/*! For license information please see main.69886b26.js.LICENSE.txt */
(()=>{var e={159:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>h,It:()=>c,QF:()=>d,R0:()=>u,fO:()=>o});var r=n(9379),s=n(3862);let i=null,a=null;const o=e=>{a=e};let l=null;const c=e=>{l=e},d=e=>{i=e};const u=new class{constructor(){this.isSyncing=!1,this.syncQueue=[],this.retryAttempts=new Map,this.maxRetries=3}isOnline(){return navigator.onLine}getSellerId(){try{const e=localStorage.getItem("auth");if(e){const t=JSON.parse(e);return t.sellerId||t.uid}return null}catch(e){return console.error("Error getting seller ID:",e),null}}getSellerIdFromCache(){try{var e;const t=localStorage.getItem("auth");if(!t)return null;const n=JSON.parse(t);return n.sellerId||(null===(e=n.currentUser)||void 0===e?void 0:e.sellerId)||null}catch(t){return console.error("Error getting sellerId from cache:",t),null}}async getSellerIdFromBackend(){try{const e=this.getSellerIdFromCache();if(e)return e;const t=localStorage.getItem("auth");if(!t)return null;const n=JSON.parse(t),i=n.currentUser;if(!i||!i.email)return null;const a=await(0,s.Pb)(i.email,i.uid,i.displayName,i.photoURL);if(a.success&&a.sellerId){const e=(0,r.A)((0,r.A)({},n),{},{sellerId:a.sellerId});return localStorage.setItem("auth",JSON.stringify(e)),a.sellerId}return null}catch(e){return console.error("Error getting seller from backend:",e),null}}async syncItem(e,t,n){try{var r,i,a,o,l,c,d,u,h,m,f;const p=this.getEndpointForStore(e);if(!p)throw new Error("No endpoint for store: ".concat(e));console.log("[SYNC] \ud83d\udce4 Sending ".concat(e," item to /sync/").concat(p),{itemId:t.id,sellerId:n,endpoint:"/sync/".concat(p)});const g=await(0,s.AT)("/sync/".concat(p),{method:"POST",body:{sellerId:n,items:[t]}});if(console.log("[SYNC] \ud83d\udce5 API response for ".concat(e," item ").concat(t.id,":"),g),!g.success)throw console.error("[SYNC] \u274c API request failed for ".concat(e," item ").concat(t.id,":"),g),new Error(g.error||g.message||"Sync failed");const x=g.data||g;return console.log("[SYNC] \ud83d\udce6 Response data structure for ".concat(e,":"),{hasData:!!g.data,hasResults:!!(null!==(r=g.data)&&void 0!==r&&r.results||g.results),successItems:(null===(i=g.data)||void 0===i||null===(a=i.results)||void 0===a||null===(o=a.success)||void 0===o?void 0:o.length)||(null===(l=g.results)||void 0===l||null===(c=l.success)||void 0===c?void 0:c.length)||0,failedItems:(null===(d=g.data)||void 0===d||null===(u=d.results)||void 0===u||null===(h=u.failed)||void 0===h?void 0:h.length)||(null===(m=g.results)||void 0===m||null===(f=m.failed)||void 0===f?void 0:f.length)||0}),x}catch(p){throw console.error("[SYNC] \u274c Error syncing item ".concat(t.id," from ").concat(e,":"),p),console.error("[SYNC] Error details:",{message:p.message,stack:p.stack,storeName:e,itemId:t.id}),p}}getEndpointForStore(e){return{customers:"customers",products:"products",orders:"orders",transactions:"transactions",purchaseOrders:"vendor-orders",categories:"categories",refunds:"refunds"}[e]}async syncStore(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const c=await t(),d=c.filter(t=>{const n=t.isSynced,r=!0!==n&&"true"!==n;if("orders"===e&&r&&a){const n=Math.round(100*(t.totalAmount||0))/100,r=JSON.stringify((t.items||[]).map(e=>({name:(e.name||"").trim(),quantity:"number"===typeof e.quantity?e.quantity:parseFloat(e.quantity)||0,sellingPrice:Math.round(100*("number"===typeof e.sellingPrice?e.sellingPrice:parseFloat(e.sellingPrice)||0))/100,costPrice:Math.round(100*("number"===typeof e.costPrice?e.costPrice:parseFloat(e.costPrice)||0))/100})).sort((e,t)=>(e.name||"").localeCompare(t.name||""))),s="".concat(t.sellerId||"","_").concat(t.customerId||"null","_").concat(n,"_").concat(r);if(a(s))return console.log("[SYNC] \u23f8\ufe0f ".concat(e,": Skipping order ").concat(t.id," - currently being processed via direct API call")),!1}return r}),u=d.filter(e=>!0===e.isDeleted);if(u.length>0&&(console.log("[SYNC] \ud83d\uddd1\ufe0f ".concat(e,": Found ").concat(u.length," deleted items to sync")),u.forEach(e=>{console.log("[SYNC] \ud83d\uddd1\ufe0f Deleted item: ".concat(e.id,", _id: ").concat(e._id||"none",", will be deleted on backend"))})),console.log("[SYNC] ".concat(e,": Found ").concat(d.length," unsynced items out of ").concat(c.length," total")),"purchaseOrders"===e&&(console.log("[SYNC] \ud83d\udd0d PURCHASE ORDERS DEBUG: Total items: ".concat(c.length)),console.log("[SYNC] \ud83d\udd0d PURCHASE ORDERS DEBUG: Unsynced items: ".concat(d.length)),console.log("[SYNC] \ud83d\udd0d PURCHASE ORDERS DEBUG: All items details:",c.map(e=>({id:e.id,supplierName:e.supplierName||e.id,isSynced:e.isSynced,isSyncedType:typeof e.isSynced,isSyncedValue:e.isSynced}))),d.length>0&&console.log("[SYNC] \ud83d\udd0d PURCHASE ORDERS DEBUG: Unsynced items details:",d.map(e=>({id:e.id,supplierName:e.supplierName||e.id,isSynced:e.isSynced,isSyncedType:typeof e.isSynced})))),console.log("[SYNC] ".concat(e,": All items isSynced status:"),c.map(e=>({id:e.id,name:e.name||e.supplierName||e.id,isSynced:e.isSynced}))),d.length>0?console.log("[SYNC] ".concat(e," unsynced items details:"),d.map(e=>({id:e.id,name:e.name||e.id,isSynced:e.isSynced,isSyncedType:typeof e.isSynced}))):console.log("[SYNC] ".concat(e,": All items are synced (isSynced === true)")),0===d.length)return{success:!0,synced:0,failed:0};let h=this.getSellerIdFromCache();if(h||(h=await this.getSellerIdFromBackend()),!h)return console.warn("No seller ID available, skipping sync"),{success:!1,error:"No seller ID"};const m={success:[],failed:[]};for(const t of d)try{console.log("[SYNC] \ud83d\udd04 Syncing ".concat(e," item:"),t.id,"isSynced:",t.isSynced),"purchaseOrders"===e?(console.log("[SYNC] \ud83d\udd0d PURCHASE ORDER SYNC: Item ID: ".concat(t.id,", Supplier: ").concat(t.supplierName,", isSynced: ").concat(t.isSynced)),console.log("[SYNC] \ud83d\udd0d PURCHASE ORDER SYNC: Full item data:",JSON.stringify(t,null,2))):console.log("[SYNC] Item data:",JSON.stringify(t,null,2));const i=await this.syncItem(e,t,h);if(console.log("[SYNC] Sync response for ".concat(e," item ").concat(t.id,":"),i),"purchaseOrders"===e&&console.log("[SYNC] \ud83d\udd0d PURCHASE ORDER SYNC RESPONSE:",JSON.stringify(i,null,2)),!i||!1===i.success){const n=(null===i||void 0===i?void 0:i.message)||(null===i||void 0===i?void 0:i.error)||"Sync failed";throw console.error("[SYNC] \u274c Sync failed for ".concat(e," item ").concat(t.id,":"),n),new Error(n)}{const a=i.results||i,o=a.success||[];if(!(o.length>0)){const n=(a.failed||[]).find(e=>e.id===t.id),r=(null===n||void 0===n?void 0:n.error)||i.message||i.error||"Sync failed - no success items";throw console.error("[SYNC] \u274c Sync failed for ".concat(e," item ").concat(t.id,":"),r),console.error("[SYNC] \u274c Failed item details:",{id:t.id,name:t.name||t.id,error:r,action:null===n||void 0===n?void 0:n.action,itemData:"products"===e?{name:t.name,description:t.description,stock:t.stock,quantity:t.quantity,unit:t.unit,costPrice:t.costPrice,sellingUnitPrice:t.sellingUnitPrice,mfg:t.mfg,expiryDate:t.expiryDate,sellerId:t.sellerId}:t}),new Error(r)}{const i=o.find(e=>e.id===t.id)||o[0];if(!0===t.isDeleted&&"deleted"===i.action)console.log("[SYNC] \ud83d\uddd1\ufe0f Item ".concat(t.id," was deleted on backend, removing from IndexedDB")),s&&(await s(t.id),console.log("[SYNC] \u2705 Deleted item ".concat(t.id," from IndexedDB after successful backend deletion"))),m.success.push(t.id),this.retryAttempts.delete(t.id),console.log("[SYNC] \u2705 Successfully deleted ".concat(e," item:"),t.id);else{const s=(0,r.A)((0,r.A)({},t),{},{isSynced:!0,syncedAt:(new Date).toISOString(),_id:i._id});s.isDeleted&&(delete s.isDeleted,delete s.deletedAt),s.isUpdate&&delete s.isUpdate,console.log("[SYNC] Updating item ".concat(t.id," in IndexedDB with isSynced: true, _id: ").concat(i._id)),await n(s),console.log("[SYNC] \u2705 Item ".concat(t.id," marked as synced in IndexedDB")),l&&l(e,s),m.success.push(t.id),this.retryAttempts.delete(t.id),console.log("[SYNC] \u2705 Successfully synced ".concat(e," item:"),t.id)}}}}catch(i){console.error("[SYNC] \u274c Failed to sync ".concat(e," item ").concat(t.id,":"),i.message),console.error("[SYNC] \u274c Error stack:",i.stack),console.error("[SYNC] \u274c Item will remain in IndexedDB for retry. Item data:",{id:t.id,name:t.name||t.id,isSynced:t.isSynced,isDeleted:t.isDeleted,sellerId:t.sellerId});const s=this.retryAttempts.get(t.id)||0,a=(0,r.A)((0,r.A)({},t),{},{isSynced:!1,syncError:i.message,syncAttempts:s+1,lastSyncAttempt:(new Date).toISOString()});try{await n(a),console.log("[SYNC] \u2705 Item ".concat(t.id," updated in IndexedDB with sync error (will retry later)"))}catch(o){console.error("[SYNC] \u274c Failed to update item ".concat(t.id," in IndexedDB:"),o)}s<this.maxRetries?(this.retryAttempts.set(t.id,s+1),m.failed.push({id:t.id,error:i.message,retry:!0})):(this.retryAttempts.set(t.id,s+1),m.failed.push({id:t.id,error:i.message,retry:!1}),console.warn("[SYNC] \u26a0\ufe0f Item ".concat(t.id," has exceeded max retry attempts (").concat(this.maxRetries,"). It will remain in IndexedDB but sync will not be retried automatically.")))}return{success:0===m.failed.length,synced:m.success.length,failed:m.failed.length,failedItems:m.failed}}catch(i){return console.error("Error syncing store ".concat(e,":"),i),{success:!1,error:i.message}}}async buildProductIdMapping(e,t){try{const n=await e();console.log("[SYNC] \ud83d\udd17 Building product ID mapping...");for(const e of n)e.id&&e._id&&!0===e.isSynced&&(t.set(e.id,e._id),console.log("[SYNC] \ud83d\udd17 Mapped product: ".concat(e.id," -> ").concat(e._id)));console.log("[SYNC] \ud83d\udd17 Product ID mapping built: ".concat(t.size," products mapped"))}catch(n){console.error("[SYNC] \u274c Error building product ID mapping:",n)}}async updateOrderProductIds(e,t,n){try{const s=(await e()).filter(e=>!0!==e.isSynced);if(0===s.length||0===n.size)return void console.log("[SYNC] \u2139\ufe0f No orders to update or no product mapping available");console.log("[SYNC] \ud83d\udd04 Updating productId in ".concat(s.length," unsynced orders..."));let i=0;for(const e of s){if(!e.items||!Array.isArray(e.items))continue;let s=!1;const a=e.items.map(e=>{if(e.productId&&"string"===typeof e.productId&&!e.productId.match(/^[0-9a-fA-F]{24}$/)){const t=n.get(e.productId);return t?(console.log("[SYNC] \ud83d\udd04 Mapping order item productId: ".concat(e.productId," -> ").concat(t)),s=!0,(0,r.A)((0,r.A)({},e),{},{productId:t})):(console.warn("[SYNC] \u26a0\ufe0f Product ".concat(e.productId," not found in mapping, setting productId to null")),s=!0,(0,r.A)((0,r.A)({},e),{},{productId:null}))}return e});if(s){const n=(0,r.A)((0,r.A)({},e),{},{items:a});await t(n),i++,console.log("[SYNC] \u2705 Updated order ".concat(e.id," productId references"))}}console.log("[SYNC] \u2705 Updated ".concat(i," orders with productId mappings"))}catch(s){console.error("[SYNC] \u274c Error updating order productIds:",s)}}async syncAll(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||i;if(!e)return console.error("[SYNC] Store functions provider not set"),{success:!1,error:"Store functions provider not set"};if(this.isSyncing)return console.log("[SYNC] Sync already in progress, skipping..."),{success:!1,error:"Sync in progress"};if(!this.isOnline())return console.log("[SYNC] Offline, cannot sync"),{success:!1,error:"Offline"};console.log("[SYNC] ========== Starting sync to MongoDB =========="),this.isSyncing=!0;try{let t=this.getSellerIdFromCache();if(t||(console.log("[SYNC] SellerId not in cache, fetching from backend..."),t=await this.getSellerIdFromBackend()),!t)return console.error("[SYNC] No seller ID available"),{success:!1,error:"No seller ID"};console.log("[SYNC] Using sellerId:",t);const n={};let r=0,s=0;const i=new Map,a=["categories","products","customers","orders","transactions","purchaseOrders","refunds"];for(const o of a){const t=e(o);if(t){console.log("[SYNC] \ud83d\udd04 Syncing ".concat(o,"...")),console.log("[SYNC] Store functions available:",{getAllItems:typeof t.getAllItems,updateItem:typeof t.updateItem,deleteItem:typeof t.deleteItem}),"products"===o&&await this.buildProductIdMapping(t.getAllItems,i),"orders"===o&&await this.updateOrderProductIds(t.getAllItems,t.updateItem,i);const e=await this.syncStore(o,t.getAllItems,t.updateItem,t.deleteItem);"products"===o&&e.synced>0&&await this.buildProductIdMapping(t.getAllItems,i),n[o]=e,r+=e.synced||0,s+=e.failed||0,e.synced>0&&console.log("[SYNC] \u2705 ".concat(o,": ").concat(e.synced," items synced successfully")),e.failed>0&&(console.log("[SYNC] \u26a0\ufe0f ".concat(o,": ").concat(e.failed," items failed to sync")),e.failedItems&&console.log("[SYNC] Failed items:",e.failedItems)),0===e.synced&&0===e.failed&&(console.log("[SYNC] \u2139\ufe0f ".concat(o,": No items to sync")),"purchaseOrders"===o&&console.log("[SYNC] \u26a0\ufe0f PURCHASE ORDERS: No items synced - check if items have isSynced: false"))}else console.warn("[SYNC] \u26a0\ufe0f No store functions found for ".concat(o)),"purchaseOrders"===o&&console.error("[SYNC] \u274c PURCHASE ORDERS: Store functions not found! Check getStoreFunctions implementation.")}return console.log("[SYNC] ========== Sync Complete =========="),console.log("[SYNC] Total synced: ".concat(r,", Total failed: ").concat(s)),{success:0===s,results:n,summary:{totalSynced:r,totalFailed:s}}}catch(t){return console.error("[SYNC] \u274c Error in batch sync:",t),{success:!1,error:t.message}}finally{this.isSyncing=!1}}async retryFailedSyncs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!(e||i))return console.error("Store functions provider not set"),{success:!1,error:"Store functions provider not set"};if(!this.isOnline())return{success:!1,error:"Offline"};let t=this.getSellerIdFromCache();if(t||(t=await this.getSellerIdFromBackend()),!t)return{success:!1,error:"No seller ID"};const n={},r=["categories","products","customers","orders","transactions","purchaseOrders"];for(const i of r){const t=e(i);if(t)try{const e=(await t.getAllItems()).filter(e=>!1===e.isSynced&&e.syncError&&(this.retryAttempts.get(e.id)||0)<this.maxRetries);e.length>0&&(console.log("Retrying ".concat(e.length," failed items in ").concat(i,"...")),n[i]=await this.syncStore(i,t.getAllItems,t.updateItem))}catch(s){console.error("Error retrying ".concat(i,":"),s)}}return{success:!0,results:n}}startAutoSync(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||i;t?(this.syncAll(t),this.syncInterval=setInterval(()=>{this.isOnline()&&!this.isSyncing&&this.syncAll(t)},e),window.addEventListener("online",()=>{console.log("\ud83c\udf10 Back online event detected, triggering sync..."),setTimeout(()=>{this.isOnline()&&this.syncAll(t).catch(e=>{console.error("Error syncing after coming online:",e)})},1e3)})):console.error("Store functions provider not set")}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}},h=u},350:(e,t,n)=>{const r=n(7969),s=r.getBCHDigit(1335);t.getEncodedBits=function(e,t){const n=e.bit<<3|t;let i=n<<10;for(;r.getBCHDigit(i)-s>=0;)i^=1335<<r.getBCHDigit(i)-s;return 21522^(n<<10|i)}},579:(e,t,n)=>{"use strict";e.exports=n(1153)},736:(e,t,n)=>{"use strict";n.d(t,{auth:()=>Re,hJ:()=>Oe});var r=n(1150);(0,r.KO)("firebase","12.5.0","app");var s=n(3637),i=n(9379),a=n(2965),o=n(1776),l=n(9606),c=n(2799);const d="@firebase/installations",u="0.6.19",h=1e4,m="w:".concat(u),f="FIS_v2",p=36e5,g={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},x=new o.FA("installations","Installations",g);function y(e){return e instanceof o.g&&e.code.includes("request-failed")}function b(e){let{projectId:t}=e;return"".concat("https://firebaseinstallations.googleapis.com/v1","/projects/").concat(t,"/installations")}function w(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function v(e,t){const n=(await t.json()).error;return x.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function N(e){let{apiKey:t}=e;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function S(e,t){let{refreshToken:n}=t;const r=N(e);return r.append("Authorization",function(e){return"".concat(f," ").concat(e)}(n)),r}async function A(e){const t=await e();return t.status>=500&&t.status<600?e():t}function _(e){return new Promise(t=>{setTimeout(t,e)})}const C=/^[cdef][\w-]{21}$/;function I(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){const t=(n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return C.test(t)?t:""}catch(e){return""}}function E(e){return"".concat(e.appName,"!").concat(e.appId)}const T=new Map;function j(e,t){const n=E(e);k(n,t),function(e,t){const n=P();n&&n.postMessage({key:e,fid:t});R()}(n,t)}function k(e,t){const n=T.get(e);if(n)for(const r of n)r(t)}let D=null;function P(){return!D&&"BroadcastChannel"in self&&(D=new BroadcastChannel("[Firebase] FID Change"),D.onmessage=e=>{k(e.data.key,e.data.fid)}),D}function R(){0===T.size&&D&&(D.close(),D=null)}const O="firebase-installations-store";let L=null;function M(){return L||(L=(0,c.P2)("firebase-installations-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(O)}})),L}async function F(e,t){const n=E(e),r=(await M()).transaction(O,"readwrite"),s=r.objectStore(O),i=await s.get(n);return await s.put(t,n),await r.done,i&&i.fid===t.fid||j(e,t.fid),t}async function B(e){const t=E(e),n=(await M()).transaction(O,"readwrite");await n.objectStore(O).delete(t),await n.done}async function U(e,t){const n=E(e),r=(await M()).transaction(O,"readwrite"),s=r.objectStore(O),i=await s.get(n),a=t(i);return void 0===a?await s.delete(n):await s.put(a,n),await r.done,!a||i&&i.fid===a.fid||j(e,a.fid),a}async function z(e){let t;const n=await U(e.appConfig,n=>{const r=function(e){const t=e||{fid:I(),registrationStatus:0};return V(t)}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(x.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function(e,t){let{appConfig:n,heartbeatServiceProvider:r}=e,{fid:s}=t;const i=b(n),a=N(n),o=r.getImmediate({optional:!0});if(o){const e=await o.getHeartbeatsHeader();e&&a.append("x-firebase-client",e)}const l={fid:s,authVersion:f,appId:n.appId,sdkVersion:m},c={method:"POST",headers:a,body:JSON.stringify(l)},d=await A(()=>fetch(i,c));if(d.ok){const e=await d.json();return{fid:e.fid||s,registrationStatus:2,refreshToken:e.refreshToken,authToken:w(e.authToken)}}throw await v("Create Installation",d)}(e,t);return F(e.appConfig,n)}catch(n){throw y(n)&&409===n.customData.serverCode?await B(e.appConfig):await F(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:q(e)}:{installationEntry:t}}(e,r);return t=s.registrationPromise,s.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function q(e){let t=await H(e.appConfig);for(;1===t.registrationStatus;)await _(100),t=await H(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await z(e);return n||t}return t}function H(e){return U(e,e=>{if(!e)throw x.create("installation-not-found");return V(e)})}function V(e){return 1===(t=e).registrationStatus&&t.registrationTime+h<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function W(e,t){let{appConfig:n,heartbeatServiceProvider:r}=e;const s=function(e,t){let{fid:n}=t;return"".concat(b(e),"/").concat(n,"/authTokens:generate")}(n,t),i=S(n,t),a=r.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:m,appId:n.appId}},l={method:"POST",headers:i,body:JSON.stringify(o)},c=await A(()=>fetch(s,l));if(c.ok){return w(await c.json())}throw await v("Generate Auth Token",c)}async function G(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=await U(e.appConfig,r=>{if(!X(r))throw x.create("not-registered");const s=r.authToken;if(!n&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+p}(e)}(s))return r;if(1===s.requestStatus)return t=async function(e,t){let n=await Y(e.appConfig);for(;1===n.authToken.requestStatus;)await _(100),n=await Y(e.appConfig);const r=n.authToken;return 0===r.requestStatus?G(e,t):r}(e,n),r;{if(!navigator.onLine)throw x.create("app-offline");const n=function(e){const t={requestStatus:1,requestTime:Date.now()};return(0,i.A)((0,i.A)({},e),{},{authToken:t})}(r);return t=async function(e,t){try{const n=await W(e,t),r=(0,i.A)((0,i.A)({},t),{},{authToken:n});return await F(e.appConfig,r),n}catch(n){if(!y(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=(0,i.A)((0,i.A)({},t),{},{authToken:{requestStatus:0}});await F(e.appConfig,n)}else await B(e.appConfig);throw n}}(e,n),n}});return t?await t:r.authToken}function Y(e){return U(e,e=>{if(!X(e))throw x.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+h<Date.now()?(0,i.A)((0,i.A)({},e),{},{authToken:{requestStatus:0}}):e;var n})}function X(e){return void 0!==e&&2===e.registrationStatus}async function Q(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e;await async function(e){const{registrationPromise:t}=await z(e);t&&await t}(n);return(await G(n,t)).token}function K(e){return x.create("missing-app-config-values",{valueName:e})}const Z="installations",J=e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw K("App Configuration");if(!e.name)throw K("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw K(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,r.j6)(t,"heartbeat"),_delete:()=>Promise.resolve()}},$=e=>{const t=e.getProvider("app").getImmediate(),n=(0,r.j6)(t,Z).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await z(t);return r?r.catch(console.error):G(t).catch(console.error),n.fid}(n),getToken:e=>Q(n,e)}};(0,r.om)(new l.uA(Z,J,"PUBLIC")),(0,r.om)(new l.uA("installations-internal",$,"PRIVATE")),(0,r.KO)(d,u),(0,r.KO)(d,u,"esm2020");const ee="analytics",te="https://www.googletagmanager.com/gtag/js",ne=new a.Vy("@firebase/analytics"),re={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},se=new o.FA("analytics","Analytics",re);function ie(e){if(!e.startsWith(te)){const t=se.create("invalid-gtag-resource",{gtagURL:e});return ne.warn(t.message),""}return e}function ae(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function oe(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:ie}),r=document.createElement("script"),s="".concat(te,"?l=").concat(e,"&id=").concat(t);r.src=n?null===n||void 0===n?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function le(e,t,n,r){return async function(s){try{for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if("event"===s){const[r,s]=a;await async function(e,t,n,r,s){try{let i=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const r=await ae(n);for(const n of e){const e=r.find(e=>e.measurementId===n),s=e&&t[e.appId];if(!s){i=[];break}i.push(s)}}0===i.length&&(i=Object.values(t)),await Promise.all(i),e("event",r,s||{})}catch(i){ne.error(i)}}(e,t,n,r,s)}else if("config"===s){const[s,i]=a;await async function(e,t,n,r,s,i){const a=r[s];try{if(a)await t[a];else{const e=(await ae(n)).find(e=>e.measurementId===s);e&&await t[e.appId]}}catch(o){ne.error(o)}e("config",s,i)}(e,t,n,r,s,i)}else if("consent"===s){const[t,n]=a;e("consent",t,n)}else if("get"===s){const[t,n,r]=a;e("get",t,n,r)}else if("set"===s){const[t]=a;e("set",t)}else e(s,...a)}catch(l){ne.error(l)}}}const ce=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function de(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce,n=arguments.length>2?arguments[2]:void 0;const{appId:r,apiKey:s,measurementId:i}=e.options;if(!r)throw se.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw se.create("no-api-key")}const a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new me;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),he({appId:r,apiKey:s,measurementId:i},a,o,t)}async function he(e,t,n){let{throttleEndTimeMillis:r,backoffCount:s}=t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ce;const{appId:a,measurementId:l}=e;try{await function(e,t){return new Promise((n,r)=>{const s=Math.max(t-Date.now(),0),i=setTimeout(n,s);e.addEventListener(()=>{clearTimeout(i),r(se.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(n,r)}catch(d){if(l)return ne.warn("Timed out fetching this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===d||void 0===d?void 0:d.message,"]")),{appId:a,measurementId:l};throw d}try{const t=await async function(e){const{appId:t,apiKey:n}=e,r={method:"GET",headers:de(n)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),i=await fetch(s,r);if(200!==i.status&&304!==i.status){let e="";try{var a;const t=await i.json();null!==(a=t.error)&&void 0!==a&&a.message&&(e=t.error.message)}catch(o){}throw se.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}return i.json()}(e);return i.deleteThrottleMetadata(a),t}catch(d){var c;const t=d;if(!function(e){if(!(e instanceof o.g)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(i.deleteThrottleMetadata(a),l)return ne.warn("Failed to fetch this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===t||void 0===t?void 0:t.message,"]")),{appId:a,measurementId:l};throw d}const r=503===Number(null===t||void 0===t||null===(c=t.customData)||void 0===c?void 0:c.httpStatus)?(0,o.p9)(s,i.intervalMillis,30):(0,o.p9)(s,i.intervalMillis),u={throttleEndTimeMillis:Date.now()+r,backoffCount:s+1};return i.setThrottleMetadata(a,u),ne.debug("Calling attemptFetch again in ".concat(r," millis")),he(e,u,n,i)}}class me{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let fe,pe;function ge(e){pe=e}function xe(e){fe=e}async function ye(e,t,n,r,s,i,a){var l;const c=ue(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ne.warn("The measurement ID in the local Firebase config (".concat(e.options.measurementId,")")+" does not match the measurement ID fetched from the server (".concat(t.measurementId,").")+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>ne.error(e)),t.push(c);const d=async function(){if(!(0,o.zW)())return ne.warn(se.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,o.eX)()}catch(e){return ne.warn(se.create("indexeddb-unavailable",{errorInfo:null===e||void 0===e?void 0:e.toString()}).message),!1}return!0}().then(e=>e?r.getId():void 0),[u,h]=await Promise.all([c,d]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(te)&&n.src.includes(e))return n;return null})(i)||oe(i,u.measurementId),pe&&(s("consent","default",pe),ge(void 0)),s("js",new Date);const m=null!==(l=null===a||void 0===a?void 0:a.config)&&void 0!==l?l:{};return m.origin="firebase",m.update=!0,null!=h&&(m.firebase_id=h),s("config",u.measurementId,m),fe&&(s("set",fe),xe(void 0)),u.measurementId}class be{constructor(e){this.app=e}_delete(){return delete we[this.app.options.appId],Promise.resolve()}}let we={},ve=[];const Ne={};let Se,Ae,_e="dataLayer",Ce="gtag",Ie=!1;function Ee(e,t,n){!function(){const e=[];if((0,o.sr)()&&e.push("This is a browser extension environment."),(0,o.dM)()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>"(".concat(t+1,") ").concat(e)).join(" "),n=se.create("invalid-analytics-context",{errorInfo:t});ne.warn(n.message)}}();const r=e.options.appId;if(!r)throw se.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw se.create("no-api-key");ne.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+" measurement ID for this Firebase app. Falling back to the measurement ID ".concat(e.options.measurementId)+' provided in the "measurementId" field in the local Firebase config.')}if(null!=we[r])throw se.create("already-exists",{id:r});if(!Ie){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(_e);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,s){let i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window[r].push(arguments)};return window[s]&&"function"===typeof window[s]&&(i=window[s]),window[s]=le(i,e,t,n),{gtagCore:i,wrappedGtag:window[s]}}(we,ve,Ne,_e,Ce);Ae=e,Se=t,Ie=!0}we[r]=ye(e,ve,Ne,t,Se,_e,n);return new be(e)}function Te(e,t,n){e=(0,o.Ku)(e),async function(e,t,n,r){if(r&&r.global){const t={};for(const e of Object.keys(n))t["user_properties.".concat(e)]=n[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Ae,we[e.app.options.appId],t,n).catch(e=>ne.error(e))}function je(e,t,n,r){e=(0,o.Ku)(e),async function(e,t,n,r,s){if(s&&s.global)e("event",n,r);else{const s=await t;e("event",n,(0,i.A)((0,i.A)({},r),{},{send_to:s}))}}(Ae,we[e.app.options.appId],t,n,r).catch(e=>ne.error(e))}const ke="@firebase/analytics",De="0.10.19";(0,r.om)(new l.uA(ee,(e,t)=>{let{options:n}=t;return Ee(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),n)},"PUBLIC")),(0,r.om)(new l.uA("analytics-internal",function(e){try{const t=e.getProvider(ee).getImmediate();return{logEvent:(e,n,r)=>je(t,e,n,r),setUserProperties:(e,n)=>Te(t,e,n)}}catch(t){throw se.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),(0,r.KO)(ke,De),(0,r.KO)(ke,De,"esm2020");const Pe=(0,r.Wp)({apiKey:"AIzaSyDCYsrrPg3VllgwR1K02jmvOo7bbgjtR3A",authDomain:"dragdrop-2a9a4.firebaseapp.com",projectId:"dragdrop-2a9a4",storageBucket:"dragdrop-2a9a4.firebasestorage.app",messagingSenderId:"1016804641337",appId:"1:1016804641337:web:306c4fa562b86f2cd61be8",measurementId:"G-GKV9HX0ZL8"}),Re=(0,s.xI)(Pe),Oe=new s.HF;let Le;Oe.addScope("profile"),Oe.addScope("email"),Oe.setCustomParameters({prompt:"select_account"}),"undefined"!==typeof window&&Re.authStateReady().catch(()=>{}),"undefined"!==typeof window&&(Le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.Sx)();e=(0,o.Ku)(e);const t=(0,r.j6)(e,ee);return t.isInitialized()?t.getImmediate():function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,r.j6)(e,ee);if(n.isInitialized()){const e=n.getImmediate();if((0,o.bD)(t,n.getOptions()))return e;throw se.create("already-initialized")}return n.initialize({options:t})}(e)}(Pe))},900:(e,t,n)=>{const r=n(7421);function s(e){this.mode=r.NUMERIC,this.data=e.toString()}s.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const s=this.data.length-t;s>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,3*s+1))},e.exports=s},1150:(e,t,n)=>{"use strict";n.d(t,{KO:()=>$,MF:()=>K,Sx:()=>J,Wp:()=>Z,j6:()=>W,om:()=>V,xZ:()=>G});var r=n(9379),s=n(9606),i=n(2965),a=n(1776),o=n(2799);class l{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const c="@firebase/app",d="0.14.5",u=new i.Vy("@firebase/app"),h="@firebase/app-compat",m="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",g="@firebase/app-check",x="@firebase/auth",y="@firebase/auth-compat",b="@firebase/database",w="@firebase/data-connect",v="@firebase/database-compat",N="@firebase/functions",S="@firebase/functions-compat",A="@firebase/installations",_="@firebase/installations-compat",C="@firebase/messaging",I="@firebase/messaging-compat",E="@firebase/performance",T="@firebase/performance-compat",j="@firebase/remote-config",k="@firebase/remote-config-compat",D="@firebase/storage",P="@firebase/storage-compat",R="@firebase/firestore",O="@firebase/ai",L="@firebase/firestore-compat",M="firebase",F="[DEFAULT]",B={[c]:"fire-core",[h]:"fire-core-compat",[f]:"fire-analytics",[m]:"fire-analytics-compat",[g]:"fire-app-check",[p]:"fire-app-check-compat",[x]:"fire-auth",[y]:"fire-auth-compat",[b]:"fire-rtdb",[w]:"fire-data-connect",[v]:"fire-rtdb-compat",[N]:"fire-fn",[S]:"fire-fn-compat",[A]:"fire-iid",[_]:"fire-iid-compat",[C]:"fire-fcm",[I]:"fire-fcm-compat",[E]:"fire-perf",[T]:"fire-perf-compat",[j]:"fire-rc",[k]:"fire-rc-compat",[D]:"fire-gcs",[P]:"fire-gcs-compat",[R]:"fire-fst",[L]:"fire-fst-compat",[O]:"fire-vertex","fire-js":"fire-js",[M]:"fire-js-all"},U=new Map,z=new Map,q=new Map;function H(e,t){try{e.container.addComponent(t)}catch(n){u.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function V(e){const t=e.name;if(q.has(t))return u.debug("There were multiple attempts to register component ".concat(t,".")),!1;q.set(t,e);for(const n of U.values())H(n,e);for(const n of z.values())H(n,e);return!0}function W(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function G(e){return null!==e&&void 0!==e&&void 0!==e.settings}const Y={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},X=new a.FA("app","Firebase",Y);class Q{constructor(e,t,n){this._isDeleted=!1,this._options=(0,r.A)({},e),this._config=(0,r.A)({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw X.create("app-deleted",{appName:this._name})}}const K="12.5.0";function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=(0,r.A)({name:F,automaticDataCollectionEnabled:!0},t),o=i.name;if("string"!==typeof o||!o)throw X.create("bad-app-name",{appName:String(o)});if(n||(n=(0,a.T9)()),!n)throw X.create("no-options");const l=U.get(o);if(l){if((0,a.bD)(n,l.options)&&(0,a.bD)(i,l.config))return l;throw X.create("duplicate-app",{appName:o})}const c=new s.h1(o);for(const r of q.values())c.addComponent(r);const d=new Q(n,i,c);return U.set(o,d),d}function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;const t=U.get(e);if(!t&&e===F&&(0,a.T9)())return Z();if(!t)throw X.create("no-app",{appName:e});return t}function $(e,t,n){var r;let i=null!==(r=B[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void u.warn(e.join(" "))}V(new s.uA("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const ee="firebase-heartbeat-store";let te=null;function ne(){return te||(te=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ee)}catch(n){console.warn(n)}}}).catch(e=>{throw X.create("idb-open",{originalErrorMessage:e.message})})),te}async function re(e,t){try{const n=(await ne()).transaction(ee,"readwrite"),r=n.objectStore(ee);await r.put(t,se(e)),await n.done}catch(n){if(n instanceof a.g)u.warn(n.message);else{const e=X.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});u.warn(e.message)}}}function se(e){return"".concat(e.name,"!").concat(e.options.appId)}class ie{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oe(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ae();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){u.warn(n)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ae(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),le(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),le(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=(0,a.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return u.warn(t),""}}}function ae(){return(new Date).toISOString().substring(0,10)}class oe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,a.zW)()&&(0,a.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ne()).transaction(ee),n=await t.objectStore(ee).get(se(e));return await t.done,n}catch(t){if(t instanceof a.g)u.warn(t.message);else{const e=X.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});u.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function le(e){return(0,a.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var ce;ce="",V(new s.uA("platform-logger",e=>new l(e),"PRIVATE")),V(new s.uA("heartbeat",e=>new ie(e),"PRIVATE")),$(c,d,ce),$(c,d,"esm2020"),$("fire-js","")},1153:(e,t,n)=>{"use strict";var r=n(5043),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,d=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:d,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},1166:(e,t)=>{const n=new Uint8Array(512),r=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)n[t]=e,r[e]=t,e<<=1,256&e&&(e^=285);for(let t=255;t<512;t++)n[t]=n[t-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return r[e]},t.exp=function(e){return n[e]},t.mul=function(e,t){return 0===e||0===t?0:n[r[e]+r[t]]}},1312:(e,t,n)=>{const r=n(1166);t.mul=function(e,t){const n=new Uint8Array(e.length+t.length-1);for(let s=0;s<e.length;s++)for(let i=0;i<t.length;i++)n[s+i]^=r.mul(e[s],t[i]);return n},t.mod=function(e,t){let n=new Uint8Array(e);for(;n.length-t.length>=0;){const e=n[0];for(let i=0;i<t.length;i++)n[i]^=r.mul(t[i],e);let s=0;for(;s<n.length&&0===n[s];)s++;n=n.slice(s)}return n},t.generateECPolynomial=function(e){let n=new Uint8Array([1]);for(let s=0;s<e;s++)n=t.mul(n,new Uint8Array([1,r.exp(s)]));return n}},1337:(e,t,n)=>{"use strict";n.r(t),n.d(t,{STORES:()=>d,addItem:()=>C,addMultipleItems:()=>D,clearAllItems:()=>O,countItems:()=>k,deleteDatabase:()=>re,deleteItem:()=>j,deleteMultipleItems:()=>R,deleteStaffMember:()=>me,exportData:()=>$,getActivitiesByDateRange:()=>Y,getActivitiesByType:()=>G,getAllItems:()=>I,getCustomerStats:()=>J,getDatabaseInfo:()=>se,getExpiringProducts:()=>q,getInventoryValue:()=>Z,getItem:()=>E,getItemsByIndex:()=>L,getItemsByRange:()=>M,getLowStockProducts:()=>z,getPaginatedItems:()=>X,getProductsByCategory:()=>U,getPurchaseOrdersByStatus:()=>W,getStaffMember:()=>de,getStaffMembers:()=>ue,getStaffPermissions:()=>ae,getTotalPurchaseOrders:()=>K,getTotalSales:()=>Q,getTransactionsByCustomer:()=>H,getTransactionsByDateRange:()=>V,importData:()=>ee,isIndexedDBAvailable:()=>o,openDB:()=>h,resetIndexedDBAvailabilityCache:()=>l,saveStaffMember:()=>le,saveStaffMembers:()=>ce,saveStaffPermissions:()=>ie,searchCustomers:()=>F,searchProducts:()=>B,syncDataFromBackend:()=>ne,syncDataToBackend:()=>te,updateItem:()=>T,updateMultipleItems:()=>P,updateStaffMember:()=>he,updateStaffPermissions:()=>oe});var r=n(9379);let s=null,i=null,a=0;const o=async()=>{if(null!==s)return s;if(i)return i;try{return window.indexedDB?(i=new Promise(e=>{const t=indexedDB.open("test-db",1);t.onerror=()=>{console.warn("\u26a0\ufe0f IndexedDB test failed - likely private browsing or storage disabled"),s=!1,i=null,e(!1)},t.onsuccess=()=>{t.result.close(),indexedDB.deleteDatabase("test-db"),s=!0,i=null,e(!0)},setTimeout(()=>{const t=Date.now();t-a>3e4&&(console.warn("\u26a0\ufe0f IndexedDB availability check timed out"),a=t),s=!1,i=null,e(!1)},3e3)}),i):(console.warn("\u26a0\ufe0f IndexedDB is not supported in this browser"),s=!1,!1)}catch(e){return console.warn("\u26a0\ufe0f IndexedDB availability check failed:",e),s=!1,i=null,!1}},l=()=>{s=null,i=null,a=0},c="ERP_DB",d={customers:"customers",products:"products",orders:"orders",transactions:"transactions",purchaseOrders:"purchaseOrders",categories:"categories",refunds:"refunds",plans:"plans",planOrders:"planOrders",planDetails:"planDetails",settings:"settings",staff:"staff",activities:"activities",syncMetadata:"syncMetadata",staffPermissions:"staffPermissions"},u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{const n=await h();return n?await e(n):(console.log("\u2139\ufe0f IndexedDB unavailable - using fallback"),t)}catch(n){return console.warn("\u26a0\ufe0f IndexedDB operation failed:",n),t}},h=()=>new Promise((e,t)=>{const n=indexedDB.open(c,21);n.onerror=()=>{const e=n.error,r=(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.toString())||"Unknown IndexedDB error";r.includes("Internal error opening backing store")||r.includes("UnknownError")||r.includes("QuotaExceededError")?(console.warn("\u26a0\ufe0f IndexedDB storage error - app will continue with in-memory data only"),t(new Error("IndexedDB storage unavailable"))):t(e)},n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result,n=e.target.transaction,r=e.oldVersion;if(console.log("\ud83d\udd04 Upgrading IndexedDB from version ".concat(r," to ").concat(21)),t.objectStoreNames.contains(d.customers)){const e=n.objectStore(d.customers);r<7&&e.indexNames.contains("phone")&&e.deleteIndex("phone"),r<9&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1})),r<6&&(e.indexNames.contains("mobileNumber")||e.createIndex("mobileNumber","mobileNumber",{unique:!1}),e.indexNames.contains("dueAmount")||e.createIndex("dueAmount","dueAmount",{unique:!1}),e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1})),e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1})}else{const e=t.createObjectStore(d.customers,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("name","name",{unique:!1}),e.createIndex("mobileNumber","mobileNumber",{unique:!1}),e.createIndex("email","email",{unique:!1}),e.createIndex("dueAmount","dueAmount",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(t.objectStoreNames.contains(d.products)){const e=n.objectStore(d.products);if(r<9&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1})),r<8&&(e.indexNames.contains("stock")||e.createIndex("stock","stock",{unique:!1}),e.indexNames.contains("costPrice")||e.createIndex("costPrice","costPrice",{unique:!1}),e.indexNames.contains("sellingUnitPrice")||e.createIndex("sellingUnitPrice","sellingUnitPrice",{unique:!1}),e.indexNames.contains("mfg")||e.createIndex("mfg","mfg",{unique:!1})),r<6){e.indexNames.contains("quantity")||e.createIndex("quantity","quantity",{unique:!1}),e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1});[{name:"categoryId",keyPath:"categoryId",unique:!1},{name:"unit",keyPath:"unit",unique:!1},{name:"lowStockLevel",keyPath:"lowStockLevel",unique:!1},{name:"sellingUnitPrice",keyPath:"sellingUnitPrice",unique:!1},{name:"isActive",keyPath:"isActive",unique:!1}].forEach(t=>{e.indexNames.contains(t.name)||e.createIndex(t.name,t.keyPath,{unique:t.unique})})}e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1})}else{const e=t.createObjectStore(d.products,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("name","name",{unique:!1}),e.createIndex("barcode","barcode",{unique:!1}),e.createIndex("categoryId","categoryId",{unique:!1}),e.createIndex("stock","stock",{unique:!1}),e.createIndex("quantity","quantity",{unique:!1}),e.createIndex("unit","unit",{unique:!1}),e.createIndex("lowStockLevel","lowStockLevel",{unique:!1}),e.createIndex("costPrice","costPrice",{unique:!1}),e.createIndex("sellingUnitPrice","sellingUnitPrice",{unique:!1}),e.createIndex("mfg","mfg",{unique:!1}),e.createIndex("expiryDate","expiryDate",{unique:!1}),e.createIndex("description","description",{unique:!1}),e.createIndex("isActive","isActive",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(t.objectStoreNames.contains(d.transactions)){const e=n.objectStore(d.transactions);if(r<9&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1})),r<8){[{name:"type",keyPath:"type",unique:!1},{name:"amount",keyPath:"amount",unique:!1},{name:"paymentMethod",keyPath:"paymentMethod",unique:!1},{name:"description",keyPath:"description",unique:!1},{name:"date",keyPath:"date",unique:!1},{name:"razorpayOrderId",keyPath:"razorpayOrderId",unique:!1},{name:"razorpayPaymentId",keyPath:"razorpayPaymentId",unique:!1},{name:"planOrderId",keyPath:"planOrderId",unique:!1},{name:"planId",keyPath:"planId",unique:!1}].forEach(t=>{e.indexNames.contains(t.name)||e.createIndex(t.name,t.keyPath,{unique:t.unique})})}r<6&&(e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1})),e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1})}else{const e=t.createObjectStore(d.transactions,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("type","type",{unique:!1}),e.createIndex("amount","amount",{unique:!1}),e.createIndex("paymentMethod","paymentMethod",{unique:!1}),e.createIndex("description","description",{unique:!1}),e.createIndex("date","date",{unique:!1}),e.createIndex("razorpayOrderId","razorpayOrderId",{unique:!1}),e.createIndex("razorpayPaymentId","razorpayPaymentId",{unique:!1}),e.createIndex("planOrderId","planOrderId",{unique:!1}),e.createIndex("planId","planId",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1}),e.createIndex("customerId","customerId",{unique:!1}),e.createIndex("customerName","customerName",{unique:!1}),e.createIndex("total","total",{unique:!1})}if(t.objectStoreNames.contains(d.purchaseOrders)){const e=n.objectStore(d.purchaseOrders);if(r<9&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1}),e.indexNames.contains("notes")||e.createIndex("notes","notes",{unique:!1}),e.indexNames.contains("cancelledReason")||e.createIndex("cancelledReason","cancelledReason",{unique:!1})),r<6){[{name:"expectedDeliveryDate",keyPath:"expectedDeliveryDate",unique:!1},{name:"actualDeliveryDate",keyPath:"actualDeliveryDate",unique:!1},{name:"cancelledAt",keyPath:"cancelledAt",unique:!1},{name:"isSynced",keyPath:"isSynced",unique:!1}].forEach(t=>{e.indexNames.contains(t.name)||e.createIndex(t.name,t.keyPath,{unique:t.unique})})}e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1})}else{const e=t.createObjectStore(d.purchaseOrders,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("supplierName","supplierName",{unique:!1}),e.createIndex("status","status",{unique:!1}),e.createIndex("total","total",{unique:!1}),e.createIndex("notes","notes",{unique:!1}),e.createIndex("expectedDeliveryDate","expectedDeliveryDate",{unique:!1}),e.createIndex("actualDeliveryDate","actualDeliveryDate",{unique:!1}),e.createIndex("cancelledAt","cancelledAt",{unique:!1}),e.createIndex("cancelledReason","cancelledReason",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(!t.objectStoreNames.contains(d.activities)){const e=t.createObjectStore(d.activities,{keyPath:"id",autoIncrement:!1});e.createIndex("type","type",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}if(!t.objectStoreNames.contains(d.syncMetadata)){const e=t.createObjectStore(d.syncMetadata,{keyPath:"id",autoIncrement:!1});e.createIndex("collection","collection",{unique:!0}),e.createIndex("lastSync","lastSync",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}if(r<9&&(t.objectStoreNames.contains("invoices")&&t.deleteObjectStore("invoices"),t.objectStoreNames.contains(d.settings)&&t.deleteObjectStore("settings")),!t.objectStoreNames.contains(d.settings)){const e=t.createObjectStore(d.settings,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}if(t.objectStoreNames.contains(d.orders)){const e=n.objectStore(d.orders);if(r<11){[{name:"sellerId",keyPath:"sellerId"},{name:"customerId",keyPath:"customerId"},{name:"paymentMethod",keyPath:"paymentMethod"},{name:"totalAmount",keyPath:"totalAmount"},{name:"createdAt",keyPath:"createdAt"},{name:"updatedAt",keyPath:"updatedAt"},{name:"isSynced",keyPath:"isSynced"},{name:"syncedAt",keyPath:"syncedAt"},{name:"_id",keyPath:"_id"},{name:"isDeleted",keyPath:"isDeleted"}].forEach(t=>{e.indexNames.contains(t.name)||(console.log("[IndexedDB Migration] Adding index ".concat(t.name," to orders store")),e.createIndex(t.name,t.keyPath,{unique:!1}))})}r<17&&console.log("[IndexedDB Migration v17] Orders store now supports splitPaymentDetails")}else{const e=t.createObjectStore(d.orders,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("customerId","customerId",{unique:!1}),e.createIndex("paymentMethod","paymentMethod",{unique:!1}),e.createIndex("totalAmount","totalAmount",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("syncedAt","syncedAt",{unique:!1}),e.createIndex("_id","_id",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(t.objectStoreNames.contains(d.plans)){const e=n.objectStore(d.plans);r<10&&(e.indexNames.contains("name")||e.createIndex("name","name",{unique:!1}),e.indexNames.contains("price")||e.createIndex("price","price",{unique:!1}),e.indexNames.contains("durationDays")||e.createIndex("durationDays","durationDays",{unique:!1}),e.indexNames.contains("isActive")||e.createIndex("isActive","isActive",{unique:!1}))}else{const e=t.createObjectStore(d.plans,{keyPath:"id",autoIncrement:!1});e.createIndex("name","name",{unique:!1}),e.createIndex("price","price",{unique:!1}),e.createIndex("durationDays","durationDays",{unique:!1}),e.createIndex("isActive","isActive",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}if(t.objectStoreNames.contains(d.planOrders)){const e=n.objectStore(d.planOrders);r<10&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1}),e.indexNames.contains("planId")||e.createIndex("planId","planId",{unique:!1}),e.indexNames.contains("expiryDate")||e.createIndex("expiryDate","expiryDate",{unique:!1}),e.indexNames.contains("paymentStatus")||e.createIndex("paymentStatus","paymentStatus",{unique:!1}),e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1}))}else{const e=t.createObjectStore(d.planOrders,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("planId","planId",{unique:!1}),e.createIndex("expiryDate","expiryDate",{unique:!1}),e.createIndex("paymentStatus","paymentStatus",{unique:!1}),e.createIndex("razorpayOrderId","razorpayOrderId",{unique:!1}),e.createIndex("razorpayPaymentId","razorpayPaymentId",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1})}if(t.objectStoreNames.contains(d.planDetails)){const e=n.objectStore(d.planDetails);e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1}),e.indexNames.contains("updatedAt")||e.createIndex("updatedAt","updatedAt",{unique:!1})}else{const e=t.createObjectStore(d.planDetails,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}if(t.objectStoreNames.contains(d.refunds)){const e=n.objectStore(d.refunds);r<18&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1}),e.indexNames.contains("orderId")||e.createIndex("orderId","orderId",{unique:!1}),e.indexNames.contains("customerId")||e.createIndex("customerId","customerId",{unique:!1}),e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1}),e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1}))}else{const e=t.createObjectStore(d.refunds,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("orderId","orderId",{unique:!1}),e.createIndex("customerId","customerId",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(t.objectStoreNames.contains(d.categories)){const e=n.objectStore(d.categories);if(r<9&&(e.indexNames.contains("sellerId")||e.createIndex("sellerId","sellerId",{unique:!1}),e.indexNames.contains("image")&&e.deleteIndex("image"),e.indexNames.contains("description")||e.createIndex("description","description",{unique:!1}),e.indexNames.contains("name")))try{e.deleteIndex("name"),e.createIndex("name","name",{unique:!1})}catch(s){}r<6&&(e.indexNames.contains("isActive")||e.createIndex("isActive","isActive",{unique:!1}),e.indexNames.contains("isSynced")||e.createIndex("isSynced","isSynced",{unique:!1})),e.indexNames.contains("isDeleted")||e.createIndex("isDeleted","isDeleted",{unique:!1})}else{const e=t.createObjectStore(d.categories,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("name","name",{unique:!1}),e.createIndex("isActive","isActive",{unique:!1}),e.createIndex("description","description",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("isSynced","isSynced",{unique:!1}),e.createIndex("isDeleted","isDeleted",{unique:!1})}if(!t.objectStoreNames.contains(d.staff)){const e=t.createObjectStore(d.staff,{keyPath:"id",autoIncrement:!1});e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("email","email",{unique:!1}),e.createIndex("isActive","isActive",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}if(!t.objectStoreNames.contains(d.staffPermissions)){const e=t.createObjectStore(d.staffPermissions,{keyPath:"id",autoIncrement:!1});e.createIndex("staffId","staffId",{unique:!0}),e.createIndex("sellerId","sellerId",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}},console.log("\u2705 IndexedDB upgrade completed successfully"),n.onerror=()=>{console.error("\u274c IndexedDB upgrade failed:",n.error),t(n.error)}}),m=e=>{const t=[];if(e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Customer name is required"),void 0!==e.dueAmount&&null!==e.dueAmount){const n="number"===typeof e.dueAmount?e.dueAmount:parseFloat(e.dueAmount);Number.isFinite(n)||t.push("Due amount must be a valid number")}return{valid:0===t.length,errors:t}},f=e=>{const t=[];e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Product name is required");const n=void 0!==e.stock?e.stock:e.quantity;void 0!==n&&null!==n&&("number"!==typeof n||n<0)&&t.push("Product stock/quantity must be a non-negative number"),e.unit&&"string"!==typeof e.unit&&t.push("Product unit must be a string");const r=void 0!==e.costPrice?e.costPrice:e.unitPrice;return void 0!==r&&null!==r&&("number"!==typeof r||r<0)&&t.push("Cost price/unit price must be a non-negative number"),void 0!==e.sellingUnitPrice&&null!==e.sellingUnitPrice&&("number"!==typeof e.sellingUnitPrice||e.sellingUnitPrice<0)&&t.push("Selling unit price must be a non-negative number"),void 0!==e.sellingPrice&&null!==e.sellingPrice&&("number"!==typeof e.sellingPrice||e.sellingPrice<0)&&t.push("Selling price must be a non-negative number"),void 0!==e.lowStockLevel&&null!==e.lowStockLevel&&("number"!==typeof e.lowStockLevel||e.lowStockLevel<0)&&t.push("Low stock level must be a non-negative number"),!e.expiryDate||e.expiryDate instanceof Date||"string"===typeof e.expiryDate||t.push("Expiry date must be a valid date"),void 0!==e.description&&null!==e.description&&"string"!==typeof e.description&&t.push("Description must be a string"),void 0!==e.isActive&&"boolean"!==typeof e.isActive&&t.push("isActive must be a boolean"),{valid:0===t.length,errors:t}},p=e=>{const t=[];e.sellerId||t.push("Seller ID is required");const n=["cash","card","upi","due","credit","split"];if(e.paymentMethod&&n.includes(e.paymentMethod)||t.push("Payment method must be one of: ".concat(n.join(", "))),"split"===e.paymentMethod)if(e.splitPaymentDetails){const n=e.splitPaymentDetails,r=["cash_online","online_due","cash_due"];null===n.type||void 0===n.type||r.includes(n.type)||t.push("Split payment type must be one of: ".concat(r.join(", "),", or null"));const s="number"===typeof n.cashAmount?n.cashAmount:0,i="number"===typeof n.onlineAmount?n.onlineAmount:0,a="number"===typeof n.dueAmount?n.dueAmount:0;if((s<0||i<0||a<0)&&t.push("Split payment amounts cannot be negative"),null!==n.type&&void 0!==n.type&&("cash_online"!==n.type||0!==s&&0!==i||t.push("Cash + Online split requires both cash and online amounts > 0"),"online_due"!==n.type||0!==i&&0!==a||t.push("Online + Due split requires both online and due amounts > 0"),"cash_due"!==n.type||0!==s&&0!==a||t.push("Cash + Due split requires both cash and due amounts > 0")),void 0!==e.totalAmount&&null!==e.totalAmount){const n=s+i+a;Math.abs(n-e.totalAmount)>.01&&t.push("Split payment total (".concat(n.toFixed(2),") must equal order total (").concat(e.totalAmount.toFixed(2),")"))}}else t.push("Split payment requires splitPaymentDetails");return Array.isArray(e.items)&&0!==e.items.length?e.items.forEach((e,n)=>{e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Item ".concat(n+1,": Name is required")),(void 0===e.sellingPrice||null===e.sellingPrice||"number"!==typeof e.sellingPrice||e.sellingPrice<0)&&t.push("Item ".concat(n+1,": Selling price must be a non-negative number")),(void 0===e.costPrice||null===e.costPrice||"number"!==typeof e.costPrice||e.costPrice<0)&&t.push("Item ".concat(n+1,": Cost price must be a non-negative number")),(void 0===e.quantity||null===e.quantity||"number"!==typeof e.quantity||e.quantity<=0)&&t.push("Item ".concat(n+1,": Quantity must be greater than 0")),e.unit&&"string"===typeof e.unit||t.push("Item ".concat(n+1,": Unit is required"))}):t.push("Order must have at least one item"),(void 0===e.totalAmount||null===e.totalAmount||"number"!==typeof e.totalAmount||e.totalAmount<0)&&t.push("Total amount must be a non-negative number"),{valid:0===t.length,errors:t}},g=e=>{const t=[];if(!e||"object"!==typeof e)return{valid:!1,errors:["Transaction must be an object"]};e.type&&"string"===typeof e.type&&""!==e.type.trim()||t.push("Transaction type is required");null===("number"!==typeof e.amount||Number.isNaN(e.amount)?"number"!==typeof e.total||Number.isNaN(e.total)?null:e.total:e.amount)&&t.push("Transaction amount or total must be a valid number");const n=["cash","card","upi","bank","credit","razorpay"];if(e.paymentMethod&&!n.includes(e.paymentMethod)&&t.push("Payment method must be one of: ".concat(n.join(", "))),e.date){const n=e.date instanceof Date,r="string"===typeof e.date&&!Number.isNaN(Date.parse(e.date));n||r||t.push("Transaction date must be a valid date")}return{valid:0===t.length,errors:t}},x=e=>{const t=[];e.supplierName&&"string"===typeof e.supplierName&&""!==e.supplierName.trim()||t.push("Supplier name is required"),Array.isArray(e.items)&&0!==e.items.length?e.items.forEach((e,n)=>{e.productName&&"string"===typeof e.productName&&""!==e.productName.trim()||t.push("Item ".concat(n+1,": Product name is required")),(void 0===e.quantity||null===e.quantity||"number"!==typeof e.quantity||e.quantity<1)&&t.push("Item ".concat(n+1,": Quantity must be at least 1")),(void 0===e.price||null===e.price||"number"!==typeof e.price||e.price<0)&&t.push("Item ".concat(n+1,": Price must be a non-negative number"));const r=["pcs","kg","g","mg","l","ml","box","packet","bottle","dozen"];e.unit&&r.includes(e.unit)||t.push("Item ".concat(n+1,": Unit must be one of: ").concat(r.join(", "))),void 0!==e.subtotal&&null!==e.subtotal&&("number"!==typeof e.subtotal||e.subtotal<0)&&t.push("Item ".concat(n+1,": Subtotal must be a non-negative number"))}):t.push("Purchase order must have at least one item"),void 0!==e.total&&null!==e.total&&("number"!==typeof e.total||e.total<0)&&t.push("Total must be a non-negative number");const n=["pending","completed","cancelled"];return e.status&&!n.includes(e.status)&&t.push("Status must be one of: ".concat(n.join(", "))),!e.expectedDeliveryDate||e.expectedDeliveryDate instanceof Date||"string"===typeof e.expectedDeliveryDate||t.push("Expected delivery date must be a valid date"),!e.actualDeliveryDate||e.actualDeliveryDate instanceof Date||"string"===typeof e.actualDeliveryDate||t.push("Actual delivery date must be a valid date"),!e.cancelledAt||e.cancelledAt instanceof Date||"string"===typeof e.cancelledAt||t.push("Cancelled date must be a valid date"),{valid:0===t.length,errors:t}},y=e=>{const t=[];return e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Category name is required"),void 0!==e.isActive&&"boolean"!==typeof e.isActive&&t.push("isActive must be a boolean"),void 0!==e.description&&null!==e.description&&"string"!==typeof e.description&&t.push("Description must be a string"),{valid:0===t.length,errors:t}},b=e=>{const t=[];return e.sellerId||t.push("Seller ID is required"),e.orderId||t.push("Order ID is required"),e.items&&Array.isArray(e.items)&&0!==e.items.length?e.items.forEach((e,n)=>{e.productId||t.push("Item ".concat(n+1,": Product ID is required")),e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Item ".concat(n+1,": Product name is required")),(void 0===e.qty||null===e.qty||"number"!==typeof e.qty||e.qty<=0)&&t.push("Item ".concat(n+1,": Quantity must be a positive number")),(void 0===e.rate||null===e.rate||"number"!==typeof e.rate||e.rate<0)&&t.push("Item ".concat(n+1,": Rate must be a non-negative number")),(void 0===e.lineTotal||null===e.lineTotal||"number"!==typeof e.lineTotal||e.lineTotal<0)&&t.push("Item ".concat(n+1,": Line total must be a non-negative number"))}):t.push("Refund items array is required and must not be empty"),(void 0===e.totalRefundAmount||null===e.totalRefundAmount||"number"!==typeof e.totalRefundAmount||e.totalRefundAmount<0)&&t.push("Total refund amount must be a non-negative number"),{valid:0===t.length,errors:t}},w=e=>{const t=[];return e.name&&"string"===typeof e.name&&""!==e.name.trim()||t.push("Plan name is required"),(void 0===e.price||null===e.price||"number"!==typeof e.price||e.price<0)&&t.push("Plan price must be a non-negative number"),(void 0===e.durationDays||null===e.durationDays||"number"!==typeof e.durationDays||e.durationDays<1)&&t.push("Duration days must be at least 1"),void 0!==e.isActive&&"boolean"!==typeof e.isActive&&t.push("isActive must be a boolean"),{valid:0===t.length,errors:t}},v=e=>{const t=[];return e&&"object"===typeof e?(e.id&&"string"===typeof e.id||t.push("Plan detail id is required"),e.sellerId&&"string"===typeof e.sellerId||t.push("Plan detail sellerId is required"),void 0===e.data&&t.push("Plan detail data is required"),{valid:0===t.length,errors:t}):(t.push("Plan detail must be an object"),{valid:!1,errors:t})},N=e=>{const t=[];e.planId&&"string"===typeof e.planId||t.push("Plan ID is required"),(void 0===e.price||null===e.price||"number"!==typeof e.price||e.price<0)&&t.push("Plan order price must be a non-negative number"),(void 0===e.durationDays||null===e.durationDays||"number"!==typeof e.durationDays||e.durationDays<1)&&t.push("Duration days must be at least 1"),!e.expiryDate||e.expiryDate instanceof Date||"string"===typeof e.expiryDate||t.push("Expiry date must be a valid date");const n=["pending","completed","failed"];return e.paymentStatus&&!n.includes(e.paymentStatus)&&t.push("Payment status must be one of: ".concat(n.join(", "))),{valid:0===t.length,errors:t}},S=e=>({[d.customers]:m,[d.products]:f,[d.orders]:p,[d.transactions]:g,[d.purchaseOrders]:x,[d.categories]:y,[d.refunds]:b,[d.plans]:w,[d.planOrders]:N,[d.planDetails]:v}[e]||null),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(e)&&0!==e.length?t?JSON.stringify(e.map(e=>({productName:e.productName||e.name,quantity:e.quantity,price:e.price})).sort((e,t)=>(e.productName||e.name||"").localeCompare(t.productName||t.name||""))):JSON.stringify(e.map(e=>({name:e.name,quantity:e.quantity,sellingPrice:e.sellingPrice,costPrice:e.costPrice})).sort((e,t)=>(e.name||"").localeCompare(t.name||""))):""},_=(e,t)=>{if(!e||!t)return!1;const n=new Date(e),r=new Date(t);return Math.abs(n.getTime()-r.getTime())<=5e3},C=async function(e,t){let n,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{const n=await I(e);if(e===d.products){const e=(t.name||"").trim().toLowerCase(),r=(t.description||"").trim().toLowerCase(),s=n.find(t=>{const n=(t.name||"").trim().toLowerCase(),s=(t.description||"").trim().toLowerCase();return n===e&&(s===r||""===s&&""===r||null===s&&null===r||void 0===s&&void 0===r)});if(s)return console.warn("\u26a0\ufe0f Duplicate product detected in IndexedDB (skipping add):",{name:t.name,description:t.description||"No description",existingId:s.id,newId:t.id}),Promise.resolve(s.id||s._id)}else if(e===d.customers){const e=(t.name||"").trim().toLowerCase(),r=(t.mobileNumber||t.phone||"").trim(),s=(t.email||"").trim().toLowerCase(),i=n.find(t=>{const n=(t.name||"").trim().toLowerCase(),i=(t.mobileNumber||t.phone||"").trim(),a=(t.email||"").trim().toLowerCase();return r&&i?n===e&&i===r:s&&a?n===e&&a===s:n===e&&!i&&!a&&!r&&!s});if(i)return console.warn("\u26a0\ufe0f Duplicate customer detected in IndexedDB (skipping add):",{name:t.name,mobileNumber:r||"N/A",email:s||"N/A",existingId:i.id,newId:t.id}),Promise.resolve(i.id||i._id)}else if(e===d.orders){const e=A(t.items,!1),r=t.createdAt||t.date,s=n.find(n=>{if(n.sellerId!==t.sellerId)return!1;if((n.customerId||null)!==(t.customerId||null))return!1;if(Math.abs((n.totalAmount||0)-(t.totalAmount||0))>.01)return!1;return A(n.items,!1)===e&&(r&&n.createdAt?_(n.createdAt,r):n.id===t.id||n._id===t.id||n.id===t._id)});if(s)return console.warn("\u26a0\ufe0f Duplicate order detected in IndexedDB (skipping add):",{sellerId:t.sellerId,customerId:t.customerId||"Walk-in",totalAmount:t.totalAmount,createdAt:r,existingId:s.id,newId:t.id}),Promise.resolve(s.id||s._id)}else if(e===d.purchaseOrders){const e=A(t.items,!0),r=t.createdAt||t.date,s=n.find(n=>{if(n.sellerId!==t.sellerId)return!1;if((n.supplierName||"").trim().toLowerCase()!==(t.supplierName||"").trim().toLowerCase())return!1;if(Math.abs((n.total||0)-(t.total||0))>.01)return!1;return A(n.items,!0)===e&&(r&&n.createdAt?_(n.createdAt,r):n.id===t.id||n._id===t.id||n.id===t._id)});if(s)return console.warn("\u26a0\ufe0f Duplicate vendor order detected in IndexedDB (skipping add):",{sellerId:t.sellerId,supplierName:t.supplierName,total:t.total,createdAt:r,existingId:s.id,newId:t.id}),Promise.resolve(s.id||s._id)}}catch(i){console.error("Error checking for duplicate ".concat(e,":"),i)}if(!s){const n=S(e);if(n){const r=n(t);if(!r.valid)return console.error("Validation failed for ".concat(e,":"),r.errors),console.error("Item data:",JSON.stringify(t,null,2)),Promise.reject(new Error("Validation failed: ".concat(r.errors.join(", "))))}}return e===d.activities||e===d.syncMetadata?(n=(0,r.A)({},t),delete n.isSynced):n=(0,r.A)((0,r.A)({},t),{},{isSynced:void 0!==t.isSynced&&t.isSynced}),u(async t=>{if(!t.objectStoreNames.contains(e)){if(e===d.syncMetadata)return console.log("\u26a0\ufe0f syncMetadata store not yet created (database upgrade pending). Using localStorage fallback."),Promise.reject(new Error("Store not available - using localStorage fallback"));console.warn('\u26a0\ufe0f Store "'.concat(e,'" does not exist. Attempting to trigger database upgrade...')),console.log("Current database version:",t.version),console.log("Expected database version:",21),console.log("Available stores:",Array.from(t.objectStoreNames));try{if(t.close(),await new Promise(e=>setTimeout(e,200)),!(t=await h()).objectStoreNames.contains(e)){const n=new Error('Object store "'.concat(e,'" does not exist. Please refresh the page to upgrade the database to version ').concat(21,"."));return console.error("IndexedDB error:",n),console.error("Available stores:",Array.from(t.objectStoreNames)),console.error("Database version after reopen:",t.version),window.showToast&&e!==d.syncMetadata&&window.showToast("Database needs to be upgraded. Please refresh the page.","error"),Promise.reject(n)}console.log('\u2705 Store "'.concat(e,'" created after database upgrade'))}catch(r){console.error("Error closing/reopening database:",r);const t=new Error('Object store "'.concat(e,'" does not exist. Please refresh the page to upgrade the database.'));return window.showToast&&e!==d.syncMetadata&&window.showToast("Please refresh the page to upgrade the database.","error"),Promise.reject(t)}}return new Promise((r,s)=>{if(!t.objectStoreNames.contains(e)){const n=new Error('Object store "'.concat(e,'" does not exist. Please refresh the page.'));return console.error("IndexedDB error:",n),console.error("Available stores:",Array.from(t.objectStoreNames)),s(n)}const i=t.transaction([e],"readwrite"),a=i.objectStore(e).add(n);a.onsuccess=()=>{console.log("Successfully added item to ".concat(e,":"),n.id||n._id),r(a.result)},a.onerror=()=>{const o=a.error;if(o&&"ConstraintError"===o.name){console.warn("\u26a0\ufe0f Item with ID ".concat(n.id||n._id," already exists in ").concat(e,", treating as update")),i.abort();try{const i=t.transaction([e],"readwrite"),a=i.objectStore(e).put(n);a.onsuccess=()=>{console.log("Updated existing item in ".concat(e,":"),n.id||n._id),r(a.result)},a.onerror=()=>{console.error("Error updating item in ".concat(e,":"),a.error),s(a.error)}}catch(l){console.error("Error creating update transaction for ".concat(e,":"),l),s(l)}}else console.error("Error adding to ".concat(e,":"),o),s(o)}})},null)},I=async e=>u(async t=>new Promise((n,r)=>{const s=t.transaction([e],"readonly").objectStore(e).getAll();s.onsuccess=()=>n(s.result),s.onerror=()=>r(s.error)}),[]),E=async(e,t)=>u(async n=>new Promise((r,s)=>{const i=n.transaction([e],"readonly").objectStore(e).get(t);i.onsuccess=()=>r(i.result||null),i.onerror=()=>s(i.error)}),null),T=async function(e,t){let n;if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){const n=S(e);if(n){const r=n(t);if(!r.valid)return console.error("Validation failed for ".concat(e,":"),r.errors),console.error("Item data:",JSON.stringify(t,null,2)),Promise.reject(new Error("Validation failed: ".concat(r.errors.join(", "))))}}e===d.activities||e===d.syncMetadata?(n=(0,r.A)({},t),delete n.isSynced):n=(0,r.A)((0,r.A)({},t),{},{isSynced:void 0!==t.isSynced&&t.isSynced});const s=await h();return new Promise((t,r)=>{if(!s.objectStoreNames.contains(e)){const t=new Error('Object store "'.concat(e,'" does not exist. Database may need to be upgraded.'));return console.error("IndexedDB error:",t),console.error("Available stores:",Array.from(s.objectStoreNames)),r(t)}const i=s.transaction([e],"readwrite").objectStore(e).put(n);i.onsuccess=()=>{console.log("Successfully saved item to ".concat(e,":"),n.id||n._id),t(i.result)},i.onerror=()=>{console.error("Error saving to ".concat(e,":"),i.error),r(i.error)}})},j=async(e,t)=>{const n=await h();return new Promise((r,s)=>{const i=n.transaction([e],"readwrite").objectStore(e).delete(t);i.onsuccess=()=>r(),i.onerror=()=>s(i.error)})},k=async e=>{const t=await h();return new Promise((n,r)=>{const s=t.transaction([e],"readonly").objectStore(e).count();s.onsuccess=()=>n(s.result),s.onerror=()=>r(s.error)})},D=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(!await o())return void console.warn("\u26a0\ufe0f [addMultipleItems] IndexedDB unavailable - skipping add for ".concat(e," (").concat(t.length," items)"));if(!n){const n=S(e);if(n){const e=[];if(t.forEach((t,r)=>{const s=n(t);s.valid||e.push("Item ".concat(r+1,": ").concat(s.errors.join(", ")))}),e.length>0)return Promise.reject(new Error("Validation failed: ".concat(e.join("; "))))}}const r=await h();return new Promise((n,s)=>{const i=r.transaction([e],"readwrite"),a=i.objectStore(e),o=t.map(t=>new Promise((n,r)=>{e===d.orders&&"split"===t.paymentMethod&&console.log("[IndexedDB] Storing split payment order ".concat(t.id,":"),{hasSplitPaymentDetails:"splitPaymentDetails"in t,splitPaymentDetails:t.splitPaymentDetails,itemKeys:Object.keys(t)});const s=a.add(t);s.onsuccess=()=>n(),s.onerror=()=>{console.error("[IndexedDB] Error storing item ".concat(t.id," in ").concat(e,":"),s.error),r(s.error)}}));i.oncomplete=()=>n(),i.onerror=()=>s(i.error),Promise.all(o).catch(s)})}catch(r){return void console.warn("\u26a0\ufe0f [addMultipleItems] IndexedDB error for ".concat(e," - skipping add (").concat(t.length," items):"),r.message)}},P=async function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){const n=S(e);if(n){const e=[];if(t.forEach((t,r)=>{const s=n(t);s.valid||e.push("Item ".concat(r+1,": ").concat(s.errors.join(", ")))}),e.length>0)return Promise.reject(new Error("Validation failed: ".concat(e.join("; "))))}}const n=await h();return new Promise((r,s)=>{const i=n.transaction([e],"readwrite"),a=i.objectStore(e),o=t.map(e=>new Promise((t,n)=>{const r=a.put(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}));i.oncomplete=()=>r(),i.onerror=()=>s(i.error),Promise.all(o).catch(s)})},R=async(e,t)=>{const n=await h();return new Promise((r,s)=>{const i=n.transaction([e],"readwrite"),a=i.objectStore(e),o=t.map(e=>new Promise((t,n)=>{const r=a.delete(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}));i.oncomplete=()=>r(),i.onerror=()=>s(i.error),Promise.all(o).catch(s)})},O=async e=>{try{if(!await o())return void console.warn("\u26a0\ufe0f [clearAllItems] IndexedDB unavailable - skipping clear for ".concat(e));const t=await h();return new Promise((n,r)=>{const s=t.transaction([e],"readwrite").objectStore(e).clear();s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})}catch(t){return void console.warn("\u26a0\ufe0f [clearAllItems] IndexedDB error for ".concat(e," - skipping clear:"),t.message)}},L=async(e,t,n)=>{const r=await h();return new Promise((s,i)=>{const a=r.transaction([e],"readonly").objectStore(e).index(t).getAll(n);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)})},M=async(e,t,n)=>{const r=await h();return new Promise((s,i)=>{const a=r.transaction([e],"readonly").objectStore(e).index(t).getAll(n);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)})},F=async e=>{const t=await h();return new Promise((n,r)=>{const s=t.transaction([d.customers],"readonly").objectStore(d.customers).getAll();s.onsuccess=()=>{const t=s.result,r=e.toLowerCase(),i=t.filter(e=>{var t,n;const s=e.mobileNumber||e.phone||"";return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(r))||s.includes(r)||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(r))});n(i)},s.onerror=()=>r(s.error)})},B=async e=>{const t=await h();return new Promise((n,r)=>{const s=t.transaction([d.products],"readonly").objectStore(d.products).getAll();s.onsuccess=()=>{const t=s.result,r=e.toLowerCase(),i=t.filter(e=>{var t,n,s;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(n=e.category)||void 0===n?void 0:n.toLowerCase().includes(r))||(null===(s=e.barcode)||void 0===s?void 0:s.includes(r))});n(i)},s.onerror=()=>r(s.error)})},U=async e=>L(d.products,"category",e),z=async e=>{const t=await h();return new Promise((n,r)=>{const s=t.transaction([d.products],"readonly").objectStore(d.products).index("quantity"),i=IDBKeyRange.upperBound(e),a=s.getAll(i);a.onsuccess=()=>n(a.result),a.onerror=()=>r(a.error)})},q=async e=>{const t=await h();return new Promise((n,r)=>{const s=t.transaction([d.products],"readonly").objectStore(d.products).index("expiryDate"),i=IDBKeyRange.upperBound(e.toISOString()),a=s.getAll(i);a.onsuccess=()=>{const t=a.result.filter(t=>{if(!t.expiryDate)return!1;const n=new Date(t.expiryDate);return n>=new Date&&n<=e});n(t)},a.onerror=()=>r(a.error)})},H=async e=>L(d.transactions,"customerId",e),V=async(e,t)=>{const n=await h();return new Promise((r,s)=>{const i=n.transaction([d.transactions],"readonly").objectStore(d.transactions).index("createdAt"),a=IDBKeyRange.bound(e.toISOString(),t.toISOString()),o=i.getAll(a);o.onsuccess=()=>{const n=o.result.filter(n=>{const r=new Date(n.createdAt);return r>=e&&r<=t});r(n)},o.onerror=()=>s(o.error)})},W=async e=>L(d.purchaseOrders,"status",e),G=async e=>L(d.activities,"type",e),Y=async(e,t)=>{const n=await h();return new Promise((r,s)=>{const i=n.transaction([d.activities],"readonly").objectStore(d.activities).index("timestamp"),a=IDBKeyRange.bound(e.toISOString(),t.toISOString()),o=i.getAll(a);o.onsuccess=()=>{const n=o.result.filter(n=>{const r=new Date(n.timestamp||n.createdAt);return r>=e&&r<=t});r(n)},o.onerror=()=>s(o.error)})},X=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=await h();return new Promise((a,o)=>{const l=i.transaction([e],"readonly").objectStore(e),c=l.count();c.onsuccess=()=>{const e=c.result,i=Math.ceil(e/n),d=r?l.index(r).getAll():l.getAll();d.onsuccess=()=>{let o=d.result;r&&o.length>0&&o.sort((e,t)=>{const n=e[r],i=t[r];return s?n>i?-1:n<i?1:0:n<i?-1:n>i?1:0});const l=(t-1)*n,c=l+n,u=o.slice(l,c);a({items:u,total:e,page:t,pageSize:n,totalPages:i})},d.onerror=()=>o(d.error)},c.onerror=()=>o(c.error)})},Q=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e&&t?await V(e,t):await I(d.transactions)).reduce((e,t)=>e+(t.total||0),0)},K=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=await I(d.purchaseOrders);let r=n;return e&&t&&(r=n.filter(n=>{const r=new Date(n.createdAt);return r>=e&&r<=t})),r.reduce((e,t)=>e+(t.total||0),0)},Z=async()=>(await I(d.products)).reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),J=async()=>{const e=await I(d.customers),t=await I(d.transactions),n=new Set(t.map(e=>e.customerId).filter(Boolean)),r=t.reduce((e,t)=>e+(t.total||0),0);return{total:e.length,withTransactions:n.size,totalSpent:r}},$=async()=>{try{const[e,t,n,r,s,i,a,o,l,c]=await Promise.all([I(d.customers),I(d.products),I(d.orders),I(d.transactions),I(d.purchaseOrders),I(d.categories),I(d.refunds),I(d.plans),I(d.planOrders),I(d.activities)]);return{version:21,exportedAt:(new Date).toISOString(),customers:e,products:t,orders:n,transactions:r,purchaseOrders:s,categories:i,refunds:a,plans:o,planOrders:l,activities:c}}catch(e){throw console.error("Error exporting data:",e),e}},ee=async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{t&&await Promise.all([O(d.customers),O(d.products),O(d.orders),O(d.transactions),O(d.purchaseOrders),O(d.categories),O(d.refunds),O(d.plans),O(d.planOrders),O(d.activities)]);const n={customers:0,products:0,orders:0,transactions:0,purchaseOrders:0,categories:0,plans:0,planOrders:0,activities:0};return e.customers&&e.customers.length>0&&(await D(d.customers,e.customers),n.customers=e.customers.length),e.products&&e.products.length>0&&(await D(d.products,e.products),n.products=e.products.length),e.orders&&e.orders.length>0&&(await D(d.orders,e.orders),n.orders=e.orders.length),e.transactions&&e.transactions.length>0&&(await D(d.transactions,e.transactions),n.transactions=e.transactions.length),e.purchaseOrders&&e.purchaseOrders.length>0&&(await D(d.purchaseOrders,e.purchaseOrders),n.purchaseOrders=e.purchaseOrders.length),e.categories&&e.categories.length>0&&(await D(d.categories,e.categories),n.categories=e.categories.length),e.refunds&&Array.isArray(e.refunds)&&e.refunds.length>0&&(await D(d.refunds,e.refunds),n.refunds=e.refunds.length),e.plans&&e.plans.length>0&&(await D(d.plans,e.plans),n.plans=e.plans.length),e.planOrders&&e.planOrders.length>0&&(await D(d.planOrders,e.planOrders),n.planOrders=e.planOrders.length),e.activities&&e.activities.length>0&&(await D(d.activities,e.activities),n.activities=e.activities.length),{success:!0,message:"Data imported successfully",imported:n}}catch(n){return console.error("Error importing data:",n),{success:!1,message:n.message,imported:{}}}},te=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://your-backend-api.com/sync",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!navigator.onLine&&!t.force)return console.warn("Device is offline. Cannot sync data."),{success:!1,message:"Device is offline"};try{const n=await $();n.syncedAt=(new Date).toISOString(),n.userId=t.userId||null;const s=await fetch(e,{method:"POST",headers:(0,r.A)({"Content-Type":"application/json"},t.headers),body:JSON.stringify(n)});if(!s.ok)throw new Error("Backend sync failed: ".concat(s.statusText));const i=await s.json();return console.log("Data synced successfully:",i),{success:!0,message:"Data synced successfully",data:i}}catch(n){return console.error("Error syncing data:",n),{success:!1,message:n.message}}},ne=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://your-backend-api.com/sync",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!navigator.onLine&&!t.force)return console.warn("Device is offline. Cannot sync data."),{success:!1,message:"Device is offline"};try{const n=new URL(e);t.userId&&n.searchParams.append("userId",t.userId);const s=await fetch(n.toString(),{method:"GET",headers:(0,r.A)({"Content-Type":"application/json"},t.headers)});if(!s.ok)throw new Error("Backend fetch failed: ".concat(s.statusText));const i=await s.json(),a=await ee(i,!1!==t.clearExisting);return{success:a.success,message:a.message,data:a.imported}}catch(n){return console.error("Error syncing data from backend:",n),{success:!1,message:n.message}}},re=async()=>new Promise((e,t)=>{const n=indexedDB.deleteDatabase(c);n.onsuccess=()=>e(),n.onerror=()=>t(n.error),n.onblocked=()=>{console.warn("Database deletion blocked. Close all tabs with this database open."),t(new Error("Database deletion blocked"))}}),se=async()=>{const e=await h(),t={};let n=0;for(const i of e.objectStoreNames){const n=e.transaction([i],"readonly").objectStore(i).count();await new Promise((e,r)=>{n.onsuccess=()=>{t[i]={count:n.result,name:i},e()},n.onerror=()=>r(n.error)})}const r=await $(),s=JSON.stringify(r);return n=new Blob([s]).size,{stores:t,totalSize:n,totalSizeMB:(n/1048576).toFixed(2)}},ie=async(e,t,n)=>{const r={id:"staff_".concat(e),staffId:e,sellerId:n,permissions:t,updatedAt:(new Date).toISOString()};return T(d.staffPermissions,r,!0)},ae=async e=>{try{const t=await E(d.staffPermissions,"staff_".concat(e));return t?t.permissions:null}catch(t){return console.error("Error getting staff permissions from IndexedDB:",t),null}},oe=async(e,t,n)=>{try{const s=await ae(e)||{},i=(0,r.A)((0,r.A)({},s),t);return ie(e,i,n)}catch(s){throw console.error("Error updating staff permissions in IndexedDB:",s),s}},le=async e=>{if(!e||!e._id)throw new Error("Staff member must have an _id");const t=(0,r.A)((0,r.A)({},e),{},{id:e._id,updatedAt:(new Date).toISOString(),isSynced:!1!==e.isSynced});return T(d.staff,t)},ce=async e=>{if(!Array.isArray(e))throw new Error("staffMembers must be an array");const t=e.map(e=>le(e));return Promise.all(t)},de=async e=>{try{return await E(d.staff,e)}catch(t){return console.error("Error getting staff member from IndexedDB:",t),null}},ue=async e=>{try{return await L(d.staff,"sellerId",e)}catch(t){return console.error("Error getting staff members from IndexedDB:",t),[]}},he=async(e,t)=>{try{const n=await de(e);if(!n)throw new Error("Staff member ".concat(e," not found"));const s=(0,r.A)((0,r.A)((0,r.A)({},n),t),{},{id:e,updatedAt:(new Date).toISOString(),isSynced:!1});return T(d.staff,s)}catch(n){throw console.error("Error updating staff member in IndexedDB:",n),n}},me=async e=>{try{return await j(d.staff,e),!0}catch(t){return console.error("Error deleting staff member from IndexedDB:",t),!1}}},1776:(e,t,n)=>{"use strict";n.d(t,{cY:()=>m,FA:()=>T,g:()=>E,dM:()=>I,u:()=>o,Uj:()=>a,p9:()=>V,tD:()=>M,bD:()=>D,hp:()=>L,T9:()=>u,Tj:()=>d,XA:()=>h,Ku:()=>W,ZQ:()=>b,sr:()=>N,zJ:()=>f,c1:()=>v,Im:()=>k,lT:()=>A,zW:()=>_,jZ:()=>w,lV:()=>S,gE:()=>p,Am:()=>R,I9:()=>O,P1:()=>y,eX:()=>C});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<e.length;s+=3){const t=e[s],i=s+1<e.length,a=i?e[s+1]:0,o=s+2<e.length,l=o?e[s+2]:0,c=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(u=64)),r.push(n[c],n[d],n[u],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],a=s<e.length?n[e.charAt(s)]:0;++s;const o=s<e.length?n[e.charAt(s)]:64;++s;const l=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==a||null==o||null==l)throw new i;const c=t<<2|a>>4;if(r.push(c),64!==o){const e=a<<4&240|o>>2;if(r.push(e),64!==l){const e=o<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=r(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const l=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return l()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"public",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://localhost:5000"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},d=e=>{var t;return null===(t=c())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]},u=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},h=e=>{var t;return null===(t=c())||void 0===t?void 0:t["_".concat(e)]};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function f(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function p(e){return(await fetch(e,{credentials:"include"})).ok}const g={};let x=!1;function y(e,t){if("undefined"===typeof window||"undefined"===typeof document||!f(window.location.host)||g[e]===t||g[e]||x)return;function n(e){return"__firebase__banner__".concat(e)}g[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(g))g[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{x=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const n=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,a,l,n),document.body.appendChild(t)}s?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function b(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function w(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())}function v(){return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function N(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function S(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function A(){const e=b();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){try{return"object"===typeof indexedDB}catch(e){return!1}}function C(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function I(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}class E extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],s=r?function(e,t){return e.replace(j,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",i="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new E(n,i,t)}}const j=/\{\$([^}]+)}/g;function k(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(P(n)&&P(i)){if(!D(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function P(e){return null!==e&&"object"===typeof e}function R(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function O(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function L(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function M(e,t){const n=new F(e,t);return n.subscribe.bind(n)}class F{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=B),void 0===r.error&&(r.error=B),void 0===r.complete&&(r.complete=B);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function B(){}const U=1e3,z=2,q=144e5,H=.5;function V(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z;const n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:U)*Math.pow(t,e),r=Math.round(H*n*(Math.random()-.5)*2);return Math.min(q,n+r)}function W(e){return e&&e._delegate?e._delegate:e}},1805:(e,t,n)=>{const r=n(6272),s=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case r.L:return s[4*(e-1)+0];case r.M:return s[4*(e-1)+1];case r.Q:return s[4*(e-1)+2];case r.H:return s[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case r.L:return i[4*(e-1)+0];case r.M:return i[4*(e-1)+1];case r.Q:return i[4*(e-1)+2];case r.H:return i[4*(e-1)+3];default:return}}},2072:function(e,t,n){!function(e){"use strict";function t(e){return null===e||void 0===e}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function s(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n=Object.setPrototypeOf;n?n(e,t):e.__proto__=t}function a(e,t){void 0===t&&(t=e.constructor);var n=Error.captureStackTrace;n&&n(e,t)}var o,l=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.defineProperty(r,"name",{value:n.name,enumerable:!1}),i(r,n.prototype),a(r),r}return s(t,e),t}(Error);class c extends l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;super(e),this.message=e}getKind(){return this.constructor.kind}}c.kind="Exception";class d extends c{}d.kind="ArgumentException";class u extends c{}u.kind="IllegalArgumentException";class h{constructor(e){if(this.binarizer=e,null===e)throw new u("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,n,r){const s=this.binarizer.getLuminanceSource().crop(e,t,n,r);return new h(this.binarizer.createBinarizer(s))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new h(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new h(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch(e){return""}}}class m extends c{static getChecksumInstance(){return new m}}m.kind="ChecksumException";class f{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class p{static arraycopy(e,t,n,r,s){for(;s--;)n[r++]=e[t++]}static currentTimeMillis(){return Date.now()}}class g extends c{}g.kind="IndexOutOfBoundsException";class x extends g{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;super(t),this.index=e,this.message=t}}x.kind="ArrayIndexOutOfBoundsException";class y{static fill(e,t){for(let n=0,r=e.length;n<r;n++)e[n]=t}static fillWithin(e,t,n,r){y.rangeCheck(e.length,t,n);for(let s=t;s<n;s++)e[s]=r}static rangeCheck(e,t,n){if(t>n)throw new u("fromIndex("+t+") > toIndex("+n+")");if(t<0)throw new x(t);if(n>e)throw new x(n)}static asList(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t}static create(e,t,n){return Array.from({length:e}).map(e=>Array.from({length:t}).fill(n))}static createInt32Array(e,t,n){return Array.from({length:e}).map(e=>Int32Array.from({length:t}).fill(n))}static equals(e,t){if(!e)return!1;if(!t)return!1;if(!e.length)return!1;if(!t.length)return!1;if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}static hashCode(e){if(null===e)return 0;let t=1;for(const n of e)t=31*t+n;return t}static fillUint8Array(e,t){for(let n=0;n!==e.length;n++)e[n]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const n=new Uint8Array(t);return n.set(e),n}return e.slice(0,t)}static copyOfRange(e,t,n){const r=n-t,s=new Int32Array(r);return p.arraycopy(e,t,s,0,r),s}static binarySearch(e,t,n){void 0===n&&(n=y.numberComparator);let r=0,s=e.length-1;for(;r<=s;){const i=s+r>>1,a=n(t,e[i]);if(a>0)r=i+1;else{if(!(a<0))return i;s=i-1}}return-r-1}static numberComparator(e,t){return e-t}}class b{static numberOfTrailingZeros(e){let t;if(0===e)return 32;let n=31;return t=e<<16,0!==t&&(n-=16,e=t),t=e<<8,0!==t&&(n-=8,e=t),t=e<<4,0!==t&&(n-=4,e=t),t=e<<2,0!==t&&(n-=2,e=t),n-(e<<1>>>31)}static numberOfLeadingZeros(e){if(0===e)return 32;let t=1;return e>>>16===0&&(t+=16,e<<=16),e>>>24===0&&(t+=8,e<<=8),e>>>28===0&&(t+=4,e<<=4),e>>>30===0&&(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,e+=e>>>8,63&(e+=e>>>16)}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e){return parseInt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0)}}b.MIN_VALUE_32_BITS=-2147483648,b.MAX_VALUE=Number.MAX_SAFE_INTEGER;class w{constructor(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=void 0===t||null===t?w.makeArray(e):t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>32*this.bits.length){const t=w.makeArray(e);p.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return 0!==(this.bits[Math.floor(e/32)]&1<<(31&e))}set(e){this.bits[Math.floor(e/32)]|=1<<(31&e)}flip(e){this.bits[Math.floor(e/32)]^=1<<(31&e)}getNextSet(e){const t=this.size;if(e>=t)return t;const n=this.bits;let r=Math.floor(e/32),s=n[r];s&=~((1<<(31&e))-1);const i=n.length;for(;0===s;){if(++r===i)return t;s=n[r]}const a=32*r+b.numberOfTrailingZeros(s);return a>t?t:a}getNextUnset(e){const t=this.size;if(e>=t)return t;const n=this.bits;let r=Math.floor(e/32),s=~n[r];s&=~((1<<(31&e))-1);const i=n.length;for(;0===s;){if(++r===i)return t;s=~n[r]}const a=32*r+b.numberOfTrailingZeros(s);return a>t?t:a}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new u;if(t===e)return;t--;const n=Math.floor(e/32),r=Math.floor(t/32),s=this.bits;for(let i=n;i<=r;i++){const a=(2<<(i<r?31:31&t))-(1<<(i>n?0:31&e));s[i]|=a}}clear(){const e=this.bits.length,t=this.bits;for(let n=0;n<e;n++)t[n]=0}isRange(e,t,n){if(t<e||e<0||t>this.size)throw new u;if(t===e)return!0;t--;const r=Math.floor(e/32),s=Math.floor(t/32),i=this.bits;for(let a=r;a<=s;a++){const o=(2<<(a<s?31:31&t))-(1<<(a>r?0:31&e))&4294967295;if((i[a]&o)!==(n?o:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(e,t){if(t<0||t>32)throw new u("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let n=t;n>0;n--)this.appendBit(1===(e>>n-1&1))}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let n=0;n<t;n++)this.appendBit(e.get(n))}xor(e){if(this.size!==e.size)throw new u("Sizes don't match");const t=this.bits;for(let n=0,r=t.length;n<r;n++)t[n]^=e.bits[n]}toBytes(e,t,n,r){for(let s=0;s<r;s++){let r=0;for(let t=0;t<8;t++)this.get(e)&&(r|=1<<7-t),e++;t[n+s]=r}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),n=t+1,r=this.bits;for(let s=0;s<n;s++){let n=r[s];n=n>>1&1431655765|(1431655765&n)<<1,n=n>>2&858993459|(858993459&n)<<2,n=n>>4&252645135|(252645135&n)<<4,n=n>>8&16711935|(16711935&n)<<8,n=n>>16&65535|(65535&n)<<16,e[t-s]=n}if(this.size!==32*n){const t=32*n-this.size;let r=e[0]>>>t;for(let s=1;s<n;s++){const n=e[s];r|=n<<32-t,e[s-1]=r,r=n>>>t}e[n-1]=r}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof w))return!1;const t=e;return this.size===t.size&&y.equals(this.bits,t.bits)}hashCode(){return 31*this.size+y.hashCode(this.bits)}toString(){let e="";for(let t=0,n=this.size;t<n;t++)0===(7&t)&&(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new w(this.size,this.bits.slice())}}!function(e){e[e.OTHER=0]="OTHER",e[e.PURE_BARCODE=1]="PURE_BARCODE",e[e.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",e[e.TRY_HARDER=3]="TRY_HARDER",e[e.CHARACTER_SET=4]="CHARACTER_SET",e[e.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",e[e.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",e[e.ASSUME_GS1=7]="ASSUME_GS1",e[e.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",e[e.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",e[e.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"}(o||(o={}));var v,N=o;class S extends c{static getFormatInstance(){return new S}}S.kind="FormatException",function(e){e[e.Cp437=0]="Cp437",e[e.ISO8859_1=1]="ISO8859_1",e[e.ISO8859_2=2]="ISO8859_2",e[e.ISO8859_3=3]="ISO8859_3",e[e.ISO8859_4=4]="ISO8859_4",e[e.ISO8859_5=5]="ISO8859_5",e[e.ISO8859_6=6]="ISO8859_6",e[e.ISO8859_7=7]="ISO8859_7",e[e.ISO8859_8=8]="ISO8859_8",e[e.ISO8859_9=9]="ISO8859_9",e[e.ISO8859_10=10]="ISO8859_10",e[e.ISO8859_11=11]="ISO8859_11",e[e.ISO8859_13=12]="ISO8859_13",e[e.ISO8859_14=13]="ISO8859_14",e[e.ISO8859_15=14]="ISO8859_15",e[e.ISO8859_16=15]="ISO8859_16",e[e.SJIS=16]="SJIS",e[e.Cp1250=17]="Cp1250",e[e.Cp1251=18]="Cp1251",e[e.Cp1252=19]="Cp1252",e[e.Cp1256=20]="Cp1256",e[e.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",e[e.UTF8=22]="UTF8",e[e.ASCII=23]="ASCII",e[e.Big5=24]="Big5",e[e.GB18030=25]="GB18030",e[e.EUC_KR=26]="EUC_KR"}(v||(v={}));class A{constructor(e,t,n){this.valueIdentifier=e,this.name=n,this.values="number"===typeof t?Int32Array.from([t]):t;for(var r=arguments.length,s=new Array(r>3?r-3:0),i=3;i<r;i++)s[i-3]=arguments[i];this.otherEncodingNames=s,A.VALUE_IDENTIFIER_TO_ECI.set(e,this),A.NAME_TO_ECI.set(n,this);const a=this.values;for(let o=0,l=a.length;o!==l;o++){const e=a[o];A.VALUES_TO_ECI.set(e,this)}for(const o of s)A.NAME_TO_ECI.set(o,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new S("incorect value");const t=A.VALUES_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}static getCharacterSetECIByName(e){const t=A.NAME_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}equals(e){if(!(e instanceof A))return!1;const t=e;return this.getName()===t.getName()}}A.VALUE_IDENTIFIER_TO_ECI=new Map,A.VALUES_TO_ECI=new Map,A.NAME_TO_ECI=new Map,A.Cp437=new A(v.Cp437,Int32Array.from([0,2]),"Cp437"),A.ISO8859_1=new A(v.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),A.ISO8859_2=new A(v.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),A.ISO8859_3=new A(v.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),A.ISO8859_4=new A(v.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),A.ISO8859_5=new A(v.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),A.ISO8859_6=new A(v.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),A.ISO8859_7=new A(v.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),A.ISO8859_8=new A(v.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),A.ISO8859_9=new A(v.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),A.ISO8859_10=new A(v.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),A.ISO8859_11=new A(v.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),A.ISO8859_13=new A(v.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),A.ISO8859_14=new A(v.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),A.ISO8859_15=new A(v.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),A.ISO8859_16=new A(v.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),A.SJIS=new A(v.SJIS,20,"SJIS","Shift_JIS"),A.Cp1250=new A(v.Cp1250,21,"Cp1250","windows-1250"),A.Cp1251=new A(v.Cp1251,22,"Cp1251","windows-1251"),A.Cp1252=new A(v.Cp1252,23,"Cp1252","windows-1252"),A.Cp1256=new A(v.Cp1256,24,"Cp1256","windows-1256"),A.UnicodeBigUnmarked=new A(v.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),A.UTF8=new A(v.UTF8,26,"UTF8","UTF-8"),A.ASCII=new A(v.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),A.Big5=new A(v.Big5,28,"Big5"),A.GB18030=new A(v.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),A.EUC_KR=new A(v.EUC_KR,30,"EUC_KR","EUC-KR");class _ extends c{}_.kind="UnsupportedOperationException";class C{static decode(e,t){const n=this.encodingName(t);return this.customDecoder?this.customDecoder(e,n):"undefined"===typeof TextDecoder||this.shouldDecodeOnFallback(n)?this.decodeFallback(e,n):new TextDecoder(n).decode(e)}static shouldDecodeOnFallback(e){return!C.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){const n=this.encodingName(t);return this.customEncoder?this.customEncoder(e,n):"undefined"===typeof TextEncoder?this.encodeFallback(e):(new TextEncoder).encode(e)}static isBrowser(){return"undefined"!==typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(e){return"string"===typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof A?e:A.getCharacterSetECIByName(e)}static decodeFallback(e,t){const n=this.encodingCharacterSet(t);if(C.isDecodeFallbackSupported(n)){let t="";for(let n=0,r=e.length;n<r;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+="%"+r}return decodeURIComponent(t)}if(n.equals(A.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new _("Encoding ".concat(this.encodingName(t)," not supported by fallback."))}static isDecodeFallbackSupported(e){return e.equals(A.UTF8)||e.equals(A.ISO8859_1)||e.equals(A.ASCII)}static encodeFallback(e){const t=btoa(unescape(encodeURIComponent(e))).split(""),n=[];for(let r=0;r<t.length;r++)n.push(t[r].charCodeAt(0));return new Uint8Array(n)}}class I{static castAsNonUtf8Char(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t?t.getName():this.ISO88591;return C.decode(new Uint8Array([e]),n)}static guessEncoding(e,t){if(null!==t&&void 0!==t&&void 0!==t.get(N.CHARACTER_SET))return t.get(N.CHARACTER_SET).toString();const n=e.length;let r=!0,s=!0,i=!0,a=0,o=0,l=0,c=0,d=0,u=0,h=0,m=0,f=0,p=0,g=0;const x=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let y=0;y<n&&(r||s||i);y++){const t=255&e[y];i&&(a>0?0===(128&t)?i=!1:a--:0!==(128&t)&&(0===(64&t)?i=!1:(a++,0===(32&t)?o++:(a++,0===(16&t)?l++:(a++,0===(8&t)?c++:i=!1))))),r&&(t>127&&t<160?r=!1:t>159&&(t<192||215===t||247===t)&&g++),s&&(d>0?t<64||127===t||t>252?s=!1:d--:128===t||160===t||t>239?s=!1:t>160&&t<224?(u++,m=0,h++,h>f&&(f=h)):t>127?(d++,h=0,m++,m>p&&(p=m)):(h=0,m=0))}return i&&a>0&&(i=!1),s&&d>0&&(s=!1),i&&(x||o+l+c>0)?I.UTF8:s&&(I.ASSUME_SHIFT_JIS||f>=3||p>=3)?I.SHIFT_JIS:r&&s?2===f&&2===u||10*g>=n?I.SHIFT_JIS:I.ISO88591:r?I.ISO88591:s?I.SHIFT_JIS:i?I.UTF8:I.PLATFORM_DEFAULT_ENCODING}static format(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let s=-1;function i(e,t,r,i,a,o){if("%%"===e)return"%";if(void 0===n[++s])return;e=i?parseInt(i.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=n[s];break;case"c":l=n[s][0];break;case"f":l=parseFloat(n[s]).toFixed(e);break;case"p":l=parseFloat(n[s]).toPrecision(e);break;case"e":l=parseFloat(n[s]).toExponential(e);break;case"x":l=parseInt(n[s]).toString(c||16);break;case"d":l=parseFloat(parseInt(n[s],c||10).toPrecision(e)).toFixed(0)}l="object"===typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(r),u=r&&r[0]+""==="0"?"0":" ";for(;l.length<d;)l=void 0!==t?l+u:u+l;return l}let a=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(a,i)}static getBytes(e,t){return C.encode(e,t)}static getCharCode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}I.SHIFT_JIS=A.SJIS.getName(),I.GB2312="GB2312",I.ISO88591=A.ISO8859_1.getName(),I.EUC_JP="EUC_JP",I.UTF8=A.UTF8.getName(),I.PLATFORM_DEFAULT_ENCODING=I.UTF8,I.ASSUME_SHIFT_JIS=!1;class E{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return"string"===typeof e?this.value+=e.toString():this.encoding?this.value+=I.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,n){for(let r=t;t<t+n;r++)this.append(e[r]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class T{constructor(e,t,n,r){if(this.width=e,this.height=t,this.rowSize=n,this.bits=r,void 0!==t&&null!==t||(t=e),this.height=t,e<1||t<1)throw new u("Both dimensions must be greater than 0");void 0!==n&&null!==n||(n=Math.floor((e+31)/32)),this.rowSize=n,void 0!==r&&null!==r||(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,n=e[0].length,r=new T(n,t);for(let s=0;s<t;s++){const t=e[s];for(let e=0;e<n;e++)t[e]&&r.set(e,s)}return r}static parseFromString(e,t,n){if(null===e)throw new u("stringRepresentation cannot be null");const r=new Array(e.length);let s=0,i=0,a=-1,o=0,l=0;for(;l<e.length;)if("\n"===e.charAt(l)||"\r"===e.charAt(l)){if(s>i){if(-1===a)a=s-i;else if(s-i!==a)throw new u("row lengths do not match");i=s,o++}l++}else if(e.substring(l,l+t.length)===t)l+=t.length,r[s]=!0,s++;else{if(e.substring(l,l+n.length)!==n)throw new u("illegal character encountered: "+e.substring(l));l+=n.length,r[s]=!1,s++}if(s>i){if(-1===a)a=s-i;else if(s-i!==a)throw new u("row lengths do not match");o++}const c=new T(a,o);for(let d=0;d<s;d++)r[d]&&c.set(Math.floor(d%a),Math.floor(d/a));return c}get(e,t){const n=t*this.rowSize+Math.floor(e/32);return 0!==(this.bits[n]>>>(31&e)&1)}set(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]|=1<<(31&e)&4294967295}unset(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]&=~(1<<(31&e)&4294967295)}flip(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]^=1<<(31&e)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new u("input matrix dimensions do not match");const t=new w(Math.floor(this.width/32)+1),n=this.rowSize,r=this.bits;for(let s=0,i=this.height;s<i;s++){const i=s*n,a=e.getRow(s,t).getBitArray();for(let e=0;e<n;e++)r[i+e]^=a[e]}}clear(){const e=this.bits,t=e.length;for(let n=0;n<t;n++)e[n]=0}setRegion(e,t,n,r){if(t<0||e<0)throw new u("Left and top must be nonnegative");if(r<1||n<1)throw new u("Height and width must be at least 1");const s=e+n,i=t+r;if(i>this.height||s>this.width)throw new u("The region must fit inside the matrix");const a=this.rowSize,o=this.bits;for(let l=t;l<i;l++){const t=l*a;for(let n=e;n<s;n++)o[t+Math.floor(n/32)]|=1<<(31&n)&4294967295}}getRow(e,t){null===t||void 0===t||t.getSize()<this.width?t=new w(this.width):t.clear();const n=this.rowSize,r=this.bits,s=e*n;for(let i=0;i<n;i++)t.setBulk(32*i,r[s+i]);return t}setRow(e,t){p.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let n=new w(e),r=new w(e);for(let s=0,i=Math.floor((t+1)/2);s<i;s++)n=this.getRow(s,n),r=this.getRow(t-1-s,r),n.reverse(),r.reverse(),this.setRow(s,r),this.setRow(t-1-s,n)}getEnclosingRectangle(){const e=this.width,t=this.height,n=this.rowSize,r=this.bits;let s=e,i=t,a=-1,o=-1;for(let l=0;l<t;l++)for(let e=0;e<n;e++){const t=r[l*n+e];if(0!==t){if(l<i&&(i=l),l>o&&(o=l),32*e<s){let n=0;for(;0===(t<<31-n&4294967295);)n++;32*e+n<s&&(s=32*e+n)}if(32*e+31>a){let n=31;for(;t>>>n===0;)n--;32*e+n>a&&(a=32*e+n)}}}return a<s||o<i?null:Int32Array.from([s,i,a-s+1,o-i+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let n=0;for(;n<t.length&&0===t[n];)n++;if(n===t.length)return null;const r=n/e;let s=n%e*32;const i=t[n];let a=0;for(;0===(i<<31-a&4294967295);)a++;return s+=a,Int32Array.from([s,r])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let n=t.length-1;for(;n>=0&&0===t[n];)n--;if(n<0)return null;const r=Math.floor(n/e);let s=32*Math.floor(n%e);const i=t[n];let a=31;for(;i>>>a===0;)a--;return s+=a,Int32Array.from([s,r])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof T))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&y.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+y.hashCode(this.bits),e}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X ",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"  ",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\n";return this.buildToString(e,t,n)}buildToString(e,t,n){let r=new E;for(let s=0,i=this.height;s<i;s++){for(let n=0,i=this.width;n<i;n++)r.append(this.get(n,s)?e:t);r.append(n)}return r.toString()}clone(){return new T(this.width,this.height,this.rowSize,this.bits.slice())}}class j extends c{static getNotFoundInstance(){return new j}}j.kind="NotFoundException";class k extends f{constructor(e){super(e),this.luminances=k.EMPTY,this.buckets=new Int32Array(k.LUMINANCE_BUCKETS)}getBlackRow(e,t){const n=this.getLuminanceSource(),r=n.getWidth();void 0===t||null===t||t.getSize()<r?t=new w(r):t.clear(),this.initArrays(r);const s=n.getRow(e,this.luminances),i=this.buckets;for(let o=0;o<r;o++)i[(255&s[o])>>k.LUMINANCE_SHIFT]++;const a=k.estimateBlackPoint(i);if(r<3)for(let o=0;o<r;o++)(255&s[o])<a&&t.set(o);else{let e=255&s[0],n=255&s[1];for(let i=1;i<r-1;i++){const r=255&s[i+1];(4*n-e-r)/2<a&&t.set(i),e=n,n=r}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight(),r=new T(t,n);this.initArrays(t);const s=this.buckets;for(let o=1;o<5;o++){const r=Math.floor(n*o/5),i=e.getRow(r,this.luminances),a=Math.floor(4*t/5);for(let e=Math.floor(t/5);e<a;e++)s[(255&i[e])>>k.LUMINANCE_SHIFT]++}const i=k.estimateBlackPoint(s),a=e.getMatrix();for(let o=0;o<n;o++){const e=o*t;for(let n=0;n<t;n++)(255&a[e+n])<i&&r.set(n,o)}return r}createBinarizer(e){return new k(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let n=0;n<k.LUMINANCE_BUCKETS;n++)t[n]=0}static estimateBlackPoint(e){const t=e.length;let n=0,r=0,s=0;for(let c=0;c<t;c++)e[c]>s&&(r=c,s=e[c]),e[c]>n&&(n=e[c]);let i=0,a=0;for(let c=0;c<t;c++){const t=c-r,n=e[c]*t*t;n>a&&(i=c,a=n)}if(r>i){const e=r;r=i,i=e}if(i-r<=t/16)throw new j;let o=i-1,l=-1;for(let c=i-1;c>r;c--){const t=c-r,s=t*t*(i-c)*(n-e[c]);s>l&&(o=c,l=s)}return o<<k.LUMINANCE_SHIFT}}k.LUMINANCE_BITS=5,k.LUMINANCE_SHIFT=8-k.LUMINANCE_BITS,k.LUMINANCE_BUCKETS=1<<k.LUMINANCE_BITS,k.EMPTY=Uint8ClampedArray.from([0]);class D extends k{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight();if(t>=D.MINIMUM_DIMENSION&&n>=D.MINIMUM_DIMENSION){const r=e.getMatrix();let s=t>>D.BLOCK_SIZE_POWER;0!==(t&D.BLOCK_SIZE_MASK)&&s++;let i=n>>D.BLOCK_SIZE_POWER;0!==(n&D.BLOCK_SIZE_MASK)&&i++;const a=D.calculateBlackPoints(r,s,i,t,n),o=new T(t,n);D.calculateThresholdForBlock(r,s,i,t,n,a,o),this.matrix=o}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new D(e)}static calculateThresholdForBlock(e,t,n,r,s,i,a){const o=s-D.BLOCK_SIZE,l=r-D.BLOCK_SIZE;for(let c=0;c<n;c++){let s=c<<D.BLOCK_SIZE_POWER;s>o&&(s=o);const d=D.cap(c,2,n-3);for(let n=0;n<t;n++){let o=n<<D.BLOCK_SIZE_POWER;o>l&&(o=l);const c=D.cap(n,2,t-3);let u=0;for(let e=-2;e<=2;e++){const t=i[d+e];u+=t[c-2]+t[c-1]+t[c]+t[c+1]+t[c+2]}const h=u/25;D.thresholdBlock(e,o,s,h,r,a)}}}static cap(e,t,n){return e<t?t:e>n?n:e}static thresholdBlock(e,t,n,r,s,i){for(let a=0,o=n*s+t;a<D.BLOCK_SIZE;a++,o+=s)for(let s=0;s<D.BLOCK_SIZE;s++)(255&e[o+s])<=r&&i.set(t+s,n+a)}static calculateBlackPoints(e,t,n,r,s){const i=s-D.BLOCK_SIZE,a=r-D.BLOCK_SIZE,o=new Array(n);for(let l=0;l<n;l++){o[l]=new Int32Array(t);let n=l<<D.BLOCK_SIZE_POWER;n>i&&(n=i);for(let s=0;s<t;s++){let t=s<<D.BLOCK_SIZE_POWER;t>a&&(t=a);let i=0,c=255,d=0;for(let s=0,a=n*r+t;s<D.BLOCK_SIZE;s++,a+=r){for(let t=0;t<D.BLOCK_SIZE;t++){const n=255&e[a+t];i+=n,n<c&&(c=n),n>d&&(d=n)}if(d-c>D.MIN_DYNAMIC_RANGE)for(s++,a+=r;s<D.BLOCK_SIZE;s++,a+=r)for(let t=0;t<D.BLOCK_SIZE;t++)i+=255&e[a+t]}let u=i>>2*D.BLOCK_SIZE_POWER;if(d-c<=D.MIN_DYNAMIC_RANGE&&(u=c/2,l>0&&s>0)){const e=(o[l-1][s]+2*o[l][s-1]+o[l-1][s-1])/4;c<e&&(u=e)}o[l][s]=u}}return o}}D.BLOCK_SIZE_POWER=3,D.BLOCK_SIZE=1<<D.BLOCK_SIZE_POWER,D.BLOCK_SIZE_MASK=D.BLOCK_SIZE-1,D.MINIMUM_DIMENSION=5*D.BLOCK_SIZE,D.MIN_DYNAMIC_RANGE=24;class P{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,n,r){throw new _("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new _("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new _("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new E;for(let n=0;n<this.height;n++){const r=this.getRow(n,e);for(let e=0;e<this.width;e++){const n=255&r[e];let s;s=n<64?"#":n<128?"+":n<192?".":" ",t.append(s)}t.append("\n")}return t.toString()}}class R extends P{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const n=this.delegate.getRow(e,t),r=this.getWidth();for(let s=0;s<r;s++)n[s]=255-(255&n[s]);return n}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),n=new Uint8ClampedArray(t);for(let r=0;r<t;r++)n[r]=255-(255&e[r]);return n}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,n,r){return new R(this.delegate.crop(e,t,n,r))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new R(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new R(this.delegate.rotateCounterClockwise45())}}class O extends P{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=O.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return O.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,n){const r=new Uint8ClampedArray(t*n);for(let s=0,i=0,a=e.length;s<a;s+=4,i++){let t;t=0===e[s+3]?255:306*e[s]+601*e[s+1]+117*e[s+2]+512>>10,r[i]=t}return r}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const n=this.getWidth(),r=e*n;return null===t?t=this.buffer.slice(r,r+n):(t.length<n&&(t=new Uint8ClampedArray(n)),t.set(this.buffer.slice(r,r+n))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,n,r){return super.crop(e,t,n,r),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),n=t.getContext("2d"),r=e*O.DEGREE_TO_RADIANS,s=this.canvas.width,i=this.canvas.height,a=Math.ceil(Math.abs(Math.cos(r))*s+Math.abs(Math.sin(r))*i),o=Math.ceil(Math.abs(Math.sin(r))*s+Math.abs(Math.cos(r))*i);return t.width=a,t.height=o,n.translate(a/2,o/2),n.rotate(r),n.drawImage(this.canvas,s/-2,i/-2),this.buffer=O.makeBufferFromCanvasImageData(t),this}invert(){return new R(this)}}O.DEGREE_TO_RADIANS=Math.PI/180;class L{constructor(e,t,n){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=n||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var M,F=(globalThis||n.g||self||window?(globalThis||n.g||self||window||void 0).__awaiter:void 0)||function(e,t,n,r){function s(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){e.done?n(e.value):s(e.value).then(a,o)}l((r=r.apply(e,t||[])).next())})};class B{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0;this.reader=e,this.timeBetweenScansMillis=t,this._hints=n,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!==typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return F(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const n of e){const e="video"===n.kind?"videoinput":n.kind;if("videoinput"!==e)continue;const r={deviceId:n.deviceId||n.id,label:n.label||"Video device ".concat(t.length+1),kind:e,groupId:n.groupId};t.push(r)}return t})}getVideoInputDevices(){return F(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(e=>new L(e.deviceId,e.label))})}findDeviceById(e){return F(this,void 0,void 0,function*(){const t=yield this.listVideoInputDevices();return t?t.find(t=>t.deviceId===e):null})}decodeFromInputVideoDevice(e,t){return F(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(e,t)})}decodeOnceFromVideoDevice(e,t){return F(this,void 0,void 0,function*(){let n;this.reset(),n=e?{deviceId:{exact:e}}:{facingMode:"environment"};const r={video:n};return yield this.decodeOnceFromConstraints(r,t)})}decodeOnceFromConstraints(e,t){return F(this,void 0,void 0,function*(){const n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(n,t)})}decodeOnceFromStream(e,t){return F(this,void 0,void 0,function*(){this.reset();const n=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(n)})}decodeFromInputVideoDeviceContinuously(e,t,n){return F(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(e,t,n)})}decodeFromVideoDevice(e,t,n){return F(this,void 0,void 0,function*(){let r;r=e?{deviceId:{exact:e}}:{facingMode:"environment"};const s={video:r};return yield this.decodeFromConstraints(s,t,n)})}decodeFromConstraints(e,t,n){return F(this,void 0,void 0,function*(){const r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(r,t,n)})}decodeFromStream(e,t,n){return F(this,void 0,void 0,function*(){this.reset();const r=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(r,n)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return F(this,void 0,void 0,function*(){const n=this.prepareVideoElement(t);return this.addVideoSource(n,e),this.videoElement=n,this.stream=e,yield this.playVideoOnLoadAsync(n),n})}playVideoOnLoadAsync(e){return new Promise((t,n)=>this.playVideoOnLoad(e,()=>t()))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return F(this,void 0,void 0,function*(){if(this.isVideoPlaying(e))console.warn("Trying to play video that is already playing.");else try{yield e.play()}catch(t){console.warn("It was not possible to play the video.")}})}getMediaElement(e,t){const n=document.getElementById(e);if(!n)throw new d("element with id '".concat(e,"' not found"));if(n.nodeName.toLowerCase()!==t.toLowerCase())throw new d("element with id '".concat(e,"' must be an ").concat(t," element"));return n}decodeFromImage(e,t){if(!e&&!t)throw new d("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,n){if(void 0===e&&void 0===t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,n):this.decodeFromVideoElementContinuously(e,n)}decodeFromImageElement(e){if(!e)throw new d("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);let n;return this.imageElement=t,n=this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t),n}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const n=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(n,t)}_decodeFromVideoElementSetup(e){if(!e)throw new d("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const n=this._decodeOnLoadImage(t);return t.src=e,n}decodeFromVideoUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),n=this.decodeFromVideoElement(t);return t.src=e,n}decodeFromVideoUrlContinuously(e,t){if(!e)throw new d("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),r=this.decodeFromVideoElementContinuously(n,t);return n.src=e,r}_decodeOnLoadImage(e){return new Promise((t,n)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,n),e.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(e){return F(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)})}_decodeOnLoadVideoContinuously(e,t){return F(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)})}isImageLoaded(e){return!!e.complete&&0!==e.naturalWidth}prepareImageElement(e){let t;return"undefined"===typeof e&&(t=document.createElement("img"),t.width=200,t.height=200),"string"===typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return e||"undefined"===typeof document||(t=document.createElement("video"),t.width=200,t.height=200),"string"===typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._stopAsyncDecode=!1;const r=(s,i)=>{if(this._stopAsyncDecode)return i(new j("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{s(this.decode(e))}catch(a){if(t&&a instanceof j||(a instanceof m||a instanceof S)&&n)return setTimeout(r,this._timeBetweenDecodingAttempts,s,i);i(a)}};return new Promise((e,t)=>r(e,t))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const n=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const r=this.decode(e);t(r,null),setTimeout(n,this.timeBetweenScansMillis)}catch(r){t(null,r),(r instanceof m||r instanceof S||r instanceof j)&&setTimeout(n,this._timeBetweenDecodingAttempts)}};n()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return 0!==e.videoWidth}drawFrameOnCanvas(e,t,n){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.captureCanvasContext;t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),n=new O(t),r=new D(n);return new h(r)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const t=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=t}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if("undefined"===typeof document)return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let n,r;return"undefined"!==typeof e&&(e instanceof HTMLVideoElement?(n=e.videoWidth,r=e.videoHeight):e instanceof HTMLImageElement&&(n=e.naturalWidth||e.width,r=e.naturalHeight||e.height)),t.style.width=n+"px",t.style.height=r+"px",t.width=n,t.height=r,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&("undefined"!==typeof this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),"undefined"!==typeof this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),"undefined"!==typeof this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch(n){e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")}}class U{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null==t?0:8*t.length,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:p.currentTimeMillis();this.text=e,this.rawBytes=t,this.numBits=n,this.resultPoints=r,this.format=s,this.timestamp=i,this.text=e,this.rawBytes=t,this.numBits=void 0===n||null===n?null===t||void 0===t?0:8*t.length:n,this.resultPoints=r,this.format=s,this.resultMetadata=null,this.timestamp=void 0===i||null===i?p.currentTimeMillis():i}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){const n=new Array(t.length+e.length);p.arraycopy(t,0,n,0,t.length),p.arraycopy(e,0,n,t.length,e.length),this.resultPoints=n}}getTimestamp(){return this.timestamp}toString(){return this.text}}!function(e){e[e.AZTEC=0]="AZTEC",e[e.CODABAR=1]="CODABAR",e[e.CODE_39=2]="CODE_39",e[e.CODE_93=3]="CODE_93",e[e.CODE_128=4]="CODE_128",e[e.DATA_MATRIX=5]="DATA_MATRIX",e[e.EAN_8=6]="EAN_8",e[e.EAN_13=7]="EAN_13",e[e.ITF=8]="ITF",e[e.MAXICODE=9]="MAXICODE",e[e.PDF_417=10]="PDF_417",e[e.QR_CODE=11]="QR_CODE",e[e.RSS_14=12]="RSS_14",e[e.RSS_EXPANDED=13]="RSS_EXPANDED",e[e.UPC_A=14]="UPC_A",e[e.UPC_E=15]="UPC_E",e[e.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"}(M||(M={}));var z,q=M;!function(e){e[e.OTHER=0]="OTHER",e[e.ORIENTATION=1]="ORIENTATION",e[e.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",e[e.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",e[e.ISSUE_NUMBER=4]="ISSUE_NUMBER",e[e.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",e[e.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",e[e.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",e[e.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",e[e.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",e[e.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"}(z||(z={}));var H,V,W,G,Y,X,Q=z;class K{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;this.rawBytes=e,this.text=t,this.byteSegments=n,this.ecLevel=r,this.structuredAppendSequenceNumber=s,this.structuredAppendParity=i,this.numBits=void 0===e||null===e?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Z{exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class J{constructor(e,t){if(0===t.length)throw new u;this.field=e;const n=t.length;if(n>1&&0===t[0]){let e=1;for(;e<n&&0===t[e];)e++;e===n?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(n-e),p.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);const t=this.coefficients;let n;if(1===e){n=0;for(let e=0,r=t.length;e!==r;e++){const r=t[e];n=Z.addOrSubtract(n,r)}return n}n=t[0];const r=t.length,s=this.field;for(let i=1;i<r;i++)n=Z.addOrSubtract(s.multiply(e,n),t[i]);return n}addOrSubtract(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){const e=t;t=n,n=e}let r=new Int32Array(n.length);const s=n.length-t.length;p.arraycopy(n,0,r,0,s);for(let i=s;i<n.length;i++)r[i]=Z.addOrSubtract(t[i-s],n[i]);return new J(this.field,r)}multiply(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,n=t.length,r=e.coefficients,s=r.length,i=new Int32Array(n+s-1),a=this.field;for(let o=0;o<n;o++){const e=t[o];for(let t=0;t<s;t++)i[o+t]=Z.addOrSubtract(i[o+t],a.multiply(e,r[t]))}return new J(a,i)}multiplyScalar(e){if(0===e)return this.field.getZero();if(1===e)return this;const t=this.coefficients.length,n=this.field,r=new Int32Array(t),s=this.coefficients;for(let i=0;i<t;i++)r[i]=n.multiply(s[i],e);return new J(n,r)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return this.field.getZero();const n=this.coefficients,r=n.length,s=new Int32Array(r+e),i=this.field;for(let a=0;a<r;a++)s[a]=i.multiply(n[a],t);return new J(i,s)}divide(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new u("Divide by 0");const t=this.field;let n=t.getZero(),r=this;const s=e.getCoefficient(e.getDegree()),i=t.inverse(s);for(;r.getDegree()>=e.getDegree()&&!r.isZero();){const s=r.getDegree()-e.getDegree(),a=t.multiply(r.getCoefficient(r.getDegree()),i),o=e.multiplyByMonomial(s,a),l=t.buildMonomial(s,a);n=n.addOrSubtract(l),r=r.addOrSubtract(o)}return[n,r]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);if(0!==n){if(n<0?(e+=" - ",n=-n):e.length>0&&(e+=" + "),0===t||1!==n){const t=this.field.log(n);0===t?e+="1":1===t?e+="a":(e+="a^",e+=t)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e}}class $ extends c{}$.kind="ArithmeticException";class ee extends Z{constructor(e,t,n){super(),this.primitive=e,this.size=t,this.generatorBase=n;const r=new Int32Array(t);let s=1;for(let a=0;a<t;a++)r[a]=s,s*=2,s>=t&&(s^=e,s&=t-1);this.expTable=r;const i=new Int32Array(t);for(let a=0;a<t-1;a++)i[r[a]]=a;this.logTable=i,this.zero=new J(this,Int32Array.from([0])),this.one=new J(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;const n=new Int32Array(e+1);return n[0]=t,new J(this,n)}inverse(e){if(0===e)throw new $;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+b.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}ee.AZTEC_DATA_12=new ee(4201,4096,1),ee.AZTEC_DATA_10=new ee(1033,1024,1),ee.AZTEC_DATA_6=new ee(67,64,1),ee.AZTEC_PARAM=new ee(19,16,1),ee.QR_CODE_FIELD_256=new ee(285,256,0),ee.DATA_MATRIX_FIELD_256=new ee(301,256,1),ee.AZTEC_DATA_8=ee.DATA_MATRIX_FIELD_256,ee.MAXICODE_FIELD_64=ee.AZTEC_DATA_6;class te extends c{}te.kind="ReedSolomonException";class ne extends c{}ne.kind="IllegalStateException";class re{constructor(e){this.field=e}decode(e,t){const n=this.field,r=new J(n,e),s=new Int32Array(t);let i=!0;for(let h=0;h<t;h++){const e=r.evaluateAt(n.exp(h+n.getGeneratorBase()));s[s.length-1-h]=e,0!==e&&(i=!1)}if(i)return;const a=new J(n,s),o=this.runEuclideanAlgorithm(n.buildMonomial(t,1),a,t),l=o[0],c=o[1],d=this.findErrorLocations(l),u=this.findErrorMagnitudes(c,d);for(let h=0;h<d.length;h++){const t=e.length-1-n.log(d[h]);if(t<0)throw new te("Bad error location");e[t]=ee.addOrSubtract(e[t],u[h])}}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){const n=e;e=t,t=n}const r=this.field;let s=e,i=t,a=r.getZero(),o=r.getOne();for(;i.getDegree()>=(n/2|0);){let e=s,t=a;if(s=i,a=o,s.isZero())throw new te("r_{i-1} was zero");i=e;let n=r.getZero();const l=s.getCoefficient(s.getDegree()),c=r.inverse(l);for(;i.getDegree()>=s.getDegree()&&!i.isZero();){const e=i.getDegree()-s.getDegree(),t=r.multiply(i.getCoefficient(i.getDegree()),c);n=n.addOrSubtract(r.buildMonomial(e,t)),i=i.addOrSubtract(s.multiplyByMonomial(e,t))}if(o=n.multiply(a).addOrSubtract(t),i.getDegree()>=s.getDegree())throw new ne("Division algorithm failed to reduce polynomial?")}const l=o.getCoefficient(0);if(0===l)throw new te("sigmaTilde(0) was zero");const c=r.inverse(l);return[o.multiplyScalar(c),i.multiplyScalar(c)]}findErrorLocations(e){const t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);const n=new Int32Array(t);let r=0;const s=this.field;for(let i=1;i<s.getSize()&&r<t;i++)0===e.evaluateAt(i)&&(n[r]=s.inverse(i),r++);if(r!==t)throw new te("Error locator degree does not match number of roots");return n}findErrorMagnitudes(e,t){const n=t.length,r=new Int32Array(n),s=this.field;for(let i=0;i<n;i++){const a=s.inverse(t[i]);let o=1;for(let e=0;e<n;e++)if(i!==e){const n=s.multiply(t[e],a),r=0===(1&n)?1|n:-2&n;o=s.multiply(o,r)}r[i]=s.multiply(e.evaluateAt(a),s.inverse(o)),0!==s.getGeneratorBase()&&(r[i]=s.multiply(r[i],a))}return r}}!function(e){e[e.UPPER=0]="UPPER",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.DIGIT=3]="DIGIT",e[e.PUNCT=4]="PUNCT",e[e.BINARY=5]="BINARY"}(H||(H={}));class se{decode(e){this.ddata=e;let t=e.getBits(),n=this.extractBits(t),r=this.correctBits(n),s=se.convertBoolArrayToByteArray(r),i=se.getEncodedData(r),a=new K(s,i,null,null);return a.setNumBits(r.length),a}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,n=H.UPPER,r=H.UPPER,s="",i=0;for(;i<t;)if(r===H.BINARY){if(t-i<5)break;let a=se.readCode(e,i,5);if(i+=5,0===a){if(t-i<11)break;a=se.readCode(e,i,11)+31,i+=11}for(let n=0;n<a;n++){if(t-i<8){i=t;break}const n=se.readCode(e,i,8);s+=I.castAsNonUtf8Char(n),i+=8}r=n}else{let a=r===H.DIGIT?4:5;if(t-i<a)break;let o=se.readCode(e,i,a);i+=a;let l=se.getCharacter(r,o);l.startsWith("CTRL_")?(n=r,r=se.getTable(l.charAt(5)),"L"===l.charAt(6)&&(n=r)):(s+=l,r=n)}return s}static getTable(e){switch(e){case"L":return H.LOWER;case"P":return H.PUNCT;case"M":return H.MIXED;case"D":return H.DIGIT;case"B":return H.BINARY;default:return H.UPPER}}static getCharacter(e,t){switch(e){case H.UPPER:return se.UPPER_TABLE[t];case H.LOWER:return se.LOWER_TABLE[t];case H.MIXED:return se.MIXED_TABLE[t];case H.PUNCT:return se.PUNCT_TABLE[t];case H.DIGIT:return se.DIGIT_TABLE[t];default:throw new ne("Bad table")}}correctBits(e){let t,n;this.ddata.getNbLayers()<=2?(n=6,t=ee.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,t=ee.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,t=ee.AZTEC_DATA_10):(n=12,t=ee.AZTEC_DATA_12);let r=this.ddata.getNbDatablocks(),s=e.length/n;if(s<r)throw new S;let i=e.length%n,a=new Int32Array(s);for(let h=0;h<s;h++,i+=n)a[h]=se.readCode(e,i,n);try{new re(t).decode(a,s-r)}catch(u){throw new S(u)}let o=(1<<n)-1,l=0;for(let h=0;h<r;h++){let e=a[h];if(0===e||e===o)throw new S;1!==e&&e!==o-1||l++}let c=new Array(r*n-l),d=0;for(let h=0;h<r;h++){let e=a[h];if(1===e||e===o-1)c.fill(e>1,d,d+n-1),d+=n-1;else for(let t=n-1;t>=0;--t)c[d++]=0!==(e&1<<t)}return c}extractBits(e){let t=this.ddata.isCompact(),n=this.ddata.getNbLayers(),r=(t?11:14)+4*n,s=new Int32Array(r),i=new Array(this.totalBitsInLayer(n,t));if(t)for(let a=0;a<s.length;a++)s[a]=a;else{let e=r+1+2*b.truncDivision(b.truncDivision(r,2)-1,15),t=r/2,n=b.truncDivision(e,2);for(let r=0;r<t;r++){let e=r+b.truncDivision(r,15);s[t-r-1]=n-e-1,s[t+r]=n+e+1}}for(let a=0,o=0;a<n;a++){let l=4*(n-a)+(t?9:12),c=2*a,d=r-1-c;for(let t=0;t<l;t++){let n=2*t;for(let r=0;r<2;r++)i[o+n+r]=e.get(s[c+r],s[c+t]),i[o+2*l+n+r]=e.get(s[c+t],s[d-r]),i[o+4*l+n+r]=e.get(s[d-r],s[d-t]),i[o+6*l+n+r]=e.get(s[d-t],s[c+r])}o+=8*l}return i}static readCode(e,t,n){let r=0;for(let s=t;s<t+n;s++)r<<=1,e[s]&&(r|=1);return r}static readByte(e,t){let n=e.length-t;return n>=8?se.readCode(e,t,8):se.readCode(e,t,n)<<8-n}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let n=0;n<t.length;n++)t[n]=se.readByte(e,8*n);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}se.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],se.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],se.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],se.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],se.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class ie{constructor(){}static round(e){return NaN===e?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,n,r){const s=e-n,i=t-r;return Math.sqrt(s*s+i*i)}static sum(e){let t=0;for(let n=0,r=e.length;n!==r;n++)t+=e[n];return t}}class ae{static floatToIntBits(e){return e}}ae.MAX_VALUE=Number.MAX_SAFE_INTEGER;class oe{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof oe){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*ae.floatToIntBits(this.x)+ae.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),n=this.distance(e[1],e[2]),r=this.distance(e[0],e[2]);let s,i,a;if(n>=t&&n>=r?(i=e[0],s=e[1],a=e[2]):r>=n&&r>=t?(i=e[1],s=e[0],a=e[2]):(i=e[2],s=e[0],a=e[1]),this.crossProductZ(s,i,a)<0){const e=s;s=a,a=e}e[0]=s,e[1]=i,e[2]=a}static distance(e,t){return ie.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,n){const r=t.x,s=t.y;return(n.x-r)*(e.y-s)-(n.y-s)*(e.x-r)}}class le{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class ce extends le{constructor(e,t,n,r,s){super(e,t),this.compact=n,this.nbDatablocks=r,this.nbLayers=s}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class de{constructor(e,t,n,r){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),void 0!==t&&null!==t||(t=de.INIT_SIZE),void 0!==n&&null!==n||(n=e.getWidth()/2|0),void 0!==r&&null!==r||(r=e.getHeight()/2|0);const s=t/2|0;if(this.leftInit=n-s,this.rightInit=n+s,this.upInit=r-s,this.downInit=r+s,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new j}detect(){let e=this.leftInit,t=this.rightInit,n=this.upInit,r=this.downInit,s=!1,i=!0,a=!1,o=!1,l=!1,c=!1,d=!1;const u=this.width,h=this.height;for(;i;){i=!1;let m=!0;for(;(m||!o)&&t<u;)m=this.containsBlackPoint(n,r,t,!1),m?(t++,i=!0,o=!0):o||t++;if(t>=u){s=!0;break}let f=!0;for(;(f||!l)&&r<h;)f=this.containsBlackPoint(e,t,r,!0),f?(r++,i=!0,l=!0):l||r++;if(r>=h){s=!0;break}let p=!0;for(;(p||!c)&&e>=0;)p=this.containsBlackPoint(n,r,e,!1),p?(e--,i=!0,c=!0):c||e--;if(e<0){s=!0;break}let g=!0;for(;(g||!d)&&n>=0;)g=this.containsBlackPoint(e,t,n,!0),g?(n--,i=!0,d=!0):d||n--;if(n<0){s=!0;break}i&&(a=!0)}if(!s&&a){const s=t-e;let i=null;for(let t=1;null===i&&t<s;t++)i=this.getBlackPointOnSegment(e,r-t,e+t,r);if(null==i)throw new j;let a=null;for(let t=1;null===a&&t<s;t++)a=this.getBlackPointOnSegment(e,n+t,e+t,n);if(null==a)throw new j;let o=null;for(let e=1;null===o&&e<s;e++)o=this.getBlackPointOnSegment(t,n+e,t-e,n);if(null==o)throw new j;let l=null;for(let e=1;null===l&&e<s;e++)l=this.getBlackPointOnSegment(t,r-e,t-e,r);if(null==l)throw new j;return this.centerEdges(l,i,o,a)}throw new j}getBlackPointOnSegment(e,t,n,r){const s=ie.round(ie.distance(e,t,n,r)),i=(n-e)/s,a=(r-t)/s,o=this.image;for(let l=0;l<s;l++){const n=ie.round(e+l*i),r=ie.round(t+l*a);if(o.get(n,r))return new oe(n,r)}return null}centerEdges(e,t,n,r){const s=e.getX(),i=e.getY(),a=t.getX(),o=t.getY(),l=n.getX(),c=n.getY(),d=r.getX(),u=r.getY(),h=de.CORR;return s<this.width/2?[new oe(d-h,u+h),new oe(a+h,o+h),new oe(l-h,c-h),new oe(s+h,i-h)]:[new oe(d+h,u+h),new oe(a+h,o-h),new oe(l-h,c+h),new oe(s-h,i-h)]}containsBlackPoint(e,t,n,r){const s=this.image;if(r){for(let i=e;i<=t;i++)if(s.get(i,n))return!0}else for(let i=e;i<=t;i++)if(s.get(n,i))return!0;return!1}}de.INIT_SIZE=10,de.CORR=1;class ue{static checkAndNudgePoints(e,t){const n=e.getWidth(),r=e.getHeight();let s=!0;for(let i=0;i<t.length&&s;i+=2){const e=Math.floor(t[i]),a=Math.floor(t[i+1]);if(e<-1||e>n||a<-1||a>r)throw new j;s=!1,-1===e?(t[i]=0,s=!0):e===n&&(t[i]=n-1,s=!0),-1===a?(t[i+1]=0,s=!0):a===r&&(t[i+1]=r-1,s=!0)}s=!0;for(let i=t.length-2;i>=0&&s;i-=2){const e=Math.floor(t[i]),a=Math.floor(t[i+1]);if(e<-1||e>n||a<-1||a>r)throw new j;s=!1,-1===e?(t[i]=0,s=!0):e===n&&(t[i]=n-1,s=!0),-1===a?(t[i+1]=0,s=!0):a===r&&(t[i+1]=r-1,s=!0)}}}class he{constructor(e,t,n,r,s,i,a,o,l){this.a11=e,this.a21=t,this.a31=n,this.a12=r,this.a22=s,this.a32=i,this.a13=a,this.a23=o,this.a33=l}static quadrilateralToQuadrilateral(e,t,n,r,s,i,a,o,l,c,d,u,h,m,f,p){const g=he.quadrilateralToSquare(e,t,n,r,s,i,a,o);return he.squareToQuadrilateral(l,c,d,u,h,m,f,p).times(g)}transformPoints(e){const t=e.length,n=this.a11,r=this.a12,s=this.a13,i=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33;for(let u=0;u<t;u+=2){const t=e[u],h=e[u+1],m=s*t+o*h+d;e[u]=(n*t+i*h+l)/m,e[u+1]=(r*t+a*h+c)/m}}transformPointsWithValues(e,t){const n=this.a11,r=this.a12,s=this.a13,i=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33,u=e.length;for(let h=0;h<u;h++){const u=e[h],m=t[h],f=s*u+o*m+d;e[h]=(n*u+i*m+l)/f,t[h]=(r*u+a*m+c)/f}}static squareToQuadrilateral(e,t,n,r,s,i,a,o){const l=e-n+s-a,c=t-r+i-o;if(0===l&&0===c)return new he(n-e,s-n,e,r-t,i-r,t,0,0,1);{const d=n-s,u=a-s,h=r-i,m=o-i,f=d*m-u*h,p=(l*m-u*c)/f,g=(d*c-l*h)/f;return new he(n-e+p*n,a-e+g*a,e,r-t+p*r,o-t+g*o,t,p,g,1)}}static quadrilateralToSquare(e,t,n,r,s,i,a,o){return he.squareToQuadrilateral(e,t,n,r,s,i,a,o).buildAdjoint()}buildAdjoint(){return new he(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new he(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class me extends ue{sampleGrid(e,t,n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y){const b=he.quadrilateralToQuadrilateral(r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y);return this.sampleGridWithTransform(e,t,n,b)}sampleGridWithTransform(e,t,n,r){if(t<=0||n<=0)throw new j;const s=new T(t,n),i=new Float32Array(2*t);for(let o=0;o<n;o++){const t=i.length,n=o+.5;for(let e=0;e<t;e+=2)i[e]=e/2+.5,i[e+1]=n;r.transformPoints(i),ue.checkAndNudgePoints(e,i);try{for(let n=0;n<t;n+=2)e.get(Math.floor(i[n]),Math.floor(i[n+1]))&&s.set(n/2,o)}catch(a){throw new j}}return s}}class fe{static setGridSampler(e){fe.gridSampler=e}static getInstance(){return fe.gridSampler}}fe.gridSampler=new me;class pe{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new oe(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class ge{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),n=this.getBullsEyeCorners(t);if(e){let e=n[0];n[0]=n[2],n[2]=e}this.extractParameters(n);let r=this.sampleGrid(this.image,n[this.shift%4],n[(this.shift+1)%4],n[(this.shift+2)%4],n[(this.shift+3)%4]),s=this.getMatrixCornerPoints(n);return new ce(r,s,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!this.isValidPoint(e[0])||!this.isValidPoint(e[1])||!this.isValidPoint(e[2])||!this.isValidPoint(e[3]))throw new j;let t=2*this.nbCenterLayers,n=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(n,t);let r=0;for(let i=0;i<4;i++){let e=n[(this.shift+i)%4];this.compact?(r<<=7,r+=e>>1&127):(r<<=10,r+=(e>>2&992)+(e>>1&31))}let s=this.getCorrectedParameterData(r,this.compact);this.compact?(this.nbLayers=1+(s>>6),this.nbDataBlocks=1+(63&s)):(this.nbLayers=1+(s>>11),this.nbDataBlocks=1+(2047&s))}getRotation(e,t){let n=0;e.forEach((e,r,s)=>{n=(e>>t-2<<1)+(1&e)+(n<<3)}),n=((1&n)<<11)+(n>>1);for(let r=0;r<4;r++)if(b.bitCount(n^this.EXPECTED_CORNER_BITS[r])<=2)return r;throw new j}getCorrectedParameterData(e,t){let n,r;t?(n=7,r=2):(n=10,r=4);let s=n-r,i=new Int32Array(n);for(let l=n-1;l>=0;--l)i[l]=15&e,e>>=4;try{new re(ee.AZTEC_PARAM).decode(i,s)}catch(o){throw new j}let a=0;for(let l=0;l<r;l++)a=(a<<4)+i[l];return a}getBullsEyeCorners(e){let t=e,n=e,r=e,s=e,i=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let e=this.getFirstDifferent(t,i,1,-1),a=this.getFirstDifferent(n,i,1,1),o=this.getFirstDifferent(r,i,-1,1),l=this.getFirstDifferent(s,i,-1,-1);if(this.nbCenterLayers>2){let n=this.distancePoint(l,e)*this.nbCenterLayers/(this.distancePoint(s,t)*(this.nbCenterLayers+2));if(n<.75||n>1.25||!this.isWhiteOrBlackRectangle(e,a,o,l))break}t=e,n=a,r=o,s=l,i=!i}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new j;this.compact=5===this.nbCenterLayers;let a=new oe(t.getX()+.5,t.getY()-.5),o=new oe(n.getX()+.5,n.getY()+.5),l=new oe(r.getX()-.5,r.getY()+.5),c=new oe(s.getX()-.5,s.getY()-.5);return this.expandSquare([a,o,l,c],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,n,r;try{let s=new de(this.image).detect();e=s[0],t=s[1],n=s[2],r=s[3]}catch(a){let s=this.image.getWidth()/2,i=this.image.getHeight()/2;e=this.getFirstDifferent(new pe(s+7,i-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new pe(s+7,i+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new pe(s-7,i+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new pe(s-7,i-7),!1,-1,-1).toResultPoint()}let s=ie.round((e.getX()+r.getX()+t.getX()+n.getX())/4),i=ie.round((e.getY()+r.getY()+t.getY()+n.getY())/4);try{let a=new de(this.image,15,s,i).detect();e=a[0],t=a[1],n=a[2],r=a[3]}catch(a){e=this.getFirstDifferent(new pe(s+7,i-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new pe(s+7,i+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new pe(s-7,i+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new pe(s-7,i-7),!1,-1,-1).toResultPoint()}return s=ie.round((e.getX()+r.getX()+t.getX()+n.getX())/4),i=ie.round((e.getY()+r.getY()+t.getY()+n.getY())/4),new pe(s,i)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,n,r,s){let i=fe.getInstance(),a=this.getDimension(),o=a/2-this.nbCenterLayers,l=a/2+this.nbCenterLayers;return i.sampleGrid(e,a,a,o,o,l,o,l,l,o,l,t.getX(),t.getY(),n.getX(),n.getY(),r.getX(),r.getY(),s.getX(),s.getY())}sampleLine(e,t,n){let r=0,s=this.distanceResultPoint(e,t),i=s/n,a=e.getX(),o=e.getY(),l=i*(t.getX()-e.getX())/s,c=i*(t.getY()-e.getY())/s;for(let d=0;d<n;d++)this.image.get(ie.round(a+d*l),ie.round(o+d*c))&&(r|=1<<n-d-1);return r}isWhiteOrBlackRectangle(e,t,n,r){let s=3;e=new pe(e.getX()-s,e.getY()+s),t=new pe(t.getX()-s,t.getY()-s),n=new pe(n.getX()+s,n.getY()-s),r=new pe(r.getX()+s,r.getY()+s);let i=this.getColor(r,e);if(0===i)return!1;let a=this.getColor(e,t);return a===i&&(a=this.getColor(t,n),a===i&&(a=this.getColor(n,r),a===i))}getColor(e,t){let n=this.distancePoint(e,t),r=(t.getX()-e.getX())/n,s=(t.getY()-e.getY())/n,i=0,a=e.getX(),o=e.getY(),l=this.image.get(e.getX(),e.getY()),c=Math.ceil(n);for(let u=0;u<c;u++)a+=r,o+=s,this.image.get(ie.round(a),ie.round(o))!==l&&i++;let d=i/n;return d>.1&&d<.9?0:d<=.1===l?1:-1}getFirstDifferent(e,t,n,r){let s=e.getX()+n,i=e.getY()+r;for(;this.isValid(s,i)&&this.image.get(s,i)===t;)s+=n,i+=r;for(s-=n,i-=r;this.isValid(s,i)&&this.image.get(s,i)===t;)s+=n;for(s-=n;this.isValid(s,i)&&this.image.get(s,i)===t;)i+=r;return i-=r,new pe(s,i)}expandSquare(e,t,n){let r=n/(2*t),s=e[0].getX()-e[2].getX(),i=e[0].getY()-e[2].getY(),a=(e[0].getX()+e[2].getX())/2,o=(e[0].getY()+e[2].getY())/2,l=new oe(a+r*s,o+r*i),c=new oe(a-r*s,o-r*i);return s=e[1].getX()-e[3].getX(),i=e[1].getY()-e[3].getY(),a=(e[1].getX()+e[3].getX())/2,o=(e[1].getY()+e[3].getY())/2,[l,new oe(a+r*s,o+r*i),c,new oe(a-r*s,o-r*i)]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=ie.round(e.getX()),n=ie.round(e.getY());return this.isValid(t,n)}distancePoint(e,t){return ie.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return ie.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(b.truncDivision(this.nbLayers-4,8)+1)+15}}class xe{decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null,r=new ge(e.getBlackMatrix()),s=null,i=null;try{let e=r.detectMirror(!1);s=e.getPoints(),this.reportFoundResultPoints(t,s),i=(new se).decode(e)}catch(c){n=c}if(null==i)try{let e=r.detectMirror(!0);s=e.getPoints(),this.reportFoundResultPoints(t,s),i=(new se).decode(e)}catch(c){if(null!=n)throw n;throw c}let a=new U(i.getText(),i.getRawBytes(),i.getNumBits(),s,q.AZTEC,p.currentTimeMillis()),o=i.getByteSegments();null!=o&&a.putMetadata(Q.BYTE_SEGMENTS,o);let l=i.getECLevel();return null!=l&&a.putMetadata(Q.ERROR_CORRECTION_LEVEL,l),a}reportFoundResultPoints(e,t){if(null!=e){let n=e.get(N.NEED_RESULT_POINT_CALLBACK);null!=n&&t.forEach((e,t,r)=>{n.foundPossibleResultPoint(e)})}}reset(){}}class ye extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;super(new xe,e)}}class be{decode(e,t){try{return this.doDecode(e,t)}catch(n){if(t&&!0===t.get(N.TRY_HARDER)&&e.isRotateSupported()){const n=e.rotateCounterClockwise(),r=this.doDecode(n,t),s=r.getResultMetadata();let i=270;null!==s&&!0===s.get(Q.ORIENTATION)&&(i+=s.get(Q.ORIENTATION)%360),r.putMetadata(Q.ORIENTATION,i);const a=r.getResultPoints();if(null!==a){const e=n.getHeight();for(let t=0;t<a.length;t++)a[t]=new oe(e-a[t].getY()-1,a[t].getX())}return r}throw new j}}reset(){}doDecode(e,t){const n=e.getWidth(),r=e.getHeight();let s=new w(n);const i=t&&!0===t.get(N.TRY_HARDER),a=Math.max(1,r>>(i?8:5));let o;o=i?r:15;const l=Math.trunc(r/2);for(let u=0;u<o;u++){const i=Math.trunc((u+1)/2),o=l+a*(0===(1&u)?i:-i);if(o<0||o>=r)break;try{s=e.getBlackRow(o,s)}catch(c){continue}for(let e=0;e<2;e++){if(1===e&&(s.reverse(),t&&!0===t.get(N.NEED_RESULT_POINT_CALLBACK))){const e=new Map;t.forEach((t,n)=>e.set(n,t)),e.delete(N.NEED_RESULT_POINT_CALLBACK),t=e}try{const r=this.decodeRow(o,s,t);if(1===e){r.putMetadata(Q.ORIENTATION,180);const e=r.getResultPoints();null!==e&&(e[0]=new oe(n-e[0].getX()-1,e[0].getY()),e[1]=new oe(n-e[1].getX()-1,e[1].getY()))}return r}catch(d){}}}throw new j}static recordPattern(e,t,n){const r=n.length;for(let l=0;l<r;l++)n[l]=0;const s=e.getSize();if(t>=s)throw new j;let i=!e.get(t),a=0,o=t;for(;o<s;){if(e.get(o)!==i)n[a]++;else{if(++a===r)break;n[a]=1,i=!i}o++}if(a!==r&&(a!==r-1||o!==s))throw new j}static recordPatternInReverse(e,t,n){let r=n.length,s=e.get(t);for(;t>0&&r>=0;)e.get(--t)!==s&&(r--,s=!s);if(r>=0)throw new j;be.recordPattern(e,t+1,n)}static patternMatchVariance(e,t,n){const r=e.length;let s=0,i=0;for(let l=0;l<r;l++)s+=e[l],i+=t[l];if(s<i)return Number.POSITIVE_INFINITY;const a=s/i;n*=a;let o=0;for(let l=0;l<r;l++){const r=e[l],s=t[l]*a,i=r>s?r-s:s-r;if(i>n)return Number.POSITIVE_INFINITY;o+=i}return o/s}}class we extends be{static findStartPattern(e){const t=e.getSize(),n=e.getNextSet(0);let r=0,s=Int32Array.from([0,0,0,0,0,0]),i=n,a=!1;const o=6;for(let l=n;l<t;l++)if(e.get(l)!==a)s[r]++;else{if(r===o-1){let t=we.MAX_AVG_VARIANCE,n=-1;for(let e=we.CODE_START_A;e<=we.CODE_START_C;e++){const r=be.patternMatchVariance(s,we.CODE_PATTERNS[e],we.MAX_INDIVIDUAL_VARIANCE);r<t&&(t=r,n=e)}if(n>=0&&e.isRange(Math.max(0,i-(l-i)/2),i,!1))return Int32Array.from([i,l,n]);i+=s[0]+s[1],s=s.slice(2,s.length-1),s[r-1]=0,s[r]=0,r--}else r++;s[r]=1,a=!a}throw new j}static decodeCode(e,t,n){be.recordPattern(e,n,t);let r=we.MAX_AVG_VARIANCE,s=-1;for(let i=0;i<we.CODE_PATTERNS.length;i++){const e=we.CODE_PATTERNS[i],n=this.patternMatchVariance(t,e,we.MAX_INDIVIDUAL_VARIANCE);n<r&&(r=n,s=i)}if(s>=0)return s;throw new j}decodeRow(e,t,n){const r=n&&!0===n.get(N.ASSUME_GS1),s=we.findStartPattern(t),i=s[2];let a=0;const o=new Uint8Array(20);let l;switch(o[a++]=i,i){case we.CODE_START_A:l=we.CODE_CODE_A;break;case we.CODE_START_B:l=we.CODE_CODE_B;break;case we.CODE_START_C:l=we.CODE_CODE_C;break;default:throw new S}let c=!1,d=!1,u="",h=s[0],f=s[1];const p=Int32Array.from([0,0,0,0,0,0]);let g=0,x=0,y=i,b=0,w=!0,v=!1,A=!1;for(;!c;){const e=d;switch(d=!1,g=x,x=we.decodeCode(t,p,f),o[a++]=x,x!==we.CODE_STOP&&(w=!0),x!==we.CODE_STOP&&(b++,y+=b*x),h=f,f+=p.reduce((e,t)=>e+t,0),x){case we.CODE_START_A:case we.CODE_START_B:case we.CODE_START_C:throw new S}switch(l){case we.CODE_CODE_A:if(x<64)u+=A===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),A=!1;else if(x<96)u+=A===v?String.fromCharCode(x-64):String.fromCharCode(x+64),A=!1;else switch(x!==we.CODE_STOP&&(w=!1),x){case we.CODE_FNC_1:r&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case we.CODE_FNC_2:case we.CODE_FNC_3:break;case we.CODE_FNC_4_A:!v&&A?(v=!0,A=!1):v&&A?(v=!1,A=!1):A=!0;break;case we.CODE_SHIFT:d=!0,l=we.CODE_CODE_B;break;case we.CODE_CODE_B:l=we.CODE_CODE_B;break;case we.CODE_CODE_C:l=we.CODE_CODE_C;break;case we.CODE_STOP:c=!0}break;case we.CODE_CODE_B:if(x<96)u+=A===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),A=!1;else switch(x!==we.CODE_STOP&&(w=!1),x){case we.CODE_FNC_1:r&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case we.CODE_FNC_2:case we.CODE_FNC_3:break;case we.CODE_FNC_4_B:!v&&A?(v=!0,A=!1):v&&A?(v=!1,A=!1):A=!0;break;case we.CODE_SHIFT:d=!0,l=we.CODE_CODE_A;break;case we.CODE_CODE_A:l=we.CODE_CODE_A;break;case we.CODE_CODE_C:l=we.CODE_CODE_C;break;case we.CODE_STOP:c=!0}break;case we.CODE_CODE_C:if(x<100)x<10&&(u+="0"),u+=x;else switch(x!==we.CODE_STOP&&(w=!1),x){case we.CODE_FNC_1:r&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case we.CODE_CODE_A:l=we.CODE_CODE_A;break;case we.CODE_CODE_B:l=we.CODE_CODE_B;break;case we.CODE_STOP:c=!0}}e&&(l=l===we.CODE_CODE_A?we.CODE_CODE_B:we.CODE_CODE_A)}const _=f-h;if(f=t.getNextUnset(f),!t.isRange(f,Math.min(t.getSize(),f+(f-h)/2),!1))throw new j;if(y-=b*g,y%103!==g)throw new m;const C=u.length;if(0===C)throw new j;C>0&&w&&(u=l===we.CODE_CODE_C?u.substring(0,C-2):u.substring(0,C-1));const I=(s[1]+s[0])/2,E=h+_/2,T=o.length,k=new Uint8Array(T);for(let m=0;m<T;m++)k[m]=o[m];const D=[new oe(I,e),new oe(E,e)];return new U(u,k,0,D,q.CODE_128,(new Date).getTime())}}we.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],we.MAX_AVG_VARIANCE=.25,we.MAX_INDIVIDUAL_VARIANCE=.7,we.CODE_SHIFT=98,we.CODE_CODE_C=99,we.CODE_CODE_B=100,we.CODE_CODE_A=101,we.CODE_FNC_1=102,we.CODE_FNC_2=97,we.CODE_FNC_3=96,we.CODE_FNC_4_A=101,we.CODE_FNC_4_B=100,we.CODE_START_A=103,we.CODE_START_B=104,we.CODE_START_C=105,we.CODE_STOP=106;class ve extends be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,n){let r=this.counters;r.fill(0),this.decodeRowResult="";let s,i,a=ve.findAsteriskPattern(t,r),o=t.getNextSet(a[1]),l=t.getSize();do{ve.recordPattern(t,o,r);let e=ve.toNarrowWidePattern(r);if(e<0)throw new j;s=ve.patternToChar(e),this.decodeRowResult+=s,i=o;for(let t of r)o+=t;o=t.getNextSet(o)}while("*"!==s);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let c,d=0;for(let m of r)d+=m;if(o!==l&&2*(o-i-d)<d)throw new j;if(this.usingCheckDigit){let e=this.decodeRowResult.length-1,t=0;for(let n=0;n<e;n++)t+=ve.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(n));if(this.decodeRowResult.charAt(e)!==ve.ALPHABET_STRING.charAt(t%43))throw new m;this.decodeRowResult=this.decodeRowResult.substring(0,e)}if(0===this.decodeRowResult.length)throw new j;c=this.extendedMode?ve.decodeExtended(this.decodeRowResult):this.decodeRowResult;let u=(a[1]+a[0])/2,h=i+d/2;return new U(c,null,0,[new oe(u,e),new oe(h,e)],q.CODE_39,(new Date).getTime())}static findAsteriskPattern(e,t){let n=e.getSize(),r=e.getNextSet(0),s=0,i=r,a=!1,o=t.length;for(let l=r;l<n;l++)if(e.get(l)!==a)t[s]++;else{if(s===o-1){if(this.toNarrowWidePattern(t)===ve.ASTERISK_ENCODING&&e.isRange(Math.max(0,i-Math.floor((l-i)/2)),i,!1))return[i,l];i+=t[0]+t[1],t.copyWithin(0,2,2+s-1),t[s-1]=0,t[s]=0,s--}else s++;t[s]=1,a=!a}throw new j}static toNarrowWidePattern(e){let t,n=e.length,r=0;do{let s=2147483647;for(let t of e)t<s&&t>r&&(s=t);r=s,t=0;let i=0,a=0;for(let o=0;o<n;o++){let s=e[o];s>r&&(a|=1<<n-1-o,t++,i+=s)}if(3===t){for(let s=0;s<n&&t>0;s++){let n=e[s];if(n>r&&(t--,2*n>=i))return-1}return a}}while(t>3);return-1}static patternToChar(e){for(let t=0;t<ve.CHARACTER_ENCODINGS.length;t++)if(ve.CHARACTER_ENCODINGS[t]===e)return ve.ALPHABET_STRING.charAt(t);if(e===ve.ASTERISK_ENCODING)return"*";throw new j}static decodeExtended(e){let t=e.length,n="";for(let r=0;r<t;r++){let t=e.charAt(r);if("+"===t||"$"===t||"%"===t||"/"===t){let s=e.charAt(r+1),i="\0";switch(t){case"+":if(!(s>="A"&&s<="Z"))throw new S;i=String.fromCharCode(s.charCodeAt(0)+32);break;case"$":if(!(s>="A"&&s<="Z"))throw new S;i=String.fromCharCode(s.charCodeAt(0)-64);break;case"%":if(s>="A"&&s<="E")i=String.fromCharCode(s.charCodeAt(0)-38);else if(s>="F"&&s<="J")i=String.fromCharCode(s.charCodeAt(0)-11);else if(s>="K"&&s<="O")i=String.fromCharCode(s.charCodeAt(0)+16);else if(s>="P"&&s<="T")i=String.fromCharCode(s.charCodeAt(0)+43);else if("U"===s)i="\0";else if("V"===s)i="@";else if("W"===s)i="`";else{if("X"!==s&&"Y"!==s&&"Z"!==s)throw new S;i="\x7f"}break;case"/":if(s>="A"&&s<="O")i=String.fromCharCode(s.charCodeAt(0)-32);else{if("Z"!==s)throw new S;i=":"}}n+=i,r++}else n+=t}return n}}ve.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",ve.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],ve.ASTERISK_ENCODING=148;class Ne extends be{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,n){let r=this.decodeStart(t),s=this.decodeEnd(t),i=new E;Ne.decodeMiddle(t,r[1],s[0],i);let a=i.toString(),o=null;null!=n&&(o=n.get(N.ALLOWED_LENGTHS)),null==o&&(o=Ne.DEFAULT_ALLOWED_LENGTHS);let l=a.length,c=!1,d=0;for(let h of o){if(l===h){c=!0;break}h>d&&(d=h)}if(!c&&l>d&&(c=!0),!c)throw new S;const u=[new oe(r[1],e),new oe(s[0],e)];return new U(a,null,0,u,q.ITF,(new Date).getTime())}static decodeMiddle(e,t,n,r){let s=new Int32Array(10),i=new Int32Array(5),a=new Int32Array(5);for(s.fill(0),i.fill(0),a.fill(0);t<n;){be.recordPattern(e,t,s);for(let e=0;e<5;e++){let t=2*e;i[e]=s[t],a[e]=s[t+1]}let n=Ne.decodeDigit(i);r.append(n.toString()),n=this.decodeDigit(a),r.append(n.toString()),s.forEach(function(e){t+=e})}}decodeStart(e){let t=Ne.skipWhiteSpace(e),n=Ne.findGuardPattern(e,t,Ne.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(e,n[0]),n}validateQuietZone(e,t){let n=10*this.narrowLineWidth;n=n<t?n:t;for(let r=t-1;n>0&&r>=0&&!e.get(r);r--)n--;if(0!==n)throw new j}static skipWhiteSpace(e){const t=e.getSize(),n=e.getNextSet(0);if(n===t)throw new j;return n}decodeEnd(e){e.reverse();try{let n,r=Ne.skipWhiteSpace(e);try{n=Ne.findGuardPattern(e,r,Ne.END_PATTERN_REVERSED[0])}catch(t){t instanceof j&&(n=Ne.findGuardPattern(e,r,Ne.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,n[0]);let s=n[0];return n[0]=e.getSize()-n[1],n[1]=e.getSize()-s,n}finally{e.reverse()}}static findGuardPattern(e,t,n){let r=n.length,s=new Int32Array(r),i=e.getSize(),a=!1,o=0,l=t;s.fill(0);for(let c=t;c<i;c++)if(e.get(c)!==a)s[o]++;else{if(o===r-1){if(be.patternMatchVariance(s,n,Ne.MAX_INDIVIDUAL_VARIANCE)<Ne.MAX_AVG_VARIANCE)return[l,c];l+=s[0]+s[1],p.arraycopy(s,2,s,0,o-1),s[o-1]=0,s[o]=0,o--}else o++;s[o]=1,a=!a}throw new j}static decodeDigit(e){let t=Ne.MAX_AVG_VARIANCE,n=-1,r=Ne.PATTERNS.length;for(let s=0;s<r;s++){let r=Ne.PATTERNS[s],i=be.patternMatchVariance(e,r,Ne.MAX_INDIVIDUAL_VARIANCE);i<t?(t=i,n=s):i===t&&(n=-1)}if(n>=0)return n%10;throw new j}}Ne.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Ne.MAX_AVG_VARIANCE=.38,Ne.MAX_INDIVIDUAL_VARIANCE=.5,Ne.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Ne.START_PATTERN=Int32Array.from([1,1,1,1]),Ne.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Se extends be{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t,n=!1,r=0,s=Int32Array.from([0,0,0]);for(;!n;){s=Int32Array.from([0,0,0]),t=Se.findGuardPattern(e,r,!1,this.START_END_PATTERN,s);let i=t[0];r=t[1];let a=i-(r-i);a>=0&&(n=e.isRange(a,i,!1))}return t}static checkChecksum(e){return Se.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let n=parseInt(e.charAt(t-1),10);return Se.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let r=t-1;r>=0;r-=2){let t=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}n*=3;for(let r=t-2;r>=0;r-=2){let t=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}return(1e3-n)%10}static decodeEnd(e,t){return Se.findGuardPattern(e,t,!1,Se.START_END_PATTERN,new Int32Array(Se.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,n,r){return this.findGuardPattern(e,t,n,r,new Int32Array(r.length))}static findGuardPattern(e,t,n,r,s){let i=e.getSize(),a=0,o=t=n?e.getNextUnset(t):e.getNextSet(t),l=r.length,c=n;for(let d=t;d<i;d++)if(e.get(d)!==c)s[a]++;else{if(a===l-1){if(be.patternMatchVariance(s,r,Se.MAX_INDIVIDUAL_VARIANCE)<Se.MAX_AVG_VARIANCE)return Int32Array.from([o,d]);o+=s[0]+s[1];let e=s.slice(2,s.length-1);for(let t=0;t<a-1;t++)s[t]=e[t];s[a-1]=0,s[a]=0,a--}else a++;s[a]=1,c=!c}throw new j}static decodeDigit(e,t,n,r){this.recordPattern(e,n,t);let s=this.MAX_AVG_VARIANCE,i=-1,a=r.length;for(let o=0;o<a;o++){let e=r[o],n=be.patternMatchVariance(t,e,Se.MAX_INDIVIDUAL_VARIANCE);n<s&&(s=n,i=o)}if(i>=0)return i;throw new j}}Se.MAX_AVG_VARIANCE=.48,Se.MAX_INDIVIDUAL_VARIANCE=.7,Se.START_END_PATTERN=Int32Array.from([1,1,1]),Se.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Se.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Se.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Ae{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let r=this.decodeRowStringBuffer,s=this.decodeMiddle(t,n,r),i=r.toString(),a=Ae.parseExtensionString(i),o=[new oe((n[0]+n[1])/2,e),new oe(s,e)],l=new U(i,null,0,o,q.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s=e.getSize(),i=t[1],a=0;for(let l=0;l<5&&i<s;l++){let t=Se.decodeDigit(e,r,i,Se.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of r)i+=e;t>=10&&(a|=1<<4-l),4!==l&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(5!==n.length)throw new j;let o=this.determineCheckDigit(a);if(Ae.extensionChecksum(n.toString())!==o)throw new j;return i}static extensionChecksum(e){let t=e.length,n=0;for(let r=t-2;r>=0;r-=2)n+=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);n*=3;for(let r=t-1;r>=0;r-=2)n+=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);return n*=3,n%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new j}static parseExtensionString(e){if(5!==e.length)return null;let t=Ae.parseExtension5String(e);return null==t?null:new Map([[Q.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="\xa3";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}let n=parseInt(e.substring(1)),r=n%100;return t+(n/100).toString()+"."+(r<10?"0"+r:r.toString())}}class _e{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let r=this.decodeRowStringBuffer,s=this.decodeMiddle(t,n,r),i=r.toString(),a=_e.parseExtensionString(i),o=[new oe((n[0]+n[1])/2,e),new oe(s,e)],l=new U(i,null,0,o,q.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s=e.getSize(),i=t[1],a=0;for(let o=0;o<2&&i<s;o++){let t=Se.decodeDigit(e,r,i,Se.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of r)i+=e;t>=10&&(a|=1<<1-o),1!==o&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(2!==n.length)throw new j;if(parseInt(n.toString())%4!==a)throw new j;return i}static parseExtensionString(e){return 2!==e.length?null:new Map([[Q.ISSUE_NUMBER,parseInt(e)]])}}class Ce{static decodeRow(e,t,n){let r=Se.findGuardPattern(t,n,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new Ae).decodeRow(e,t,r)}catch(s){return(new _e).decodeRow(e,t,r)}}}Ce.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Ie extends Se{constructor(){super(),this.decodeRowStringBuffer="",Ie.L_AND_G_PATTERNS=Ie.L_PATTERNS.map(e=>Int32Array.from(e));for(let e=10;e<20;e++){let t=Ie.L_PATTERNS[e-10],n=new Int32Array(t.length);for(let e=0;e<t.length;e++)n[e]=t[t.length-e-1];Ie.L_AND_G_PATTERNS[e]=n}}decodeRow(e,t,n){let r=Ie.findStartGuardPattern(t),s=null==n?null:n.get(N.NEED_RESULT_POINT_CALLBACK);if(null!=s){const t=new oe((r[0]+r[1])/2,e);s.foundPossibleResultPoint(t)}let i=this.decodeMiddle(t,r,this.decodeRowStringBuffer),a=i.rowOffset,o=i.resultString;if(null!=s){const t=new oe(a,e);s.foundPossibleResultPoint(t)}let l=this.decodeEnd(t,a);if(null!=s){const t=new oe((l[0]+l[1])/2,e);s.foundPossibleResultPoint(t)}let c=l[1],d=c+(c-l[0]);if(d>=t.getSize()||!t.isRange(c,d,!1))throw new j;let u=o.toString();if(u.length<8)throw new S;if(!Ie.checkChecksum(u))throw new m;let h=(r[1]+r[0])/2,f=(l[1]+l[0])/2,p=this.getBarcodeFormat(),g=[new oe(h,e),new oe(f,e)],x=new U(u,null,0,g,p,(new Date).getTime()),y=0;try{let n=Ce.decodeRow(e,t,l[1]);x.putMetadata(Q.UPC_EAN_EXTENSION,n.getText()),x.putAllMetadata(n.getResultMetadata()),x.addResultPoints(n.getResultPoints()),y=n.getText().length}catch(w){}let b=null==n?null:n.get(N.ALLOWED_EAN_EXTENSIONS);if(null!=b){let e=!1;for(let t in b)if(y.toString()===t){e=!0;break}if(!e)throw new j}return x}decodeEnd(e,t){return Ie.findGuardPattern(e,t,!1,Ie.START_END_PATTERN,new Int32Array(Ie.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return Ie.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let n=parseInt(e.charAt(t-1),10);return Ie.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let r=t-1;r>=0;r-=2){let t=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}n*=3;for(let r=t-2;r>=0;r-=2){let t=e.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}return(1e3-n)%10}}class Ee extends Ie{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s=e.getSize(),i=t[1],a=0;for(let o=0;o<6&&i<s;o++){let t=Ie.decodeDigit(e,r,i,Ie.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of r)i+=e;t>=10&&(a|=1<<5-o)}n=Ee.determineFirstDigit(n,a),i=Ie.findGuardPattern(e,i,!0,Ie.MIDDLE_PATTERN,new Int32Array(Ie.MIDDLE_PATTERN.length).fill(0))[1];for(let o=0;o<6&&i<s;o++){let t=Ie.decodeDigit(e,r,i,Ie.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of r)i+=e}return{rowOffset:i,resultString:n}}getBarcodeFormat(){return q.EAN_13}static determineFirstDigit(e,t){for(let n=0;n<10;n++)if(t===this.FIRST_DIGIT_ENCODINGS[n])return e=String.fromCharCode("0".charCodeAt(0)+n)+e;throw new j}}Ee.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Te extends Ie{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){const r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s=e.getSize(),i=t[1];for(let a=0;a<4&&i<s;a++){let t=Ie.decodeDigit(e,r,i,Ie.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of r)i+=e}i=Ie.findGuardPattern(e,i,!0,Ie.MIDDLE_PATTERN,new Int32Array(Ie.MIDDLE_PATTERN.length).fill(0))[1];for(let a=0;a<4&&i<s;a++){let t=Ie.decodeDigit(e,r,i,Ie.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of r)i+=e}return{rowOffset:i,resultString:n}}getBarcodeFormat(){return q.EAN_8}}class je extends Ie{constructor(){super(...arguments),this.ean13Reader=new Ee}getBarcodeFormat(){return q.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,n){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,n))}decodeMiddle(e,t,n){return this.ean13Reader.decodeMiddle(e,t,n)}maybeReturnResult(e){let t=e.getText();if("0"===t.charAt(0)){let n=new U(t.substring(1),null,null,e.getResultPoints(),q.UPC_A);return null!=e.getResultMetadata()&&n.putAllMetadata(e.getResultMetadata()),n}throw new j}reset(){this.ean13Reader.reset()}}class ke extends Ie{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,n){const r=this.decodeMiddleCounters.map(e=>e);r[0]=0,r[1]=0,r[2]=0,r[3]=0;const s=e.getSize();let i=t[1],a=0;for(let o=0;o<6&&i<s;o++){const t=ke.decodeDigit(e,r,i,ke.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of r)i+=e;t>=10&&(a|=1<<5-o)}return{rowOffset:i,resultString:ke.determineNumSysAndCheckDigit(n,a)}}decodeEnd(e,t){return ke.findGuardPatternWithoutCounters(e,t,!0,ke.MIDDLE_END_PATTERN)}checkChecksum(e){return Ie.checkChecksum(ke.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let n=0;n<=1;n++)for(let r=0;r<10;r++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[n][r])return String.fromCharCode("0".charCodeAt(0)+n)+e+String.fromCharCode("0".charCodeAt(0)+r);throw j.getNotFoundInstance()}getBarcodeFormat(){return q.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map(e=>e.charCodeAt(0)),n=new E;n.append(e.charAt(0));let r=t[5];switch(r){case 0:case 1:case 2:n.appendChars(t,0,2),n.append(r),n.append("0000"),n.appendChars(t,2,3);break;case 3:n.appendChars(t,0,3),n.append("00000"),n.appendChars(t,3,2);break;case 4:n.appendChars(t,0,4),n.append("00000"),n.append(t[4]);break;default:n.appendChars(t,0,5),n.append("0000"),n.append(r)}return e.length>=8&&n.append(e.charAt(7)),n.toString()}}ke.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ke.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class De extends be{constructor(e){super();let n=null==e?null:e.get(N.POSSIBLE_FORMATS),r=[];t(n)?(r.push(new Ee),r.push(new je),r.push(new Te),r.push(new ke)):(n.indexOf(q.EAN_13)>-1&&r.push(new Ee),n.indexOf(q.UPC_A)>-1&&r.push(new je),n.indexOf(q.EAN_8)>-1&&r.push(new Te),n.indexOf(q.UPC_E)>-1&&r.push(new ke)),this.readers=r}decodeRow(e,t,n){for(let s of this.readers)try{const r=s.decodeRow(e,t,n),i=r.getBarcodeFormat()===q.EAN_13&&"0"===r.getText().charAt(0),a=null==n?null:n.get(N.POSSIBLE_FORMATS),o=null==a||a.includes(q.UPC_A);if(i&&o){const e=r.getRawBytes(),t=new U(r.getText().substring(1),e,e?e.length:null,r.getResultPoints(),q.UPC_A);return t.putAllMetadata(r.getResultMetadata()),t}return r}catch(r){}throw new j}reset(){for(let e of this.readers)e.reset()}}class Pe extends be{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let n=0;n<t.length;n++)if(be.patternMatchVariance(e,t[n],Pe.MAX_INDIVIDUAL_VARIANCE)<Pe.MAX_AVG_VARIANCE)return n;throw new j}static count(e){return ie.sum(new Int32Array(e))}static increment(e,t){let n=0,r=t[0];for(let s=1;s<e.length;s++)t[s]>r&&(r=t[s],n=s);e[n]++}static decrement(e,t){let n=0,r=t[0];for(let s=1;s<e.length;s++)t[s]<r&&(r=t[s],n=s);e[n]--}static isFinderPattern(e){let t=e[0]+e[1],n=t/(t+e[2]+e[3]);if(n>=Pe.MIN_FINDER_PATTERN_RATIO&&n<=Pe.MAX_FINDER_PATTERN_RATIO){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let r of e)r>n&&(n=r),r<t&&(t=r);return n<10*t}return!1}}Pe.MAX_AVG_VARIANCE=.2,Pe.MAX_INDIVIDUAL_VARIANCE=.45,Pe.MIN_FINDER_PATTERN_RATIO=9.5/12,Pe.MAX_FINDER_PATTERN_RATIO=12.5/14;class Re{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof Re))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Oe{constructor(e,t,n,r,s){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new oe(n,s)),this.resultPoints.push(new oe(r,s))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Oe))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class Le{constructor(){}static getRSSvalue(e,t,n){let r=0;for(let o of e)r+=o;let s=0,i=0,a=e.length;for(let o=0;o<a-1;o++){let l;for(l=1,i|=1<<o;l<e[o];l++,i&=~(1<<o)){let e=Le.combins(r-l-1,a-o-2);if(n&&0===i&&r-l-(a-o-1)>=a-o-1&&(e-=Le.combins(r-l-(a-o),a-o-2)),a-o-1>1){let n=0;for(let e=r-l-(a-o-2);e>t;e--)n+=Le.combins(r-l-e-1,a-o-3);e-=n*(a-1-o)}else r-l>t&&e--;s+=e}r-=l}return s}static combins(e,t){let n,r;e-t>t?(r=t,n=e-t):(r=e-t,n=t);let s=1,i=1;for(let a=e;a>n;a--)s*=a,i<=r&&(s/=i,i++);for(;i<=r;)s/=i,i++;return s}}class Me{static buildBitArray(e){let t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);let n=new w(12*t),r=0,s=e[0].getRightChar().getValue();for(let i=11;i>=0;--i)0!=(s&1<<i)&&n.set(r),r++;for(let i=1;i<e.length;++i){let t=e[i],s=t.getLeftChar().getValue();for(let e=11;e>=0;--e)0!=(s&1<<e)&&n.set(r),r++;if(null!=t.getRightChar()){let e=t.getRightChar().getValue();for(let t=11;t>=0;--t)0!=(e&1<<t)&&n.set(r),r++}}return n}}class Fe{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Be{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class Ue extends Be{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===Ue.FNC1}}Ue.FNC1="$";class ze extends Be{constructor(e,t,n){super(e),n?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class qe extends Be{constructor(e,t,n){if(super(e),t<0||t>10||n<0||n>10)throw new S;this.firstDigit=t,this.secondDigit=n}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===qe.FNC1}isSecondDigitFNC1(){return this.secondDigit===qe.FNC1}isAnyFNC1(){return this.firstDigit===qe.FNC1||this.secondDigit===qe.FNC1}}qe.FNC1=10;class He{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new j;let t=e.substring(0,2);for(let s of He.TWO_DIGIT_DATA_LENGTH)if(s[0]===t)return s[1]===He.VARIABLE_LENGTH?He.processVariableAI(2,s[2],e):He.processFixedAI(2,s[1],e);if(e.length<3)throw new j;let n=e.substring(0,3);for(let s of He.THREE_DIGIT_DATA_LENGTH)if(s[0]===n)return s[1]===He.VARIABLE_LENGTH?He.processVariableAI(3,s[2],e):He.processFixedAI(3,s[1],e);for(let s of He.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(s[0]===n)return s[1]===He.VARIABLE_LENGTH?He.processVariableAI(4,s[2],e):He.processFixedAI(4,s[1],e);if(e.length<4)throw new j;let r=e.substring(0,4);for(let s of He.FOUR_DIGIT_DATA_LENGTH)if(s[0]===r)return s[1]===He.VARIABLE_LENGTH?He.processVariableAI(4,s[2],e):He.processFixedAI(4,s[1],e);throw new j}static processFixedAI(e,t,n){if(n.length<e)throw new j;let r=n.substring(0,e);if(n.length<e+t)throw new j;let s=n.substring(e,e+t),i=n.substring(e+t),a="("+r+")"+s,o=He.parseFieldsInGeneralPurpose(i);return null==o?a:a+o}static processVariableAI(e,t,n){let r,s=n.substring(0,e);r=n.length<e+t?n.length:e+t;let i=n.substring(e,r),a=n.substring(r),o="("+s+")"+i,l=He.parseFieldsInGeneralPurpose(a);return null==l?o:o+l}}He.VARIABLE_LENGTH=[],He.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",He.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",He.VARIABLE_LENGTH,20],["22",He.VARIABLE_LENGTH,29],["30",He.VARIABLE_LENGTH,8],["37",He.VARIABLE_LENGTH,8],["90",He.VARIABLE_LENGTH,30],["91",He.VARIABLE_LENGTH,30],["92",He.VARIABLE_LENGTH,30],["93",He.VARIABLE_LENGTH,30],["94",He.VARIABLE_LENGTH,30],["95",He.VARIABLE_LENGTH,30],["96",He.VARIABLE_LENGTH,30],["97",He.VARIABLE_LENGTH,3],["98",He.VARIABLE_LENGTH,30],["99",He.VARIABLE_LENGTH,30]],He.THREE_DIGIT_DATA_LENGTH=[["240",He.VARIABLE_LENGTH,30],["241",He.VARIABLE_LENGTH,30],["242",He.VARIABLE_LENGTH,6],["250",He.VARIABLE_LENGTH,30],["251",He.VARIABLE_LENGTH,30],["253",He.VARIABLE_LENGTH,17],["254",He.VARIABLE_LENGTH,20],["400",He.VARIABLE_LENGTH,30],["401",He.VARIABLE_LENGTH,30],["402",17],["403",He.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",He.VARIABLE_LENGTH,20],["421",He.VARIABLE_LENGTH,15],["422",3],["423",He.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],He.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",He.VARIABLE_LENGTH,15],["391",He.VARIABLE_LENGTH,18],["392",He.VARIABLE_LENGTH,15],["393",He.VARIABLE_LENGTH,18],["703",He.VARIABLE_LENGTH,30]],He.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",He.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",He.VARIABLE_LENGTH,20],["8003",He.VARIABLE_LENGTH,30],["8004",He.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",He.VARIABLE_LENGTH,30],["8008",He.VARIABLE_LENGTH,12],["8018",18],["8020",He.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",He.VARIABLE_LENGTH,70],["8200",He.VARIABLE_LENGTH,70]];class Ve{constructor(e){this.buffer=new E,this.information=e}decodeAllCodes(e,t){let n=t,r=null;for(;;){let t=this.decodeGeneralPurposeField(n,r),s=He.parseFieldsInGeneralPurpose(t.getNewString());if(null!=s&&e.append(s),r=t.isRemaining()?""+t.getRemainingValue():null,n===t.getNewPosition())break;n=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return new qe(this.information.getSize(),0===t?qe.FNC1:t-1,qe.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new qe(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return Ve.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,n){let r=0;for(let s=0;s<n;++s)e.get(t+s)&&(r|=1<<n-s-1);return r}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let n=this.parseBlocks();return null!=n&&n.isRemaining()?new ze(this.current.getPosition(),this.buffer.toString(),n.getRemainingValue()):new ze(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let n=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),n===this.current.getPosition()&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return t=e.isSecondDigitFNC1()?new ze(this.current.getPosition(),this.buffer.toString()):new ze(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new Fe(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let e=new ze(this.current.getPosition(),this.buffer.toString());return new Fe(!0,e)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Fe(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new ze(this.current.getPosition(),this.buffer.toString());return new Fe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Fe(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new ze(this.current.getPosition(),this.buffer.toString());return new Fe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Fe(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<116)return!0;if(e+8>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,8);return r>=232&&r<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Ue(e+5,Ue.FNC1);if(t>=5&&t<15)return new Ue(e+5,"0"+(t-5));let n,r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<90)return new Ue(e+7,""+(r+1));if(r>=90&&r<116)return new Ue(e+7,""+(r+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:n="!";break;case 233:n='"';break;case 234:n="%";break;case 235:n="&";break;case 236:n="'";break;case 237:n="(";break;case 238:n=")";break;case 239:n="*";break;case 240:n="+";break;case 241:n=",";break;case 242:n="-";break;case 243:n=".";break;case 244:n="/";break;case 245:n=":";break;case 246:n=";";break;case 247:n="<";break;case 248:n="=";break;case 249:n=">";break;case 250:n="?";break;case 251:n="_";break;case 252:n=" ";break;default:throw new S}return new Ue(e+8,n)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,6);return n>=16&&n<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Ue(e+5,Ue.FNC1);if(t>=5&&t<15)return new Ue(e+5,"0"+(t-5));let n,r=this.extractNumericValueFromBitArray(e,6);if(r>=32&&r<58)return new Ue(e+6,""+(r+33));switch(r){case 58:n="*";break;case 59:n=",";break;case 60:n="-";break;case 61:n=".";break;case 62:n="/";break;default:throw new ne("Decoding invalid alphanumeric value: "+r)}return new Ue(e+6,n)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class We{constructor(e){this.information=e,this.generalDecoder=new Ve(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Ge extends We{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let n=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,n)}encodeCompressedGtinWithoutAI(e,t,n){for(let r=0;r<4;++r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*r,10);n/100===0&&e.append("0"),n/10===0&&e.append("0"),e.append(n)}Ge.appendCheckDigit(e,n)}static appendCheckDigit(e,t){let n=0;for(let r=0;r<13;r++){let s=e.charAt(r+t).charCodeAt(0)-"0".charCodeAt(0);n+=0===(1&r)?3*s:s}n=10-n%10,10===n&&(n=0),e.append(n)}}Ge.GTIN_SIZE=40;class Ye extends Ge{constructor(e){super(e)}parseInformation(){let e=new E;e.append("(01)");let t=e.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(Ye.HEADER_SIZE,4);return e.append(n),this.encodeCompressedGtinWithoutAI(e,Ye.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,Ye.HEADER_SIZE+44)}}Ye.HEADER_SIZE=4;class Xe extends We{constructor(e){super(e)}parseInformation(){let e=new E;return this.getGeneralDecoder().decodeAllCodes(e,Xe.HEADER_SIZE)}}Xe.HEADER_SIZE=5;class Qe extends Ge{constructor(e){super(e)}encodeCompressedWeight(e,t,n){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,n);this.addWeightCode(e,r);let s=this.checkWeight(r),i=1e5;for(let a=0;a<5;++a)s/i===0&&e.append("0"),i/=10;e.append(s)}}class Ke extends Qe{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=Ke.HEADER_SIZE+Qe.GTIN_SIZE+Ke.WEIGHT_SIZE)throw new j;let e=new E;return this.encodeCompressedGtin(e,Ke.HEADER_SIZE),this.encodeCompressedWeight(e,Ke.HEADER_SIZE+Qe.GTIN_SIZE,Ke.WEIGHT_SIZE),e.toString()}}Ke.HEADER_SIZE=5,Ke.WEIGHT_SIZE=15;class Ze extends Ke{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class Je extends Ke{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class $e extends Ge{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<$e.HEADER_SIZE+Ge.GTIN_SIZE)throw new j;let e=new E;this.encodeCompressedGtin(e,$e.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray($e.HEADER_SIZE+Ge.GTIN_SIZE,$e.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let n=this.getGeneralDecoder().decodeGeneralPurposeField($e.HEADER_SIZE+Ge.GTIN_SIZE+$e.LAST_DIGIT_SIZE,null);return e.append(n.getNewString()),e.toString()}}$e.HEADER_SIZE=8,$e.LAST_DIGIT_SIZE=2;class et extends Ge{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<et.HEADER_SIZE+Ge.GTIN_SIZE)throw new j;let e=new E;this.encodeCompressedGtin(e,et.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(et.HEADER_SIZE+Ge.GTIN_SIZE,et.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let n=this.getGeneralDecoder().extractNumericValueFromBitArray(et.HEADER_SIZE+Ge.GTIN_SIZE+et.LAST_DIGIT_SIZE,et.FIRST_THREE_DIGITS_SIZE);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n);let r=this.getGeneralDecoder().decodeGeneralPurposeField(et.HEADER_SIZE+Ge.GTIN_SIZE+et.LAST_DIGIT_SIZE+et.FIRST_THREE_DIGITS_SIZE,null);return e.append(r.getNewString()),e.toString()}}et.HEADER_SIZE=8,et.LAST_DIGIT_SIZE=2,et.FIRST_THREE_DIGITS_SIZE=10;class tt extends Qe{constructor(e,t,n){super(e),this.dateCode=n,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=tt.HEADER_SIZE+tt.GTIN_SIZE+tt.WEIGHT_SIZE+tt.DATE_SIZE)throw new j;let e=new E;return this.encodeCompressedGtin(e,tt.HEADER_SIZE),this.encodeCompressedWeight(e,tt.HEADER_SIZE+tt.GTIN_SIZE,tt.WEIGHT_SIZE),this.encodeCompressedDate(e,tt.HEADER_SIZE+tt.GTIN_SIZE+tt.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,tt.DATE_SIZE);if(38400==n)return;e.append("("),e.append(this.dateCode),e.append(")");let r=n%32;n/=32;let s=n%12+1;n/=12;let i=n;i/10==0&&e.append("0"),e.append(i),s/10==0&&e.append("0"),e.append(s),r/10==0&&e.append("0"),e.append(r)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}function nt(e){try{if(e.get(1))return new Ye(e);if(!e.get(2))return new Xe(e);switch(Ve.extractNumericValueFromBitArray(e,1,4)){case 4:return new Ze(e);case 5:return new Je(e)}switch(Ve.extractNumericValueFromBitArray(e,1,5)){case 12:return new $e(e);case 13:return new et(e)}switch(Ve.extractNumericValueFromBitArray(e,1,7)){case 56:return new tt(e,"310","11");case 57:return new tt(e,"320","11");case 58:return new tt(e,"310","13");case 59:return new tt(e,"320","13");case 60:return new tt(e,"310","15");case 61:return new tt(e,"320","15");case 62:return new tt(e,"310","17");case 63:return new tt(e,"320","17")}}catch(t){throw console.log(t),new ne("unknown decoder: "+e)}}tt.HEADER_SIZE=8,tt.WEIGHT_SIZE=20,tt.DATE_SIZE=16;class rt{constructor(e,t,n,r){this.leftchar=e,this.rightchar=t,this.finderpattern=n,this.maybeLast=r}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof rt&&rt.equalsOrNull(e.leftchar,t.leftchar)&&rt.equalsOrNull(e.rightchar,t.rightchar)&&rt.equalsOrNull(e.finderpattern,t.finderpattern)}static equalsOrNull(e,t){return null===e?null===t:rt.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class st{constructor(e,t,n){this.pairs=e,this.rowNumber=t,this.wasReversed=n}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof st&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed}checkEqualitity(e,t){if(!e||!t)return;let n;return e.forEach((e,r)=>{t.forEach(t=>{e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(n=!0)})}),n}}class it extends Pe{constructor(e){super(...arguments),this.pairs=new Array(it.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===e}decodeRow(e,t,n){this.pairs.length=0,this.startFromEven=!1;try{return it.constructResult(this.decodeRow2pairs(e,t))}catch(r){this.verbose&&console.log(r)}return this.pairs.length=0,this.startFromEven=!0,it.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let n,r=!1;for(;!r;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(s){if(s instanceof j){if(!this.pairs.length)throw new j;r=!0}}if(this.checkChecksum())return this.pairs;if(n=!!this.rows.length,this.storeRow(e,!1),n){let e=this.checkRowsBoolean(!1);if(null!=e)return e;if(e=this.checkRowsBoolean(!0),null!=e)return e}throw new j}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(n){this.verbose&&console.log(n)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let r=t;r<this.rows.length;r++){let t=this.rows[r];this.pairs.length=0;for(let n of e)this.pairs.push(n.getPairs());if(this.pairs.push(t.getPairs()),!it.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let s=new Array(e);s.push(t);try{return this.checkRows(s,r+1)}catch(n){this.verbose&&console.log(n)}}throw new j}static isValidSequence(e){for(let t of it.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let n=!0;for(let r=0;r<e.length;r++)if(e[r].getFinderPattern().getValue()!=t[r]){n=!1;break}if(n)return!0}return!1}storeRow(e,t){let n=0,r=!1,s=!1;for(;n<this.rows.length;){let t=this.rows[n];if(t.getRowNumber()>e){s=t.isEquivalent(this.pairs);break}r=t.isEquivalent(this.pairs),n++}s||r||it.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new st(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let n of t)if(n.getPairs().length!==e.length)for(let t of n.getPairs())for(let n of e)if(rt.equals(t,n))break}static isPartialRow(e,t){for(let n of t){let t=!0;for(let r of e){let e=!1;for(let t of n.getPairs())if(r.equals(t)){e=!0;break}if(!e){t=!1;break}}if(t)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=nt(Me.buildBitArray(e)).parseInformation(),n=e[0].getFinderPattern().getResultPoints(),r=e[e.length-1].getFinderPattern().getResultPoints(),s=[n[0],n[1],r[0],r[1]];return new U(t,null,null,s,q.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),n=e.getRightChar();if(null==n)return!1;let r=n.getChecksumPortion(),s=2;for(let i=1;i<this.pairs.size();++i){let e=this.pairs.get(i);r+=e.getLeftChar().getChecksumPortion(),s++;let t=e.getRightChar();null!=t&&(r+=t.getChecksumPortion(),s++)}return r%=211,211*(s-4)+r==t.getValue()}static getNextSecondBar(e,t){let n;return e.get(t)?(n=e.getNextUnset(t),n=e.getNextSet(n)):(n=e.getNextSet(t),n=e.getNextUnset(n)),n}retrieveNextPair(e,t,n){let r,s=t.length%2==0;this.startFromEven&&(s=!s);let i=!0,a=-1;do{this.findNextPair(e,t,a),r=this.parseFoundFinderPattern(e,n,s),null==r?a=it.getNextSecondBar(e,this.startEnd[0]):i=!1}while(i);let o,l=this.decodeDataCharacter(e,r,s,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new j;try{o=this.decodeDataCharacter(e,r,s,!1)}catch(c){o=null,this.verbose&&console.log(c)}return new rt(l,o,r,!0)}isEmptyPair(e){return 0===e.length}findNextPair(e,t,n){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s,i=e.getSize();s=n>=0?n:this.isEmptyPair(t)?0:t[t.length-1].getFinderPattern().getStartEnd()[1];let a=t.length%2!=0;this.startFromEven&&(a=!a);let o=!1;for(;s<i&&(o=!e.get(s),o);)s++;let l=0,c=s;for(let d=s;d<i;d++)if(e.get(d)!=o)r[l]++;else{if(3==l){if(a&&it.reverseCounters(r),it.isFinderPattern(r))return this.startEnd[0]=c,void(this.startEnd[1]=d);a&&it.reverseCounters(r),c+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,l--}else l++;r[l]=1,o=!o}throw new j}static reverseCounters(e){let t=e.length;for(let n=0;n<t/2;++n){let r=e[n];e[n]=e[t-n-1],e[t-n-1]=r}}parseFoundFinderPattern(e,t,n){let r,s,i;if(n){let t=this.startEnd[0]-1;for(;t>=0&&!e.get(t);)t--;t++,r=this.startEnd[0]-t,s=t,i=this.startEnd[1]}else s=this.startEnd[0],i=e.getNextUnset(this.startEnd[1]+1),r=i-this.startEnd[1];let a,o=this.getDecodeFinderCounters();p.arraycopy(o,0,o,1,o.length-1),o[0]=r;try{a=this.parseFinderValue(o,it.FINDER_PATTERNS)}catch(l){return null}return new Oe(a,[s,i],s,i,t)}decodeDataCharacter(e,t,n,r){let s=this.getDataCharacterCounters();for(let A=0;A<s.length;A++)s[A]=0;if(r)it.recordPatternInReverse(e,t.getStartEnd()[0],s);else{it.recordPattern(e,t.getStartEnd()[1],s);for(let e=0,t=s.length-1;e<t;e++,t--){let n=s[e];s[e]=s[t],s[t]=n}}let i=17,a=ie.sum(new Int32Array(s))/i,o=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(a-o)/o>.3)throw new j;let l=this.getOddCounts(),c=this.getEvenCounts(),d=this.getOddRoundingErrors(),u=this.getEvenRoundingErrors();for(let A=0;A<s.length;A++){let e=1*s[A]/a,t=e+.5;if(t<1){if(e<.3)throw new j;t=1}else if(t>8){if(e>8.7)throw new j;t=8}let n=A/2;0==(1&A)?(l[n]=t,d[n]=e-t):(c[n]=t,u[n]=e-t)}this.adjustOddEvenCounts(i);let h=4*t.getValue()+(n?0:2)+(r?0:1)-1,m=0,f=0;for(let A=l.length-1;A>=0;A--){if(it.isNotA1left(t,n,r)){let e=it.WEIGHTS[h][2*A];f+=l[A]*e}m+=l[A]}let p=0;for(let A=c.length-1;A>=0;A--)if(it.isNotA1left(t,n,r)){let e=it.WEIGHTS[h][2*A+1];p+=c[A]*e}let g=f+p;if(0!=(1&m)||m>13||m<4)throw new j;let x=(13-m)/2,y=it.SYMBOL_WIDEST[x],b=9-y,w=Le.getRSSvalue(l,y,!0),v=Le.getRSSvalue(c,b,!1),N=it.EVEN_TOTAL_SUBSET[x],S=it.GSUM[x];return new Re(w*N+v+S,g)}static isNotA1left(e,t,n){return!(0==e.getValue()&&t&&n)}adjustOddEvenCounts(e){let t=ie.sum(new Int32Array(this.getOddCounts())),n=ie.sum(new Int32Array(this.getEvenCounts())),r=!1,s=!1;t>13?s=!0:t<4&&(r=!0);let i=!1,a=!1;n>13?a=!0:n<4&&(i=!0);let o=t+n-e,l=1==(1&t),c=0==(1&n);if(1==o)if(l){if(c)throw new j;s=!0}else{if(!c)throw new j;a=!0}else if(-1==o)if(l){if(c)throw new j;r=!0}else{if(!c)throw new j;i=!0}else{if(0!=o)throw new j;if(l){if(!c)throw new j;t<n?(r=!0,a=!0):(s=!0,i=!0)}else if(c)throw new j}if(r){if(s)throw new j;it.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&it.decrement(this.getOddCounts(),this.getOddRoundingErrors()),i){if(a)throw new j;it.increment(this.getEvenCounts(),this.getOddRoundingErrors())}a&&it.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}it.SYMBOL_WIDEST=[7,5,4,3,1],it.EVEN_TOTAL_SUBSET=[4,20,52,104,204],it.GSUM=[0,348,1388,2948,3988],it.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],it.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],it.FINDER_PAT_A=0,it.FINDER_PAT_B=1,it.FINDER_PAT_C=2,it.FINDER_PAT_D=3,it.FINDER_PAT_E=4,it.FINDER_PAT_F=5,it.FINDER_PATTERN_SEQUENCES=[[it.FINDER_PAT_A,it.FINDER_PAT_A],[it.FINDER_PAT_A,it.FINDER_PAT_B,it.FINDER_PAT_B],[it.FINDER_PAT_A,it.FINDER_PAT_C,it.FINDER_PAT_B,it.FINDER_PAT_D],[it.FINDER_PAT_A,it.FINDER_PAT_E,it.FINDER_PAT_B,it.FINDER_PAT_D,it.FINDER_PAT_C],[it.FINDER_PAT_A,it.FINDER_PAT_E,it.FINDER_PAT_B,it.FINDER_PAT_D,it.FINDER_PAT_D,it.FINDER_PAT_F],[it.FINDER_PAT_A,it.FINDER_PAT_E,it.FINDER_PAT_B,it.FINDER_PAT_D,it.FINDER_PAT_E,it.FINDER_PAT_F,it.FINDER_PAT_F],[it.FINDER_PAT_A,it.FINDER_PAT_A,it.FINDER_PAT_B,it.FINDER_PAT_B,it.FINDER_PAT_C,it.FINDER_PAT_C,it.FINDER_PAT_D,it.FINDER_PAT_D],[it.FINDER_PAT_A,it.FINDER_PAT_A,it.FINDER_PAT_B,it.FINDER_PAT_B,it.FINDER_PAT_C,it.FINDER_PAT_C,it.FINDER_PAT_D,it.FINDER_PAT_E,it.FINDER_PAT_E],[it.FINDER_PAT_A,it.FINDER_PAT_A,it.FINDER_PAT_B,it.FINDER_PAT_B,it.FINDER_PAT_C,it.FINDER_PAT_C,it.FINDER_PAT_D,it.FINDER_PAT_E,it.FINDER_PAT_F,it.FINDER_PAT_F],[it.FINDER_PAT_A,it.FINDER_PAT_A,it.FINDER_PAT_B,it.FINDER_PAT_B,it.FINDER_PAT_C,it.FINDER_PAT_D,it.FINDER_PAT_D,it.FINDER_PAT_E,it.FINDER_PAT_E,it.FINDER_PAT_F,it.FINDER_PAT_F]],it.MAX_PAIRS=11;class at extends Re{constructor(e,t,n){super(e,t),this.count=0,this.finderPattern=n}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ot extends Pe{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,n){const r=this.decodePair(t,!1,e,n);ot.addOrTally(this.possibleLeftPairs,r),t.reverse();let s=this.decodePair(t,!0,e,n);ot.addOrTally(this.possibleRightPairs,s),t.reverse();for(let i of this.possibleLeftPairs)if(i.getCount()>1)for(let e of this.possibleRightPairs)if(e.getCount()>1&&ot.checkChecksum(i,e))return ot.constructResult(i,e);throw new j}static addOrTally(e,t){if(null==t)return;let n=!1;for(let r of e)if(r.getValue()===t.getValue()){r.incrementCount(),n=!0;break}n||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let n=4537077*e.getValue()+t.getValue(),r=new String(n).toString(),s=new E;for(let l=13-r.length;l>0;l--)s.append("0");s.append(r);let i=0;for(let l=0;l<13;l++){let e=s.charAt(l).charCodeAt(0)-"0".charCodeAt(0);i+=0===(1&l)?3*e:e}i=10-i%10,10===i&&(i=0),s.append(i.toString());let a=e.getFinderPattern().getResultPoints(),o=t.getFinderPattern().getResultPoints();return new U(s.toString(),null,0,[a[0],a[1],o[0],o[1]],q.RSS_14,(new Date).getTime())}static checkChecksum(e,t){let n=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,r=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return r>72&&r--,r>8&&r--,n===r}decodePair(e,t,n,r){try{let s=this.findFinderPattern(e,t),i=this.parseFoundFinderPattern(e,n,t,s),a=null==r?null:r.get(N.NEED_RESULT_POINT_CALLBACK);if(null!=a){let r=(s[0]+s[1])/2;t&&(r=e.getSize()-1-r),a.foundPossibleResultPoint(new oe(r,n))}let o=this.decodeDataCharacter(e,i,!0),l=this.decodeDataCharacter(e,i,!1);return new at(1597*o.getValue()+l.getValue(),o.getChecksumPortion()+4*l.getChecksumPortion(),i)}catch(s){return null}}decodeDataCharacter(e,t,n){let r=this.getDataCharacterCounters();for(let p=0;p<r.length;p++)r[p]=0;if(n)be.recordPatternInReverse(e,t.getStartEnd()[0],r);else{be.recordPattern(e,t.getStartEnd()[1]+1,r);for(let e=0,t=r.length-1;e<t;e++,t--){let n=r[e];r[e]=r[t],r[t]=n}}let s=n?16:15,i=ie.sum(new Int32Array(r))/s,a=this.getOddCounts(),o=this.getEvenCounts(),l=this.getOddRoundingErrors(),c=this.getEvenRoundingErrors();for(let p=0;p<r.length;p++){let e=r[p]/i,t=Math.floor(e+.5);t<1?t=1:t>8&&(t=8);let n=Math.floor(p/2);0===(1&p)?(a[n]=t,l[n]=e-t):(o[n]=t,c[n]=e-t)}this.adjustOddEvenCounts(n,s);let d=0,u=0;for(let p=a.length-1;p>=0;p--)u*=9,u+=a[p],d+=a[p];let h=0,m=0;for(let p=o.length-1;p>=0;p--)h*=9,h+=o[p],m+=o[p];let f=u+3*h;if(n){if(0!==(1&d)||d>12||d<4)throw new j;let e=(12-d)/2,t=ot.OUTSIDE_ODD_WIDEST[e],n=9-t,r=Le.getRSSvalue(a,t,!1),s=Le.getRSSvalue(o,n,!0),i=ot.OUTSIDE_EVEN_TOTAL_SUBSET[e],l=ot.OUTSIDE_GSUM[e];return new Re(r*i+s+l,f)}{if(0!==(1&m)||m>10||m<4)throw new j;let e=(10-m)/2,t=ot.INSIDE_ODD_WIDEST[e],n=9-t,r=Le.getRSSvalue(a,t,!0),s=Le.getRSSvalue(o,n,!1),i=ot.INSIDE_ODD_TOTAL_SUBSET[e],l=ot.INSIDE_GSUM[e];return new Re(s*i+r+l,f)}}findFinderPattern(e,t){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let r=e.getSize(),s=!1,i=0;for(;i<r&&(s=!e.get(i),t!==s);)i++;let a=0,o=i;for(let l=i;l<r;l++)if(e.get(l)!==s)n[a]++;else{if(3===a){if(Pe.isFinderPattern(n))return[o,l];o+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,a--}else a++;n[a]=1,s=!s}throw new j}parseFoundFinderPattern(e,t,n,r){let s=e.get(r[0]),i=r[0]-1;for(;i>=0&&s!==e.get(i);)i--;i++;const a=r[0]-i,o=this.getDecodeFinderCounters(),l=new Int32Array(o.length);p.arraycopy(o,0,l,1,o.length-1),l[0]=a;const c=this.parseFinderValue(l,ot.FINDER_PATTERNS);let d=i,u=r[1];return n&&(d=e.getSize()-1-d,u=e.getSize()-1-u),new Oe(c,[i,r[1]],d,u,t)}adjustOddEvenCounts(e,t){let n=ie.sum(new Int32Array(this.getOddCounts())),r=ie.sum(new Int32Array(this.getEvenCounts())),s=!1,i=!1,a=!1,o=!1;e?(n>12?i=!0:n<4&&(s=!0),r>12?o=!0:r<4&&(a=!0)):(n>11?i=!0:n<5&&(s=!0),r>10?o=!0:r<4&&(a=!0));let l=n+r-t,c=(1&n)===(e?1:0),d=1===(1&r);if(1===l)if(c){if(d)throw new j;i=!0}else{if(!d)throw new j;o=!0}else if(-1===l)if(c){if(d)throw new j;s=!0}else{if(!d)throw new j;a=!0}else{if(0!==l)throw new j;if(c){if(!d)throw new j;n<r?(s=!0,o=!0):(i=!0,a=!0)}else if(d)throw new j}if(s){if(i)throw new j;Pe.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&Pe.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new j;Pe.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&Pe.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ot.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ot.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ot.OUTSIDE_GSUM=[0,161,961,2015,2715],ot.INSIDE_GSUM=[0,336,1036,1516],ot.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ot.INSIDE_ODD_WIDEST=[2,4,6,8],ot.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class lt extends be{constructor(e,t){super(),this.readers=[],this.verbose=!0===t;const n=e?e.get(N.POSSIBLE_FORMATS):null,r=e&&void 0!==e.get(N.ASSUME_CODE_39_CHECK_DIGIT);n?((n.includes(q.EAN_13)||n.includes(q.UPC_A)||n.includes(q.EAN_8)||n.includes(q.UPC_E))&&this.readers.push(new De(e)),n.includes(q.CODE_39)&&this.readers.push(new ve(r)),n.includes(q.CODE_128)&&this.readers.push(new we),n.includes(q.ITF)&&this.readers.push(new Ne),n.includes(q.RSS_14)&&this.readers.push(new ot),n.includes(q.RSS_EXPANDED)&&this.readers.push(new it(this.verbose))):(this.readers.push(new De(e)),this.readers.push(new ve),this.readers.push(new De(e)),this.readers.push(new we),this.readers.push(new Ne),this.readers.push(new ot),this.readers.push(new it(this.verbose)))}decodeRow(e,t,n){for(let s=0;s<this.readers.length;s++)try{return this.readers[s].decodeRow(e,t,n)}catch(r){}throw new j}reset(){this.readers.forEach(e=>e.reset())}}class ct extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=arguments.length>1?arguments[1]:void 0;super(new lt(t),e,t)}}class dt{constructor(e,t,n){this.ecCodewords=e,this.ecBlocks=[t],n&&this.ecBlocks.push(n)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class ut{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ht{constructor(e,t,n,r,s,i){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=n,this.dataRegionSizeRows=r,this.dataRegionSizeColumns=s,this.ecBlocks=i;let a=0;const o=i.getECCodewords(),l=i.getECBlocks();for(let c of l)a+=c.getCount()*(c.getDataCodewords()+o);this.totalCodewords=a}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if(0!==(1&e)||0!==(1&t))throw new S;for(let n of ht.VERSIONS)if(n.symbolSizeRows===e&&n.symbolSizeColumns===t)return n;throw new S}toString(){return""+this.versionNumber}static buildVersions(){return[new ht(1,10,10,8,8,new dt(5,new ut(1,3))),new ht(2,12,12,10,10,new dt(7,new ut(1,5))),new ht(3,14,14,12,12,new dt(10,new ut(1,8))),new ht(4,16,16,14,14,new dt(12,new ut(1,12))),new ht(5,18,18,16,16,new dt(14,new ut(1,18))),new ht(6,20,20,18,18,new dt(18,new ut(1,22))),new ht(7,22,22,20,20,new dt(20,new ut(1,30))),new ht(8,24,24,22,22,new dt(24,new ut(1,36))),new ht(9,26,26,24,24,new dt(28,new ut(1,44))),new ht(10,32,32,14,14,new dt(36,new ut(1,62))),new ht(11,36,36,16,16,new dt(42,new ut(1,86))),new ht(12,40,40,18,18,new dt(48,new ut(1,114))),new ht(13,44,44,20,20,new dt(56,new ut(1,144))),new ht(14,48,48,22,22,new dt(68,new ut(1,174))),new ht(15,52,52,24,24,new dt(42,new ut(2,102))),new ht(16,64,64,14,14,new dt(56,new ut(2,140))),new ht(17,72,72,16,16,new dt(36,new ut(4,92))),new ht(18,80,80,18,18,new dt(48,new ut(4,114))),new ht(19,88,88,20,20,new dt(56,new ut(4,144))),new ht(20,96,96,22,22,new dt(68,new ut(4,174))),new ht(21,104,104,24,24,new dt(56,new ut(6,136))),new ht(22,120,120,18,18,new dt(68,new ut(6,175))),new ht(23,132,132,20,20,new dt(62,new ut(8,163))),new ht(24,144,144,22,22,new dt(62,new ut(8,156),new ut(2,155))),new ht(25,8,18,6,16,new dt(7,new ut(1,5))),new ht(26,8,32,6,14,new dt(11,new ut(1,10))),new ht(27,12,26,10,24,new dt(14,new ut(1,16))),new ht(28,12,36,10,16,new dt(18,new ut(1,22))),new ht(29,16,36,14,16,new dt(24,new ut(1,32))),new ht(30,16,48,14,22,new dt(28,new ut(1,49)))]}}ht.VERSIONS=ht.buildVersions();class mt{constructor(e){const t=e.getHeight();if(t<8||t>144||0!==(1&t))throw new S;this.version=mt.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new T(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),n=e.getWidth();return ht.getVersionForDimensions(t,n)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,n=4,r=0;const s=this.mappingBitMatrix.getHeight(),i=this.mappingBitMatrix.getWidth();let a=!1,o=!1,l=!1,c=!1;do{if(n!==s||0!==r||a)if(n!==s-2||0!==r||0===(3&i)||o)if(n!==s+4||2!==r||0!==(7&i)||l)if(n!==s-2||0!==r||4!==(7&i)||c){do{n<s&&r>=0&&!this.readMappingMatrix.get(r,n)&&(e[t++]=255&this.readUtah(n,r,s,i)),n-=2,r+=2}while(n>=0&&r<i);n+=1,r+=3;do{n>=0&&r<i&&!this.readMappingMatrix.get(r,n)&&(e[t++]=255&this.readUtah(n,r,s,i)),n+=2,r-=2}while(n<s&&r>=0);n+=3,r+=1}else e[t++]=255&this.readCorner4(s,i),n-=2,r+=2,c=!0;else e[t++]=255&this.readCorner3(s,i),n-=2,r+=2,l=!0;else e[t++]=255&this.readCorner2(s,i),n-=2,r+=2,o=!0;else e[t++]=255&this.readCorner1(s,i),n-=2,r+=2,a=!0}while(n<s||r<i);if(t!==this.version.getTotalCodewords())throw new S;return e}readModule(e,t,n,r){return e<0&&(e+=n,t+=4-(n+4&7)),t<0&&(t+=r,e+=4-(r+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,n,r){let s=0;return this.readModule(e-2,t-2,n,r)&&(s|=1),s<<=1,this.readModule(e-2,t-1,n,r)&&(s|=1),s<<=1,this.readModule(e-1,t-2,n,r)&&(s|=1),s<<=1,this.readModule(e-1,t-1,n,r)&&(s|=1),s<<=1,this.readModule(e-1,t,n,r)&&(s|=1),s<<=1,this.readModule(e,t-2,n,r)&&(s|=1),s<<=1,this.readModule(e,t-1,n,r)&&(s|=1),s<<=1,this.readModule(e,t,n,r)&&(s|=1),s}readCorner1(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,1,e,t)&&(n|=1),n<<=1,this.readModule(e-1,2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}readCorner2(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-4,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner3(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-3,e,t)&&(n|=1),n<<=1,this.readModule(1,t-2,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner4(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),n=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new u("Dimension of bitMatrix must match the version size");const r=this.version.getDataRegionSizeRows(),s=this.version.getDataRegionSizeColumns(),i=t/r|0,a=n/s|0,o=new T(a*s,i*r);for(let l=0;l<i;++l){const t=l*r;for(let n=0;n<a;++n){const i=n*s;for(let a=0;a<r;++a){const c=l*(r+2)+1+a,d=t+a;for(let t=0;t<s;++t){const r=n*(s+2)+1+t;if(e.get(r,c)){const e=i+t;o.set(e,d)}}}}}return o}}class ft{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const n=t.getECBlocks();let r=0;const s=n.getECBlocks();for(let u of s)r+=u.getCount();const i=new Array(r);let a=0;for(let u of s)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=n.getECCodewords()+e;i[a++]=new ft(e,new Uint8Array(t))}const o=i[0].codewords.length-n.getECCodewords(),l=o-1;let c=0;for(let u=0;u<l;u++)for(let t=0;t<a;t++)i[t].codewords[u]=e[c++];const d=24===t.getVersionNumber(),h=d?8:a;for(let u=0;u<h;u++)i[u].codewords[o-1]=e[c++];const m=i[0].codewords.length;for(let u=o;u<m;u++)for(let t=0;t<a;t++){const n=d?(t+8)%a:t,r=d&&n>7?u-1:u;i[n].codewords[r]=e[c++]}if(c!==e.length)throw new u;return i}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class pt{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new u(""+e);let t=0,n=this.bitOffset,r=this.byteOffset;const s=this.bytes;if(n>0){const i=8-n,a=e<i?e:i,o=i-a,l=255>>8-a<<o;t=(s[r]&l)>>o,e-=a,n+=a,8===n&&(n=0,r++)}if(e>0){for(;e>=8;)t=t<<8|255&s[r],r++,e-=8;if(e>0){const i=8-e,a=255>>i<<i;t=t<<e|(s[r]&a)>>i,n+=e}}return this.bitOffset=n,this.byteOffset=r,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}!function(e){e[e.PAD_ENCODE=0]="PAD_ENCODE",e[e.ASCII_ENCODE=1]="ASCII_ENCODE",e[e.C40_ENCODE=2]="C40_ENCODE",e[e.TEXT_ENCODE=3]="TEXT_ENCODE",e[e.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",e[e.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",e[e.BASE256_ENCODE=6]="BASE256_ENCODE"}(V||(V={}));class gt{static decode(e){const t=new pt(e),n=new E,r=new E,s=new Array;let i=V.ASCII_ENCODE;do{if(i===V.ASCII_ENCODE)i=this.decodeAsciiSegment(t,n,r);else{switch(i){case V.C40_ENCODE:this.decodeC40Segment(t,n);break;case V.TEXT_ENCODE:this.decodeTextSegment(t,n);break;case V.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,n);break;case V.EDIFACT_ENCODE:this.decodeEdifactSegment(t,n);break;case V.BASE256_ENCODE:this.decodeBase256Segment(t,n,s);break;default:throw new S}i=V.ASCII_ENCODE}}while(i!==V.PAD_ENCODE&&t.available()>0);return r.length()>0&&n.append(r.toString()),new K(e,n.toString(),0===s.length?null:s,null)}static decodeAsciiSegment(e,t,n){let r=!1;do{let s=e.readBits(8);if(0===s)throw new S;if(s<=128)return r&&(s+=128),t.append(String.fromCharCode(s-1)),V.ASCII_ENCODE;if(129===s)return V.PAD_ENCODE;if(s<=229){const e=s-130;e<10&&t.append("0"),t.append(""+e)}else switch(s){case 230:return V.C40_ENCODE;case 231:return V.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:r=!0;break;case 236:t.append("[)>\x1e05\x1d"),n.insert(0,"\x1e\x04");break;case 237:t.append("[)>\x1e06\x1d"),n.insert(0,"\x1e\x04");break;case 238:return V.ANSIX12_ENCODE;case 239:return V.TEXT_ENCODE;case 240:return V.EDIFACT_ENCODE;default:if(254!==s||0!==e.available())throw new S}}while(e.available()>0);return V.ASCII_ENCODE}static decodeC40Segment(e,t){let n=!1;const r=[];let s=0;do{if(8===e.available())return;const i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),r);for(let e=0;e<3;e++){const i=r[e];switch(s){case 0:if(i<3)s=i+1;else{if(!(i<this.C40_BASIC_SET_CHARS.length))throw new S;{const e=this.C40_BASIC_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}}break;case 1:n?(t.append(String.fromCharCode(i+128)),n=!1):t.append(String.fromCharCode(i)),s=0;break;case 2:if(i<this.C40_SHIFT2_SET_CHARS.length){const e=this.C40_SHIFT2_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}else switch(i){case 27:t.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}s=0;break;case 3:n?(t.append(String.fromCharCode(i+224)),n=!1):t.append(String.fromCharCode(i+96)),s=0;break;default:throw new S}}}while(e.available()>0)}static decodeTextSegment(e,t){let n=!1,r=[],s=0;do{if(8===e.available())return;const i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),r);for(let e=0;e<3;e++){const i=r[e];switch(s){case 0:if(i<3)s=i+1;else{if(!(i<this.TEXT_BASIC_SET_CHARS.length))throw new S;{const e=this.TEXT_BASIC_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}}break;case 1:n?(t.append(String.fromCharCode(i+128)),n=!1):t.append(String.fromCharCode(i)),s=0;break;case 2:if(i<this.TEXT_SHIFT2_SET_CHARS.length){const e=this.TEXT_SHIFT2_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}else switch(i){case 27:t.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}s=0;break;case 3:if(!(i<this.TEXT_SHIFT3_SET_CHARS.length))throw new S;{const e=this.TEXT_SHIFT3_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e),s=0}break;default:throw new S}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const n=[];do{if(8===e.available())return;const r=e.readBits(8);if(254===r)return;this.parseTwoBytes(r,e.readBits(8),n);for(let e=0;e<3;e++){const r=n[e];switch(r){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(r<14)t.append(String.fromCharCode(r+44));else{if(!(r<40))throw new S;t.append(String.fromCharCode(r+51))}}}}while(e.available()>0)}static parseTwoBytes(e,t,n){let r=(e<<8)+t-1,s=Math.floor(r/1600);n[0]=s,r-=1600*s,s=Math.floor(r/40),n[1]=s,n[2]=r-40*s}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let n=0;n<4;n++){let n=e.readBits(6);if(31===n){const t=8-e.getBitOffset();return void(8!==t&&e.readBits(t))}0===(32&n)&&(n|=64),t.append(String.fromCharCode(n))}}while(e.available()>0)}static decodeBase256Segment(e,t,n){let r=1+e.getByteOffset();const s=this.unrandomize255State(e.readBits(8),r++);let i;if(i=0===s?e.available()/8|0:s<250?s:250*(s-249)+this.unrandomize255State(e.readBits(8),r++),i<0)throw new S;const a=new Uint8Array(i);for(let l=0;l<i;l++){if(e.available()<8)throw new S;a[l]=this.unrandomize255State(e.readBits(8),r++)}n.push(a);try{t.append(C.decode(a,I.ISO88591))}catch(o){throw new ne("Platform does not support required encoding: "+o.message)}}static unrandomize255State(e,t){const n=e-(149*t%255+1);return n>=0?n:n+256}}gt.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],gt.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],gt.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],gt.TEXT_SHIFT2_SET_CHARS=gt.C40_SHIFT2_SET_CHARS,gt.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class xt{constructor(){this.rsDecoder=new re(ee.DATA_MATRIX_FIELD_256)}decode(e){const t=new mt(e),n=t.getVersion(),r=t.readCodewords(),s=ft.getDataBlocks(r,n);let i=0;for(let l of s)i+=l.getNumDataCodewords();const a=new Uint8Array(i),o=s.length;for(let l=0;l<o;l++){const e=s[l],t=e.getCodewords(),n=e.getNumDataCodewords();this.correctErrors(t,n);for(let r=0;r<n;r++)a[r*o+l]=t[r]}return gt.decode(a)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch(r){throw new m}for(let s=0;s<t;s++)e[s]=n[s]}}class yt{constructor(e){this.image=e,this.rectangleDetector=new de(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new j;t=this.shiftToModuleCenter(t);const n=t[0],r=t[1],s=t[2],i=t[3];let a=this.transitionsBetween(n,i)+1,o=this.transitionsBetween(s,i)+1;1===(1&a)&&(a+=1),1===(1&o)&&(o+=1),4*a<7*o&&4*o<7*a&&(a=o=Math.max(a,o));let l=yt.sampleGrid(this.image,n,r,s,i,a,o);return new le(l,[n,r,s,i])}static shiftPoint(e,t,n){let r=(t.getX()-e.getX())/(n+1),s=(t.getY()-e.getY())/(n+1);return new oe(e.getX()+r,e.getY()+s)}static moveAway(e,t,n){let r=e.getX(),s=e.getY();return r<t?r-=1:r+=1,s<n?s-=1:s+=1,new oe(r,s)}detectSolid1(e){let t=e[0],n=e[1],r=e[3],s=e[2],i=this.transitionsBetween(t,n),a=this.transitionsBetween(n,r),o=this.transitionsBetween(r,s),l=this.transitionsBetween(s,t),c=i,d=[s,t,n,r];return c>a&&(c=a,d[0]=t,d[1]=n,d[2]=r,d[3]=s),c>o&&(c=o,d[0]=n,d[1]=r,d[2]=s,d[3]=t),c>l&&(d[0]=r,d[1]=s,d[2]=t,d[3]=n),d}detectSolid2(e){let t=e[0],n=e[1],r=e[2],s=e[3],i=this.transitionsBetween(t,s),a=yt.shiftPoint(n,r,4*(i+1)),o=yt.shiftPoint(r,n,4*(i+1));return this.transitionsBetween(a,t)<this.transitionsBetween(o,s)?(e[0]=t,e[1]=n,e[2]=r,e[3]=s):(e[0]=n,e[1]=r,e[2]=s,e[3]=t),e}correctTopRight(e){let t=e[0],n=e[1],r=e[2],s=e[3],i=this.transitionsBetween(t,s),a=this.transitionsBetween(n,s),o=yt.shiftPoint(t,n,4*(a+1)),l=yt.shiftPoint(r,n,4*(i+1));i=this.transitionsBetween(o,s),a=this.transitionsBetween(l,s);let c=new oe(s.getX()+(r.getX()-n.getX())/(i+1),s.getY()+(r.getY()-n.getY())/(i+1)),d=new oe(s.getX()+(t.getX()-n.getX())/(a+1),s.getY()+(t.getY()-n.getY())/(a+1));return this.isValid(c)?this.isValid(d)?this.transitionsBetween(o,c)+this.transitionsBetween(l,c)>this.transitionsBetween(o,d)+this.transitionsBetween(l,d)?c:d:c:this.isValid(d)?d:null}shiftToModuleCenter(e){let t=e[0],n=e[1],r=e[2],s=e[3],i=this.transitionsBetween(t,s)+1,a=this.transitionsBetween(r,s)+1,o=yt.shiftPoint(t,n,4*a),l=yt.shiftPoint(r,n,4*i);i=this.transitionsBetween(o,s)+1,a=this.transitionsBetween(l,s)+1,1===(1&i)&&(i+=1),1===(1&a)&&(a+=1);let c,d,u=(t.getX()+n.getX()+r.getX()+s.getX())/4,h=(t.getY()+n.getY()+r.getY()+s.getY())/4;return t=yt.moveAway(t,u,h),n=yt.moveAway(n,u,h),r=yt.moveAway(r,u,h),s=yt.moveAway(s,u,h),o=yt.shiftPoint(t,n,4*a),o=yt.shiftPoint(o,s,4*i),c=yt.shiftPoint(n,t,4*a),c=yt.shiftPoint(c,r,4*i),l=yt.shiftPoint(r,s,4*a),l=yt.shiftPoint(l,n,4*i),d=yt.shiftPoint(s,r,4*a),d=yt.shiftPoint(d,t,4*i),[o,c,l,d]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,n,r,s,i,a){return fe.getInstance().sampleGrid(e,i,a,.5,.5,i-.5,.5,i-.5,a-.5,.5,a-.5,t.getX(),t.getY(),s.getX(),s.getY(),r.getX(),r.getY(),n.getX(),n.getY())}transitionsBetween(e,t){let n=Math.trunc(e.getX()),r=Math.trunc(e.getY()),s=Math.trunc(t.getX()),i=Math.trunc(t.getY()),a=Math.abs(i-r)>Math.abs(s-n);if(a){let e=n;n=r,r=e,e=s,s=i,i=e}let o=Math.abs(s-n),l=Math.abs(i-r),c=-o/2,d=r<i?1:-1,u=n<s?1:-1,h=0,m=this.image.get(a?r:n,a?n:r);for(let f=n,p=r;f!==s;f+=u){let e=this.image.get(a?p:f,a?f:p);if(e!==m&&(h++,m=e),c+=l,c>0){if(p===i)break;p+=d,c-=o}}return h}}class bt{constructor(){this.decoder=new xt}decode(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=r&&r.has(N.PURE_BARCODE)){const r=bt.extractPureBits(e.getBlackMatrix());t=this.decoder.decode(r),n=bt.NO_POINTS}else{const r=new yt(e.getBlackMatrix()).detect();t=this.decoder.decode(r.getBits()),n=r.getPoints()}const s=t.getRawBytes(),i=new U(t.getText(),s,8*s.length,n,q.DATA_MATRIX,p.currentTimeMillis()),a=t.getByteSegments();null!=a&&i.putMetadata(Q.BYTE_SEGMENTS,a);const o=t.getECLevel();return null!=o&&i.putMetadata(Q.ERROR_CORRECTION_LEVEL,o),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(null==t||null==n)throw new j;const r=this.moduleSize(t,e);let s=t[1];const i=n[1];let a=t[0];const o=(n[0]-a+1)/r,l=(i-s+1)/r;if(o<=0||l<=0)throw new j;const c=r/2;s+=c,a+=c;const d=new T(o,l);for(let u=0;u<l;u++){const t=s+u*r;for(let n=0;n<o;n++)e.get(a+n*r,t)&&d.set(n,u)}return d}static moduleSize(e,t){const n=t.getWidth();let r=e[0];const s=e[1];for(;r<n&&t.get(r,s);)r++;if(r===n)throw new j;const i=r-e[0];if(0===i)throw new j;return i}}bt.NO_POINTS=[];class wt extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;super(new bt,e)}}!function(e){e[e.L=0]="L",e[e.M=1]="M",e[e.Q=2]="Q",e[e.H=3]="H"}(W||(W={}));class vt{constructor(e,t,n){this.value=e,this.stringValue=t,this.bits=n,vt.FOR_BITS.set(n,this),vt.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return vt.L;case"M":return vt.M;case"Q":return vt.Q;case"H":return vt.H;default:throw new d(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof vt))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=vt.FOR_BITS.size)throw new u;return vt.FOR_BITS.get(e)}}vt.FOR_BITS=new Map,vt.FOR_VALUE=new Map,vt.L=new vt(W.L,"L",1),vt.M=new vt(W.M,"M",0),vt.Q=new vt(W.Q,"Q",3),vt.H=new vt(W.H,"H",2);class Nt{constructor(e){this.errorCorrectionLevel=vt.forBits(e>>3&3),this.dataMask=7&e}static numBitsDiffering(e,t){return b.bitCount(e^t)}static decodeFormatInformation(e,t){const n=Nt.doDecodeFormatInformation(e,t);return null!==n?n:Nt.doDecodeFormatInformation(e^Nt.FORMAT_INFO_MASK_QR,t^Nt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let n=Number.MAX_SAFE_INTEGER,r=0;for(const s of Nt.FORMAT_INFO_DECODE_LOOKUP){const i=s[0];if(i===e||i===t)return new Nt(s[1]);let a=Nt.numBitsDiffering(e,i);a<n&&(r=s[1],n=a),e!==t&&(a=Nt.numBitsDiffering(t,i),a<n&&(r=s[1],n=a))}return n<=3?new Nt(r):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof Nt))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}Nt.FORMAT_INFO_MASK_QR=21522,Nt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class St{constructor(e){this.ecCodewordsPerBlock=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.ecBlocks=n}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const n of t)e+=n.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class At{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class _t{constructor(e,t){this.versionNumber=e,this.alignmentPatternCenters=t;for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];this.ecBlocks=r;let i=0;const a=r[0].getECCodewordsPerBlock(),o=r[0].getECBlocks();for(const l of o)i+=l.getCount()*(l.getDataCodewords()+a);this.totalCodewords=i}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!==1)throw new S;try{return this.getVersionForNumber((e-17)/4)}catch(t){throw new S}}static getVersionForNumber(e){if(e<1||e>40)throw new u;return _t.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,n=0;for(let r=0;r<_t.VERSION_DECODE_INFO.length;r++){const s=_t.VERSION_DECODE_INFO[r];if(s===e)return _t.getVersionForNumber(r+7);const i=Nt.numBitsDiffering(e,s);i<t&&(n=r+7,t=i)}return t<=3?_t.getVersionForNumber(n):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new T(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const n=this.alignmentPatternCenters.length;for(let r=0;r<n;r++){const e=this.alignmentPatternCenters[r]-2;for(let s=0;s<n;s++)0===r&&(0===s||s===n-1)||r===n-1&&0===s||t.setRegion(this.alignmentPatternCenters[s]-2,e,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}_t.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),_t.VERSIONS=[new _t(1,new Int32Array(0),new St(7,new At(1,19)),new St(10,new At(1,16)),new St(13,new At(1,13)),new St(17,new At(1,9))),new _t(2,Int32Array.from([6,18]),new St(10,new At(1,34)),new St(16,new At(1,28)),new St(22,new At(1,22)),new St(28,new At(1,16))),new _t(3,Int32Array.from([6,22]),new St(15,new At(1,55)),new St(26,new At(1,44)),new St(18,new At(2,17)),new St(22,new At(2,13))),new _t(4,Int32Array.from([6,26]),new St(20,new At(1,80)),new St(18,new At(2,32)),new St(26,new At(2,24)),new St(16,new At(4,9))),new _t(5,Int32Array.from([6,30]),new St(26,new At(1,108)),new St(24,new At(2,43)),new St(18,new At(2,15),new At(2,16)),new St(22,new At(2,11),new At(2,12))),new _t(6,Int32Array.from([6,34]),new St(18,new At(2,68)),new St(16,new At(4,27)),new St(24,new At(4,19)),new St(28,new At(4,15))),new _t(7,Int32Array.from([6,22,38]),new St(20,new At(2,78)),new St(18,new At(4,31)),new St(18,new At(2,14),new At(4,15)),new St(26,new At(4,13),new At(1,14))),new _t(8,Int32Array.from([6,24,42]),new St(24,new At(2,97)),new St(22,new At(2,38),new At(2,39)),new St(22,new At(4,18),new At(2,19)),new St(26,new At(4,14),new At(2,15))),new _t(9,Int32Array.from([6,26,46]),new St(30,new At(2,116)),new St(22,new At(3,36),new At(2,37)),new St(20,new At(4,16),new At(4,17)),new St(24,new At(4,12),new At(4,13))),new _t(10,Int32Array.from([6,28,50]),new St(18,new At(2,68),new At(2,69)),new St(26,new At(4,43),new At(1,44)),new St(24,new At(6,19),new At(2,20)),new St(28,new At(6,15),new At(2,16))),new _t(11,Int32Array.from([6,30,54]),new St(20,new At(4,81)),new St(30,new At(1,50),new At(4,51)),new St(28,new At(4,22),new At(4,23)),new St(24,new At(3,12),new At(8,13))),new _t(12,Int32Array.from([6,32,58]),new St(24,new At(2,92),new At(2,93)),new St(22,new At(6,36),new At(2,37)),new St(26,new At(4,20),new At(6,21)),new St(28,new At(7,14),new At(4,15))),new _t(13,Int32Array.from([6,34,62]),new St(26,new At(4,107)),new St(22,new At(8,37),new At(1,38)),new St(24,new At(8,20),new At(4,21)),new St(22,new At(12,11),new At(4,12))),new _t(14,Int32Array.from([6,26,46,66]),new St(30,new At(3,115),new At(1,116)),new St(24,new At(4,40),new At(5,41)),new St(20,new At(11,16),new At(5,17)),new St(24,new At(11,12),new At(5,13))),new _t(15,Int32Array.from([6,26,48,70]),new St(22,new At(5,87),new At(1,88)),new St(24,new At(5,41),new At(5,42)),new St(30,new At(5,24),new At(7,25)),new St(24,new At(11,12),new At(7,13))),new _t(16,Int32Array.from([6,26,50,74]),new St(24,new At(5,98),new At(1,99)),new St(28,new At(7,45),new At(3,46)),new St(24,new At(15,19),new At(2,20)),new St(30,new At(3,15),new At(13,16))),new _t(17,Int32Array.from([6,30,54,78]),new St(28,new At(1,107),new At(5,108)),new St(28,new At(10,46),new At(1,47)),new St(28,new At(1,22),new At(15,23)),new St(28,new At(2,14),new At(17,15))),new _t(18,Int32Array.from([6,30,56,82]),new St(30,new At(5,120),new At(1,121)),new St(26,new At(9,43),new At(4,44)),new St(28,new At(17,22),new At(1,23)),new St(28,new At(2,14),new At(19,15))),new _t(19,Int32Array.from([6,30,58,86]),new St(28,new At(3,113),new At(4,114)),new St(26,new At(3,44),new At(11,45)),new St(26,new At(17,21),new At(4,22)),new St(26,new At(9,13),new At(16,14))),new _t(20,Int32Array.from([6,34,62,90]),new St(28,new At(3,107),new At(5,108)),new St(26,new At(3,41),new At(13,42)),new St(30,new At(15,24),new At(5,25)),new St(28,new At(15,15),new At(10,16))),new _t(21,Int32Array.from([6,28,50,72,94]),new St(28,new At(4,116),new At(4,117)),new St(26,new At(17,42)),new St(28,new At(17,22),new At(6,23)),new St(30,new At(19,16),new At(6,17))),new _t(22,Int32Array.from([6,26,50,74,98]),new St(28,new At(2,111),new At(7,112)),new St(28,new At(17,46)),new St(30,new At(7,24),new At(16,25)),new St(24,new At(34,13))),new _t(23,Int32Array.from([6,30,54,78,102]),new St(30,new At(4,121),new At(5,122)),new St(28,new At(4,47),new At(14,48)),new St(30,new At(11,24),new At(14,25)),new St(30,new At(16,15),new At(14,16))),new _t(24,Int32Array.from([6,28,54,80,106]),new St(30,new At(6,117),new At(4,118)),new St(28,new At(6,45),new At(14,46)),new St(30,new At(11,24),new At(16,25)),new St(30,new At(30,16),new At(2,17))),new _t(25,Int32Array.from([6,32,58,84,110]),new St(26,new At(8,106),new At(4,107)),new St(28,new At(8,47),new At(13,48)),new St(30,new At(7,24),new At(22,25)),new St(30,new At(22,15),new At(13,16))),new _t(26,Int32Array.from([6,30,58,86,114]),new St(28,new At(10,114),new At(2,115)),new St(28,new At(19,46),new At(4,47)),new St(28,new At(28,22),new At(6,23)),new St(30,new At(33,16),new At(4,17))),new _t(27,Int32Array.from([6,34,62,90,118]),new St(30,new At(8,122),new At(4,123)),new St(28,new At(22,45),new At(3,46)),new St(30,new At(8,23),new At(26,24)),new St(30,new At(12,15),new At(28,16))),new _t(28,Int32Array.from([6,26,50,74,98,122]),new St(30,new At(3,117),new At(10,118)),new St(28,new At(3,45),new At(23,46)),new St(30,new At(4,24),new At(31,25)),new St(30,new At(11,15),new At(31,16))),new _t(29,Int32Array.from([6,30,54,78,102,126]),new St(30,new At(7,116),new At(7,117)),new St(28,new At(21,45),new At(7,46)),new St(30,new At(1,23),new At(37,24)),new St(30,new At(19,15),new At(26,16))),new _t(30,Int32Array.from([6,26,52,78,104,130]),new St(30,new At(5,115),new At(10,116)),new St(28,new At(19,47),new At(10,48)),new St(30,new At(15,24),new At(25,25)),new St(30,new At(23,15),new At(25,16))),new _t(31,Int32Array.from([6,30,56,82,108,134]),new St(30,new At(13,115),new At(3,116)),new St(28,new At(2,46),new At(29,47)),new St(30,new At(42,24),new At(1,25)),new St(30,new At(23,15),new At(28,16))),new _t(32,Int32Array.from([6,34,60,86,112,138]),new St(30,new At(17,115)),new St(28,new At(10,46),new At(23,47)),new St(30,new At(10,24),new At(35,25)),new St(30,new At(19,15),new At(35,16))),new _t(33,Int32Array.from([6,30,58,86,114,142]),new St(30,new At(17,115),new At(1,116)),new St(28,new At(14,46),new At(21,47)),new St(30,new At(29,24),new At(19,25)),new St(30,new At(11,15),new At(46,16))),new _t(34,Int32Array.from([6,34,62,90,118,146]),new St(30,new At(13,115),new At(6,116)),new St(28,new At(14,46),new At(23,47)),new St(30,new At(44,24),new At(7,25)),new St(30,new At(59,16),new At(1,17))),new _t(35,Int32Array.from([6,30,54,78,102,126,150]),new St(30,new At(12,121),new At(7,122)),new St(28,new At(12,47),new At(26,48)),new St(30,new At(39,24),new At(14,25)),new St(30,new At(22,15),new At(41,16))),new _t(36,Int32Array.from([6,24,50,76,102,128,154]),new St(30,new At(6,121),new At(14,122)),new St(28,new At(6,47),new At(34,48)),new St(30,new At(46,24),new At(10,25)),new St(30,new At(2,15),new At(64,16))),new _t(37,Int32Array.from([6,28,54,80,106,132,158]),new St(30,new At(17,122),new At(4,123)),new St(28,new At(29,46),new At(14,47)),new St(30,new At(49,24),new At(10,25)),new St(30,new At(24,15),new At(46,16))),new _t(38,Int32Array.from([6,32,58,84,110,136,162]),new St(30,new At(4,122),new At(18,123)),new St(28,new At(13,46),new At(32,47)),new St(30,new At(48,24),new At(14,25)),new St(30,new At(42,15),new At(32,16))),new _t(39,Int32Array.from([6,26,54,82,110,138,166]),new St(30,new At(20,117),new At(4,118)),new St(28,new At(40,47),new At(7,48)),new St(30,new At(43,24),new At(22,25)),new St(30,new At(10,15),new At(67,16))),new _t(40,Int32Array.from([6,30,58,86,114,142,170]),new St(30,new At(19,118),new At(6,119)),new St(28,new At(18,47),new At(31,48)),new St(30,new At(34,24),new At(34,25)),new St(30,new At(20,15),new At(61,16)))],function(e){e[e.DATA_MASK_000=0]="DATA_MASK_000",e[e.DATA_MASK_001=1]="DATA_MASK_001",e[e.DATA_MASK_010=2]="DATA_MASK_010",e[e.DATA_MASK_011=3]="DATA_MASK_011",e[e.DATA_MASK_100=4]="DATA_MASK_100",e[e.DATA_MASK_101=5]="DATA_MASK_101",e[e.DATA_MASK_110=6]="DATA_MASK_110",e[e.DATA_MASK_111=7]="DATA_MASK_111"}(G||(G={}));class Ct{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let n=0;n<t;n++)for(let r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)}}Ct.values=new Map([[G.DATA_MASK_000,new Ct(G.DATA_MASK_000,(e,t)=>0===(e+t&1))],[G.DATA_MASK_001,new Ct(G.DATA_MASK_001,(e,t)=>0===(1&e))],[G.DATA_MASK_010,new Ct(G.DATA_MASK_010,(e,t)=>t%3===0)],[G.DATA_MASK_011,new Ct(G.DATA_MASK_011,(e,t)=>(e+t)%3===0)],[G.DATA_MASK_100,new Ct(G.DATA_MASK_100,(e,t)=>0===(Math.floor(e/2)+Math.floor(t/3)&1))],[G.DATA_MASK_101,new Ct(G.DATA_MASK_101,(e,t)=>e*t%6===0)],[G.DATA_MASK_110,new Ct(G.DATA_MASK_110,(e,t)=>e*t%6<3)],[G.DATA_MASK_111,new Ct(G.DATA_MASK_111,(e,t)=>0===(e+t+e*t%3&1))]]);class It{constructor(e){const t=e.getHeight();if(t<21||1!==(3&t))throw new S;this.bitMatrix=e}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let e=0;for(let s=0;s<6;s++)e=this.copyBit(s,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let s=5;s>=0;s--)e=this.copyBit(8,s,e);const t=this.bitMatrix.getHeight();let n=0;const r=t-7;for(let s=t-1;s>=r;s--)n=this.copyBit(8,s,n);for(let s=t-8;s<t;s++)n=this.copyBit(s,8,n);if(this.parsedFormatInfo=Nt.decodeFormatInformation(e,n),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new S}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return _t.getVersionForNumber(t);let n=0;const r=e-11;for(let i=5;i>=0;i--)for(let t=e-9;t>=r;t--)n=this.copyBit(t,i,n);let s=_t.decodeVersionInformation(n);if(null!==s&&s.getDimensionForVersion()===e)return this.parsedVersion=s,s;n=0;for(let i=5;i>=0;i--)for(let t=e-9;t>=r;t--)n=this.copyBit(i,t,n);if(s=_t.decodeVersionInformation(n),null!==s&&s.getDimensionForVersion()===e)return this.parsedVersion=s,s;throw new S}copyBit(e,t,n){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?n<<1|1:n<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),n=Ct.values.get(e.getDataMask()),r=this.bitMatrix.getHeight();n.unmaskBitMatrix(this.bitMatrix,r);const s=t.buildFunctionPattern();let i=!0;const a=new Uint8Array(t.getTotalCodewords());let o=0,l=0,c=0;for(let d=r-1;d>0;d-=2){6===d&&d--;for(let e=0;e<r;e++){const t=i?r-1-e:e;for(let e=0;e<2;e++)s.get(d-e,t)||(c++,l<<=1,this.bitMatrix.get(d-e,t)&&(l|=1),8===c&&(a[o++]=l,c=0,l=0))}i=!i}if(o!==t.getTotalCodewords())throw new S;return a}remask(){if(null===this.parsedFormatInfo)return;const e=Ct.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,n=e.getWidth();t<n;t++)for(let r=t+1,s=e.getHeight();r<s;r++)e.get(t,r)!==e.get(r,t)&&(e.flip(r,t),e.flip(t,r))}}class Et{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,n){if(e.length!==t.getTotalCodewords())throw new u;const r=t.getECBlocksForLevel(n);let s=0;const i=r.getECBlocks();for(const u of i)s+=u.getCount();const a=new Array(s);let o=0;for(const u of i)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=r.getECCodewordsPerBlock()+e;a[o++]=new Et(e,new Uint8Array(t))}const l=a[0].codewords.length;let c=a.length-1;for(;c>=0&&a[c].codewords.length!==l;)c--;c++;const d=l-r.getECCodewordsPerBlock();let h=0;for(let u=0;u<d;u++)for(let t=0;t<o;t++)a[t].codewords[u]=e[h++];for(let u=c;u<o;u++)a[u].codewords[d]=e[h++];const m=a[0].codewords.length;for(let u=d;u<m;u++)for(let t=0;t<o;t++){const n=t<c?u:u+1;a[t].codewords[n]=e[h++]}return a}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}!function(e){e[e.TERMINATOR=0]="TERMINATOR",e[e.NUMERIC=1]="NUMERIC",e[e.ALPHANUMERIC=2]="ALPHANUMERIC",e[e.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",e[e.BYTE=4]="BYTE",e[e.ECI=5]="ECI",e[e.KANJI=6]="KANJI",e[e.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",e[e.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",e[e.HANZI=9]="HANZI"}(Y||(Y={}));class Tt{constructor(e,t,n,r){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=n,this.bits=r,Tt.FOR_BITS.set(r,this),Tt.FOR_VALUE.set(e,this)}static forBits(e){const t=Tt.FOR_BITS.get(e);if(void 0===t)throw new u;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let n;return n=t<=9?0:t<=26?1:2,this.characterCountBitsForVersions[n]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof Tt))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}Tt.FOR_BITS=new Map,Tt.FOR_VALUE=new Map,Tt.TERMINATOR=new Tt(Y.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Tt.NUMERIC=new Tt(Y.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Tt.ALPHANUMERIC=new Tt(Y.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Tt.STRUCTURED_APPEND=new Tt(Y.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Tt.BYTE=new Tt(Y.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Tt.ECI=new Tt(Y.ECI,"ECI",Int32Array.from([0,0,0]),7),Tt.KANJI=new Tt(Y.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Tt.FNC1_FIRST_POSITION=new Tt(Y.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Tt.FNC1_SECOND_POSITION=new Tt(Y.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Tt.HANZI=new Tt(Y.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class jt{static decode(e,t,n,r){const s=new pt(e);let i=new E;const a=new Array;let o=-1,l=-1;try{let e,n=null,c=!1;do{if(s.available()<4)e=Tt.TERMINATOR;else{const t=s.readBits(4);e=Tt.forBits(t)}switch(e){case Tt.TERMINATOR:break;case Tt.FNC1_FIRST_POSITION:case Tt.FNC1_SECOND_POSITION:c=!0;break;case Tt.STRUCTURED_APPEND:if(s.available()<16)throw new S;o=s.readBits(8),l=s.readBits(8);break;case Tt.ECI:const d=jt.parseECIValue(s);if(n=A.getCharacterSetECIByValue(d),null===n)throw new S;break;case Tt.HANZI:const u=s.readBits(4),h=s.readBits(e.getCharacterCountBits(t));u===jt.GB2312_SUBSET&&jt.decodeHanziSegment(s,i,h);break;default:const m=s.readBits(e.getCharacterCountBits(t));switch(e){case Tt.NUMERIC:jt.decodeNumericSegment(s,i,m);break;case Tt.ALPHANUMERIC:jt.decodeAlphanumericSegment(s,i,m,c);break;case Tt.BYTE:jt.decodeByteSegment(s,i,m,n,a,r);break;case Tt.KANJI:jt.decodeKanjiSegment(s,i,m);break;default:throw new S}}}while(e!==Tt.TERMINATOR)}catch(c){throw new S}return new K(e,i.toString(),0===a.length?null:a,null===n?null:n.toString(),o,l)}static decodeHanziSegment(e,t,n){if(13*n>e.available())throw new S;const r=new Uint8Array(2*n);let s=0;for(;n>0;){const t=e.readBits(13);let i=t/96<<8&4294967295|t%96;i+=i<959?41377:42657,r[s]=i>>8&255,r[s+1]=255&i,s+=2,n--}try{t.append(C.decode(r,I.GB2312))}catch(i){throw new S(i)}}static decodeKanjiSegment(e,t,n){if(13*n>e.available())throw new S;const r=new Uint8Array(2*n);let s=0;for(;n>0;){const t=e.readBits(13);let i=t/192<<8&4294967295|t%192;i+=i<7936?33088:49472,r[s]=i>>8,r[s+1]=i,s+=2,n--}try{t.append(C.decode(r,I.SHIFT_JIS))}catch(i){throw new S(i)}}static decodeByteSegment(e,t,n,r,s,i){if(8*n>e.available())throw new S;const a=new Uint8Array(n);for(let c=0;c<n;c++)a[c]=e.readBits(8);let o;o=null===r?I.guessEncoding(a,i):r.getName();try{t.append(C.decode(a,o))}catch(l){throw new S(l)}s.push(a)}static toAlphaNumericChar(e){if(e>=jt.ALPHANUMERIC_CHARS.length)throw new S;return jt.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,n,r){const s=t.length();for(;n>1;){if(e.available()<11)throw new S;const r=e.readBits(11);t.append(jt.toAlphaNumericChar(Math.floor(r/45))),t.append(jt.toAlphaNumericChar(r%45)),n-=2}if(1===n){if(e.available()<6)throw new S;t.append(jt.toAlphaNumericChar(e.readBits(6)))}if(r)for(let i=s;i<t.length();i++)"%"===t.charAt(i)&&(i<t.length()-1&&"%"===t.charAt(i+1)?t.deleteCharAt(i+1):t.setCharAt(i,String.fromCharCode(29)))}static decodeNumericSegment(e,t,n){for(;n>=3;){if(e.available()<10)throw new S;const r=e.readBits(10);if(r>=1e3)throw new S;t.append(jt.toAlphaNumericChar(Math.floor(r/100))),t.append(jt.toAlphaNumericChar(Math.floor(r/10)%10)),t.append(jt.toAlphaNumericChar(r%10)),n-=3}if(2===n){if(e.available()<7)throw new S;const n=e.readBits(7);if(n>=100)throw new S;t.append(jt.toAlphaNumericChar(Math.floor(n/10))),t.append(jt.toAlphaNumericChar(n%10))}else if(1===n){if(e.available()<4)throw new S;const n=e.readBits(4);if(n>=10)throw new S;t.append(jt.toAlphaNumericChar(n))}}static parseECIValue(e){const t=e.readBits(8);if(0===(128&t))return 127&t;if(128===(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192===(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new S}}jt.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",jt.GB2312_SUBSET=1;class kt{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||null===e||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class Dt{constructor(){this.rsDecoder=new re(ee.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(T.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const n=new It(e);let r=null;try{return this.decodeBitMatrixParser(n,t)}catch(s){r=s}try{n.remask(),n.setMirror(!0),n.readVersion(),n.readFormatInformation(),n.mirror();const e=this.decodeBitMatrixParser(n,t);return e.setOther(new kt(!0)),e}catch(s){if(null!==r)throw r;throw s}}decodeBitMatrixParser(e,t){const n=e.readVersion(),r=e.readFormatInformation().getErrorCorrectionLevel(),s=e.readCodewords(),i=Et.getDataBlocks(s,n,r);let a=0;for(const c of i)a+=c.getNumDataCodewords();const o=new Uint8Array(a);let l=0;for(const c of i){const e=c.getCodewords(),t=c.getNumDataCodewords();this.correctErrors(e,t);for(let n=0;n<t;n++)o[l++]=e[n]}return jt.decode(o,n,r,t)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch(r){throw new m}for(let s=0;s<t;s++)e[s]=n[s]}}class Pt extends oe{constructor(e,t,n){super(e,t),this.estimatedModuleSize=n}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const r=(this.getX()+t)/2,s=(this.getY()+e)/2,i=(this.estimatedModuleSize+n)/2;return new Pt(r,s,i)}}class Rt{constructor(e,t,n,r,s,i,a){this.image=e,this.startX=t,this.startY=n,this.width=r,this.height=s,this.moduleSize=i,this.resultPointCallback=a,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,n=e+this.width,r=this.startY+t/2,s=new Int32Array(3),i=this.image;for(let a=0;a<t;a++){const t=r+(0===(1&a)?Math.floor((a+1)/2):-Math.floor((a+1)/2));s[0]=0,s[1]=0,s[2]=0;let o=e;for(;o<n&&!i.get(o,t);)o++;let l=0;for(;o<n;){if(i.get(o,t))if(1===l)s[1]++;else if(2===l){if(this.foundPatternCross(s)){const e=this.handlePossibleCenter(s,t,o);if(null!==e)return e}s[0]=s[2],s[1]=1,s[2]=0,l=1}else s[++l]++;else 1===l&&l++,s[l]++;o++}if(this.foundPatternCross(s)){const e=this.handlePossibleCenter(s,t,n);if(null!==e)return e}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new j}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,n=t/2;for(let r=0;r<3;r++)if(Math.abs(t-e[r])>=n)return!1;return!0}crossCheckVertical(e,t,n,r){const s=this.image,i=s.getHeight(),a=this.crossCheckStateCount;a[0]=0,a[1]=0,a[2]=0;let o=e;for(;o>=0&&s.get(t,o)&&a[1]<=n;)a[1]++,o--;if(o<0||a[1]>n)return NaN;for(;o>=0&&!s.get(t,o)&&a[0]<=n;)a[0]++,o--;if(a[0]>n)return NaN;for(o=e+1;o<i&&s.get(t,o)&&a[1]<=n;)a[1]++,o++;if(o===i||a[1]>n)return NaN;for(;o<i&&!s.get(t,o)&&a[2]<=n;)a[2]++,o++;if(a[2]>n)return NaN;const l=a[0]+a[1]+a[2];return 5*Math.abs(l-r)>=2*r?NaN:this.foundPatternCross(a)?Rt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,n){const r=e[0]+e[1]+e[2],s=Rt.centerFromEnd(e,n),i=this.crossCheckVertical(t,s,2*e[1],r);if(!isNaN(i)){const t=(e[0]+e[1]+e[2])/3;for(const e of this.possibleCenters)if(e.aboutEquals(t,i,s))return e.combineEstimate(i,s,t);const n=new Pt(s,i,t);this.possibleCenters.push(n),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(n)}return null}}class Ot extends oe{constructor(e,t,n,r){super(e,t),this.estimatedModuleSize=n,this.count=r,void 0===r&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const r=this.count+1,s=(this.count*this.getX()+t)/r,i=(this.count*this.getY()+e)/r,a=(this.count*this.estimatedModuleSize+n)/r;return new Ot(s,i,a,r)}}class Lt{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Mt{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=null!==e&&void 0!==e&&void 0!==e.get(N.TRY_HARDER),n=null!==e&&void 0!==e&&void 0!==e.get(N.PURE_BARCODE),r=this.image,s=r.getHeight(),i=r.getWidth();let a=Math.floor(3*s/(4*Mt.MAX_MODULES));(a<Mt.MIN_SKIP||t)&&(a=Mt.MIN_SKIP);let o=!1;const l=new Int32Array(5);for(let d=a-1;d<s&&!o;d+=a){l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0;let e=0;for(let t=0;t<i;t++)if(r.get(t,d))1===(1&e)&&e++,l[e]++;else if(0===(1&e))if(4===e)if(Mt.foundPatternCross(l)){if(!0!==this.handlePossibleCenter(l,d,t,n)){l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;continue}if(a=2,!0===this.hasSkipped)o=this.haveMultiplyConfirmedCenters();else{const e=this.findRowSkip();e>l[2]&&(d+=e-l[2]-a,t=i-1)}e=0,l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0}else l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;else l[++e]++;else l[e]++;Mt.foundPatternCross(l)&&!0===this.handlePossibleCenter(l,d,i,n)&&(a=l[0],this.hasSkipped&&(o=this.haveMultiplyConfirmedCenters()))}const c=this.selectBestPatterns();return oe.orderBestPatterns(c),new Lt(c)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let s=0;s<5;s++){const n=e[s];if(0===n)return!1;t+=n}if(t<7)return!1;const n=t/7,r=n/2;return Math.abs(n-e[0])<r&&Math.abs(n-e[1])<r&&Math.abs(3*n-e[2])<3*r&&Math.abs(n-e[3])<r&&Math.abs(n-e[4])<r}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,n,r){const s=this.getCrossCheckStateCount();let i=0;const a=this.image;for(;e>=i&&t>=i&&a.get(t-i,e-i);)s[2]++,i++;if(e<i||t<i)return!1;for(;e>=i&&t>=i&&!a.get(t-i,e-i)&&s[1]<=n;)s[1]++,i++;if(e<i||t<i||s[1]>n)return!1;for(;e>=i&&t>=i&&a.get(t-i,e-i)&&s[0]<=n;)s[0]++,i++;if(s[0]>n)return!1;const o=a.getHeight(),l=a.getWidth();for(i=1;e+i<o&&t+i<l&&a.get(t+i,e+i);)s[2]++,i++;if(e+i>=o||t+i>=l)return!1;for(;e+i<o&&t+i<l&&!a.get(t+i,e+i)&&s[3]<n;)s[3]++,i++;if(e+i>=o||t+i>=l||s[3]>=n)return!1;for(;e+i<o&&t+i<l&&a.get(t+i,e+i)&&s[4]<n;)s[4]++,i++;if(s[4]>=n)return!1;const c=s[0]+s[1]+s[2]+s[3]+s[4];return Math.abs(c-r)<2*r&&Mt.foundPatternCross(s)}crossCheckVertical(e,t,n,r){const s=this.image,i=s.getHeight(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&s.get(t,o);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!s.get(t,o)&&a[1]<=n;)a[1]++,o--;if(o<0||a[1]>n)return NaN;for(;o>=0&&s.get(t,o)&&a[0]<=n;)a[0]++,o--;if(a[0]>n)return NaN;for(o=e+1;o<i&&s.get(t,o);)a[2]++,o++;if(o===i)return NaN;for(;o<i&&!s.get(t,o)&&a[3]<n;)a[3]++,o++;if(o===i||a[3]>=n)return NaN;for(;o<i&&s.get(t,o)&&a[4]<n;)a[4]++,o++;if(a[4]>=n)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-r)>=2*r?NaN:Mt.foundPatternCross(a)?Mt.centerFromEnd(a,o):NaN}crossCheckHorizontal(e,t,n,r){const s=this.image,i=s.getWidth(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&s.get(o,t);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!s.get(o,t)&&a[1]<=n;)a[1]++,o--;if(o<0||a[1]>n)return NaN;for(;o>=0&&s.get(o,t)&&a[0]<=n;)a[0]++,o--;if(a[0]>n)return NaN;for(o=e+1;o<i&&s.get(o,t);)a[2]++,o++;if(o===i)return NaN;for(;o<i&&!s.get(o,t)&&a[3]<n;)a[3]++,o++;if(o===i||a[3]>=n)return NaN;for(;o<i&&s.get(o,t)&&a[4]<n;)a[4]++,o++;if(a[4]>=n)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-r)>=r?NaN:Mt.foundPatternCross(a)?Mt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,n,r){const s=e[0]+e[1]+e[2]+e[3]+e[4];let i=Mt.centerFromEnd(e,n),a=this.crossCheckVertical(t,Math.floor(i),e[2],s);if(!isNaN(a)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(a),e[2],s),!isNaN(i)&&(!r||this.crossCheckDiagonal(Math.floor(a),Math.floor(i),e[2],s)))){const e=s/7;let t=!1;const n=this.possibleCenters;for(let r=0,s=n.length;r<s;r++){const s=n[r];if(s.aboutEquals(e,a,i)){n[r]=s.combineEstimate(a,i,e),t=!0;break}}if(!t){const t=new Ot(i,a,e);n.push(t),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(t)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(const t of this.possibleCenters)if(t.getCount()>=Mt.CENTER_QUORUM){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-t.getX())-Math.abs(e.getY()-t.getY()))/2);e=t}return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const n=this.possibleCenters.length;for(const i of this.possibleCenters)i.getCount()>=Mt.CENTER_QUORUM&&(e++,t+=i.getEstimatedModuleSize());if(e<3)return!1;const r=t/n;let s=0;for(const i of this.possibleCenters)s+=Math.abs(i.getEstimatedModuleSize()-r);return s<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new j;const t=this.possibleCenters;let n;if(e>3){let r=0,s=0;for(const e of this.possibleCenters){const t=e.getEstimatedModuleSize();r+=t,s+=t*t}n=r/e;let i=Math.sqrt(s/e-n*n);t.sort((e,t)=>{const r=Math.abs(t.getEstimatedModuleSize()-n),s=Math.abs(e.getEstimatedModuleSize()-n);return r<s?-1:r>s?1:0});const a=Math.max(.2*n,i);for(let e=0;e<t.length&&t.length>3;e++){const r=t[e];Math.abs(r.getEstimatedModuleSize()-n)>a&&(t.splice(e,1),e--)}}if(t.length>3){let e=0;for(const n of t)e+=n.getEstimatedModuleSize();n=e/t.length,t.sort((e,t)=>{if(t.getCount()===e.getCount()){const r=Math.abs(t.getEstimatedModuleSize()-n),s=Math.abs(e.getEstimatedModuleSize()-n);return r<s?1:r>s?-1:0}return t.getCount()-e.getCount()}),t.splice(3)}return[t[0],t[1],t[2]]}}Mt.CENTER_QUORUM=2,Mt.MIN_SKIP=3,Mt.MAX_MODULES=57;class Ft{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=null===e||void 0===e?null:e.get(N.NEED_RESULT_POINT_CALLBACK);const t=new Mt(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)}processFinderPatternInfo(e){const t=e.getTopLeft(),n=e.getTopRight(),r=e.getBottomLeft(),s=this.calculateModuleSize(t,n,r);if(s<1)throw new j("No pattern found in proccess finder.");const i=Ft.computeDimension(t,n,r,s),a=_t.getProvisionalVersionForDimension(i),o=a.getDimensionForVersion()-7;let l=null;if(a.getAlignmentPatternCenters().length>0){const e=n.getX()-t.getX()+r.getX(),i=n.getY()-t.getY()+r.getY(),a=1-3/o,c=Math.floor(t.getX()+a*(e-t.getX())),d=Math.floor(t.getY()+a*(i-t.getY()));for(let t=4;t<=16;t<<=1)try{l=this.findAlignmentInRegion(s,c,d,t);break}catch(h){if(!(h instanceof j))throw h}}const c=Ft.createTransform(t,n,r,l,i),d=Ft.sampleGrid(this.image,c,i);let u;return u=null===l?[r,t,n]:[r,t,n,l],new le(d,u)}static createTransform(e,t,n,r,s){const i=s-3.5;let a,o,l,c;return null!==r?(a=r.getX(),o=r.getY(),l=i-3,c=l):(a=t.getX()-e.getX()+n.getX(),o=t.getY()-e.getY()+n.getY(),l=i,c=i),he.quadrilateralToQuadrilateral(3.5,3.5,i,3.5,l,c,3.5,i,e.getX(),e.getY(),t.getX(),t.getY(),a,o,n.getX(),n.getY())}static sampleGrid(e,t,n){return fe.getInstance().sampleGridWithTransform(e,n,n,t)}static computeDimension(e,t,n,r){const s=ie.round(oe.distance(e,t)/r),i=ie.round(oe.distance(e,n)/r);let a=Math.floor((s+i)/2)+7;switch(3&a){case 0:a++;break;case 2:a--;break;case 3:throw new j("Dimensions could be not found.")}return a}calculateModuleSize(e,t,n){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,n))/2}calculateModuleSizeOneWay(e,t){const n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(n)?r/7:isNaN(r)?n/7:(n+r)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,n,r){let s=this.sizeOfBlackWhiteBlackRun(e,t,n,r),i=1,a=e-(n-e);a<0?(i=e/(e-a),a=0):a>=this.image.getWidth()&&(i=(this.image.getWidth()-1-e)/(a-e),a=this.image.getWidth()-1);let o=Math.floor(t-(r-t)*i);return i=1,o<0?(i=t/(t-o),o=0):o>=this.image.getHeight()&&(i=(this.image.getHeight()-1-t)/(o-t),o=this.image.getHeight()-1),a=Math.floor(e+(a-e)*i),s+=this.sizeOfBlackWhiteBlackRun(e,t,a,o),s-1}sizeOfBlackWhiteBlackRun(e,t,n,r){const s=Math.abs(r-t)>Math.abs(n-e);if(s){let s=e;e=t,t=s,s=n,n=r,r=s}const i=Math.abs(n-e),a=Math.abs(r-t);let o=-i/2;const l=e<n?1:-1,c=t<r?1:-1;let d=0;const u=n+l;for(let h=e,m=t;h!==u;h+=l){const n=s?m:h,l=s?h:m;if(1===d===this.image.get(n,l)){if(2===d)return ie.distance(h,m,e,t);d++}if(o+=a,o>0){if(m===r)break;m+=c,o-=i}}return 2===d?ie.distance(n+l,r,e,t):NaN}findAlignmentInRegion(e,t,n,r){const s=Math.floor(r*e),i=Math.max(0,t-s),a=Math.min(this.image.getWidth()-1,t+s);if(a-i<3*e)throw new j("Alignment top exceeds estimated module size.");const o=Math.max(0,n-s),l=Math.min(this.image.getHeight()-1,n+s);if(l-o<3*e)throw new j("Alignment bottom exceeds estimated module size.");return new Rt(this.image,i,o,a-i,l-o,e,this.resultPointCallback).find()}}class Bt{constructor(){this.decoder=new Dt}getDecoder(){return this.decoder}decode(e,t){let n,r;if(void 0!==t&&null!==t&&void 0!==t.get(N.PURE_BARCODE)){const s=Bt.extractPureBits(e.getBlackMatrix());n=this.decoder.decodeBitMatrix(s,t),r=Bt.NO_POINTS}else{const s=new Ft(e.getBlackMatrix()).detect(t);n=this.decoder.decodeBitMatrix(s.getBits(),t),r=s.getPoints()}n.getOther()instanceof kt&&n.getOther().applyMirroredCorrection(r);const s=new U(n.getText(),n.getRawBytes(),void 0,r,q.QR_CODE,void 0),i=n.getByteSegments();null!==i&&s.putMetadata(Q.BYTE_SEGMENTS,i);const a=n.getECLevel();return null!==a&&s.putMetadata(Q.ERROR_CORRECTION_LEVEL,a),n.hasStructuredAppend()&&(s.putMetadata(Q.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),s.putMetadata(Q.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),s}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(null===t||null===n)throw new j;const r=this.moduleSize(t,e);let s=t[1],i=n[1],a=t[0],o=n[0];if(a>=o||s>=i)throw new j;if(i-s!==o-a&&(o=a+(i-s),o>=e.getWidth()))throw new j;const l=Math.round((o-a+1)/r),c=Math.round((i-s+1)/r);if(l<=0||c<=0)throw new j;if(c!==l)throw new j;const d=Math.floor(r/2);s+=d,a+=d;const u=a+Math.floor((l-1)*r)-o;if(u>0){if(u>d)throw new j;a-=u}const h=s+Math.floor((c-1)*r)-i;if(h>0){if(h>d)throw new j;s-=h}const m=new T(l,c);for(let f=0;f<c;f++){const t=s+Math.floor(f*r);for(let n=0;n<l;n++)e.get(a+Math.floor(n*r),t)&&m.set(n,f)}return m}static moduleSize(e,t){const n=t.getHeight(),r=t.getWidth();let s=e[0],i=e[1],a=!0,o=0;for(;s<r&&i<n;){if(a!==t.get(s,i)){if(5===++o)break;a=!a}s++,i++}if(s===r||i===n)throw new j;return(s-e[0])/7}}Bt.NO_POINTS=new Array;class Ut{PDF417Common(){}static getBitCountSum(e){return ie.sum(e)}static toIntArray(e){if(null==e||!e.length)return Ut.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let n=0;for(const r of e)t[n++]=r;return t}static getCodeword(e){const t=y.binarySearch(Ut.SYMBOL_TABLE,262143&e);return t<0?-1:(Ut.CODEWORD_TABLE[t]-1)%Ut.NUMBER_OF_CODEWORDS}}Ut.NUMBER_OF_CODEWORDS=929,Ut.MAX_CODEWORDS_IN_BARCODE=Ut.NUMBER_OF_CODEWORDS-1,Ut.MIN_ROWS_IN_BARCODE=3,Ut.MAX_ROWS_IN_BARCODE=90,Ut.MODULES_IN_CODEWORD=17,Ut.MODULES_IN_STOP_PATTERN=18,Ut.BARS_IN_MODULE=8,Ut.EMPTY_INT_ARRAY=new Int32Array([]),Ut.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ut.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class zt{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class qt{static detectMultiple(e,t,n){let r=e.getBlackMatrix(),s=qt.detect(n,r);return s.length||(r=r.clone(),r.rotate180(),s=qt.detect(n,r)),new zt(r,s)}static detect(e,t){const n=new Array;let r=0,s=0,i=!1;for(;r<t.getHeight();){const a=qt.findVertices(t,r,s);if(null!=a[0]||null!=a[3]){if(i=!0,n.push(a),!e)break;null!=a[2]?(s=Math.trunc(a[2].getX()),r=Math.trunc(a[2].getY())):(s=Math.trunc(a[4].getX()),r=Math.trunc(a[4].getY()))}else{if(!i)break;i=!1,s=0;for(const e of n)null!=e[1]&&(r=Math.trunc(Math.max(r,e[1].getY()))),null!=e[3]&&(r=Math.max(r,Math.trunc(e[3].getY())));r+=qt.ROW_STEP}}return n}static findVertices(e,t,n){const r=e.getHeight(),s=e.getWidth(),i=new Array(8);return qt.copyToResult(i,qt.findRowsWithPattern(e,r,s,t,n,qt.START_PATTERN),qt.INDEXES_START_PATTERN),null!=i[4]&&(n=Math.trunc(i[4].getX()),t=Math.trunc(i[4].getY())),qt.copyToResult(i,qt.findRowsWithPattern(e,r,s,t,n,qt.STOP_PATTERN),qt.INDEXES_STOP_PATTERN),i}static copyToResult(e,t,n){for(let r=0;r<n.length;r++)e[n[r]]=t[r]}static findRowsWithPattern(e,t,n,r,s,i){const a=new Array(4);let o=!1;const l=new Int32Array(i.length);for(;r<t;r+=qt.ROW_STEP){let t=qt.findGuardPattern(e,s,r,n,!1,i,l);if(null!=t){for(;r>0;){const a=qt.findGuardPattern(e,s,--r,n,!1,i,l);if(null==a){r++;break}t=a}a[0]=new oe(t[0],r),a[1]=new oe(t[1],r),o=!0;break}}let c=r+1;if(o){let r=0,s=Int32Array.from([Math.trunc(a[0].getX()),Math.trunc(a[1].getX())]);for(;c<t;c++){const t=qt.findGuardPattern(e,s[0],c,n,!1,i,l);if(null!=t&&Math.abs(s[0]-t[0])<qt.MAX_PATTERN_DRIFT&&Math.abs(s[1]-t[1])<qt.MAX_PATTERN_DRIFT)s=t,r=0;else{if(r>qt.SKIPPED_ROW_COUNT_MAX)break;r++}}c-=r+1,a[2]=new oe(s[0],c),a[3]=new oe(s[1],c)}return c-r<qt.BARCODE_MIN_HEIGHT&&y.fill(a,null),a}static findGuardPattern(e,t,n,r,s,i,a){y.fillWithin(a,0,a.length,0);let o=t,l=0;for(;e.get(o,n)&&o>0&&l++<qt.MAX_PIXEL_DRIFT;)o--;let c=o,d=0,u=i.length;for(let h=s;c<r;c++)if(e.get(c,n)!==h)a[d]++;else{if(d===u-1){if(qt.patternMatchVariance(a,i,qt.MAX_INDIVIDUAL_VARIANCE)<qt.MAX_AVG_VARIANCE)return new Int32Array([o,c]);o+=a[0]+a[1],p.arraycopy(a,2,a,0,d-1),a[d-1]=0,a[d]=0,d--}else d++;a[d]=1,h=!h}return d===u-1&&qt.patternMatchVariance(a,i,qt.MAX_INDIVIDUAL_VARIANCE)<qt.MAX_AVG_VARIANCE?new Int32Array([o,c-1]):null}static patternMatchVariance(e,t,n){let r=e.length,s=0,i=0;for(let l=0;l<r;l++)s+=e[l],i+=t[l];if(s<i)return 1/0;let a=s/i;n*=a;let o=0;for(let l=0;l<r;l++){let r=e[l],s=t[l]*a,i=r>s?r-s:s-r;if(i>n)return 1/0;o+=i}return o/s}}qt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),qt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),qt.MAX_AVG_VARIANCE=.42,qt.MAX_INDIVIDUAL_VARIANCE=.8,qt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),qt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),qt.MAX_PIXEL_DRIFT=3,qt.MAX_PATTERN_DRIFT=5,qt.SKIPPED_ROW_COUNT_MAX=25,qt.ROW_STEP=5,qt.BARCODE_MIN_HEIGHT=10;class Ht{constructor(e,t){if(0===t.length)throw new u;this.field=e;let n=t.length;if(n>1&&0===t[0]){let e=1;for(;e<n&&0===t[e];)e++;e===n?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(n-e),p.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);if(1===e){let e=0;for(let t of this.coefficients)e=this.field.add(e,t);return e}let t=this.coefficients[0],n=this.coefficients.length;for(let r=1;r<n;r++)t=this.field.add(this.field.multiply(e,t),this.coefficients[r]);return t}add(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){let e=t;t=n,n=e}let r=new Int32Array(n.length),s=n.length-t.length;p.arraycopy(n,0,r,0,s);for(let i=s;i<n.length;i++)r[i]=this.field.add(t[i-s],n[i]);return new Ht(this.field,r)}subtract(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof Ht?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new Ht(this.field,new Int32Array([0]));let t=this.coefficients,n=t.length,r=e.coefficients,s=r.length,i=new Int32Array(n+s-1);for(let a=0;a<n;a++){let e=t[a];for(let t=0;t<s;t++)i[a+t]=this.field.add(i[a+t],this.field.multiply(e,r[t]))}return new Ht(this.field,i)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=this.field.subtract(0,this.coefficients[n]);return new Ht(this.field,t)}multiplyScalar(e){if(0===e)return new Ht(this.field,new Int32Array([0]));if(1===e)return this;let t=this.coefficients.length,n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=this.field.multiply(this.coefficients[r],e);return new Ht(this.field,n)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return new Ht(this.field,new Int32Array([0]));let n=this.coefficients.length,r=new Int32Array(n+e);for(let s=0;s<n;s++)r[s]=this.field.multiply(this.coefficients[s],t);return new Ht(this.field,r)}toString(){let e=new E;for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);0!==n&&(n<0?(e.append(" - "),n=-n):e.length()>0&&e.append(" + "),0!==t&&1===n||e.append(n),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class Vt{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}inverse(e){if(0===e)throw new $;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class Wt extends Vt{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let n=1;for(let r=0;r<e;r++)this.expTable[r]=n,n=n*t%e;for(let r=0;r<e-1;r++)this.logTable[this.expTable[r]]=r;this.zero=new Ht(this,new Int32Array([0])),this.one=new Ht(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;let n=new Int32Array(e+1);return n[0]=t,new Ht(this,n)}}Wt.PDF417_GF=new Wt(Ut.NUMBER_OF_CODEWORDS,3);class Gt{constructor(){this.field=Wt.PDF417_GF}decode(e,t,n){let r=new Ht(this.field,e),s=new Int32Array(t),i=!1;for(let m=t;m>0;m--){let e=r.evaluateAt(this.field.exp(m));s[t-m]=e,0!==e&&(i=!0)}if(!i)return 0;let a=this.field.getOne();if(null!=n)for(const m of n){let t=this.field.exp(e.length-1-m),n=new Ht(this.field,new Int32Array([this.field.subtract(0,t),1]));a=a.multiply(n)}let o=new Ht(this.field,s),l=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),o,t),c=l[0],d=l[1],u=this.findErrorLocations(c),h=this.findErrorMagnitudes(d,c,u);for(let f=0;f<u.length;f++){let t=e.length-1-this.field.log(u[f]);if(t<0)throw m.getChecksumInstance();e[t]=this.field.subtract(e[t],h[f])}return u.length}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){let n=e;e=t,t=n}let r=e,s=t,i=this.field.getZero(),a=this.field.getOne();for(;s.getDegree()>=Math.round(n/2);){let e=r,t=i;if(r=s,i=a,r.isZero())throw m.getChecksumInstance();s=e;let n=this.field.getZero(),o=r.getCoefficient(r.getDegree()),l=this.field.inverse(o);for(;s.getDegree()>=r.getDegree()&&!s.isZero();){let e=s.getDegree()-r.getDegree(),t=this.field.multiply(s.getCoefficient(s.getDegree()),l);n=n.add(this.field.buildMonomial(e,t)),s=s.subtract(r.multiplyByMonomial(e,t))}a=n.multiply(i).subtract(t).negative()}let o=a.getCoefficient(0);if(0===o)throw m.getChecksumInstance();let l=this.field.inverse(o);return[a.multiply(l),s.multiply(l)]}findErrorLocations(e){let t=e.getDegree(),n=new Int32Array(t),r=0;for(let s=1;s<this.field.getSize()&&r<t;s++)0===e.evaluateAt(s)&&(n[r]=this.field.inverse(s),r++);if(r!==t)throw m.getChecksumInstance();return n}findErrorMagnitudes(e,t,n){let r=t.getDegree(),s=new Int32Array(r);for(let l=1;l<=r;l++)s[r-l]=this.field.multiply(l,t.getCoefficient(l));let i=new Ht(this.field,s),a=n.length,o=new Int32Array(a);for(let l=0;l<a;l++){let t=this.field.inverse(n[l]),r=this.field.subtract(0,e.evaluateAt(t)),s=this.field.inverse(i.evaluateAt(t));o[l]=this.field.multiply(r,s)}return o}}class Yt{constructor(e,t,n,r,s){e instanceof Yt?this.constructor_2(e):this.constructor_1(e,t,n,r,s)}constructor_1(e,t,n,r,s){const i=null==t||null==n,a=null==r||null==s;if(i&&a)throw new j;i?(t=new oe(0,r.getY()),n=new oe(0,s.getY())):a&&(r=new oe(e.getWidth()-1,t.getY()),s=new oe(e.getWidth()-1,n.getY())),this.image=e,this.topLeft=t,this.bottomLeft=n,this.topRight=r,this.bottomRight=s,this.minX=Math.trunc(Math.min(t.getX(),n.getX())),this.maxX=Math.trunc(Math.max(r.getX(),s.getX())),this.minY=Math.trunc(Math.min(t.getY(),r.getY())),this.maxY=Math.trunc(Math.max(n.getY(),s.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return null==e?t:null==t?e:new Yt(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,n){let r=this.topLeft,s=this.bottomLeft,i=this.topRight,a=this.bottomRight;if(e>0){let t=n?this.topLeft:this.topRight,s=Math.trunc(t.getY()-e);s<0&&(s=0);let a=new oe(t.getX(),s);n?r=a:i=a}if(t>0){let e=n?this.bottomLeft:this.bottomRight,r=Math.trunc(e.getY()+t);r>=this.image.getHeight()&&(r=this.image.getHeight()-1);let i=new oe(e.getX(),r);n?s=i:a=i}return new Yt(this.image,r,s,i,a)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Xt{constructor(e,t,n,r){this.columnCount=e,this.errorCorrectionLevel=r,this.rowCountUpperPart=t,this.rowCountLowerPart=n,this.rowCount=t+n}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Qt{constructor(){this.buffer=""}static form(e,t){let n=-1;function r(e,r,s,i,a,o){if("%%"===e)return"%";if(void 0===t[++n])return;e=i?parseInt(i.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[n];break;case"c":l=t[n][0];break;case"f":l=parseFloat(t[n]).toFixed(e);break;case"p":l=parseFloat(t[n]).toPrecision(e);break;case"e":l=parseFloat(t[n]).toExponential(e);break;case"x":l=parseInt(t[n]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[n],c||10).toPrecision(e)).toFixed(0)}l="object"===typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(s),u=s&&s[0]+""==="0"?"0":" ";for(;l.length<d;)l=void 0!==r?l+u:u+l;return l}let s=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(s,r)}format(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.buffer+=Qt.form(e,n)}toString(){return this.buffer}}class Kt{constructor(e){this.boundingBox=new Yt(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(null!=t)return t;for(let n=1;n<Kt.MAX_NEARBY_DISTANCE;n++){let r=this.imageRowToCodewordIndex(e)-n;if(r>=0&&(t=this.codewords[r],null!=t))return t;if(r=this.imageRowToCodewordIndex(e)+n,r<this.codewords.length&&(t=this.codewords[r],null!=t))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new Qt;let t=0;for(const n of this.codewords)null!=n?e.format("%3d: %3d|%3d%n",t++,n.getRowNumber(),n.getValue()):e.format("%3d:    |   %n",t++);return e.toString()}}Kt.MAX_NEARBY_DISTANCE=5;class Zt{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[n,r]of this.values.entries()){const s={getKey:()=>n,getValue:()=>r};s.getValue()>e?(e=s.getValue(),t=[],t.push(s.getKey())):s.getValue()===e&&t.push(s.getKey())}return Ut.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class Jt extends Kt{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())null!=e&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let n=this.getBoundingBox(),r=this._isLeft?n.getTopLeft():n.getTopRight(),s=this._isLeft?n.getBottomLeft():n.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(r.getY())),a=this.imageRowToCodewordIndex(Math.trunc(s.getY())),o=-1,l=1,c=0;for(let d=i;d<a;d++){if(null==t[d])continue;let n=t[d],r=n.getRowNumber()-o;if(0===r)c++;else if(1===r)l=Math.max(l,c),c=1,o=n.getRowNumber();else if(r<0||n.getRowNumber()>=e.getRowCount()||r>d)t[d]=null;else{let e;e=l>2?(l-2)*r:r;let s=e>=d;for(let n=1;n<=e&&!s;n++)s=null!=t[d-n];s?t[d]=null:(o=n.getRowNumber(),c=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(null==e)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let n of this.getCodewords())if(null!=n){let e=n.getRowNumber();if(e>=t.length)continue;t[e]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),n=this._isLeft?t.getTopLeft():t.getTopRight(),r=this._isLeft?t.getBottomLeft():t.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),i=this.imageRowToCodewordIndex(Math.trunc(r.getY())),a=this.getCodewords(),o=-1;for(let l=s;l<i;l++){if(null==a[l])continue;let t=a[l];t.setRowNumberAsRowIndicatorColumn();let n=t.getRowNumber()-o;0===n||(1===n?o=t.getRowNumber():t.getRowNumber()>=e.getRowCount()?a[l]=null:o=t.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new Zt,n=new Zt,r=new Zt,s=new Zt;for(let a of e){if(null==a)continue;a.setRowNumberAsRowIndicatorColumn();let e=a.getValue()%30,i=a.getRowNumber();switch(this._isLeft||(i+=2),i%3){case 0:n.setValue(3*e+1);break;case 1:s.setValue(e/3),r.setValue(e%3);break;case 2:t.setValue(e+1)}}if(0===t.getValue().length||0===n.getValue().length||0===r.getValue().length||0===s.getValue().length||t.getValue()[0]<1||n.getValue()[0]+r.getValue()[0]<Ut.MIN_ROWS_IN_BARCODE||n.getValue()[0]+r.getValue()[0]>Ut.MAX_ROWS_IN_BARCODE)return null;let i=new Xt(t.getValue()[0],n.getValue()[0],r.getValue()[0],s.getValue()[0]);return this.removeIncorrectCodewords(e,i),i}removeIncorrectCodewords(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(null==e[n])continue;let s=r.getValue()%30,i=r.getRowNumber();if(i>t.getRowCount())e[n]=null;else switch(this._isLeft||(i+=2),i%3){case 0:3*s+1!==t.getRowCountUpperPart()&&(e[n]=null);break;case 1:Math.trunc(s/3)===t.getErrorCorrectionLevel()&&s%3===t.getRowCountLowerPart()||(e[n]=null);break;case 2:s+1!==t.getColumnCount()&&(e[n]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class $t{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e,t=Ut.MAX_CODEWORDS_IN_BARCODE;do{e=t,t=this.adjustRowNumbersAndGetCount()}while(t>0&&t<e);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(0===e)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let e=this.detectionResultColumns[t].getCodewords();for(let n=0;n<e.length;n++)null!=e[n]&&(e[n].hasValidRowNumber()||this.adjustRowNumbers(t,n,e))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<e.length;n++)if(null!=e[n]&&null!=t[n]&&e[n].getRowNumber()===t[n].getRowNumber())for(let t=1;t<=this.barcodeColumnCount;t++){let r=this.detectionResultColumns[t].getCodewords()[n];null!=r&&(r.setRowNumber(e[n].getRowNumber()),r.hasValidRowNumber()||(this.detectionResultColumns[t].getCodewords()[n]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<t.length;n++){if(null==t[n])continue;let r=t[n].getRowNumber(),s=0;for(let t=this.barcodeColumnCount+1;t>0&&s<this.ADJUST_ROW_NUMBER_SKIP;t--){let i=this.detectionResultColumns[t].getCodewords()[n];null!=i&&(s=$t.adjustRowNumberIfValid(r,s,i),i.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let n=0;n<t.length;n++){if(null==t[n])continue;let r=t[n].getRowNumber(),s=0;for(let t=1;t<this.barcodeColumnCount+1&&s<this.ADJUST_ROW_NUMBER_SKIP;t++){let i=this.detectionResultColumns[t].getCodewords()[n];null!=i&&(s=$t.adjustRowNumberIfValid(r,s,i),i.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,n){return null==n||n.hasValidRowNumber()||(n.isValidRowNumber(e)?(n.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,n){if(!this.detectionResultColumns[e-1])return;let r=n[t],s=this.detectionResultColumns[e-1].getCodewords(),i=s;null!=this.detectionResultColumns[e+1]&&(i=this.detectionResultColumns[e+1].getCodewords());let a=new Array(14);a[2]=s[t],a[3]=i[t],t>0&&(a[0]=n[t-1],a[4]=s[t-1],a[5]=i[t-1]),t>1&&(a[8]=n[t-2],a[10]=s[t-2],a[11]=i[t-2]),t<n.length-1&&(a[1]=n[t+1],a[6]=s[t+1],a[7]=i[t+1]),t<n.length-2&&(a[9]=n[t+2],a[12]=s[t+2],a[13]=i[t+2]);for(let o of a)if($t.adjustRowNumber(r,o))return}static adjustRowNumber(e,t){return null!=t&&!(!t.hasValidRowNumber()||t.getBucket()!==e.getBucket())&&(e.setRowNumber(t.getRowNumber()),!0)}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new Qt;for(let n=0;n<e.getCodewords().length;n++){t.format("CW %3d:",n);for(let e=0;e<this.barcodeColumnCount+2;e++){if(null==this.detectionResultColumns[e]){t.format("    |   ");continue}let r=this.detectionResultColumns[e].getCodewords()[n];null!=r?t.format(" %3d|%3d",r.getRowNumber(),r.getValue()):t.format("    |   ")}t.format("%n")}return t.toString()}}class en{constructor(e,t,n,r){this.rowNumber=en.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(n),this.value=Math.trunc(r)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==en.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}en.BARCODE_ROW_UNKNOWN=-1;class tn{static initialize(){for(let e=0;e<Ut.SYMBOL_TABLE.length;e++){let t=Ut.SYMBOL_TABLE[e],n=1&t;for(let r=0;r<Ut.BARS_IN_MODULE;r++){let s=0;for(;(1&t)===n;)s+=1,t>>=1;n=1&t,tn.RATIOS_TABLE[e]||(tn.RATIOS_TABLE[e]=new Array(Ut.BARS_IN_MODULE)),tn.RATIOS_TABLE[e][Ut.BARS_IN_MODULE-r-1]=Math.fround(s/Ut.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=tn.getDecodedCodewordValue(tn.sampleBitCounts(e));return-1!==t?t:tn.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=ie.sum(e),n=new Int32Array(Ut.BARS_IN_MODULE),r=0,s=0;for(let i=0;i<Ut.MODULES_IN_CODEWORD;i++){let a=t/(2*Ut.MODULES_IN_CODEWORD)+i*t/Ut.MODULES_IN_CODEWORD;s+e[r]<=a&&(s+=e[r],r++),n[r]++}return n}static getDecodedCodewordValue(e){let t=tn.getBitValue(e);return-1===Ut.getCodeword(t)?-1:t}static getBitValue(e){let t=0;for(let n=0;n<e.length;n++)for(let r=0;r<e[n];r++)t=t<<1|(n%2===0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=ie.sum(e),n=new Array(Ut.BARS_IN_MODULE);if(t>1)for(let i=0;i<n.length;i++)n[i]=Math.fround(e[i]/t);let r=ae.MAX_VALUE,s=-1;this.bSymbolTableReady||tn.initialize();for(let i=0;i<tn.RATIOS_TABLE.length;i++){let e=0,t=tn.RATIOS_TABLE[i];for(let s=0;s<Ut.BARS_IN_MODULE;s++){let i=Math.fround(t[s]-n[s]);if(e+=Math.fround(i*i),e>=r)break}e<r&&(r=e,s=Ut.SYMBOL_TABLE[i])}return s}}tn.bSymbolTableReady=!1,tn.RATIOS_TABLE=new Array(Ut.SYMBOL_TABLE.length).map(e=>new Array(Ut.BARS_IN_MODULE));class nn{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class rn{static parseLong(e){return parseInt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0)}}class sn extends c{}sn.kind="NullPointerException";class an{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,n){if(null==e)throw new sn;if(t<0||t>e.length||n<0||t+n>e.length||t+n<0)throw new g;if(0!==n)for(let r=0;r<n;r++)this.write(e[t+r])}flush(){}close(){}}class on extends c{}class ln extends an{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(super(),this.count=0,e<0)throw new u("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new on;t=b.MAX_VALUE}this.buf=y.copyOfUint8Array(this.buf,t)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,n){if(t<0||t>e.length||n<0||t+n-e.length>0)throw new g;this.ensureCapacity(this.count+n),p.arraycopy(e,t,this.buf,this.count,n),this.count+=n}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return y.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?"string"===typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}function cn(){if("undefined"!==typeof window)return window.BigInt||null;if("undefined"!==typeof n.g)return n.g.BigInt||null;if("undefined"!==typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let dn;function un(e){if("undefined"===typeof dn&&(dn=cn()),null===dn)throw new Error("BigInt is not supported!");return dn(e)}function hn(){let e=[];e[0]=un(1);let t=un(900);e[1]=t;for(let n=2;n<16;n++)e[n]=e[n-1]*t;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(X||(X={}));class mn{static decode(e,t){let n=new E(""),r=A.ISO8859_1;n.enableDecoding(r);let s=1,i=e[s++],a=new nn;for(;s<e[0];){switch(i){case mn.TEXT_COMPACTION_MODE_LATCH:s=mn.textCompaction(e,s,n);break;case mn.BYTE_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH_6:s=mn.byteCompaction(i,e,r,s,n);break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(e[s++]);break;case mn.NUMERIC_COMPACTION_MODE_LATCH:s=mn.numericCompaction(e,s,n);break;case mn.ECI_CHARSET:A.getCharacterSetECIByValue(e[s++]);break;case mn.ECI_GENERAL_PURPOSE:s+=2;break;case mn.ECI_USER_DEFINED:s++;break;case mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:s=mn.decodeMacroBlock(e,s,a);break;case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case mn.MACRO_PDF417_TERMINATOR:throw new S;default:s--,s=mn.textCompaction(e,s,n)}if(!(s<e.length))throw S.getFormatInstance();i=e[s++]}if(0===n.length())throw S.getFormatInstance();let o=new K(null,n.toString(),null,t);return o.setOther(a),o}static decodeMacroBlock(e,t,n){if(t+mn.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw S.getFormatInstance();let r=new Int32Array(mn.NUMBER_OF_SEQUENCE_CODEWORDS);for(let a=0;a<mn.NUMBER_OF_SEQUENCE_CODEWORDS;a++,t++)r[a]=e[t];n.setSegmentIndex(b.parseInt(mn.decodeBase900toBase10(r,mn.NUMBER_OF_SEQUENCE_CODEWORDS)));let s=new E;t=mn.textCompaction(e,t,s),n.setFileId(s.toString());let i=-1;for(e[t]===mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(i=t+1);t<e[0];)switch(e[t]){case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case mn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let r=new E;t=mn.textCompaction(e,t+1,r),n.setFileName(r.toString());break;case mn.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let s=new E;t=mn.textCompaction(e,t+1,s),n.setSender(s.toString());break;case mn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let i=new E;t=mn.textCompaction(e,t+1,i),n.setAddressee(i.toString());break;case mn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let a=new E;t=mn.numericCompaction(e,t+1,a),n.setSegmentCount(b.parseInt(a.toString()));break;case mn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let o=new E;t=mn.numericCompaction(e,t+1,o),n.setTimestamp(rn.parseLong(o.toString()));break;case mn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let l=new E;t=mn.numericCompaction(e,t+1,l),n.setChecksum(b.parseInt(l.toString()));break;case mn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let c=new E;t=mn.numericCompaction(e,t+1,c),n.setFileSize(rn.parseLong(c.toString()));break;default:throw S.getFormatInstance()}break;case mn.MACRO_PDF417_TERMINATOR:t++,n.setLastSegment(!0);break;default:throw S.getFormatInstance()}if(-1!==i){let r=t-i;n.isLastSegment()&&r--,n.setOptionalData(y.copyOfRange(e,i,i+r))}return t}static textCompaction(e,t,n){let r=new Int32Array(2*(e[0]-t)),s=new Int32Array(2*(e[0]-t)),i=0,a=!1;for(;t<e[0]&&!a;){let n=e[t++];if(n<mn.TEXT_COMPACTION_MODE_LATCH)r[i]=n/30,r[i+1]=n%30,i+=2;else switch(n){case mn.TEXT_COMPACTION_MODE_LATCH:r[i++]=mn.TEXT_COMPACTION_MODE_LATCH;break;case mn.BYTE_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH_6:case mn.NUMERIC_COMPACTION_MODE_LATCH:case mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case mn.MACRO_PDF417_TERMINATOR:t--,a=!0;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r[i]=mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,n=e[t++],s[i]=n,i++}}return mn.decodeTextCompaction(r,s,i,n),t}static decodeTextCompaction(e,t,n,r){let s=X.ALPHA,i=X.ALPHA,a=0;for(;a<n;){let n=e[a],o="";switch(s){case X.ALPHA:if(n<26)o=String.fromCharCode(65+n);else switch(n){case 26:o=" ";break;case mn.LL:s=X.LOWER;break;case mn.ML:s=X.MIXED;break;case mn.PS:i=s,s=X.PUNCT_SHIFT;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[a]);break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}break;case X.LOWER:if(n<26)o=String.fromCharCode(97+n);else switch(n){case 26:o=" ";break;case mn.AS:i=s,s=X.ALPHA_SHIFT;break;case mn.ML:s=X.MIXED;break;case mn.PS:i=s,s=X.PUNCT_SHIFT;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[a]);break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}break;case X.MIXED:if(n<mn.PL)o=mn.MIXED_CHARS[n];else switch(n){case mn.PL:s=X.PUNCT;break;case 26:o=" ";break;case mn.LL:s=X.LOWER;break;case mn.AL:s=X.ALPHA;break;case mn.PS:i=s,s=X.PUNCT_SHIFT;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[a]);break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}break;case X.PUNCT:if(n<mn.PAL)o=mn.PUNCT_CHARS[n];else switch(n){case mn.PAL:s=X.ALPHA;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[a]);break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}break;case X.ALPHA_SHIFT:if(s=i,n<26)o=String.fromCharCode(65+n);else switch(n){case 26:o=" ";break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}break;case X.PUNCT_SHIFT:if(s=i,n<mn.PAL)o=mn.PUNCT_CHARS[n];else switch(n){case mn.PAL:s=X.ALPHA;break;case mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[a]);break;case mn.TEXT_COMPACTION_MODE_LATCH:s=X.ALPHA}}""!==o&&r.append(o),a++}}static byteCompaction(e,t,n,r,s){let i=new ln,a=0,o=0,l=!1;switch(e){case mn.BYTE_COMPACTION_MODE_LATCH:let e=new Int32Array(6),n=t[r++];for(;r<t[0]&&!l;)switch(e[a++]=n,o=900*o+n,n=t[r++],n){case mn.TEXT_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH:case mn.NUMERIC_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH_6:case mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case mn.MACRO_PDF417_TERMINATOR:r--,l=!0;break;default:if(a%5===0&&a>0){for(let e=0;e<6;++e)i.write(Number(un(o)>>un(8*(5-e))));o=0,a=0}}r===t[0]&&n<mn.TEXT_COMPACTION_MODE_LATCH&&(e[a++]=n);for(let t=0;t<a;t++)i.write(e[t]);break;case mn.BYTE_COMPACTION_MODE_LATCH_6:for(;r<t[0]&&!l;){let e=t[r++];if(e<mn.TEXT_COMPACTION_MODE_LATCH)a++,o=900*o+e;else switch(e){case mn.TEXT_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH:case mn.NUMERIC_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH_6:case mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case mn.MACRO_PDF417_TERMINATOR:r--,l=!0}if(a%5===0&&a>0){for(let e=0;e<6;++e)i.write(Number(un(o)>>un(8*(5-e))));o=0,a=0}}}return s.append(C.decode(i.toByteArray(),n)),r}static numericCompaction(e,t,n){let r=0,s=!1,i=new Int32Array(mn.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!s;){let a=e[t++];if(t===e[0]&&(s=!0),a<mn.TEXT_COMPACTION_MODE_LATCH)i[r]=a,r++;else switch(a){case mn.TEXT_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH:case mn.BYTE_COMPACTION_MODE_LATCH_6:case mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case mn.MACRO_PDF417_TERMINATOR:t--,s=!0}(r%mn.MAX_NUMERIC_CODEWORDS===0||a===mn.NUMERIC_COMPACTION_MODE_LATCH||s)&&r>0&&(n.append(mn.decodeBase900toBase10(i,r)),r=0)}return t}static decodeBase900toBase10(e,t){let n=un(0);for(let s=0;s<t;s++)n+=mn.EXP900[t-s-1]*un(e[s]);let r=n.toString();if("1"!==r.charAt(0))throw new S;return r.substring(1)}}mn.TEXT_COMPACTION_MODE_LATCH=900,mn.BYTE_COMPACTION_MODE_LATCH=901,mn.NUMERIC_COMPACTION_MODE_LATCH=902,mn.BYTE_COMPACTION_MODE_LATCH_6=924,mn.ECI_USER_DEFINED=925,mn.ECI_GENERAL_PURPOSE=926,mn.ECI_CHARSET=927,mn.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,mn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,mn.MACRO_PDF417_TERMINATOR=922,mn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,mn.MAX_NUMERIC_CODEWORDS=15,mn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,mn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,mn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,mn.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,mn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,mn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,mn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,mn.PL=25,mn.LL=27,mn.AS=27,mn.ML=28,mn.AL=28,mn.PS=29,mn.PAL=29,mn.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",mn.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",mn.EXP900=cn()?hn():[],mn.NUMBER_OF_SEQUENCE_CODEWORDS=2;class fn{constructor(){}static decode(e,t,n,r,s,i,a){let o,l=new Yt(e,t,n,r,s),c=null,d=null;for(let m=!0;;m=!1){if(null!=t&&(c=fn.getRowIndicatorColumn(e,l,t,!0,i,a)),null!=r&&(d=fn.getRowIndicatorColumn(e,l,r,!1,i,a)),o=fn.merge(c,d),null==o)throw j.getNotFoundInstance();let n=o.getBoundingBox();if(!m||null==n||!(n.getMinY()<l.getMinY()||n.getMaxY()>l.getMaxY()))break;l=n}o.setBoundingBox(l);let u=o.getBarcodeColumnCount()+1;o.setDetectionResultColumn(0,c),o.setDetectionResultColumn(u,d);let h=null!=c;for(let m=1;m<=u;m++){let t,n=h?m:u-m;if(void 0!==o.getDetectionResultColumn(n))continue;t=0===n||n===u?new Jt(l,0===n):new Kt(l),o.setDetectionResultColumn(n,t);let r=-1,s=r;for(let c=l.getMinY();c<=l.getMaxY();c++){if(r=fn.getStartColumn(o,n,c,h),r<0||r>l.getMaxX()){if(-1===s)continue;r=s}let d=fn.detectCodeword(e,l.getMinX(),l.getMaxX(),h,r,c,i,a);null!=d&&(t.setCodeword(c,d),s=r,i=Math.min(i,d.getWidth()),a=Math.max(a,d.getWidth()))}}return fn.createDecoderResult(o)}static merge(e,t){if(null==e&&null==t)return null;let n=fn.getBarcodeMetadata(e,t);if(null==n)return null;let r=Yt.merge(fn.adjustBoundingBox(e),fn.adjustBoundingBox(t));return new $t(n,r)}static adjustBoundingBox(e){if(null==e)return null;let t=e.getRowHeights();if(null==t)return null;let n=fn.getMax(t),r=0;for(let a of t)if(r+=n-a,a>0)break;let s=e.getCodewords();for(let a=0;r>0&&null==s[a];a++)r--;let i=0;for(let a=t.length-1;a>=0&&(i+=n-t[a],!(t[a]>0));a--);for(let a=s.length-1;i>0&&null==s[a];a--)i--;return e.getBoundingBox().addMissingRows(r,i,e.isLeft())}static getMax(e){let t=-1;for(let n of e)t=Math.max(t,n);return t}static getBarcodeMetadata(e,t){let n,r;return null==e||null==(n=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(r=t.getBarcodeMetadata())?n:n.getColumnCount()!==r.getColumnCount()&&n.getErrorCorrectionLevel()!==r.getErrorCorrectionLevel()&&n.getRowCount()!==r.getRowCount()?null:n}static getRowIndicatorColumn(e,t,n,r,s,i){let a=new Jt(t,r);for(let o=0;o<2;o++){let l=0===o?1:-1,c=Math.trunc(Math.trunc(n.getX()));for(let o=Math.trunc(Math.trunc(n.getY()));o<=t.getMaxY()&&o>=t.getMinY();o+=l){let t=fn.detectCodeword(e,0,e.getWidth(),r,c,o,s,i);null!=t&&(a.setCodeword(o,t),c=r?t.getStartX():t.getEndX())}}return a}static adjustCodewordCount(e,t){let n=t[0][1],r=n.getValue(),s=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-fn.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===r.length){if(s<1||s>Ut.MAX_CODEWORDS_IN_BARCODE)throw j.getNotFoundInstance();n.setValue(s)}else r[0]!==s&&n.setValue(s)}static createDecoderResult(e){let t=fn.createBarcodeMatrix(e);fn.adjustCodewordCount(e,t);let n=new Array,r=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),s=[],i=new Array;for(let o=0;o<e.getBarcodeRowCount();o++)for(let a=0;a<e.getBarcodeColumnCount();a++){let l=t[o][a+1].getValue(),c=o*e.getBarcodeColumnCount()+a;0===l.length?n.push(c):1===l.length?r[c]=l[0]:(i.push(c),s.push(l))}let a=new Array(s.length);for(let o=0;o<a.length;o++)a[o]=s[o];return fn.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),r,Ut.toIntArray(n),Ut.toIntArray(i),a)}static createDecoderResultFromAmbiguousValues(e,t,n,r,s){let i=new Int32Array(r.length),a=100;for(;a-- >0;){for(let e=0;e<i.length;e++)t[r[e]]=s[e][i[e]];try{return fn.decodeCodewords(t,e,n)}catch(o){if(!(o instanceof m))throw o}if(0===i.length)throw m.getChecksumInstance();for(let e=0;e<i.length;e++){if(i[e]<s[e].length-1){i[e]++;break}if(i[e]=0,e===i.length-1)throw m.getChecksumInstance()}}throw m.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},()=>new Array(e.getBarcodeColumnCount()+2));for(let r=0;r<t.length;r++)for(let e=0;e<t[r].length;e++)t[r][e]=new Zt;let n=0;for(let r of e.getDetectionResultColumns()){if(null!=r)for(let e of r.getCodewords())if(null!=e){let r=e.getRowNumber();if(r>=0){if(r>=t.length)continue;t[r][n].setValue(e.getValue())}}n++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,n,r){let s=r?1:-1,i=null;if(fn.isValidBarcodeColumn(e,t-s)&&(i=e.getDetectionResultColumn(t-s).getCodeword(n)),null!=i)return r?i.getEndX():i.getStartX();if(i=e.getDetectionResultColumn(t).getCodewordNearby(n),null!=i)return r?i.getStartX():i.getEndX();if(fn.isValidBarcodeColumn(e,t-s)&&(i=e.getDetectionResultColumn(t-s).getCodewordNearby(n)),null!=i)return r?i.getEndX():i.getStartX();let a=0;for(;fn.isValidBarcodeColumn(e,t-s);){t-=s;for(let n of e.getDetectionResultColumn(t).getCodewords())if(null!=n)return(r?n.getEndX():n.getStartX())+s*a*(n.getEndX()-n.getStartX());a++}return r?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,n,r,s,i,a,o){s=fn.adjustCodewordStartColumn(e,t,n,r,s,i);let l,c=fn.getModuleBitCount(e,t,n,r,s,i);if(null==c)return null;let d=ie.sum(c);if(r)l=s+d;else{for(let e=0;e<c.length/2;e++){let t=c[e];c[e]=c[c.length-1-e],c[c.length-1-e]=t}l=s,s=l-d}if(!fn.checkCodewordSkew(d,a,o))return null;let u=tn.getDecodedValue(c),h=Ut.getCodeword(u);return-1===h?null:new en(s,l,fn.getCodewordBucketNumber(u),h)}static getModuleBitCount(e,t,n,r,s,i){let a=s,o=new Int32Array(8),l=0,c=r?1:-1,d=r;for(;(r?a<n:a>=t)&&l<o.length;)e.get(a,i)===d?(o[l]++,a+=c):(l++,d=!d);return l===o.length||a===(r?n:t)&&l===o.length-1?o:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,n,r,s,i){let a=s,o=r?-1:1;for(let l=0;l<2;l++){for(;(r?a>=t:a<n)&&r===e.get(a,i);){if(Math.abs(s-a)>fn.CODEWORD_SKEW_SIZE)return s;a+=o}o=-o,r=!r}return a}static checkCodewordSkew(e,t,n){return t-fn.CODEWORD_SKEW_SIZE<=e&&e<=n+fn.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,n){if(0===e.length)throw S.getFormatInstance();let r=1<<t+1,s=fn.correctErrors(e,n,r);fn.verifyCodewordCount(e,r);let i=mn.decode(e,""+t);return i.setErrorsCorrected(s),i.setErasures(n.length),i}static correctErrors(e,t,n){if(null!=t&&t.length>n/2+fn.MAX_ERRORS||n<0||n>fn.MAX_EC_CODEWORDS)throw m.getChecksumInstance();return fn.errorCorrection.decode(e,n,t)}static verifyCodewordCount(e,t){if(e.length<4)throw S.getFormatInstance();let n=e[0];if(n>e.length)throw S.getFormatInstance();if(0===n){if(!(t<e.length))throw S.getFormatInstance();e[0]=e.length-t}}static getBitCountForCodeword(e){let t=new Int32Array(8),n=0,r=t.length-1;for(;!((1&e)!==n&&(n=1&e,r--,r<0));)t[r]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return fn.getCodewordBucketNumber(fn.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new Qt;for(let n=0;n<e.length;n++){t.format("Row %2d: ",n);for(let r=0;r<e[n].length;r++){let s=e[n][r];0===s.getValue().length?t.format("        ",null):t.format("%4d(%2d)",s.getValue()[0],s.getConfidence(s.getValue()[0]))}t.format("%n")}return t.toString()}}fn.CODEWORD_SKEW_SIZE=2,fn.MAX_ERRORS=3,fn.MAX_EC_CODEWORDS=512,fn.errorCorrection=new Gt;class pn{decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=pn.decode(e,t,!1);if(null==n||0===n.length||null==n[0])throw j.getNotFoundInstance();return n[0]}decodeMultiple(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return pn.decode(e,t,!0)}catch(n){if(n instanceof S||n instanceof m)throw j.getNotFoundInstance();throw n}}static decode(e,t,n){const r=new Array,s=qt.detectMultiple(e,t,n);for(const i of s.getPoints()){const e=fn.decode(s.getBits(),i[4],i[5],i[6],i[7],pn.getMinCodewordWidth(i),pn.getMaxCodewordWidth(i)),t=new U(e.getText(),e.getRawBytes(),void 0,i,q.PDF_417);t.putMetadata(Q.ERROR_CORRECTION_LEVEL,e.getECLevel());const n=e.getOther();null!=n&&t.putMetadata(Q.PDF417_EXTRA_METADATA,n),r.push(t)}return r.map(e=>e)}static getMaxWidth(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return null==e||null==t?b.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(pn.getMaxWidth(e[0],e[4]),pn.getMaxWidth(e[6],e[2])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN),Math.max(pn.getMaxWidth(e[1],e[5]),pn.getMaxWidth(e[7],e[3])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(pn.getMinWidth(e[0],e[4]),pn.getMinWidth(e[6],e[2])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN),Math.min(pn.getMinWidth(e[1],e[5]),pn.getMinWidth(e[7],e[3])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN)))}reset(){}}class gn extends c{}gn.kind="ReaderException";class xn{constructor(e,t){this.verbose=!0===e,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const n=!t(e)&&!0===e.get(N.TRY_HARDER),r=t(e)?null:e.get(N.POSSIBLE_FORMATS),s=new Array;if(!t(r)){const t=r.some(e=>e===q.UPC_A||e===q.UPC_E||e===q.EAN_13||e===q.EAN_8||e===q.CODABAR||e===q.CODE_39||e===q.CODE_93||e===q.CODE_128||e===q.ITF||e===q.RSS_14||e===q.RSS_EXPANDED);t&&!n&&s.push(new lt(e,this.verbose)),r.includes(q.QR_CODE)&&s.push(new Bt),r.includes(q.DATA_MATRIX)&&s.push(new bt),r.includes(q.AZTEC)&&s.push(new xe),r.includes(q.PDF_417)&&s.push(new pn),t&&n&&s.push(new lt(e,this.verbose))}0===s.length&&(n||s.push(new lt(e,this.verbose)),s.push(new Bt),s.push(new bt),s.push(new xe),s.push(new pn),n&&s.push(new lt(e,this.verbose))),this.readers=s}reset(){if(null!==this.readers)for(const e of this.readers)e.reset()}decodeInternal(e){if(null===this.readers)throw new gn("No readers where selected, nothing can be read.");for(const n of this.readers)try{return n.decode(e,this.hints)}catch(t){if(t instanceof gn)continue}throw new j("No MultiFormat Readers were able to detect the code.")}}class yn extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;const n=new xn;n.setHints(e),super(n,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class bn extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;super(new pn,e)}}class wn extends B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;super(new Bt,e)}}var vn;!function(e){e[e.ERROR_CORRECTION=0]="ERROR_CORRECTION",e[e.CHARACTER_SET=1]="CHARACTER_SET",e[e.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",e[e.MIN_SIZE=3]="MIN_SIZE",e[e.MAX_SIZE=4]="MAX_SIZE",e[e.MARGIN=5]="MARGIN",e[e.PDF417_COMPACT=6]="PDF417_COMPACT",e[e.PDF417_COMPACTION=7]="PDF417_COMPACTION",e[e.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",e[e.AZTEC_LAYERS=9]="AZTEC_LAYERS",e[e.QR_VERSION=10]="QR_VERSION"}(vn||(vn={}));var Nn=vn;class Sn{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new J(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let n=t[t.length-1];const r=this.field;for(let s=t.length;s<=e;s++){const e=n.multiply(new J(r,Int32Array.from([1,r.exp(s-1+r.getGeneratorBase())])));t.push(e),n=e}}return t[e]}encode(e,t){if(0===t)throw new u("No error correction bytes");const n=e.length-t;if(n<=0)throw new u("No data bytes provided");const r=this.buildGenerator(t),s=new Int32Array(n);p.arraycopy(e,0,s,0,n);let i=new J(this.field,s);i=i.multiplyByMonomial(t,1);const a=i.divide(r)[1].getCoefficients(),o=t-a.length;for(let l=0;l<o;l++)e[n+l]=0;p.arraycopy(a,0,e,n+o,a.length)}}class An{constructor(){}static applyMaskPenaltyRule1(e){return An.applyMaskPenaltyRule1Internal(e,!0)+An.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const n=e.getArray(),r=e.getWidth(),s=e.getHeight();for(let i=0;i<s-1;i++){const e=n[i];for(let s=0;s<r-1;s++){const r=e[s];r===e[s+1]&&r===n[i+1][s]&&r===n[i+1][s+1]&&t++}}return An.N2*t}static applyMaskPenaltyRule3(e){let t=0;const n=e.getArray(),r=e.getWidth(),s=e.getHeight();for(let i=0;i<s;i++)for(let e=0;e<r;e++){const a=n[i];e+6<r&&1===a[e]&&0===a[e+1]&&1===a[e+2]&&1===a[e+3]&&1===a[e+4]&&0===a[e+5]&&1===a[e+6]&&(An.isWhiteHorizontal(a,e-4,e)||An.isWhiteHorizontal(a,e+7,e+11))&&t++,i+6<s&&1===n[i][e]&&0===n[i+1][e]&&1===n[i+2][e]&&1===n[i+3][e]&&1===n[i+4][e]&&0===n[i+5][e]&&1===n[i+6][e]&&(An.isWhiteVertical(n,e,i-4,i)||An.isWhiteVertical(n,e,i+7,i+11))&&t++}return t*An.N3}static isWhiteHorizontal(e,t,n){t=Math.max(t,0),n=Math.min(n,e.length);for(let r=t;r<n;r++)if(1===e[r])return!1;return!0}static isWhiteVertical(e,t,n,r){n=Math.max(n,0),r=Math.min(r,e.length);for(let s=n;s<r;s++)if(1===e[s][t])return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const n=e.getArray(),r=e.getWidth(),s=e.getHeight();for(let a=0;a<s;a++){const e=n[a];for(let n=0;n<r;n++)1===e[n]&&t++}const i=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-i)/i)*An.N4}static getDataMaskBit(e,t,n){let r,s;switch(e){case 0:r=n+t&1;break;case 1:r=1&n;break;case 2:r=t%3;break;case 3:r=(n+t)%3;break;case 4:r=Math.floor(n/2)+Math.floor(t/3)&1;break;case 5:s=n*t,r=(1&s)+s%3;break;case 6:s=n*t,r=(1&s)+s%3&1;break;case 7:s=n*t,r=s%3+(n+t&1)&1;break;default:throw new u("Invalid mask pattern: "+e)}return 0===r}static applyMaskPenaltyRule1Internal(e,t){let n=0;const r=t?e.getHeight():e.getWidth(),s=t?e.getWidth():e.getHeight(),i=e.getArray();for(let a=0;a<r;a++){let e=0,r=-1;for(let o=0;o<s;o++){const s=t?i[a][o]:i[o][a];s===r?e++:(e>=5&&(n+=An.N1+(e-5)),e=1,r=s)}e>=5&&(n+=An.N1+(e-5))}return n}}An.N1=3,An.N2=3,An.N3=40,An.N4=10;class _n{constructor(e,t){this.width=e,this.height=t;const n=new Array(t);for(let r=0;r!==t;r++)n[r]=new Uint8Array(e);this.bytes=n}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,n){this.bytes[t][e]=n}setBoolean(e,t,n){this.bytes[t][e]=n?1:0}clear(e){for(const t of this.bytes)y.fill(t,e)}equals(e){if(!(e instanceof _n))return!1;const t=e;if(this.width!==t.width)return!1;if(this.height!==t.height)return!1;for(let n=0,r=this.height;n<r;++n){const e=this.bytes[n],r=t.bytes[n];for(let t=0,n=this.width;t<n;++t)if(e[t]!==r[t])return!1}return!0}toString(){const e=new E;for(let t=0,n=this.height;t<n;++t){const n=this.bytes[t];for(let t=0,r=this.width;t<r;++t)switch(n[t]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()}}class Cn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new E;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<Cn.NUM_MASK_PATTERNS}}Cn.NUM_MASK_PATTERNS=8;class In extends c{}In.kind="WriterException";class En{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,n,r,s){En.clearMatrix(s),En.embedBasicPatterns(n,s),En.embedTypeInfo(t,r,s),En.maybeEmbedVersionInfo(n,s),En.embedDataBits(e,r,s)}static embedBasicPatterns(e,t){En.embedPositionDetectionPatternsAndSeparators(t),En.embedDarkDotAtLeftBottomCorner(t),En.maybeEmbedPositionAdjustmentPatterns(e,t),En.embedTimingPatterns(t)}static embedTypeInfo(e,t,n){const r=new w;En.makeTypeInfoBits(e,t,r);for(let s=0,i=r.getSize();s<i;++s){const e=r.get(r.getSize()-1-s),t=En.TYPE_INFO_COORDINATES[s],i=t[0],a=t[1];if(n.setBoolean(i,a,e),s<8){const t=n.getWidth()-s-1,r=8;n.setBoolean(t,r,e)}else{const t=8,r=n.getHeight()-7+(s-8);n.setBoolean(t,r,e)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const n=new w;En.makeVersionInfoBits(e,n);let r=17;for(let s=0;s<6;++s)for(let e=0;e<3;++e){const i=n.get(r);r--,t.setBoolean(s,t.getHeight()-11+e,i),t.setBoolean(t.getHeight()-11+e,s,i)}}static embedDataBits(e,t,n){let r=0,s=-1,i=n.getWidth()-1,a=n.getHeight()-1;for(;i>0;){for(6===i&&(i-=1);a>=0&&a<n.getHeight();){for(let s=0;s<2;++s){const o=i-s;if(!En.isEmpty(n.get(o,a)))continue;let l;r<e.getSize()?(l=e.get(r),++r):l=!1,255!==t&&An.getDataMaskBit(t,o,a)&&(l=!l),n.setBoolean(o,a,l)}a+=s}s=-s,a+=s,i-=2}if(r!==e.getSize())throw new In("Not all bits consumed: "+r+"/"+e.getSize())}static findMSBSet(e){return 32-b.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(0===t)throw new u("0 polynomial");const n=En.findMSBSet(t);for(e<<=n-1;En.findMSBSet(e)>=n;)e^=t<<En.findMSBSet(e)-n;return e}static makeTypeInfoBits(e,t,n){if(!Cn.isValidMaskPattern(t))throw new In("Invalid mask pattern");const r=e.getBits()<<3|t;n.appendBits(r,5);const s=En.calculateBCHCode(r,En.TYPE_INFO_POLY);n.appendBits(s,10);const i=new w;if(i.appendBits(En.TYPE_INFO_MASK_PATTERN,15),n.xor(i),15!==n.getSize())throw new In("should not happen but we got: "+n.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const n=En.calculateBCHCode(e.getVersionNumber(),En.VERSION_INFO_POLY);if(t.appendBits(n,12),18!==t.getSize())throw new In("should not happen but we got: "+t.getSize())}static isEmpty(e){return 255===e}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const n=(t+1)%2;En.isEmpty(e.get(t,6))&&e.setNumber(t,6,n),En.isEmpty(e.get(6,t))&&e.setNumber(6,t,n)}}static embedDarkDotAtLeftBottomCorner(e){if(0===e.get(8,e.getHeight()-8))throw new In;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,n){for(let r=0;r<8;++r){if(!En.isEmpty(n.get(e+r,t)))throw new In;n.setNumber(e+r,t,0)}}static embedVerticalSeparationPattern(e,t,n){for(let r=0;r<7;++r){if(!En.isEmpty(n.get(e,t+r)))throw new In;n.setNumber(e,t+r,0)}}static embedPositionAdjustmentPattern(e,t,n){for(let r=0;r<5;++r){const s=En.POSITION_ADJUSTMENT_PATTERN[r];for(let i=0;i<5;++i)n.setNumber(e+i,t+r,s[i])}}static embedPositionDetectionPattern(e,t,n){for(let r=0;r<7;++r){const s=En.POSITION_DETECTION_PATTERN[r];for(let i=0;i<7;++i)n.setNumber(e+i,t+r,s[i])}}static embedPositionDetectionPatternsAndSeparators(e){const t=En.POSITION_DETECTION_PATTERN[0].length;En.embedPositionDetectionPattern(0,0,e),En.embedPositionDetectionPattern(e.getWidth()-t,0,e),En.embedPositionDetectionPattern(0,e.getWidth()-t,e);const n=8;En.embedHorizontalSeparationPattern(0,n-1,e),En.embedHorizontalSeparationPattern(e.getWidth()-n,n-1,e),En.embedHorizontalSeparationPattern(0,e.getWidth()-n,e);const r=7;En.embedVerticalSeparationPattern(r,0,e),En.embedVerticalSeparationPattern(e.getHeight()-r-1,0,e),En.embedVerticalSeparationPattern(r,e.getHeight()-r,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const n=e.getVersionNumber()-1,r=En.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n];for(let s=0,i=r.length;s!==i;s++){const e=r[s];if(e>=0)for(let n=0;n!==i;n++){const s=r[n];s>=0&&En.isEmpty(t.get(s,e))&&En.embedPositionAdjustmentPattern(s-2,e-2,t)}}}}En.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),En.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),En.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),En.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),En.VERSION_INFO_POLY=7973,En.TYPE_INFO_POLY=1335,En.TYPE_INFO_MASK_PATTERN=21522;class Tn{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class jn{constructor(){}static calculateMaskPenalty(e){return An.applyMaskPenaltyRule1(e)+An.applyMaskPenaltyRule2(e)+An.applyMaskPenaltyRule3(e)+An.applyMaskPenaltyRule4(e)}static encode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=jn.DEFAULT_BYTE_MODE_ENCODING;const s=null!==n&&void 0!==n.get(Nn.CHARACTER_SET);s&&(r=n.get(Nn.CHARACTER_SET).toString());const i=this.chooseMode(e,r),a=new w;if(i===Tt.BYTE&&(s||jn.DEFAULT_BYTE_MODE_ENCODING!==r)){const e=A.getCharacterSetECIByName(r);void 0!==e&&this.appendECI(e,a)}this.appendModeInfo(i,a);const o=new w;let l;if(this.appendBytes(e,i,o,r),null!==n&&void 0!==n.get(Nn.QR_VERSION)){const e=Number.parseInt(n.get(Nn.QR_VERSION).toString(),10);l=_t.getVersionForNumber(e);const r=this.calculateBitsNeeded(i,a,o,l);if(!this.willFit(r,l,t))throw new In("Data too big for requested version")}else l=this.recommendVersion(t,i,a,o);const c=new w;c.appendBitArray(a);const d=i===Tt.BYTE?o.getSizeInBytes():e.length;this.appendLengthInfo(d,l,i,c),c.appendBitArray(o);const u=l.getECBlocksForLevel(t),h=l.getTotalCodewords()-u.getTotalECCodewords();this.terminateBits(h,c);const m=this.interleaveWithECBytes(c,l.getTotalCodewords(),h,u.getNumBlocks()),f=new Cn;f.setECLevel(t),f.setMode(i),f.setVersion(l);const p=l.getDimensionForVersion(),g=new _n(p,p),x=this.chooseMaskPattern(m,t,l,g);return f.setMaskPattern(x),En.buildMatrix(m,t,l,x,g),f.setMatrix(g),f}static recommendVersion(e,t,n,r){const s=this.calculateBitsNeeded(t,n,r,_t.getVersionForNumber(1)),i=this.chooseVersion(s,e),a=this.calculateBitsNeeded(t,n,r,i);return this.chooseVersion(a,e)}static calculateBitsNeeded(e,t,n,r){return t.getSize()+e.getCharacterCountBits(r)+n.getSize()}static getAlphanumericCode(e){return e<jn.ALPHANUMERIC_TABLE.length?jn.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(A.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return Tt.KANJI;let n=!1,r=!1;for(let s=0,i=e.length;s<i;++s){const t=e.charAt(s);if(jn.isDigit(t))n=!0;else{if(-1===this.getAlphanumericCode(t.charCodeAt(0)))return Tt.BYTE;r=!0}}return r?Tt.ALPHANUMERIC:n?Tt.NUMERIC:Tt.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=C.encode(e,A.SJIS)}catch(r){return!1}const n=t.length;if(n%2!==0)return!1;for(let s=0;s<n;s+=2){const e=255&t[s];if((e<129||e>159)&&(e<224||e>235))return!1}return!0}static chooseMaskPattern(e,t,n,r){let s=Number.MAX_SAFE_INTEGER,i=-1;for(let a=0;a<Cn.NUM_MASK_PATTERNS;a++){En.buildMatrix(e,t,n,a,r);let o=this.calculateMaskPenalty(r);o<s&&(s=o,i=a)}return i}static chooseVersion(e,t){for(let n=1;n<=40;n++){const r=_t.getVersionForNumber(n);if(jn.willFit(e,r,t))return r}throw new In("Data too big")}static willFit(e,t,n){return t.getTotalCodewords()-t.getECBlocksForLevel(n).getTotalECCodewords()>=(e+7)/8}static terminateBits(e,t){const n=8*e;if(t.getSize()>n)throw new In("data bits cannot fit in the QR Code"+t.getSize()+" > "+n);for(let i=0;i<4&&t.getSize()<n;++i)t.appendBit(!1);const r=7&t.getSize();if(r>0)for(let i=r;i<8;i++)t.appendBit(!1);const s=e-t.getSizeInBytes();for(let i=0;i<s;++i)t.appendBits(0===(1&i)?236:17,8);if(t.getSize()!==n)throw new In("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,n,r,s,i){if(r>=n)throw new In("Block ID too large");const a=e%n,o=n-a,l=Math.floor(e/n),c=l+1,d=Math.floor(t/n),u=d+1,h=l-d,m=c-u;if(h!==m)throw new In("EC bytes mismatch");if(n!==o+a)throw new In("RS blocks mismatch");if(e!==(d+h)*o+(u+m)*a)throw new In("Total bytes mismatch");r<o?(s[0]=d,i[0]=h):(s[0]=u,i[0]=m)}static interleaveWithECBytes(e,t,n,r){if(e.getSizeInBytes()!==n)throw new In("Number of bits and data bytes does not match");let s=0,i=0,a=0;const o=new Array;for(let c=0;c<r;++c){const l=new Int32Array(1),d=new Int32Array(1);jn.getNumDataBytesAndNumECBytesForBlockID(t,n,r,c,l,d);const u=l[0],h=new Uint8Array(u);e.toBytes(8*s,h,0,u);const m=jn.generateECBytes(h,d[0]);o.push(new Tn(h,m)),i=Math.max(i,u),a=Math.max(a,m.length),s+=l[0]}if(n!==s)throw new In("Data bytes does not match offset");const l=new w;for(let c=0;c<i;++c)for(const e of o){const t=e.getDataBytes();c<t.length&&l.appendBits(t[c],8)}for(let c=0;c<a;++c)for(const e of o){const t=e.getErrorCorrectionBytes();c<t.length&&l.appendBits(t[c],8)}if(t!==l.getSizeInBytes())throw new In("Interleaving error: "+t+" and "+l.getSizeInBytes()+" differ.");return l}static generateECBytes(e,t){const n=e.length,r=new Int32Array(n+t);for(let i=0;i<n;i++)r[i]=255&e[i];new Sn(ee.QR_CODE_FIELD_256).encode(r,t);const s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=r[n+i];return s}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,n,r){const s=n.getCharacterCountBits(t);if(e>=1<<s)throw new In(e+" is bigger than "+((1<<s)-1));r.appendBits(e,s)}static appendBytes(e,t,n,r){switch(t){case Tt.NUMERIC:jn.appendNumericBytes(e,n);break;case Tt.ALPHANUMERIC:jn.appendAlphanumericBytes(e,n);break;case Tt.BYTE:jn.append8BitBytes(e,n,r);break;case Tt.KANJI:jn.appendKanjiBytes(e,n);break;default:throw new In("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=jn.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const n=e.length;let r=0;for(;r<n;){const s=jn.getDigit(e.charAt(r));if(r+2<n){const n=jn.getDigit(e.charAt(r+1)),i=jn.getDigit(e.charAt(r+2));t.appendBits(100*s+10*n+i,10),r+=3}else if(r+1<n){const n=jn.getDigit(e.charAt(r+1));t.appendBits(10*s+n,7),r+=2}else t.appendBits(s,4),r++}}static appendAlphanumericBytes(e,t){const n=e.length;let r=0;for(;r<n;){const s=jn.getAlphanumericCode(e.charCodeAt(r));if(-1===s)throw new In;if(r+1<n){const n=jn.getAlphanumericCode(e.charCodeAt(r+1));if(-1===n)throw new In;t.appendBits(45*s+n,11),r+=2}else t.appendBits(s,6),r++}}static append8BitBytes(e,t,n){let r;try{r=C.encode(e,n)}catch(s){throw new In(s)}for(let i=0,a=r.length;i!==a;i++){const e=r[i];t.appendBits(e,8)}}static appendKanjiBytes(e,t){let n;try{n=C.encode(e,A.SJIS)}catch(s){throw new In(s)}const r=n.length;for(let i=0;i<r;i+=2){const e=(255&n[i])<<8&4294967295|255&n[i+1];let r=-1;if(e>=33088&&e<=40956?r=e-33088:e>=57408&&e<=60351&&(r=e-49472),-1===r)throw new In("Invalid byte sequence");const s=192*(r>>8)+(255&r);t.appendBits(s,13)}}static appendECI(e,t){t.appendBits(Tt.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}jn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),jn.DEFAULT_BYTE_MODE_ENCODING=A.UTF8.getName();class kn{write(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(0===e.length)throw new u("Found empty contents");if(t<0||n<0)throw new u("Requested dimensions are too small: "+t+"x"+n);let s=vt.L,i=kn.QUIET_ZONE_SIZE;null!==r&&(void 0!==r.get(Nn.ERROR_CORRECTION)&&(s=vt.fromString(r.get(Nn.ERROR_CORRECTION).toString())),void 0!==r.get(Nn.MARGIN)&&(i=Number.parseInt(r.get(Nn.MARGIN).toString(),10)));const a=jn.encode(e,s,r);return this.renderResult(a,t,n,i)}writeToDom(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;"string"===typeof e&&(e=document.querySelector(e));const i=this.write(t,n,r,s);e&&e.appendChild(i)}renderResult(e,t,n,r){const s=e.getMatrix();if(null===s)throw new ne;const i=s.getWidth(),a=s.getHeight(),o=i+2*r,l=a+2*r,c=Math.max(t,o),d=Math.max(n,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-i*u)/2),m=Math.floor((d-a*u)/2),f=this.createSVGElement(c,d);for(let p=0,g=m;p<a;p++,g+=u)for(let e=0,t=h;e<i;e++,t+=u)if(1===s.get(e,p)){const e=this.createSvgRectElement(t,g,u,u);f.appendChild(e)}return f}createSVGElement(e,t){const n=document.createElementNS(kn.SVG_NS,"svg");return n.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width",t.toString()),n}createSvgRectElement(e,t,n,r){const s=document.createElementNS(kn.SVG_NS,"rect");return s.setAttributeNS(null,"x",e.toString()),s.setAttributeNS(null,"y",t.toString()),s.setAttributeNS(null,"height",n.toString()),s.setAttributeNS(null,"width",r.toString()),s.setAttributeNS(null,"fill","#000000"),s}}kn.QUIET_ZONE_SIZE=4,kn.SVG_NS="http://www.w3.org/2000/svg";class Dn{encode(e,t,n,r,s){if(0===e.length)throw new u("Found empty contents");if(t!==q.QR_CODE)throw new u("Can only encode QR_CODE, but got "+t);if(n<0||r<0)throw new u("Requested dimensions are too small: ".concat(n,"x").concat(r));let i=vt.L,a=Dn.QUIET_ZONE_SIZE;null!==s&&(void 0!==s.get(Nn.ERROR_CORRECTION)&&(i=vt.fromString(s.get(Nn.ERROR_CORRECTION).toString())),void 0!==s.get(Nn.MARGIN)&&(a=Number.parseInt(s.get(Nn.MARGIN).toString(),10)));const o=jn.encode(e,i,s);return Dn.renderResult(o,n,r,a)}static renderResult(e,t,n,r){const s=e.getMatrix();if(null===s)throw new ne;const i=s.getWidth(),a=s.getHeight(),o=i+2*r,l=a+2*r,c=Math.max(t,o),d=Math.max(n,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-i*u)/2),m=Math.floor((d-a*u)/2),f=new T(c,d);for(let p=0,g=m;p<a;p++,g+=u)for(let e=0,t=h;e<i;e++,t+=u)1===s.get(e,p)&&f.setRegion(t,g,u,u);return f}}Dn.QUIET_ZONE_SIZE=4;class Pn{encode(e,t,n,r,s){let i;if(t!==q.QR_CODE)throw new u("No encoder available for format "+t);return i=new Dn,i.encode(e,t,n,r,s)}}class Rn extends P{constructor(e,t,n,r,s,i,a,o){if(super(i,a),this.yuvData=e,this.dataWidth=t,this.dataHeight=n,this.left=r,this.top=s,r+i>t||s+a>n)throw new u("Crop rectangle does not fit within image data.");o&&this.reverseHorizontal(i,a)}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const n=this.getWidth();(null===t||void 0===t||t.length<n)&&(t=new Uint8ClampedArray(n));const r=(e+this.top)*this.dataWidth+this.left;return p.arraycopy(this.yuvData,r,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const n=e*t,r=new Uint8ClampedArray(n);let s=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return p.arraycopy(this.yuvData,s,r,0,n),r;for(let i=0;i<t;i++){const t=i*e;p.arraycopy(this.yuvData,s,r,t,e),s+=this.dataWidth}return r}isCropSupported(){return!0}crop(e,t,n,r){return new Rn(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,n,r,!1)}renderThumbnail(){const e=this.getWidth()/Rn.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/Rn.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(e*t),r=this.yuvData;let s=this.top*this.dataWidth+this.left;for(let i=0;i<t;i++){const t=i*e;for(let i=0;i<e;i++){const e=255&r[s+i*Rn.THUMBNAIL_SCALE_FACTOR];n[t+i]=4278190080|65793*e}s+=this.dataWidth*Rn.THUMBNAIL_SCALE_FACTOR}return n}getThumbnailWidth(){return this.getWidth()/Rn.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Rn.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const n=this.yuvData;for(let r=0,s=this.top*this.dataWidth+this.left;r<t;r++,s+=this.dataWidth){const t=s+e/2;for(let r=s,i=s+e-1;r<t;r++,i--){const e=n[r];n[r]=n[i],n[i]=e}}}invert(){return new R(this)}}Rn.THUMBNAIL_SCALE_FACTOR=2;class On extends P{constructor(e,t,n,r,s,i,a){if(super(t,n),this.dataWidth=r,this.dataHeight=s,this.left=i,this.top=a,4===e.BYTES_PER_ELEMENT){const r=t*n,s=new Uint8ClampedArray(r);for(let t=0;t<r;t++){const n=e[t],r=n>>16&255,i=n>>7&510,a=255&n;s[t]=(r+i+a)/4&255}this.luminances=s}else this.luminances=e;if(void 0===r&&(this.dataWidth=t),void 0===s&&(this.dataHeight=n),void 0===i&&(this.left=0),void 0===a&&(this.top=0),this.left+t>this.dataWidth||this.top+n>this.dataHeight)throw new u("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const n=this.getWidth();(null===t||void 0===t||t.length<n)&&(t=new Uint8ClampedArray(n));const r=(e+this.top)*this.dataWidth+this.left;return p.arraycopy(this.luminances,r,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const n=e*t,r=new Uint8ClampedArray(n);let s=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return p.arraycopy(this.luminances,s,r,0,n),r;for(let i=0;i<t;i++){const t=i*e;p.arraycopy(this.luminances,s,r,t,e),s+=this.dataWidth}return r}isCropSupported(){return!0}crop(e,t,n,r){return new On(this.luminances,n,r,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new R(this)}}class Ln extends A{static forName(e){return this.getCharacterSetECIByName(e)}}class Mn{}Mn.ISO_8859_1=A.ISO8859_1;class Fn{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class Bn{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class Un{constructor(e){this.previous=e}getPrevious(){return this.previous}}class zn extends Un{constructor(e,t,n){super(e),this.value=t,this.bitCount=n}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new zn(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new zn(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+b.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class qn extends zn{constructor(e,t,n){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=n}appendTo(e,t){for(let n=0;n<this.binaryShiftByteCount;n++)(0===n||31===n&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===n?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+n],8)}addBinaryShift(e,t){return new qn(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Hn(e,t,n){return new qn(e,t,n)}function Vn(e,t,n){return new zn(e,t,n)}const Wn=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Gn=0,Yn=1,Xn=2,Qn=3,Kn=4,Zn=new zn(null,0,0),Jn=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];function $n(e){for(let t of e)y.fill(t,-1);return e[Gn][Kn]=0,e[Yn][Kn]=0,e[Yn][Gn]=28,e[Qn][Kn]=0,e[Xn][Kn]=0,e[Xn][Gn]=15,e}const er=$n(y.createInt32Array(6,6));class tr{constructor(e,t,n,r){this.token=e,this.mode=t,this.binaryShiftByteCount=n,this.bitCount=r}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let n=this.bitCount,r=this.token;if(e!==this.mode){let t=Jn[this.mode][e];r=Vn(r,65535&t,t>>16),n+=t>>16}let s=e===Xn?4:5;return r=Vn(r,t,s),new tr(r,e,0,n+s)}shiftAndAppend(e,t){let n=this.token,r=this.mode===Xn?4:5;return n=Vn(n,er[this.mode][e],r),n=Vn(n,t,5),new tr(n,this.mode,0,this.bitCount+r+5)}addBinaryShiftChar(e){let t=this.token,n=this.mode,r=this.bitCount;if(this.mode===Kn||this.mode===Xn){let e=Jn[n][Gn];t=Vn(t,65535&e,e>>16),r+=e>>16,n=Gn}let s=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,i=new tr(t,n,this.binaryShiftByteCount+1,r+s);return 2078===i.binaryShiftByteCount&&(i=i.endBinaryShift(e+1)),i}endBinaryShift(e){if(0===this.binaryShiftByteCount)return this;let t=this.token;return t=Hn(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new tr(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(Jn[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=tr.calculateBinaryShiftCost(e)-tr.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let r=this.endBinaryShift(e.length).token;null!==r;r=r.getPrevious())t.unshift(r);let n=new w;for(const r of t)r.appendTo(n,e);return n}toString(){return I.format("%s bits=%d bytes=%d",Wn[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}function nr(e){const t=I.getCharCode(" "),n=I.getCharCode("."),r=I.getCharCode(",");e[Gn][t]=1;const s=I.getCharCode("Z"),i=I.getCharCode("A");for(let h=i;h<=s;h++)e[Gn][h]=h-i+2;e[Yn][t]=1;const a=I.getCharCode("z"),o=I.getCharCode("a");for(let h=o;h<=a;h++)e[Yn][h]=h-o+2;e[Xn][t]=1;const l=I.getCharCode("9"),c=I.getCharCode("0");for(let h=c;h<=l;h++)e[Xn][h]=h-c+2;e[Xn][r]=12,e[Xn][n]=13;const d=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~","\x7f"];for(let h=0;h<d.length;h++)e[Qn][I.getCharCode(d[h])]=h;const u=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let h=0;h<u.length;h++)I.getCharCode(u[h])>0&&(e[Kn][I.getCharCode(u[h])]=h);return e}tr.INITIAL_STATE=new tr(Zn,Gn,0,0);const rr=nr(y.createInt32Array(5,256));class sr{constructor(e){this.text=e}encode(){const e=I.getCharCode(" "),t=I.getCharCode("\n");let n=Bn.singletonList(tr.INITIAL_STATE);for(let r=0;r<this.text.length;r++){let s,i=r+1<this.text.length?this.text[r+1]:0;switch(this.text[r]){case I.getCharCode("\r"):s=i===t?2:0;break;case I.getCharCode("."):s=i===e?3:0;break;case I.getCharCode(","):s=i===e?4:0;break;case I.getCharCode(":"):s=i===e?5:0;break;default:s=0}s>0?(n=sr.updateStateListForPair(n,r,s),r++):n=this.updateStateListForChar(n,r)}return Bn.min(n,(e,t)=>e.getBitCount()-t.getBitCount()).toBitArray(this.text)}updateStateListForChar(e,t){const n=[];for(let r of e)this.updateStateForChar(r,t,n);return sr.simplifyStates(n)}updateStateForChar(e,t,n){let r=255&this.text[t],s=rr[e.getMode()][r]>0,i=null;for(let a=0;a<=Kn;a++){let o=rr[a][r];if(o>0){if(null==i&&(i=e.endBinaryShift(t)),!s||a===e.getMode()||a===Xn){const e=i.latchAndAppend(a,o);n.push(e)}if(!s&&er[e.getMode()][a]>=0){const e=i.shiftAndAppend(a,o);n.push(e)}}}if(e.getBinaryShiftByteCount()>0||0===rr[e.getMode()][r]){let r=e.addBinaryShiftChar(t);n.push(r)}}static updateStateListForPair(e,t,n){const r=[];for(let s of e)this.updateStateForPair(s,t,n,r);return this.simplifyStates(r)}static updateStateForPair(e,t,n,r){let s=e.endBinaryShift(t);if(r.push(s.latchAndAppend(Kn,n)),e.getMode()!==Kn&&r.push(s.shiftAndAppend(Kn,n)),3===n||4===n){let e=s.latchAndAppend(Xn,16-n).latchAndAppend(Xn,1);r.push(e)}if(e.getBinaryShiftByteCount()>0){let n=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);r.push(n)}}static simplifyStates(e){let t=[];for(const n of e){let e=!0;for(const r of t){if(r.isBetterThanOrEqualTo(n)){e=!1;break}n.isBetterThanOrEqualTo(r)&&(t=t.filter(e=>e!==r))}e&&t.push(n)}return t}}class ir{constructor(){}static encodeBytes(e){return ir.encode(e,ir.DEFAULT_EC_PERCENT,ir.DEFAULT_AZTEC_LAYERS)}static encode(e,t,n){let r,s,i,a,o,l=new sr(e).encode(),c=b.truncDivision(l.getSize()*t,100)+11,d=l.getSize()+c;if(n!==ir.DEFAULT_AZTEC_LAYERS){if(r=n<0,s=Math.abs(n),s>(r?ir.MAX_NB_BITS_COMPACT:ir.MAX_NB_BITS))throw new u(I.format("Illegal value %s for layers",n));i=ir.totalBitsInLayer(s,r),a=ir.WORD_SIZE[s];let e=i-i%a;if(o=ir.stuffBits(l,a),o.getSize()+c>e)throw new u("Data to large for user specified layer");if(r&&o.getSize()>64*a)throw new u("Data to large for user specified layer")}else{a=0,o=null;for(let e=0;;e++){if(e>ir.MAX_NB_BITS)throw new u("Data too large for an Aztec code");if(r=e<=3,s=r?e+1:e,i=ir.totalBitsInLayer(s,r),d>i)continue;null!=o&&a===ir.WORD_SIZE[s]||(a=ir.WORD_SIZE[s],o=ir.stuffBits(l,a));let t=i-i%a;if(!(r&&o.getSize()>64*a)&&o.getSize()+c<=t)break}}let h,m=ir.generateCheckWords(o,i,a),f=o.getSize()/a,p=ir.generateModeMessage(r,s,f),g=(r?11:14)+4*s,x=new Int32Array(g);if(r){h=g;for(let e=0;e<x.length;e++)x[e]=e}else{h=g+1+2*b.truncDivision(b.truncDivision(g,2)-1,15);let e=b.truncDivision(g,2),t=b.truncDivision(h,2);for(let n=0;n<e;n++){let r=n+b.truncDivision(n,15);x[e-n-1]=t-r-1,x[e+n]=t+r+1}}let y=new T(h);for(let u=0,b=0;u<s;u++){let e=4*(s-u)+(r?9:12);for(let t=0;t<e;t++){let n=2*t;for(let r=0;r<2;r++)m.get(b+n+r)&&y.set(x[2*u+r],x[2*u+t]),m.get(b+2*e+n+r)&&y.set(x[2*u+t],x[g-1-2*u-r]),m.get(b+4*e+n+r)&&y.set(x[g-1-2*u-r],x[g-1-2*u-t]),m.get(b+6*e+n+r)&&y.set(x[g-1-2*u-t],x[2*u+r])}b+=8*e}if(ir.drawModeMessage(y,r,h,p),r)ir.drawBullsEye(y,b.truncDivision(h,2),5);else{ir.drawBullsEye(y,b.truncDivision(h,2),7);for(let e=0,t=0;e<b.truncDivision(g,2)-1;e+=15,t+=16)for(let n=1&b.truncDivision(h,2);n<h;n+=2)y.set(b.truncDivision(h,2)-t,n),y.set(b.truncDivision(h,2)+t,n),y.set(n,b.truncDivision(h,2)-t),y.set(n,b.truncDivision(h,2)+t)}let w=new Fn;return w.setCompact(r),w.setSize(h),w.setLayers(s),w.setCodeWords(f),w.setMatrix(y),w}static drawBullsEye(e,t,n){for(let r=0;r<n;r+=2)for(let n=t-r;n<=t+r;n++)e.set(n,t-r),e.set(n,t+r),e.set(t-r,n),e.set(t+r,n);e.set(t-n,t-n),e.set(t-n+1,t-n),e.set(t-n,t-n+1),e.set(t+n,t-n),e.set(t+n,t-n+1),e.set(t+n,t+n-1)}static generateModeMessage(e,t,n){let r=new w;return e?(r.appendBits(t-1,2),r.appendBits(n-1,6),r=ir.generateCheckWords(r,28,4)):(r.appendBits(t-1,5),r.appendBits(n-1,11),r=ir.generateCheckWords(r,40,4)),r}static drawModeMessage(e,t,n,r){let s=b.truncDivision(n,2);if(t)for(let i=0;i<7;i++){let t=s-3+i;r.get(i)&&e.set(t,s-5),r.get(i+7)&&e.set(s+5,t),r.get(20-i)&&e.set(t,s+5),r.get(27-i)&&e.set(s-5,t)}else for(let i=0;i<10;i++){let t=s-5+i+b.truncDivision(i,5);r.get(i)&&e.set(t,s-7),r.get(i+10)&&e.set(s+7,t),r.get(29-i)&&e.set(t,s+7),r.get(39-i)&&e.set(s-7,t)}}static generateCheckWords(e,t,n){let r=e.getSize()/n,s=new Sn(ir.getGF(n)),i=b.truncDivision(t,n),a=ir.bitsToWords(e,n,i);s.encode(a,i-r);let o=t%n,l=new w;l.appendBits(0,o);for(const c of Array.from(a))l.appendBits(c,n);return l}static bitsToWords(e,t,n){let r,s,i=new Int32Array(n);for(r=0,s=e.getSize()/t;r<s;r++){let n=0;for(let s=0;s<t;s++)n|=e.get(r*t+s)?1<<t-s-1:0;i[r]=n}return i}static getGF(e){switch(e){case 4:return ee.AZTEC_PARAM;case 6:return ee.AZTEC_DATA_6;case 8:return ee.AZTEC_DATA_8;case 10:return ee.AZTEC_DATA_10;case 12:return ee.AZTEC_DATA_12;default:throw new u("Unsupported word size "+e)}}static stuffBits(e,t){let n=new w,r=e.getSize(),s=(1<<t)-2;for(let i=0;i<r;i+=t){let a=0;for(let n=0;n<t;n++)(i+n>=r||e.get(i+n))&&(a|=1<<t-1-n);(a&s)===s?(n.appendBits(a&s,t),i--):0===(a&s)?(n.appendBits(1|a,t),i--):n.appendBits(a,t)}return n}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}ir.DEFAULT_EC_PERCENT=33,ir.DEFAULT_AZTEC_LAYERS=0,ir.MAX_NB_BITS=32,ir.MAX_NB_BITS_COMPACT=4,ir.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class ar{encode(e,t,n,r){return this.encodeWithHints(e,t,n,r,null)}encodeWithHints(e,t,n,r,s){let i=Mn.ISO_8859_1,a=ir.DEFAULT_EC_PERCENT,o=ir.DEFAULT_AZTEC_LAYERS;return null!=s&&(s.has(Nn.CHARACTER_SET)&&(i=Ln.forName(s.get(Nn.CHARACTER_SET).toString())),s.has(Nn.ERROR_CORRECTION)&&(a=b.parseInt(s.get(Nn.ERROR_CORRECTION).toString())),s.has(Nn.AZTEC_LAYERS)&&(o=b.parseInt(s.get(Nn.AZTEC_LAYERS).toString()))),ar.encodeLayers(e,t,n,r,i,a,o)}static encodeLayers(e,t,n,r,s,i,a){if(t!==q.AZTEC)throw new u("Can only encode AZTEC, but got "+t);let o=ir.encode(I.getBytes(e,s),i,a);return ar.renderResult(o,n,r)}static renderResult(e,t,n){let r=e.getMatrix();if(null==r)throw new ne;let s=r.getWidth(),i=r.getHeight(),a=Math.max(t,s),o=Math.max(n,i),l=Math.min(a/s,o/i),c=(a-s*l)/2,d=(o-i*l)/2,u=new T(a,o);for(let h=0,m=d;h<i;h++,m+=l)for(let e=0,t=c;e<s;e++,t+=l)r.get(e,h)&&u.setRegion(t,m,l,l);return u}}e.AbstractExpandedDecoder=We,e.ArgumentException=d,e.ArithmeticException=$,e.AztecCode=Fn,e.AztecCodeReader=xe,e.AztecCodeWriter=ar,e.AztecDecoder=se,e.AztecDetector=ge,e.AztecDetectorResult=ce,e.AztecEncoder=ir,e.AztecHighLevelEncoder=sr,e.AztecPoint=pe,e.BarcodeFormat=q,e.Binarizer=f,e.BinaryBitmap=h,e.BitArray=w,e.BitMatrix=T,e.BitSource=pt,e.BrowserAztecCodeReader=ye,e.BrowserBarcodeReader=ct,e.BrowserCodeReader=B,e.BrowserDatamatrixCodeReader=wt,e.BrowserMultiFormatReader=yn,e.BrowserPDF417Reader=bn,e.BrowserQRCodeReader=wn,e.BrowserQRCodeSvgWriter=kn,e.CharacterSetECI=A,e.ChecksumException=m,e.Code128Reader=we,e.Code39Reader=ve,e.DataMatrixDecodedBitStreamParser=gt,e.DataMatrixReader=bt,e.DecodeHintType=N,e.DecoderResult=K,e.DefaultGridSampler=me,e.DetectorResult=le,e.EAN13Reader=Ee,e.EncodeHintType=Nn,e.Exception=c,e.FormatException=S,e.GenericGF=ee,e.GenericGFPoly=J,e.GlobalHistogramBinarizer=k,e.GridSampler=ue,e.GridSamplerInstance=fe,e.HTMLCanvasElementLuminanceSource=O,e.HybridBinarizer=D,e.ITFReader=Ne,e.IllegalArgumentException=u,e.IllegalStateException=ne,e.InvertedLuminanceSource=R,e.LuminanceSource=P,e.MathUtils=ie,e.MultiFormatOneDReader=lt,e.MultiFormatReader=xn,e.MultiFormatWriter=Pn,e.NotFoundException=j,e.OneDReader=be,e.PDF417DecodedBitStreamParser=mn,e.PDF417DecoderErrorCorrection=Gt,e.PDF417Reader=pn,e.PDF417ResultMetadata=nn,e.PerspectiveTransform=he,e.PlanarYUVLuminanceSource=Rn,e.QRCodeByteMatrix=_n,e.QRCodeDataMask=Ct,e.QRCodeDecodedBitStreamParser=jt,e.QRCodeDecoderErrorCorrectionLevel=vt,e.QRCodeDecoderFormatInformation=Nt,e.QRCodeEncoder=jn,e.QRCodeEncoderQRCode=Cn,e.QRCodeMaskUtil=An,e.QRCodeMatrixUtil=En,e.QRCodeMode=Tt,e.QRCodeReader=Bt,e.QRCodeVersion=_t,e.QRCodeWriter=Dn,e.RGBLuminanceSource=On,e.RSS14Reader=ot,e.RSSExpandedReader=it,e.ReaderException=gn,e.ReedSolomonDecoder=re,e.ReedSolomonEncoder=Sn,e.ReedSolomonException=te,e.Result=U,e.ResultMetadataType=Q,e.ResultPoint=oe,e.StringUtils=I,e.UnsupportedOperationException=_,e.VideoInputDevice=L,e.WhiteRectangleDetector=de,e.WriterException=In,e.ZXingArrays=y,e.ZXingCharset=Ln,e.ZXingInteger=b,e.ZXingStandardCharsets=Mn,e.ZXingStringBuilder=E,e.ZXingStringEncoding=C,e.ZXingSystem=p,e.createAbstractExpandedDecoder=nt,Object.defineProperty(e,"__esModule",{value:!0})}(t)},2182:(e,t,n)=>{const r=n(8293);t.render=function(e,t,n){let s=n,i=t;"undefined"!==typeof s||t&&t.getContext||(s=t,t=void 0),t||(i=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),s=r.getOptions(s);const a=r.getImageWidth(e.modules.size,s),o=i.getContext("2d"),l=o.createImageData(a,a);return r.qrToImageData(l.data,e,s),function(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=n,t.width=n,t.style.height=n+"px",t.style.width=n+"px"}(o,i,a),o.putImageData(l,0,0),i},t.renderToDataURL=function(e,n,r){let s=r;"undefined"!==typeof s||n&&n.getContext||(s=n,n=void 0),s||(s={});const i=t.render(e,n,s),a=s.type||"image/png",o=s.rendererOpts||{};return i.toDataURL(a,o.quality)}},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2599:(e,t,n)=>{const r=n(7969),s=n(1805),i=n(6272),a=n(7421),o=n(3257),l=r.getBCHDigit(7973);function c(e,t){return a.getCharCountIndicator(e,t)+4}function d(e,t){let n=0;return e.forEach(function(e){const r=c(e.mode,t);n+=r+e.getBitsLength()}),n}t.from=function(e,t){return o.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,n){if(!o.isValid(e))throw new Error("Invalid QR Code version");"undefined"===typeof n&&(n=a.BYTE);const i=8*(r.getSymbolTotalCodewords(e)-s.getTotalCodewordsCount(e,t));if(n===a.MIXED)return i;const l=i-c(n,e);switch(n){case a.NUMERIC:return Math.floor(l/10*3);case a.ALPHANUMERIC:return Math.floor(l/11*2);case a.KANJI:return Math.floor(l/13);case a.BYTE:default:return Math.floor(l/8)}},t.getBestVersionForData=function(e,n){let r;const s=i.from(n,i.M);if(Array.isArray(e)){if(e.length>1)return function(e,n){for(let r=1;r<=40;r++)if(d(e,r)<=t.getCapacity(r,n,a.MIXED))return r}(e,s);if(0===e.length)return 1;r=e[0]}else r=e;return function(e,n,r){for(let s=1;s<=40;s++)if(n<=t.getCapacity(s,r,e))return s}(r.mode,r.getLength(),s)},t.getEncodedBits=function(e){if(!o.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;r.getBCHDigit(t)-l>=0;)t^=7973<<r.getBCHDigit(t)-l;return e<<12|t}},2730:(e,t,n)=>{"use strict";var r=n(5043),s=n(8853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},f={};function p(e,t,n,r,s,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var s=g.hasOwnProperty(t)?g[t]:null;(null!==s?0!==s.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,r)&&(n=null),r||null===s?function(e){return!!u.call(f,e)||!u.call(m,e)&&(h.test(e)?f[e]=!0:(m[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,r=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(x,y);g[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(x,y);g[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(x,y);g[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,v=Symbol.for("react.element"),N=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),I=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var L,M=Object.assign;function F(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),i=r.stack.split("\n"),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==i[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function z(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case N:return"Portal";case _:return"Profiler";case A:return"StrictMode";case T:return"Suspense";case j:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return q(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(r&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ie(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function pe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),s=pe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}Object.keys(me).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]})});var xe=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(xe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function ve(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ne=null,Se=null,Ae=null;function _e(e){if(e=bs(e)){if("function"!==typeof Ne)throw Error(i(280));var t=e.stateNode;t&&(t=vs(t),Ne(e.stateNode,e.type,t))}}function Ce(e){Se?Ae?Ae.push(e):Ae=[e]:Se=e}function Ie(){if(Se){var e=Se,t=Ae;if(Ae=Se=null,_e(e),t)for(e=0;e<t.length;e++)_e(t[e])}}function Ee(e,t){return e(t)}function Te(){}var je=!1;function ke(e,t,n){if(je)return e(t,n);je=!0;try{return Ee(e,t,n)}finally{je=!1,(null!==Se||null!==Ae)&&(Te(),Ie())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=vs(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Pe=!1;if(d)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(de){Pe=!1}function Oe(e,t,n,r,s,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var Le=!1,Me=null,Fe=!1,Be=null,Ue={onError:function(e){Le=!0,Me=e}};function ze(e,t,n,r,s,i,a,o,l){Le=!1,Me=null,Oe.apply(Ue,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(qe(e)!==e)throw Error(i(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(r=s.return)){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Ve(s),e;if(a===r)return Ve(s),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ye=s.unstable_scheduleCallback,Xe=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,Ke=s.unstable_requestPaint,Ze=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,$e=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,rt=s.unstable_IdlePriority,st=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,s=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?r=ut(o):0!==(i&=a)&&(r=ut(i))}else 0!==(a=n&~s)?r=ut(a):0!==i&&(r=ut(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(i=t&-t)||16===s&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)s=1<<(n=31-at(t)),r|=e[n],t&=~s;return r}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var vt,Nt,St,At,_t,Ct=!1,It=[],Et=null,Tt=null,jt=null,kt=new Map,Dt=new Map,Pt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":jt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Lt(e,t,n,r,s,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&Nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Mt(e){var t=ys(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void _t(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&Nt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Bt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){Ct=!1,null!==Et&&Ft(Et)&&(Et=null),null!==Tt&&Ft(Tt)&&(Tt=null),null!==jt&&Ft(jt)&&(jt=null),kt.forEach(Bt),Dt.forEach(Bt)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ut)))}function qt(e){function t(t){return zt(t,e)}if(0<It.length){zt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&zt(Et,e),null!==Tt&&zt(Tt,e),null!==jt&&zt(jt,e),kt.forEach(t),Dt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Pt.shift()}var Ht=w.ReactCurrentBatchConfig,Vt=!0;function Wt(e,t,n,r){var s=bt,i=Ht.transition;Ht.transition=null;try{bt=1,Yt(e,t,n,r)}finally{bt=s,Ht.transition=i}}function Gt(e,t,n,r){var s=bt,i=Ht.transition;Ht.transition=null;try{bt=4,Yt(e,t,n,r)}finally{bt=s,Ht.transition=i}}function Yt(e,t,n,r){if(Vt){var s=Qt(e,t,n,r);if(null===s)Vr(e,t,r,Xt,n),Ot(e,r);else if(function(e,t,n,r,s){switch(t){case"focusin":return Et=Lt(Et,e,t,n,r,s),!0;case"dragenter":return Tt=Lt(Tt,e,t,n,r,s),!0;case"mouseover":return jt=Lt(jt,e,t,n,r,s),!0;case"pointerover":var i=s.pointerId;return kt.set(i,Lt(kt.get(i)||null,e,t,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Dt.set(i,Lt(Dt.get(i)||null,e,t,n,r,s)),!0}return!1}(s,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==s;){var i=bs(s);if(null!==i&&vt(i),null===(i=Qt(e,t,n,r))&&Vr(e,t,r,Xt,n),i===s)break;s=i}null!==s&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Xt=null;function Qt(e,t,n,r){if(Xt=null,null!==(e=ys(e=ve(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,r=n.length,s="value"in Zt?Zt.value:Zt.textContent,i=s.length;for(e=0;e<r&&n[e]===s[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===s[i-t];t++);return $t=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,s,i){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(cn),un=M({},cn,{view:0,detail:0}),hn=sn(un),mn=M({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),fn=sn(mn),pn=sn(M({},mn,{dataTransfer:0})),gn=sn(M({},un,{relatedTarget:0})),xn=sn(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(yn),wn=sn(M({},cn,{data:0})),vn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function An(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function _n(){return An}var Cn=M({},un,{key:function(e){if(e.key){var t=vn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Nn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=sn(Cn),En=sn(M({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=sn(M({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),jn=sn(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=M({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=sn(kn),Pn=[9,13,27,32],Rn=d&&"CompositionEvent"in window,On=null;d&&"documentMode"in document&&(On=document.documentMode);var Ln=d&&"TextEvent"in window&&!On,Mn=d&&(!Rn||On&&8<On&&11>=On),Fn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ce(r),0<(t=Gr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Yn=null;function Xn(e){Fr(e,0)}function Qn(e){if(Y(ws(e)))return e}function Kn(e,t){if("change"===e)return t}var Zn=!1;if(d){var Jn;if(d){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Jn=$n}else Jn=!1;Zn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Yn=Gn=null)}function nr(e){if("value"===e.propertyName&&Qn(Yn)){var t=[];Wn(t,Yn,e,ve(e)),ke(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function sr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Yn)}function ir(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!u.call(t,s)||!or(e[s],t[s]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function ur(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ur(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function mr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ur(n.ownerDocument.documentElement,n)){if(null!==r&&mr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=void 0===r.end?i:Math.min(r.end,s),!e.extend&&i>r&&(s=r,r=i,i=s),s=dr(n,i);var a=dr(n,r);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,xr=null,yr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&mr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Gr(xr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function vr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Nr={animationend:vr("Animation","AnimationEnd"),animationiteration:vr("Animation","AnimationIteration"),animationstart:vr("Animation","AnimationStart"),transitionend:vr("Transition","TransitionEnd")},Sr={},Ar={};function _r(e){if(Sr[e])return Sr[e];if(!Nr[e])return e;var t,n=Nr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ar)return Sr[e]=n[t];return e}d&&(Ar=document.createElement("div").style,"AnimationEvent"in window||(delete Nr.animationend.animation,delete Nr.animationiteration.animation,delete Nr.animationstart.animation),"TransitionEvent"in window||delete Nr.transitionend.transition);var Cr=_r("animationend"),Ir=_r("animationiteration"),Er=_r("animationstart"),Tr=_r("transitionend"),jr=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){jr.set(e,t),l(t,[e])}for(var Pr=0;Pr<kr.length;Pr++){var Rr=kr[Pr];Dr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Dr(Cr,"onAnimationEnd"),Dr(Ir,"onAnimationIteration"),Dr(Er,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,s,a,o,l,c){if(ze.apply(this,arguments),Le){if(!Le)throw Error(i(198));var d=Me;Le=!1,Me=null,Fe||(Fe=!0,Be=d)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;Mr(s,o,c),i=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;Mr(s,o,c),i=l}}}if(Fe)throw e=Be,Fe=!1,Be=null,e}function Br(e,t){var n=t[ps];void 0===n&&(n=t[ps]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var zr="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[zr]){e[zr]=!0,a.forEach(function(t){"selectionchange"!==t&&(Lr.has(t)||Ur(t,!1,e),Ur(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zr]||(t[zr]=!0,Ur("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Kt(t)){case 1:var s=Wt;break;case 4:s=Gt;break;default:s=Yt}n=s.bind(null,t,n,e),s=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),r?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,s){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=ys(o)))return;if(5===(l=a.tag)||6===l){r=i=a;continue e}o=o.parentNode}}r=r.return}ke(function(){var r=i,s=ve(n),a=[];e:{var o=jr.get(e);if(void 0!==o){var l=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case Cr:case Ir:case Er:l=xn;break;case Tr:l=jn;break;case"scroll":l=hn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var m,f=r;null!==f;){var p=(m=f).stateNode;if(5===m.tag&&null!==p&&(m=p,null!==h&&(null!=(p=De(f,h))&&d.push(Wr(f,p,m)))),u)break;f=f.return}0<d.length&&(o=new l(o,c,null,n,s),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!ys(c)&&!c[fs])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?ys(c):null)&&(c!==(u=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(d=fn,p="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=En,p="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==l?o:ws(l),m=null==c?o:ws(c),(o=new d(p,f+"leave",l,n,s)).target=u,o.relatedTarget=m,p=null,ys(s)===r&&((d=new d(h,f+"enter",c,n,s)).target=m,d.relatedTarget=u,p=d),u=p,l&&c)e:{for(h=c,f=0,m=d=l;m;m=Yr(m))f++;for(m=0,p=h;p;p=Yr(p))m++;for(;0<f-m;)d=Yr(d),f--;for(;0<m-f;)h=Yr(h),m--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=Yr(d),h=Yr(h)}d=null}else d=null;null!==l&&Xr(a,o,l,d,!1),null!==c&&null!==u&&Xr(a,u,c,d,!0)}if("select"===(l=(o=r?ws(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Kn;else if(Vn(o))if(Zn)g=ar;else{g=sr;var x=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=ir);switch(g&&(g=g(e,r))?Wn(a,g,n,s):(x&&x(e,o,r),"focusout"===e&&(x=o._wrapperState)&&x.controlled&&"number"===o.type&&ee(o,"number",o.value)),x=r?ws(r):window,e){case"focusin":(Vn(x)||"true"===x.contentEditable)&&(gr=x,xr=r,yr=null);break;case"focusout":yr=xr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(a,n,s);break;case"selectionchange":if(pr)break;case"keydown":case"keyup":wr(a,n,s)}var y;if(Rn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else qn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&(qn||"onCompositionStart"!==b?"onCompositionEnd"===b&&qn&&(y=en()):(Jt="value"in(Zt=s)?Zt.value:Zt.textContent,qn=!0)),0<(x=Gr(r,b)).length&&(b=new wn(b,e,null,n,s),a.push({event:b,listeners:x}),y?b.data=y:null!==(y=zn(n))&&(b.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!Rn&&Un(e,t)?(e=en(),$t=Jt=Zt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(s=new wn("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:r}),s.data=y))}Fr(a,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var s=e,i=s.stateNode;5===s.tag&&null!==i&&(s=i,null!=(i=De(e,n))&&r.unshift(Wr(e,i,s)),null!=(i=De(e,t))&&r.push(Wr(e,i,s))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,s){for(var i=t._reactName,a=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=De(n,i))&&a.unshift(Wr(n,l,o)):s||null!=(l=De(n,i))&&a.push(Wr(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,Kr=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Kr,"")}function Jr(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(i(425))}function $r(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rs="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,is="function"===typeof Promise?Promise:void 0,as="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof is?function(e){return is.resolve(null).then(e).catch(os)}:rs;function os(e){setTimeout(function(){throw e})}function ls(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===r)return e.removeChild(s),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=s}while(n);qt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ds(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),hs="__reactFiber$"+us,ms="__reactProps$"+us,fs="__reactContainer$"+us,ps="__reactEvents$"+us,gs="__reactListeners$"+us,xs="__reactHandles$"+us;function ys(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fs]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ds(e);null!==e;){if(n=e[hs])return n;e=ds(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[hs]||e[fs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ws(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function vs(e){return e[ms]||null}var Ns=[],Ss=-1;function As(e){return{current:e}}function _s(e){0>Ss||(e.current=Ns[Ss],Ns[Ss]=null,Ss--)}function Cs(e,t){Ss++,Ns[Ss]=e.current,e.current=t}var Is={},Es=As(Is),Ts=As(!1),js=Is;function ks(e,t){var n=e.type.contextTypes;if(!n)return Is;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s,i={};for(s in n)i[s]=t[s];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ds(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ps(){_s(Ts),_s(Es)}function Rs(e,t,n){if(Es.current!==Is)throw Error(i(168));Cs(Es,t),Cs(Ts,n)}function Os(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var s in r=r.getChildContext())if(!(s in t))throw Error(i(108,H(e)||"Unknown",s));return M({},n,r)}function Ls(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Is,js=Es.current,Cs(Es,e),Cs(Ts,Ts.current),!0}function Ms(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Os(e,t,js),r.__reactInternalMemoizedMergedChildContext=e,_s(Ts),_s(Es),Cs(Es,e)):_s(Ts),Cs(Ts,n)}var Fs=null,Bs=!1,Us=!1;function zs(e){null===Fs?Fs=[e]:Fs.push(e)}function qs(){if(!Us&&null!==Fs){Us=!0;var e=0,t=bt;try{var n=Fs;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fs=null,Bs=!1}catch(s){throw null!==Fs&&(Fs=Fs.slice(e+1)),Ye($e,qs),s}finally{bt=t,Us=!1}}return null}var Hs=[],Vs=0,Ws=null,Gs=0,Ys=[],Xs=0,Qs=null,Ks=1,Zs="";function Js(e,t){Hs[Vs++]=Gs,Hs[Vs++]=Ws,Ws=e,Gs=t}function $s(e,t,n){Ys[Xs++]=Ks,Ys[Xs++]=Zs,Ys[Xs++]=Qs,Qs=e;var r=Ks;e=Zs;var s=32-at(r)-1;r&=~(1<<s),n+=1;var i=32-at(t)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Ks=1<<32-at(t)+s|n<<s|r,Zs=i+e}else Ks=1<<i|n<<s|r,Zs=e}function ei(e){null!==e.return&&(Js(e,1),$s(e,1,0))}function ti(e){for(;e===Ws;)Ws=Hs[--Vs],Hs[Vs]=null,Gs=Hs[--Vs],Hs[Vs]=null;for(;e===Qs;)Qs=Ys[--Xs],Ys[Xs]=null,Zs=Ys[--Xs],Ys[Xs]=null,Ks=Ys[--Xs],Ys[Xs]=null}var ni=null,ri=null,si=!1,ii=null;function ai(e,t){var n=kc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oi(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qs?{id:Ks,overflow:Zs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=kc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function li(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(si){var t=ri;if(t){var n=t;if(!oi(e,t)){if(li(e))throw Error(i(418));t=cs(n.nextSibling);var r=ni;t&&oi(e,t)?ai(r,n):(e.flags=-4097&e.flags|2,si=!1,ni=e)}}else{if(li(e))throw Error(i(418));e.flags=-4097&e.flags|2,si=!1,ni=e}}}function di(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function ui(e){if(e!==ni)return!1;if(!si)return di(e),si=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ri)){if(li(e))throw hi(),Error(i(418));for(;t;)ai(e,t),t=cs(t.nextSibling)}if(di(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?cs(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ri;e;)e=cs(e.nextSibling)}function mi(){ri=ni=null,si=!1}function fi(e){null===ii?ii=[e]:ii.push(e)}var pi=w.ReactCurrentBatchConfig;function gi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var s=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function xi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function bi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Mc(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===S?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===D&&yi(i)===t.type)?((r=s(t,n.props)).ref=gi(e,t,n),r.return=e,r):((r=Rc(n.type,n.key,n.props,null,e.mode,r)).ref=gi(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function u(e,t,n,r,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,i)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case v:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=gi(e,null,t),n.return=e,n;case N:return(t=Fc(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;xi(e,t)}return null}function m(e,t,n,r){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case v:return n.key===s?c(e,t,n,r):null;case N:return n.key===s?d(e,t,n,r):null;case D:return m(e,t,(s=n._init)(n._payload),r)}if(te(n)||O(n))return null!==s?null:u(e,t,n,r,null);xi(e,n)}return null}function f(e,t,n,r,s){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,s);if("object"===typeof r&&null!==r){switch(r.$$typeof){case v:return c(t,e=e.get(null===r.key?n:r.key)||null,r,s);case N:return d(t,e=e.get(null===r.key?n:r.key)||null,r,s);case D:return f(e,t,n,(0,r._init)(r._payload),s)}if(te(r)||O(r))return u(t,e=e.get(n)||null,r,s,null);xi(t,r)}return null}function p(s,i,o,l){for(var c=null,d=null,u=i,p=i=0,g=null;null!==u&&p<o.length;p++){u.index>p?(g=u,u=null):g=u.sibling;var x=m(s,u,o[p],l);if(null===x){null===u&&(u=g);break}e&&u&&null===x.alternate&&t(s,u),i=a(x,i,p),null===d?c=x:d.sibling=x,d=x,u=g}if(p===o.length)return n(s,u),si&&Js(s,p),c;if(null===u){for(;p<o.length;p++)null!==(u=h(s,o[p],l))&&(i=a(u,i,p),null===d?c=u:d.sibling=u,d=u);return si&&Js(s,p),c}for(u=r(s,u);p<o.length;p++)null!==(g=f(u,s,p,o[p],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?p:g.key),i=a(g,i,p),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(s,e)}),si&&Js(s,p),c}function g(s,o,l,c){var d=O(l);if("function"!==typeof d)throw Error(i(150));if(null==(l=d.call(l)))throw Error(i(151));for(var u=d=null,p=o,g=o=0,x=null,y=l.next();null!==p&&!y.done;g++,y=l.next()){p.index>g?(x=p,p=null):x=p.sibling;var b=m(s,p,y.value,c);if(null===b){null===p&&(p=x);break}e&&p&&null===b.alternate&&t(s,p),o=a(b,o,g),null===u?d=b:u.sibling=b,u=b,p=x}if(y.done)return n(s,p),si&&Js(s,g),d;if(null===p){for(;!y.done;g++,y=l.next())null!==(y=h(s,y.value,c))&&(o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return si&&Js(s,g),d}for(p=r(s,p);!y.done;g++,y=l.next())null!==(y=f(p,s,g,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?g:y.key),o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&p.forEach(function(e){return t(s,e)}),si&&Js(s,g),d}return function e(r,i,a,l){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case v:e:{for(var c=a.key,d=i;null!==d;){if(d.key===c){if((c=a.type)===S){if(7===d.tag){n(r,d.sibling),(i=s(d,a.props.children)).return=r,r=i;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&yi(c)===d.type){n(r,d.sibling),(i=s(d,a.props)).ref=gi(r,d,a),i.return=r,r=i;break e}n(r,d);break}t(r,d),d=d.sibling}a.type===S?((i=Oc(a.props.children,r.mode,l,a.key)).return=r,r=i):((l=Rc(a.type,a.key,a.props,null,r.mode,l)).ref=gi(r,i,a),l.return=r,r=l)}return o(r);case N:e:{for(d=a.key;null!==i;){if(i.key===d){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(r,i.sibling),(i=s(i,a.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Fc(a,r.mode,l)).return=r,r=i}return o(r);case D:return e(r,i,(d=a._init)(a._payload),l)}if(te(a))return p(r,i,a,l);if(O(a))return g(r,i,a,l);xi(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(r,i.sibling),(i=s(i,a)).return=r,r=i):(n(r,i),(i=Mc(a,r.mode,l)).return=r,r=i),o(r)):n(r,i)}}var wi=bi(!0),vi=bi(!1),Ni=As(null),Si=null,Ai=null,_i=null;function Ci(){_i=Ai=Si=null}function Ii(e){var t=Ni.current;_s(Ni),e._currentValue=t}function Ei(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ti(e,t){Si=e,_i=Ai=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function ji(e){var t=e._currentValue;if(_i!==e)if(e={context:e,memoizedValue:t,next:null},null===Ai){if(null===Si)throw Error(i(308));Ai=e,Si.dependencies={lanes:0,firstContext:e}}else Ai=Ai.next=e;return t}var ki=null;function Di(e){null===ki?ki=[e]:ki.push(e)}function Pi(e,t,n,r){var s=t.interleaved;return null===s?(n.next=n,Di(t)):(n.next=s.next,s.next=n),t.interleaved=n,Ri(e,r)}function Ri(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oi=!1;function Li(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&El)){var s=r.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Ri(e,n)}return null===(s=r.interleaved)?(t.next=t,Di(r)):(t.next=s.next,s.next=t),r.interleaved=t,Ri(e,n)}function Ui(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function zi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var s=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?s=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?s=i=t:i=i.next=t}else s=i=t;return n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qi(e,t,n,r){var s=e.updateQueue;Oi=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==i){var u=s.baseState;for(a=0,d=c=l=null,o=i;;){var h=o.lane,m=o.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,p=o;switch(h=t,m=n,p.tag){case 1:if("function"===typeof(f=p.payload)){u=f.call(m,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=p.payload)?f.call(m,u,h):f)||void 0===h)break e;u=M({},u,h);break e;case 2:Oi=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,a|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===i&&(s.shared.lanes=0);Ll|=a,e.lanes=a,e.memoizedState=u}}function Hi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=n,"function"!==typeof s)throw Error(i(191,s));s.call(r)}}}var Vi={},Wi=As(Vi),Gi=As(Vi),Yi=As(Vi);function Xi(e){if(e===Vi)throw Error(i(174));return e}function Qi(e,t){switch(Cs(Yi,t),Cs(Gi,e),Cs(Wi,Vi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_s(Wi),Cs(Wi,t)}function Ki(){_s(Wi),_s(Gi),_s(Yi)}function Zi(e){Xi(Yi.current);var t=Xi(Wi.current),n=le(t,e.type);t!==n&&(Cs(Gi,e),Cs(Wi,n))}function Ji(e){Gi.current===e&&(_s(Wi),_s(Gi))}var $i=As(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ra=w.ReactCurrentDispatcher,sa=w.ReactCurrentBatchConfig,ia=0,aa=null,oa=null,la=null,ca=!1,da=!1,ua=0,ha=0;function ma(){throw Error(i(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function pa(e,t,n,r,s,a){if(ia=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Ja:$a,e=n(r,s),da){a=0;do{if(da=!1,ua=0,25<=a)throw Error(i(301));a+=1,la=oa=null,t.updateQueue=null,ra.current=eo,e=n(r,s)}while(da)}if(ra.current=Za,t=null!==oa&&null!==oa.next,ia=0,la=oa=aa=null,ca=!1,t)throw Error(i(300));return e}function ga(){var e=0!==ua;return ua=0,e}function xa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function wa(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=oa,s=r.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,r=r.baseState;var l=o=null,c=null,d=a;do{var u=d.lane;if((ia&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,aa.lanes|=u,Ll|=u}d=d.next}while(null!==d&&d!==a);null===c?o=r:c.next=l,or(r,t.memoizedState)||(bo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,aa.lanes|=a,Ll|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function va(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);or(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Na(){}function Sa(e,t){var n=aa,r=ya(),s=t(),a=!or(r.memoizedState,s);if(a&&(r.memoizedState=s,bo=!0),r=r.queue,Oa(Ca.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,ja(9,_a.bind(null,n,r,s,t),void 0,null),null===Tl)throw Error(i(349));0!==(30&ia)||Aa(n,t,s)}return s}function Aa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function _a(e,t,n,r){t.value=n,t.getSnapshot=r,Ia(t)&&Ea(e)}function Ca(e,t,n){return n(function(){Ia(t)&&Ea(e)})}function Ia(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ea(e){var t=Ri(e,1);null!==t&&nc(t,e,1,-1)}function Ta(e){var t=xa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=Ya.bind(null,aa,e),[t.memoizedState,e]}function ja(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ka(){return ya().memoizedState}function Da(e,t,n,r){var s=xa();aa.flags|=e,s.memoizedState=ja(1|t,n,void 0,void 0===r?null:r)}function Pa(e,t,n,r){var s=ya();r=void 0===r?null:r;var i=void 0;if(null!==oa){var a=oa.memoizedState;if(i=a.destroy,null!==r&&fa(r,a.deps))return void(s.memoizedState=ja(t,n,i,r))}aa.flags|=e,s.memoizedState=ja(1|t,n,i,r)}function Ra(e,t){return Da(8390656,8,e,t)}function Oa(e,t){return Pa(2048,8,e,t)}function La(e,t){return Pa(4,2,e,t)}function Ma(e,t){return Pa(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4,4,Fa.bind(null,t,e),n)}function Ua(){}function za(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function qa(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&ia)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(or(n,t)||(n=pt(),aa.lanes|=n,Ll|=n,e.baseState=!0),t)}function Va(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=sa.transition;sa.transition={};try{e(!1),t()}finally{bt=n,sa.transition=r}}function Wa(){return ya().memoizedState}function Ga(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xa(e))Qa(t,n);else if(null!==(n=Pi(e,t,n,r))){nc(n,e,r,ec()),Ka(n,t,r)}}function Ya(e,t,n){var r=tc(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xa(e))Qa(t,s);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,n);if(s.hasEagerState=!0,s.eagerState=o,or(o,a)){var l=t.interleaved;return null===l?(s.next=s,Di(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Pi(e,t,s,r))&&(nc(n,e,r,s=ec()),Ka(n,t,r))}}function Xa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Qa(e,t){da=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ka(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Za={readContext:ji,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},Ja={readContext:ji,useCallback:function(e,t){return xa().memoizedState=[e,void 0===t?null:t],e},useContext:ji,useEffect:Ra,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Da(4194308,4,Fa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var n=xa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=xa();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ga.bind(null,aa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},xa().memoizedState=e},useState:Ta,useDebugValue:Ua,useDeferredValue:function(e){return xa().memoizedState=e},useTransition:function(){var e=Ta(!1),t=e[0];return e=Va.bind(null,e[1]),xa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=aa,s=xa();if(si){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Tl)throw Error(i(349));0!==(30&ia)||Aa(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Ra(Ca.bind(null,r,a,e),[e]),r.flags|=2048,ja(9,_a.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=xa(),t=Tl.identifierPrefix;if(si){var n=Zs;t=":"+t+"R"+(n=(Ks&~(1<<32-at(Ks)-1)).toString(32)+n),0<(n=ua++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$a={readContext:ji,useCallback:za,useContext:ji,useEffect:Oa,useImperativeHandle:Ba,useInsertionEffect:La,useLayoutEffect:Ma,useMemo:qa,useReducer:wa,useRef:ka,useState:function(){return wa(ba)},useDebugValue:Ua,useDeferredValue:function(e){return Ha(ya(),oa.memoizedState,e)},useTransition:function(){return[wa(ba)[0],ya().memoizedState]},useMutableSource:Na,useSyncExternalStore:Sa,useId:Wa,unstable_isNewReconciler:!1},eo={readContext:ji,useCallback:za,useContext:ji,useEffect:Oa,useImperativeHandle:Ba,useInsertionEffect:La,useLayoutEffect:Ma,useMemo:qa,useReducer:va,useRef:ka,useState:function(){return va(ba)},useDebugValue:Ua,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[va(ba)[0],ya().memoizedState]},useMutableSource:Na,useSyncExternalStore:Sa,useId:Wa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Fi(r,s);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,s))&&(nc(t,e,s,r),Ui(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Fi(r,s);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,s))&&(nc(t,e,s,r),Ui(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),s=Fi(n,r);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Bi(e,s,r))&&(nc(t,e,r,n),Ui(t,e,r))}};function so(e,t,n,r,s,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(s,i))}function io(e,t,n){var r=!1,s=Is,i=t.contextType;return"object"===typeof i&&null!==i?i=ji(i):(s=Ds(t)?js:Es.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?ks(e,s):Is),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function ao(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Li(e);var i=t.contextType;"object"===typeof i&&null!==i?s.context=ji(i):(i=Ds(t)?js:Es.current,s.context=ks(e,i)),s.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(no(e,t,i,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&ro.enqueueReplaceState(s,s.state,null),qi(e,n,s,r),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var s=n}catch(i){s="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=Fi(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Wl=r),uo(0,t)},n}function fo(e,t,n){(n=Fi(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function po(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var s=new Set;r.set(t,s)}else void 0===(s=r.get(t))&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=_c.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function xo(e,t,n,r,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fi(-1,1)).tag=2,Bi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var yo=w.ReactCurrentOwner,bo=!1;function wo(e,t,n,r){t.child=null===e?vi(t,null,n,r):wi(t,e.child,n,r)}function vo(e,t,n,r,s){n=n.render;var i=t.ref;return Ti(t,s),r=pa(e,t,n,r,i,s),n=ga(),null===e||bo?(si&&n&&ei(t),t.flags|=1,wo(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vo(e,t,s))}function No(e,t,n,r,s){if(null===e){var i=n.type;return"function"!==typeof i||Dc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,r,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,So(e,t,i,r,s))}if(i=e.child,0===(e.lanes&s)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(a,r)&&e.ref===t.ref)return Vo(e,t,s)}return t.flags|=1,(e=Pc(i,r)).ref=t.ref,e.return=t,t.child=e}function So(e,t,n,r,s){if(null!==e){var i=e.memoizedProps;if(lr(i,r)&&e.ref===t.ref){if(bo=!1,t.pendingProps=r=i,0===(e.lanes&s))return t.lanes=e.lanes,Vo(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return Co(e,t,n,r,s)}function Ao(e,t,n){var r=t.pendingProps,s=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cs(Pl,Dl),Dl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cs(Pl,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Cs(Pl,Dl),Dl|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Cs(Pl,Dl),Dl|=r;return wo(e,t,s,n),t.child}function _o(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,r,s){var i=Ds(n)?js:Es.current;return i=ks(t,i),Ti(t,s),n=pa(e,t,n,r,i,s),r=ga(),null===e||bo?(si&&r&&ei(t),t.flags|=1,wo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vo(e,t,s))}function Io(e,t,n,r,s){if(Ds(n)){var i=!0;Ls(t)}else i=!1;if(Ti(t,s),null===t.stateNode)Ho(e,t),io(t,n,r),oo(t,n,r,s),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=ji(c):c=ks(t,c=Ds(n)?js:Es.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==c)&&ao(t,a,r,c),Oi=!1;var h=t.memoizedState;a.state=h,qi(t,r,a,s),l=t.memoizedState,o!==r||h!==l||Ts.current||Oi?("function"===typeof d&&(no(t,n,d,r),l=t.memoizedState),(o=Oi||so(t,n,o,r,h,l,c))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Mi(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,u=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=ji(l):l=ks(t,l=Ds(n)?js:Es.current);var m=n.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==l)&&ao(t,a,r,l),Oi=!1,h=t.memoizedState,a.state=h,qi(t,r,a,s);var f=t.memoizedState;o!==u||h!==f||Ts.current||Oi?("function"===typeof m&&(no(t,n,m,r),f=t.memoizedState),(c=Oi||so(t,n,c,r,h,f,l)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Eo(e,t,n,r,i,s)}function Eo(e,t,n,r,s,i){_o(e,t);var a=0!==(128&t.flags);if(!r&&!a)return s&&Ms(t,n,!1),Vo(e,t,i);r=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=wi(t,e.child,null,i),t.child=wi(t,null,o,i)):wo(e,t,o,i),t.memoizedState=r.state,s&&Ms(t,n,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?Rs(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Rs(0,t.context,!1),Qi(e,t.containerInfo)}function jo(e,t,n,r,s){return mi(),fi(s),t.flags|=256,wo(e,t,n,r),t.child}var ko,Do,Po,Ro,Oo={dehydrated:null,treeContext:null,retryLane:0};function Lo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mo(e,t,n){var r,s=t.pendingProps,a=$i.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Cs($i,1&a),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Lc(l,s,0,null),e=Oc(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Lo(n),t.memoizedState=Oo,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,r=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Lc({mode:"visible",children:r.children},s,0,null),(a=Oc(a,s,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&wi(t,e.child,null,o),t.child.memoizedState=Lo(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,Bo(e,t,o,r=co(a=Error(i(419)),r,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(r=Tl)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Ri(e,s),nc(r,e,s,-1))}return pc(),Bo(e,t,o,r=co(Error(i(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ri=cs(s.nextSibling),ni=t,si=!0,ii=null,null!==e&&(Ys[Xs++]=Ks,Ys[Xs++]=Zs,Ys[Xs++]=Qs,Ks=e.id,Zs=e.overflow,Qs=t),t=Fo(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,a,n);if(o){o=s.fallback,l=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Pc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Pc(r,o):(o=Oc(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Lo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Oo,s}return e=(o=e.child).sibling,s=Pc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Fo(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,r){return null!==r&&fi(r),wi(t,e.child,null,n),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ei(e.return,t,n)}function zo(e,t,n,r,s){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function qo(e,t,n){var r=t.pendingProps,s=r.revealOrder,i=r.tail;if(wo(e,t,r.children,n),0!==(2&(r=$i.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,n,t);else if(19===e.tag)Uo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Cs($i,r),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),zo(t,!1,s,n,i);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ea(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}zo(t,!0,n,null,i);break;case"together":zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ll|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!si)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Go(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=14680064&s.subtreeFlags,r|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yo(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Go(t),null;case 1:case 17:return Ds(t.type)&&Ps(),Go(t),null;case 3:return r=t.stateNode,Ki(),_s(Ts),_s(Es),na(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ui(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ac(ii),ii=null))),Do(e,t),Go(t),null;case 5:Ji(t);var s=Xi(Yi.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Go(t),null}if(e=Xi(Wi.current),ui(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hs]=t,r[ms]=a,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(s=0;s<Or.length;s++)Br(Or[s],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":K(r,a),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Br("invalid",r);break;case"textarea":se(r,a),Br("invalid",r)}for(var l in ye(n,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),s=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(n){case"input":G(r),$(r,a,!0);break;case"textarea":G(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=s,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hs]=t,e[ms]=r,ko(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),s=r;break;case"iframe":case"object":case"embed":Br("load",e),s=r;break;case"video":case"audio":for(s=0;s<Or.length;s++)Br(Or[s],e);s=r;break;case"source":Br("error",e),s=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),s=r;break;case"details":Br("toggle",e),s=r;break;case"input":K(e,r),s=Q(e,r),Br("invalid",e);break;case"option":default:s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=M({},r,{value:void 0}),Br("invalid",e);break;case"textarea":se(e,r),s=re(e,r),Br("invalid",e)}for(a in ye(n,s),c=s)if(c.hasOwnProperty(a)){var d=c[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Br("scroll",e):null!=d&&b(e,a,d,l))}switch(n){case"input":G(e),$(e,r,!1);break;case"textarea":G(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Go(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=Xi(Yi.current),Xi(Wi.current),ui(t)){if(r=t.stateNode,n=t.memoizedProps,r[hs]=t,(a=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hs]=t,t.stateNode=r}return Go(t),null;case 13:if(_s($i),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(si&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))hi(),mi(),t.flags|=98560,a=!1;else if(a=ui(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[hs]=t}else mi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Go(t),a=!1}else null!==ii&&(ac(ii),ii=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$i.current)?0===Rl&&(Rl=3):pc())),null!==t.updateQueue&&(t.flags|=4),Go(t),null);case 4:return Ki(),Do(e,t),null===e&&qr(t.stateNode.containerInfo),Go(t),null;case 10:return Ii(t.type._context),Go(t),null;case 19:if(_s($i),null===(a=t.memoizedState))return Go(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)Wo(a,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Wo(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cs($i,1&$i.current|2),t.child}e=e.sibling}null!==a.tail&&Ze()>ql&&(t.flags|=128,r=!0,Wo(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ea(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!si)return Go(t),null}else 2*Ze()-a.renderingStartTime>ql&&1073741824!==n&&(t.flags|=128,r=!0,Wo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ze(),t.sibling=null,n=$i.current,Cs($i,r?1&n|2:1&n),t):(Go(t),null);case 22:case 23:return uc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Go(t),6&t.subtreeFlags&&(t.flags|=8192)):Go(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Xo(e,t){switch(ti(t),t.tag){case 1:return Ds(t.type)&&Ps(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ki(),_s(Ts),_s(Es),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ji(t),null;case 13:if(_s($i),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));mi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _s($i),null;case 4:return Ki(),null;case 10:return Ii(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}ko=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Do=function(){},Po=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,Xi(Wi.current);var i,a=null;switch(n){case"input":s=Q(e,s),r=Q(e,r),a=[];break;case"select":s=M({},s,{value:void 0}),r=M({},r,{value:void 0}),a=[];break;case"textarea":s=re(e,s),r=re(e,r),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(d in ye(n,r),n=null,s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var l=s[d];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var c=r[d];if(l=null!=s?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Br("scroll",e),a||l===c||(a=[])):(a=a||[]).push(d,c))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Ro=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qo=!1,Ko=!1,Zo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ac(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Ac(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var s=r=r.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,void 0!==i&&el(t,n,i)}s=s.next}while(s!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function sl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[ms],delete t[ps],delete t[gs],delete t[xs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var dl=null,ul=!1;function hl(e,t,n){for(n=n.child;null!==n;)ml(e,t,n),n=n.sibling}function ml(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:Ko||$o(n,t);case 6:var r=dl,s=ul;dl=null,hl(e,t,n),ul=s,null!==(dl=r)&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),qt(e)):ls(dl,n.stateNode));break;case 4:r=dl,s=ul,dl=n.stateNode.containerInfo,ul=!0,hl(e,t,n),dl=r,ul=s;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&el(n,t,a),s=s.next}while(s!==r)}hl(e,t,n);break;case 1:if(!Ko&&($o(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Ac(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Ko=(r=Ko)||null!==n.memoizedState,hl(e,t,n),Ko=r):hl(e,t,n);break;default:hl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zo),t.forEach(function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,ul=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===dl)throw Error(i(160));ml(a,o,s),dl=null,ul=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(d){Ac(s,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),xl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Ac(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Ac(e,e.return,g)}}break;case 1:pl(t,e),xl(e),512&r&&null!==n&&$o(n,n.return);break;case 5:if(pl(t,e),xl(e),512&r&&null!==n&&$o(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(g){Ac(e,e.return,g)}}if(4&r&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Z(s,a),be(l,o);var d=be(l,a);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?ge(s,h):"dangerouslySetInnerHTML"===u?ue(s,h):"children"===u?he(s,h):b(s,u,h,d)}switch(l){case"input":J(s,a);break;case"textarea":ie(s,a);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(s,!!a.multiple,f,!1):m!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[ms]=a}catch(g){Ac(e,e.return,g)}}break;case 6:if(pl(t,e),xl(e),4&r){if(null===e.stateNode)throw Error(i(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(g){Ac(e,e.return,g)}}break;case 3:if(pl(t,e),xl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(g){Ac(e,e.return,g)}break;case 4:default:pl(t,e),xl(e);break;case 13:pl(t,e),xl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(zl=Ze())),4&r&&fl(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Ko=(d=Ko)||u,pl(t,e),Ko=d):pl(t,e),xl(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Jo=e,u=e.child;null!==u;){for(h=Jo=u;null!==Jo;){switch(f=(m=Jo).child,m.tag){case 0:case 11:case 14:case 15:nl(4,m,m.return);break;case 1:$o(m,m.return);var p=m.stateNode;if("function"===typeof p.componentWillUnmount){r=m,n=m.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(g){Ac(r,n,g)}}break;case 5:$o(m,m.return);break;case 22:if(null!==m.memoizedState){vl(h);continue}}null!==f?(f.return=m,Jo=f):vl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",o))}catch(g){Ac(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Ac(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),xl(e),4&r&&fl(e);case 21:}}function xl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(he(s,""),r.flags&=-33),cl(e,ol(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(i(161))}}catch(o){Ac(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Jo;){var s=Jo,i=s.child;if(22===s.tag&&r){var a=null!==s.memoizedState||Qo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Qo;var c=Ko;if(Qo=a,(Ko=l)&&!c)for(Jo=s;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?Nl(s):null!==l?(l.return=a,Jo=l):Nl(s);for(;null!==i;)Jo=i,bl(i,t,n),i=i.sibling;Jo=s,Qo=o,Ko=c}wl(e)}else 0!==(8772&s.subtreeFlags)&&null!==i?(i.return=s,Jo=i):wl(e)}}function wl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ko)if(null===n)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hi(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hi(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&qt(h)}}}break;default:throw Error(i(163))}Ko||512&t.flags&&sl(t)}catch(m){Ac(t,t.return,m)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function vl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function Nl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Ac(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var s=t.return;try{r.componentDidMount()}catch(l){Ac(t,s,l)}}var i=t.return;try{sl(t)}catch(l){Ac(t,i,l)}break;case 5:var a=t.return;try{sl(t)}catch(l){Ac(t,a,l)}}}catch(l){Ac(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Sl,Al=Math.ceil,_l=w.ReactCurrentDispatcher,Cl=w.ReactCurrentOwner,Il=w.ReactCurrentBatchConfig,El=0,Tl=null,jl=null,kl=0,Dl=0,Pl=As(0),Rl=0,Ol=null,Ll=0,Ml=0,Fl=0,Bl=null,Ul=null,zl=0,ql=1/0,Hl=null,Vl=!1,Wl=null,Gl=null,Yl=!1,Xl=null,Ql=0,Kl=0,Zl=null,Jl=-1,$l=0;function ec(){return 0!==(6&El)?Ze():-1!==Jl?Jl:Jl=Ze()}function tc(e){return 0===(1&e.mode)?1:0!==(2&El)&&0!==kl?kl&-kl:null!==pi.transition?(0===$l&&($l=pt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function nc(e,t,n,r){if(50<Kl)throw Kl=0,Zl=null,Error(i(185));xt(e,n,r),0!==(2&El)&&e===Tl||(e===Tl&&(0===(2&El)&&(Ml|=n),4===Rl&&oc(e,kl)),rc(e,r),1===n&&0===El&&0===(1&t.mode)&&(ql=Ze()+500,Bs&&qs()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),o=1<<a,l=s[a];-1===l?0!==(o&n)&&0===(o&r)||(s[a]=mt(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var r=ht(e,e===Tl?kl:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Bs=!0,zs(e)}(lc.bind(null,e)):zs(lc.bind(null,e)),as(function(){0===(6&El)&&qs()}),n=null;else{switch(wt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tc(n,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sc(e,t){if(Jl=-1,$l=0,0!==(6&El))throw Error(i(327));var n=e.callbackNode;if(Nc()&&e.callbackNode!==n)return null;var r=ht(e,e===Tl?kl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var s=El;El|=2;var a=fc();for(Tl===e&&kl===t||(Hl=null,ql=Ze()+500,hc(e,t));;)try{yc();break}catch(l){mc(e,l)}Ci(),_l.current=a,El=s,null!==jl?t=0:(Tl=null,kl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(s=ft(e))&&(r=s,t=ic(e,s))),1===t)throw n=Ol,hc(e,0),oc(e,r),rc(e,Ze()),n;if(6===t)oc(e,r);else{if(s=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!or(i(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=gc(e,r))&&(0!==(a=ft(e))&&(r=a,t=ic(e,a))),1===t))throw n=Ol,hc(e,0),oc(e,r),rc(e,Ze()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:vc(e,Ul,Hl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=zl+500-Ze())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=rs(vc.bind(null,e,Ul,Hl),t);break}vc(e,Ul,Hl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>s&&(s=o),r&=~a}if(r=s,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Al(r/1960))-r)){e.timeoutHandle=rs(vc.bind(null,e,Ul,Hl),r);break}vc(e,Ul,Hl);break;default:throw Error(i(329))}}}return rc(e,Ze()),e.callbackNode===n?sc.bind(null,e):null}function ic(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){for(t&=~Fl,t&=~Ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&El))throw Error(i(327));Nc();var t=ht(e,0);if(0===(1&t))return rc(e,Ze()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ol,hc(e,0),oc(e,t),rc(e,Ze()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,vc(e,Ul,Hl),rc(e,Ze()),null}function cc(e,t){var n=El;El|=1;try{return e(t)}finally{0===(El=n)&&(ql=Ze()+500,Bs&&qs())}}function dc(e){null!==Xl&&0===Xl.tag&&0===(6&El)&&Nc();var t=El;El|=1;var n=Il.transition,r=bt;try{if(Il.transition=null,bt=1,e)return e()}finally{bt=r,Il.transition=n,0===(6&(El=t))&&qs()}}function uc(){Dl=Pl.current,_s(Pl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==jl)for(n=jl.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ps();break;case 3:Ki(),_s(Ts),_s(Es),na();break;case 5:Ji(r);break;case 4:Ki();break;case 13:case 19:_s($i);break;case 10:Ii(r.type._context);break;case 22:case 23:uc()}n=n.return}if(Tl=e,jl=e=Pc(e.current,null),kl=Dl=t,Rl=0,Ol=null,Fl=Ml=Ll=0,Ul=Bl=null,null!==ki){for(t=0;t<ki.length;t++)if(null!==(r=(n=ki[t]).interleaved)){n.interleaved=null;var s=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=s,r.next=a}n.pending=r}ki=null}return e}function mc(e,t){for(;;){var n=jl;try{if(Ci(),ra.current=Za,ca){for(var r=aa.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ca=!1}if(ia=0,la=oa=aa=null,da=!1,ua=0,Cl.current=null,null===n||null===n.return){Rl=1,Ol=t,jl=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=kl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,xo(f,o,l,0,t),1&f.mode&&po(a,d,t),c=d;var p=(t=f).updateQueue;if(null===p){var g=new Set;g.add(c),t.updateQueue=g}else p.add(c);break e}if(0===(1&t)){po(a,d,t),pc();break e}c=Error(i(426))}else if(si&&1&l.mode){var x=go(o);if(null!==x){0===(65536&x.flags)&&(x.flags|=256),xo(x,o,l,0,t),fi(lo(c,l));break e}}a=c=lo(c,l),4!==Rl&&(Rl=2),null===Bl?Bl=[a]:Bl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,zi(a,mo(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Gl||!Gl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,zi(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}wc(n)}catch(w){t=w,jl===n&&null!==n&&(jl=n=n.return);continue}break}}function fc(){var e=_l.current;return _l.current=Za,null===e?Za:e}function pc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Tl||0===(268435455&Ll)&&0===(268435455&Ml)||oc(Tl,kl)}function gc(e,t){var n=El;El|=2;var r=fc();for(Tl===e&&kl===t||(Hl=null,hc(e,t));;)try{xc();break}catch(s){mc(e,s)}if(Ci(),El=n,_l.current=r,null!==jl)throw Error(i(261));return Tl=null,kl=0,Rl}function xc(){for(;null!==jl;)bc(jl)}function yc(){for(;null!==jl&&!Qe();)bc(jl)}function bc(e){var t=Sl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?wc(e):jl=t,Cl.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,Dl)))return void(jl=n)}else{if(null!==(n=Xo(n,t)))return n.flags&=32767,void(jl=n);if(null===e)return Rl=6,void(jl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(jl=t);jl=t=e}while(null!==t);0===Rl&&(Rl=5)}function vc(e,t,n){var r=bt,s=Il.transition;try{Il.transition=null,bt=1,function(e,t,n,r){do{Nc()}while(null!==Xl);if(0!==(6&El))throw Error(i(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-at(n),i=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~i}}(e,a),e===Tl&&(jl=Tl=null,kl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Tc(tt,function(){return Nc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Il.transition,Il.transition=null;var o=bt;bt=1;var l=El;El|=4,Cl.current=null,function(e,t){if(es=Vt,mr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(v){n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var f;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==a||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(f=h.firstChild);)m=h,h=f;for(;;){if(h===e)break t;if(m===n&&++d===s&&(l=o),m===a&&++u===r&&(c=o),null!==(f=h.nextSibling))break;m=(h=m).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},Vt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var g=p.memoizedProps,x=p.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),x);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(i(163))}}catch(v){Ac(t,t.return,v)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}p=tl,tl=!1}(e,n),gl(n,e),fr(ts),Vt=!!es,ts=es=null,e.current=n,yl(n,e,s),Ke(),El=l,bt=o,Il.transition=a}else e.current=n;if(Yl&&(Yl=!1,Xl=e,Ql=s),a=e.pendingLanes,0===a&&(Gl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Vl)throw Vl=!1,e=Wl,Wl=null,e;0!==(1&Ql)&&0!==e.tag&&Nc(),a=e.pendingLanes,0!==(1&a)?e===Zl?Kl++:(Kl=0,Zl=e):Kl=0,qs()}(e,t,n,r)}finally{Il.transition=s,bt=r}return null}function Nc(){if(null!==Xl){var e=wt(Ql),t=Il.transition,n=bt;try{if(Il.transition=null,bt=16>e?16:e,null===Xl)var r=!1;else{if(e=Xl,Xl=null,Ql=0,0!==(6&El))throw Error(i(331));var s=El;for(El|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Jo=d;null!==Jo;){var u=Jo;switch(u.tag){case 0:case 11:case 15:nl(8,u,a)}var h=u.child;if(null!==h)h.return=u,Jo=h;else for(;null!==Jo;){var m=(u=Jo).sibling,f=u.return;if(il(u),u===d){Jo=null;break}if(null!==m){m.return=f,Jo=m;break}Jo=f}}}var p=a.alternate;if(null!==p){var g=p.child;if(null!==g){p.child=null;do{var x=g.sibling;g.sibling=null,g=x}while(null!==g)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var b=e.current;for(Jo=b;null!==Jo;){var w=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==w)w.return=o,Jo=w;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(N){Ac(l,l.return,N)}if(l===o){Jo=null;break e}var v=l.sibling;if(null!==v){v.return=l.return,Jo=v;break e}Jo=l.return}}if(El=s,qs(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(st,e)}catch(N){}r=!0}return r}finally{bt=n,Il.transition=t}}return!1}function Sc(e,t,n){e=Bi(e,t=mo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(xt(e,1,t),rc(e,t))}function Ac(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gl||!Gl.has(r))){t=Bi(t,e=fo(t,e=lo(n,e),1),1),e=ec(),null!==t&&(xt(t,1,e),rc(t,e));break}}t=t.return}}function _c(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Tl===e&&(kl&n)===n&&(4===Rl||3===Rl&&(130023424&kl)===kl&&500>Ze()-zl?hc(e,0):Fl|=n),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=ec();null!==(e=Ri(e,t))&&(xt(e,t,n),rc(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Cc(e,n)}function Tc(e,t){return Ye(e,t)}function jc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,n,r){return new jc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,r,s,a){var o=2;if(r=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case S:return Oc(n.children,s,a,t);case A:o=8,s|=8;break;case _:return(e=kc(12,n,t,2|s)).elementType=_,e.lanes=a,e;case T:return(e=kc(13,n,t,s)).elementType=T,e.lanes=a,e;case j:return(e=kc(19,n,t,s)).elementType=j,e.lanes=a,e;case P:return Lc(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case I:o=9;break e;case E:o=11;break e;case k:o=14;break e;case D:o=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=kc(o,n,t,s)).elementType=e,t.type=r,t.lanes=a,t}function Oc(e,t,n,r){return(e=kc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=kc(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=kc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,s,i,a,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=kc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Li(i),e}function zc(e){if(!e)return Is;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ds(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Ds(n))return Os(e,n,t)}return t}function qc(e,t,n,r,s,i,a,o,l){return(e=Uc(n,r,!0,e,0,i,0,o,l)).context=zc(null),n=e.current,(i=Fi(r=ec(),s=tc(n))).callback=void 0!==t&&null!==t?t:null,Bi(n,i,s),e.current.lanes=s,xt(e,s,r),rc(e,r),e}function Hc(e,t,n,r){var s=t.current,i=ec(),a=tc(s);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fi(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Bi(s,t,a))&&(nc(e,s,a,i),Ui(e,s,a)),a}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ts.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:To(t),mi();break;case 5:Zi(t);break;case 1:Ds(t.type)&&Ls(t);break;case 4:Qi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;Cs(Ni,r._currentValue),r._currentValue=s;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Cs($i,1&$i.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Mo(e,t,n):(Cs($i,1&$i.current),null!==(e=Vo(e,t,n))?e.sibling:null);Cs($i,1&$i.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return qo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Cs($i,$i.current),r)break;return null;case 22:case 23:return t.lanes=0,Ao(e,t,n)}return Vo(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,si&&0!==(1048576&t.flags)&&$s(t,Gs,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ho(e,t),e=t.pendingProps;var s=ks(t,Es.current);Ti(t,n),s=pa(null,t,r,e,s,n);var a=ga();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ds(r)?(a=!0,Ls(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Li(t),s.updater=ro,t.stateNode=s,s._reactInternals=t,oo(t,r,e,n),t=Eo(null,t,r,!0,a,n)):(t.tag=0,si&&a&&ei(t),wo(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===k)return 14}return 2}(r),e=to(r,e),s){case 0:t=Co(null,t,r,e,n);break e;case 1:t=Io(null,t,r,e,n);break e;case 11:t=vo(null,t,r,e,n);break e;case 14:t=No(null,t,r,to(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,Co(e,t,r,s=t.elementType===r?s:to(r,s),n);case 1:return r=t.type,s=t.pendingProps,Io(e,t,r,s=t.elementType===r?s:to(r,s),n);case 3:e:{if(To(t),null===e)throw Error(i(387));r=t.pendingProps,s=(a=t.memoizedState).element,Mi(e,t),qi(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=jo(e,t,r,n,s=lo(Error(i(423)),t));break e}if(r!==s){t=jo(e,t,r,n,s=lo(Error(i(424)),t));break e}for(ri=cs(t.stateNode.containerInfo.firstChild),ni=t,si=!0,ii=null,n=vi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(mi(),r===s){t=Vo(e,t,n);break e}wo(e,t,r,n)}t=t.child}return t;case 5:return Zi(t),null===e&&ci(t),r=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ns(r,s)?o=null:null!==a&&ns(r,a)&&(t.flags|=32),_o(e,t),wo(e,t,o,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Mo(e,t,n);case 4:return Qi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wi(t,null,r,n):wo(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,vo(e,t,r,s=t.elementType===r?s:to(r,s),n);case 7:return wo(e,t,t.pendingProps,n),t.child;case 8:case 12:return wo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Cs(Ni,r._currentValue),r._currentValue=o,null!==a)if(or(a.value,o)){if(a.children===s.children&&!Ts.current){t=Vo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Fi(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ei(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ei(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}wo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Ti(t,n),r=r(s=ji(s)),t.flags|=1,wo(e,t,r,n),t.child;case 14:return s=to(r=t.type,t.pendingProps),No(e,t,r,s=to(r.type,s),n);case 15:return So(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:to(r,s),Ho(e,t),t.tag=1,Ds(r)?(e=!0,Ls(t)):e=!1,Ti(t,n),io(t,r,s),oo(t,r,s,n),Eo(null,t,r,!0,e,n);case 19:return qo(e,t,n);case 22:return Ao(e,t,n)}throw Error(i(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function $c(e,t,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof s){var o=s;s=function(){var e=Vc(a);o.call(e)}}Hc(t,a,e,s)}else a=function(e,t,n,r,s){if(s){if("function"===typeof r){var i=r;r=function(){var e=Vc(a);i.call(e)}}var a=qc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[fs]=a.current,qr(8===e.nodeType?e.parentNode:e),dc(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fs]=l.current,qr(8===e.nodeType?e.parentNode:e),dc(function(){Hc(t,l,n,r)}),l}(n,t,e,s,r);return Vc(a)}Qc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Hc(e,t,null,null)},Qc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Hc(null,e,null,null)}),t[fs]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=At();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Mt(e)}},vt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ze()),0===(6&El)&&(ql=Ze()+500,qs()))}break;case 13:dc(function(){var t=Ri(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Gc(e,1)}},Nt=function(e){if(13===e.tag){var t=Ri(e,134217728);if(null!==t)nc(t,e,134217728,ec());Gc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Ri(e,t);if(null!==n)nc(n,e,t,ec());Gc(e,t)}},At=function(){return bt},_t=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ne=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=vs(r);if(!s)throw Error(i(90));Y(r),J(r,s)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=cc,Te=dc;var ed={usingClientEntryPoint:!1,Events:[bs,ws,vs,Ce,Ie,cc]},td={findFiberByHostInstance:ys,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rd.isDisabled&&rd.supportsFiber)try{st=rd.inject(nd),it=rd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:N,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(i(299));var n=!1,r="",s=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,s),e[fs]=t.current,qr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(i(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,s=!1,a="",o=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=qc(t,null,e,1,null!=n?n:null,s,0,a,o),e[fs]=t.current,qr(e),r)for(e=0;e<r.length;e++)s=(s=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Qc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(i(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(i(40));return!!e._reactRootContainer&&(dc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[fs]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return $c(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},2799:(e,t,n)=>{"use strict";n.d(t,{P2:()=>x});var r=n(9379);const s=(e,t)=>t.some(t=>e instanceof t);let i,a;const o=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(g(this),n),p(o.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return p(e.apply(g(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];const i=e.call(g(this),t,...r);return c.set(i,t.sort?t.sort():[t]),p(i)}}function f(e){return"function"===typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(l.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});l.set(e,t)}(e),s(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(p(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&o.set(t,e)}).catch(()=>{}),u.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=f(e);return t!==e&&(d.set(e,t),u.set(t,e)),t}const g=e=>u.get(e);function x(e,t){let{blocked:n,upgrade:r,blocking:s,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=p(a);return r&&a.addEventListener("upgradeneeded",e=>{r(p(a.result),e.oldVersion,e.newVersion,p(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}const y=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function v(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=b.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const i=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let i=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return r&&(i=i.index(o.shift())),(await Promise.all([i[n](...o),s&&t.done]))[0]};return w.set(t,i),i}h=(e=>(0,r.A)((0,r.A)({},e),{},{get:(t,n,r)=>v(t,n)||e.get(t,n,r),has:(t,n)=>!!v(t,n)||e.has(t,n)}))(h)},2814:(e,t,n)=>{"use strict";n.d(t,{IV:()=>u,Ku:()=>i,Nx:()=>l,WK:()=>r,ay:()=>d,cR:()=>c,sp:()=>o});const r={basic:{unlockedModules:["dashboard","customers","products","inventory","billing","salesOrderHistory","refunds","settings"],lockedModules:["purchase","financial","reports"],maxCustomers:149,maxProducts:499,maxOrders:199,voiceAssistant:!1,advancedReports:!1,userManagement:!1},standard:{unlockedModules:["dashboard","customers","products","inventory","billing","salesOrderHistory","refunds","purchase","reports","settings"],lockedModules:["financial"],maxCustomers:299,maxProducts:899,maxOrders:599,voiceAssistant:!1,advancedReports:!1,userManagement:!1},premium:{unlockedModules:["dashboard","customers","products","inventory","billing","salesOrderHistory","refunds","purchase","financial","reports","settings"],lockedModules:[],maxCustomers:1/0,maxProducts:1/0,maxOrders:1/0,voiceAssistant:!0,advancedReports:!0,userManagement:!0}},s=e=>e?e.toLowerCase().replace(/\s+/g,"").replace(/orders?/g,"").replace(/ai/g,"").replace(/voice/g,"").replace(/assistant/g,"assistant"):"",i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("upgrade"===e||"dashboard"===e||"settings"===e)return!0;if(n&&n.unlockedModules){const t=n.unlockedModules.map(s),r=s(e);if(t.includes(r))return!0;const i=e.toLowerCase();for(const e of n.unlockedModules)if(e.toLowerCase()===i)return!0;const a={purchase:["purchase","purchaseorders","purchase orders"],purchaseOrders:["purchase","purchaseorders","purchase orders"],financial:["financial","finance","financial management"],reports:["reports","reporting"],settings:["settings","setting"],dashboard:["dashboard"],customers:["customers","customer"],products:["products","product"],inventory:["inventory","stock"],billing:["billing","bill"],salesOrderHistory:["salesorderhistory","sales order history","order history","orders"]}[e]||[e];for(const e of a){const r=s(e);if(t.includes(r))return!0;for(const t of n.unlockedModules)if(t.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(t.toLowerCase()))return!0}return!1}const i=r[t];return!!i&&i.unlockedModules.includes(e)},a=(e,t,n)=>{if(e&&void 0!==e[t]&&null!==e[t]){const n=e[t];if("string"===typeof n){const e=n.toLowerCase();if("unlimited"===e||"infinity"===e)return 1/0;const t=parseInt(n,10);if(!Number.isNaN(t))return t}if("number"===typeof n)return-1===n?1/0:n}return n},o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=r[t];if(!s&&!n)return!1;return e<a(n,"maxCustomers",s?s.maxCustomers:0)},l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=r[t];if(!s&&!n)return!1;return e<a(n,"maxProducts",s?s.maxProducts:0)},c=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=r[t];if(!s&&!n)return!1;return e<a(n,"maxOrders",s?s.maxOrders:0)},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=r[e];if(!n&&!t)return{maxCustomers:0,maxProducts:0,maxOrders:0};const s=n?n.maxCustomers:0,i=n?n.maxProducts:0,o=n?n.maxOrders:0;return{maxCustomers:a(t,"maxCustomers",s),maxProducts:a(t,"maxProducts",i),maxOrders:a(t,"maxOrders",o)}},u=(e,t)=>{if("upgrade"===e)return"";return{purchase:"Upgrade to Standard Plan to manage purchase orders",financial:"Upgrade to Premium Plan to access financial management",reports:"basic"===t?"Upgrade to Standard Plan for basic reports":"Upgrade to Premium Plan for advanced reports",settings:"Upgrade to Premium Plan for full settings control"}[e]||"Upgrade your plan to access this feature"}},2965:(e,t,n)=>{"use strict";n.d(t,{$b:()=>s,Vy:()=>c});const r=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},a=s.INFO,o={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},l=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=o[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var s=arguments.length,i=new Array(s>2?s-2:0),a=2;a<s;a++)i[a-2]=arguments[a];console[r]("[".concat(n,"]  ").concat(e.name,":"),...i)};class c{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}},3257:(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},3637:(e,t,n)=>{"use strict";n.d(t,{HF:()=>et,xI:()=>Fn,Q4:()=>sn,df:()=>Xt,$2:()=>rn,CI:()=>dt});var r=n(3986),s=n(9379),i=n(1150),a=n(1776),o=n(2965),l=n(9606);const c=["providerId"],d=["uid","auth","stsTokenManager"],u=["providerId","signInMethod"];function h(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const m=h,f=new a.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),p=new o.Vy("@firebase/auth");function g(e){if(p.logLevel<=o.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.error("Auth (".concat(i.MF,"): ").concat(e),...n)}}function x(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw N(e,...n)}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return N(e,...n)}function b(e,t,n){const r=(0,s.A)((0,s.A)({},m()),{},{[t]:n});return new a.FA("auth","Firebase",r).create(t,{appName:e.name})}function w(e){return b(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function v(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&x(e,"argument-error"),b(e,"argument-error","Type of ".concat(t.constructor.name," does not match expected instance.")+"Did you pass a reference from a different Auth SDK?")}function N(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return f.create(e,...n)}function S(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];throw N(t,...r)}}function A(e){const t="INTERNAL ASSERTION FAILED: "+e;throw g(t),new Error(t)}function _(e,t){e||A(t)}function C(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function I(){return"http:"===E()||"https:"===E()}function E(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class T{constructor(e,t){this.shortDelay=e,this.longDelay=t,_(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,a.jZ)()||(0,a.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(I()||(0,a.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function j(e,t){_(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class k{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void A("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void A("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void A("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const D={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},P=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],R=new T(3e4,6e4);function O(e,t){return e.tenantId&&!t.tenantId?(0,s.A)((0,s.A)({},t),{},{tenantId:e.tenantId}):t}async function L(e,t,n,r){return M(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},o={};r&&("GET"===t?o=r:i={body:JSON.stringify(r)});const l=(0,a.Am)((0,s.A)({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode);const d=(0,s.A)({method:t,headers:c},i);return(0,a.c1)()||(d.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,a.zJ)(e.emulatorConfig.host)&&(d.credentials="include"),k.fetch()(await B(e,e.config.apiHost,n,l),d)})}async function M(e,t,n){e._canInitEmulator=!1;const r=(0,s.A)((0,s.A)({},D),t);try{const t=new z(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw q(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw q(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw q(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw q(e,"user-disabled",i);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw b(e,o,a);x(e,o)}}catch(i){if(i instanceof a.g)throw i;x(e,"network-request-failed",{message:String(i)})}}async function F(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await L(e,t,n,r,s);return"mfaPendingCredential"in i&&x(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function B(e,t,n,r){const s="".concat(t).concat(n,"?").concat(r),i=e,a=i.config.emulator?j(e.config,s):"".concat(e.config.apiScheme,"://").concat(s);if(P.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(a).toString()}return a}function U(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class z{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(y(this.auth,"network-request-failed")),R.get())})}}function q(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=y(e,t,r);return s.customData._tokenResponse=n,s}function H(e){return void 0!==e&&void 0!==e.enterprise}class V{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return U(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function W(e,t){return L(e,"GET","/v2/recaptchaConfig",O(e,t))}async function G(e,t){return L(e,"POST","/v1/accounts:lookup",t)}function Y(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function X(e){return 1e3*Number(e)}function Q(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return g("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,a.u)(n);return e?JSON.parse(e):(g("Failed to decode base64 JWT payload"),null)}catch(s){return g("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function K(e){const t=Q(e);return S(t,"internal-error"),S("undefined"!==typeof t.exp,"internal-error"),S("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Z(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof a.g&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class J{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class ${constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Y(this.lastLoginAt),this.creationTime=Y(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ee(e){var t;const n=e.auth,r=await e.getIdToken(),s=await Z(e,G(n,{idToken:r}));S(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const a=null!==(t=i.providerUserInfo)&&void 0!==t&&t.length?te(i.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&i.passwordHash)&&!(null!==o&&void 0!==o&&o.length),h=!!d&&u,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new $(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,m)}function te(e){return e.map(e=>{let{providerId:t}=e,n=(0,r.A)(e,c);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class ne{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){S(e.idToken,"internal-error"),S("undefined"!==typeof e.idToken,"internal-error"),S("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):K(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){S(0!==e.length,"internal-error");const t=K(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(S(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await M(e,{},async()=>{const n=(0,a.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=await B(e,r,"/v1/token","key=".concat(s)),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:n};return e.emulatorConfig&&(0,a.zJ)(e.emulatorConfig.host)&&(l.credentials="include"),k.fetch()(i,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new ne;return n&&(S("string"===typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(S("string"===typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(S("number"===typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ne,this.toJSON())}_performRefresh(){return A("not implemented")}}function re(e,t){S("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class se{constructor(e){let{uid:t,auth:n,stsTokenManager:s}=e,i=(0,r.A)(e,d);this.providerId="firebase",this.proactiveRefresh=new J(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new $(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Z(this,this.stsTokenManager.getToken(this.auth,e));return S(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,a.Ku)(e),r=await n.getIdToken(t),s=Q(r);S(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"===typeof s.firebase?s.firebase:void 0,o=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Y(X(s.auth_time)),issuedAtTime:Y(X(s.iat)),expirationTime:Y(X(s.exp)),signInProvider:o||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,a.Ku)(e);await ee(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(S(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>(0,s.A)({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new se((0,s.A)((0,s.A)({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){S(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ee(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,i.xZ)(this.auth.app))return Promise.reject(w(this.auth));const e=await this.getIdToken();return await Z(this,async function(e,t){return L(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return(0,s.A)((0,s.A)({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>(0,s.A)({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,a,o,l,c,d;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,m=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(a=t.photoURL)&&void 0!==a?a:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(l=t._redirectEventId)&&void 0!==l?l:void 0,x=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(d=t.lastLoginAt)&&void 0!==d?d:void 0,{uid:b,emailVerified:w,isAnonymous:v,providerData:N,stsTokenManager:A}=t;S(b&&A,e,"internal-error");const _=ne.fromJSON(this.name,A);S("string"===typeof b,e,"internal-error"),re(u,e.name),re(h,e.name),S("boolean"===typeof w,e,"internal-error"),S("boolean"===typeof v,e,"internal-error"),re(m,e.name),re(f,e.name),re(p,e.name),re(g,e.name),re(x,e.name),re(y,e.name);const C=new se({uid:b,auth:e,email:h,emailVerified:w,displayName:u,isAnonymous:v,photoURL:f,phoneNumber:m,tenantId:p,stsTokenManager:_,createdAt:x,lastLoginAt:y});return N&&Array.isArray(N)&&(C.providerData=N.map(e=>(0,s.A)({},e))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new ne;r.updateFromServerResponse(t);const s=new se({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ee(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];S(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?te(r.providerUserInfo):[],i=!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length),a=new ne;a.updateFromIdToken(n);const o=new se({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new $(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length)};return Object.assign(o,l),o}}const ie=new Map;function ae(e){_(e instanceof Function,"Expected a class definition");let t=ie.get(e);return t?(_(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ie.set(e,t),t)}class oe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}oe.type="NONE";const le=oe;function ce(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class de{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=ce(this.userKey,r.apiKey,s),this.fullPersistenceKey=ce("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await G(this.auth,{idToken:e}).catch(()=>{});return t?se._fromGetAccountInfoResponse(this.auth,t,e):null}return se._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new de(ae(le),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=r[0]||ae(le);const i=ce(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"===typeof t){const r=await G(e,{idToken:t}).catch(()=>{});if(!r)break;n=await se._fromGetAccountInfoResponse(e,r,t)}else n=se._fromJSON(e,t);c!==s&&(a=n),s=c;break}}catch(l){}const o=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&o.length?(s=o[0],a&&await s._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(t){}})),new de(s,e,n)):new de(s,e,n)}}function ue(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(pe(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(he(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(xe(t))return"Blackberry";if(ye(t))return"Webos";if(me(t))return"Safari";if((t.includes("chrome/")||fe(t))&&!t.includes("edge/"))return"Chrome";if(ge(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function he(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/firefox\//i.test(e)}function me(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/crios\//i.test(e)}function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/iemobile/i.test(e)}function ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/android/i.test(e)}function xe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/blackberry/i.test(e)}function ye(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/webos/i.test(e)}function be(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function we(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return be(e)||ge(e)||ye(e)||xe(e)||/windows phone/i.test(e)||pe(e)}function ve(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=ue((0,a.ZQ)());break;case"Worker":t="".concat(ue((0,a.ZQ)()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(i.MF,"/").concat(r)}class Ne{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(s){r(s)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class Se{constructor(e){var t,n,r,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,s,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(s=o.containsUppercaseLetter)||void 0===s||s),o.isValid&&(o.isValid=null===(i=o.containsNumericCharacter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Ae{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ce(this),this.idTokenSubscription=new Ce(this),this.beforeStateQueue=new Ne(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=f,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ae(t)),this._initializationPromise=this.queue(async()=>{var n,r,s;if(!this._deleted&&(this.persistenceManager=await de.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await G(this,{idToken:e}),n=await se._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,i.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var s,a;await this.getOrInitRedirectPersistenceManager();const t=null===(s=this.redirectUser)||void 0===s?void 0:s._redirectEventId,i=null===(a=n)||void 0===a?void 0:a._redirectEventId,o=await this.tryRedirectSignIn(e);t&&t!==i||null===o||void 0===o||!o.user||(n=o.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return S(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ee(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,i.xZ)(this.app))return Promise.reject(w(this));const t=e?(0,a.Ku)(e):null;return t&&S(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&S(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,i.xZ)(this.app)?Promise.reject(w(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,i.xZ)(this.app)?Promise.reject(w(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ae(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return L(e,"GET","/v2/passwordPolicy",O(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Se(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new a.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return L(e,"POST","/v2/accounts:revokeToken",O(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ae(e)||this._popupRedirectResolver;S(t,this,"argument-error"),this.redirectPersistenceManager=await de.create(this,[ae(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(S(a,this,"internal-error"),a.then(()=>{i||s(this.currentUser)}),"function"===typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return S(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ve(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if((0,i.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(p.logLevel<=o.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.warn("Auth (".concat(i.MF,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function _e(e){return(0,a.Ku)(e)}class Ce{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,a.tD)(e=>this.observer=e)}get next(){return S(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ie={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ee(e){return Ie.loadJS(e)}function Te(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class je{constructor(){this.enterprise=new ke}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ke{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const De="NO_RECAPTCHA";class Pe{constructor(e){this.type="recaptcha-enterprise",this.auth=_e(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const s=window.grecaptcha;H(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(De)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new je).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{W(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new V(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&H(window.grecaptcha))n(s,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ie.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Ee(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Re(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=new Pe(e);let o;if(i)o=De;else try{o=await a.verify(n)}catch(c){o=await a.verify(n,!0)}const l=(0,s.A)({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in l){const e=l.phoneEnrollmentInfo.phoneNumber,t=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const e=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Oe(e,t,n,r,s){if("EMAIL_PASSWORD_PROVIDER"===s){var i;if(null!==(i=e._getRecaptchaConfig())&&void 0!==i&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Re(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch(async s=>{if(s.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const s=await Re(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){var a;if(null!==(a=e._getRecaptchaConfig())&&void 0!==a&&a.isProviderEnabled("PHONE_PROVIDER")){const s=await Re(e,t,n);return r(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&(s.code==="auth/".concat("missing-recaptcha-token")||s.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const s=await Re(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)})}{const s=await Re(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Le(e){const t=_e(e),n=await W(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new V(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Pe(t).verify()}}function Me(e,t,n){const r=_e(e);S(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!(null===n||void 0===n||!n.disableWarnings),i=Fe(t),{host:o,port:l}=function(e){const t=Fe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:Be(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Be(t)}}}(t),c=null===l?"":":".concat(l),d={url:"".concat(i,"//").concat(o).concat(c,"/")},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator)return S(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void S((0,a.bD)(d,r.config.emulator)&&(0,a.bD)(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,(0,a.zJ)(o)?((0,a.gE)("".concat(i,"//").concat(o).concat(c)),(0,a.P1)("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Fe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Be(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ue{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return A("not implemented")}_getIdTokenResponse(e){return A("not implemented")}_linkToIdToken(e,t){return A("not implemented")}_getReauthenticationResolver(e){return A("not implemented")}}async function ze(e,t){return L(e,"POST","/v1/accounts:signUp",t)}async function qe(e,t){return F(e,"POST","/v1/accounts:signInWithPassword",O(e,t))}class He extends Ue{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new He(e,t,"password")}static _fromEmailAndCode(e,t){return new He(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Oe(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",qe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return F(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}(e,{email:this._email,oobCode:this._password});default:x(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Oe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ze,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return F(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:x(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ve(e,t){return F(e,"POST","/v1/accounts:signInWithIdp",O(e,t))}class We extends Ue{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new We(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):x("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,i=(0,r.A)(t,u);if(!n||!s)return null;const a=new We(n,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return Ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ve(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,a.Am)(t)}return e}}async function Ge(e,t){return L(e,"POST","/v1/accounts:sendVerificationCode",O(e,t))}const Ye={USER_NOT_FOUND:"user-not-found"};class Xe extends Ue{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Xe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Xe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return F(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await F(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t));if(n.temporaryProof)throw q(e,"account-exists-with-different-credential",n);return n}(e,(0,s.A)({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return F(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,(0,s.A)((0,s.A)({},t),{},{operation:"REAUTH"})),Ye)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new Xe({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class Qe{constructor(e){var t,n,r,s,i,o;const l=(0,a.I9)((0,a.hp)(e)),c=null!==(t=l.apiKey)&&void 0!==t?t:null,d=null!==(n=l.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=l.mode)&&void 0!==r?r:null);S(c&&d&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=d,this.continueUrl=null!==(s=l.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=l.lang)&&void 0!==i?i:null,this.tenantId=null!==(o=l.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=(0,a.I9)((0,a.hp)(e)).link,n=t?(0,a.I9)((0,a.hp)(t)).deep_link_id:null,r=(0,a.I9)((0,a.hp)(e)).deep_link_id;return(r?(0,a.I9)((0,a.hp)(r)).link:null)||r||n||t||e}(e);try{return new Qe(t)}catch(n){return null}}}class Ke{constructor(){this.providerId=Ke.PROVIDER_ID}static credential(e,t){return He._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qe.parseLink(t);return S(n,"argument-error"),He._fromEmailAndCode(e,n.code,n.tenantId)}}Ke.PROVIDER_ID="password",Ke.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ke.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ze{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Je extends Ze{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $e extends Je{constructor(){super("facebook.com")}static credential(e){return We._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return $e.credential(t.oauthAccessToken)}catch(n){return null}}}$e.FACEBOOK_SIGN_IN_METHOD="facebook.com",$e.PROVIDER_ID="facebook.com";class et extends Je{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return We._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return et.credential(n,r)}catch(s){return null}}}et.GOOGLE_SIGN_IN_METHOD="google.com",et.PROVIDER_ID="google.com";class tt extends Je{constructor(){super("github.com")}static credential(e){return We._fromParams({providerId:tt.PROVIDER_ID,signInMethod:tt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tt.credentialFromTaggedObject(e)}static credentialFromError(e){return tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return tt.credential(t.oauthAccessToken)}catch(n){return null}}}tt.GITHUB_SIGN_IN_METHOD="github.com",tt.PROVIDER_ID="github.com";class nt extends Je{constructor(){super("twitter.com")}static credential(e,t){return We._fromParams({providerId:nt.PROVIDER_ID,signInMethod:nt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nt.credentialFromTaggedObject(e)}static credentialFromError(e){return nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return nt.credential(n,r)}catch(s){return null}}}nt.TWITTER_SIGN_IN_METHOD="twitter.com",nt.PROVIDER_ID="twitter.com";class rt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await se._fromIdTokenResponse(e,n,r),i=st(n);return new rt({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=st(n);return new rt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function st(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class it extends a.g{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,it.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new it(e,t,n,r)}}function at(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw it._fromErrorAndOperation(e,n,t,r);throw n})}async function ot(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Z(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return rt._forOperation(e,"link",r)}async function lt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if((0,i.xZ)(r.app))return Promise.reject(w(r));const s="reauthenticate";try{const i=await Z(e,at(r,s,t,e),n);S(i.idToken,r,"internal-error");const a=Q(i.idToken);S(a,r,"internal-error");const{sub:o}=a;return S(e.uid===o,r,"user-mismatch"),rt._forOperation(e,s,i)}catch(a){throw(null===a||void 0===a?void 0:a.code)==="auth/".concat("user-not-found")&&x(r,"user-mismatch"),a}}async function ct(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,i.xZ)(e.app))return Promise.reject(w(e));const r="signIn",s=await at(e,r,t),a=await rt._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(a.user),a}function dt(e){return(0,a.Ku)(e).signOut()}function ut(e,t){return L(e,"POST","/v2/accounts/mfaEnrollment:start",O(e,t))}new WeakMap;const ht="__sak";class mt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ht,"1"),this.storage.removeItem(ht),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ft extends mt{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=we(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,a.lT)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ft.type="LOCAL";const pt=ft;function gt(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),s=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(s))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function xt(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class yt{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=xt(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return gt(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=xt(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=xt(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=gt(n);const s=setInterval(()=>{const e=gt(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(s))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}yt.type="COOKIE";class bt extends mt{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bt.type="SESSION";const wt=bt;class vt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new vt(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(null===i||void 0===i||!i.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(i).map(async e=>e(t.origin,s)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Nt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}vt.receivers=[];class St{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise((a,o)=>{const l=Nt("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(c),clearTimeout(s),o(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function At(){return window}function _t(){return"undefined"!==typeof At().WorkerGlobalScope&&"function"===typeof At().importScripts}const Ct="firebaseLocalStorageDb",It="firebaseLocalStorage",Et="fbase_key";class Tt{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function jt(e,t){return e.transaction([It],t?"readwrite":"readonly").objectStore(It)}function kt(){const e=indexedDB.open(Ct,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(It,{keyPath:Et})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(It)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Ct);return new Tt(e).toPromise()}(),t(await kt()))})})}async function Dt(e,t,n){const r=jt(e,!0).put({[Et]:t,value:n});return new Tt(r).toPromise()}function Pt(e,t){const n=jt(e,!0).delete(t);return new Tt(n).toPromise()}class Rt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await kt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _t()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=vt._getInstance(_t()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new St(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kt();return await Dt(e,ht,"1"),await Pt(e,ht),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Dt(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=jt(e,!1).get(t),r=await new Tt(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Pt(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=jt(e,!1).getAll();return new Tt(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Rt.type="LOCAL";const Ot=Rt;function Lt(e,t){return L(e,"POST","/v2/accounts/mfaSignIn:start",O(e,t))}Te("rcb"),new T(3e4,6e4);const Mt="recaptcha";async function Ft(e,t,n){if(!e._getRecaptchaConfig())try{await Le(e)}catch(s){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){S("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=Oe(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===De){S((null===n||void 0===n?void 0:n.type)===Mt,e,"argument-error");return ut(e,await Bt(e,t,n))}return ut(e,t)},"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{var r;S("signin"===t.type,e,"internal-error");const i=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;S(i,e,"missing-multi-factor-info");const a={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=Oe(e,a,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===De){S((null===n||void 0===n?void 0:n.type)===Mt,e,"argument-error");return Lt(e,await Bt(e,t,n))}return Lt(e,t)},"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=Oe(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===De){S((null===n||void 0===n?void 0:n.type)===Mt,e,"argument-error");return Ge(e,await Bt(e,t,n))}return Ge(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function Bt(e,t,n){S(n.type===Mt,e,"argument-error");const r=await n.verify();S("string"===typeof r,e,"argument-error");const i=(0,s.A)({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class Ut{constructor(e){this.providerId=Ut.PROVIDER_ID,this.auth=_e(e)}verifyPhoneNumber(e,t){return Ft(this.auth,e,(0,a.Ku)(t))}static credential(e,t){return Xe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ut.credentialFromTaggedObject(t)}static credentialFromError(e){return Ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?Xe._fromTokenResponse(n,r):null}}function zt(e,t){return t?ae(t):(S(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ut.PROVIDER_ID="phone",Ut.PHONE_SIGN_IN_METHOD="phone";class qt extends Ue{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ve(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ve(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ve(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ht(e){return ct(e.auth,new qt(e),e.bypassAuthState)}function Vt(e){const{auth:t,user:n}=e;return S(n,t,"internal-error"),lt(n,new qt(e),e.bypassAuthState)}async function Wt(e){const{auth:t,user:n}=e;return S(n,t,"internal-error"),ot(n,new qt(e),e.bypassAuthState)}class Gt{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ht;case"linkViaPopup":case"linkViaRedirect":return Wt;case"reauthViaPopup":case"reauthViaRedirect":return Vt;default:x(this.auth,"internal-error")}}resolve(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yt=new T(2e3,1e4);async function Xt(e,t,n){if((0,i.xZ)(e.app))return Promise.reject(y(e,"operation-not-supported-in-this-environment"));const r=_e(e);v(e,t,Ze);const s=zt(r,n);return new Qt(r,"signInViaPopup",t,s).executeNotNull()}class Qt extends Gt{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,Qt.currentPopupAction&&Qt.currentPopupAction.cancel(),Qt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return S(e,this.auth,"internal-error"),e}async onExecution(){_(1===this.filter.length,"Popup operations only handle one event");const e=Nt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(y(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(y(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(y(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Yt.get())};e()}}Qt.currentPopupAction=null;const Kt="pendingRedirect",Zt=new Map;class Jt extends Gt{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Zt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=nn(t),r=tn(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Zt.set(this.auth._key(),e)}return this.bypassAuthState||Zt.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function $t(e,t){return tn(e)._set(nn(t),"true")}function en(e,t){Zt.set(e._key(),t)}function tn(e){return ae(e._redirectPersistence)}function nn(e){return ce(Kt,e.config.apiKey,e.name)}function rn(e,t,n){return async function(e,t,n){if((0,i.xZ)(e.app))return Promise.reject(w(e));const r=_e(e);v(e,t,Ze),await r._initializationPromise;const s=zt(r,n);return await $t(s,r),s._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}async function sn(e,t){return await _e(e)._initializationPromise,an(e,t,!1)}async function an(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,i.xZ)(e.app))return Promise.reject(w(e));const r=_e(e),s=zt(r,t),a=new Jt(r,s,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class on{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return cn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!cn(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(y(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ln(e))}saveEventToCache(e){this.cachedEventUids.add(ln(e)),this.lastProcessedEventTime=Date.now()}}function ln(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function cn(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const dn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,un=/^https?/;async function hn(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return L(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(mn(r))return}catch(n){}x(e,"unauthorized-domain")}function mn(e){const t=C(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!un.test(n))return!1;if(dn.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const fn=new T(3e4,6e4);function pn(){const e=At().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function gn(e){return new Promise((t,n)=>{var r,s;function i(){pn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{pn(),n(y(e,"network-request-failed"))},timeout:fn.get()})}if(null!==(r=At().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(s=At().gapi)||void 0===s||!s.load){const t=Te("iframefcb");return At()[t]=()=>{gapi.load?i():n(y(e,"network-request-failed"))},Ee("".concat(Ie.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}i()}}).catch(e=>{throw xn=null,e})}let xn=null;const yn=new T(5e3,15e3),bn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},wn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vn(e){const t=e.config;S(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?j(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:i.MF},s=wn.get(e.config.apiHost);s&&(r.eid=s);const o=e._getFrameworks();return o.length&&(r.fw=o.join(",")),"".concat(n,"?").concat((0,a.Am)(r).slice(1))}async function Nn(e){const t=await function(e){return xn=xn||gn(e),xn}(e),n=At().gapi;return S(n,e,"internal-error"),t.open({where:document.body,url:vn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bn,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=y(e,"network-request-failed"),i=At().setTimeout(()=>{r(s)},yn.get());function a(){At().clearTimeout(i),n(t)}t.ping(a).then(a,()=>{r(s)})}))}const Sn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class An{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function _n(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const d=(0,s.A)((0,s.A)({},Sn),{},{width:r.toString(),height:i.toString(),top:o,left:l}),u=(0,a.ZQ)().toLowerCase();n&&(c=fe(u)?"_blank":n),he(u)&&(t=t||"http://localhost",d.scrollbars="yes");const h=Object.entries(d).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return be(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new An(null);const m=window.open(t||"",c,h);S(m,e,"popup-blocked");try{m.focus()}catch(f){}return new An(m)}const Cn="__/auth/handler",In="emulator/auth/handler",En=encodeURIComponent("fac");async function Tn(e,t,n,r,s,o){S(e.config.authDomain,e,"auth-domain-config-required"),S(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:i.MF,eventId:s};if(t instanceof Ze){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,a.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))l[e]=t}if(t instanceof Je){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const i of Object.keys(c))void 0===c[i]&&delete c[i];const d=await e._getAppCheckToken(),u=d?"#".concat(En,"=").concat(encodeURIComponent(d)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Cn);return j(t,In)}(e),"?").concat((0,a.Am)(c).slice(1)).concat(u)}const jn="webStorageSupport";const kn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wt,this._completeRedirectFn=an,this._overrideRedirectResult=en}async _openPopup(e,t,n,r){var s;_(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return _n(e,await Tn(e,t,n,C(),r),Nt())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){At().location.href=e}(await Tn(e,t,n,C(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(_(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Nn(e),n=new on(e);return t.register("authEvent",t=>{S(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jn,{type:jn},n=>{var r;const s=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[jn];void 0!==s&&t(!!s),x(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hn(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return we()||me()||be()}};var Dn="@firebase/auth",Pn="1.11.1";class Rn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){S(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const On=(0,a.XA)("authIdTokenMaxAge")||300;let Ln=null;const Mn=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>On)return;const s=null===n||void 0===n?void 0:n.token;Ln!==s&&(Ln=s,await fetch(e,{method:s?"POST":"DELETE",headers:s?{Authorization:"Bearer ".concat(s)}:{}}))};function Fn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Sx)();const t=(0,i.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,i.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,a.bD)(r,null!==t&&void 0!==t?t:{}))return e;x(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:kn,persistence:[Ot,pt,wt]}),r=(0,a.XA)("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=Mn(e.toString());!function(e,t,n){(0,a.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){(0,a.Ku)(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}const s=(0,a.Tj)("auth");return s&&Me(n,"http://".concat(s)),n}var Bn;Ie={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=y("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Bn="Browser",(0,i.om)(new l.uA("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;S(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:Bn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ve(Bn)},c=new Ae(r,s,i,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ae);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,i.om)(new l.uA("auth-internal",e=>(e=>new Rn(e))(_e(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KO)(Dn,Pn,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Bn)),(0,i.KO)(Dn,Pn,"esm2020")},3862:(e,t,n)=>{"use strict";n.d(t,{$C:()=>i,$u:()=>o,AT:()=>a,JR:()=>s,Pb:()=>l,a4:()=>d,fS:()=>h,getStaffAuth:()=>c});var r=n(9379);const s="http://localhost:5000/api",i=async()=>{try{const e=s.replace("/api","")||"http://localhost:5000",t=new Promise((e,t)=>setTimeout(()=>t(new Error("Health check timeout")),5e3)),n=fetch("".concat(e,"/api/health"),{method:"GET",headers:{"Content-Type":"application/json"}}),r=await Promise.race([n,t]);if(r&&r.ok){return{available:!0,data:await r.json()}}return{available:!1,error:"Backend health check failed"}}catch(e){return"Health check timeout"===e.message?{available:!1,error:"Backend connection timeout"}:(console.error("Backend health check error:",e),{available:!1,error:e.message||"Backend not reachable"})}},a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const c=localStorage.getItem("auth");let d=null;if(c)try{var i;const e=JSON.parse(c);d=e.sellerId||(null===(i=e.currentUser)||void 0===i?void 0:i.sellerId)}catch(a){console.error("Error parsing auth data:",a)}else console.log("API Request - no auth data found in localStorage");const u=(0,r.A)({"Content-Type":"application/json"},d&&{"x-seller-id":d}),h=(0,r.A)((0,r.A)({},u),t.headers);!d&&h["x-seller-id"]&&console.warn("\ud83d\udea8 API Request missing sellerId for ".concat(e));const m=await fetch("".concat(s).concat(e),(0,r.A)((0,r.A)({},t),{},{headers:h,body:t.body?JSON.stringify(t.body):void 0}));console.log("\ud83d\udce1 Response status for ".concat(e,": ").concat(m.status," ").concat(m.statusText));const f=await m.text();let p;console.log("\ud83d\udcc4 Raw response for ".concat(e,":"),f.substring(0,500)+(f.length>500?"...":""));try{p=JSON.parse(f),console.log("\u2705 Parsed API Response (".concat(e,"):"),p)}catch(o){console.error("\u274c Failed to parse JSON response for ".concat(e,":"),o),p={}}if(!m.ok){if(403===m.status||404===m.status){const t=p.message||"",r=t.toLowerCase().includes("seller")&&(t.toLowerCase().includes("not found")||t.toLowerCase().includes("inactive")||t.toLowerCase().includes("deactivated")),s=e.includes("/data/all");if(r||s){console.log("\ud83d\udea8 Seller/account error detected on ".concat(e," - automatically logging out user and clearing data"));const t=async()=>{try{const{STORES:e,clearAllItems:t}=await Promise.resolve().then(n.bind(n,1337)),{getAllItems:r}=await Promise.resolve().then(n.bind(n,1337)),[s,i,a]=await Promise.all([r(e.products).catch(()=>[]),r(e.customers).catch(()=>[]),r(e.orders).catch(()=>[])]);if([...s,...i,...a].some(e=>e&&!1===e.isSynced))return console.warn("\u26a0\ufe0f Found unsynced data - skipping IndexedDB cleanup to prevent data loss"),!1;const o=[e.products,e.customers,e.orders,e.transactions,e.purchaseOrders,e.categories,e.refunds,e.activities,e.syncMetadata,e.staff,e.staffPermissions];return await Promise.all(o.map(e=>t(e).catch(()=>{}))),console.log("\ud83d\uddd1\ufe0f Cleared all IndexedDB data"),!0}catch(e){return console.error("\u274c Error clearing IndexedDB data:",e),!1}};await t(),localStorage.clear(),console.log("\ud83d\uddd1\ufe0f Cleared all localStorage data");try{const{ActionTypes:e}=await Promise.resolve().then(n.bind(n,8050));window.globalDispatch&&window.globalDispatch({type:e.LOGOUT})}catch(l){console.error("Error dispatching logout:",l)}return window.showToast&&window.showToast("Your account has been deactivated. All data has been cleared.","error"),setTimeout(()=>{window.location.href="/login"},2e3),{success:!1,error:"Your account has been deactivated. Data cleared and redirecting to login...",autoLogout:!0}}}throw new Error(p.message||"HTTP ".concat(m.status,": ").concat(m.statusText))}return{success:!0,data:p}}catch(c){return console.error("API request error (".concat(e,"):"),c),{success:!1,error:c.message}}},o=()=>{try{var e;const t=localStorage.getItem("auth");if(!t)return null;const n=JSON.parse(t);return n.sellerId||(null===(e=n.currentUser)||void 0===e?void 0:e.sellerId)||null}catch(t){return console.error("Error extracting sellerId from auth:",t),null}},l=async(e,t,n,r)=>{const i=new AbortController,a=setTimeout(()=>i.abort(),45e3);try{const o=await fetch("".concat(s,"/auth/seller"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,uid:t,displayName:n,photoURL:r}),signal:i.signal});if(clearTimeout(a),o.ok){const e=await o.json();if(e.success&&e.seller)return{success:!0,sellerId:e.seller._id,seller:e.seller,userType:"seller"}}return{success:!1,error:(await o.json().catch(()=>({}))).message||"Failed to get seller ID",status:o.status}}catch(o){return clearTimeout(a),console.error("Get seller ID error:",o),"AbortError"===o.name?{success:!1,error:"Request timeout. Please check your connection and try again.",status:408}:{success:!1,error:o.message}}},c=async(e,t,n,r)=>{console.log("\ud83d\udd0d Calling staff auth API for: ".concat(e));const i=new AbortController,a=setTimeout(()=>i.abort(),45e3);try{const o=await fetch("".concat(s,"/staff/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,uid:t,displayName:n,photoURL:r}),signal:i.signal});if(clearTimeout(a),console.log("\ud83d\udce1 Staff auth response status: ".concat(o.status," ").concat(o.statusText)),o.ok){const t=await o.json();if(console.log("\u2705 Staff auth response data:",t),t.success&&t.staff)return console.log("\u2705 Staff auth successful for ".concat(e)),{success:!0,staffId:t.staff._id,staff:t.staff,seller:t.seller,userType:"staff"}}const l=await o.json().catch(()=>({}));return console.log("\u274c Staff auth failed for ".concat(e,":"),l),{success:!1,error:l.message||"Failed to authenticate staff",status:o.status}}catch(o){return clearTimeout(a),console.error("\ud83d\udca5 Staff auth network error for ".concat(e,":"),o),"AbortError"===o.name?{success:!1,error:"Request timeout. Please check your connection and try again.",status:408}:{success:!1,error:o.message}}},d=async e=>{console.log("\ud83d\udce4 Updating seller profile with data:",e);const t=localStorage.getItem("auth");if(!t)return console.error("\u274c No auth data found in localStorage"),{success:!1,error:"Not authenticated. Please log in again."};let n;try{var s,i;const e=JSON.parse(t);n=e.sellerId||(null===(s=e.currentUser)||void 0===s?void 0:s.sellerId)||(null===(i=e.currentUser)||void 0===i?void 0:i._id),console.log("\ud83d\udd11 Using sellerId:",n)}catch(o){return console.error("\u274c Error parsing auth data:",o),{success:!1,error:"Invalid authentication data"}}return n?a("/auth/seller/profile",{method:"PUT",body:(0,r.A)((0,r.A)({},e),{},{sellerId:n})}):(console.error("\u274c No sellerId found in auth data"),{success:!1,error:"Seller ID not found. Please log in again."})},u=async(e,t,n)=>{const r={customers:"/sync/customers",products:"/sync/products",orders:"/sync/orders",transactions:"/sync/transactions",purchaseOrders:"/sync/vendor-orders",categories:"/sync/categories"}[e];if(!r)return console.error("[syncData] Unknown store: ".concat(e)),{success:!1,error:"Unknown store: ".concat(e)};console.log("[syncData] Syncing ".concat(e," to endpoint: ").concat(r)),console.log("[syncData] Items count: ".concat(Array.isArray(t)?t.length:1)),console.log("[syncData] SellerId: ".concat(n||"from header"));const i={items:Array.isArray(t)?t:[t]};n&&(i.sellerId=n),console.log("[syncData] Request body:",JSON.stringify(i,null,2)),console.log("[syncData] Making API request to: ".concat(s).concat(r));const o=await a(r,{method:"POST",body:i});return console.log("[syncData] API response for ".concat(e,":"),o),o},h=async e=>{try{console.log("\ud83d\udce4 [createOrder] Starting order creation API call...",e.id),console.log("\ud83d\udce4 [createOrder] Order data:",JSON.stringify(e,null,2));const n=o();if(console.log("\ud83d\udce4 [createOrder] SellerId from auth:",n),!n)return console.error("\u274c [createOrder] No sellerId found in auth!"),{success:!1,error:"No sellerId found. Please login again."};console.log("\ud83d\udce4 [createOrder] Calling syncData with storeName: orders");const r=await u("orders",e,n);if(console.log("\ud83d\udce5 [createOrder] Backend response:",r),console.log("\ud83d\udce5 [createOrder] Response success:",r.success),console.log("\ud83d\udce5 [createOrder] Response data:",r.data),r.success&&r.data){const t=r.data.results||r.data,n=t.success||[];if(console.log("\ud83d\udce5 [createOrder] Success items:",n),n.length>0){const t=n.find(t=>t.id===e.id)||n[0];return console.log("\u2705 [createOrder] Order created on backend:",t),{success:!0,_id:t._id,order:t,action:t.action||"created"}}return console.error("\u274c [createOrder] Order creation failed - no success items:",r),console.error("\u274c [createOrder] Failed items:",t.failed||[]),{success:!1,error:r.data.message||"Order creation failed - no success response"}}var t;return console.error("\u274c [createOrder] Order creation failed:",r),{success:!1,error:r.error||(null===(t=r.data)||void 0===t?void 0:t.message)||"Order creation failed"}}catch(n){return console.error("\u274c [createOrder] Exception creating order:",n),console.error("\u274c [createOrder] Error stack:",n.stack),{success:!1,error:n.message||"Failed to create order"}}}},3885:(e,t,n)=>{"use strict";n.d(t,{gc:()=>c,isOnline:()=>l,syncToIndexedDB:()=>m});var r=n(9379),s=n(3862),i=n(1337);const a=e=>{if(!e)return e;let t=0;void 0!==e.dueAmount&&null!==e.dueAmount?t="number"===typeof e.dueAmount?e.dueAmount:parseFloat(e.dueAmount)||0:void 0!==e.balanceDue&&null!==e.balanceDue&&(t="number"===typeof e.balanceDue?e.balanceDue:parseFloat(e.balanceDue)||0);const n=e.mobileNumber||e.phone||"",s=(0,r.A)((0,r.A)({},e),{},{dueAmount:t,balanceDue:t,mobileNumber:n});return(void 0!==e.dueAmount&&void 0===e.balanceDue||void 0!==e.balanceDue&&void 0===e.dueAmount)&&console.log("Normalized customer (fixed missing field):",{id:s.id,name:s.name,dueAmount:s.dueAmount,balanceDue:s.balanceDue}),s},o=e=>{if(!e)return e;const t=void 0!==e.stock?e.stock:void 0!==e.quantity?e.quantity:0,n=void 0!==e.costPrice?e.costPrice:void 0!==e.unitPrice?e.unitPrice:0;return(0,r.A)((0,r.A)({},e),{},{stock:t,quantity:t,costPrice:n,unitPrice:n,sellingUnitPrice:e.sellingUnitPrice||e.sellingPrice||0,sellingPrice:e.sellingUnitPrice||e.sellingPrice||0})},l=async()=>{if(!navigator.onLine)return!1;try{return(await(0,s.$C)()).available}catch(e){return console.error("Backend health check failed:",e),!1}},c=async()=>{if(await l())try{var e;const t=await(0,s.AT)("/data/all",{method:"GET"});if(t.success&&null!==(e=t.data)&&void 0!==e&&e.data){const{customers:e,products:n,orders:r,transactions:s,purchaseOrders:l,categories:c}=t.data.data,d=(e||[]).map(e=>a(e)),u=(n||[]).map(e=>o(e));return await Promise.all([m(i.STORES.customers,d),m(i.STORES.products,u),m(i.STORES.orders,r||[]),m(i.STORES.transactions,s||[]),m(i.STORES.purchaseOrders,l||[]),m(i.STORES.categories,c||[])]),{customers:d,products:u,orders:r||[],transactions:s||[],purchaseOrders:l||[],categories:c||[]}}}catch(h){console.error("Error fetching all data from backend:",h)}const[t,n,r,c,d,u]=await Promise.all([(0,i.getAllItems)(i.STORES.customers).catch(()=>[]),(0,i.getAllItems)(i.STORES.products).catch(()=>[]),(0,i.getAllItems)(i.STORES.orders).catch(()=>[]),(0,i.getAllItems)(i.STORES.transactions).catch(()=>[]),(0,i.getAllItems)(i.STORES.purchaseOrders).catch(()=>[]),(0,i.getAllItems)(i.STORES.categories).catch(()=>[])]);return{customers:(t||[]).map(e=>a(e)),products:(n||[]).map(e=>o(e)),orders:r||[],transactions:c||[],purchaseOrders:d||[],categories:u||[]}},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(e)&&0!==e.length?t?JSON.stringify(e.map(e=>({productName:e.productName||e.name,quantity:e.quantity,price:e.price})).sort((e,t)=>(e.productName||e.name||"").localeCompare(t.productName||t.name||""))):JSON.stringify(e.map(e=>({name:e.name,quantity:e.quantity,sellingPrice:e.sellingPrice,costPrice:e.costPrice})).sort((e,t)=>(e.name||"").localeCompare(t.name||""))):""},u=(e,t)=>{if(!e||!t)return!1;const n=new Date(e),r=new Date(t);return Math.abs(n.getTime()-r.getTime())<=5e3},h=(e,t,n)=>{if(e===i.STORES.products){const e=(t.name||"").trim().toLowerCase(),r=(t.description||"").trim().toLowerCase();return n.some(t=>{const n=(t.name||"").trim().toLowerCase(),s=(t.description||"").trim().toLowerCase();return n===e&&(s===r||""===s&&""===r||null===s&&null===r||void 0===s&&void 0===r)})}if(e===i.STORES.customers){const e=(t.name||"").trim().toLowerCase(),r=(t.mobileNumber||t.phone||"").trim(),s=(t.email||"").trim().toLowerCase();return n.some(t=>{const n=(t.name||"").trim().toLowerCase(),i=(t.mobileNumber||t.phone||"").trim(),a=(t.email||"").trim().toLowerCase();return r&&i?n===e&&i===r:s&&a?n===e&&a===s:n===e&&!i&&!a&&!r&&!s})}if(e===i.STORES.orders){const e=d(t.items,!1),r=t.createdAt||t.date;return n.some(n=>{if(n.sellerId!==t.sellerId)return!1;if((n.customerId||null)!==(t.customerId||null))return!1;if(Math.abs((n.totalAmount||0)-(t.totalAmount||0))>.01)return!1;return d(n.items,!1)===e&&(r&&n.createdAt?u(n.createdAt,r):n.id===t.id||n._id===t.id||n.id===t._id)})}if(e===i.STORES.purchaseOrders){const e=d(t.items,!0),r=t.createdAt||t.date;return n.some(n=>{if(n.sellerId!==t.sellerId)return!1;if((n.supplierName||"").trim().toLowerCase()!==(t.supplierName||"").trim().toLowerCase())return!1;if(Math.abs((n.total||0)-(t.total||0))>.01)return!1;return d(n.items,!0)===e&&(r&&n.createdAt?u(n.createdAt,r):n.id===t.id||n._id===t.id||n.id===t._id)})}return!1},m=async(e,t)=>{try{if(!await(0,i.isIndexedDBAvailable)())return void console.warn("\u26a0\ufe0f [syncToIndexedDB] IndexedDB unavailable - skipping sync for ".concat(e,". Data will remain in memory only."));console.log("\ud83d\udd04 [syncToIndexedDB] Syncing ".concat(e," with ").concat(t.length," items from MongoDB"));const s=(await(0,i.getAllItems)(e)).filter(e=>!1===e.isSynced);s.length>0&&console.log("\u26a0\ufe0f [syncToIndexedDB] Preserving ".concat(s.length," unsynced local ").concat(e," items")),console.log("\ud83d\uddd1\ufe0f [syncToIndexedDB] Clearing all existing ".concat(e," data from IndexedDB...")),await(0,i.clearAllItems)(e),console.log("\u2705 [syncToIndexedDB] Cleared ".concat(e," store"));const l=[];let c=0;for(const n of t){let t=n;e===i.STORES.customers?t=a(n):e===i.STORES.products&&(t=o(n));const s=t._id||t.id,d=(0,r.A)((0,r.A)({},t),{},{id:s,isSynced:!0});e===i.STORES.orders&&("splitPaymentDetails"in n?(n.splitPaymentDetails&&"object"===typeof n.splitPaymentDetails?d.splitPaymentDetails=JSON.parse(JSON.stringify(n.splitPaymentDetails)):d.splitPaymentDetails=n.splitPaymentDetails,"split"===n.paymentMethod&&console.log("[syncToIndexedDB] Preserving splitPaymentDetails for order ".concat(d.id,":"),{backend:n.splitPaymentDetails,preserved:d.splitPaymentDetails,itemToInsertKeys:Object.keys(d)})):"split"===n.paymentMethod&&console.warn("[syncToIndexedDB] WARNING: Order ".concat(d.id," has paymentMethod='split' but no splitPaymentDetails in backend response"))),h(e,d,l)?(c++,console.warn("\u26a0\ufe0f Duplicate ".concat(e," in MongoDB batch (skipping):"),{id:d.id,name:d.name||d.supplierName||"N/A"})):l.push(d)}if(c>0&&console.log("\u26a0\ufe0f [syncToIndexedDB] Skipped ".concat(c," duplicate items from MongoDB batch")),l.length>0&&(console.log("\ud83d\udce5 [syncToIndexedDB] Inserting ".concat(l.length," items from MongoDB into ").concat(e,"...")),await(0,i.addMultipleItems)(e,l,!0),console.log("\u2705 [syncToIndexedDB] Successfully inserted ".concat(l.length," items into ").concat(e))),s.length>0){console.log("\ud83d\udce5 [syncToIndexedDB] Re-inserting ".concat(s.length," unsynced local items into ").concat(e,"..."));for(const t of s)try{await(0,i.updateItem)(e,t,!0)}catch(n){console.error("Error re-inserting unsynced item ".concat(t.id," in ").concat(e,":"),n)}console.log("\u2705 [syncToIndexedDB] Successfully re-inserted ".concat(s.length," unsynced items into ").concat(e))}console.log("\u2705 [syncToIndexedDB] Completed sync for ".concat(e,": ").concat(l.length," MongoDB items + ").concat(s.length," unsynced local items"))}catch(n){const t=(null===n||void 0===n?void 0:n.message)||(null===n||void 0===n?void 0:n.toString())||"Unknown error";if(t.includes("Internal error opening backing store")||t.includes("UnknownError")||t.includes("QuotaExceededError"))return console.warn("\u26a0\ufe0f [syncToIndexedDB] IndexedDB storage unavailable for ".concat(e," - likely private browsing or storage quota exceeded. Data will remain in memory.")),void console.warn("   Error details: ".concat(t));throw console.error("\u274c [syncToIndexedDB] Unexpected error syncing ".concat(e," to IndexedDB:"),n),n}}},3986:(e,t,n)=>{"use strict";function r(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}n.d(t,{A:()=>r})},4004:(e,t,n)=>{const r=n(7421),s=n(900),i=n(9642),a=n(8697),o=n(5200),l=n(8511),c=n(7969),d=n(7347);function u(e){return unescape(encodeURIComponent(e)).length}function h(e,t,n){const r=[];let s;for(;null!==(s=e.exec(n));)r.push({data:s[0],index:s.index,mode:t,length:s[0].length});return r}function m(e){const t=h(l.NUMERIC,r.NUMERIC,e),n=h(l.ALPHANUMERIC,r.ALPHANUMERIC,e);let s,i;c.isKanjiModeEnabled()?(s=h(l.BYTE,r.BYTE,e),i=h(l.KANJI,r.KANJI,e)):(s=h(l.BYTE_KANJI,r.BYTE,e),i=[]);return t.concat(n,s,i).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function f(e,t){switch(t){case r.NUMERIC:return s.getBitsLength(e);case r.ALPHANUMERIC:return i.getBitsLength(e);case r.KANJI:return o.getBitsLength(e);case r.BYTE:return a.getBitsLength(e)}}function p(e,t){let n;const l=r.getBestModeForData(e);if(n=r.from(t,l),n!==r.BYTE&&n.bit<l.bit)throw new Error('"'+e+'" cannot be encoded with mode '+r.toString(n)+".\n Suggested mode is: "+r.toString(l));switch(n!==r.KANJI||c.isKanjiModeEnabled()||(n=r.BYTE),n){case r.NUMERIC:return new s(e);case r.ALPHANUMERIC:return new i(e);case r.KANJI:return new o(e);case r.BYTE:return new a(e)}}t.fromArray=function(e){return e.reduce(function(e,t){return"string"===typeof t?e.push(p(t,null)):t.data&&e.push(p(t.data,t.mode)),e},[])},t.fromString=function(e,n){const s=function(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n];switch(s.mode){case r.NUMERIC:t.push([s,{data:s.data,mode:r.ALPHANUMERIC,length:s.length},{data:s.data,mode:r.BYTE,length:s.length}]);break;case r.ALPHANUMERIC:t.push([s,{data:s.data,mode:r.BYTE,length:s.length}]);break;case r.KANJI:t.push([s,{data:s.data,mode:r.BYTE,length:u(s.data)}]);break;case r.BYTE:t.push([{data:s.data,mode:r.BYTE,length:u(s.data)}])}}return t}(m(e,c.isKanjiModeEnabled())),i=function(e,t){const n={},s={start:{}};let i=["start"];for(let a=0;a<e.length;a++){const o=e[a],l=[];for(let e=0;e<o.length;e++){const c=o[e],d=""+a+e;l.push(d),n[d]={node:c,lastCount:0},s[d]={};for(let e=0;e<i.length;e++){const a=i[e];n[a]&&n[a].node.mode===c.mode?(s[a][d]=f(n[a].lastCount+c.length,c.mode)-f(n[a].lastCount,c.mode),n[a].lastCount+=c.length):(n[a]&&(n[a].lastCount=c.length),s[a][d]=f(c.length,c.mode)+4+r.getCharCountIndicator(c.mode,t))}}i=l}for(let r=0;r<i.length;r++)s[i[r]].end=0;return{map:s,table:n}}(s,n),a=d.find_path(i.map,"start","end"),o=[];for(let t=1;t<a.length-1;t++)o.push(i.table[a[t]].node);return t.fromArray(function(e){return e.reduce(function(e,t){const n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}(o))},t.rawSplit=function(e){return t.fromArray(m(e,c.isKanjiModeEnabled()))}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=x.prototype;var w=b.prototype=new y;w.constructor=b,p(w,x.prototype),w.isPureReactComponent=!0;var v=Array.isArray,N=Object.prototype.hasOwnProperty,S={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var s,i={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)N.call(t,s)&&!A.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===i[s]&&(i[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:i,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,s,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===i?"."+E(l,0):i,v(a)?(s="",null!=e&&(s=e.replace(I,"$&/")+"/"),T(a,t,s,"",function(e){return e})):null!=a&&(C(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",v(e))for(var c=0;c<e.length;c++){var d=i+E(o=e[c],c);l+=T(o,t,s,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=T(o=o.value,t,s,d=i+E(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function j(e,t,n){if(null==e)return e;var r=[],s=0;return T(e,r,"","",function(e){return t.call(n,e,s++)}),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},P={transition:null},R={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:P,ReactCurrentOwner:S};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:j,forEach:function(e,t,n){j(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return j(e,function(){t++}),t},toArray:function(e){return j(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=x,t.Fragment=s,t.Profiler=a,t.PureComponent=b,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=p({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)N.call(t,c)&&!A.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:n,type:e.type,key:i,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4566:e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1===(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let n=0;n<t;n++)this.putBit(1===(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},4661:e=>{function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,n,r){const s=e*this.size+t;this.data[s]=n,r&&(this.reservedBit[s]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},4772:(e,t,n)=>{const r=n(7969),s=n(6272),i=n(4566),a=n(4661),o=n(9382),l=n(9021),c=n(4833),d=n(1805),u=n(8177),h=n(2599),m=n(350),f=n(7421),p=n(4004);function g(e,t,n){const r=e.size,s=m.getEncodedBits(t,n);let i,a;for(i=0;i<15;i++)a=1===(s>>i&1),i<6?e.set(i,8,a,!0):i<8?e.set(i+1,8,a,!0):e.set(r-15+i,8,a,!0),i<8?e.set(8,r-i-1,a,!0):i<9?e.set(8,15-i-1+1,a,!0):e.set(8,15-i-1,a,!0);e.set(r-8,8,1,!0)}function x(e,t,n){const s=new i;n.forEach(function(t){s.put(t.mode.bit,4),s.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(s)});const a=8*(r.getSymbolTotalCodewords(e)-d.getTotalCodewordsCount(e,t));for(s.getLengthInBits()+4<=a&&s.put(0,4);s.getLengthInBits()%8!==0;)s.putBit(0);const o=(a-s.getLengthInBits())/8;for(let r=0;r<o;r++)s.put(r%2?17:236,8);return function(e,t,n){const s=r.getSymbolTotalCodewords(t),i=d.getTotalCodewordsCount(t,n),a=s-i,o=d.getBlocksCount(t,n),l=s%o,c=o-l,h=Math.floor(s/o),m=Math.floor(a/o),f=m+1,p=h-m,g=new u(p);let x=0;const y=new Array(o),b=new Array(o);let w=0;const v=new Uint8Array(e.buffer);for(let r=0;r<o;r++){const e=r<c?m:f;y[r]=v.slice(x,x+e),b[r]=g.encode(y[r]),x+=e,w=Math.max(w,e)}const N=new Uint8Array(s);let S,A,_=0;for(S=0;S<w;S++)for(A=0;A<o;A++)S<y[A].length&&(N[_++]=y[A][S]);for(S=0;S<p;S++)for(A=0;A<o;A++)N[_++]=b[A][S];return N}(s,e,t)}function y(e,t,n,s){let i;if(Array.isArray(e))i=p.fromArray(e);else{if("string"!==typeof e)throw new Error("Invalid data");{let r=t;if(!r){const t=p.rawSplit(e);r=h.getBestVersionForData(t,n)}i=p.fromString(e,r||40)}}const d=h.getBestVersionForData(i,n);if(!d)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<d)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+d+".\n")}else t=d;const u=x(t,n,i),m=r.getSymbolSize(t),f=new a(m);return function(e,t){const n=e.size,r=l.getPositions(t);for(let s=0;s<r.length;s++){const t=r[s][0],i=r[s][1];for(let r=-1;r<=7;r++)if(!(t+r<=-1||n<=t+r))for(let s=-1;s<=7;s++)i+s<=-1||n<=i+s||(r>=0&&r<=6&&(0===s||6===s)||s>=0&&s<=6&&(0===r||6===r)||r>=2&&r<=4&&s>=2&&s<=4?e.set(t+r,i+s,!0,!0):e.set(t+r,i+s,!1,!0))}}(f,t),function(e){const t=e.size;for(let n=8;n<t-8;n++){const t=n%2===0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}(f),function(e,t){const n=o.getPositions(t);for(let r=0;r<n.length;r++){const t=n[r][0],s=n[r][1];for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)-2===n||2===n||-2===r||2===r||0===n&&0===r?e.set(t+n,s+r,!0,!0):e.set(t+n,s+r,!1,!0)}}(f,t),g(f,n,0),t>=7&&function(e,t){const n=e.size,r=h.getEncodedBits(t);let s,i,a;for(let o=0;o<18;o++)s=Math.floor(o/3),i=o%3+n-8-3,a=1===(r>>o&1),e.set(s,i,a,!0),e.set(i,s,a,!0)}(f,t),function(e,t){const n=e.size;let r=-1,s=n-1,i=7,a=0;for(let o=n-1;o>0;o-=2)for(6===o&&o--;;){for(let n=0;n<2;n++)if(!e.isReserved(s,o-n)){let r=!1;a<t.length&&(r=1===(t[a]>>>i&1)),e.set(s,o-n,r),i--,-1===i&&(a++,i=7)}if(s+=r,s<0||n<=s){s-=r,r=-r;break}}}(f,u),isNaN(s)&&(s=c.getBestMask(f,g.bind(null,f,n))),c.applyMask(s,f),g(f,n,s),{modules:f,version:t,errorCorrectionLevel:n,maskPattern:s,segments:i}}t.create=function(e,t){if("undefined"===typeof e||""===e)throw new Error("No input text");let n,i,a=s.M;return"undefined"!==typeof t&&(a=s.from(t.errorCorrectionLevel,s.M),n=h.from(t.version),i=c.from(t.maskPattern),t.toSJISFunc&&r.setToSJISFunction(t.toSJISFunc)),y(e,n,a,i)}},4833:(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const n=3,r=3,s=40,i=10;function a(e,n,r){switch(e){case t.Patterns.PATTERN000:return(n+r)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return r%3===0;case t.Patterns.PATTERN011:return(n+r)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2===0;case t.Patterns.PATTERN101:return n*r%2+n*r%3===0;case t.Patterns.PATTERN110:return(n*r%2+n*r%3)%2===0;case t.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2===0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let r=0,s=0,i=0,a=null,o=null;for(let l=0;l<t;l++){s=i=0,a=o=null;for(let c=0;c<t;c++){let t=e.get(l,c);t===a?s++:(s>=5&&(r+=n+(s-5)),a=t,s=1),t=e.get(c,l),t===o?i++:(i>=5&&(r+=n+(i-5)),o=t,i=1)}s>=5&&(r+=n+(s-5)),i>=5&&(r+=n+(i-5))}return r},t.getPenaltyN2=function(e){const t=e.size;let n=0;for(let r=0;r<t-1;r++)for(let s=0;s<t-1;s++){const t=e.get(r,s)+e.get(r,s+1)+e.get(r+1,s)+e.get(r+1,s+1);4!==t&&0!==t||n++}return n*r},t.getPenaltyN3=function(e){const t=e.size;let n=0,r=0,i=0;for(let s=0;s<t;s++){r=i=0;for(let a=0;a<t;a++)r=r<<1&2047|e.get(s,a),a>=10&&(1488===r||93===r)&&n++,i=i<<1&2047|e.get(a,s),a>=10&&(1488===i||93===i)&&n++}return n*s},t.getPenaltyN4=function(e){let t=0;const n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return Math.abs(Math.ceil(100*t/n/5)-10)*i},t.applyMask=function(e,t){const n=t.size;for(let r=0;r<n;r++)for(let s=0;s<n;s++)t.isReserved(s,r)||t.xor(s,r,a(e,s,r))},t.getBestMask=function(e,n){const r=Object.keys(t.Patterns).length;let s=0,i=1/0;for(let a=0;a<r;a++){n(a),t.applyMask(a,e);const r=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(a,e),r<i&&(i=r,s=a)}return s}},4980:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(2284);function s(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=(0,r.A)(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}function i(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5200:(e,t,n)=>{const r=n(7421),s=n(7969);function i(e){this.mode=r.KANJI,this.data=e}i.getBitsLength=function(e){return 13*e},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=s.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else{if(!(n>=57408&&n<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");n-=49472}n=192*(n>>>8&255)+(255&n),e.put(n,13)}},e.exports=i},5487:(e,t,n)=>{const r=n(8293);function s(e,t){const n=e.a/255,r=t+'="'+e.hex+'"';return n<1?r+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function i(e,t,n){let r=e+t;return"undefined"!==typeof n&&(r+=" "+n),r}t.render=function(e,t,n){const a=r.getOptions(t),o=e.modules.size,l=e.modules.data,c=o+2*a.margin,d=a.color.light.a?"<path "+s(a.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",u="<path "+s(a.color.dark,"stroke")+' d="'+function(e,t,n){let r="",s=0,a=!1,o=0;for(let l=0;l<e.length;l++){const c=Math.floor(l%t),d=Math.floor(l/t);c||a||(a=!0),e[l]?(o++,l>0&&c>0&&e[l-1]||(r+=a?i("M",c+n,.5+d+n):i("m",s,0),s=0,a=!1),c+1<t&&e[l+1]||(r+=i("h",o),o=0)):s++}return r}(l,o,a.margin)+'"/>',h='viewBox="0 0 '+c+" "+c+'"',m='<svg xmlns="http://www.w3.org/2000/svg" '+(a.width?'width="'+a.width+'" height="'+a.width+'" ':"")+h+' shape-rendering="crispEdges">'+d+u+"</svg>\n";return"function"===typeof n&&n(null,m),m}},6116:e=>{e.exports=function(){return"function"===typeof Promise&&Promise.prototype&&Promise.prototype.then}},6272:(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&"undefined"!==typeof e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!==typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(r){return n}}},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,d=e[c];if(0>i(l,n))c<s&&0>i(d,l)?(e[r]=d,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>i(d,n)))break e;e[r]=d,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,m=3,f=!1,p=!1,g=!1,x="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,n(c,t)}t=r(d)}}function v(e){if(g=!1,w(e),!p)if(null!==r(c))p=!0,P(N);else{var t=r(d);null!==t&&R(v,t.startTime-e)}}function N(e,n){p=!1,g&&(g=!1,y(C),C=-1),f=!0;var i=m;try{for(w(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!T());){var a=h.callback;if("function"===typeof a){h.callback=null,m=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&s(c),w(n)}else s(c);h=r(c)}if(null!==h)var l=!0;else{var u=r(d);null!==u&&R(v,u.startTime-n),l=!1}return l}finally{h=null,m=i,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,A=!1,_=null,C=-1,I=5,E=-1;function T(){return!(t.unstable_now()-E<I)}function j(){if(null!==_){var e=t.unstable_now();E=e;var n=!0;try{n=_(!0,e)}finally{n?S():(A=!1,_=null)}}else A=!1}if("function"===typeof b)S=function(){b(j)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,D=k.port2;k.port1.onmessage=j,S=function(){D.postMessage(null)}}else S=function(){x(j,0)};function P(e){_=e,A||(A=!0,S())}function R(e,n){C=x(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,P(N))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},t.unstable_scheduleCallback=function(e,s,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,n(d,e),null===r(c)&&e===r(d)&&(g?(y(C),C=-1):g=!0,R(v,i-a))):(e.sortIndex=o,n(c,e),p||f||(p=!0,P(N))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}},7347:e=>{"use strict";var t={single_source_shortest_paths:function(e,n,r){var s={},i={};i[n]=0;var a,o,l,c,d,u,h,m=t.PriorityQueue.make();for(m.push(n,0);!m.empty();)for(l in o=(a=m.pop()).value,c=a.cost,d=e[o]||{})d.hasOwnProperty(l)&&(u=c+d[l],h=i[l],("undefined"===typeof i[l]||h>u)&&(i[l]=u,m.push(l,u),s[l]=o));if("undefined"!==typeof r&&"undefined"===typeof i[r]){var f=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(f)}return s},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(e,n,r){var s=t.single_source_shortest_paths(e,n,r);return t.extract_shortest_path_from_predecessor_list(s,r)},PriorityQueue:{make:function(e){var n,r=t.PriorityQueue,s={};for(n in e=e||{},r)r.hasOwnProperty(n)&&(s[n]=r[n]);return s.queue=[],s.sorter=e.sorter||r.default_sorter,s},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},7421:(e,t,n)=>{const r=n(3257),s=n(8511);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!r.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return s.testNumeric(e)?t.NUMERIC:s.testAlphanumeric(e)?t.ALPHANUMERIC:s.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!==typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(r){return n}}},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},7969:(e,t)=>{let n;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return r[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!==typeof e)throw new Error('"toSJISFunc" is not a valid function.');n=e},t.isKanjiModeEnabled=function(){return"undefined"!==typeof n},t.toSJIS=function(e){return n(e)}},8050:(e,t,n)=>{"use strict";n.d(t,{ActionTypes:()=>H,Dv:()=>X,P9:()=>O,Y0:()=>_,nm:()=>Q});var r=n(3986),s=n(9379),i=n(5043),a=n(1337),o=n(159),l=n(3885),c=n(3862),d=n(2814),u=n(8162);const h={customers:"customers",products:"products",orders:"orders",transactions:"transactions",purchaseOrders:"vendor-orders",categories:"categories",refunds:"refunds",planOrders:"plan-orders",plans:"plans"},m=a.STORES.syncMetadata,f=async e=>{try{try{const t=(await(0,a.getAllItems)(m).catch(()=>[])).find(t=>t.collection===e);if(t&&t.lastSync)return new Date(t.lastSync)}catch(t){console.log("syncMetadata store not available, using localStorage fallback:",t.message)}const n=localStorage.getItem("sync_".concat(e));return n?new Date(n):null}catch(n){console.error("Error getting last sync for ".concat(e,":"),n);const t=localStorage.getItem("sync_".concat(e));return t?new Date(t):null}},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;try{const r=t instanceof Date?t.toISOString():t;try{const t=(await(0,a.getAllItems)(m).catch(()=>{throw new Error("Store not available")})).find(t=>t.collection===e);t?await(0,a.updateItem)(m,(0,s.A)((0,s.A)({},t),{},{lastSync:r,updatedAt:(new Date).toISOString()})):await(0,a.addItem)(m,{id:"metadata_".concat(e),collection:e,lastSync:r,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}catch(n){console.log("syncMetadata store not available, using localStorage only:",n.message)}localStorage.setItem("sync_".concat(e),r)}catch(r){console.error("Error setting last sync for ".concat(e,":"),r),localStorage.setItem("sync_".concat(e),t instanceof Date?t.toISOString():t)}},g=async(e,t)=>{try{const n=(0,s.A)((0,s.A)({},t),{},{id:t.id||t._id,isSynced:!0,updatedAt:t.updatedAt||(new Date).toISOString()});return await(0,a.getAllItems)(e).then(e=>e.find(e=>e.id===n.id||e._id===n.id))?await(0,a.updateItem)(e,n):await(0,a.addItem)(e,n),n}catch(n){throw console.error("Error updating IndexedDB for ".concat(e,":"),n),n}},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{const r=h[e];if(!r)throw new Error("No collection mapping for store: ".concat(e));let i="/sync/".concat(r);if(t){const e=t instanceof Date?t.toISOString():t;i+="?since=".concat(encodeURIComponent(e))}const o=await(0,c.AT)(i,{method:"GET"});if(!o.success)throw new Error(o.message||"Sync failed");const{updated:l=[],deleted:d=[]}=o;let u=0;for(const t of l)try{await g(e,t),u++}catch(n){console.error("Error updating item ".concat(t.id," in ").concat(e,":"),n)}let m=0;for(const t of d)try{const n=t.id||t._id;if(n){const r=(await(0,a.getAllItems)(e)).find(e=>e.id===n||e._id===n);r?(await(0,a.updateItem)(e,(0,s.A)((0,s.A)({},r),{},{isDeleted:!0,updatedAt:t.updatedAt||(new Date).toISOString()})),m++):console.log("Item ".concat(n," not found in IndexedDB, skipping deletion"))}}catch(n){console.error("Error deleting item ".concat(t.id," from ").concat(e,":"),n)}return await p(r),{success:!0,collection:r,updated:u,deleted:m,total:u+m}}catch(n){return console.error("Error syncing collection ".concat(e,":"),n),{success:!1,collection:e,error:n.message}}},y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const n=e||Object.keys(h),r={};for(const e of n)try{const t=await f(h[e]),n=await x(e,t);r[e]=n}catch(t){console.error("Error syncing ".concat(e,":"),t),r[e]={success:!1,error:t.message}}return{success:!0,results:r,summary:{total:n.length,successful:Object.values(r).filter(e=>e.success).length,failed:Object.values(r).filter(e=>!e.success).length}}}catch(t){return console.error("Error performing incremental sync:",t),{success:!1,error:t.message}}};var b=n(579);const w=["isSynced"],v=new Map;let N=null,S=new Set,A=null;const _=e=>(S.add(e),()=>S.delete(e)),C=()=>{A&&clearTimeout(A),A=setTimeout(()=>{S.forEach(e=>{try{e()}catch(t){console.error("Error in sync status callback:",t)}}),A=null},50)},I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"===typeof window)return;if(!("serviceWorker"in navigator))return;const{delay:n=0}=t,r=()=>{if(navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage(e)}catch(t){console.error("[PWA] Failed to post message to service worker:",t)}};n>0?setTimeout(r,n):r()},E="plan-bootstrap-complete",T=e=>v.has(e),j=e=>{try{var t;const n=(null===(t=e.currentUser)||void 0===t?void 0:t.sellerId)||e.sellerId||null,r=(e.orders||[]).filter(e=>!n||e.sellerId===n),s=e.products||[],i=new Date,a=new Date(i);a.setDate(a.getDate()-29);const o=e=>"".concat(e.getFullYear(),"-").concat((e.getMonth()+1).toString().padStart(2,"0"),"-").concat(e.getDate().toString().padStart(2,"0")),l=[],c=new Map;for(let e=0;e<30;e++){const t=new Date(a);t.setDate(a.getDate()+e);const n=o(t);l.push(n),c.set(n,{sales:0,profit:0})}let d=0,u=0,h=0,m=0;const f=o(i);for(const e of r){const t=o(new Date(e.createdAt||e.date||i)),n=Number(e.totalAmount||0),r=(e.items||[]).reduce((e,t)=>e+(Number(t.sellingPrice||0)-Number(t.costPrice||0))*Number(t.quantity||0),0);if(d+=n,u+=r,t===f&&(h+=n,m+=r),c.has(t)){const e=c.get(t);e.sales+=n,e.profit+=r}}const p=l.map(e=>{var t;return(null===(t=c.get(e))||void 0===t?void 0:t.sales)||0}),g=l.map(e=>{var t;return(null===(t=c.get(e))||void 0===t?void 0:t.profit)||0});return{salesChartData:{labels:l,datasets:[{label:"Sales",data:p}]},profitChartData:{labels:l,datasets:[{label:"Profit",data:g}]},inventoryChartData:{labels:s.slice(0,10).map(e=>e.name||""),datasets:[{label:"Stock",data:s.slice(0,10).map(e=>Number(e.quantity||e.stock||0))}]},totals:{totalSales:d,totalProfit:u,salesToday:h,profitToday:m}}}catch(n){return console.error("Error recomputing derived data:",n),{}}},k=e=>{const t=Math.round(100*(e.totalAmount||0))/100,n=JSON.stringify((e.items||[]).map(e=>({name:(e.name||"").trim(),quantity:"number"===typeof e.quantity?e.quantity:parseFloat(e.quantity)||0,sellingPrice:Math.round(100*("number"===typeof e.sellingPrice?e.sellingPrice:parseFloat(e.sellingPrice)||0))/100,costPrice:Math.round(100*("number"===typeof e.costPrice?e.costPrice:parseFloat(e.costPrice)||0))/100})).sort((e,t)=>(e.name||"").localeCompare(t.name||"")));return"".concat(e.sellerId||"","_").concat(e.customerId||"null","_").concat(t,"_").concat(n)},D=(e,t)=>t?"".concat(e,"_").concat(t):e,P=(()=>{var e,t,n;const r=localStorage.getItem("auth"),i=localStorage.getItem("settings");let a={isAuthenticated:!1,currentUser:null,userType:null};if(r)try{a=JSON.parse(r),a.currentUser&&!a.userType&&(a.userType=a.currentUser.userType||"seller")}catch(d){console.error("Error parsing saved auth:",d)}let o={currentLanguage:"en",voiceAssistantLanguage:"en-US",voiceAssistantEnabled:!0,expiryDaysThreshold:3,lowStockThreshold:10,subscriptionDays:30,isSubscriptionActive:!0,currentPlan:"basic",gstNumber:"",storeName:"Grocery Store",upiId:""};const l="undefined"!==typeof window&&"true"===sessionStorage.getItem(E);if(i)try{const e=JSON.parse(i);o=(0,s.A)((0,s.A)({},o),e)}catch(d){console.error("Error parsing saved settings:",d)}const c="undefined"!==typeof window?(0,u.zD)(window.location.pathname):"dashboard";return{isAuthenticated:a.isAuthenticated,currentUser:a.currentUser||null,staffPermissionsLoading:!1,permissionsInitiallyLoaded:!1,currentLanguage:o.currentLanguage,voiceAssistantLanguage:o.voiceAssistantLanguage,voiceAssistantEnabled:o.voiceAssistantEnabled,customers:[],products:[],purchaseOrders:[],orders:[],transactions:[],activities:[],categories:[],currentView:c,isListening:!1,isLoading:!1,refreshTrigger:0,customerCurrentPage:1,productCurrentPage:1,itemsPerPage:50,currentBillItems:[],currentPOItems:[],billingDraft:null,currentProduct:null,expiryDaysThreshold:o.expiryDaysThreshold,lowStockThreshold:o.lowStockThreshold,subscriptionDays:o.subscriptionDays,isSubscriptionActive:o.isSubscriptionActive,currentPlan:o.currentPlan,currentPlanDetails:null,gstNumber:o.gstNumber,storeName:(null===(e=a.currentUser)||void 0===e?void 0:e.shopName)||o.storeName,upiId:(null===(t=a.currentUser)||void 0===t?void 0:t.upiId)||o.upiId||"",isScannerActive:!1,scannerType:"html5-qrcode",salesChartData:null,profitChartData:null,inventoryChartData:null,dashboardTotals:{totalSales:0,totalProfit:0,salesToday:0,profitToday:0},customerChartData:null,currentTime:(new Date).toLocaleTimeString(),systemStatus:"online",allowedModules:(null===(n=a.currentUser)||void 0===n?void 0:n.allowedModules)||null,planBootstrap:{isActive:!1,hasCompleted:l,startedAt:null,completedAt:l?Date.now():null}}})(),R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return e;const n=(0,s.A)({},e),r=!!n.planUsageSummary,i=(e,t)=>{if(!t||0===t)return;if(!(e in n))return;const r=n[e],s="number"===typeof r?r:"string"===typeof r?parseInt(r,10):null;if(null===s||Number.isNaN(s))return;const i=Math.max(0,s+t);n[e]="string"===typeof r?String(i):i},a=(e,t,r)=>{if(!r||0===r)return;if(!n.planUsageSummary||!n.planUsageSummary[e])return void i("total".concat(t),r);const a=(0,s.A)({},n.planUsageSummary),o=(0,s.A)({},a[e]),l="number"===typeof o.used?o.used:0,c=Math.max(0,l+r);if(o.used=c,o.isUnlimited)o.remaining=null,n["max".concat(t)]=1/0,n["remaining".concat(t)]=1/0;else{const e="number"===typeof o.limit?o.limit:null;if(null!==e){const r=Math.max(0,e-c);o.remaining=r,n["max".concat(t)]=e,n["remaining".concat(t)]=r}else"number"===typeof o.remaining&&(o.remaining=Math.max(0,o.remaining-r),n["remaining".concat(t)]=o.remaining)}n["total".concat(t)]=c,a[e]=o,n.planUsageSummary=a};return r?(a("customers","Customers",t.customers||0),a("products","Products",t.products||0),a("orders","Orders",t.orders||0)):(i("totalCustomers",t.customers||0),i("totalProducts",t.products||0),i("totalOrders",t.orders||0)),n},O=(e,t)=>{const n=t&&t.summary;if(!e&&!n)return e||null;const r=(0,s.A)({},e?(0,s.A)({},e):{});if(n){const e=(0,s.A)({},t.summary),n=Array.isArray(t.plans)?t.plans.map(e=>(0,s.A)({},e)):[],i=(t,n)=>{const i=e[t];if(!i)return;const a=!!i.isUnlimited,o="number"===typeof i.used?i.used:0,l="number"===typeof i.limit?i.limit:null;let c;c=a?1/0:"number"===typeof i.remaining?Math.max(0,i.remaining):null!==l?Math.max(0,l-o):"number"===typeof r["max".concat(n)]?Math.max(0,r["max".concat(n)]-o):Math.max(0,-o),r["total".concat(n)]=o,a?(r["max".concat(n)]=1/0,r["remaining".concat(n)]=1/0):(null!==l?r["max".concat(n)]=l:void 0===r["max".concat(n)]&&(r["max".concat(n)]=o+("number"===typeof c?c:0)),c===1/0?r["remaining".concat(n)]=1/0:"number"===typeof c&&(r["remaining".concat(n)]=c)),e[t]=(0,s.A)((0,s.A)({},i),{},{used:o,remaining:a?null:"number"===typeof c?c:null})};i("customers","Customers"),i("products","Products"),i("orders","Orders"),r.planUsageSummary=e,r.planUsagePlans=n}return r},L=new Set(["completed","paid","success","successful","captured","active"]),M=e=>{if(void 0===e||null===e)return null;if("object"===typeof e){if(void 0!==e.planId)return M(e.planId);if(void 0!==e.id)return M(e.id);if(void 0!==e.slug)return M(e.slug);if(void 0!==e.code)return M(e.code);if(void 0!==e.name)return M(e.name)}const t=String(e).trim();return t?t.toLowerCase():null},F=e=>{if(void 0===e||null===e||""===e)return null;if(e instanceof Date){const t=e.getTime();return Number.isNaN(t)?null:t}if("number"===typeof e)return Number.isFinite(e)?e>1e12?e:Math.round(1e3*e):null;const t=String(e).trim();if(!t)return null;const n=Number(t);if(!Number.isNaN(n)){if(n>1e12)return n;if(n>1e9)return Math.round(1e3*n)}const r=new Date(t).getTime();return Number.isNaN(r)?null:r},B=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const r of t)if(void 0!==r&&null!==r&&""!==r)return r;return null},U=e=>{var t,n,r,s,i,a,o,l,c,d,u;if(!e||"object"!==typeof e)return null;const h=B(e.planId,e.plan_id,null===(t=e.plan)||void 0===t?void 0:t.planId,null===(n=e.plan)||void 0===n?void 0:n.plan_id,null===(r=e.plan)||void 0===r?void 0:r.id,null===(s=e.plan)||void 0===s?void 0:s.slug,null===(i=e.plan)||void 0===i?void 0:i.code,e.planIdentifier,e.planSlug,e.planCode,e.plan_key,e.planKey),m=null!==h?String(h):null,f=M(h),p=B(e.planOrderId,e.plan_order_id,e.id,e._id,e.orderId,e.subscriptionId,e.referenceId);if(!m&&!p)return null;const g=M(null!==(a=null!==(o=null!==(l=e.paymentStatus)&&void 0!==l?l:e.payment_status)&&void 0!==o?o:e.paymentState)&&void 0!==a?a:e.payment_state),x=M(null!==(c=null!==(d=e.status)&&void 0!==d?d:e.state)&&void 0!==c?c:e.subscriptionStatus),y=F(B(e.expiresAt,e.expiryDate,e.expiry,e.endDate,e.validTill,e.validUntil,e.planExpiryDate,e.planExpiry)),b=F(B(e.startsAt,e.startDate,e.start_time,e.activatedAt,e.createdAt,e.planStartDate,e.planStart)),w=[p?String(p):null,f,null!==y?String(y):null,null!==b?String(b):null].filter(Boolean);return{key:w.length>0?w.join("|"):f?"".concat(f,"|").concat(null!==y&&void 0!==y?y:"no-expiry"):null,planId:m,planKey:f,planOrderId:p?String(p):null,paymentStatus:g,status:x,expiresAt:y,startsAt:b,planName:B(e.planName,null===(u=e.plan)||void 0===u?void 0:u.name,e.name,e.title),isCurrent:Boolean(e.isCurrent||e.current||e.isActive||e.active),isExpiredFlag:e.isExpired,raw:e}},z=e=>{if(!e)return!1;const t=e.toLowerCase();return L.has(t)},q=(e,t)=>{if(!e)return!1;if(!0===e.isExpired)return!0;const n=(e=>{var t,n,r;if(!e)return null;const s=B(e.expiresAt,e.expiryDate,e.expiry,e.endDate,e.validTill,e.validUntil,e.planExpiry,e.planExpiryDate,null===(t=e.plan)||void 0===t?void 0:t.expiresAt,null===(n=e.plan)||void 0===n?void 0:n.expiryDate,null===(r=e.currentPlan)||void 0===r?void 0:r.expiresAt);return F(s)})(e);return null!==n&&n<=t},H={LOGIN:"LOGIN",LOGOUT:"LOGOUT",REFRESH_STAFF_PERMISSIONS:"REFRESH_STAFF_PERMISSIONS",SET_STAFF_PERMISSIONS_LOADING:"SET_STAFF_PERMISSIONS_LOADING",SET_LANGUAGE:"SET_LANGUAGE",SET_VOICE_LANGUAGE:"SET_VOICE_LANGUAGE",SET_CURRENT_PLAN:"SET_CURRENT_PLAN",SET_CURRENT_PLAN_DETAILS:"SET_CURRENT_PLAN_DETAILS",SET_UPI_ID:"SET_UPI_ID",SET_CUSTOMERS:"SET_CUSTOMERS",ADD_CUSTOMER:"ADD_CUSTOMER",UPDATE_CUSTOMER:"UPDATE_CUSTOMER",DELETE_CUSTOMER:"DELETE_CUSTOMER",SET_PRODUCTS:"SET_PRODUCTS",ADD_PRODUCT:"ADD_PRODUCT",UPDATE_PRODUCT:"UPDATE_PRODUCT",DELETE_PRODUCT:"DELETE_PRODUCT",SET_CURRENT_PRODUCT:"SET_CURRENT_PRODUCT",SET_PURCHASE_ORDERS:"SET_PURCHASE_ORDERS",ADD_PURCHASE_ORDER:"ADD_PURCHASE_ORDER",UPDATE_PURCHASE_ORDER:"UPDATE_PURCHASE_ORDER",DELETE_PURCHASE_ORDER:"DELETE_PURCHASE_ORDER",SET_ORDERS:"SET_ORDERS",ADD_ORDER:"ADD_ORDER",UPDATE_ORDER:"UPDATE_ORDER",DELETE_ORDER:"DELETE_ORDER",SET_TRANSACTIONS:"SET_TRANSACTIONS",ADD_TRANSACTION:"ADD_TRANSACTION",UPDATE_TRANSACTION:"UPDATE_TRANSACTION",SET_ACTIVITIES:"SET_ACTIVITIES",ADD_ACTIVITY:"ADD_ACTIVITY",SET_CATEGORIES:"SET_CATEGORIES",ADD_CATEGORY:"ADD_CATEGORY",UPDATE_CATEGORY:"UPDATE_CATEGORY",DELETE_CATEGORY:"DELETE_CATEGORY",SET_CURRENT_VIEW:"SET_CURRENT_VIEW",SET_LISTENING:"SET_LISTENING",SET_LOADING:"SET_LOADING",FORCE_REFRESH:"FORCE_REFRESH",SET_CUSTOMER_PAGE:"SET_CUSTOMER_PAGE",SET_PRODUCT_PAGE:"SET_PRODUCT_PAGE",SET_BILL_ITEMS:"SET_BILL_ITEMS",ADD_BILL_ITEM:"ADD_BILL_ITEM",REMOVE_BILL_ITEM:"REMOVE_BILL_ITEM",CLEAR_BILL_ITEMS:"CLEAR_BILL_ITEMS",SET_BILLING_DRAFT:"SET_BILLING_DRAFT",SET_PO_ITEMS:"SET_PO_ITEMS",ADD_PO_ITEM:"ADD_PO_ITEM",REMOVE_PO_ITEM:"REMOVE_PO_ITEM",CLEAR_PO_ITEMS:"CLEAR_PO_ITEMS",SET_LOW_STOCK_THRESHOLD:"SET_LOW_STOCK_THRESHOLD",SET_EXPIRY_DAYS_THRESHOLD:"SET_EXPIRY_DAYS_THRESHOLD",SET_SUBSCRIPTION_DAYS:"SET_SUBSCRIPTION_DAYS",SET_SUBSCRIPTION_ACTIVE:"SET_SUBSCRIPTION_ACTIVE",PLAN_BOOTSTRAP_START:"PLAN_BOOTSTRAP_START",PLAN_BOOTSTRAP_COMPLETE:"PLAN_BOOTSTRAP_COMPLETE",PLAN_BOOTSTRAP_RESET:"PLAN_BOOTSTRAP_RESET",SET_GST_NUMBER:"SET_GST_NUMBER",SET_STORE_NAME:"SET_STORE_NAME",UPDATE_USER:"UPDATE_USER",SET_VOICE_ASSISTANT_LANGUAGE:"SET_VOICE_ASSISTANT_LANGUAGE",SET_VOICE_ASSISTANT_ENABLED:"SET_VOICE_ASSISTANT_ENABLED",SET_SCANNER_ACTIVE:"SET_SCANNER_ACTIVE",SET_SCANNER_TYPE:"SET_SCANNER_TYPE",SET_SALES_CHART_DATA:"SET_SALES_CHART_DATA",SET_PROFIT_CHART_DATA:"SET_PROFIT_CHART_DATA",SET_INVENTORY_CHART_DATA:"SET_INVENTORY_CHART_DATA",SET_CUSTOMER_CHART_DATA:"SET_CUSTOMER_CHART_DATA",UPDATE_CURRENT_TIME:"UPDATE_CURRENT_TIME",SET_SYSTEM_STATUS:"SET_SYSTEM_STATUS"},V=e=>({customers:{getAllItems:()=>(0,a.getAllItems)(a.STORES.customers),updateItem:e=>(0,a.updateItem)(a.STORES.customers,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.customers,e)},products:{getAllItems:()=>(0,a.getAllItems)(a.STORES.products),updateItem:e=>(0,a.updateItem)(a.STORES.products,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.products,e)},orders:{getAllItems:()=>(0,a.getAllItems)(a.STORES.orders),updateItem:e=>(0,a.updateItem)(a.STORES.orders,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.orders,e)},transactions:{getAllItems:()=>(0,a.getAllItems)(a.STORES.transactions),updateItem:e=>(0,a.updateItem)(a.STORES.transactions,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.transactions,e)},purchaseOrders:{getAllItems:()=>(0,a.getAllItems)(a.STORES.purchaseOrders),updateItem:e=>(0,a.updateItem)(a.STORES.purchaseOrders,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.purchaseOrders,e)},categories:{getAllItems:()=>(0,a.getAllItems)(a.STORES.categories),updateItem:e=>(0,a.updateItem)(a.STORES.categories,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.categories,e)},refunds:{getAllItems:()=>(0,a.getAllItems)(a.STORES.refunds),updateItem:e=>(0,a.updateItem)(a.STORES.refunds,e),deleteItem:e=>(0,a.deleteItem)(a.STORES.refunds,e)}}[e]),W=(e,t)=>{const n=(0,d.ay)(e.currentPlan,e.currentPlanDetails),r=(e=>{var t;return null!==(t=e.currentPlanDetails)&&void 0!==t&&t.planName?e.currentPlanDetails.planName:e.currentPlan?"".concat(e.currentPlan.charAt(0).toUpperCase()).concat(e.currentPlan.slice(1)):"Current"})(e),s={customer:{current:e.customers.filter(e=>!e.isDeleted).length,limit:n.maxCustomers,canAdd:t=>(0,d.sp)(t,e.currentPlan,e.currentPlanDetails),label:"customer",plural:"customers"},product:{current:e.products.filter(e=>!e.isDeleted).length,limit:n.maxProducts,canAdd:t=>(0,d.Nx)(t,e.currentPlan,e.currentPlanDetails),label:"product",plural:"products"},order:{current:e.orders.filter(e=>!e.isDeleted).length,limit:n.maxOrders,canAdd:t=>(0,d.cR)(t,e.currentPlan,e.currentPlanDetails),label:"order",plural:"orders"}}[t];if(!s)return{allowed:!0};if(s.canAdd(s.current))return{allowed:!0};const i=(a=s.limit)===1/0?"Unlimited":a;var a;return{allowed:!1,message:"You've reached the ".concat(s.label," limit (").concat(i,") for the ").concat(r," plan. Upgrade your plan to add more ").concat(s.plural,".")}},G=(e,t)=>{var n,i,l;switch("ADD_ORDER"===t.type&&console.log("\ud83c\udfaf REDUCER: ADD_ORDER action received!",t),t.type){case H.LOGIN:{var d,u,h,m,f,p,g,x,y,b,S,A,_,T;console.log("\ud83d\udd10 LOGIN ACTION RECEIVED:",{userType:null===(d=t.payload)||void 0===d?void 0:d.userType,userEmail:null===(u=t.payload)||void 0===u?void 0:u.email,permissions:null===(h=t.payload)||void 0===h?void 0:h.permissions,hasSellerId:!(null===(m=t.payload)||void 0===m||!m.sellerId)});const n=(null===(f=t.payload)||void 0===f?void 0:f.sellerId)||null,r="staff"===(null===(p=t.payload)||void 0===p?void 0:p.userType),i={isAuthenticated:!0,currentUser:t.payload,userType:(null===(g=t.payload)||void 0===g?void 0:g.userType)||"seller",sellerId:n};localStorage.setItem("auth",JSON.stringify(i)),r&&console.log("\ud83d\udc64 Staff user logged in, ensuring fresh permissions..."),I({type:"AUTHENTICATED",user:t.payload}),I({type:"CACHE_APP_RESOURCES"},{delay:500}),setTimeout(()=>{o.Ay.isOnline()&&(o.Ay.startAutoSync(V,3e4),o.Ay.syncAll(V).catch(e=>console.error("Initial sync error:",e)))},2e3);let a=e.planBootstrap||{isActive:!1,hasCompleted:!1,startedAt:null,completedAt:null};n&&!r?("undefined"!==typeof window&&sessionStorage.removeItem(E),a={isActive:!0,hasCompleted:!1,startedAt:Date.now(),completedAt:null}):("undefined"!==typeof window&&sessionStorage.setItem(E,"true"),a={isActive:!1,hasCompleted:!0,startedAt:null,completedAt:Date.now()});const l=null!==(x=t.payload)&&void 0!==x&&x.shopName&&t.payload.shopName.trim()?t.payload.shopName.trim():null!==(y=t.payload)&&void 0!==y&&null!==(b=y.owner)&&void 0!==b&&b.shopName&&t.payload.owner.shopName.trim()?t.payload.owner.shopName.trim():e.storeName;return(0,s.A)((0,s.A)({},e),{},{isAuthenticated:!0,currentUser:t.payload,userType:(null===(S=t.payload)||void 0===S?void 0:S.userType)||"seller",upiId:(null===(A=t.payload)||void 0===A?void 0:A.upiId)||(null===(_=t.payload)||void 0===_||null===(T=_.owner)||void 0===T?void 0:T.upiId)||"",storeName:l||e.storeName,planBootstrap:a,allowedModules:null})}case H.REFRESH_STAFF_PERMISSIONS:{var D;const n=(0,s.A)((0,s.A)({},e.currentUser),{},{permissions:t.payload.permissions||{}}),r=localStorage.getItem("auth");if(r){const e=JSON.parse(r);e.currentUser=n,localStorage.setItem("auth",JSON.stringify(e))}const i="staff"===e.userType||"staff"===(null===(D=e.currentUser)||void 0===D?void 0:D.userType);let a=e.currentView;return i&&t.payload.defaultView&&(e.permissionsInitiallyLoaded||(a=t.payload.defaultView)),(0,s.A)((0,s.A)({},e),{},{currentUser:n,currentView:a,permissionsInitiallyLoaded:!0})}case H.SET_STAFF_PERMISSIONS_LOADING:return(0,s.A)((0,s.A)({},e),{},{staffPermissionsLoading:t.payload.loading});case H.LOGOUT:localStorage.removeItem("auth"),o.Ay.stopAutoSync(),I({type:"LOGGED_OUT"}),"undefined"!==typeof window&&sessionStorage.removeItem(E);const te=null===(n=e.currentUser)||void 0===n?void 0:n.userType,ne=(null===(i=e.currentUser)||void 0===i?void 0:i.email)||(null===(l=e.currentUser)||void 0===l?void 0:l.uid);if(console.log("\ud83d\uddd1\ufe0f Processing logout for ".concat(te," (").concat(ne,")")),"seller"===te){console.log("\ud83d\uddd1\ufe0f Clearing all IndexedDB data for seller logout...");[a.STORES.customers,a.STORES.products,a.STORES.orders,a.STORES.transactions,a.STORES.purchaseOrders,a.STORES.categories,a.STORES.refunds,a.STORES.planDetails,a.STORES.settings,a.STORES.activities,a.STORES.syncMetadata].forEach(e=>{(0,a.clearAllItems)(e).catch(t=>{console.warn("\u26a0\ufe0f Error clearing IndexedDB store ".concat(e,":"),t.message)})}),console.log("\u2705 IndexedDB clearing initiated for seller logout")}else"staff"===te?(console.log("\ud83d\udc64 Staff logout - keeping seller data, clearing staff-specific data only"),(0,a.clearAllItems)(a.STORES.staffPermissions).catch(e=>{console.warn("\u26a0\ufe0f Error clearing staff permissions:",e.message)}),console.log("\u2705 Staff permissions cleared")):(console.log("\u2753 Unknown user type during logout - clearing minimal data"),(0,a.clearAllItems)(a.STORES.activities).catch(e=>{console.warn("\u26a0\ufe0f Error clearing activities:",e.message)}));return(0,s.A)((0,s.A)({},e),{},{isAuthenticated:!1,currentUser:null,customers:[],products:[],transactions:[],purchaseOrders:[],activities:[],categories:[],currentPlan:"basic",currentPlanDetails:null,isSubscriptionActive:!0,lowStockThreshold:10,expiryDaysThreshold:3,subscriptionDays:30,upiId:"",planBootstrap:{isActive:!1,hasCompleted:!1,startedAt:null,completedAt:null}});case H.SET_LANGUAGE:return(0,s.A)((0,s.A)({},e),{},{currentLanguage:t.payload});case H.SET_CURRENT_PLAN:return(0,s.A)((0,s.A)({},e),{},{currentPlan:t.payload});case H.SET_CURRENT_PLAN_DETAILS:return(0,s.A)((0,s.A)({},e),{},{currentPlanDetails:t.payload});case H.SET_VOICE_LANGUAGE:return(0,s.A)((0,s.A)({},e),{},{voiceAssistantLanguage:t.payload});case H.SET_CUSTOMERS:const re=(t.payload||[]).map(e=>{const t=void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0;return(0,s.A)((0,s.A)({},e),{},{dueAmount:"number"===typeof t?t:parseFloat(t)||0,balanceDue:"number"===typeof t?t:parseFloat(t)||0})});return e.customers.length===re.length&&e.customers.every((e,t)=>{const n=re[t];return n&&e.id===n.id&&JSON.stringify(e)===JSON.stringify(n)})?e:(0,s.A)((0,s.A)({},e),{},{customers:re});case H.ADD_CUSTOMER:{var P,O,L,M;const n=!0===(null===(P=t.payload)||void 0===P?void 0:P.isSynced)||(null===(O=t.payload)||void 0===O?void 0:O.syncedAt);if(!n){const t=W(e,"customer");if(!t.allowed)return window.showToast&&window.showToast(t.message,"warning",5e3),e}const r=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:null!==(L=null===(M=t.payload)||void 0===M?void 0:M.isSynced)&&void 0!==L&&L});(0,a.addItem)(a.STORES.customers,r).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("MongoDB sync error:",e)),C()}).catch(e=>console.error("IndexedDB save error:",e));const i=n?e.currentPlanDetails:R(e.currentPlanDetails,{customers:1});return(0,s.A)((0,s.A)({},e),{},{customers:[r,...e.customers],currentPlanDetails:i})}case H.UPDATE_CUSTOMER:const se=void 0!==t.payload.syncedAt;se&&setTimeout(()=>C(),0);const ie=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!!se,isUpdate:!se||void 0,updatedAt:se?t.payload.updatedAt:(new Date).toISOString()});(0,a.updateItem)(a.STORES.customers,ie).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Customer updated. We'll retry syncing shortly.","info")})}).catch(e=>{console.error("IndexedDB save error:",e.message),window.showToast&&window.showToast("Couldn't update customer. Please try again.","error")});const ae=e.customers.find(e=>e.id===t.payload.id);return ae&&JSON.stringify(ae)===JSON.stringify(ie)?e:(setTimeout(()=>C(),0),(0,s.A)((0,s.A)({},e),{},{customers:e.customers.map(e=>e.id===t.payload.id?ie:e)}));case H.DELETE_CUSTOMER:const oe=e.customers.find(e=>e.id===t.payload);if(oe){const n=(0,s.A)((0,s.A)({},oe),{},{isDeleted:!0,deletedAt:(new Date).toISOString(),isSynced:!1});return(0,a.updateItem)(a.STORES.customers,n,!0).then(()=>{console.log("\u2705 Customer marked as deleted in IndexedDB:",t.payload),o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("Delete sync error:",e)),window.showToast&&window.showToast("Customer deleted.","success")}).catch(e=>{console.error("\u274c IndexedDB update error:",e),window.showToast&&window.showToast("Couldn't delete customer. Please try again.","error")}),(0,s.A)((0,s.A)({},e),{},{customers:e.customers.filter(e=>e.id!==t.payload),currentPlanDetails:R(e.currentPlanDetails,{customers:-1})})}return e;case H.SET_PRODUCTS:if(e.products.length===t.payload.length&&e.products.every((e,n)=>{const r=t.payload[n];return r&&e.id===r.id&&JSON.stringify(e)===JSON.stringify(r)}))return e;{const n=t.payload,r=j((0,s.A)((0,s.A)({},e),{},{products:n}));return(0,s.A)((0,s.A)({},e),{},{products:n,inventoryChartData:r.inventoryChartData||e.inventoryChartData,salesChartData:r.salesChartData||e.salesChartData,profitChartData:r.profitChartData||e.profitChartData,dashboardTotals:r.totals||e.dashboardTotals})}case H.ADD_PRODUCT:{var F,B,U,z;const n=(t.payload.name||"").trim().toLowerCase(),r=(t.payload.description||"").trim().toLowerCase(),i=e.products.find(e=>{const t=(e.name||"").trim().toLowerCase(),s=(e.description||"").trim().toLowerCase();return t===n&&(s===r||""===s&&""===r||null===s&&null===r||void 0===s&&void 0===r)});if(i)return console.warn("\u26a0\ufe0f Duplicate product detected:",{name:t.payload.name,description:t.payload.description||"No description",existingId:i.id}),window.showToast&&window.showToast('"'.concat(t.payload.name,'" already exists. Edit the product to make changes.'),"warning"),e;const l=!0===(null===(F=t.payload)||void 0===F?void 0:F.isSynced)||(null===(B=t.payload)||void 0===B?void 0:B.syncedAt);if(!l){const t=W(e,"product");if(!t.allowed)return window.showToast&&window.showToast(t.message,"warning",5e3),e}const c=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:null!==(U=null===(z=t.payload)||void 0===z?void 0:z.isSynced)&&void 0!==U&&U});(0,a.addItem)(a.STORES.products,c).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("MongoDB sync error:",e)),C()}).catch(e=>{console.error("IndexedDB save error:",e),window.showToast&&window.showToast("Couldn't save product. Please try again.","error")});{const t=[c,...e.products],n=j((0,s.A)((0,s.A)({},e),{},{products:t}));return(0,s.A)((0,s.A)({},e),{},{products:t,currentPlanDetails:l?e.currentPlanDetails:R(e.currentPlanDetails,{products:1}),inventoryChartData:n.inventoryChartData||e.inventoryChartData,salesChartData:n.salesChartData||e.salesChartData,profitChartData:n.profitChartData||e.profitChartData,dashboardTotals:n.totals||e.dashboardTotals})}}case H.UPDATE_PRODUCT:const le=void 0!==t.payload.syncedAt;if(le&&C(),!t.payload.id)return console.error("\u274c [UPDATE_PRODUCT] Product ID is missing!",t.payload),window.showToast&&window.showToast("Error: Product ID is missing. Cannot update product.","error"),e;const ce=e.products.find(e=>e.id===t.payload.id||String(e.id)===String(t.payload.id)||t.payload._id&&e._id&&String(e._id)===String(t.payload._id));if(!ce)return console.error("\u274c [UPDATE_PRODUCT] Product not found in state! Cannot update:",{searchedId:t.payload.id,searchedMongoId:t.payload._id,totalProducts:e.products.length}),e;const de=ce._id||ce.id,ue=(0,s.A)((0,s.A)((0,s.A)({},ce),t.payload),{},{id:de,_id:ce._id||t.payload._id,isSynced:!!le,isUpdate:!le||void 0,updatedAt:le?t.payload.updatedAt:(new Date).toISOString()});return console.log("\ud83d\udd04 [UPDATE_PRODUCT] Updating product:",{id:ue.id,idType:typeof ue.id,originalId:ce.id,originalIdType:typeof ce.id,name:ue.name,quantity:ue.quantity,costPrice:ue.costPrice}),(0,a.getAllItems)(a.STORES.products).then(e=>{const t=e.find(e=>e.id===de||e._id===de||ce._id&&e._id&&String(e._id)===String(ce._id)||ce.id&&e.id===ce.id);if(!t)throw console.error("\u274c [UPDATE_PRODUCT] Product NOT found in IndexedDB!",{searchedId:de,searchedIdType:typeof de,searchedMongoId:ce._id,totalProductsInDB:e.length,sampleIds:e.slice(0,3).map(e=>({id:e.id,idType:typeof e.id,_id:e._id,name:e.name}))}),new Error('Product with id "'.concat(de,'" not found in IndexedDB. Cannot update.'));const n=t.id;return ue.id=n,console.log("\u2705 [UPDATE_PRODUCT] Found product in IndexedDB, using exact id:",{idFromDB:n,idType:typeof n,name:t.name}),console.log("\u2705 [UPDATE_PRODUCT] Found product in IndexedDB:",{id:t.id,idType:typeof t.id,name:t.name,matches:t.id===de}),(0,a.updateItem)(a.STORES.products,ue)}).then(()=>(console.log("\u2705 [UPDATE_PRODUCT] Product saved to IndexedDB successfully:",ue.id),(0,a.getAllItems)(a.STORES.products))).then(e=>{const t=e.find(e=>e.id===ue.id||e._id===ue._id||ce._id&&e._id&&String(e._id)===String(ce._id)||ce.id&&e.id===ce.id);t?(console.log("\u2705 [UPDATE_PRODUCT] Verified product in IndexedDB after save:",{id:t.id,name:t.name,quantity:t.quantity,costPrice:t.costPrice,sellingPrice:t.sellingPrice,isSynced:t.isSynced}),t.name===ue.name&&t.quantity===ue.quantity?console.log("\u2705 [UPDATE_PRODUCT] Product data verified - update successful!"):console.error("\u274c [UPDATE_PRODUCT] Product data mismatch!",{expected:{name:ue.name,quantity:ue.quantity},actual:{name:t.name,quantity:t.quantity}})):console.error("\u274c [UPDATE_PRODUCT] Product NOT found in IndexedDB after save!",{searchedId:de,totalProducts:e.length}),o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Product updated. We'll retry syncing shortly.","info")})}).catch(e=>{console.error("\u274c [UPDATE_PRODUCT] IndexedDB save error:",e.message),console.error("Product data:",JSON.stringify(ue,null,2)),window.showToast&&window.showToast("Couldn't update product: ".concat(e.message),"error")}),(0,s.A)((0,s.A)({},e),{},{products:e.products.map(e=>e.id===de||e._id===de||ce._id&&e._id&&String(e._id)===String(ce._id)||ce.id&&e.id===ce.id?ue:e)});case H.SET_CURRENT_PRODUCT:return(0,s.A)((0,s.A)({},e),{},{currentProduct:t.payload});case H.DELETE_PRODUCT:const he=e.products.find(e=>e.id===t.payload);if(he){const n=(0,s.A)((0,s.A)({},he),{},{isDeleted:!0,deletedAt:(new Date).toISOString(),isSynced:!1});(0,a.updateItem)(a.STORES.products,n,!0).then(()=>{console.log("\u2705 Product marked as deleted in IndexedDB:",t.payload),o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("Delete sync error:",e)),window.showToast&&window.showToast("Product deleted.","success")}).catch(e=>{console.error("\u274c IndexedDB update error:",e),window.showToast&&window.showToast("Couldn't delete product. Please try again.","error")});const r=e.products.filter(e=>e.id!==t.payload),i=j((0,s.A)((0,s.A)({},e),{},{products:r}));return(0,s.A)((0,s.A)({},e),{},{products:r,currentPlanDetails:R(e.currentPlanDetails,{products:-1}),inventoryChartData:i.inventoryChartData||e.inventoryChartData,salesChartData:i.salesChartData||e.salesChartData,profitChartData:i.profitChartData||e.profitChartData,dashboardTotals:i.totals||e.dashboardTotals})}return e;case H.SET_PURCHASE_ORDERS:return e.purchaseOrders.length===t.payload.length&&e.purchaseOrders.every((e,n)=>{const r=t.payload[n];return r&&e.id===r.id&&JSON.stringify(e)===JSON.stringify(r)})?e:(0,s.A)((0,s.A)({},e),{},{purchaseOrders:t.payload});case H.SET_ORDERS:console.log("\ud83d\udd27 [SET_ORDERS] Loading orders, marking all as stockDeducted: true");const me=t.payload.map(e=>{const t=!1!==e.stockDeducted;return console.log("\ud83d\udd27 [SET_ORDERS] Order ".concat(e.id,": stockDeducted=").concat(e.stockDeducted," -> ").concat(t)),(0,s.A)((0,s.A)({},e),{},{stockDeducted:t})}),fe=new Set(me.map(e=>e.id||e._id).filter(Boolean)),pe=e.orders.filter(e=>{const t=e.id||e._id;return t&&!fe.has(t)&&(!1===e.isSynced||void 0===e.isSynced)}),ge=[...me,...pe];if(ge.sort((e,t)=>{const n=new Date(e.createdAt||0).getTime();return new Date(t.createdAt||0).getTime()-n}),pe.length>0&&console.log("\ud83d\udd27 [SET_ORDERS] Preserving ".concat(pe.length," unsynced orders from state")),e.orders.length===ge.length&&e.orders.every((e,t)=>{const n=ge[t];return n&&e.id===n.id&&JSON.stringify(e)===JSON.stringify(n)}))return e;{const t=j((0,s.A)((0,s.A)({},e),{},{orders:ge}));return(0,s.A)((0,s.A)({},e),{},{orders:ge,salesChartData:t.salesChartData||e.salesChartData,profitChartData:t.profitChartData||e.profitChartData,inventoryChartData:t.inventoryChartData||e.inventoryChartData,dashboardTotals:t.totals||e.dashboardTotals})}case H.ADD_ORDER:{var q,G,Y,X;console.log("\ud83c\udfaf ADD_ORDER: Order ID:",t.payload.id,"Total:",t.payload.totalAmount);const n=!0===(null===(q=t.payload)||void 0===q?void 0:q.isSynced)||(null===(G=t.payload)||void 0===G?void 0:G.syncedAt);if(!n){const t=W(e,"order");if(!t.allowed)return window.showToast&&window.showToast(t.message,"warning",5e3),console.warn("\ud83d\udeab [ADD_ORDER] BLOCKED - Plan limit reached, preventing IndexedDB write."),e}const r=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:null!==(Y=null===(X=t.payload)||void 0===X?void 0:X.isSynced)&&void 0!==Y&&Y});if(!r.id)return console.error("\u274c Order validation failed: id is missing"),window.showToast&&window.showToast("Order creation failed: Missing order ID","error"),e;if(!r.sellerId)return console.error("\u274c Order validation failed: sellerId is missing"),window.showToast&&window.showToast("Order creation failed: User not authenticated","error"),e;if(!r.items||0===r.items.length)return console.error("\u274c Order validation failed: items array is empty"),window.showToast&&window.showToast("Order creation failed: No items in order","error"),e;if(!r.totalAmount||r.totalAmount<=0)return console.error("\u274c Order validation failed: totalAmount is invalid:",r.totalAmount),window.showToast&&window.showToast("Order creation failed: Invalid total amount","error"),e;const i=(0,s.A)((0,s.A)({},r),{},{stockDeducted:void 0!==r.stockDeducted?r.stockDeducted:!!n,items:r.items.map(e=>(0,s.A)((0,s.A)({},e),{},{costPrice:"number"===typeof e.costPrice?e.costPrice:0,sellingPrice:"number"===typeof e.sellingPrice?e.sellingPrice:0,quantity:"number"===typeof e.quantity?e.quantity:1}))}),l=k(i);console.log("\ud83d\udd11 [ADD_ORDER] Order hash created:",l.substring(0,50)+"..."),console.log("\ud83d\udd11 [ADD_ORDER] Current pending calls:",Array.from(v.keys()).map(e=>e.substring(0,30)+"..."));const d=o.Ay.isOnline();if(d){if(v.has(l)){const t=v.get(l);return console.warn("\ud83d\udeab [ADD_ORDER] BLOCKED - Duplicate order prevented (pending API call exists):",t),console.warn("\ud83d\udeab [ADD_ORDER] Current order ID:",i.id),console.warn("\ud83d\udeab [ADD_ORDER] Order hash:",l.substring(0,50)+"..."),e}v.set(l,i.id),console.log("\u2705 [ADD_ORDER] ALLOWED - Marked order as pending API call:",i.id),console.log("\u2705 [ADD_ORDER] Order hash:",l.substring(0,50)+"...")}const u=e.orders.find(e=>{if(!e||!e.createdAt)return!1;const t=new Date(e.createdAt);if((new Date).getTime()-t.getTime()>5e3)return!1;return k(e)===l});if(u)return console.warn("\ud83d\udeab [ADD_ORDER] BLOCKED - Duplicate order detected in state (created within 5s):",u.id),console.warn("\ud83d\udeab [ADD_ORDER] Current order ID:",i.id),console.warn("\ud83d\udeab [ADD_ORDER] Order hash:",l.substring(0,50)+"..."),d&&v.has(l)&&v.delete(l),e;console.log("\ud83d\udcbe Attempting to save order to IndexedDB...",i.id),console.log("\ud83d\udcbe Order data being saved:",JSON.stringify(i,null,2)),(0,a.updateItem)(a.STORES.orders,i,!0).then(e=>{console.log("\u2705 Order successfully saved to IndexedDB!",i.id,e),setTimeout(async()=>{try{const e=await(0,a.getAllItems)(a.STORES.orders),t=e.find(e=>{var t,n;return e.id===i.id||(null===(t=e.id)||void 0===t?void 0:t.toString())===(null===(n=i.id)||void 0===n?void 0:n.toString())});t?console.log("\u2705 Verified: Order exists in IndexedDB",t.id):(console.error("\u274c WARNING: Order not found in IndexedDB after save!",i.id),console.error("\u274c All orders in IndexedDB:",e.map(e=>({id:e.id,_id:e._id}))))}catch(e){console.error("Error verifying order in IndexedDB:",e)}},100),d&&v.has(k(i))?(console.log("\ud83c\udf10 [ADD_ORDER] Online - scheduling ONE-TIME order creation API call..."),setTimeout(async()=>{const e=k(i);if(v.has(e)){console.log("\ud83c\udf10 [ADD_ORDER] \u23f0 Timeout executed - Creating order on backend via API (ONE ATTEMPT)...",i.id),console.log("\ud83c\udf10 [ADD_ORDER] Order to create:",JSON.stringify(i,null,2)),console.log("\ud83c\udf10 [ADD_ORDER] createOrder function available:",typeof c.fS);try{if(console.log("\ud83c\udf10 [ADD_ORDER] Calling createOrder function (ONE TIME ONLY)..."),"function"!==typeof c.fS)throw console.error("\u274c [ADD_ORDER] createOrder is not a function!",c.fS),new Error("createOrder function not available");const t=await(0,c.fS)(i);if(v.delete(e),console.log("\ud83c\udf10 [ADD_ORDER] Removed order from pending calls:",i.id),console.log("\ud83c\udf10 [ADD_ORDER] createOrder result:",t),t.success){console.log("\u2705 Order created on backend successfully!",t._id);const e=(0,s.A)((0,s.A)({},i),{},{_id:t._id,isSynced:!0,syncedAt:(new Date).toISOString(),stockDeducted:void 0===i.stockDeducted||i.stockDeducted});(0,a.updateItem)(a.STORES.orders,e,!0).then(()=>{console.log("\u2705 Order marked as synced in IndexedDB:",e.id),N&&N({type:H.UPDATE_ORDER,payload:e,meta:{fromSync:!0}})}).catch(e=>{console.error("\u274c Failed to mark order as synced in IndexedDB:",e)})}else console.warn("\u26a0\ufe0f [ADD_ORDER] API call failed (ONE-TIME attempt):",t.error),console.warn("\u26a0\ufe0f [ADD_ORDER] Order saved to IndexedDB with isSynced: false. Will be synced by background sync service."),window.showToast&&window.showToast("Order saved. We'll sync it shortly.","info")}catch(t){console.error("\u274c [ADD_ORDER] Error creating order on backend (ONE-TIME attempt failed):",t),console.error("\u274c [ADD_ORDER] Order saved to IndexedDB with isSynced: false. Will be synced by background sync service."),v.delete(e),console.log("\ud83c\udf10 [ADD_ORDER] Removed order from pending calls after error:",i.id),window.showToast&&window.showToast("Order saved. We'll sync it shortly.","info")}}else console.warn("\u26a0\ufe0f [ADD_ORDER] Order was removed from pending calls, skipping API call:",i.id)},200)):d||(console.log("\ud83d\udcf4 Offline - Order saved to IndexedDB, will sync when online"),window.showToast&&window.showToast("Order saved offline. We'll sync once you're online.","success"))}).catch(e=>{var t;(console.error("\u274c IndexedDB save error:",e),console.error("Error message:",e.message),console.error("Error stack:",e.stack),console.error("Error name:",e.name),console.error("Order data that failed:",JSON.stringify(i,null,2)),e.message&&e.message.includes("Validation failed"))&&(console.error("\u274c VALIDATION ERROR - Order validation failed!"),console.error("Order details:",{id:r.id,sellerId:r.sellerId,itemsCount:null===(t=r.items)||void 0===t?void 0:t.length,totalAmount:r.totalAmount,paymentMethod:r.paymentMethod}));window.showToast&&window.showToast("Failed to save order: ".concat(e.message),"error")});{const t=[i,...e.orders],r=j((0,s.A)((0,s.A)({},e),{},{orders:t}));return(0,s.A)((0,s.A)({},e),{},{orders:t,salesChartData:r.salesChartData||e.salesChartData,profitChartData:r.profitChartData||e.profitChartData,inventoryChartData:r.inventoryChartData||e.inventoryChartData,currentPlanDetails:n?e.currentPlanDetails:R(e.currentPlanDetails,{orders:1}),dashboardTotals:r.totals||e.dashboardTotals})}}case H.UPDATE_ORDER:const xe=void 0!==t.payload.syncedAt;xe&&C();const ye=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!!xe,isUpdate:!xe||void 0,updatedAt:xe?t.payload.updatedAt:(new Date).toISOString(),stockDeducted:void 0!==t.payload.stockDeducted?t.payload.stockDeducted:!!xe||t.payload.stockDeducted});(0,a.updateItem)(a.STORES.orders,ye).then(()=>{!ye.isSynced&&o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Order updated. We'll retry syncing shortly.","info")})}).catch(e=>{console.error("IndexedDB update error:",e.message)});const be=e.orders.find(e=>e.id===t.payload.id||e._id===t.payload.id||e.id===t.payload._id||e._id===t.payload._id);if(!be){console.log("\ud83d\udd04 [UPDATE_ORDER] Order not found in state, adding it:",t.payload.id||t.payload._id);const n=[ye,...e.orders],r=j((0,s.A)((0,s.A)({},e),{},{orders:n}));return(0,s.A)((0,s.A)({},e),{},{orders:n,salesChartData:r.salesChartData||e.salesChartData,profitChartData:r.profitChartData||e.profitChartData,inventoryChartData:r.inventoryChartData||e.inventoryChartData,dashboardTotals:r.totals||e.dashboardTotals})}if(JSON.stringify(be)===JSON.stringify(ye))return e;const we=e.orders.map(e=>e.id===t.payload.id||e._id===t.payload.id||e.id===t.payload._id||e._id===t.payload._id?ye:e),ve=j((0,s.A)((0,s.A)({},e),{},{orders:we}));return(0,s.A)((0,s.A)({},e),{},{orders:we,salesChartData:ve.salesChartData||e.salesChartData,profitChartData:ve.profitChartData||e.profitChartData,inventoryChartData:ve.inventoryChartData||e.inventoryChartData,dashboardTotals:ve.totals||e.dashboardTotals});case H.DELETE_ORDER:const Ne=e.orders.find(e=>e.id===t.payload);if(Ne){const n=(0,s.A)((0,s.A)({},Ne),{},{isDeleted:!0,deletedAt:(new Date).toISOString(),isSynced:!1});(0,a.updateItem)(a.STORES.orders,n,!0).then(()=>{console.log("\u2705 Order marked as deleted in IndexedDB:",t.payload),o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("Delete sync error:",e)),window.showToast&&window.showToast("Order deleted.","success")}).catch(e=>{console.error("\u274c IndexedDB update error:",e),window.showToast&&window.showToast("Couldn't delete order. Please try again.","error")});const r=e.orders.filter(e=>e.id!==t.payload),i=j((0,s.A)((0,s.A)({},e),{},{orders:r}));return(0,s.A)((0,s.A)({},e),{},{orders:r,currentPlanDetails:R(e.currentPlanDetails,{orders:-1}),salesChartData:i.salesChartData||e.salesChartData,profitChartData:i.profitChartData||e.profitChartData,inventoryChartData:i.inventoryChartData||e.inventoryChartData,dashboardTotals:i.totals||e.dashboardTotals})}return e;case H.ADD_PURCHASE_ORDER:const Se=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!1});return(0,a.addItem)(a.STORES.purchaseOrders,Se).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("MongoDB sync error:",e))}).catch(e=>console.error("IndexedDB save error:",e)),(0,s.A)((0,s.A)({},e),{},{purchaseOrders:[Se,...e.purchaseOrders]});case H.UPDATE_PURCHASE_ORDER:const Ae=void 0!==t.payload.syncedAt;Ae&&C();const _e=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!!Ae,isUpdate:!Ae||void 0,updatedAt:Ae?t.payload.updatedAt:(new Date).toISOString()});(0,a.updateItem)(a.STORES.purchaseOrders,_e).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Purchase order updated. We'll retry syncing shortly.","info")})}).catch(e=>{console.error("IndexedDB save error:",e.message),window.showToast&&window.showToast("Couldn't update purchase order. Please try again.","error")});const Ce=e.purchaseOrders.find(e=>e.id===t.payload.id);return Ce&&JSON.stringify(Ce)===JSON.stringify(_e)?e:(0,s.A)((0,s.A)({},e),{},{purchaseOrders:e.purchaseOrders.map(e=>e.id===t.payload.id?_e:e)});case H.DELETE_PURCHASE_ORDER:const Ie=e.purchaseOrders.find(e=>e.id===t.payload);if(Ie){const n=(0,s.A)((0,s.A)({},Ie),{},{isDeleted:!0,deletedAt:(new Date).toISOString(),isSynced:!1});return console.log("\ud83d\uddd1\ufe0f [DELETE_PURCHASE_ORDER] Marking purchase order as deleted:",n.id),console.log("\ud83d\uddd1\ufe0f [DELETE_PURCHASE_ORDER] Deleted PO data:",JSON.stringify(n,null,2)),(0,a.updateItem)(a.STORES.purchaseOrders,n,!0).then(()=>{console.log("\u2705 [DELETE_PURCHASE_ORDER] Purchase order marked as deleted in IndexedDB"),o.Ay.isOnline()?(console.log("\ud83c\udf10 [DELETE_PURCHASE_ORDER] Online - syncing deletion to backend..."),o.Ay.syncAll(V).catch(e=>console.error("Delete sync error:",e))):console.log("\ud83d\udcf4 [DELETE_PURCHASE_ORDER] Offline - deletion will sync when online"),window.showToast&&window.showToast("Purchase order deleted.","success")}).catch(e=>{console.error("\u274c [DELETE_PURCHASE_ORDER] IndexedDB update error:",e),window.showToast&&window.showToast("Couldn't delete purchase order. Please try again.","error")}),(0,s.A)((0,s.A)({},e),{},{purchaseOrders:e.purchaseOrders.filter(e=>e.id!==t.payload)})}return e;case H.SET_TRANSACTIONS:return e.transactions.length===t.payload.length&&e.transactions.every((e,n)=>{const r=t.payload[n];return r&&e.id===r.id&&JSON.stringify(e)===JSON.stringify(r)})?e:(0,s.A)((0,s.A)({},e),{},{transactions:t.payload});case H.ADD_TRANSACTION:const Ee=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!1});return(0,a.addItem)(a.STORES.transactions,Ee).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("MongoDB sync error:",e))}).catch(e=>console.error("IndexedDB save error:",e)),(0,s.A)((0,s.A)({},e),{},{transactions:[Ee,...e.transactions]});case H.UPDATE_TRANSACTION:const Te=void 0!==t.payload.syncedAt;Te&&C();const je=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!!Te,isUpdate:!Te||void 0,updatedAt:Te?t.payload.updatedAt:(new Date).toISOString()});(0,a.updateItem)(a.STORES.transactions,je).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Transaction updated. We'll retry syncing shortly.","info")})}).catch(e=>{console.error("IndexedDB save error:",e.message),window.showToast&&window.showToast("Couldn't update transaction. Please try again.","error")});const ke=e.transactions.find(e=>e.id===t.payload.id);return ke&&JSON.stringify(ke)===JSON.stringify(je)?e:(0,s.A)((0,s.A)({},e),{},{transactions:e.transactions.map(e=>e.id===t.payload.id?je:e)});case H.SET_ACTIVITIES:{const n=(t.payload||[]).map(e=>{const t=e||{},{isSynced:n}=t;return(0,r.A)(t,w)});return(0,s.A)((0,s.A)({},e),{},{activities:n})}case H.ADD_ACTIVITY:const De=(0,s.A)({},t.payload);return delete De.isSynced,(0,a.addItem)(a.STORES.activities,De).catch(e=>console.error("IndexedDB sync error:",e)),(0,s.A)((0,s.A)({},e),{},{activities:[De,...e.activities]});case H.SET_CATEGORIES:return(0,s.A)((0,s.A)({},e),{},{categories:t.payload});case H.ADD_CATEGORY:const Pe=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!1});return(0,a.addItem)(a.STORES.categories,Pe).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("MongoDB sync error:",e))}).catch(e=>console.error("IndexedDB save error:",e)),(0,s.A)((0,s.A)({},e),{},{categories:[Pe,...e.categories]});case H.UPDATE_CATEGORY:const Re=void 0!==t.payload.syncedAt;Re&&C();const Oe=(0,s.A)((0,s.A)({},t.payload),{},{isSynced:!!Re,isUpdate:!Re||void 0,updatedAt:Re?t.payload.updatedAt:(new Date).toISOString()});(0,a.updateItem)(a.STORES.categories,Oe).then(()=>{o.Ay.isOnline()&&o.Ay.syncAll(V).catch(()=>{window.showToast&&window.showToast("Category updated locally but sync failed. Will retry automatically.","warning")})}).catch(e=>{console.error("IndexedDB save error:",e.message),window.showToast&&window.showToast("Failed to update category: ".concat(e.message),"error")});const Le=e.categories.find(e=>e.id===t.payload.id);return Le&&JSON.stringify(Le)===JSON.stringify(Oe)?e:(0,s.A)((0,s.A)({},e),{},{categories:e.categories.map(e=>e.id===t.payload.id?Oe:e)});case H.DELETE_CATEGORY:const Me=e.categories.find(e=>e.id===t.payload);if(Me){const n=(0,s.A)((0,s.A)({},Me),{},{isDeleted:!0,deletedAt:(new Date).toISOString(),isSynced:!1});return(0,a.updateItem)(a.STORES.categories,n,!0).then(()=>{console.log("\u2705 Category marked as deleted in IndexedDB:",t.payload),o.Ay.isOnline()&&o.Ay.syncAll(V).catch(e=>console.error("Delete sync error:",e)),window.showToast&&window.showToast("Category deleted successfully","success")}).catch(e=>{console.error("\u274c IndexedDB update error:",e),window.showToast&&window.showToast("Failed to delete category: "+e.message,"error")}),(0,s.A)((0,s.A)({},e),{},{categories:e.categories.filter(e=>e.id!==t.payload)})}return e;case H.SET_CURRENT_VIEW:return(0,s.A)((0,s.A)({},e),{},{currentView:t.payload});case H.SET_LISTENING:return(0,s.A)((0,s.A)({},e),{},{isListening:t.payload});case H.SET_LOADING:return(0,s.A)((0,s.A)({},e),{},{isLoading:t.payload});case H.FORCE_REFRESH:return(0,s.A)((0,s.A)({},e),{},{refreshTrigger:Date.now()});case H.SET_CUSTOMER_PAGE:return(0,s.A)((0,s.A)({},e),{},{customerCurrentPage:t.payload});case H.SET_PRODUCT_PAGE:return(0,s.A)((0,s.A)({},e),{},{productCurrentPage:t.payload});case H.SET_BILL_ITEMS:return(0,s.A)((0,s.A)({},e),{},{currentBillItems:t.payload});case H.ADD_BILL_ITEM:return(0,s.A)((0,s.A)({},e),{},{currentBillItems:[...e.currentBillItems,t.payload]});case H.REMOVE_BILL_ITEM:return(0,s.A)((0,s.A)({},e),{},{currentBillItems:e.currentBillItems.filter((e,n)=>n!==t.payload)});case H.CLEAR_BILL_ITEMS:return(0,s.A)((0,s.A)({},e),{},{currentBillItems:[]});case H.SET_BILLING_DRAFT:return(0,s.A)((0,s.A)({},e),{},{billingDraft:t.payload||null});case H.SET_PO_ITEMS:return(0,s.A)((0,s.A)({},e),{},{currentPOItems:t.payload});case H.ADD_PO_ITEM:return(0,s.A)((0,s.A)({},e),{},{currentPOItems:[...e.currentPOItems,t.payload]});case H.REMOVE_PO_ITEM:return(0,s.A)((0,s.A)({},e),{},{currentPOItems:e.currentPOItems.filter((e,n)=>n!==t.payload)});case H.CLEAR_PO_ITEMS:return(0,s.A)((0,s.A)({},e),{},{currentPOItems:[]});case H.SET_LOW_STOCK_THRESHOLD:return(0,s.A)((0,s.A)({},e),{},{lowStockThreshold:t.payload});case H.SET_EXPIRY_DAYS_THRESHOLD:return(0,s.A)((0,s.A)({},e),{},{expiryDaysThreshold:t.payload});case H.SET_SUBSCRIPTION_DAYS:return(0,s.A)((0,s.A)({},e),{},{subscriptionDays:t.payload});case H.SET_SUBSCRIPTION_ACTIVE:return(0,s.A)((0,s.A)({},e),{},{isSubscriptionActive:t.payload});case H.SET_SCANNER_ACTIVE:return(0,s.A)((0,s.A)({},e),{},{isScannerActive:t.payload});case H.SET_SCANNER_TYPE:return(0,s.A)((0,s.A)({},e),{},{scannerType:t.payload});case H.SET_SALES_CHART_DATA:return(0,s.A)((0,s.A)({},e),{},{salesChartData:t.payload});case H.SET_PROFIT_CHART_DATA:return(0,s.A)((0,s.A)({},e),{},{profitChartData:t.payload});case H.SET_INVENTORY_CHART_DATA:return(0,s.A)((0,s.A)({},e),{},{inventoryChartData:t.payload});case H.SET_CUSTOMER_CHART_DATA:return(0,s.A)((0,s.A)({},e),{},{customerChartData:t.payload});case H.UPDATE_CURRENT_TIME:return e.currentTime===t.payload?e:(0,s.A)((0,s.A)({},e),{},{currentTime:t.payload});case H.SET_SYSTEM_STATUS:return e.systemStatus===t.payload?e:(0,s.A)((0,s.A)({},e),{},{systemStatus:t.payload});case H.SET_GST_NUMBER:return(0,s.A)((0,s.A)({},e),{},{gstNumber:t.payload});case H.SET_STORE_NAME:return(0,s.A)((0,s.A)({},e),{},{storeName:t.payload});case H.SET_UPI_ID:{const n=t.payload||"",r=localStorage.getItem("auth");if(r)try{const e=JSON.parse(r);e.currentUser&&(e.currentUser=(0,s.A)((0,s.A)({},e.currentUser),{},{upiId:n})),localStorage.setItem("auth",JSON.stringify(e))}catch(ee){console.error("Error updating UPI ID in auth storage:",ee)}return(0,s.A)((0,s.A)({},e),{},{upiId:n,currentUser:e.currentUser?(0,s.A)((0,s.A)({},e.currentUser),{},{upiId:n}):e.currentUser})}case H.UPDATE_USER:{const n=t.payload,r=localStorage.getItem("auth");if(r)try{const e=JSON.parse(r);e.currentUser=n,null!==n&&void 0!==n&&n.sellerId&&(e.sellerId=n.sellerId),localStorage.setItem("auth",JSON.stringify(e))}catch(ee){console.error("Error updating user in auth storage:",ee)}return(0,s.A)((0,s.A)({},e),{},{currentUser:n,upiId:void 0!==(null===n||void 0===n?void 0:n.upiId)?n.upiId||"":e.upiId})}case H.SET_VOICE_ASSISTANT_LANGUAGE:return(0,s.A)((0,s.A)({},e),{},{voiceAssistantLanguage:t.payload});case H.SET_VOICE_ASSISTANT_ENABLED:return(0,s.A)((0,s.A)({},e),{},{voiceAssistantEnabled:t.payload});case H.PLAN_BOOTSTRAP_START:var Q,K;return null!==(Q=e.planBootstrap)&&void 0!==Q&&Q.isActive||null!==(K=e.planBootstrap)&&void 0!==K&&K.hasCompleted?e:(0,s.A)((0,s.A)({},e),{},{planBootstrap:{isActive:!0,hasCompleted:!1,startedAt:Date.now(),completedAt:null}});case H.PLAN_BOOTSTRAP_COMPLETE:var Z,J,$;return"undefined"!==typeof window&&sessionStorage.setItem(E,"true"),null===(Z=e.planBootstrap)||void 0===Z||!Z.hasCompleted||null!==(J=e.planBootstrap)&&void 0!==J&&J.isActive?(0,s.A)((0,s.A)({},e),{},{planBootstrap:{isActive:!1,hasCompleted:!0,startedAt:(null===($=e.planBootstrap)||void 0===$?void 0:$.startedAt)||null,completedAt:Date.now()}}):e;case H.PLAN_BOOTSTRAP_RESET:return"undefined"!==typeof window&&sessionStorage.removeItem(E),(0,s.A)((0,s.A)({},e),{},{planBootstrap:{isActive:!1,hasCompleted:!1,startedAt:null,completedAt:null}});default:return"ADD_ORDER"!==t.type&&"FORCE_REFRESH"!==t.type||"ADD_ORDER"===t.type&&(console.error("\u274c ADD_ORDER action reached default case! This means the case is not matching!"),console.error("ActionTypes.ADD_ORDER:",H.ADD_ORDER),console.error("action.type:",t.type),console.error("Are they equal?",t.type===H.ADD_ORDER)),e}},Y=(0,i.createContext)(),X=e=>{var t,r,d,u;let{children:h}=e;const[m,f]=(0,i.useReducer)(G,P),p=(0,i.useRef)({inFlight:!1,refreshing:!1,lastAttemptKey:null,lastAttemptAt:0,lastRefreshAt:0}),g=(0,i.useRef)({lastTriggered:0,hasShown:!1}),x=(0,i.useRef)({sellerId:null,hash:null}),w=(0,i.useCallback)(async()=>{try{const[e,t]=await Promise.all([(0,c.AT)("/data/current-plan"),(0,c.AT)("/plans/usage")]),n=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||e.data:null,r=t.success&&t.data&&t.data.summary?t.data:null;let i=O(n,r);if(!i&&n&&(i=(0,s.A)({},n)),i){const e=m.currentPlanDetails;!e||JSON.stringify(e)!==JSON.stringify(i)?(console.log("\ud83d\udd04 Plan details updated from backend"),i.planId?f({type:H.SET_CURRENT_PLAN,payload:i.planId}):null!==n&&void 0!==n&&n.planId&&f({type:H.SET_CURRENT_PLAN,payload:n.planId}),f({type:H.SET_CURRENT_PLAN_DETAILS,payload:i||null})):console.log("\ud83d\udccb Plan details unchanged from backend")}}catch(e){console.error("Error refreshing current plan details:",e)}},[f]);(0,i.useEffect)(()=>{(e=>{N=e})(f),window.globalDispatch=f},[f]),(0,i.useEffect)(()=>{var e;if(null===(e=m.currentUser)||void 0===e||!e.sellerId||"online"!==m.systemStatus)return;const t=setInterval(async()=>{var e;const t=null===(e=m.currentUser)||void 0===e?void 0:e.lastActivityDate;if(t){const e=new Date(t).getTime();if((Date.now()-e)/6e4>10)return void console.log("\u23ed\ufe0f Skipping periodic plan refresh - user inactive")}try{console.log("\ud83d\udd04 Periodic plan details refresh..."),await w()}catch(n){console.error("Error during periodic plan refresh:",n)}},9e5);return()=>clearInterval(t)},[null===(t=m.currentUser)||void 0===t?void 0:t.sellerId,m.systemStatus,w]),(0,i.useEffect)(()=>{(0,o.QF)(V),(0,o.fO)(T),(0,o.It)((e,t)=>{if(N)switch(e){case"orders":N({type:H.UPDATE_ORDER,payload:t});break;case"customers":N({type:H.UPDATE_CUSTOMER,payload:t});break;case"products":N({type:H.UPDATE_PRODUCT,payload:t});break;case"purchaseOrders":N({type:H.UPDATE_PURCHASE_ORDER,payload:t});break;case"transactions":N({type:H.UPDATE_TRANSACTION,payload:t});break;case"categories":N({type:H.UPDATE_CATEGORY,payload:t});break;case"refunds":console.log("[SYNC] Refund ".concat(t.id," synced successfully"));break;default:console.warn("[SYNC] Unknown store type for state update: ".concat(e))}})},[]),(0,i.useEffect)(()=>{if("undefined"===typeof window||!("serviceWorker"in navigator))return;const e=async e=>{var t;if("TRIGGER_SYNC"===(null===(t=e.data)||void 0===t?void 0:t.type)){console.log("[PWA] Service worker requested sync");try{await(0,l.isOnline)()&&m.isAuthenticated&&(await o.Ay.syncAll(V),await y(),window.showToast&&window.showToast("Data synced successfully","success"))}catch(n){console.error("[PWA] Sync trigger error:",n)}}};return navigator.serviceWorker.addEventListener("message",e),()=>{navigator.serviceWorker.removeEventListener("message",e)}},[m.isAuthenticated]),(0,i.useEffect)(()=>{(async()=>{try{var e;const[t,n,u,h,p,g,b,w]=await Promise.all([(0,a.getAllItems)(a.STORES.customers).catch(()=>[]),(0,a.getAllItems)(a.STORES.products).catch(()=>[]),(0,a.getAllItems)(a.STORES.orders).catch(()=>[]),(0,a.getAllItems)(a.STORES.transactions).catch(()=>[]),(0,a.getAllItems)(a.STORES.purchaseOrders).catch(()=>[]),(0,a.getAllItems)(a.STORES.categories).catch(()=>[]),(0,a.getAllItems)(a.STORES.planDetails).catch(()=>[]),(0,a.getAllItems)(a.STORES.activities).catch(()=>[])]),v=(t||[]).map(e=>(0,s.A)((0,s.A)({},e),{},{dueAmount:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,balanceDue:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,mobileNumber:e.mobileNumber||e.phone||""})),N=(n||[]).map(e=>{const t=void 0!==e.stock?e.stock:void 0!==e.quantity?e.quantity:0,n=void 0!==e.costPrice?e.costPrice:void 0!==e.unitPrice?e.unitPrice:0;return(0,s.A)((0,s.A)({},e),{},{stock:t,quantity:t,costPrice:n,unitPrice:n})});f({type:H.SET_CUSTOMERS,payload:(v||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PRODUCTS,payload:(N||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ORDERS,payload:(u||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_TRANSACTIONS,payload:(h||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PURCHASE_ORDERS,payload:(p||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_CATEGORIES,payload:(g||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ACTIVITIES,payload:w||[]});const S=(null===(e=m.currentUser)||void 0===e?void 0:e.sellerId)||null;if(S){const e=(b||[]).find(e=>e&&e.sellerId===S);null!==e&&void 0!==e&&e.data?(console.log("\ud83d\ude80 Loading plan details from IndexedDB for instant UI unlock"),f({type:H.SET_CURRENT_PLAN_DETAILS,payload:e.data}),e.data.planId&&f({type:H.SET_CURRENT_PLAN,payload:e.data.planId}),"boolean"===typeof e.data.isExpired&&f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:!e.data.isExpired}),x.current={sellerId:S,hash:JSON.stringify(e.data)}):console.log("\ud83d\udcdd No cached plan details found - will fetch from backend"),A&&setTimeout(async()=>{try{console.log("\ud83d\udd04 Background plan details refresh from backend...");const[t,n]=await Promise.all([(0,c.AT)("/data/current-plan"),(0,c.AT)("/plans/usage")]),r=t.success&&t.data?Array.isArray(t.data)?t.data:t.data.data||t.data:null,i=n.success&&n.data&&n.data.summary?n.data:null;let a=O(r,i);if(!a&&r&&(a=(0,s.A)({},r)),a){console.log("\u2705 Background plan refresh completed - updating UI silently");const t=m.currentPlanDetails;if(!t||JSON.stringify(t)!==JSON.stringify(a)){if(console.log("\ud83d\udd04 Plan data changed - updating UI"),a.planId&&f({type:H.SET_CURRENT_PLAN,payload:a.planId}),f({type:H.SET_CURRENT_PLAN_DETAILS,payload:a||null}),null!==e&&void 0!==e&&e.data&&a){const t=e.data.isExpired,n=a.isExpired;t!==n&&window.showToast&&window.showToast(n?"Your plan has expired. Please upgrade to continue.":"Plan details updated.",n?"warning":"info")}}else console.log("\ud83d\udccb Plan data unchanged - no UI update needed")}}catch(t){console.error("\u274c Background plan refresh failed:",t)}},3e3)}const A=await(0,l.isOnline)();if(f({type:H.SET_SYSTEM_STATUS,payload:A?"online":"offline"}),A)try{try{await o.Ay.syncAll(V)}catch(r){console.error("Initial online sync failed, proceeding to incremental sync:",r)}try{await new Promise(e=>setTimeout(e,100));const e=await y();if(console.log("\u2705 Incremental sync completed:",e),e.success&&!e.skipped){const t=Object.keys(e.results||{});if(t.length>0){const e=[],n={};t.includes("customers")&&e.push((0,a.getAllItems)(a.STORES.customers).then(e=>{n.customers=e.filter(e=>!0!==e.isDeleted)})),t.includes("products")&&e.push((0,a.getAllItems)(a.STORES.products).then(e=>{n.products=e.filter(e=>!0!==e.isDeleted)})),t.includes("orders")&&e.push((0,a.getAllItems)(a.STORES.orders).then(e=>{n.orders=e.filter(e=>!0!==e.isDeleted)})),t.includes("transactions")&&e.push((0,a.getAllItems)(a.STORES.transactions).then(e=>{n.transactions=e.filter(e=>!0!==e.isDeleted)})),t.includes("purchaseOrders")&&e.push((0,a.getAllItems)(a.STORES.purchaseOrders).then(e=>{n.purchaseOrders=e.filter(e=>!0!==e.isDeleted)})),t.includes("categories")&&e.push((0,a.getAllItems)(a.STORES.categories).then(e=>{n.categories=e.filter(e=>!0!==e.isDeleted)})),await Promise.all(e),n.customers&&f({type:H.SET_CUSTOMERS,payload:n.customers}),n.products&&f({type:H.SET_PRODUCTS,payload:n.products}),n.orders&&f({type:H.SET_ORDERS,payload:n.orders}),n.transactions&&f({type:H.SET_TRANSACTIONS,payload:n.transactions}),n.purchaseOrders&&f({type:H.SET_PURCHASE_ORDERS,payload:n.purchaseOrders}),n.categories&&f({type:H.SET_CATEGORIES,payload:n.categories})}}}catch(i){console.error("\u274c Error performing incremental sync:",i)}}catch(d){console.error("\u274c Error syncing with backend:",d.message)}}catch(u){var t,n;console.error("Error loading data:",u);const e=(null===(t=m.currentUser)||void 0===t?void 0:t.email)||(null===(n=m.currentUser)||void 0===n?void 0:n.uid);if(e){const t=localStorage.getItem(D("customers",e)),n=localStorage.getItem(D("products",e)),r=localStorage.getItem(D("transactions",e)),s=localStorage.getItem(D("purchaseOrders",e)),i=localStorage.getItem(D("activities",e));t&&f({type:H.SET_CUSTOMERS,payload:JSON.parse(t)}),n&&f({type:H.SET_PRODUCTS,payload:JSON.parse(n)}),r&&f({type:H.SET_TRANSACTIONS,payload:JSON.parse(r)}),s&&f({type:H.SET_PURCHASE_ORDERS,payload:JSON.parse(s)}),i&&f({type:H.SET_ACTIVITIES,payload:JSON.parse(i)})}f({type:H.SET_SYSTEM_STATUS,payload:"offline"})}})()},[]),(0,i.useEffect)(()=>{var e,t,n,r;const i=(null===(e=m.currentUser)||void 0===e?void 0:e.email)||(null===(t=m.currentUser)||void 0===t?void 0:t.uid);if(!i)return f({type:H.SET_CUSTOMERS,payload:[]}),f({type:H.SET_PRODUCTS,payload:[]}),f({type:H.SET_TRANSACTIONS,payload:[]}),f({type:H.SET_PURCHASE_ORDERS,payload:[]}),f({type:H.SET_ACTIVITIES,payload:[]}),void f({type:H.SET_CATEGORIES,payload:[]});(async()=>{try{var e;const[i,d,u,h,p,g,y,b]=await Promise.all([(0,a.getAllItems)(a.STORES.customers).catch(()=>[]),(0,a.getAllItems)(a.STORES.products).catch(()=>[]),(0,a.getAllItems)(a.STORES.orders).catch(()=>[]),(0,a.getAllItems)(a.STORES.transactions).catch(()=>[]),(0,a.getAllItems)(a.STORES.purchaseOrders).catch(()=>[]),(0,a.getAllItems)(a.STORES.categories).catch(()=>[]),(0,a.getAllItems)(a.STORES.planDetails).catch(()=>[]),(0,a.getAllItems)(a.STORES.activities).catch(()=>[])]),w=(i||[]).map(e=>(0,s.A)((0,s.A)({},e),{},{dueAmount:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,balanceDue:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,mobileNumber:e.mobileNumber||e.phone||""})),v=(d||[]).map(e=>{const t=void 0!==e.stock?e.stock:void 0!==e.quantity?e.quantity:0,n=void 0!==e.costPrice?e.costPrice:void 0!==e.unitPrice?e.unitPrice:0;return(0,s.A)((0,s.A)({},e),{},{stock:t,quantity:t,costPrice:n,unitPrice:n})});f({type:H.SET_CUSTOMERS,payload:(w||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PRODUCTS,payload:(v||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ORDERS,payload:(u||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_TRANSACTIONS,payload:(h||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PURCHASE_ORDERS,payload:(p||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_CATEGORIES,payload:(g||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ACTIVITIES,payload:b||[]});const N=(null===(e=m.currentUser)||void 0===e?void 0:e.sellerId)||null;if(N){const e=(y||[]).find(e=>e&&e.sellerId===N);null!==e&&void 0!==e&&e.data&&!m.currentPlanDetails&&(console.log("\ud83d\ude80 Loading plan details from IndexedDB for instant UI unlock"),f({type:H.SET_CURRENT_PLAN_DETAILS,payload:e.data}),e.data.planId&&f({type:H.SET_CURRENT_PLAN,payload:e.data.planId}),"boolean"===typeof e.data.isExpired&&f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:!e.data.isExpired}),x.current={sellerId:N,hash:JSON.stringify(e.data)})}const S=await(0,l.isOnline)();if(f({type:H.SET_SYSTEM_STATUS,payload:S?"online":"offline"}),S){try{var t;try{await o.Ay.syncAll(V)}catch(n){console.error("User-change online sync failed, proceeding to fetch backend:",n)}const e=await(0,c.AT)("/data/all",{method:"GET"});if(e.success&&null!==(t=e.data)&&void 0!==t&&t.data){const{customers:t,products:n,orders:r,transactions:i,purchaseOrders:o,categories:c,refunds:d}=e.data.data,u=(t||[]).map(e=>(0,s.A)((0,s.A)({},e),{},{dueAmount:e.dueAmount||0,balanceDue:e.dueAmount||0,mobileNumber:e.mobileNumber||e.phone||""})),h=(n||[]).map(e=>{const t=void 0!==e.stock?e.stock:void 0!==e.quantity?e.quantity:0,n=void 0!==e.costPrice?e.costPrice:void 0!==e.unitPrice?e.unitPrice:0;return(0,s.A)((0,s.A)({},e),{},{stock:t,quantity:t,costPrice:n,unitPrice:n})});await Promise.all([(0,l.syncToIndexedDB)(a.STORES.customers,u),(0,l.syncToIndexedDB)(a.STORES.products,h),(0,l.syncToIndexedDB)(a.STORES.orders,r||[]),(0,l.syncToIndexedDB)(a.STORES.transactions,i||[]),(0,l.syncToIndexedDB)(a.STORES.purchaseOrders,o||[]),(0,l.syncToIndexedDB)(a.STORES.categories,c||[]),(0,l.syncToIndexedDB)(a.STORES.refunds,d||[])]),f({type:H.SET_CUSTOMERS,payload:(u||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PRODUCTS,payload:(h||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ORDERS,payload:(r||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_TRANSACTIONS,payload:(i||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PURCHASE_ORDERS,payload:(o||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_CATEGORIES,payload:(c||[]).filter(e=>!0!==e.isDeleted)})}}catch(r){console.error("\u274c Error fetching user data from backend:",r.message)}setTimeout(async()=>{try{console.log("\ud83d\udd04 Background plan details refresh after login...");const[e,t]=await Promise.all([(0,c.AT)("/data/current-plan"),(0,c.AT)("/plans/usage")]),n=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||e.data:null,r=t.success&&t.data&&t.data.summary?t.data:null;let i=O(n,r);if(!i&&n&&(i=(0,s.A)({},n)),i){console.log("\u2705 Login plan refresh completed");const e=m.currentPlanDetails;!e||JSON.stringify(e)!==JSON.stringify(i)?(console.log("\ud83d\udd04 Updating plan data after login"),i.planId&&f({type:H.SET_CURRENT_PLAN,payload:i.planId}),f({type:H.SET_CURRENT_PLAN_DETAILS,payload:i||null})):console.log("\ud83d\udccb Plan data unchanged after login")}}catch(e){console.error("\u274c Login plan refresh failed:",e)}},2e3)}}catch(i){console.error("Error loading user data:",i),f({type:H.SET_SYSTEM_STATUS,payload:"offline"})}})(),("seller"===(null===(n=m.currentUser)||void 0===n?void 0:n.userType)||null!==(r=m.currentUser)&&void 0!==r&&r.sellerId)&&w().catch(e=>{console.error("Error refreshing plan details on user login:",e)});const d=localStorage.getItem(D("settings",i));if(d)try{const e=JSON.parse(d);f({type:H.SET_LOW_STOCK_THRESHOLD,payload:e.lowStockThreshold}),f({type:H.SET_EXPIRY_DAYS_THRESHOLD,payload:e.expiryDaysThreshold}),f({type:H.SET_SUBSCRIPTION_DAYS,payload:e.subscriptionDays}),f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:e.isSubscriptionActive}),f({type:H.SET_CURRENT_PLAN,payload:e.currentPlan}),e.gstNumber&&f({type:H.SET_GST_NUMBER,payload:e.gstNumber}),e.storeName&&f({type:H.SET_STORE_NAME,payload:e.storeName}),void 0!==e.voiceAssistantEnabled&&f({type:H.SET_VOICE_ASSISTANT_ENABLED,payload:e.voiceAssistantEnabled}),e.voiceAssistantLanguage&&f({type:H.SET_VOICE_ASSISTANT_LANGUAGE,payload:e.voiceAssistantLanguage})}catch(u){console.error("Error parsing settings:",u)}},[m.currentUser]),(0,i.useEffect)(()=>{var e,t,n,r,s,i;if(!m.isAuthenticated)return;const a=m.currentPlanDetails;if(!a)return;const o=p.current;if(!(e=>!!e&&(Array.isArray(e.planUsagePlans)||Array.isArray(e.planOrders)))(a)){const e=Date.now();return void(!o.refreshing&&e-o.lastRefreshAt>=15e3&&(o.refreshing=!0,(async()=>{try{await w()}catch(e){console.error("Error fetching plan usage details:",e)}finally{o.refreshing=!1,o.lastRefreshAt=Date.now()}})()))}const l=()=>{if("upgrade"!==m.currentView){(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"undefined"!==typeof window&&"function"===typeof window.navigateToView&&(window.navigateToView(e,t),!0)})("upgrade",{replace:!0})||f({type:H.SET_CURRENT_VIEW,payload:"upgrade"})}},d=()=>{if(g.current.hasShown)return;const e=Date.now();e-g.current.lastTriggered<5e3||(g.current.lastTriggered=e,g.current.hasShown=!0,"undefined"!==typeof window&&window.showToast&&window.showToast("Your subscription has expired. Upgrade now to continue using all features.","warning",6e3))},u=(e=>{if(!e)return[];const t=[];Array.isArray(e.planUsagePlans)&&t.push(...e.planUsagePlans),Array.isArray(e.planOrders)&&t.push(...e.planOrders);const n=new Map;for(const r of t){const e=U(r);e&&e.key&&(n.has(e.key)||n.set(e.key,e))}return Array.from(n.values())})(a),h=Date.now(),x=u.filter(e=>z(e.paymentStatus)||z(e.status));if(0===x.length)return!1!==m.isSubscriptionActive&&f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:!1}),d(),void l();const y=x.filter(e=>!((e,t)=>!e||!0===e.isExpiredFlag||!1!==e.isExpiredFlag&&null!==e.expiresAt&&e.expiresAt<=t)(e,h));if(0===y.length)return!1!==m.isSubscriptionActive&&f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:!1}),d(),void l();!0!==m.isSubscriptionActive&&f({type:H.SET_SUBSCRIPTION_ACTIVE,payload:!0}),g.current.hasShown=!1;const b=[a.planId,a.plan_id,null===(e=a.plan)||void 0===e?void 0:e.planId,null===(t=a.plan)||void 0===t?void 0:t.plan_id,null===(n=a.plan)||void 0===n?void 0:n.id,null===(r=a.plan)||void 0===r?void 0:r.slug,a.planKey,null===(s=a.plan)||void 0===s?void 0:s.key,null===(i=a.plan)||void 0===i?void 0:i.identifier,m.currentPlan].map(M).filter(Boolean),v=new Set(b),N=y.find(e=>v.has(e.planKey)),S=q(a,h);if(!S&&N)return void(g.current.hasShown=!1);const A=Date.now();if(S&&!o.refreshing){if(A-o.lastRefreshAt>=15e3&&!o.inFlight)return o.refreshing=!0,void(async()=>{try{await w()}catch(e){console.error("Error refreshing plan details after expiry:",e)}finally{o.refreshing=!1,o.lastRefreshAt=Date.now()}})()}const _=y.slice().sort((e,t)=>{var n,r,s,i;const a=null!==(n=e.startsAt)&&void 0!==n?n:0,o=null!==(r=t.startsAt)&&void 0!==r?r:0;if(a!==o)return a-o;return(null!==(s=e.expiresAt)&&void 0!==s?s:Number.POSITIVE_INFINITY)-(null!==(i=t.expiresAt)&&void 0!==i?i:Number.POSITIVE_INFINITY)}),C=S?N||_[0]||null:_.find(e=>!v.has(e.planKey))||null;C&&C.planId?"undefined"===typeof navigator||!1!==navigator.onLine?o.inFlight||o.refreshing||o.lastAttemptKey===C.key&&A-o.lastAttemptAt<6e4||(o.inFlight=!0,o.lastAttemptKey=C.key,o.lastAttemptAt=A,(async()=>{try{const e={planId:C.planId};C.planOrderId&&(e.planOrderId=C.planOrderId);const t=await(0,c.AT)("/data/plans/upgrade",{method:"POST",body:e});t.success?(await w(),o.lastRefreshAt=Date.now()):(console.warn("Automatic plan switch failed",t),d(),l())}catch(e){console.error("Automatic plan switch error:",e),d(),l()}finally{o.inFlight=!1}})()):l():S&&(d(),l())},[m.isAuthenticated,m.currentPlanDetails,m.currentPlan,m.isSubscriptionActive,m.currentView,m.currentTime,f,w]),(0,i.useEffect)(()=>{var e;const t=(null===(e=m.currentUser)||void 0===e?void 0:e.sellerId)||null;if(!t)return;const n="planDetails_".concat(t);if(!m.currentPlanDetails)return;const r=JSON.stringify(m.currentPlanDetails);var s,i;if(x.current.sellerId===t&&x.current.hash===r)return void(null===(s=m.planBootstrap)||void 0===s||!s.isActive||null!==(i=m.planBootstrap)&&void 0!==i&&i.hasCompleted||f({type:H.PLAN_BOOTSTRAP_COMPLETE}));const o={id:n,sellerId:t,planId:m.currentPlanDetails.planId||null,planName:m.currentPlanDetails.planName||null,data:m.currentPlanDetails,updatedAt:(new Date).toISOString()};(async()=>{let e=!1;try{await(0,a.updateItem)(a.STORES.planDetails,o),e=!0}catch(s){try{await(0,a.addItem)(a.STORES.planDetails,o),e=!0}catch(i){console.error("Error saving active plan details to IndexedDB:",i)}}finally{var n;x.current={sellerId:t,hash:r},e&&null!==(n=m.planBootstrap)&&void 0!==n&&n.isActive&&f({type:H.PLAN_BOOTSTRAP_COMPLETE})}})()},[m.currentPlanDetails,null===(r=m.currentUser)||void 0===r?void 0:r.sellerId,null===(d=m.planBootstrap)||void 0===d?void 0:d.isActive,f]),(0,i.useEffect)(()=>{var e,t;const n=(null===(e=m.currentUser)||void 0===e?void 0:e.email)||(null===(t=m.currentUser)||void 0===t?void 0:t.uid);if(!n)return;const r=setTimeout(()=>{localStorage.setItem(D("customers",n),JSON.stringify(m.customers)),localStorage.setItem(D("products",n),JSON.stringify(m.products)),localStorage.setItem(D("transactions",n),JSON.stringify(m.transactions)),localStorage.setItem(D("purchaseOrders",n),JSON.stringify(m.purchaseOrders)),localStorage.setItem(D("activities",n),JSON.stringify(m.activities))},300);return()=>clearTimeout(r)},[m.customers,m.products,m.transactions,m.purchaseOrders,m.activities,m.currentUser]),(0,i.useEffect)(()=>{var e,t;const n=(null===(e=m.currentUser)||void 0===e?void 0:e.email)||(null===(t=m.currentUser)||void 0===t?void 0:t.uid);if(!n)return;const r={lowStockThreshold:m.lowStockThreshold,expiryDaysThreshold:m.expiryDaysThreshold,subscriptionDays:m.subscriptionDays,isSubscriptionActive:m.isSubscriptionActive,currentPlan:m.currentPlan,gstNumber:m.gstNumber,storeName:m.storeName,upiId:m.upiId,voiceAssistantEnabled:m.voiceAssistantEnabled,voiceAssistantLanguage:m.voiceAssistantLanguage};localStorage.setItem(D("settings",n),JSON.stringify(r))},[m.lowStockThreshold,m.expiryDaysThreshold,m.subscriptionDays,m.isSubscriptionActive,m.currentPlan,m.gstNumber,m.storeName,m.voiceAssistantEnabled,m.voiceAssistantLanguage,m.currentUser]);const v=(0,i.useCallback)(()=>{const e=(new Date).toLocaleTimeString();f({type:H.UPDATE_CURRENT_TIME,payload:e})},[f]);(0,i.useEffect)(()=>{let e=null;return e=setInterval(v,1e3),v(),()=>{e&&(clearInterval(e),e=null)}},[v]),(0,i.useEffect)(()=>{let e=!0;const t=async()=>{if(await new Promise(e=>setTimeout(e,500)),navigator.onLine&&e){try{const n=await(0,a.getAllItems)(a.STORES.customers),r=await(0,a.getAllItems)(a.STORES.products),i=await(0,a.getAllItems)(a.STORES.orders),l=async(e,t)=>{const n=t=>(0,a.updateItem)(e,(0,s.A)((0,s.A)({},t),{},{isSynced:!1}),!0),r=t.filter(e=>!0===e.isDeleted&&(!0===e.isSynced||"true"===e.isSynced));r.length>0&&await Promise.all(r.map(n).map(e=>e))};await l(a.STORES.customers,n),await l(a.STORES.products,r),await l(a.STORES.orders,i);const c=n.filter(e=>!e.isSynced),d=r.filter(e=>!e.isSynced),u=i.filter(e=>!e.isSynced);if(c.length>0||d.length>0||u.length>0){const n=await o.Ay.syncAll(V);var t;if(n.success&&e){if(window.showToast)window.showToast("All offline changes synced! (".concat((null===(t=n.summary)||void 0===t?void 0:t.totalSynced)||0," items)"),"success")}else e&&window.showToast&&window.showToast("Some changes could not be synced. Will retry automatically.","warning")}}catch(i){console.error("\u274c Error syncing unsynced changes:",i.message),e&&window.showToast&&window.showToast("Error syncing offline changes. Will retry automatically.","error")}if(e)try{const t=await(0,l.gc)(),i=await(0,a.getAllItems)(a.STORES.activities).catch(()=>[]),o=(t.customers||[]).map(e=>e.phone&&!e.mobileNumber||!e.mobileNumber&&e.phone?(0,s.A)((0,s.A)({},e),{},{mobileNumber:e.phone}):e);var n,r;if(e)f({type:H.SET_CUSTOMERS,payload:(o||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PRODUCTS,payload:(t.products||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ORDERS,payload:(t.orders||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_TRANSACTIONS,payload:(t.transactions||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_PURCHASE_ORDERS,payload:(t.purchaseOrders||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_CATEGORIES,payload:(t.categories||[]).filter(e=>!0!==e.isDeleted)}),f({type:H.SET_ACTIVITIES,payload:(i||[]).filter(e=>!0!==e.isDeleted)}),("seller"===(null===(n=m.currentUser)||void 0===n?void 0:n.userType)||null!==(r=m.currentUser)&&void 0!==r&&r.sellerId)&&setTimeout(async()=>{console.log("\ud83d\udd04 Refreshing plan details after coming online...");try{await w()}catch(e){console.error("Error refreshing plan details after coming online:",e)}},1e3),f({type:H.SET_SYSTEM_STATUS,payload:"online"})}catch(c){console.error("Error refreshing data after coming online:",c.message),e&&f({type:H.SET_SYSTEM_STATUS,payload:"online"})}}},n=()=>{e&&f({type:H.SET_SYSTEM_STATUS,payload:"offline"})};return navigator.onLine&&t(),window.addEventListener("online",t),window.addEventListener("offline",n),()=>{e=!1,window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]);const S=(0,i.useCallback)(async()=>{const e=[{key:"customers",label:"Customers",storeName:a.STORES.customers},{key:"products",label:"Products",storeName:a.STORES.products},{key:"orders",label:"Orders",storeName:a.STORES.orders},{key:"transactions",label:"Transactions",storeName:a.STORES.transactions},{key:"purchaseOrders",label:"Purchase Orders",storeName:a.STORES.purchaseOrders},{key:"categories",label:"Categories",storeName:a.STORES.categories}],t=[],n=e=>!!e&&(!1===e.isSynced||"false"===e.isSynced||!!e.syncError);for(const s of e)try{const e=(await(0,a.getAllItems)(s.storeName)||[]).filter(n);e.length>0&&t.push({key:s.key,label:s.label,count:e.length})}catch(r){console.error("[LOGOUT] Error checking unsynced items for ".concat(s.label,":"),r)}return t},[]);(0,i.useEffect)(()=>{const e=localStorage.getItem("auth");if(e)try{var t;const n=JSON.parse(e);("staff"===n.userType||"staff"===(null===(t=n.currentUser)||void 0===t?void 0:t.userType))&&n.isAuthenticated?r():console.log("\u274c Not a staff user or not authenticated")}catch(a){console.error("Error parsing auth data:",a)}else console.log("\u274c No auth data in localStorage");const r=async()=>{const e=localStorage.getItem("auth");if(e)try{const i=JSON.parse(e);if("staff"===i.userType&&i.isAuthenticated){console.log("\ud83d\udd04 Loading staff permissions on app initialization...");const e=i.currentUser;if(null===e||void 0===e||!e._id)return;const{getStaffPermissions:o}=await Promise.resolve().then(n.bind(n,1337)),l=await o(e._id);if(l&&Object.keys(l).length>0){const e=["customers","products","inventory","billing","salesOrderHistory","refunds","purchaseOrders","financial","reports","settings","dashboard"];let t="dashboard";for(const n of e)if(!0===l[n]){t=n;break}f({type:H.REFRESH_STAFF_PERMISSIONS,payload:{permissions:l,defaultView:t}})}else f({type:H.REFRESH_STAFF_PERMISSIONS,payload:{permissions:{},defaultView:"dashboard"}});f({type:H.SET_STAFF_PERMISSIONS_LOADING,payload:{loading:!1}});if(!await Promise.resolve().then(n.bind(n,3885)).then(e=>e.isOnline()))return void console.log("\ud83d\udcf4 Skipping staff permission refresh - offline, using cached permissions");console.log("\ud83d\udd04 Refreshing staff permissions from server...");const{getStaffAuth:c}=await Promise.resolve().then(n.bind(n,3862)),d=await c(e.email,e.uid||"",e.displayName||e.name||"",e.profilePicture||e.photoURL||"");if(d.success&&d.staff){var t;console.log("\u2705 Staff permissions refreshed from server on app init:",{permissions:d.staff.permissions,userType:d.userType});const{saveStaffPermissions:e}=await Promise.resolve().then(n.bind(n,1337));try{var r;await e(d.staff._id,d.staff.permissions,(null===(r=d.seller)||void 0===r?void 0:r._id)||d.sellerId),console.log("\ud83d\udcbe Staff permissions updated in IndexedDB")}catch(a){console.error("\u274c Failed to save updated permissions to IndexedDB:",a)}f({type:H.LOGIN,payload:(0,s.A)((0,s.A)({},d.staff),{},{userType:d.userType,sellerId:null===(t=d.seller)||void 0===t?void 0:t._id})})}else console.error("\u274c Staff re-authentication failed on app init:",d.error),d.error&&(d.error.includes("not found")||d.error.includes("inactive"))&&(console.log("\ud83d\udeaa Logging out staff user due to authentication failure"),localStorage.removeItem("auth"),f({type:H.LOGOUT}),window.showToast&&window.showToast("Your account has been deactivated. Please contact your seller.","error"))}}catch(a){console.error("\ud83d\udca5 Error re-authenticating staff on app init:",a)}},i=setTimeout(r,1500);return()=>clearTimeout(i)},[f]);const A=(0,i.useCallback)(async()=>{const e=await S();if(0===e.length)return{success:!0};const t=await o.Ay.syncAll(V),n=await S();if(0===n.length)return{success:!0,synced:e};if(!o.Ay.isOnline())return{success:!1,message:"You are offline. Please reconnect to the internet so we can sync the pending changes before logging out.",unsynced:n,toastType:"error",offline:!0};return{success:!1,message:t.success?"Some data could not be synced yet. Please wait a moment and try again.":"Sync in progress"===t.error?"A sync is already running. Please wait a moment and try again.":"Unable to sync all changes right now. Please try again shortly.",unsynced:n,toastType:"warning"}},[S]),_=(0,i.useCallback)(async e=>"REQUEST_LOGOUT"===(null===e||void 0===e?void 0:e.type)?A():(f(e),{success:!0}),[f,A]),C=(0,i.useMemo)(()=>{try{return j(m)}catch(e){return console.error("Error computing derived metrics:",e),{}}},[m.orders,m.products,null===(u=m.currentUser)||void 0===u?void 0:u.sellerId]),I=(0,i.useMemo)(()=>({state:m,dispatch:_,derivedMetrics:C,refreshCurrentPlanDetails:w}),[m,C,_,w]);return(0,b.jsx)(Y.Provider,{value:I,children:h})},Q=()=>{const e=(0,i.useContext)(Y);if(!e)throw new Error("useApp must be used within an AppProvider");return e}},8162:(e,t,n)=>{"use strict";n.d(t,{k_:()=>a,zD:()=>o});const r={dashboard:"/dashboard",customers:"/customers",products:"/products",inventory:"/inventory",billing:"/billing",purchase:"/purchase",financial:"/financial",reports:"/reports",salesOrderHistory:"/sales-order-history",refunds:"/refunds",staff:"/staff",upgrade:"/upgrade",settings:"/settings"},s=e=>e?"/"===e?"/":e.replace(/\/+$/,""):"/",i=Object.entries(r).reduce((e,t)=>{let[n,r]=t;return e[s(r)]=n,e},{"/":"dashboard"}),a=e=>r[e]||r.dashboard,o=e=>{const t=s(e);return i[t]||"dashboard"}},8177:(e,t,n)=>{const r=n(1312);function s(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}s.prototype.initialize=function(e){this.degree=e,this.genPoly=r.generateECPolynomial(this.degree)},s.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=r.mod(t,this.genPoly),s=this.degree-n.length;if(s>0){const e=new Uint8Array(this.degree);return e.set(n,s),e}return n},e.exports=s},8293:(e,t)=>{function n(e){if("number"===typeof e&&(e=e.toString()),"string"!==typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const n=parseInt(t.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t="undefined"===typeof e.margin||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,s=e.scale||4;return{width:r,scale:r?4:s,margin:t,color:{dark:n(e.color.dark||"#000000ff"),light:n(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,n){const r=t.getScale(e,n);return Math.floor((e+2*n.margin)*r)},t.qrToImageData=function(e,n,r){const s=n.modules.size,i=n.modules.data,a=t.getScale(s,r),o=Math.floor((s+2*r.margin)*a),l=r.margin*a,c=[r.color.light,r.color.dark];for(let t=0;t<o;t++)for(let n=0;n<o;n++){let d=4*(t*o+n),u=r.color.light;if(t>=l&&n>=l&&t<o-l&&n<o-l){u=c[i[Math.floor((t-l)/a)*s+Math.floor((n-l)/a)]?1:0]}e[d++]=u.r,e[d++]=u.g,e[d++]=u.b,e[d]=u.a}}},8511:(e,t)=>{const n="[0-9]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const s="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+")(?:.|[\r\n]))+";t.KANJI=new RegExp(r,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(s,"g"),t.NUMERIC=new RegExp(n,"g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const i=new RegExp("^"+r+"$"),a=new RegExp("^"+n+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return i.test(e)},t.testNumeric=function(e){return a.test(e)},t.testAlphanumeric=function(e){return o.test(e)}},8697:(e,t,n)=>{const r=n(7421);function s(e){this.mode=r.BYTE,this.data="string"===typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}s.getBitsLength=function(e){return 8*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},e.exports=s},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8970:(e,t,n)=>{const r=n(6116),s=n(4772),i=n(2182),a=n(5487);function o(e,t,n,i,a){const o=[].slice.call(arguments,1),l=o.length,c="function"===typeof o[l-1];if(!c&&!r())throw new Error("Callback required as last argument");if(!c){if(l<1)throw new Error("Too few arguments provided");return 1===l?(n=t,t=i=void 0):2!==l||t.getContext||(i=n,n=t,t=void 0),new Promise(function(r,a){try{const a=s.create(n,i);r(e(a,t,i))}catch(o){a(o)}})}if(l<2)throw new Error("Too few arguments provided");2===l?(a=n,n=t,t=i=void 0):3===l&&(t.getContext&&"undefined"===typeof a?(a=i,i=void 0):(a=i,i=n,n=t,t=void 0));try{const r=s.create(n,i);a(null,e(r,t,i))}catch(d){a(d)}}t.create=s.create,t.toCanvas=o.bind(null,i.render),t.toDataURL=o.bind(null,i.renderToDataURL),t.toString=o.bind(null,function(e,t,n){return a.render(e,n)})},9021:(e,t,n)=>{const r=n(7969).getSymbolSize;t.getPositions=function(e){const t=r(e);return[[0,0],[t-7,0],[0,t-7]]}},9379:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(4980);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}},9382:(e,t,n)=>{const r=n(7969).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,n=r(e),s=145===n?26:2*Math.ceil((n-13)/(2*t-2)),i=[n-7];for(let r=1;r<t-1;r++)i[r]=i[r-1]-s;return i.push(6),i.reverse()},t.getPositions=function(e){const n=[],r=t.getRowColCoords(e),s=r.length;for(let t=0;t<s;t++)for(let e=0;e<s;e++)0===t&&0===e||0===t&&e===s-1||t===s-1&&0===e||n.push([r[t],r[e]]);return n}},9606:(e,t,n)=>{"use strict";n.d(t,{h1:()=>o,uA:()=>s});var r=n(1776);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const i="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===i?void 0:s),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(a){}var s;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},9642:(e,t,n)=>{const r=n(7421),s=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(e){this.mode=r.ALPHANUMERIC,this.data=e}i.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=45*s.indexOf(this.data[t]);n+=s.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(s.indexOf(this.data[t]),6)},e.exports=i}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(i,a),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+"."+{239:"afcaabc9",455:"2663e77c",977:"dbff986b"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="grocery-erp-react:";n.l=(r,s,i,a)=>{if(e[r])e[r].push(s);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+i){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+i),o.src=r),e[r]=[s];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(m);var s=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(e=>e(n)),t)return t(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="public/",(()=>{var e={792:0};n.f.j=(t,r)=>{var s=n.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var i=new Promise((n,r)=>s=e[t]=[n,r]);r.push(s[2]=i);var a=n.p+n.u(t),o=new Error;n.l(a,r=>{if(n.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,s[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var s,i,[a,o,l]=r,c=0;if(a.some(t=>0!==e[t])){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)l(n)}for(t&&t(r);c<a.length;c++)i=a[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkgrocery_erp_react=self.webpackChunkgrocery_erp_react||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e,t=n(5043),r=n.t(t,2),s=n(4391),i=n(8050),a=n(9379);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const l="popstate";function c(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function d(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,n,r){return void 0===n&&(n=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?f(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function f(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function p(t,n,r,s){void 0===s&&(s={});let{window:i=document.defaultView,v5Compat:a=!1}=s,d=i.history,f=e.Pop,p=null,g=x();function x(){return(d.state||{idx:null}).idx}function y(){f=e.Pop;let t=x(),n=null==t?null:t-g;g=t,p&&p({action:f,location:w.location,delta:n})}function b(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:m(e);return n=n.replace(/ $/,"%20"),c(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,d.replaceState(o({},d.state,{idx:g}),""));let w={get action(){return f},get location(){return t(i,d)},listen(e){if(p)throw new Error("A history only accepts one active listener");return i.addEventListener(l,y),p=e,()=>{i.removeEventListener(l,y),p=null}},createHref:e=>n(i,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){f=e.Push;let s=h(w.location,t,n);r&&r(s,t),g=x()+1;let o=u(s,g),l=w.createHref(s);try{d.pushState(o,"",l)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;i.location.assign(l)}a&&p&&p({action:f,location:w.location,delta:1})},replace:function(t,n){f=e.Replace;let s=h(w.location,t,n);r&&r(s,t),g=x();let i=u(s,g),o=w.createHref(s);d.replaceState(i,"",o),a&&p&&p({action:f,location:w.location,delta:0})},go:e=>d.go(e)};return w}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function x(e,t,n){return void 0===n&&(n="/"),y(e,t,n,!1)}function y(e,t,n,r){let s=D(("string"===typeof t?f(t):t).pathname||"/",n);if(null==s)return null;let i=b(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=k(s);a=T(i[o],e,r)}return a}function b(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let s=(e,s,i)=>{let a={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};a.relativePath.startsWith("/")&&(c(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let o=M([r,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(c(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),b(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:E(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of w(e.path))s(e,t,r);else s(e,t)}),t}function w(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return s?[i,""]:[i];let a=w(r.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),s&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const v=/^:[\w-]+$/,N=3,S=2,A=1,_=10,C=-2,I=e=>"*"===e;function E(e,t){let n=e.split("/"),r=n.length;return n.some(I)&&(r+=C),t&&(r+=S),n.filter(e=>!I(e)).reduce((e,t)=>e+(v.test(t)?N:""===t?A:_),r)}function T(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,s={},i="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],l=o===r.length-1,c="/"===i?t:t.slice(i.length)||"/",d=j({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!d&&l&&n&&!r[r.length-1].route.index&&(d=j({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(s,d.params),a.push({params:s,pathname:M([i,d.pathname]),pathnameBase:F(M([i,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(i=M([i,d.pathnameBase]))}return a}function j(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":""!==e&&"/"!==e&&(s+="(?:(?=\\/|$))");let i=new RegExp(s,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1),l=r.reduce((e,t,n)=>{let{paramName:r,isOptional:s}=t;if("*"===r){let e=o[n]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=s&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{});return{params:l,pathname:i,pathnameBase:a,pattern:e}}function k(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function D(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function P(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function R(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function O(e,t){let n=R(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function L(e,t,n,r){let s;void 0===r&&(r=!1),"string"===typeof e?s=f(e):(s=o({},e),c(!s.pathname||!s.pathname.includes("?"),P("?","pathname","search",s)),c(!s.pathname||!s.pathname.includes("#"),P("#","pathname","hash",s)),c(!s.search||!s.search.includes("#"),P("#","search","hash",s)));let i,a=""===e||""===s.pathname,l=a?"/":s.pathname;if(null==l)i=n;else{let e=t.length-1;if(!r&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}i=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:s=""}="string"===typeof e?f(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:B(r),hash:U(s)}}(s,i),u=l&&"/"!==l&&l.endsWith("/"),h=(a||"."===l)&&n.endsWith("/");return d.pathname.endsWith("/")||!u&&!h||(d.pathname+="/"),d}const M=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),B=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function z(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],H=(new Set(q),["get",...q]);new Set(H),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}const W=t.createContext(null);const G=t.createContext(null);const Y=t.createContext(null);const X=t.createContext(null);const Q=t.createContext({outlet:null,matches:[],isDataRoute:!1});const K=t.createContext(null);function Z(){return null!=t.useContext(X)}function J(){return Z()||c(!1),t.useContext(X).location}function $(e){t.useContext(Y).static||t.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=t.useContext(Q);return e?function(){let{router:e}=de(le.UseNavigateStable),n=he(ce.UseNavigateStable),r=t.useRef(!1);$(()=>{r.current=!0});let s=t.useCallback(function(t,s){void 0===s&&(s={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,V({fromRouteId:n},s)))},[e,n]);return s}():function(){Z()||c(!1);let e=t.useContext(W),{basename:n,future:r,navigator:s}=t.useContext(Y),{matches:i}=t.useContext(Q),{pathname:a}=J(),o=JSON.stringify(O(i,r.v7_relativeSplatPath)),l=t.useRef(!1);$(()=>{l.current=!0});let d=t.useCallback(function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof t)return void s.go(t);let i=L(t,JSON.parse(o),a,"path"===r.relative);null==e&&"/"!==n&&(i.pathname="/"===i.pathname?n:M([n,i.pathname])),(r.replace?s.replace:s.push)(i,r.state,r)},[n,s,o,a,e]);return d}()}const te=t.createContext(null);function ne(n,r,s,i){Z()||c(!1);let{navigator:a}=t.useContext(Y),{matches:o}=t.useContext(Q),l=o[o.length-1],d=l?l.params:{},u=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let h,m=J();if(r){var p;let e="string"===typeof r?f(r):r;"/"===u||(null==(p=e.pathname)?void 0:p.startsWith(u))||c(!1),h=e}else h=m;let g=h.pathname||"/",y=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=x(n,{pathname:y});let w=oe(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:M([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,s,i);return r&&w?t.createElement(X.Provider,{value:{location:V({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},w):w}function re(){let e=function(){var e;let n=t.useContext(K),r=ue(ce.UseRouteError),s=he(ce.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[s]}(),n=z(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:i},r):null,null)}const se=t.createElement(re,null);class ie extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(Q.Provider,{value:this.props.routeContext},t.createElement(K.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ae(e){let{routeContext:n,match:r,children:s}=e,i=t.useContext(W);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(Q.Provider,{value:n},s)}function oe(e,n,r,s){var i;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===s&&(s=null),null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=s)&&a.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let o=e,l=null==(i=r)?void 0:i.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||c(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(r&&s&&s.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=r,s=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||s){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,s,i)=>{let a,c=!1,h=null,m=null;var f;r&&(a=l&&s.route.id?l[s.route.id]:void 0,h=s.route.errorElement||se,d&&(u<0&&0===i?(f="route-fallback",!1||me[f]||(me[f]=!0),c=!0,m=null):u===i&&(c=!0,m=s.route.hydrateFallbackElement||null)));let p=n.concat(o.slice(0,i+1)),g=()=>{let n;return n=a?h:c?m:s.route.Component?t.createElement(s.route.Component,null):s.route.element?s.route.element:e,t.createElement(ae,{match:s,routeContext:{outlet:e,matches:p,isDataRoute:null!=r},children:n})};return r&&(s.route.ErrorBoundary||s.route.errorElement||0===i)?t.createElement(ie,{location:r.location,revalidation:r.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()},null)}var le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(le||{}),ce=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ce||{});function de(e){let n=t.useContext(W);return n||c(!1),n}function ue(e){let n=t.useContext(G);return n||c(!1),n}function he(e){let n=function(){let e=t.useContext(Q);return e||c(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||c(!1),r.route.id}const me={};function fe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function pe(e){let{to:n,replace:r,state:s,relative:i}=e;Z()||c(!1);let{future:a,static:o}=t.useContext(Y),{matches:l}=t.useContext(Q),{pathname:d}=J(),u=ee(),h=L(n,O(l,a.v7_relativeSplatPath),d,"path"===i),m=JSON.stringify(h);return t.useEffect(()=>u(JSON.parse(m),{replace:r,state:s,relative:i}),[u,m,i,r,s]),null}function ge(e){return function(e){let n=t.useContext(Q).outlet;return n?t.createElement(te.Provider,{value:e},n):n}(e.context)}function xe(e){c(!1)}function ye(n){let{basename:r="/",children:s=null,location:i,navigationType:a=e.Pop,navigator:o,static:l=!1,future:d}=n;Z()&&c(!1);let u=r.replace(/^\/*/,"/"),h=t.useMemo(()=>({basename:u,navigator:o,static:l,future:V({v7_relativeSplatPath:!1},d)}),[u,d,o,l]);"string"===typeof i&&(i=f(i));let{pathname:m="/",search:p="",hash:g="",state:x=null,key:y="default"}=i,b=t.useMemo(()=>{let e=D(m,u);return null==e?null:{location:{pathname:e,search:p,hash:g,state:x,key:y},navigationType:a}},[u,m,p,g,x,y,a]);return null==b?null:t.createElement(Y.Provider,{value:h},t.createElement(X.Provider,{children:s,value:b}))}function be(e){let{children:t,location:n}=e;return ne(we(t),n)}new Promise(()=>{});t.Component;function we(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,s)=>{if(!t.isValidElement(e))return;let i=[...n,s];if(e.type===t.Fragment)return void r.push.apply(r,we(e.props.children,i));e.type!==xe&&c(!1),e.props.index&&e.props.children&&c(!1);let a={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=we(e.props.children,i)),r.push(a)}),r}var ve=n(3637),Ne=n(736),Se=n(3862),Ae=n(1337),_e=n(3986),Ce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ie=["color","size","strokeWidth","absoluteStrokeWidth","children"];var Ee=(e,n)=>{const r=(0,t.forwardRef)((r,s)=>{let{color:i="currentColor",size:o=24,strokeWidth:l=2,absoluteStrokeWidth:c,children:d}=r,u=(0,_e.A)(r,Ie);return(0,t.createElement)("svg",(0,a.A)((0,a.A)({ref:s},Ce),{},{width:o,height:o,stroke:i,strokeWidth:c?24*Number(l)/Number(o):l,className:"lucide lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))},u),[...n.map(e=>{let[n,r]=e;return(0,t.createElement)(n,r)}),...(Array.isArray(d)?d:[d])||[]]);var h});return r.displayName="".concat(e),r};const Te=Ee("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),je=Ee("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ke=Ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),De=Ee("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var Pe=n(579);const Re=()=>{const{dispatch:e,state:n}=(0,i.nm)(),r=ee(),s="".concat("public","/assets/drag-and-drop-logo.jpg"),[o,l]=(0,t.useState)(""),[c,d]=(0,t.useState)(!1),u=(0,t.useRef)(!1),[h,m]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{const o=await(0,ve.Q4)(Ne.auth);if(o&&o.user){const g=o.user;try{let o;console.log("\ud83d\udd10 ATTEMPTING AUTHENTICATION FOR:",g.email),console.log("\ud83d\udce7 Email:",g.email),console.log("\ud83c\udd94 UID:",g.uid),console.log("\ud83d\udc64 Display Name:",g.displayName),console.log("\ud83d\udd0d STARTING INTELLIGENT AUTHENTICATION"),console.log("\ud83d\udc64 STEP 1: ABOUT TO CALL getStaffAuth");try{console.log("\ud83d\udcde Calling getStaffAuth with params:",{email:g.email,uid:g.uid,displayName:g.displayName,photoURL:g.photoURL}),o=await(0,Se.getStaffAuth)(g.email,g.uid,g.displayName,g.photoURL),console.log("\ud83d\udccb STAFF AUTH RESULT RECEIVED:",o)}catch(u){console.error("\ud83d\udca5 STAFF AUTH THREW EXCEPTION:",u),o={success:!1,error:"Staff auth exception: ".concat(u.message)}}let p="staff";if(o.success)console.log("\u2705 STAFF AUTH SUCCESS - LOGGING IN AS STAFF");else{console.log("\u274c STAFF AUTH FAILED - TRYING SELLER AUTH"),console.log("Staff auth error:",o.error),console.log("\ud83c\udfea STEP 2: ABOUT TO CALL getSellerId");try{if(o=await(0,Se.Pb)(g.email,g.uid,g.displayName,g.photoURL),console.log("\ud83d\udccb SELLER AUTH RESULT RECEIVED:",o),p="seller",o.success)console.log("\u2705 SELLER AUTH SUCCESS - LOGGING IN AS EXISTING SELLER");else{console.log("\u274c SELLER AUTH FAILED - NO EXISTING ACCOUNT FOUND"),console.log("Seller auth error:",o.error),console.log("\ud83d\udcdd STEP 3: USER IS NEITHER STAFF NOR SELLER - AUTO-REGISTERING AS SELLER");try{console.log("\ud83d\udd04 CALLING SELLER REGISTRATION API");const t=g.email.split("@")[0],n={email:g.email,uid:g.uid,displayName:g.displayName,photoURL:g.photoURL,name:g.displayName||t,phoneNumber:"",shopName:"".concat(g.displayName||t,"'s Store"),businessAddress:"",city:"",state:"",pincode:"",gstNumber:"",businessType:"Retail",lowStockThreshold:10,expiryDaysThreshold:7},s=await fetch("".concat("http://localhost:5000","/auth/seller/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(s.ok){const t=await s.json();console.log("\u2705 SELLER AUTO-REGISTRATION SUCCESSFUL:",t);const n={sellerId:t.seller._id,seller:t.seller,userType:"seller",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(n)),e({type:"LOGIN",payload:{currentUser:t.seller,sellerId:t.seller._id,userType:"seller"}}),t.planDetails&&(e({type:i.ActionTypes.SET_CURRENT_PLAN_DETAILS,payload:t.planDetails}),t.planDetails.planId&&e({type:i.ActionTypes.SET_CURRENT_PLAN,payload:t.planDetails.planId}),"boolean"===typeof t.planDetails.isExpired&&e({type:i.ActionTypes.SET_SUBSCRIPTION_ACTIVE,payload:!t.planDetails.isExpired})),void r("/dashboard",{state:{message:"Welcome! Your seller account has been created automatically.",isNewRegistration:!0}})}{console.error("\u274c SELLER AUTO-REGISTRATION FAILED");const e=await s.json().catch(()=>({}));return l("Registration failed: ".concat(e.message||"Unknown error")),void Ne.auth.signOut().catch(console.error)}}catch(h){return console.error("\ud83d\udca5 REGISTRATION EXCEPTION:",h),l("Failed to create seller account. Please try again."),void Ne.auth.signOut().catch(console.error)}}}catch(m){return console.error("\ud83d\udca5 SELLER AUTH THREW EXCEPTION:",m),l("Authentication failed due to technical error. Please try again."),void Ne.auth.signOut().catch(console.error)}}if(o.success){var t;console.log("\u2705 ".concat("seller"===p?"Seller":"Staff"," received from backend:"),o[p]),console.log("\ud83d\udd0d Full authResult for debugging:",o);const s=(0,a.A)((0,a.A)({username:g.displayName||g.email||"User",photoURL:g.photoURL,uid:g.uid,userType:p},o[p]),"staff"===p&&{sellerId:(null===(t=o.seller)||void 0===t?void 0:t._id)||o.sellerId,seller:o.seller});if(console.log("\ud83d\udce4 Dispatching LOGIN with payload:",s),console.log("  - userType:",s.userType),console.log("  - name:",s.name),"seller"===p)console.log("  - shopName:",s.shopName),console.log("  - phoneNumber:",s.phoneNumber),console.log("  - city:",s.city);else if("staff"===p){var n;console.log("  - sellerId:",s.sellerId),console.log("  - seller:",s.seller),console.log("  - authResult.seller:",o.seller),console.log("  - authResult.seller._id:",null===(n=o.seller)||void 0===n?void 0:n._id),console.log("  \u2705 Staff will access seller data using sellerId:",s.sellerId)}else"staff"===p&&(console.log("  - sellerId:",s.sellerId),console.log("  - permissions:",s.permissions));try{e({type:"LOGIN",payload:s}),console.log("\u2705 LOGIN action dispatched successfully"),console.log("\ud83c\udfe0 Navigating ".concat(p," to dashboard")),r("/dashboard")}catch(f){return console.error("\ud83d\udca5 Error dispatching LOGIN:",f),l("Login failed due to technical error. Please try again."),void Ne.auth.signOut().catch(console.error)}}else if(403===o.status)console.warn("Access denied: Account is inactive"),l(o.error||"Your account has been deactivated. Please contact administrator."),Ne.auth.signOut().catch(console.error);else if(503===o.status)console.error("Database connection unavailable"),l(o.error||"Database connection unavailable. Please try again later."),Ne.auth.signOut().catch(console.error);else{var s,c,d;console.error("Backend verification failed:",o.error);let e="Unable to verify your account. Please try again or contact support.";null!==(s=o.error)&&void 0!==s&&s.includes("Seller account not found")?e="Authentication failed. Please try again or contact support.":null!==(c=o.error)&&void 0!==c&&c.includes("Staff account not found")?e="Staff account not found or inactive. Please ensure you have completed the signup process using the invite link from your seller. If the issue persists, contact your seller.":null!==(d=o.error)&&void 0!==d&&d.includes("Seller account is inactive")&&(e="Your seller account has been deactivated. Please contact your seller or administrator."),l(e),Ne.auth.signOut().catch(console.error)}}catch(p){console.error("Backend auth error:",p),Ne.auth.signOut().catch(console.error)}}}catch(o){console.error("Error checking redirect result:",o)}})()},[e]);(0,t.useEffect)(()=>{let t=null,s=!0;return(async()=>{try{if(await Ne.auth.authStateReady(),!s)return;const c=async t=>{if(!t)return;const s=localStorage.getItem("auth");let c=!1;if(s)try{var d;const e=JSON.parse(s);c="staff"===(null===(d=e.currentUser)||void 0===d?void 0:d.userType)}catch(g){c=!0}if(!c&&n.isAuthenticated&&n.currentUser&&n.currentUser.email===t.email)console.log("\ud83d\udc64 User already authenticated with fresh permissions, skipping handleUserLogin");else{c&&console.log("\ud83d\udd04 STAFF USER - REFRESHING PERMISSIONS FROM SERVER for:",t.email),console.log("\ud83d\udd04 handleUserLogin called for user:",t.email,"- REFRESHING PERMISSIONS FROM SERVER"),console.log("\ud83d\udccb Following intelligent authentication flow (staff first, then seller)");try{let n;console.log("\ud83d\udd10 INTELLIGENT AUTHENTICATION IN handleUserLogin"),console.log("\ud83d\udce7 Email:",t.email),console.log("\ud83c\udd94 UID:",t.uid),console.log("\ud83d\udc64 STEP 1: Checking for existing staff account...");try{n=await(0,Se.getStaffAuth)(t.email,t.uid,t.displayName,t.photoURL),console.log("\ud83d\udccb STAFF AUTH RESULT RECEIVED:",n)}catch(x){console.error("\ud83d\udca5 STAFF AUTH THREW EXCEPTION:",x),n={success:!1,error:"Staff auth exception: ".concat(x.message)}}let s="staff";if(n.success)console.log("\u2705 STAFF AUTH SUCCESS - LOGGING IN AS STAFF");else{console.log("\u274c STAFF AUTH FAILED - TRYING SELLER AUTH"),console.log("Staff auth error:",n.error);try{if(n=await(0,Se.Pb)(t.email,t.uid,t.displayName,t.photoURL),console.log("\ud83d\udccb SELLER AUTH RESULT RECEIVED:",n),s="seller",n.success)console.log("\u2705 SELLER AUTH SUCCESS - LOGGING IN AS EXISTING SELLER");else{console.log("\u274c SELLER AUTH FAILED - NO EXISTING ACCOUNT FOUND"),console.log("Seller auth error:",n.error),console.log("\ud83d\udcdd STEP 3: USER IS NEITHER STAFF NOR SELLER - AUTO-REGISTERING AS SELLER");try{console.log("\ud83d\udd04 CALLING SELLER REGISTRATION API");const n=t.email.split("@")[0],s={email:t.email,uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,name:t.displayName||n,phoneNumber:"",shopName:"".concat(t.displayName||n,"'s Store"),businessAddress:"",city:"",state:"",pincode:"",gstNumber:"",businessType:"Retail",lowStockThreshold:10,expiryDaysThreshold:7},a=await fetch("".concat("http://localhost:5000","/auth/seller/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const t=await a.json();console.log("\u2705 SELLER AUTO-REGISTRATION SUCCESSFUL:",t);const n={sellerId:t.seller._id,seller:t.seller,userType:"seller",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(n)),e({type:"LOGIN",payload:{currentUser:t.seller,sellerId:t.seller._id,userType:"seller"}}),t.planDetails&&(e({type:i.ActionTypes.SET_CURRENT_PLAN_DETAILS,payload:t.planDetails}),t.planDetails.planId&&e({type:i.ActionTypes.SET_CURRENT_PLAN,payload:t.planDetails.planId}),"boolean"===typeof t.planDetails.isExpired&&e({type:i.ActionTypes.SET_SUBSCRIPTION_ACTIVE,payload:!t.planDetails.isExpired})),void r("/dashboard",{state:{message:"Welcome! Your seller account has been created automatically.",isNewRegistration:!0}})}{console.error("\u274c SELLER AUTO-REGISTRATION FAILED");const e=await a.json().catch(()=>({}));return l("Registration failed: ".concat(e.message||"Unknown error")),void Ne.auth.signOut().catch(console.error)}}catch(y){return console.error("\ud83d\udca5 REGISTRATION EXCEPTION:",y),l("Failed to create seller account. Please try again."),void Ne.auth.signOut().catch(console.error)}}}catch(b){return console.error("\ud83d\udca5 SELLER AUTH THREW EXCEPTION:",b),l("Authentication failed due to technical error. Please try again."),void Ne.auth.signOut().catch(console.error)}}if(n.success){var u,h,m;if(console.log("\u2705 ".concat("seller"===s?"Seller":"Staff"," received from backend:"),n[s]),"seller"===s)console.log("\ud83d\udd0d Seller profileCompleted status:",null===(h=n.seller)||void 0===h?void 0:h.profileCompleted),console.log("\ud83d\udd0d Seller data keys:",Object.keys(n.seller||{}));if("staff"===s)console.log("\ud83d\udd04 STAFF PERMISSIONS REFRESHED FROM SERVER:",n.staff.permissions),console.log("\ud83c\udfea Associated seller:",null===(m=n.seller)||void 0===m?void 0:m.name);console.log("\ud83d\udd0d Full authResult for debugging:",n);const i=(0,a.A)((0,a.A)({username:t.displayName||t.email||"User",photoURL:t.photoURL,uid:t.uid,userType:s},n[s]),"staff"===s&&{sellerId:(null===(u=n.seller)||void 0===u?void 0:u._id)||n.sellerId,seller:n.seller});if(console.log("\ud83d\udce4 Dispatching LOGIN with payload:",i),console.log("  - userType:",i.userType),console.log("  - name:",i.name),"seller"===s)console.log("  - shopName:",i.shopName),console.log("  - phoneNumber:",i.phoneNumber),console.log("  - city:",i.city);else if("staff"===s){var f;console.log("  - sellerId:",i.sellerId),console.log("  - seller:",i.seller),console.log("  - authResult.seller:",n.seller),console.log("  - authResult.seller._id:",null===(f=n.seller)||void 0===f?void 0:f._id),console.log("  \u2705 Staff will access seller data using sellerId:",i.sellerId)}else"staff"===s&&(console.log("  - sellerId:",i.sellerId),console.log("  - permissions:",i.permissions));if("staff"===s&&n.staff.permissions)try{var p;console.log("\ud83d\udcbe Saving staff permissions to IndexedDB for offline access"),await(0,Ae.saveStaffPermissions)(n.staff._id,n.staff.permissions,(null===(p=n.seller)||void 0===p?void 0:p._id)||n.sellerId),console.log("\u2705 Staff permissions saved to IndexedDB")}catch(o){console.error("\u274c Failed to save staff permissions to IndexedDB:",o)}e({type:"LOGIN",payload:i}),console.log("\ud83c\udfe0 Navigating ".concat(s," to dashboard")),r("/dashboard")}else console.log("\u274c Authentication failed"),console.log("Auth result error:",n.error),l(n.error||"Authentication failed. Please try again."),Ne.auth.signOut().catch(console.error)}catch(o){console.error("Error during intelligent authentication:",o),l("Authentication failed. Please try again."),Ne.auth.signOut().catch(console.error)}}};Ne.auth.currentUser&&(console.log("\ud83d\udd04 PAGE LOAD - Checking authentication for:",Ne.auth.currentUser.email),await c(Ne.auth.currentUser)),t=Ne.auth.onAuthStateChanged(async e=>{s&&e&&(console.log("\ud83d\udd04 AUTH STATE CHANGE - Processing user:",e.email),await c(e))})}catch(o){console.error("Error setting up auth state listener:",o)}})(),()=>{s=!1,t&&t()}},[e]);return(0,Pe.jsxs)("div",{className:"relative min-h-screen overflow-hidden",style:{background:"radial-gradient(circle at top left, rgba(242, 244, 255, 0.95), rgba(237, 241, 255, 0.9)), linear-gradient(135deg, #f8fafc 0%, #eef2ff 35%, #e2e8f0 100%)"},children:[(0,Pe.jsxs)("div",{className:"pointer-events-none absolute inset-0",children:[(0,Pe.jsx)("div",{className:"absolute -top-24 -left-24 h-[40vh] w-[40vh] rounded-full bg-[#2F3C7E]/5 blur-3xl"}),(0,Pe.jsx)("div",{className:"absolute bottom-0 right-0 h-[40vh] w-[40vh] rounded-full bg-white/50 blur-3xl"})]}),(0,Pe.jsxs)("div",{className:"relative z-10 mx-auto flex min-h-screen w-full max-w-6xl flex-col-reverse gap-8 px-0 pb-12 pt-8 sm:px-6 lg:flex-row lg:items-center lg:justify-center lg:gap-16 lg:px-8 lg:pb-14 lg:pt-12",children:[(0,Pe.jsx)("section",{className:"flex flex-1 flex-col justify-center px-6 sm:px-0",children:(0,Pe.jsx)("div",{className:"mx-auto w-full max-w-xl space-y-8",children:(0,Pe.jsxs)("div",{className:"space-y-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-4xl font-semibold leading-tight text-slate-900 sm:text-5xl sm:leading-tight",children:"All-in-one retail management platform"}),(0,Pe.jsx)("p",{className:"mt-4 text-lg text-slate-600",children:"Billing, inventory, and analytics in one place. Start selling smarter today."})]}),(0,Pe.jsx)("div",{className:"space-y-4 pt-4",children:[{icon:Te,title:"Secure & Reliable",body:"Google-secured authentication with enterprise-grade security."},{icon:je,title:"Real-time Analytics",body:"Live KPIs and insights to make data-driven decisions."},{icon:ke,title:"Works Offline",body:"Continue selling even when internet is down. Auto-syncs when back online."}].map(e=>{let{icon:t,title:n,body:r}=e;return(0,Pe.jsxs)("div",{className:"flex items-start gap-4",children:[(0,Pe.jsx)("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl",style:{backgroundColor:"rgba(47, 60, 126, 0.08)",color:"#2F3C7E"},children:(0,Pe.jsx)(t,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-base font-semibold text-slate-900",children:n}),(0,Pe.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:r})]})]},n)})})]})})}),(0,Pe.jsx)("section",{className:"flex flex-1 items-center justify-center",children:(0,Pe.jsxs)("div",{className:"w-full sm:max-w-md rounded-2xl border border-[#2F3C7E]/20 bg-white p-8 sm:p-10 shadow-lg",children:[(0,Pe.jsxs)("div",{className:"space-y-6 text-center",children:[(0,Pe.jsx)("div",{className:"mx-auto flex h-20 w-22 items-center justify-center rounded-2xl bg-transparent overflow-hidden",children:(0,Pe.jsx)("img",{src:s,alt:"Drag & Drop",className:"h-40 w-40 object-cover",onError:e=>{e.currentTarget.src="".concat("public","/assets/drag-drop-logo.png")}})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-2xl font-semibold text-slate-900",children:"Welcome back"}),(0,Pe.jsx)("p",{className:"mt-2 text-sm text-slate-500",children:"Sign in to access your dashboard"})]})]}),(0,Pe.jsx)("button",{onClick:async()=>{if(!c&&!u.current)try{if(u.current=!0,d(!0),l(""),!Ne.auth||!Ne.hJ)throw new Error("Firebase authentication is not properly initialized");try{await Ne.auth.authStateReady()}catch(t){console.warn("Auth state ready warning:",t)}const o=(0,ve.df)(Ne.auth,Ne.hJ),c=new Promise((e,t)=>setTimeout(()=>t(new Error("Sign-in timeout")),6e4)),h=(await Promise.race([o,c])).user;let m;console.log("\ud83d\udd0d STARTING GOOGLE SIGN-IN AUTHENTICATION"),console.log("\ud83d\udc64 STEP 1: CHECKING IF USER IS STAFF");let f="unknown";try{if(m=await(0,Se.getStaffAuth)(h.email,h.uid,h.displayName,h.photoURL),console.log("\ud83d\udccb STAFF AUTH RESULT:",m),m.success){console.log("\u2705 USER IS STAFF - LOGGING IN"),f="staff";const t={sellerId:m.sellerId,seller:m.seller,userType:"staff",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(t)),e({type:"LOGIN",payload:{currentUser:m.staff,sellerId:m.sellerId,userType:"staff"}}),void r("/dashboard")}}catch(n){console.error("\ud83d\udca5 STAFF AUTH EXCEPTION:",n)}console.log("\ud83c\udfea STEP 2: CHECKING IF USER IS SELLER (not staff)");try{if(m=await(0,Se.Pb)(h.email,h.uid,h.displayName,h.photoURL),console.log("\ud83d\udccb SELLER AUTH RESULT:",m),m.success){if(console.log("\u2705 USER IS SELLER - LOGGING IN"),m.isNewSeller){console.log("\ud83c\udd95 NEW SELLER ACCOUNT CREATED - REDIRECTING TO DASHBOARD WITH WELCOME");const t={sellerId:m.sellerId,seller:m.seller,userType:"seller",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(t)),e({type:"LOGIN",payload:{currentUser:m.seller,sellerId:m.sellerId,userType:"seller"}}),void r("/dashboard",{state:{message:"Welcome! Your seller account has been created automatically.",isNewRegistration:!0}})}{console.log("\ud83d\udc64 EXISTING SELLER - NORMAL LOGIN");const t={sellerId:m.sellerId,seller:m.seller,userType:"seller",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(t)),e({type:"LOGIN",payload:{currentUser:m.seller,sellerId:m.sellerId,userType:"seller"}}),void r("/dashboard")}}}catch(s){console.error("\ud83d\udca5 SELLER AUTH EXCEPTION:",s)}console.log("\ud83d\udcdd STEP 3: USER IS NEITHER STAFF NOR SELLER - AUTO-REGISTERING AS SELLER");try{console.log("\ud83d\udd04 CALLING SELLER REGISTRATION API");const t={email:h.email,uid:h.uid,displayName:h.displayName,photoURL:h.photoURL,name:h.displayName||h.email.split("@")[0],phoneNumber:"",shopName:"".concat(h.displayName||h.email.split("@")[0],"'s Store"),businessAddress:"",city:"",state:"",pincode:"",gstNumber:"",businessType:"Retail",lowStockThreshold:10,expiryDaysThreshold:7},n=await fetch("".concat("http://localhost:5000","/auth/seller/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const t=await n.json();console.log("\u2705 SELLER AUTO-REGISTRATION SUCCESSFUL:",t);const s={sellerId:t.seller._id,seller:t.seller,userType:"seller",loginTime:(new Date).toISOString()};return localStorage.setItem("auth",JSON.stringify(s)),e({type:"LOGIN",payload:{currentUser:t.seller,sellerId:t.seller._id,userType:"seller"}}),t.planDetails&&(e({type:i.ActionTypes.SET_CURRENT_PLAN_DETAILS,payload:t.planDetails}),t.planDetails.planId&&e({type:i.ActionTypes.SET_CURRENT_PLAN,payload:t.planDetails.planId}),"boolean"===typeof t.planDetails.isExpired&&e({type:i.ActionTypes.SET_SUBSCRIPTION_ACTIVE,payload:!t.planDetails.isExpired})),void r("/dashboard",{state:{message:"Welcome! Your seller account has been created automatically.",isNewRegistration:!0}})}{console.error("\u274c SELLER AUTO-REGISTRATION FAILED");const e=await n.json().catch(()=>({}));return l("Registration failed: ".concat(e.message||"Unknown error")),void Ne.auth.signOut().catch(console.error)}}catch(a){return console.error("\ud83d\udca5 REGISTRATION EXCEPTION:",a),l("Failed to create seller account. Please try again."),void Ne.auth.signOut().catch(console.error)}}catch(o){console.error("Google sign in error:",o);let t="Failed to sign in with Google";if("auth/popup-closed-by-user"===o.code)t="Sign-in popup was closed. Please try again.";else if("auth/popup-blocked"===o.code){t="Popup was blocked. Using redirect method instead...";try{return void await(0,ve.$2)(Ne.auth,Ne.hJ)}catch(h){t="Failed to sign in. Please allow popups or try again."}}else"auth/cancelled-popup-request"===o.code?t="Only one popup request is allowed at a time. Please wait and try again.":"auth/account-exists-with-different-credential"===o.code?t="An account with this email already exists.":"Sign-in timeout"===o.message?t="Sign-in took too long. Please try again.":o.message&&(t=o.message);l(t)}finally{d(!1),setTimeout(()=>{u.current=!1},1e3)}},disabled:c,className:"btn-primary mt-8 w-full py-3.5 px-4 text-sm",children:(0,Pe.jsx)("span",{className:"flex items-center justify-center gap-3",children:c?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white/30 border-t-white"}),(0,Pe.jsx)("span",{children:"Signing in\u2026"})]}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"Google logo",className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Continue with Google"})]})})}),o&&(0,Pe.jsx)("div",{className:"mt-6 rounded-xl border border-rose-400/40 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:o}),(0,Pe.jsx)("button",{onClick:async()=>{if(!f)try{p(!0),l("");const t=await fetch("".concat(Se.JR,"/auth/demo/razorpay"),{method:"POST",headers:{"Content-Type":"application/json"}}),n=await t.json();if(n.success&&n.seller){console.log("\u2705 Razorpay demo account logged in:",n.seller);const t=(0,a.A)((0,a.A)({username:"Razorpay Demo Account",photoURL:null,uid:"razorpay-demo-uid"},n.seller),{},{sellerId:n.seller._id});console.log("\ud83d\udce4 Dispatching LOGIN with demo payload:",t),e({type:"LOGIN",payload:t})}else l(n.message||"Failed to create demo account. Please try again.")}catch(t){console.error("Razorpay demo login error:",t),l("Failed to login to demo account. Please try again.")}finally{p(!1)}},disabled:f||c,className:"mt-4 w-full rounded-xl border border-orange-200 bg-gradient-to-r from-orange-50 to-orange-100 py-3 px-4 text-sm font-semibold text-orange-700 shadow-sm transition hover:from-orange-100 hover:to-orange-200 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:(0,Pe.jsx)("span",{className:"flex items-center justify-center gap-2",children:f?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-orange-700/20 border-t-orange-700"}),(0,Pe.jsx)("span",{children:"Logging in..."})]}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(De,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{children:"Razorpay Demo Account"})]})})}),(0,Pe.jsxs)("div",{className:"mt-6 space-y-3 text-center",children:[(0,Pe.jsx)("p",{className:"text-xs text-slate-400",children:"Your credentials stay with Google. We never see or store your password."}),(0,Pe.jsx)("button",{type:"button",onClick:()=>m(!0),className:"text-xs font-medium transition hover:opacity-80",style:{color:"#2F3C7E"},children:"Terms & Conditions"})]})]})})]}),h&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center px-4",children:(0,Pe.jsxs)("div",{className:"bg-white max-w-3xl w-full max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[(0,Pe.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Drag & Drop Terms & Conditions"}),(0,Pe.jsx)("button",{type:"button",onClick:()=>m(!1),className:"text-slate-500 hover:text-slate-700",children:"\u2715"})]}),(0,Pe.jsxs)("div",{className:"px-6 py-4 overflow-y-auto space-y-4 text-sm text-slate-700 max-h-[70vh]",children:[(0,Pe.jsx)("p",{children:"These Terms & Conditions govern your use of the Drag & Drop inventory management platform. By authenticating, you agree to comply with the following policies designed for retailers managing inventory, billing, and customer data."}),(0,Pe.jsxs)("ol",{className:"list-decimal list-inside space-y-3",children:[(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Account Responsibility."})," Each seller account is for a single business entity. You are responsible for safeguarding login credentials and restricting access to authorized team members only."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Data Accuracy."})," You agree to maintain accurate product, customer, and order information. Inventory adjustments, returns, and write-offs should be recorded promptly to keep analytics reliable."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Usage Limits & Plans."})," Plan quotas for customers, products, and orders are enforced automatically. When limits are reached, Drag & Drop may pause record creation, prompt you to upgrade, or stack an additional plan order, according to your configuration."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Billing & Payments."})," Paid plan charges are due in advance. Failed payments may result in a downgrade or suspension until the balance is cleared. All fees are non-refundable unless required by law."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Integrations & Automation."})," When enabling automations, webhooks, or third-party integrations, you are responsible for configuration and any resulting actions (for example, automated stock adjustments or notifications)."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Compliance & Security."})," You must comply with applicable laws regarding taxes, invoicing, and data privacy. Drag & Drop encrypts data in transit and at rest; however, you are responsible for securing devices that access the platform."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Prohibited Conduct."})," You may not misuse the platform to store unlawful content, interfere with system operations, or share access with competitors with the intent to reverse engineer or benchmark proprietary features."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Data Retention."})," Inventory, billing, and activity data are retained for the duration of your subscription. Upon cancellation, you may export records before the account is closed. Drag & Drop may retain anonymized usage metrics for product improvement."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Service Modifications."})," We may add, change, or sunset features with reasonable notice. Critical changes affecting plan limits or pricing will be communicated to account owners via email or in-app announcements."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Termination."})," Drag & Drop reserves the right to suspend or terminate accounts that violate these terms or present security risks. You may terminate at any time by contacting support; outstanding invoices remain payable."]})]}),(0,Pe.jsx)("p",{className:"text-xs text-slate-500",children:"By continuing to use Drag & Drop, you acknowledge that these Terms & Conditions may be updated from time to time. We will notify account owners of material changes. For questions, contact support@draganddrop.com."})]}),(0,Pe.jsx)("div",{className:"px-6 py-4 border-t border-slate-200 flex justify-end",children:(0,Pe.jsx)("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 rounded-lg bg-slate-900 text-white text-sm hover:bg-slate-800",children:"Close"})})]})})]})},Oe=Ee("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Le=Ee("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Me=Ee("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),Fe=Ee("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]),Be=Ee("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),Ue=Ee("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ze=Ee("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),qe=Ee("Truck",[["path",{d:"M10 17h4V5H2v12h3",key:"1jq12e"}],["path",{d:"M20 17h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5",key:"1xb3ft"}],["path",{d:"M14 17h1",key:"nufu4t"}],["circle",{cx:"7.5",cy:"17.5",r:"2.5",key:"a7aife"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),He=Ee("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Ve=Ee("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),We=Ee("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Ge=Ee("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Ye=Ee("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Xe=Ee("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Qe=Ee("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ke={en:{dashboard:"Dashboard",customers:"Customers",products:"Products",inventory:"Inventory",billing:"Billing",salesOrderHistory:"Sales Order History",purchaseOrders:"Purchase Orders",financial:"Financial",reports:"Reports",refunds:"Refunds",upgradePlan:"Upgrade Plan",settings:"Settings",add:"Add",edit:"Edit",delete:"Delete",save:"Save",cancel:"Cancel",search:"Search",total:"Total",quantity:"Quantity",price:"Price",name:"Name",phone:"Phone",email:"Email",address:"Address",stock:"Stock",lowStock:"Low Stock",expiringSoon:"Expiring Soon",notifications:"Notifications",noNotifications:"No notifications",billingSystem:"Billing System",createAndManageBills:"Create and manage customer bills",customerInformation:"Customer Information",selectCustomer:"Select Customer",useCustomCustomerName:"Use custom customer name",enterCustomerName:"Enter customer name",chooseCustomer:"Choose a customer",paymentMethod:"Payment Method",cash:"Cash",card:"Card",upi:"UPI",due:"Due (Credit)",addProducts:"Add Products",searchProducts:"Search products...",scanBarcode:"Scan Barcode",enterBarcodeManually:"Or enter barcode manually and press Enter...",billItems:"Bill Items",noItemsAdded:"No items added to bill yet",billSummary:"Bill Summary",subtotal:"Subtotal",discount:"Discount",tax:"Tax",generateBill:"Generate Bill",addToBill:"Add to Bill",addQuantity:"Add Quantity",product:"Product",unit:"Unit",pieces:"Pieces (pcs)",grams:"Grams (gm)",kilograms:"Kilograms (kg)",milliliters:"Milliliters (mL)",liters:"Liters (L)",boxes:"Boxes",packets:"Packets",bottles:"Bottles",lowStockAlert:"Low Stock Alert",expiringSoon:"Expiring Soon",isRunningLow:"is running low",unitsRemaining:"units remaining",expiresIn:"expires in",days:"days",billGeneratedSuccessfully:"Bill generated successfully!",pleaseAddItems:"Please add items to the bill",pleaseEnterCustomerName:"Please enter or select a customer name",lowStockWarning:"Low Stock Warning!",available:"Available",requested:"Requested",pleaseReduceQuantity:"Please reduce quantity to",orLess:"or less",stockError:"Stock Error!",cannotGenerateBill:"Cannot generate bill with insufficient stock",thankYouForBusiness:"Thank you for your business!",productNotFound:"Product not found with barcode",pleaseAddProductFirst:"Please add the product first or try again",lowStock:"Low Stock!",youCannotAddMore:"You cannot add more than"},hi:{dashboard:"\u0921\u0948\u0936\u092c\u094b\u0930\u094d\u0921",customers:"\u0917\u094d\u0930\u093e\u0939\u0915",products:"\u0909\u0924\u094d\u092a\u093e\u0926",inventory:"\u0907\u0928\u094d\u0935\u0947\u0902\u091f\u0930\u0940",billing:"\u092c\u093f\u0932\u093f\u0902\u0917",salesOrderHistory:"\u092c\u093f\u0915\u094d\u0930\u0940 \u0906\u0926\u0947\u0936 \u0907\u0924\u093f\u0939\u093e\u0938",purchaseOrders:"\u0916\u0930\u0940\u0926 \u0906\u0926\u0947\u0936",financial:"\u0935\u093f\u0924\u094d\u0924\u0940\u092f",reports:"\u0930\u093f\u092a\u094b\u0930\u094d\u091f\u094d\u0938",refunds:"\u0930\u093f\u092b\u0902\u0921",upgradePlan:"\u0905\u092a\u0917\u094d\u0930\u0947\u0921 \u092a\u094d\u0932\u093e\u0928",settings:"\u0938\u0947\u091f\u093f\u0902\u0917\u094d\u0938",add:"\u091c\u094b\u0921\u093c\u0947\u0902",edit:"\u0938\u0902\u092a\u093e\u0926\u093f\u0924 \u0915\u0930\u0947\u0902",delete:"\u0939\u091f\u093e\u090f\u0902",save:"\u0938\u0939\u0947\u091c\u0947\u0902",cancel:"\u0930\u0926\u094d\u0926 \u0915\u0930\u0947\u0902",search:"\u0916\u094b\u091c\u0947\u0902",total:"\u0915\u0941\u0932",quantity:"\u092e\u093e\u0924\u094d\u0930\u093e",price:"\u092e\u0942\u0932\u094d\u092f",name:"\u0928\u093e\u092e",phone:"\u092b\u094b\u0928",email:"\u0908\u092e\u0947\u0932",address:"\u092a\u0924\u093e",stock:"\u0938\u094d\u091f\u0949\u0915",lowStock:"\u0915\u092e \u0938\u094d\u091f\u0949\u0915",expiringSoon:"\u091c\u0932\u094d\u0926\u0940 \u0938\u092e\u093e\u092a\u094d\u0924 \u0939\u094b \u0930\u0939\u093e",notifications:"\u0938\u0942\u091a\u0928\u093e\u090f\u0902",noNotifications:"\u0915\u094b\u0908 \u0938\u0942\u091a\u0928\u093e \u0928\u0939\u0940\u0902",billingSystem:"\u092c\u093f\u0932\u093f\u0902\u0917 \u0938\u093f\u0938\u094d\u091f\u092e",createAndManageBills:"\u0917\u094d\u0930\u093e\u0939\u0915 \u092c\u093f\u0932 \u092c\u0928\u093e\u090f\u0902 \u0914\u0930 \u092a\u094d\u0930\u092c\u0902\u0927\u093f\u0924 \u0915\u0930\u0947\u0902",customerInformation:"\u0917\u094d\u0930\u093e\u0939\u0915 \u091c\u093e\u0928\u0915\u093e\u0930\u0940",selectCustomer:"\u0917\u094d\u0930\u093e\u0939\u0915 \u091a\u0941\u0928\u0947\u0902",useCustomCustomerName:"\u0915\u0938\u094d\u091f\u092e \u0917\u094d\u0930\u093e\u0939\u0915 \u0928\u093e\u092e \u0915\u093e \u0909\u092a\u092f\u094b\u0917 \u0915\u0930\u0947\u0902",enterCustomerName:"\u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u0928\u093e\u092e \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902",chooseCustomer:"\u090f\u0915 \u0917\u094d\u0930\u093e\u0939\u0915 \u091a\u0941\u0928\u0947\u0902",paymentMethod:"\u092d\u0941\u0917\u0924\u093e\u0928 \u0935\u093f\u0927\u093f",cash:"\u0928\u0915\u0926",card:"\u0915\u093e\u0930\u094d\u0921",upi:"UPI",due:"\u092c\u0915\u093e\u092f\u093e (\u0915\u094d\u0930\u0947\u0921\u093f\u091f)",addProducts:"\u0909\u0924\u094d\u092a\u093e\u0926 \u091c\u094b\u0921\u093c\u0947\u0902",searchProducts:"\u0909\u0924\u094d\u092a\u093e\u0926 \u0916\u094b\u091c\u0947\u0902...",scanBarcode:"\u092c\u093e\u0930\u0915\u094b\u0921 \u0938\u094d\u0915\u0948\u0928 \u0915\u0930\u0947\u0902",enterBarcodeManually:"\u092f\u093e \u092c\u093e\u0930\u0915\u094b\u0921 \u092e\u0948\u0928\u094d\u092f\u0941\u0905\u0932 \u0930\u0942\u092a \u0938\u0947 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 \u0914\u0930 Enter \u0926\u092c\u093e\u090f\u0902...",billItems:"\u092c\u093f\u0932 \u0906\u0907\u091f\u092e",noItemsAdded:"\u0905\u092d\u0940 \u0924\u0915 \u0915\u094b\u0908 \u0906\u0907\u091f\u092e \u0928\u0939\u0940\u0902 \u091c\u094b\u0921\u093c\u093e \u0917\u092f\u093e",billSummary:"\u092c\u093f\u0932 \u0938\u093e\u0930\u093e\u0902\u0936",subtotal:"\u0909\u092a-\u092f\u094b\u0917",discount:"\u091b\u0942\u091f",tax:"\u0915\u0930",generateBill:"\u092c\u093f\u0932 \u092c\u0928\u093e\u090f\u0902",addToBill:"\u092c\u093f\u0932 \u092e\u0947\u0902 \u091c\u094b\u0921\u093c\u0947\u0902",addQuantity:"\u092e\u093e\u0924\u094d\u0930\u093e \u091c\u094b\u0921\u093c\u0947\u0902",product:"\u0909\u0924\u094d\u092a\u093e\u0926",unit:"\u0907\u0915\u093e\u0908",pieces:"\u091f\u0941\u0915\u0921\u093c\u0947 (pcs)",grams:"\u0917\u094d\u0930\u093e\u092e (gm)",kilograms:"\u0915\u093f\u0932\u094b\u0917\u094d\u0930\u093e\u092e (kg)",milliliters:"\u092e\u093f\u0932\u0940\u0932\u0940\u091f\u0930 (mL)",liters:"\u0932\u0940\u091f\u0930 (L)",boxes:"\u092c\u0949\u0915\u094d\u0938",packets:"\u092a\u0948\u0915\u0947\u091f",bottles:"\u092c\u094b\u0924\u0932\u0947\u0902",lowStockAlert:"\u0915\u092e \u0938\u094d\u091f\u0949\u0915 \u091a\u0947\u0924\u093e\u0935\u0928\u0940",expiringSoon:"\u091c\u0932\u094d\u0926\u0940 \u0938\u092e\u093e\u092a\u094d\u0924 \u0939\u094b \u0930\u0939\u093e",isRunningLow:"\u0915\u092e \u0939\u094b \u0930\u0939\u093e \u0939\u0948",unitsRemaining:"\u0907\u0915\u093e\u0907\u092f\u093e\u0902 \u0936\u0947\u0937",expiresIn:"\u0938\u092e\u093e\u092a\u094d\u0924 \u0939\u094b\u0924\u093e \u0939\u0948",days:"\u0926\u093f\u0928\u094b\u0902 \u092e\u0947\u0902",billGeneratedSuccessfully:"\u092c\u093f\u0932 \u0938\u092b\u0932\u0924\u093e\u092a\u0942\u0930\u094d\u0935\u0915 \u092c\u0928\u093e\u092f\u093e \u0917\u092f\u093e!",pleaseAddItems:"\u0915\u0943\u092a\u092f\u093e \u092c\u093f\u0932 \u092e\u0947\u0902 \u0906\u0907\u091f\u092e \u091c\u094b\u0921\u093c\u0947\u0902",pleaseEnterCustomerName:"\u0915\u0943\u092a\u092f\u093e \u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u0928\u093e\u092e \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 \u092f\u093e \u091a\u0941\u0928\u0947\u0902",lowStockWarning:"\u0915\u092e \u0938\u094d\u091f\u0949\u0915 \u091a\u0947\u0924\u093e\u0935\u0928\u0940!",available:"\u0909\u092a\u0932\u092c\u094d\u0927",requested:"\u0905\u0928\u0941\u0930\u094b\u0927\u093f\u0924",pleaseReduceQuantity:"\u0915\u0943\u092a\u092f\u093e \u092e\u093e\u0924\u094d\u0930\u093e \u0915\u092e \u0915\u0930\u0947\u0902",orLess:"\u092f\u093e \u0909\u0938\u0938\u0947 \u0915\u092e",stockError:"\u0938\u094d\u091f\u0949\u0915 \u0924\u094d\u0930\u0941\u091f\u093f!",cannotGenerateBill:"\u0905\u092a\u0930\u094d\u092f\u093e\u092a\u094d\u0924 \u0938\u094d\u091f\u0949\u0915 \u0915\u0947 \u0938\u093e\u0925 \u092c\u093f\u0932 \u0928\u0939\u0940\u0902 \u092c\u0928\u093e \u0938\u0915\u0924\u0947",thankYouForBusiness:"\u0906\u092a\u0915\u0947 \u0935\u094d\u092f\u0935\u0938\u093e\u092f \u0915\u0947 \u0932\u093f\u090f \u0927\u0928\u094d\u092f\u0935\u093e\u0926!",productNotFound:"\u092c\u093e\u0930\u0915\u094b\u0921 \u0915\u0947 \u0938\u093e\u0925 \u0909\u0924\u094d\u092a\u093e\u0926 \u0928\u0939\u0940\u0902 \u092e\u093f\u0932\u093e",pleaseAddProductFirst:"\u0915\u0943\u092a\u092f\u093e \u092a\u0939\u0932\u0947 \u0909\u0924\u094d\u092a\u093e\u0926 \u091c\u094b\u0921\u093c\u0947\u0902 \u092f\u093e \u092b\u093f\u0930 \u0938\u0947 \u0915\u094b\u0936\u093f\u0936 \u0915\u0930\u0947\u0902",lowStock:"\u0915\u092e \u0938\u094d\u091f\u0949\u0915!",youCannotAddMore:"\u0906\u092a \u0907\u0938\u0938\u0947 \u0905\u0927\u093f\u0915 \u0928\u0939\u0940\u0902 \u091c\u094b\u0921\u093c \u0938\u0915\u0924\u0947"}},Ze=function(e){var t;return(null===(t=Ke[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en"])||void 0===t?void 0:t[e])||Ke.en[e]||e};var Je=n(2814),$e=n(8162);const et=e=>{var t,n,r,s,i,a;if(!e)return null;return(e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t})((null===(t=e.subscription)||void 0===t?void 0:t.expiresAt)||(null===(n=e.subscription)||void 0===n?void 0:n.expiryDate)||(null===(r=e.subscription)||void 0===r?void 0:r.endDate)||(null===(s=e.currentPlanDetails)||void 0===s?void 0:s.expiresAt)||(null===(i=e.currentPlanDetails)||void 0===i?void 0:i.expiryDate)||(null===(a=e.currentPlanDetails)||void 0===a?void 0:a.endDate)||null)},tt=e=>{var t,n,r;let{onClose:s}=e;const{state:a,dispatch:o}=(0,i.nm)(),l=ee(),c=et(a),d="string"===typeof(null===(t=a.subscription)||void 0===t?void 0:t.status)?a.subscription.status.toLowerCase():null,u=!1===a.isSubscriptionActive||"expired"===d||!!c&&c.getTime()<=Date.now(),h="Your subscription has expired. Upgrade your plan to continue.",m="staff"===a.userType||"staff"===(null===(n=a.currentUser)||void 0===n?void 0:n.userType),f=(null===(r=a.currentUser)||void 0===r?void 0:r.permissions)||{},p=a.staffPermissionsLoading;let g=[{name:"dashboard",href:"dashboard",icon:Oe},{name:"customers",href:"customers",icon:Le},{name:"products",href:"products",icon:Me},{name:"inventory",href:"inventory",icon:Fe},{name:"billing",href:"billing",icon:Be},{name:"salesOrderHistory",href:"salesOrderHistory",icon:Ue},{name:"refunds",href:"refunds",icon:ze},{name:"purchaseOrders",href:"purchase",icon:qe},...m?[]:[{name:"staff",href:"staff",icon:He}],{name:"financial",href:"financial",icon:Ve},{name:"reports",href:"reports",icon:We},...m?!0===f.upgradePlan?[{name:"upgradePlan",href:"upgrade",icon:Ge}]:[]:[{name:"upgradePlan",href:"upgrade",icon:Ge}]];m&&!p&&Object.keys(f).length>0&&(g=g.filter(e=>{const t={dashboard:"dashboard",customers:"customers",products:"products",inventory:"inventory",billing:"billing",salesOrderHistory:"salesOrderHistory",refunds:"refunds",purchase:"purchaseOrders",financial:"financial",reports:"reports",upgrade:"upgradePlan"}[e.href]||e.href;return!0===f[t]}));const x=e=>{var t;if("staff"===a.userType||"staff"===(null===(t=a.currentUser)||void 0===t?void 0:t.userType))if("settings"===e);else{var n;if(!(!0===((null===(n=a.currentUser)||void 0===n?void 0:n.permissions)||{})[{dashboard:"dashboard",customers:"customers",products:"products",inventory:"inventory",billing:"billing",salesOrderHistory:"salesOrderHistory",refunds:"refunds",purchase:"purchaseOrders",financial:"financial",reports:"reports",upgrade:"upgradePlan"}[e]||e]))return void(window.showToast&&window.showToast("You do not have permission to access this feature.","warning"))}else{if(u&&"upgrade"!==e)return void(window.showToast&&window.showToast(h,"warning"));if("dashboard"!==e&&"settings"!==e&&!(0,Je.Ku)(e,a.currentPlan,a.currentPlanDetails)){const t=(0,Je.IV)(e,a.currentPlan);return void(window.showToast&&window.showToast(t,"warning"))}}const r=(0,$e.k_)(e);o({type:i.ActionTypes.SET_CURRENT_VIEW,payload:e}),l(r),s&&s()},y="".concat("public","/assets/drag-and-drop-logo.jpg"),b=(e,t,n)=>t?e?"group flex w-full items-center gap-3 rounded-2xl px-4 py-3 text-sm font-medium bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow-lg border border-transparent":"group flex w-full items-center gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-600 transition-all duration-200 border border-transparent hover:bg-white/70 hover:text-[#2f3c7e]":"group flex w-full items-center gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-400 cursor-not-allowed border border-transparent",w=(e,t)=>t?e?"h-5 w-5 text-white":"h-5 w-5 text-slate-500 group-hover:text-[#2f3c7e]":"h-5 w-5 text-slate-300";return(0,Pe.jsxs)("div",{className:"dark-sidebar flex h-full flex-col",style:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between px-5 py-5 flex-shrink-0 border-b border-slate-200/50",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,Pe.jsx)("div",{className:"flex h-11 w-11 items-center justify-center rounded-2xl border border-white/40 bg-white shadow-lg",children:(0,Pe.jsx)("img",{src:y,alt:"Drag & Drop",className:"h-8 w-8 object-contain"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-[0.35em] text-slate-500",children:"Drag & Drop"}),(0,Pe.jsx)("h1",{className:"truncate text-lg font-semibold text-slate-800",children:"Business OS"})]})]}),s&&(0,Pe.jsx)("button",{onClick:s,className:"xl:hidden inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-600 transition hover:bg-slate-100","aria-label":"Close navigation",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-h-0",style:{WebkitOverflowScrolling:"touch"},children:(0,Pe.jsxs)("ul",{className:"pb-6 pt-2",children:[g.map(e=>{const t=e.icon,n=a.currentView===e.href,r="upgrade"===e.href;let s;if(m){const t=!0===f["purchase"===e.href?"purchaseOrders":e.href],n="dashboard"===e.href||"upgrade"===e.href||(0,Je.Ku)(e.href,a.currentPlan,a.currentPlanDetails);s=t&&(u?r:n)}else{const t="dashboard"===e.href||(0,Je.Ku)(e.href,a.currentPlan,a.currentPlanDetails);s=u?r:t}const i=s?void 0:u&&!r?h:(0,Je.IV)(e.href,a.currentPlan);return(0,Pe.jsx)("li",{className:"px-3 py-1",children:(0,Pe.jsxs)("button",{onClick:()=>x(e.href),className:b(n,s),title:i,disabled:!s,children:[(0,Pe.jsx)(t,{className:w(n,s)}),(0,Pe.jsx)("span",{className:"truncate",children:Ze(e.name,a.currentLanguage)}),!s&&(0,Pe.jsx)(Xe,{className:"h-4 w-4 text-slate-300"}),r&&(0,Pe.jsx)(Ge,{className:"h-4 w-4 text-amber-400"})]})},e.name)}),(0,Pe.jsx)("li",{className:"px-3 py-1",children:(0,Pe.jsxs)("button",{onClick:()=>x("settings"),className:b("settings"===a.currentView,!0),disabled:!1,children:[(0,Pe.jsx)(Qe,{className:w("settings"===a.currentView,!0)}),(0,Pe.jsx)("span",{className:"truncate",children:Ze("settings",a.currentLanguage)})]})})]})})]})},nt=Ee("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),rt=Ee("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),st=Ee("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),it=Ee("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);var at=n(7950),ot=n.t(at,2);const lt=Ee("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ct=e=>{let{onClose:t}=e;const{state:n}=(0,i.nm)(),r=n.products.filter(e=>(e.quantity||e.stock||0)<=n.lowStockThreshold),s=n.products.filter(e=>{if(!e.expiryDate)return!1;const t=new Date(e.expiryDate)-new Date,r=Math.ceil(t/864e5);return r>=0&&r<=n.expiryDaysThreshold}),a=[...r.map(e=>({type:"low_stock",title:Ze("lowStockAlert",n.currentLanguage),message:"".concat(e.name," ").concat(Ze("isRunningLow",n.currentLanguage)," (").concat(e.quantity||e.stock||0," ").concat(Ze("unitsRemaining",n.currentLanguage),")"),icon:Me,color:"yellow"})),...s.map(e=>({type:"expiring",title:Ze("expiringSoon",n.currentLanguage),message:"".concat(e.name," ").concat(Ze("expiresIn",n.currentLanguage)," ").concat(Math.ceil((new Date(e.expiryDate)-new Date)/864e5)," ").concat(Ze("days",n.currentLanguage)),icon:rt,color:"red"}))];if("undefined"===typeof document)return null;const o=(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/70 backdrop-blur-sm px-4",children:(0,Pe.jsxs)("div",{className:"w-full max-w-lg rounded-3xl bg-white shadow-[0_20px_60px_-15px_rgba(15,23,42,0.45)] border border-slate-100",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b border-slate-100",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-400",children:"Drag & Drop"}),(0,Pe.jsx)("h2",{className:"mt-1 text-xl font-semibold text-slate-900",children:Ze("notifications",n.currentLanguage)})]}),(0,Pe.jsx)("button",{onClick:t,className:"p-2 rounded-full text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"max-h-[60vh] overflow-y-auto px-6 py-5",children:0===a.length?(0,Pe.jsxs)("div",{className:"text-center py-10 space-y-3",children:[(0,Pe.jsx)("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-slate-100",children:(0,Pe.jsx)(lt,{className:"h-7 w-7 text-slate-300"})}),(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500",children:Ze("noNotifications",n.currentLanguage)}),(0,Pe.jsx)("p",{className:"text-xs text-slate-400",children:Ze("noNotificationsDetail",n.currentLanguage)||"Come back later for low-stock or expiry alerts."})]}):(0,Pe.jsx)("div",{className:"space-y-4",children:a.map((e,t)=>{const n=e.icon,r="yellow"===e.color?{wrapper:"bg-amber-50 border-amber-200",iconBox:"bg-amber-100 text-amber-600"}:{wrapper:"bg-rose-50 border-rose-200",iconBox:"bg-rose-100 text-rose-600"};return(0,Pe.jsxs)("div",{className:"flex items-start gap-4 rounded-2xl border px-4 py-4 transition hover:shadow-md ".concat(r.wrapper),children:[(0,Pe.jsx)("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl ".concat(r.iconBox),children:(0,Pe.jsx)(n,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,Pe.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:e.title}),(0,Pe.jsx)("p",{className:"text-sm text-slate-600 leading-relaxed",children:e.message})]})]},t)})})})]})});return(0,at.createPortal)(o,document.body)},dt=Ee("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]),ut=Ee("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ht=Ee("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),mt=Ee("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ft=Ee("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var pt=n(159);const gt=()=>{const{state:e}=(0,i.nm)(),[n,r]=(0,t.useState)(navigator.onLine),[s,a]=(0,t.useState)(0),[o,l]=(0,t.useState)({products:[],customers:[],orders:[],transactions:[],purchaseOrders:[],categories:[],refunds:[]}),[c,d]=((0,t.useRef)(null),(0,t.useState)(!1)),u=(0,t.useRef)(null);(0,t.useEffect)(()=>{const e=()=>r(!0),t=()=>r(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,t.useEffect)(()=>{(async()=>{try{const[e,t,n,r,s,i,a]=await Promise.all([(0,Ae.getAllItems)(Ae.STORES.products).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.customers).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.orders).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.transactions).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.purchaseOrders).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.categories).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.refunds).catch(()=>[])]);l({products:e||[],customers:t||[],orders:n||[],transactions:r||[],purchaseOrders:s||[],categories:i||[],refunds:a||[]})}catch(e){console.error("Error loading IndexedDB data for sync status:",e)}})()},[s]),(0,t.useEffect)(()=>{const e=setInterval(()=>{a(e=>e+1)},6e4);return()=>clearInterval(e)},[]);const h=(0,t.useCallback)(()=>{a(e=>e+1)},[]);(0,t.useEffect)(()=>(0,i.Y0)(h),[h]),(0,t.useEffect)(()=>{const e=()=>{a(e=>e+1)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const m=(0,t.useMemo)(()=>{const t={products:Array.isArray(o.products)&&o.products.length>0?o.products:Array.isArray(e.products)?[...e.products]:[],customers:Array.isArray(o.customers)&&o.customers.length>0?o.customers:Array.isArray(e.customers)?[...e.customers]:[],orders:Array.isArray(o.orders)&&o.orders.length>0?o.orders:Array.isArray(e.orders)?[...e.orders]:[],transactions:Array.isArray(o.transactions)&&o.transactions.length>0?o.transactions:Array.isArray(e.transactions)?[...e.transactions]:[],purchaseOrders:Array.isArray(o.purchaseOrders)&&o.purchaseOrders.length>0?o.purchaseOrders:Array.isArray(e.purchaseOrders)?[...e.purchaseOrders]:[],categories:Array.isArray(o.categories)&&o.categories.length>0?o.categories:Array.isArray(e.categories)?[...e.categories]:[],refunds:Array.isArray(o.refunds)&&o.refunds.length>0?o.refunds:[]};let n=0,r=0,s=0;const i={products:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},customers:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},orders:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},transactions:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},purchaseOrders:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},categories:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]},refunds:{count:0,items:[],reasons:{new:0,update:0,deletion:0},errors:[]}};Object.entries(t).forEach(e=>{let[t,a]=e;Array.isArray(a)&&a.forEach(e=>{n++;if(!0!==e.isSynced){if(s++,i[t]){i[t].count++;const n=e.syncError&&"string"===typeof e.syncError;let r="update";if(e.isDeleted?r="deletion":e._id||(r="new"),void 0!==i[t].reasons[r]&&i[t].reasons[r]++,n){const n={name:"refunds"===t?e.orderId?"Order ".concat(e.orderId):e.id||"Unknown":e.name||e.supplierName||e.id||"Unknown",error:e.syncError,attempts:e.syncAttempts||1,lastAttempt:e.lastSyncAttempt||null};i[t].errors.length<3&&i[t].errors.push(n)}if(i[t].items.length<5){const s="refunds"===t?e.orderId?"Order ".concat(e.orderId):e.id||"Unknown":e.name||e.supplierName||e.id||"Unknown";i[t].items.push({name:s,type:r,reason:"new"===r?"New item":"deletion"===r?"Pending deletion":"Pending update",hasError:n,error:n?e.syncError:null})}}}else r++})});const a=n>0?Math.round(r/n*100):100;return{totalItems:n,syncedItems:r,unsyncedItems:s,percentage:a,isFullySynced:0===s&&n>0,unsyncedByStore:i}},[e.products,e.customers,e.orders,e.transactions,e.purchaseOrders,e.categories,o.products,o.customers,o.orders,o.transactions,o.purchaseOrders,o.categories,o.refunds,s]),{percentage:f,unsyncedItems:p,isFullySynced:g,unsyncedByStore:x}=m,y=(0,t.useRef)(null),[b,w]=(0,t.useState)({top:0,right:0});(0,t.useEffect)(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&d(!1)};if(c)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]),(0,t.useEffect)(()=>{if(c&&y.current){const e=y.current.getBoundingClientRect();w({top:e.bottom+8,right:window.innerWidth-e.right})}},[c]);const v=(()=>{if(!n)return{reason:"Offline",message:"You are currently offline. Data will sync automatically when you reconnect to the internet.",details:[]};if(g)return{reason:"All synced",message:"All data is successfully synced to the database.",details:[]};const e=[],t={products:"Products",customers:"Customers",orders:"Orders",transactions:"Transactions",purchaseOrders:"Purchase Orders",categories:"Categories",refunds:"Refunds"};Object.entries(x).forEach(n=>{let[r,s]=n;if(s.count>0){const n=t[r]||r,i=1===s.count?"item":"items",a=[];s.reasons.new>0&&a.push("".concat(s.reasons.new," new")),s.reasons.update>0&&a.push("".concat(s.reasons.update," update").concat(s.reasons.update>1?"s":"")),s.reasons.deletion>0&&a.push("".concat(s.reasons.deletion," deletion").concat(s.reasons.deletion>1?"s":""));const o=s.errors.length,l=o>0;e.push({store:n,count:s.count,items:s.items,reasons:s.reasons,reasonBreakdown:a.join(", "),errors:s.errors,errorCount:o,hasErrors:l,message:"".concat(s.count," ").concat(i," pending sync").concat(l?" (".concat(o," with errors)"):""," (").concat(a.join(", "),")")})}});let r="Pending sync",s="".concat(p," item(s) are waiting to sync to the database.");return pt.Ay.isSyncing?(r="Syncing in progress",s="Data is currently being synced to the database. Please wait..."):p>0&&(r="Pending sync",s="".concat(p," item(s) are waiting to sync. Sync happens automatically every 30 seconds.")),{reason:r,message:s,details:e}})();if(0===m.totalItems)return null;const N=n?g?{bg:"bg-emerald-500/20",text:"text-emerald-300",border:"border-emerald-400/30",icon:ut,iconColor:"text-emerald-400"}:f>=80?{bg:"bg-blue-500/20",text:"text-blue-300",border:"border-blue-400/30",icon:ht,iconColor:"text-blue-400"}:f>=50?{bg:"bg-yellow-500/20",text:"text-yellow-300",border:"border-yellow-400/30",icon:mt,iconColor:"text-yellow-400 animate-spin"}:{bg:"bg-orange-500/20",text:"text-orange-300",border:"border-orange-400/30",icon:mt,iconColor:"text-orange-400 animate-spin"}:{bg:"bg-white/5",text:"text-white/60",border:"border-white/10",icon:dt,iconColor:"text-white/50"},S=N.icon;return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"relative",ref:u,children:(0,Pe.jsxs)("div",{ref:y,className:"inline-flex items-center gap-1.5 rounded-lg border ".concat(N.border," ").concat(N.bg," px-2.5 py-1.5 transition-all duration-300 cursor-pointer hover:opacity-80"),onClick:()=>d(!c),title:"Click to see sync details",children:[(0,Pe.jsx)(S,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 ".concat(N.iconColor)}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,Pe.jsxs)("span",{className:"text-[10px] font-semibold sm:text-xs ".concat(N.text),children:[f,"%"]}),!g&&n&&(0,Pe.jsx)("span",{className:"text-[9px] ".concat(N.text," opacity-75 hidden sm:inline"),children:p})]})]})}),c&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"fixed inset-0 z-[99] bg-transparent",onClick:()=>d(!1)}),(0,Pe.jsxs)("div",{className:"fixed w-80 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-xl border border-gray-200 z-[100] p-4",style:{top:"".concat(b.top,"px"),right:"".concat(b.right,"px")},children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Sync Status"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:v.reason})]}),(0,Pe.jsx)("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-4 w-4"})})]}),(0,Pe.jsxs)("div",{className:"mb-3",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Pe.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Overall Progress"}),(0,Pe.jsxs)("span",{className:"text-xs font-semibold text-gray-900",children:[f,"%"]})]}),(0,Pe.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Pe.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(g?"bg-green-500":f>=80?"bg-blue-500":f>=50?"bg-yellow-500":"bg-orange-500"),style:{width:"".concat(f,"%")}})}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs text-gray-600",children:[(0,Pe.jsxs)("span",{children:[m.syncedItems," synced"]}),(0,Pe.jsxs)("span",{children:[p," pending"]})]})]}),(0,Pe.jsx)("div",{className:"mb-3",children:(0,Pe.jsx)("p",{className:"text-xs text-gray-700 mb-2",children:v.message})}),v.details.length>0&&(0,Pe.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,Pe.jsx)("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Pending by Type:"}),(0,Pe.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:v.details.map((e,t)=>(0,Pe.jsxs)("div",{className:"flex flex-col gap-1 text-xs",children:[(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("span",{className:"font-medium text-gray-700",children:[e.store,":"]}),(0,Pe.jsxs)("span",{className:"text-gray-600 ml-1",children:[e.count," ",1===e.count?"item":"items"]})]})}),(0,Pe.jsxs)("div",{className:"ml-2 text-[10px] text-gray-500",children:[(0,Pe.jsx)("span",{className:"font-medium",children:"Reasons:"})," ",e.reasonBreakdown]}),e.hasErrors&&(0,Pe.jsxs)("div",{className:"ml-2 mt-1 space-y-1",children:[(0,Pe.jsxs)("div",{className:"text-[10px] font-medium text-red-600",children:["\u26a0\ufe0f Sync Errors (",e.errorCount,"):"]}),e.errors.map((e,t)=>(0,Pe.jsxs)("div",{className:"ml-2 text-[9px] text-red-500 bg-red-50 rounded px-1.5 py-1 border border-red-200",children:[(0,Pe.jsx)("div",{className:"font-medium text-red-700",children:e.name}),(0,Pe.jsx)("div",{className:"text-red-600 mt-0.5 truncate",title:e.error,children:e.error}),e.attempts>1&&(0,Pe.jsxs)("div",{className:"text-[8px] text-red-400 mt-0.5",children:["Attempt ",e.attempts]})]},t))]}),e.items.length>0&&(0,Pe.jsxs)("div",{className:"mt-0.5 ml-2 space-y-0.5",children:[e.items.slice(0,3).map((e,t)=>(0,Pe.jsxs)("div",{className:"text-[10px] truncate flex items-center gap-1 ".concat(e.hasError?"text-red-600":"text-gray-500"),children:[(0,Pe.jsx)("span",{children:"\u2022"}),(0,Pe.jsx)("span",{className:"flex-1 truncate",children:e.name}),(0,Pe.jsxs)("span",{className:"text-[9px] ".concat(e.hasError?"text-red-500":"text-gray-400"),children:["(",e.hasError?"Error":e.reason,")"]})]},t)),e.count>3&&(0,Pe.jsxs)("div",{className:"text-[10px] text-gray-400",children:["... and ",e.count-3," more"]})]})]},t))})]}),!n&&(0,Pe.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-2 text-xs text-amber-600",children:[(0,Pe.jsx)(dt,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold",children:"Offline Mode"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-0.5",children:"Data will sync automatically when you reconnect."})]})]})}),n&&!g&&!pt.Ay.isSyncing&&(0,Pe.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-2 text-xs text-blue-600",children:[(0,Pe.jsx)(ft,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold",children:"Auto-sync Active"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-0.5",children:"Data syncs automatically every 30 seconds."})]})]})})]})]})]})},xt=e=>{var n,r,s,a;let{onMenuClick:o,installState:l={}}=e;const{state:c}=(0,i.nm)(),[d,u]=(0,t.useState)(!1),{isInstallable:h,isInstalled:m,install:f}=l,p=e=>Ze(e,c.currentLanguage),g=c.products.filter(e=>(e.quantity||e.stock||0)<=c.lowStockThreshold).length,x=c.products.filter(e=>{if(!e.expiryDate)return!1;const t=new Date(e.expiryDate)-new Date,n=Math.ceil(t/864e5);return n>=0&&n<=c.expiryDaysThreshold}).length,y=g+x;return(0,Pe.jsxs)("header",{className:"relative overflow-hidden border-b border-slate-800 bg-slate-950/95 px-2.5 py-2 text-white sm:px-4 sm:py-2.5 lg:px-6 lg:py-3.5",children:[(0,Pe.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-white/5 via-transparent to-white/5 opacity-40 pointer-events-none"}),(0,Pe.jsxs)("div",{className:"relative flex flex-row items-center justify-between gap-2 sm:gap-2.5 lg:gap-3",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,Pe.jsx)("button",{onClick:o,className:"xl:hidden inline-flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border border-white/10 bg-white/10 text-white transition hover:bg-white/20 active:scale-95","aria-label":"Open navigation",children:(0,Pe.jsx)(nt,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsx)("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-1.5 py-0.5 text-[8px] font-semibold uppercase tracking-[0.2em] text-white/70 sm:text-[9px] sm:px-2 sm:tracking-[0.28em]",children:p(c.currentView)}),(0,Pe.jsx)("h1",{className:"mt-1 text-base font-semibold leading-tight sm:text-lg sm:mt-1.5 lg:text-[24px] lg:tracking-tight",children:p(c.currentView)}),(0,Pe.jsxs)("div",{className:"mt-1 hidden items-center gap-1.5 text-xs text-white/70 sm:flex",children:[(0,Pe.jsx)(rt,{className:"h-3.5 w-3.5 shrink-0"}),(0,Pe.jsx)("span",{className:"font-mono text-xs font-semibold tracking-wide text-white/90 sm:text-sm",children:c.currentTime})]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2 sm:gap-2.5 lg:gap-3",children:[(0,Pe.jsx)(gt,{}),h&&!m&&(0,Pe.jsxs)("button",{onClick:f,className:"inline-flex items-center gap-1.5 rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-[10px] font-semibold text-white transition hover:bg-white/20 active:scale-95 sm:text-xs sm:rounded-full sm:px-4",title:"Install App",children:[(0,Pe.jsx)(st,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Install App"})]}),(0,Pe.jsxs)("button",{onClick:()=>u(!0),className:"relative inline-flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border border-white/10 bg-white/10 text-white transition hover:bg-white/20 active:scale-95 sm:h-9 sm:w-9 sm:rounded-full","aria-label":"View notifications",children:[(0,Pe.jsx)(it,{className:"h-4 w-4 sm:h-5 sm:w-5"}),y>0&&(0,Pe.jsx)("span",{className:"absolute -top-0.5 -right-0.5 flex h-3.5 min-w-[16px] items-center justify-center rounded-full bg-rose-500 px-1 text-[8px] font-semibold text-white shadow-lg sm:h-4 sm:min-w-[18px] sm:text-[9px]",children:y})]}),(0,Pe.jsxs)("div",{className:"hidden items-center gap-2 rounded-full border border-white/10 bg-white/5 px-2.5 py-1 text-left sm:flex sm:gap-2.5 sm:px-3 sm:py-1.5",children:[(0,Pe.jsxs)("div",{className:"leading-tight text-white/80",children:[(0,Pe.jsx)("p",{className:"text-[8px] font-semibold uppercase tracking-[0.2em] sm:text-[9px] sm:tracking-[0.26em]",children:"User"}),(0,Pe.jsx)("p",{className:"text-xs font-semibold text-white leading-tight sm:text-sm",children:(null===(n=c.currentUser)||void 0===n?void 0:n.username)||"User"})]}),(0,Pe.jsx)("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center overflow-hidden rounded-full border border-white/30 bg-white/10 sm:h-8 sm:w-8",children:(0,Pe.jsx)("img",{className:"h-full w-full object-cover",src:(null===(r=c.currentUser)||void 0===r?void 0:r.photoURL)||"https://placehold.co/80x80/1b1b1b/ffffff?text=".concat((null===(s=c.currentUser)||void 0===s||null===(a=s.username)||void 0===a?void 0:a.charAt(0).toUpperCase())||"U"),alt:"User avatar",onError:e=>{var t,n;e.currentTarget.src="https://placehold.co/80x80/1b1b1b/ffffff?text=".concat((null===(t=c.currentUser)||void 0===t||null===(n=t.username)||void 0===n?void 0:n.charAt(0).toUpperCase())||"U")}})})]})]})]}),d&&(0,Pe.jsx)(ct,{onClose:()=>u(!1)})]})},yt=e=>{let{children:n}=e;const{state:r}=(0,i.nm)(),s=r.planBootstrap||{},a=s.isActive&&!s.hasCompleted,[o,l]=(0,t.useState)(a),[c,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)([]),{prompt:m,isInstallable:f,isInstalled:p,install:g}=(()=>{const[e,n]=(0,t.useState)(null),[r,s]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{if(window.matchMedia("(display-mode: standalone)").matches)return void s(!0);if(!0===window.navigator.standalone)return void s(!0);const e=e=>{e.preventDefault(),n(e),console.log("PWA install prompt available")},t=()=>{s(!0),n(null),console.log("PWA installed")};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]),{prompt:e,isInstallable:!!e&&!r,isInstalled:r,install:async()=>{if(e)try{await e.prompt();const{outcome:t}=await e.userChoice;"accepted"===t?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),n(null)}catch(t){console.error("Error showing install prompt:",t)}else console.warn("Install prompt not available")}}})(),[x,y]=(0,t.useState)(!1),[b,w]=(0,t.useState)(()=>"undefined"!==typeof window&&"true"===sessionStorage.getItem("pwa-install-dismissed"));(0,t.useEffect)(()=>{if(a)return void l(!0);if(!o)return;const e=setTimeout(()=>l(!1),400);return()=>clearTimeout(e)},[a,o]),(0,t.useEffect)(()=>{"undefined"!==typeof window&&sessionStorage.setItem("pwa-install-dismissed",b?"true":"false")},[b]),(0,t.useEffect)(()=>{if(f&&!p&&!b){const e=setTimeout(()=>y(!0),800);return()=>clearTimeout(e)}y(!1)},[f,p,b]);const v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;const r=Date.now();h(s=>[...s.filter(n=>!(n.message===e&&n.type===t)),{id:r,message:e,type:t,duration:n}]),setTimeout(()=>{h(e=>e.filter(e=>e.id!==r))},n)};(0,t.useEffect)(()=>{window.showToast=v},[]);const N={prompt:m,isInstallable:f,isInstalled:p,install:g};return(0,Pe.jsxs)("div",{className:"flex h-screen text-slate-900",children:[(0,Pe.jsx)("nav",{className:"hidden w-72 xl:flex xl:flex-col xl:sticky xl:top-0 xl:h-screen shadow-[0_28px_90px_-55px_rgba(15,23,42,0.55)]",children:(0,Pe.jsx)(tt,{})}),c&&(0,Pe.jsxs)("div",{className:"fixed inset-0 z-40 xl:hidden",style:{height:"100vh",overflow:"hidden"},children:[(0,Pe.jsx)("div",{className:"fixed inset-0 bg-slate-900/70 backdrop-blur-sm",onClick:()=>d(!1)}),(0,Pe.jsx)("div",{className:"relative w-full max-w-xs h-full flex flex-col shadow-[0_28px_80px_-50px_rgba(15,23,42,0.55)] bg-white",style:{height:"100vh"},children:(0,Pe.jsx)(tt,{onClose:()=>d(!1)})})]}),(0,Pe.jsxs)("div",{className:"relative flex min-w-0 flex-1 flex-col",children:[(0,Pe.jsx)(xt,{onMenuClick:()=>d(!0),installState:N}),"offline"===r.systemStatus&&(0,Pe.jsxs)("div",{className:"bg-amber-100 border-b border-amber-200 text-amber-700 text-sm px-4 py-2 text-center flex items-center justify-center gap-2",children:[(0,Pe.jsx)("span",{className:"inline-flex h-2.5 w-2.5 rounded-full bg-amber-500 animate-pulse","aria-hidden":"true"}),(0,Pe.jsx)("span",{children:"You're offline. Changes will sync automatically when you reconnect."})]}),(0,Pe.jsx)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden scroll-smooth no-scrollbar",children:(0,Pe.jsx)("div",{className:"p-3 pt-3 sm:p-5 sm:pt-4 xl:p-7 xl:pt-5 2xl:p-10 2xl:pt-6",children:n})})]}),o&&(0,Pe.jsxs)("div",{className:"fixed inset-0 z-[70] flex flex-col items-center justify-center transition-opacity duration-500 ease-out ".concat(a?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[(0,Pe.jsx)("div",{className:"absolute inset-0 bg-slate-900/65 backdrop-blur-xl","aria-hidden":"true"}),(0,Pe.jsxs)("div",{className:"relative flex flex-col items-center justify-center gap-6 rounded-3xl border border-white/10 bg-white/10 px-10 py-12 shadow-[0_35px_90px_-25px_rgba(15,23,42,0.65)] backdrop-blur-2xl",children:[(0,Pe.jsxs)("div",{className:"relative flex h-20 w-20 items-center justify-center",children:[(0,Pe.jsx)("div",{className:"absolute inset-0 rounded-full bg-white/10 blur-xl"}),(0,Pe.jsx)("div",{className:"h-16 w-16 animate-spin rounded-full border-[3px] border-white/25 border-t-white"})]}),(0,Pe.jsxs)("div",{className:"space-y-2 text-center text-white",children:[(0,Pe.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.35em] text-white/60",children:"Please wait"}),(0,Pe.jsx)("h2",{className:"text-2xl font-semibold",children:"We are preparing your dashboard..."}),(0,Pe.jsx)("p",{className:"text-sm text-white/70 max-w-sm",children:"Fetching the latest plan details and unlocking your workspace."})]})]})]}),(0,Pe.jsx)("div",{className:"fixed top-24 right-4 z-50 flex flex-col-reverse",children:u.map(e=>(0,Pe.jsxs)("div",{className:"flex items-start gap-3 rounded-2xl border px-4 py-3 shadow-[0_16px_40px_-28px_rgba(15,23,42,0.5)] backdrop-blur-md min-w-[280px] max-w-[420px] mb-3 text-sm ".concat("success"===e.type?"border-emerald-200 bg-white/85 text-emerald-700":"error"===e.type?"border-rose-200 bg-white/85 text-rose-700":"warning"===e.type?"border-amber-200 bg-white/85 text-amber-700":"border-sky-200 bg-white/85 text-sky-700"),children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"font-semibold capitalize",children:e.type||"info"}),(0,Pe.jsx)("p",{className:"mt-1 leading-relaxed whitespace-pre-wrap break-words text-slate-600",children:e.message})]}),(0,Pe.jsx)("button",{onClick:()=>{return t=e.id,void h(e=>e.filter(e=>e.id!==t));var t},className:"flex-shrink-0 text-slate-400 hover:text-slate-600 transition","aria-label":"Dismiss notification",children:"\xd7"})]},e.id))}),x&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm px-4",children:(0,Pe.jsxs)("div",{className:"w-full max-w-sm rounded-3xl bg-white/90 border border-slate-200 shadow-[0_28px_70px_-38px_rgba(15,23,42,0.55)] p-6 space-y-4 backdrop-blur-lg",children:[(0,Pe.jsxs)("div",{className:"space-y-1 text-center",children:[(0,Pe.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.35em] text-slate-400",children:"Install App"}),(0,Pe.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Drag & Drop on your device"}),(0,Pe.jsx)("p",{className:"text-sm text-slate-500",children:"Install the PWA for instant access, faster launches, and full offline support."})]}),(0,Pe.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end sm:gap-3",children:[(0,Pe.jsx)("button",{type:"button",onClick:()=>{w(!0),y(!1)},className:"px-4 py-2 rounded-full border border-slate-200 text-slate-600 text-sm font-medium hover:bg-slate-100 transition",children:"Maybe later"}),(0,Pe.jsx)("button",{type:"button",onClick:async()=>{if(!g)return w(!0),void y(!1);try{await g()}finally{w(!0),y(!1)}},className:"px-4 py-2 rounded-full bg-[linear-gradient(135deg,#2F3C7E,#18224f)] text-white text-sm font-semibold hover:bg-[linear-gradient(135deg,#243168,#111c44)] transition",children:"Install now"})]})]})})]})},bt=Ee("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),wt=Ee("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),vt=Ee("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Nt=Ee("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),St=Ee("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),At=Ee("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),_t=Ee("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ct=Ee("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),It=e=>(e||"").toString().replace(/\D/g,"").slice(-10),Et=e=>{const t=It(e);return/^[6-9]\d{9}$/.test(t)},Tt=e=>e?e.toString().trim().replace(/\s+/g,"").toUpperCase():"",jt=["Retail","Wholesale","Service","Manufacturing","E-commerce","Other"],kt=["Male","Female","Other","Prefer not to say"],Dt=e=>{let{isOpen:n,onClose:r}=e;const{state:s,dispatch:o}=(0,i.nm)(),l=s.currentUser||{},c=!0===(null===l||void 0===l?void 0:l.profileCompleted),d=(0,t.useMemo)(()=>({shopName:l.shopName||"",businessType:l.businessType||"",shopAddress:l.shopAddress||"",phoneNumber:l.phoneNumber||"",city:l.city||"",state:l.state||"",pincode:l.pincode||"",upiId:l.upiId||"",gstNumber:l.gstNumber||"",gender:l.gender||""}),[l.shopName,l.businessType,l.shopAddress,l.phoneNumber,l.city,l.state,l.pincode,l.upiId,l.gstNumber,l.gender]),[u,h]=(0,t.useState)(d),[m,f]=(0,t.useState)({}),[p,g]=(0,t.useState)(!1),x=e=>t=>{let n=t.target.value;"gstNumber"===e&&n&&(n=Tt(n)),h(t=>(0,a.A)((0,a.A)({},t),{},{[e]:n})),f(t=>(0,a.A)((0,a.A)({},t),{},{[e]:""}))},y=()=>{const e={};["shopName","businessType","shopAddress","phoneNumber","city","state","pincode","upiId","gender"].forEach(t=>{u[t]&&u[t].toString().trim()||(e[t]="Required")});const t=It(u.phoneNumber);t&&Et(t)||(e.phoneNumber="Enter a valid 10-digit mobile number");6!==(u.pincode||"").toString().replace(/\D/g,"").length&&(e.pincode="Enter a valid 6-digit pincode");if(/^[\w.-]{2,}@[a-zA-Z]{2,}$/.test(u.upiId.trim())||(e.upiId="Enter a valid UPI ID (example: name@bank)"),u.gstNumber&&u.gstNumber.trim()){(e=>{if(!e)return!1;const t=Tt(e);if(15!==t.length)return!1;if(!/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(t))return!1;const n=parseInt(t.substring(0,2),10);return!(n<1||n>42)&&"Z"===t.charAt(12)})(Tt(u.gstNumber))||(e.gstNumber="Enter a valid 15-character GSTIN (e.g., 27ABCDE1234F1Z5)")}return f(e),0===Object.keys(e).length};if(!n)return null;return(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-8 bg-black/60 backdrop-blur-sm",onClick:e=>{c||e.target!==e.currentTarget||(e.preventDefault(),e.stopPropagation())},children:(0,Pe.jsxs)("div",{className:"w-full max-w-3xl rounded-3xl bg-white shadow-2xl p-8 relative max-h-[90vh] overflow-y-auto",children:[c&&(0,Pe.jsx)("button",{onClick:r,className:"absolute top-6 right-6 text-slate-400 hover:text-slate-600 transition","aria-label":"Close",children:(0,Pe.jsx)(Ye,{className:"h-6 w-6"})}),(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsx)("p",{className:"text-sm font-semibold text-sky-600 uppercase tracking-[0.3em]",children:"Complete Your Profile"}),(0,Pe.jsx)("h1",{className:"mt-2 text-3xl font-semibold text-slate-900",children:"Welcome! Let's set up your business"}),(0,Pe.jsx)("p",{className:"mt-2 text-sm text-slate-500",children:"We need a few business details to unlock all features."})]}),(0,Pe.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),p)return;if(!y())return void(window.showToast&&window.showToast("Please fix the highlighted fields.","warning"));g(!0);const t=It(u.phoneNumber),n=(u.pincode||"").toString().replace(/\D/g,"").slice(0,6),s=u.gstNumber?Tt(u.gstNumber):null,c={shopName:u.shopName.trim(),businessType:u.businessType.trim(),shopAddress:u.shopAddress.trim(),phoneNumber:t,city:u.city.trim(),state:u.state.trim(),pincode:n,upiId:u.upiId.trim(),gstNumber:s||null,gender:u.gender.trim()};try{var d,h,m;console.log("\ud83d\udce4 Submitting registration form with payload:",c);const e=await(0,Se.a4)(c);if(console.log("\ud83d\udce5 Registration response:",e),!e.success){var f;const t=e.error||(null===(f=e.data)||void 0===f?void 0:f.message)||"Failed to complete registration";throw console.error("\u274c Registration failed:",t),new Error(t)}const t=(null===(d=e.data)||void 0===d||null===(h=d.data)||void 0===h?void 0:h.seller)||(null===(m=e.data)||void 0===m?void 0:m.seller)||{};console.log("\u2705 Registration successful, updated seller:",t);const n=(0,a.A)((0,a.A)((0,a.A)({},l),t),{},{profileCompleted:!0});console.log("\ud83d\udd04 Dispatching UPDATE_USER with profileCompleted:",n.profileCompleted),o({type:i.ActionTypes.UPDATE_USER,payload:n}),c.shopName&&o({type:i.ActionTypes.SET_STORE_NAME,payload:c.shopName}),c.upiId&&o({type:i.ActionTypes.SET_UPI_ID,payload:c.upiId}),window.showToast&&window.showToast("Profile completed successfully!","success"),r()}catch(x){console.error("\u274c Seller registration error:",x);const e=x.message||"Failed to save registration details.";window.showToast&&window.showToast(e,"error")}finally{g(!1)}},className:"space-y-6",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Shop Name *"}),(0,Pe.jsx)("input",{type:"text",value:u.shopName,onChange:x("shopName"),className:"input-field ".concat(m.shopName?"border-red-400":""),placeholder:"Eg. ABC Store"}),m.shopName&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.shopName})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Business Type *"}),(0,Pe.jsxs)("select",{value:u.businessType,onChange:x("businessType"),className:"input-field ".concat(m.businessType?"border-red-400":""),children:[(0,Pe.jsx)("option",{value:"",children:"Select business type"}),jt.map(e=>(0,Pe.jsx)("option",{value:e,children:e},e))]}),m.businessType&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.businessType})]}),(0,Pe.jsxs)("div",{className:"md:col-span-2",children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Shop Address *"}),(0,Pe.jsx)("textarea",{value:u.shopAddress,onChange:x("shopAddress"),className:"input-field h-20 resize-none ".concat(m.shopAddress?"border-red-400":""),placeholder:"Street, locality, landmark","data-gramm":"false","data-gramm_editor":"false","data-enable-grammarly":"false"}),m.shopAddress&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.shopAddress})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone Number *"}),(0,Pe.jsx)("input",{type:"tel",value:u.phoneNumber,onChange:x("phoneNumber"),className:"input-field ".concat(m.phoneNumber?"border-red-400":""),placeholder:"10-digit mobile number"}),m.phoneNumber&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.phoneNumber})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"City *"}),(0,Pe.jsx)("input",{type:"text",value:u.city,onChange:x("city"),className:"input-field ".concat(m.city?"border-red-400":""),placeholder:"City"}),m.city&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.city})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"State *"}),(0,Pe.jsx)("input",{type:"text",value:u.state,onChange:x("state"),className:"input-field ".concat(m.state?"border-red-400":""),placeholder:"State"}),m.state&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.state})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Pincode *"}),(0,Pe.jsx)("input",{type:"text",value:u.pincode,onChange:x("pincode"),className:"input-field ".concat(m.pincode?"border-red-400":""),placeholder:"6-digit pincode"}),m.pincode&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.pincode})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"UPI ID *"}),(0,Pe.jsx)("input",{type:"text",value:u.upiId,onChange:x("upiId"),className:"input-field ".concat(m.upiId?"border-red-400":""),placeholder:"yourname@bank"}),m.upiId&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.upiId}),(0,Pe.jsxs)("p",{className:"mt-1.5 text-xs text-slate-500 bg-blue-50 border border-blue-100 rounded-md px-2.5 py-1.5",children:[(0,Pe.jsx)("span",{className:"font-medium text-blue-700",children:"\ud83d\udca1 Why we need your UPI ID:"})," We generate dynamic QR codes for you to accept customer payments directly to your UPI account."]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["GST Number ",(0,Pe.jsx)("span",{className:"text-slate-400 font-normal",children:"(Optional)"})]}),(0,Pe.jsx)("input",{type:"text",value:u.gstNumber,onChange:x("gstNumber"),className:"input-field ".concat(m.gstNumber?"border-red-400":""),placeholder:"GSTIN (e.g., 27ABCDE1234F1Z5)"}),m.gstNumber&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.gstNumber})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Gender *"}),(0,Pe.jsxs)("select",{value:u.gender,onChange:x("gender"),className:"input-field ".concat(m.gender?"border-red-400":""),children:[(0,Pe.jsx)("option",{value:"",children:"Select gender"}),kt.map(e=>(0,Pe.jsx)("option",{value:e,children:e},e))]}),m.gender&&(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-500",children:m.gender})]})]}),(0,Pe.jsx)("div",{className:"flex gap-3 pt-4",children:(0,Pe.jsx)("button",{type:"submit",disabled:p,className:"flex-1 rounded-xl bg-sky-600 py-3.5 text-sm font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:p?"Saving...":"Save & Continue"})})]})]})})},Pt=e=>{if(!e)return null;const t=e.getTime()-Date.now();if(t<=0)return{expired:!0,days:0,hours:0,minutes:0,seconds:0};const n=Math.floor(t/1e3);return{expired:!1,days:Math.floor(n/86400),hours:Math.floor(n%86400/3600),minutes:Math.floor(n%3600/60),seconds:n%60}},Rt={primary:{background:"rgba(47, 60, 126, 0.12)",color:"#2F3C7E",border:"rgba(47, 60, 126, 0.28)"},teal:{background:"rgba(45, 212, 191, 0.14)",color:"#0F766E",border:"rgba(15, 118, 110, 0.24)"},amber:{background:"rgba(244, 162, 89, 0.16)",color:"#C2410C",border:"rgba(194, 65, 12, 0.24)"},rose:{background:"rgba(251, 113, 133, 0.16)",color:"#BE123C",border:"rgba(190, 18, 60, 0.24)"},sky:{background:"rgba(56, 189, 248, 0.18)",color:"#0369A1",border:"rgba(3, 105, 161, 0.24)"},emerald:{background:"rgba(74, 222, 128, 0.14)",color:"#047857",border:"rgba(4, 120, 87, 0.22)"},purple:{background:"rgba(196, 181, 253, 0.2)",color:"#6D28D9",border:"rgba(109, 40, 217, 0.24)"},slate:{background:"rgba(148, 163, 184, 0.16)",color:"#1E293B",border:"rgba(30, 41, 59, 0.2)"}},Ot=()=>{var e,n,r,s,o,l,c,d,u,h,m,f;const{state:p,dispatch:g}=(0,i.nm)(),x=ee(),[y,b]=(0,t.useState)("today"),[w,v]=(0,t.useState)(null),[N,S]=(0,t.useState)(!1),A="staff"===(null===(e=p.currentUser)||void 0===e?void 0:e.userType),_=!0===(null===(n=p.currentUser)||void 0===n?void 0:n.profileCompleted),C=!!(null!==(r=p.currentUser)&&void 0!==r&&r.shopName&&null!==(s=p.currentUser)&&void 0!==s&&s.businessType&&null!==(o=p.currentUser)&&void 0!==o&&o.shopAddress),I=_||C,E=!A&&!I;console.log("\ud83d\udd0d Dashboard profile completion check:",{isStaffUser:A,profileCompleted:null===(l=p.currentUser)||void 0===l?void 0:l.profileCompleted,hasProfileCompletedFlag:_,hasRequiredProfileFields:C,isProfileCompleted:I,currentUser:p.currentUser,showRegistrationModal:E});const T=(null===(c=p.subscription)||void 0===c?void 0:c.expiresAt)||(null===(d=p.currentPlanDetails)||void 0===d?void 0:d.expiresAt)||(null===(u=p.currentPlanDetails)||void 0===u?void 0:u.expiryDate)||null,j=(0,t.useMemo)(()=>(e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t})(T),[T]),[k,D]=(0,t.useState)(()=>Pt(j)),P=j?Math.max(0,Math.ceil((j.getTime()-Date.now())/864e5)):0,R=(null===(h=p.currentPlanDetails)||void 0===h?void 0:h.planName)||(null===(m=p.subscription)||void 0===m?void 0:m.planName)||(p.currentPlan?p.currentPlan.charAt(0).toUpperCase()+p.currentPlan.slice(1):null),O=j?j.toLocaleString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):null,L=O?R?"".concat(R," ").concat(0===P?"expired on":"expires on"," ").concat(O):"Plan ".concat(0===P?"expired on":"expires on"," ").concat(O):R?"".concat(R," expiry date not available"):"Plan expiry date not available";(0,t.useEffect)(()=>{let e=!0;const t=async()=>{try{const t=await(0,Ae.getAllItems)(Ae.STORES.orders).catch(()=>[]);if(!e)return;const n=(t||[]).filter(e=>e&&!0!==e.isDeleted),r=(p.orders||[]).filter(e=>e&&!0!==e.isDeleted),s=new Map(r.map(e=>[(e.id||e._id||e.createdAt||"").toString(),e]));let a=n.length!==r.length;if(!a)for(const e of n){const t=(e.id||e._id||e.createdAt||"").toString(),n=s.get(t);if(!n){a=!0;break}if(["totalAmount","subtotal","discountPercent","taxPercent","updatedAt","isSynced"].some(t=>{var r,s;const i=null!==(r=e[t])&&void 0!==r?r:null,a=null!==(s=n[t])&&void 0!==s?s:null;return JSON.stringify(i)!==JSON.stringify(a)})){a=!0;break}}a&&g({type:i.ActionTypes.SET_ORDERS,payload:n})}catch(t){console.error("Dashboard: Failed to refresh orders from IndexedDB",t)}};t();const n=()=>{t()};return window.addEventListener("focus",n),()=>{e=!1,window.removeEventListener("focus",n)}},[g,p.orders,null===(f=p.currentUser)||void 0===f?void 0:f.sellerId]);const M=e=>{const t=Number(e||0);if(!Number.isFinite(t))return"\u20b90.00";const n=Math.floor(100*t)/100;return"\u20b9".concat(n.toFixed(2))},F=(0,t.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;"undefined"!==typeof window&&"function"===typeof window.showToast&&window.showToast(e,t,n)},[]),B=(0,t.useCallback)((e,t,n)=>{var r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b,w;if(!e)return"";const v=e=>null===e||void 0===e||""===e?"null":e,N=v(t.storeName||(null===(r=t.currentUser)||void 0===r?void 0:r.shopName)||(null===(s=t.currentUser)||void 0===s?void 0:s.username)),S=v(null===(i=t.currentUser)||void 0===i?void 0:i.shopAddress),A=(null===(a=t.currentUser)||void 0===a?void 0:a.phoneNumber)||(null===(o=t.currentUser)||void 0===o?void 0:o.mobileNumber)||(null===(l=t.currentUser)||void 0===l?void 0:l.phone)||(null===(c=t.currentUser)||void 0===c?void 0:c.contact)||"",_=It(A),C=_?"+91 ".concat(_):v(A),I=new Date(e.date||e.createdAt||e.updatedAt||Date.now()),E=Number.isNaN(I.getTime())?"null":I.toLocaleDateString("en-IN"),T=v(e.customerName||e.customer||"Customer"),j=n?"+91 ".concat(n):"null",k=Number(null!==(d=null!==(u=null!==(h=e.subtotal)&&void 0!==h?h:e.subTotal)&&void 0!==u?u:e.total)&&void 0!==d?d:0),D=Number(null!==(m=null!==(f=e.discountAmount)&&void 0!==f?f:e.discount)&&void 0!==m?m:0),P=Number(null!==(p=null!==(g=e.taxAmount)&&void 0!==g?g:e.tax)&&void 0!==p?p:0),R=Number(null!==(x=null!==(y=null!==(b=e.total)&&void 0!==b?b:e.totalAmount)&&void 0!==y?y:e.amount)&&void 0!==x?x:k),O=null!==(w=e.taxPercent)&&void 0!==w?w:e.taxRate,L=void 0!==O&&null!==O?Number(O):k>0?P/k*100:null,M=Number.isFinite(k)?"\u20b9".concat(k.toFixed(2)):"\u20b9null",F=Number.isFinite(D)?"\u20b9".concat(D.toFixed(2)):"\u20b9null",B=Number.isFinite(P)?"\u20b9".concat(P.toFixed(2)):"\u20b9null",U=Number.isFinite(L)?"".concat(L%1===0?L.toFixed(0):L.toFixed(2),"%"):"null",z=Number.isFinite(R)?"\u20b9".concat(R.toFixed(2)):"\u20b9null",H="".concat("Item".padEnd(12," ")).concat("Qty".padStart(8," "),"   ").concat("Rate".padStart(8," "),"   ").concat("Amount".padStart(10," ")),V=(e.items||[]).map((e,t)=>{var n,r,s,i,a,o,l,c,d,u,h,m,f,p;const g=Number(null!==(n=null!==(r=null!==(s=e.quantity)&&void 0!==s?s:null===(i=e.originalQuantity)||void 0===i?void 0:i.quantity)&&void 0!==r?r:e.qty)&&void 0!==n?n:0),x=e.unit||(null===(a=e.originalQuantity)||void 0===a?void 0:a.unit)||"",y=Number(null!==(o=null!==(l=null!==(c=e.unitSellingPrice)&&void 0!==c?c:e.sellingPrice)&&void 0!==l?l:e.price)&&void 0!==o?o:g>0?(null!==(d=null!==(u=null!==(h=e.totalSellingPrice)&&void 0!==h?h:e.total)&&void 0!==u?u:e.amount)&&void 0!==d?d:0)/g:0),b=Number(null!==(m=null!==(f=null!==(p=e.totalSellingPrice)&&void 0!==p?p:e.total)&&void 0!==f?f:e.amount)&&void 0!==m?m:y*g),w=(e.name||e.productName||"Item ".concat(t+1)).slice(0,12).padEnd(12," "),v=(Number.isFinite(g)?g.toString():"null").padStart(8," "),N=(Number.isFinite(y)?y.toFixed(2):"null").padStart(8," "),S=(Number.isFinite(b)?b.toFixed(2):"null").padStart(10," ");return"".concat(w).concat(v,"   ").concat(N,"   ").concat(S).concat(x?" ".concat(x):"")}),W=V.length?V.join("\n"):"".concat("null".padEnd(12," ")).concat("null".padStart(8," "),"   ").concat("null".padStart(8," "),"   ").concat("null".padStart(10," ")),G=v(q(e.paymentMethod)),Y="--------------------------------";return["             INVOICE","",Y,"Shop Name : ".concat(N),"Address   : ".concat(S),"Phone     : ".concat(C),"Date      : ".concat(E),Y,"Customer Name : ".concat(T),"Customer Phone: ".concat(j),Y,H,W,Y,"Subtotal     : ".concat(M),"Discount     : ".concat(F),"Tax (".concat(U,")     : ").concat(B),Y,"Grand Total  : ".concat(z),"Payment Mode : ".concat(G),"Thank you for shopping with us!",Y,"       Powered by Drag & Drop",Y].join("\n")},[]),U=(0,t.useCallback)(e=>{var t,n;if(!e)return;const r=It(e.customerMobile||e.customerPhone||e.phoneNumber||"")||((e,t)=>{if(!e)return null;const n=e=>It(e)||null,r=n(e.customerMobile)||n(e.customerPhone)||n(e.phoneNumber);if(r)return r;if(e.customerId&&Array.isArray(t)){const r=t.find(t=>t.id===e.customerId||t._id===e.customerId||t.customerId===e.customerId);if(r){const e=n(r.mobileNumber)||n(r.phone)||n(r.contactNumber);if(e)return e}}if(e.customerName&&Array.isArray(t)){const r=e.customerName.trim().toLowerCase(),s=t.find(e=>(e.name||"").trim().toLowerCase()===r);if(s){const e=n(s.mobileNumber)||n(s.phone)||n(s.contactNumber);if(e)return e}}return null})(e,p.customers)||It((null===(t=p.currentUser)||void 0===t?void 0:t.phoneNumber)||(null===(n=p.currentUser)||void 0===n?void 0:n.mobileNumber)||"");if(!r)return void F("No customer mobile number found for this invoice.","warning");const s=B(e,p,r);if(!s)return void F("Unable to prepare invoice details for sharing.","error");const i=10===r.length?"91".concat(r):r,a="https://wa.me/".concat(i,"?text=").concat(encodeURIComponent(s));window.open(a,"_blank")},[B,F,p]),z=e=>"\u20b9".concat((Number(e)||0).toFixed(2)),q=function(){switch(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cash")||"").toLowerCase()){case"upi":case"online":return"Online Payment";case"due":case"credit":return"Due (Credit)";default:return"Cash"}};(0,t.useEffect)(()=>{if(!j)return void D(null);const e=()=>{D(Pt(j))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[j]);const H=e=>e.createdAt||e.date||(new Date).toISOString(),V=e=>e.date||e.createdAt||(new Date).toISOString(),{startDate:W,endDate:G}=(()=>{const e=new Date;e.setHours(0,0,0,0);let t=new Date(e);switch(y){case"7d":t.setDate(e.getDate()-7);break;case"30d":default:t.setDate(e.getDate()-30);break;case"90d":t.setDate(e.getDate()-90);break;case"1y":t.setFullYear(e.getFullYear()-1)}const n=new Date(e);return n.setHours(23,59,59,999),{startDate:t,endDate:n}})(),Y=(0,Se.$u)(),X=(e,t)=>{var n,r,s,i,a,o;if(!t||!e)return!0;const l=[e.sellerId,e.sellerID,e.seller_id,e._sellerId,null===(n=e.seller)||void 0===n?void 0:n.id,null===(r=e.seller)||void 0===r?void 0:r._id,null===(s=e.seller)||void 0===s?void 0:s.sellerId,null===(i=e.createdBy)||void 0===i?void 0:i.sellerId,null===(a=e.createdBy)||void 0===a?void 0:a.sellerID,null===(o=e.createdBy)||void 0===o?void 0:o._id].filter(Boolean).map(e=>{var t,n,r;return null===e||void 0===e||null===(t=e.toString)||void 0===t||null===(n=(r=t.call(e)).trim)||void 0===n?void 0:n.call(r)}).filter(Boolean);return 0===l.length||l.includes(t.toString())},Q=Y?p.orders.filter(e=>X(e,Y)):p.orders,K=Q.filter(e=>{const t=new Date(H(e));return t>=W&&t<=G}),Z=Y?p.purchaseOrders.filter(e=>X(e,Y)):p.purchaseOrders,J=Z.filter(e=>{const t=new Date(V(e));return t>=W&&t<=G}),$=p.customers.length,te=p.products.length,ne=Q.length,re=(Z.length,p.customers.reduce((e,t)=>e+(t.dueAmount||t.balanceDue||0),0)),se=Q.reduce((e,t)=>e+(t.totalAmount||0),0),ie=(K.reduce((e,t)=>e+(t.totalAmount||0),0),Z.reduce((e,t)=>e+(t.total||0),0),J.reduce((e,t)=>e+(t.total||0),0),e=>{const t=e=>("number"===typeof e?e:parseFloat(e))||0;return e.reduce((e,n)=>{if(!n.items||!Array.isArray(n.items))return e;return e+n.items.reduce((e,n)=>{var r,s;return e+(t(null!==(r=n.totalSellingPrice)&&void 0!==r?r:n.sellingPrice)-t(null!==(s=n.totalCostPrice)&&void 0!==s?s:n.costPrice))},0)},0)}),ae=p.products.filter(e=>(e.quantity||e.stock||0)<=p.lowStockThreshold),oe=p.products.filter(e=>{if(!e.expiryDate)return!1;const t=new Date(e.expiryDate),n=new Date;n.setHours(0,0,0,0);const r=t-n,s=Math.ceil(r/864e5);return s<=p.expiryDaysThreshold&&s>=0}),le=p.customers.filter(e=>(e.dueAmount||e.balanceDue||0)>0).length,ce=(ie(Q),Z.reduce((e,t)=>e+(t.total||0),0),new Date),de=new Date(ce.getFullYear(),ce.getMonth(),ce.getDate());de.setHours(0,0,0,0);const ue=new Date(de);ue.setDate(ue.getDate()+1);const he=Q.filter(e=>{const t=new Date(H(e));return t>=de&&t<ue}),me=Z.filter(e=>{const t=new Date(V(e));return t>=de&&t<ue}),fe=(he.reduce((e,t)=>e+(t.totalAmount||0),0),ie(he),me.reduce((e,t)=>e+(t.total||0),0),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;const t=new Date;t.setHours(0,0,0,0);let n=new Date(t);switch(e){case"today":default:return{startDate:de,endDate:ue};case"7d":return n.setDate(t.getDate()-7),{startDate:n,endDate:ue};case"30d":return n.setDate(t.getDate()-30),{startDate:n,endDate:ue};case"90d":return n.setDate(t.getDate()-90),{startDate:n,endDate:ue};case"1y":case"all":return{startDate:new Date(0),endDate:ue}}}),pe=()=>{const{startDate:e,endDate:t}=fe();return Q.filter(n=>{const r=new Date(H(n));return r>=e&&r<t}).reduce((e,t)=>e+(t.totalAmount||0),0)},ge=()=>{const{startDate:e,endDate:t}=fe(),n=Q.filter(n=>{const r=new Date(H(n));return r>=e&&r<t}),r=Z.filter(n=>{const r=new Date(V(n));return r>=e&&r<t});return ie(n)-r.reduce((e,t)=>e+(t.total||0),0)},xe=()=>{const{startDate:e,endDate:t}=fe(),n=Q.filter(n=>{const r=new Date(H(n));return r>=e&&r<t});return ie(n)},ye=new Date(ce.getFullYear(),ce.getMonth(),1);ye.setHours(0,0,0,0);const be=new Date(ce.getFullYear(),ce.getMonth()+1,1);be.setHours(0,0,0,0);const we=Q.filter(e=>{const t=new Date(H(e));return t>=ye&&t<be}),ve=Z.filter(e=>{const t=new Date(V(e));return t>=ye&&t<be}),Ne=(we.reduce((e,t)=>e+(t.totalAmount||0),0),ie(we),ve.reduce((e,t)=>e+(t.total||0),0),((e,t,n,r)=>{const s=e.filter(e=>{const t=new Date(H(e));return t>=n&&t<=r}),i=t.filter(e=>{const t=new Date(V(e));return t>=n&&t<=r});ie(s),i.reduce((e,t)=>e+(t.total||0),0)})(Q,Z,W,G),new Date(ce));Ne.setDate(Ne.getDate()-7);const _e=p.products.map(e=>{if(Q.filter(e=>new Date(H(e))>=Ne).some(t=>{var n;return null===(n=t.items)||void 0===n?void 0:n.some(t=>t.productId===e.id||t.name===e.name)})){const t=((e,t)=>{let n=0;return Q.forEach(r=>{r.items&&Array.isArray(r.items)&&r.items.forEach(r=>{r.productId!==e&&r.name!==t||!r.quantity||(n+=Number(r.quantity||0))})}),n})(e.id,e.name);return(0,a.A)((0,a.A)({},e),{},{salesCount:t})}return null}).filter(Boolean).sort((e,t)=>t.salesCount-e.salesCount).slice(0,10),Ce=new Date(ce);Ce.setDate(Ce.getDate()-30);const Ie=p.products.filter(e=>{const t=Q.filter(e=>new Date(H(e))>=Ce).some(t=>{var n;return null===(n=t.items)||void 0===n?void 0:n.some(t=>t.productId===e.id||t.name===e.name)}),n=Q.some(t=>{var n;return new Date(H(t))<Ce&&(null===(n=t.items)||void 0===n?void 0:n.some(t=>t.productId===e.id||t.name===e.name))});return!t&&n}).slice(0,10),Ee=p.products.filter(e=>!Q.some(t=>{var n;return null===(n=t.items)||void 0===n?void 0:n.some(t=>t.productId===e.id||t.name===e.name)})),Te=[...Q||[]].sort((e,t)=>{const n=new Date(H(e));return new Date(H(t))-n}).slice(0,5).map(e=>{const t=e.customerId?p.customers.find(t=>t.id===e.customerId||t._id===e.customerId):null;return{id:e.id||e._id,customerName:(null===t||void 0===t?void 0:t.name)||e.customerName||"Walk-in Customer",customerMobile:(null===t||void 0===t?void 0:t.mobileNumber)||(null===t||void 0===t?void 0:t.phone)||e.customerMobile||"",total:e.totalAmount||e.total||0,totalAmount:e.totalAmount||e.total||0,paymentMethod:e.paymentMethod||"cash",splitPaymentDetails:e.splitPaymentDetails,date:e.createdAt||e.date||(new Date).toISOString(),createdAt:e.createdAt||e.date||(new Date).toISOString(),subtotal:e.subtotal||0,discountPercent:e.discountPercent||0,taxPercent:e.taxPercent||0,items:e.items||[],note:e.notes||"",orderId:e.id||e._id,rawOrder:e}}),ke=[...p.activities||[]].sort((e,t)=>{const n=new Date(e.timestamp||e.createdAt||0);return new Date(t.timestamp||t.createdAt||0)-n}).slice(0,5),Re=e=>{const t=[{value:"today",label:"Today"},{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"90d",label:"Last 90 Days"},{value:"1y",label:"All Time"}].find(t=>t.value===e);return t?t.label:"Today"},Oe=(()=>{const{startDate:e,endDate:t}=fe(),n=Z.filter(n=>{const r=new Date(V(n));return r>=e&&r<t});return{count:n.length,value:n.reduce((e,t)=>e+(t.total||0),0)}})(),Fe=[{name:"Total Customers",value:$,icon:Le,description:"Active customers",theme:"primary"},{name:"Total Products",value:te,icon:Me,description:"Items in inventory",theme:"teal"},{name:"Sales",value:M(pe()),icon:Ve,description:"Sales - ".concat(Re(y)),theme:"amber"},{name:"Net Profit",value:M(ge()),icon:je,description:"Net Profit - ".concat(Re(y)),theme:"emerald"},{name:"Balance Due",value:M(re),icon:De,description:"Outstanding payments",theme:"rose"},{name:"Purchase Orders",value:"".concat(Oe.count),icon:qe,description:"".concat(Re(y)),theme:"slate",secondaryValue:M(Oe.value)},{name:"Sales Profit",value:M(xe()),icon:je,description:"Sales Profit - ".concat(Re(y)),theme:"purple"},{name:"Sales Profit Margin",value:"".concat((()=>{const e=pe(),t=xe();return e>0?t/e*100:0})().toFixed(1),"%"),icon:je,description:"Sales Profit Margin - ".concat(Re(y)),theme:"teal"}],Ue=(0,t.useCallback)(e=>{g({type:i.ActionTypes.SET_CURRENT_VIEW,payload:e}),x((0,$e.k_)(e))},[g,x]),ze=[{key:"billing",label:"New Bill",description:"Generate an invoice instantly",icon:bt,gradient:"linear-gradient(135deg, rgba(47,60,126,0.92), rgba(31,40,88,0.94))",onClick:()=>Ue("billing")},{key:"products",label:"Add Product",description:"Expand your catalog",icon:Me,gradient:"linear-gradient(135deg, rgba(99,102,241,0.88), rgba(76,29,149,0.92))",onClick:()=>Ue("products")},{key:"customers",label:"Add Customer",description:"Capture buyer details",icon:Le,gradient:"linear-gradient(135deg, rgba(16,185,129,0.88), rgba(4,120,87,0.92))",onClick:()=>Ue("customers")},{key:"purchase",label:"Purchase Order",description:"Replenish inventory fast",icon:qe,gradient:"linear-gradient(135deg, rgba(244,162,89,0.9), rgba(217,119,6,0.92))",onClick:()=>{(0,Je.Ku)("purchase",p.currentPlan,p.currentPlanDetails)?Ue("purchase"):window.showToast&&window.showToast((0,Je.IV)("purchase",p.currentPlan),"warning")}}];return(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-3 lg:space-y-4 fade-in-up",children:[(0,Pe.jsx)("div",{className:"hidden lg:block"}),j&&(0,Pe.jsx)("div",{className:"rounded-xl border-2 p-4 ".concat((He=P,He>10?"text-green-700 bg-green-50 border-green-200":He>3?"text-orange-700 bg-orange-50 border-orange-200":He>0?"text-red-600 bg-red-50 border-red-200":"text-red-700 bg-red-100 border-red-300")," ").concat(P>3?"hidden sm:block":""),children:(0,Pe.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,Pe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Pe.jsx)(rt,{className:"h-6 w-6"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold text-lg",children:(e=>0===e?"Subscription Expired":e<=3?"".concat(e," Day").concat(1===e?"":"s"," Left - Recharge Now!"):"".concat(e,e<=10?" Days Left - Recharge Soon!":" Days Remaining"))(P)}),(0,Pe.jsx)("p",{className:"text-sm opacity-80",children:L})]})]}),(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4 lg:justify-end",children:[k?k.expired?(0,Pe.jsx)("div",{className:"text-sm font-semibold",children:"Plan expired"}):(0,Pe.jsx)("div",{className:"flex items-center gap-2 sm:gap-3",children:[{label:"Days",value:k.days},{label:"Hours",value:k.hours},{label:"Minutes",value:k.minutes},{label:"Seconds",value:k.seconds}].map(e=>{return(0,Pe.jsxs)("div",{className:"bg-white/80 text-gray-900 rounded-lg px-3 py-2 min-w-[64px] text-center shadow-sm",children:[(0,Pe.jsx)("div",{className:"text-xl font-bold leading-none",children:(t=e.value,String(null!==t&&void 0!==t?t:0).padStart(2,"0"))}),(0,Pe.jsx)("div",{className:"text-xs uppercase tracking-wide text-gray-600",children:e.label})]},e.label);var t})}):(0,Pe.jsx)("div",{className:"text-sm font-semibold",children:"No active plan"}),P<=3&&(0,Pe.jsx)("button",{onClick:()=>Ue("upgrade"),className:"px-4 py-2 bg-[#1b1b1b] text-white rounded-lg hover:bg-[#252525] transition-colors",children:"Recharge Now"})]})]})}),(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Business Overview"}),(0,Pe.jsx)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80.p-1 shadow-sm",children:[{value:"today",label:"Today"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"},{value:"90d",label:"Last 90 days"},{value:"1y",label:"All Time"}].map(e=>{const t=y===e.value;return(0,Pe.jsx)("button",{type:"button",onClick:()=>b(e.value),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat(t?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:e.label},e.value)})})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Fe.map((e,t)=>{const n=e.icon,r=(s=e.theme,Rt[s]||Rt.slate);var s;return(0,Pe.jsxs)("div",{className:"stat-card animate-float-up group transition-all duration-300 bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md",style:{animationDelay:"".concat(.1*t,"s"),animationFillMode:"both"},children:[(0,Pe.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition group-hover:shadow-md",style:{backgroundColor:r.background,color:r.color,borderColor:r.border},children:(0,Pe.jsx)(n,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:e.name}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",title:e.value,children:e.value}),e.secondaryValue&&(0,Pe.jsxs)("p",{className:"text-sm font-medium text-slate-600 mt-1",children:["Value: ",e.secondaryValue]})]})]})}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:e.description})]},e.name)})}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,Pe.jsx)(lt,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Important Alerts"]}),(0,Pe.jsxs)("div",{className:"space-y-4",children:[ae.length>0&&(0,Pe.jsxs)("div",{className:"flex items-center p-4 bg-yellow-50 rounded-xl border-l-4 border-yellow-400",children:[(0,Pe.jsx)(lt,{className:"h-6 w-6 text-yellow-600 mr-4 flex-shrink-0"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("p",{className:"font-semibold text-yellow-800",children:[ae.length," products low in stock"]}),(0,Pe.jsxs)("p",{className:"text-sm text-yellow-600",children:[ae.slice(0,3).map(e=>e.name).join(", "),ae.length>3&&" and ".concat(ae.length-3," more")]})]})]}),oe.length>0&&(0,Pe.jsxs)("div",{className:"flex items-center p-4 bg-red-50 rounded-xl border-l-4 border-red-400",children:[(0,Pe.jsx)(rt,{className:"h-6 w-6 text-red-600 mr-4 flex-shrink-0"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("p",{className:"font-semibold text-red-800",children:[oe.length," products expiring soon"]}),(0,Pe.jsxs)("p",{className:"text-sm text-red-600",children:[oe.slice(0,3).map(e=>e.name).join(", "),oe.length>3&&" and ".concat(oe.length-3," more")]})]})]}),le>0&&(0,Pe.jsxs)("div",{className:"flex items-center p-4 bg-blue-50 rounded-xl border-l-4 border-blue-400",children:[(0,Pe.jsx)(De,{className:"h-6 w-6 text-blue-600 mr-4 flex-shrink-0"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("p",{className:"font-semibold text-blue-800",children:[le," customers have pending payments"]}),(0,Pe.jsxs)("p",{className:"text-sm text-blue-600",children:["Total outstanding: ",M(re)]})]})]}),0===ae.length&&0===oe.length&&0===le&&(0,Pe.jsxs)("div",{className:"text-center py-8",children:[(0,Pe.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Pe.jsx)(wt,{className:"h-8 w-8 text-green-600"})}),(0,Pe.jsx)("p",{className:"text-green-600 font-semibold",children:"All good! No alerts at this time"})]})]})]}),(0,Pe.jsxs)("div",{className:"card lg:col-span-2",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,Pe.jsx)(Be,{className:"h-5 w-5 mr-2 text-green-600"}),"Recent Transactions"]}),(0,Pe.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:Te.length>0?Te.map((e,t)=>(0,Pe.jsxs)("div",{className:"w-full flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>{const t=e.rawOrder||e;v(t),S(!0)},className:"flex-1 text-left flex items-center focus:outline-none",children:[(0,Pe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg mr-3",children:(0,Pe.jsx)(Be,{className:"h-4 w-4 text-green-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.customerName||"Walk-in Customer"}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:[q(e.paymentMethod)," \u2022 ",new Date(e.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.items&&e.items.length>0&&(0,Pe.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:[e.items.length," item",e.items.length>1?"s":""]})]})]}),(0,Pe.jsxs)("div",{className:"text-right",children:[(0,Pe.jsx)("p",{className:"font-semibold text-gray-900",children:M(e.total)}),(0,Pe.jsx)("p",{className:"text-xs text-green-600",children:"Sale"})]})]},e.id||t)):ke.length>0?ke.map((e,t)=>{const n=new Date(e.timestamp||e.createdAt||Date.now()),{icon:r,color:s}=(e=>{switch(e){case"bill_generated":return{icon:Be,color:"bg-green-100 text-green-600"};case"po_status_changed":return{icon:qe,color:"bg-blue-100 text-blue-600"};case"product_added":return{icon:Me,color:"bg-purple-100 text-purple-600"};case"customer_added":return{icon:Le,color:"bg-indigo-100 text-indigo-600"};default:return{icon:vt,color:"bg-gray-100 text-gray-600"}}})(e.type);return(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 ".concat(s," rounded-lg mr-3"),children:(0,Pe.jsx)(r,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.message||"Activity"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:n.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,Pe.jsx)("div",{className:"text-right",children:(0,Pe.jsx)("p",{className:"text-xs text-gray-400",children:e.type||"activity"})})]},e.id||t)}):(0,Pe.jsxs)("div",{className:"text-center py-8",children:[(0,Pe.jsx)(Be,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-500",children:"No recent transactions"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:"Transactions will appear here after you make sales"})]})})]})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,Pe.jsx)(Me,{className:"h-5 w-5 mr-2 text-purple-600"}),"Inventory Insights"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5",children:[(0,Pe.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(lt,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Low Stock Items"]}),(0,Pe.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:ae.length>0?ae.slice(0,10).map((e,t)=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.quantity||e.stock||0]})]}),(0,Pe.jsx)("p",{className:"text-xs font-semibold text-yellow-600",children:"Low Stock"})]},t)):(0,Pe.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No low stock items"})})]}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5",children:[(0,Pe.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(je,{className:"h-5 w-5 mr-2 text-green-600"}),"Fast-moving Items"]}),(0,Pe.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:_e.length>0?_e.map((e,t)=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:["Sold: ",e.salesCount||0," units (last 7 days)"]})]}),(0,Pe.jsx)("p",{className:"text-xs font-semibold text-green-600",children:"Fast Moving"})]},t)):(0,Pe.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No fast moving items"})})]}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5",children:[(0,Pe.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(Nt,{className:"h-5 w-5 mr-2 text-orange-600"}),"Slow-moving Items"]}),(0,Pe.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:Ie.length>0?Ie.map((e,t)=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.quantity||e.stock||0]})]}),(0,Pe.jsx)("p",{className:"text-xs font-semibold text-orange-600",children:"Slow Moving"})]},t)):(0,Pe.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No slow moving items"})})]}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5",children:[(0,Pe.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 mr-2 text-red-600"}),"Dead Stock (Not Sold for 30+ Days)"]}),(0,Pe.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:Ee.length>0?Ee.slice(0,10).map((e,t)=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.quantity||e.stock||0]})]}),(0,Pe.jsx)("p",{className:"text-xs font-semibold text-red-600",children:"Dead Stock"})]},t)):(0,Pe.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No dead stock"})})]})]})]}),N&&w&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/50 px-4 overflow-y-auto py-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col my-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4 flex-shrink-0",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Transaction Details"}),(0,Pe.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:w.customerName||"Walk-in Customer"}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(w.date).toLocaleString("en-IN")," \u2022 ",q(w.paymentMethod)]})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>U(w),className:"inline-flex items-center gap-2 rounded-full border border-primary-100 bg-primary-50 px-3 py-1.5 text-xs font-medium text-primary-600 transition hover:bg-primary-100",children:[(0,Pe.jsx)(At,{className:"h-3.5 w-3.5"}),"Share"]}),(0,Pe.jsx)("button",{type:"button",onClick:()=>{S(!1),v(null)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close transaction details",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]})]}),(0,Pe.jsxs)("div",{className:"px-6 py-5 space-y-6 overflow-y-auto flex-1",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Date"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(e=>{try{const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-IN",n).format(t)}catch(t){return e}})(w.createdAt||w.date)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Customer Name"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:w.customerName||"Walk-in Customer"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Customer Mobile"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:w.customerMobile||"-"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Payment Method"}),(0,Pe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{const t=(e||"").toLowerCase();return"cash"===t?"bg-green-50 text-green-700":"card"===t||"upi"===t||"online"===t?"bg-blue-50 text-blue-700":"due"===t||"credit"===t?"bg-red-50 text-red-700":"split"===t?"bg-purple-50 text-purple-700":"bg-gray-50 text-gray-700"})(w.paymentMethod)),children:w.paymentMethod||"N/A"})]}),(()=>{if("split"===(w.paymentMethod||"").toString().toLowerCase().trim()){const e=w.splitPaymentDetails||{},t=Number(e.cashAmount)||0,n=Number(e.onlineAmount)||0,r=Number(e.dueAmount)||0;return(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Split Payment Breakdown"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,Pe.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-green-700 font-medium mb-1",children:"Cash"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-green-900",children:z(t)})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Online"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-blue-900",children:z(n)})]}),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-red-700 font-medium mb-1",children:"Due"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-red-900",children:z(r)})]})]})]})}return null})(),(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Amount"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:z(w.totalAmount||w.total)})]})]}),w.items&&w.items.length>0&&(0,Pe.jsx)("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-gray-100",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Item"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Qty"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Rate"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-gray-100",children:w.items.map((e,t)=>{var n,r,s,i,a,o,l,c,d,u;const h=Number(null!==(n=null!==(r=e.quantity)&&void 0!==r?r:null===(s=e.originalQuantity)||void 0===s?void 0:s.quantity)&&void 0!==n?n:0),m=e.unit||(null===(i=e.originalQuantity)||void 0===i?void 0:i.unit)||"",f=Number(null!==(a=null!==(o=null!==(l=e.totalSellingPrice)&&void 0!==l?l:e.total)&&void 0!==o?o:e.sellingPrice)&&void 0!==a?a:0),p=h>0?f/h:Number(null!==(c=null!==(d=null!==(u=e.unitSellingPrice)&&void 0!==u?u:e.sellingPrice)&&void 0!==d?d:e.price)&&void 0!==c?c:0),g=h>0?p*h:f;return(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("td",{className:"px-4 py-2 text-gray-800",children:(0,Pe.jsx)("span",{className:"truncate block max-w-[200px]",title:e.name||"\u2014",children:e.name||"\u2014"})}),(0,Pe.jsxs)("td",{className:"px-4 py-2 text-center text-gray-600",children:[h," ",m]}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right text-gray-600",children:z(p)}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right font-medium text-gray-700",children:z(g)})]},"".concat(e.productId||e.name||t,"-").concat(t))})})]})}),w.note&&(0,Pe.jsxs)("div",{className:"bg-primary-50 border border-primary-100 rounded-xl p-3 text-sm text-primary-700",children:[(0,Pe.jsx)("p",{className:"text-xs uppercase tracking-wide text-primary-600 mb-1",children:"Note"}),w.note]})]}),(0,Pe.jsx)("div",{className:"flex justify-end border-t border-gray-200 px-6 py-4 flex-shrink-0",children:(0,Pe.jsx)("button",{type:"button",onClick:()=>{S(!1),v(null)},className:"btn-secondary",children:"Close"})})]})}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,Pe.jsx)(_t,{className:"h-5 w-5 mr-2 text-[var(--brand-primary)]"}),"Quick Actions"]}),(0,Pe.jsx)("div",{className:"grid grid-cols-2 gap-4",children:ze.map(e=>{const t=e.icon;return(0,Pe.jsx)("button",{type:"button",onClick:e.onClick,className:"group relative overflow-hidden rounded-2xl border border-white/25 bg-white/10 px-5 py-5 text-left text-white shadow-[0_24px_70px_-40px_rgba(15,23,42,0.6)] transition-transform duration-200 hover:-translate-y-1 hover:shadow-[0_32px_80px_-42px_rgba(15,23,42,0.65)] focus:outline-none",style:{background:e.gradient},children:(0,Pe.jsxs)("div",{className:"flex h-full flex-col justify-between gap-4",children:[(0,Pe.jsx)("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/15 text-white",children:(0,Pe.jsx)(t,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"space-y-1",children:[(0,Pe.jsx)("p",{className:"text-base font-semibold tracking-tight",children:e.label}),(0,Pe.jsx)("p",{className:"text-xs text-white/75",children:e.description})]})]})},e.key)})})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,Pe.jsx)(vt,{className:"h-5 w-5 mr-2 text-black"}),"Performance Metrics"]}),(0,Pe.jsxs)("div",{className:"space-y-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)(Ct,{className:"h-5 w-5 text-black mr-3"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold text-gray-900",children:"Sales Efficiency"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-600",children:"Transactions per day"})]})]}),(0,Pe.jsx)("div",{className:"text-right",children:(0,Pe.jsx)("p",{className:"text-xl font-bold text-black",children:he.length||0})})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)(We,{className:"h-5 w-5 text-black mr-3"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold text-gray-900",children:"Inventory Value"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-600",children:"Total stock value"})]})]}),(0,Pe.jsx)("div",{className:"text-right",children:(0,Pe.jsx)("p",{className:"text-xl font-bold text-black",children:M(p.products.reduce((e,t)=>e+(t.quantity||t.stock||0)*(t.costPrice||t.unitPrice||0),0))})})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)(je,{className:"h-5 w-5 text-black mr-3"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-semibold text-gray-900",children:"Avg Transaction"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-600",children:"Per transaction"})]})]}),(0,Pe.jsx)("div",{className:"text-right",children:(0,Pe.jsxs)("p",{className:"text-xl font-bold text-black",children:["\u20b9",se>0&&ne>0?(se/ne).toFixed(2):"0.00"]})})]})]})]})]}),(0,Pe.jsx)(Dt,{isOpen:E,onClose:()=>{}})]});var He},Lt=Ee("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Mt=Ee("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),Ft=Ee("FileJson",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),Bt=Ee("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ut=Ee("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),zt=Ee("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),qt=Ee("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ht=Ee("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),Vt=Ee("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Wt=Ee("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Gt=Ee("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);var Yt=n(2284),Xt=Uint8Array,Qt=Uint16Array,Kt=Int32Array,Zt=new Xt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Jt=new Xt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$t=new Xt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),en=function(e,t){for(var n=new Qt(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var s=new Kt(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)s[i]=i-n[r]<<5|r;return{b:n,r:s}},tn=en(Zt,2),nn=tn.b,rn=tn.r;nn[28]=258,rn[258]=28;for(var sn=en(Jt,0),an=(sn.b,sn.r),on=new Qt(32768),ln=0;ln<32768;++ln){var cn=(43690&ln)>>1|(21845&ln)<<1;cn=(61680&(cn=(52428&cn)>>2|(13107&cn)<<2))>>4|(3855&cn)<<4,on[ln]=((65280&cn)>>8|(255&cn)<<8)>>1}var dn=function(e,t,n){for(var r=e.length,s=0,i=new Qt(t);s<r;++s)e[s]&&++i[e[s]-1];var a,o=new Qt(t);for(s=1;s<t;++s)o[s]=o[s-1]+i[s-1]<<1;if(n){a=new Qt(1<<t);var l=15-t;for(s=0;s<r;++s)if(e[s])for(var c=s<<4|e[s],d=t-e[s],u=o[e[s]-1]++<<d,h=u|(1<<d)-1;u<=h;++u)a[on[u]>>l]=c}else for(a=new Qt(r),s=0;s<r;++s)e[s]&&(a[s]=on[o[e[s]-1]++]>>15-e[s]);return a},un=new Xt(288);for(ln=0;ln<144;++ln)un[ln]=8;for(ln=144;ln<256;++ln)un[ln]=9;for(ln=256;ln<280;++ln)un[ln]=7;for(ln=280;ln<288;++ln)un[ln]=8;var hn=new Xt(32);for(ln=0;ln<32;++ln)hn[ln]=5;var mn=dn(un,9,0),fn=dn(hn,5,0),pn=function(e){return(e+7)/8|0},gn=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new Xt(e.subarray(t,n))},xn=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},yn=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},bn=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var s=n.length,i=n.slice();if(!s)return{t:Cn,l:0};if(1==s){var a=new Xt(n[0].s+1);return a[n[0].s]=1,{t:a,l:1}}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var o=n[0],l=n[1],c=0,d=1,u=2;for(n[0]={s:-1,f:o.f+l.f,l:o,r:l};d!=s-1;)o=n[n[c].f<n[u].f?c++:u++],l=n[c!=d&&n[c].f<n[u].f?c++:u++],n[d++]={s:-1,f:o.f+l.f,l:o,r:l};var h=i[0].s;for(r=1;r<s;++r)i[r].s>h&&(h=i[r].s);var m=new Qt(h+1),f=wn(n[d-1],m,0);if(f>t){r=0;var p=0,g=f-t,x=1<<g;for(i.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});r<s;++r){var y=i[r].s;if(!(m[y]>t))break;p+=x-(1<<f-m[y]),m[y]=t}for(p>>=g;p>0;){var b=i[r].s;m[b]<t?p-=1<<t-m[b]++-1:++r}for(;r>=0&&p;--r){var w=i[r].s;m[w]==t&&(--m[w],++p)}f=t}return{t:new Xt(m),l:f}},wn=function(e,t,n){return-1==e.s?Math.max(wn(e.l,t,n+1),wn(e.r,t,n+1)):t[e.s]=n},vn=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Qt(++t),r=0,s=e[0],i=1,a=function(e){n[r++]=e},o=1;o<=t;++o)if(e[o]==s&&o!=t)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=e[o]}return{c:n.subarray(0,r),n:t}},Nn=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Sn=function(e,t,n){var r=n.length,s=pn(t+2);e[s]=255&r,e[s+1]=r>>8,e[s+2]=255^e[s],e[s+3]=255^e[s+1];for(var i=0;i<r;++i)e[s+i+4]=n[i];return 8*(s+4+r)},An=function(e,t,n,r,s,i,a,o,l,c,d){xn(t,d++,n),++s[256];for(var u=bn(s,15),h=u.t,m=u.l,f=bn(i,15),p=f.t,g=f.l,x=vn(h),y=x.c,b=x.n,w=vn(p),v=w.c,N=w.n,S=new Qt(19),A=0;A<y.length;++A)++S[31&y[A]];for(A=0;A<v.length;++A)++S[31&v[A]];for(var _=bn(S,7),C=_.t,I=_.l,E=19;E>4&&!C[$t[E-1]];--E);var T,j,k,D,P=c+5<<3,R=Nn(s,un)+Nn(i,hn)+a,O=Nn(s,h)+Nn(i,p)+a+14+3*E+Nn(S,C)+2*S[16]+3*S[17]+7*S[18];if(l>=0&&P<=R&&P<=O)return Sn(t,d,e.subarray(l,l+c));if(xn(t,d,1+(O<R)),d+=2,O<R){T=dn(h,m,0),j=h,k=dn(p,g,0),D=p;var L=dn(C,I,0);xn(t,d,b-257),xn(t,d+5,N-1),xn(t,d+10,E-4),d+=14;for(A=0;A<E;++A)xn(t,d+3*A,C[$t[A]]);d+=3*E;for(var M=[y,v],F=0;F<2;++F){var B=M[F];for(A=0;A<B.length;++A){var U=31&B[A];xn(t,d,L[U]),d+=C[U],U>15&&(xn(t,d,B[A]>>5&127),d+=B[A]>>12)}}}else T=mn,j=un,k=fn,D=hn;for(A=0;A<o;++A){var z=r[A];if(z>255){yn(t,d,T[(U=z>>18&31)+257]),d+=j[U+257],U>7&&(xn(t,d,z>>23&31),d+=Zt[U]);var q=31&z;yn(t,d,k[q]),d+=D[q],q>3&&(yn(t,d,z>>5&8191),d+=Jt[q])}else yn(t,d,T[z]),d+=j[z]}return yn(t,d,T[256]),d+j[256]},_n=new Kt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Cn=new Xt(0),In=function(e,t,n,r,s,i){var a=i.z||e.length,o=new Xt(r+a+5*(1+Math.ceil(a/7e3))+s),l=o.subarray(r,o.length-s),c=i.l,d=7&(i.r||0);if(t){d&&(l[0]=i.r>>3);for(var u=_n[t-1],h=u>>13,m=8191&u,f=(1<<n)-1,p=i.p||new Qt(32768),g=i.h||new Qt(f+1),x=Math.ceil(n/3),y=2*x,b=function(t){return(e[t]^e[t+1]<<x^e[t+2]<<y)&f},w=new Kt(25e3),v=new Qt(288),N=new Qt(32),S=0,A=0,_=i.i||0,C=0,I=i.w||0,E=0;_+2<a;++_){var T=b(_),j=32767&_,k=g[T];if(p[j]=k,g[T]=j,I<=_){var D=a-_;if((S>7e3||C>24576)&&(D>423||!c)){d=An(e,l,0,w,v,N,A,C,E,_-E,d),C=S=A=0,E=_;for(var P=0;P<286;++P)v[P]=0;for(P=0;P<30;++P)N[P]=0}var R=2,O=0,L=m,M=j-k&32767;if(D>2&&T==b(_-M))for(var F=Math.min(h,D)-1,B=Math.min(32767,_),U=Math.min(258,D);M<=B&&--L&&j!=k;){if(e[_+R]==e[_+R-M]){for(var z=0;z<U&&e[_+z]==e[_+z-M];++z);if(z>R){if(R=z,O=M,z>F)break;var q=Math.min(M,z-2),H=0;for(P=0;P<q;++P){var V=_-M+P&32767,W=V-p[V]&32767;W>H&&(H=W,k=V)}}}M+=(j=k)-(k=p[j])&32767}if(O){w[C++]=268435456|rn[R]<<18|an[O];var G=31&rn[R],Y=31&an[O];A+=Zt[G]+Jt[Y],++v[257+G],++N[Y],I=_+R,++S}else w[C++]=e[_],++v[e[_]]}}for(_=Math.max(_,I);_<a;++_)w[C++]=e[_],++v[e[_]];d=An(e,l,c,w,v,N,A,C,E,_-E,d),c||(i.r=7&d|l[d/8|0]<<3,d-=7,i.h=g,i.p=p,i.i=_,i.w=I)}else{for(_=i.w||0;_<a+c;_+=65535){var X=_+65535;X>=a&&(l[d/8|0]=c,X=a),d=Sn(l,d+1,e.subarray(_,X))}i.i=a}return gn(o,0,r+pn(d)+s)},En=function(){var e=1,t=0;return{p:function(n){for(var r=e,s=t,i=0|n.length,a=0;a!=i;){for(var o=Math.min(a+2655,i);a<o;++a)s+=r+=n[a];r=(65535&r)+15*(r>>16),s=(65535&s)+15*(s>>16)}e=r,t=s},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},Tn=function(e,t,n,r,s){if(!s&&(s={l:1},t.dictionary)){var i=t.dictionary.subarray(-32768),a=new Xt(i.length+e.length);a.set(i),a.set(e,i.length),e=a,s.w=i.length}return In(e,null==t.level?6:t.level,null==t.mem?s.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,r,s)},jn=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},kn=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=En();s.p(t.dictionary),jn(e,2,s.d())}};function Dn(e,t){t||(t={});var n=En();n.p(e);var r=Tn(e,t,t.dictionary?6:2,4);return kn(r,t),jn(r,r.length-4,n.d()),r}var Pn="undefined"!=typeof TextDecoder&&new TextDecoder;try{Pn.decode(Cn,{stream:!0})}catch(qb){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function On(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,i,a,o=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,s=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Rn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ln=n(4980);function Mn(e){return new TextDecoder(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").decode(e)}const Fn=new TextEncoder;const Bn=(()=>{const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])})(),Un={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class zn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Ln.A)(this,"buffer",void 0),(0,Ln.A)(this,"byteLength",void 0),(0,Ln.A)(this,"byteOffset",void 0),(0,Ln.A)(this,"length",void 0),(0,Ln.A)(this,"offset",void 0),(0,Ln.A)(this,"lastWrittenByte",void 0),(0,Ln.A)(this,"littleEndian",void 0),(0,Ln.A)(this,"_data",void 0),(0,Ln.A)(this,"_mark",void 0),(0,Ln.A)(this,"_marks",void 0);let n=!1;"number"===typeof e?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,s=e.byteLength-r;let i=r;(ArrayBuffer.isView(e)||e instanceof zn)&&(e.byteLength!==e.buffer.byteLength&&(i=e.byteOffset+r),e=e.buffer),this.lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,s),this._mark=0,this._marks=[]}available(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=e,this}back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readArray(e,"uint8")}readArray(e,t){const n=Un[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,s=this.buffer.slice(r,r+n);if(this.littleEndian===Bn&&"uint8"!==t&&"int8"!==t){const e=new Uint8Array(this.buffer.slice(r,r+n));e.reverse();const s=new Un[t](e.buffer);return this.offset+=n,s.reverse(),s}const i=new Un[t](s);return this.offset+=n,i}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Mn(this.readBytes(e))}decodeText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";return Mn(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return Fn.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function qn(e){let t=e.length;for(;--t>=0;)e[t]=0}const Hn=256,Vn=286,Wn=30,Gn=15,Yn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Xn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Qn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Kn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zn=new Array(576);qn(Zn);const Jn=new Array(60);qn(Jn);const $n=new Array(512);qn($n);const er=new Array(256);qn(er);const tr=new Array(29);qn(tr);const nr=new Array(Wn);function rr(e,t,n,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let sr,ir,ar;function or(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}qn(nr);const lr=e=>e<256?$n[e]:$n[256+(e>>>7)],cr=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},dr=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,cr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ur=(e,t,n)=>{dr(e,n[2*t],n[2*t+1])},hr=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},mr=(e,t,n)=>{const r=new Array(16);let s,i,a=0;for(s=1;s<=Gn;s++)a=a+n[s-1]<<1,r[s]=a;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=hr(r[t]++,t))}},fr=e=>{let t;for(t=0;t<Vn;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Wn;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},pr=e=>{e.bi_valid>8?cr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},gr=(e,t,n,r)=>{const s=2*t,i=2*n;return e[s]<e[i]||e[s]===e[i]&&r[t]<=r[n]},xr=(e,t,n)=>{const r=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&gr(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!gr(t,r,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=r},yr=(e,t,n)=>{let r,s,i,a,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,s=e.pending_buf[e.sym_buf+o++],0===r?ur(e,s,t):(i=er[s],ur(e,i+Hn+1,t),a=Yn[i],0!==a&&(s-=tr[i],dr(e,s,a)),r--,i=lr(r),ur(e,i,n),a=Xn[i],0!==a&&(r-=nr[i],dr(e,r,a)))}while(o<e.sym_next);ur(e,256,t)},br=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,i=t.stat_desc.elems;let a,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<i;a++)0!==n[2*a]?(e.heap[++e.heap_len]=c=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=r[2*l+1]);for(t.max_code=c,a=e.heap_len>>1;a>=1;a--)xr(e,n,a);l=i;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],xr(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*l]=n[2*a]+n[2*o],e.depth[l]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=l,e.heap[1]=l++,xr(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,u,h,m,f,p=0;for(h=0;h<=Gn;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],h=n[2*n[2*d+1]+1]+1,h>l&&(h=l,p++),n[2*d+1]=h,d>r||(e.bl_count[h]++,m=0,d>=o&&(m=a[d-o]),f=n[2*d],e.opt_len+=f*(h+m),i&&(e.static_len+=f*(s[2*d+1]+m)));if(0!==p){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,p-=2}while(p>0);for(h=l;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--c],u>r||(n[2*u+1]!==h&&(e.opt_len+=(h-n[2*u+1])*n[2*u],n[2*u+1]=h),d--)}})(e,t),mr(n,c,e.bl_count)},wr=(e,t,n)=>{let r,s,i=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)s=a,a=t[2*(r+1)+1],++o<l&&s===a||(o<c?e.bl_tree[2*s]+=o:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=s,0===a?(l=138,c=3):s===a?(l=6,c=3):(l=7,c=4))},vr=(e,t,n)=>{let r,s,i=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),r=0;r<=n;r++)if(s=a,a=t[2*(r+1)+1],!(++o<l&&s===a)){if(o<c)do{ur(e,s,e.bl_tree)}while(0!==--o);else 0!==s?(s!==i&&(ur(e,s,e.bl_tree),o--),ur(e,16,e.bl_tree),dr(e,o-3,2)):o<=10?(ur(e,17,e.bl_tree),dr(e,o-3,3)):(ur(e,18,e.bl_tree),dr(e,o-11,7));o=0,i=s,0===a?(l=138,c=3):s===a?(l=6,c=3):(l=7,c=4)}};let Nr=!1;const Sr=(e,t,n,r)=>{dr(e,0+(r?1:0),3),pr(e),cr(e,n),cr(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Ar=e=>{Nr||((()=>{let e,t,n,r,s;const i=new Array(16);for(n=0,r=0;r<28;r++)for(tr[r]=n,e=0;e<1<<Yn[r];e++)er[n++]=r;for(er[n-1]=r,s=0,r=0;r<16;r++)for(nr[r]=s,e=0;e<1<<Xn[r];e++)$n[s++]=r;for(s>>=7;r<Wn;r++)for(nr[r]=s<<7,e=0;e<1<<Xn[r]-7;e++)$n[256+s++]=r;for(t=0;t<=Gn;t++)i[t]=0;for(e=0;e<=143;)Zn[2*e+1]=8,e++,i[8]++;for(;e<=255;)Zn[2*e+1]=9,e++,i[9]++;for(;e<=279;)Zn[2*e+1]=7,e++,i[7]++;for(;e<=287;)Zn[2*e+1]=8,e++,i[8]++;for(mr(Zn,287,i),e=0;e<Wn;e++)Jn[2*e+1]=5,Jn[2*e]=hr(e,5);sr=new rr(Zn,Yn,257,Vn,Gn),ir=new rr(Jn,Xn,0,Wn,Gn),ar=new rr(new Array(0),Qn,0,19,7)})(),Nr=!0),e.l_desc=new or(e.dyn_ltree,sr),e.d_desc=new or(e.dyn_dtree,ir),e.bl_desc=new or(e.bl_tree,ar),e.bi_buf=0,e.bi_valid=0,fr(e)},_r=(e,t,n,r)=>{let s,i,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Hn;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),br(e,e.l_desc),br(e,e.d_desc),a=(e=>{let t;for(wr(e,e.dyn_ltree,e.l_desc.max_code),wr(e,e.dyn_dtree,e.d_desc.max_code),br(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Kn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=s&&(s=i)):s=i=n+5,n+4<=s&&-1!==t?Sr(e,t,n,r):4===e.strategy||i===s?(dr(e,2+(r?1:0),3),yr(e,Zn,Jn)):(dr(e,4+(r?1:0),3),((e,t,n,r)=>{let s;for(dr(e,t-257,5),dr(e,n-1,5),dr(e,r-4,4),s=0;s<r;s++)dr(e,e.bl_tree[2*Kn[s]+1],3);vr(e,e.dyn_ltree,t-1),vr(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),yr(e,e.dyn_ltree,e.dyn_dtree)),fr(e),r&&pr(e)},Cr=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(er[n]+Hn+1)]++,e.dyn_dtree[2*lr(t)]++),e.sym_next===e.sym_end),Ir=e=>{dr(e,2,3),ur(e,256,Zn),(e=>{16===e.bi_valid?(cr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},Er={_tr_init:Ar,_tr_stored_block:Sr,_tr_flush_block:_r,_tr_tally:Cr,_tr_align:Ir};var Tr=(e,t,n,r)=>{let s=65535&e,i=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{s=s+t[r++]|0,i=i+s|0}while(--a);s%=65521,i%=65521}return s|i<<16};const jr=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var kr=(e,t,n,r)=>{const s=jr,i=r+n;e^=-1;for(let a=r;a<i;a++)e=e>>>8^s[255&(e^t[a])];return-1^e},Dr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Pr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Rr,_tr_stored_block:Or,_tr_flush_block:Lr,_tr_tally:Mr,_tr_align:Fr}=Er,{Z_NO_FLUSH:Br,Z_PARTIAL_FLUSH:Ur,Z_FULL_FLUSH:zr,Z_FINISH:qr,Z_BLOCK:Hr,Z_OK:Vr,Z_STREAM_END:Wr,Z_STREAM_ERROR:Gr,Z_DATA_ERROR:Yr,Z_BUF_ERROR:Xr,Z_DEFAULT_COMPRESSION:Qr,Z_FILTERED:Kr,Z_HUFFMAN_ONLY:Zr,Z_RLE:Jr,Z_FIXED:$r,Z_DEFAULT_STRATEGY:es,Z_UNKNOWN:ts,Z_DEFLATED:ns}=Pr,rs=258,ss=262,is=42,as=113,os=666,ls=(e,t)=>(e.msg=Dr[t],t),cs=e=>2*e-(e>4?9:0),ds=e=>{let t=e.length;for(;--t>=0;)e[t]=0},us=e=>{let t,n,r,s=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=s?n-s:0}while(--t);t=s,r=t;do{n=e.prev[--r],e.prev[r]=n>=s?n-s:0}while(--t)};let hs=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ms=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},fs=(e,t)=>{Lr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ms(e.strm)},ps=(e,t)=>{e.pending_buf[e.pending++]=t},gs=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},xs=(e,t,n,r)=>{let s=e.avail_in;return s>r&&(s=r),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=Tr(e.adler,t,s,n):2===e.state.wrap&&(e.adler=kr(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},ys=(e,t)=>{let n,r,s=e.max_chain_length,i=e.strstart,a=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-ss?e.strstart-(e.w_size-ss):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+rs;let m=c[i+a-1],f=c[i+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+a]===f&&c[n+a-1]===m&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<h);if(r=rs-(h-i),i=h-rs,r>a){if(e.match_start=t,a=r,r>=o)break;m=c[i+a-1],f=c[i+a]}}}while((t=u[t&d])>l&&0!==--s);return a<=e.lookahead?a:e.lookahead},bs=e=>{const t=e.w_size;let n,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ss)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),us(e),r+=t),0===e.strm.avail_in)break;if(n=xs(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=hs(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=hs(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ss&&0!==e.strm.avail_in)},ws=(e,t)=>{let n,r,s,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>s&&(n=s),n<i&&(0===n&&t!==qr||t===Br||n!==r+e.strm.avail_in))break;a=t===qr&&n===r+e.strm.avail_in?1:0,Or(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ms(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(xs(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==Br&&t!==qr&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(xs(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,i=s>e.w_size?e.w_size:s,r=e.strstart-e.block_start,(r>=i||(r||t===qr)&&t!==Br&&0===e.strm.avail_in&&r<=s)&&(n=r>s?s:r,a=t===qr&&0===e.strm.avail_in&&n===r?1:0,Or(e,e.block_start,n,a),e.block_start+=n,ms(e.strm)),a?3:1)},vs=(e,t)=>{let n,r;for(;;){if(e.lookahead<ss){if(bs(e),e.lookahead<ss&&t===Br)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=hs(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ss&&(e.match_length=ys(e,n)),e.match_length>=3)if(r=Mr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=hs(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=hs(e,e.ins_h,e.window[e.strstart+1]);else r=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(fs(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===qr?(fs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fs(e,!1),0===e.strm.avail_out)?1:2},Ns=(e,t)=>{let n,r,s;for(;;){if(e.lookahead<ss){if(bs(e),e.lookahead<ss&&t===Br)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=hs(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ss&&(e.match_length=ys(e,n),e.match_length<=5&&(e.strategy===Kr||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,r=Mr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=hs(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(fs(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=Mr(e,0,e.window[e.strstart-1]),r&&fs(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Mr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===qr?(fs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fs(e,!1),0===e.strm.avail_out)?1:2};function Ss(e,t,n,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=s}const As=[new Ss(0,0,0,0,ws),new Ss(4,4,8,4,vs),new Ss(4,5,16,8,vs),new Ss(4,6,32,32,vs),new Ss(4,4,16,16,Ns),new Ss(8,16,32,32,Ns),new Ss(8,16,128,128,Ns),new Ss(8,32,128,256,Ns),new Ss(32,128,258,1024,Ns),new Ss(32,258,258,4096,Ns)];function _s(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ns,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ds(this.dyn_ltree),ds(this.dyn_dtree),ds(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ds(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ds(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Cs=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==is&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==as&&t.status!==os?1:0},Is=e=>{if(Cs(e))return ls(e,Gr);e.total_in=e.total_out=0,e.data_type=ts;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?is:as,e.adler=2===t.wrap?0:1,t.last_flush=-2,Rr(t),Vr},Es=e=>{const t=Is(e);return t===Vr&&(e=>{e.window_size=2*e.w_size,ds(e.head),e.max_lazy_match=As[e.level].max_lazy,e.good_match=As[e.level].good_length,e.nice_match=As[e.level].nice_length,e.max_chain_length=As[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},Ts=(e,t,n,r,s,i)=>{if(!e)return Gr;let a=1;if(t===Qr&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),s<1||s>9||n!==ns||r<8||r>15||t<0||t>9||i<0||i>$r||8===r&&1!==a)return ls(e,Gr);8===r&&(r=9);const o=new _s;return e.state=o,o.strm=e,o.status=is,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=n,Es(e)};var js=(e,t)=>{if(Cs(e)||t>Hr||t<0)return e?ls(e,Gr):Gr;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===os&&t!==qr)return ls(e,0===e.avail_out?Xr:Gr);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ms(e),0===e.avail_out)return n.last_flush=-1,Vr}else if(0===e.avail_in&&cs(t)<=cs(r)&&t!==qr)return ls(e,Xr);if(n.status===os&&0!==e.avail_in)return ls(e,Xr);if(n.status===is&&0===n.wrap&&(n.status=as),n.status===is){let t=ns+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=Zr||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,gs(n,t),0!==n.strstart&&(gs(n,e.adler>>>16),gs(n,65535&e.adler)),e.adler=1,n.status=as,ms(e),0!==n.pending)return n.last_flush=-1,Vr}if(57===n.status)if(e.adler=0,ps(n,31),ps(n,139),ps(n,8),n.gzhead)ps(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ps(n,255&n.gzhead.time),ps(n,n.gzhead.time>>8&255),ps(n,n.gzhead.time>>16&255),ps(n,n.gzhead.time>>24&255),ps(n,9===n.level?2:n.strategy>=Zr||n.level<2?4:0),ps(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(ps(n,255&n.gzhead.extra.length),ps(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=kr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(ps(n,0),ps(n,0),ps(n,0),ps(n,0),ps(n,0),ps(n,9===n.level?2:n.strategy>=Zr||n.level<2?4:0),ps(n,3),n.status=as,ms(e),0!==n.pending)return n.last_flush=-1,Vr;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=kr(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,ms(e),0!==n.pending)return n.last_flush=-1,Vr;t=0,r-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=kr(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=kr(e.adler,n.pending_buf,n.pending-r,r)),ms(e),0!==n.pending)return n.last_flush=-1,Vr;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,ps(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=kr(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=kr(e.adler,n.pending_buf,n.pending-r,r)),ms(e),0!==n.pending)return n.last_flush=-1,Vr;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,ps(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=kr(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ms(e),0!==n.pending))return n.last_flush=-1,Vr;ps(n,255&e.adler),ps(n,e.adler>>8&255),e.adler=0}if(n.status=as,ms(e),0!==n.pending)return n.last_flush=-1,Vr}if(0!==e.avail_in||0!==n.lookahead||t!==Br&&n.status!==os){let r=0===n.level?ws(n,t):n.strategy===Zr?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(bs(e),0===e.lookahead)){if(t===Br)return 1;break}if(e.match_length=0,n=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(fs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===qr?(fs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fs(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Jr?((e,t)=>{let n,r,s,i;const a=e.window;for(;;){if(e.lookahead<=rs){if(bs(e),e.lookahead<=rs&&t===Br)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,r=a[s],r===a[++s]&&r===a[++s]&&r===a[++s])){i=e.strstart+rs;do{}while(r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&s<i);e.match_length=rs-(i-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Mr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(fs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===qr?(fs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fs(e,!1),0===e.strm.avail_out)?1:2})(n,t):As[n.level].func(n,t);if(3!==r&&4!==r||(n.status=os),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Vr;if(2===r&&(t===Ur?Fr(n):t!==Hr&&(Or(n,0,0,!1),t===zr&&(ds(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ms(e),0===e.avail_out))return n.last_flush=-1,Vr}return t!==qr?Vr:n.wrap<=0?Wr:(2===n.wrap?(ps(n,255&e.adler),ps(n,e.adler>>8&255),ps(n,e.adler>>16&255),ps(n,e.adler>>24&255),ps(n,255&e.total_in),ps(n,e.total_in>>8&255),ps(n,e.total_in>>16&255),ps(n,e.total_in>>24&255)):(gs(n,e.adler>>>16),gs(n,65535&e.adler)),ms(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Vr:Wr)},ks=(e,t)=>{let n=t.length;if(Cs(e))return Gr;const r=e.state,s=r.wrap;if(2===s||1===s&&r.status!==is||r.lookahead)return Gr;if(1===s&&(e.adler=Tr(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===s&&(ds(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const i=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,bs(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=hs(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,bs(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=i,r.wrap=s,Vr},Ds={deflateInit:(e,t)=>Ts(e,t,ns,15,8,es),deflateInit2:Ts,deflateReset:Es,deflateResetKeep:Is,deflateSetHeader:(e,t)=>Cs(e)||2!==e.state.wrap?Gr:(e.state.gzhead=t,Vr),deflate:js,deflateEnd:e=>{if(Cs(e))return Gr;const t=e.state.status;return e.state=null,t===as?ls(e,Yr):Vr},deflateSetDictionary:ks,deflateInfo:"pako deflate (from Nodeca project)"};const Ps=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Rs=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ps(n,t)&&(e[t]=n[t])}}return e},Os=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,s=0,i=e.length;r<i;r++){let t=e[r];n.set(t,s),s+=t.length}return n};let Ls=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Hb){Ls=!1}const Ms=new Uint8Array(256);for(let n=0;n<256;n++)Ms[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Ms[254]=Ms[254]=1;var Fs=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,s,i,a=e.length,o=0;for(s=0;s<a;s++)n=e.charCodeAt(s),55296===(64512&n)&&s+1<a&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),i=0,s=0;i<o;s++)n=e.charCodeAt(s),55296===(64512&n)&&s+1<a&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},Bs=(e,t)=>{const n=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,s;const i=new Array(2*n);for(s=0,r=0;r<n;){let t=e[r++];if(t<128){i[s++]=t;continue}let a=Ms[t];if(a>4)i[s++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?i[s++]=65533:t<65536?i[s++]=t:(t-=65536,i[s++]=55296|t>>10&1023,i[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ls)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(i,s)},Us=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+Ms[e[n]]>t?n:t};var zs=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qs=Object.prototype.toString,{Z_NO_FLUSH:Hs,Z_SYNC_FLUSH:Vs,Z_FULL_FLUSH:Ws,Z_FINISH:Gs,Z_OK:Ys,Z_STREAM_END:Xs,Z_DEFAULT_COMPRESSION:Qs,Z_DEFAULT_STRATEGY:Ks,Z_DEFLATED:Zs}=Pr;function Js(e){this.options=Rs({level:Qs,method:Zs,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ks},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zs,this.strm.avail_out=0;let n=Ds.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Ys)throw new Error(Dr[n]);if(t.header&&Ds.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?Fs(t.dictionary):"[object ArrayBuffer]"===qs.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Ds.deflateSetDictionary(this.strm,e),n!==Ys)throw new Error(Dr[n]);this._dict_set=!0}}function $s(e,t){const n=new Js(t);if(n.push(e,!0),n.err)throw n.msg||Dr[n.err];return n.result}Js.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let s,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Gs:Hs,"string"===typeof e?n.input=Fs(e):"[object ArrayBuffer]"===qs.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(i===Vs||i===Ws)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=Ds.deflate(n,i),s===Xs)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=Ds.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Ys;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Js.prototype.onData=function(e){this.chunks.push(e)},Js.prototype.onEnd=function(e){e===Ys&&(this.result=Os(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ei={Deflate:Js,deflate:$s,deflateRaw:function(e,t){return(t=t||{}).raw=!0,$s(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,$s(e,t)},constants:Pr};const ti=16209;var ni=function(e,t){let n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b,w,v,N,S,A,_;const C=e.state;n=e.next_in,A=e.input,r=n+(e.avail_in-5),s=e.next_out,_=e.output,i=s-(t-e.avail_out),a=s+(e.avail_out-257),o=C.dmax,l=C.wsize,c=C.whave,d=C.wnext,u=C.window,h=C.hold,m=C.bits,f=C.lencode,p=C.distcode,g=(1<<C.lenbits)-1,x=(1<<C.distbits)-1;e:do{m<15&&(h+=A[n++]<<m,m+=8,h+=A[n++]<<m,m+=8),y=f[h&g];t:for(;;){if(b=y>>>24,h>>>=b,m-=b,b=y>>>16&255,0===b)_[s++]=65535&y;else{if(!(16&b)){if(0===(64&b)){y=f[(65535&y)+(h&(1<<b)-1)];continue t}if(32&b){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=ti;break e}w=65535&y,b&=15,b&&(m<b&&(h+=A[n++]<<m,m+=8),w+=h&(1<<b)-1,h>>>=b,m-=b),m<15&&(h+=A[n++]<<m,m+=8,h+=A[n++]<<m,m+=8),y=p[h&x];n:for(;;){if(b=y>>>24,h>>>=b,m-=b,b=y>>>16&255,!(16&b)){if(0===(64&b)){y=p[(65535&y)+(h&(1<<b)-1)];continue n}e.msg="invalid distance code",C.mode=ti;break e}if(v=65535&y,b&=15,m<b&&(h+=A[n++]<<m,m+=8,m<b&&(h+=A[n++]<<m,m+=8)),v+=h&(1<<b)-1,v>o){e.msg="invalid distance too far back",C.mode=ti;break e}if(h>>>=b,m-=b,b=s-i,v>b){if(b=v-b,b>c&&C.sane){e.msg="invalid distance too far back",C.mode=ti;break e}if(N=0,S=u,0===d){if(N+=l-b,b<w){w-=b;do{_[s++]=u[N++]}while(--b);N=s-v,S=_}}else if(d<b){if(N+=l+d-b,b-=d,b<w){w-=b;do{_[s++]=u[N++]}while(--b);if(N=0,d<w){b=d,w-=b;do{_[s++]=u[N++]}while(--b);N=s-v,S=_}}}else if(N+=d-b,b<w){w-=b;do{_[s++]=u[N++]}while(--b);N=s-v,S=_}for(;w>2;)_[s++]=S[N++],_[s++]=S[N++],_[s++]=S[N++],w-=3;w&&(_[s++]=S[N++],w>1&&(_[s++]=S[N++]))}else{N=s-v;do{_[s++]=_[N++],_[s++]=_[N++],_[s++]=_[N++],w-=3}while(w>2);w&&(_[s++]=_[N++],w>1&&(_[s++]=_[N++]))}break}}break}}while(n<r&&s<a);w=m>>3,n-=w,m-=w<<3,h&=(1<<m)-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=s<a?a-s+257:257-(s-a),C.hold=h,C.bits=m};const ri=15,si=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ii=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ai=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),oi=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var li=(e,t,n,r,s,i,a,o)=>{const l=o.bits;let c,d,u,h,m,f,p=0,g=0,x=0,y=0,b=0,w=0,v=0,N=0,S=0,A=0,_=null;const C=new Uint16Array(16),I=new Uint16Array(16);let E,T,j,k=null;for(p=0;p<=ri;p++)C[p]=0;for(g=0;g<r;g++)C[t[n+g]]++;for(b=l,y=ri;y>=1&&0===C[y];y--);if(b>y&&(b=y),0===y)return s[i++]=20971520,s[i++]=20971520,o.bits=1,0;for(x=1;x<y&&0===C[x];x++);for(b<x&&(b=x),N=1,p=1;p<=ri;p++)if(N<<=1,N-=C[p],N<0)return-1;if(N>0&&(0===e||1!==y))return-1;for(I[1]=0,p=1;p<ri;p++)I[p+1]=I[p]+C[p];for(g=0;g<r;g++)0!==t[n+g]&&(a[I[t[n+g]]++]=g);if(0===e?(_=k=a,f=20):1===e?(_=si,k=ii,f=257):(_=ai,k=oi,f=0),A=0,g=0,p=x,m=i,w=b,v=0,u=-1,S=1<<b,h=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){E=p-v,a[g]+1<f?(T=0,j=a[g]):a[g]>=f?(T=k[a[g]-f],j=_[a[g]-f]):(T=96,j=0),c=1<<p-v,d=1<<w,x=d;do{d-=c,s[m+(A>>v)+d]=E<<24|T<<16|j}while(0!==d);for(c=1<<p-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,g++,0===--C[p]){if(p===y)break;p=t[n+a[g]]}if(p>b&&(A&h)!==u){for(0===v&&(v=b),m+=x,w=p-v,N=1<<w;w+v<y&&(N-=C[w+v],!(N<=0));)w++,N<<=1;if(S+=1<<w,1===e&&S>852||2===e&&S>592)return 1;u=A&h,s[u]=b<<24|w<<16|m-i}}return 0!==A&&(s[m+A]=p-v<<24|64<<16),o.bits=b,0};const{Z_FINISH:ci,Z_BLOCK:di,Z_TREES:ui,Z_OK:hi,Z_STREAM_END:mi,Z_NEED_DICT:fi,Z_STREAM_ERROR:pi,Z_DATA_ERROR:gi,Z_MEM_ERROR:xi,Z_BUF_ERROR:yi,Z_DEFLATED:bi}=Pr,wi=16180,vi=16190,Ni=16191,Si=16192,Ai=16194,_i=16199,Ci=16200,Ii=16206,Ei=16209,Ti=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ji(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ki=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<wi||t.mode>16211?1:0},Di=e=>{if(ki(e))return pi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=wi,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,hi},Pi=e=>{if(ki(e))return pi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Di(e)},Ri=(e,t)=>{let n;if(ki(e))return pi;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?pi:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Pi(e))},Oi=(e,t)=>{if(!e)return pi;const n=new ji;e.state=n,n.strm=e,n.window=null,n.mode=wi;const r=Ri(e,t);return r!==hi&&(e.state=null),r};let Li,Mi,Fi=!0;const Bi=e=>{if(Fi){Li=new Int32Array(512),Mi=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(li(1,e.lens,0,288,Li,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;li(2,e.lens,0,32,Mi,0,e.work,{bits:5}),Fi=!1}e.lencode=Li,e.lenbits=9,e.distcode=Mi,e.distbits=5},Ui=(e,t,n,r)=>{let s;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>r&&(s=r),i.window.set(t.subarray(n-r,n-r+s),i.wnext),(r-=s)?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0};var zi=(e,t)=>{let n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b,w,v,N,S,A=0;const _=new Uint8Array(4);let C,I;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ki(e)||!e.output||!e.input&&0!==e.avail_in)return pi;n=e.state,n.mode===Ni&&(n.mode=Si),a=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,d=n.bits,u=o,h=l,S=hi;e:for(;;)switch(n.mode){case wi:if(0===n.wrap){n.mode=Si;break}for(;d<16;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,_[0]=255&c,_[1]=c>>>8&255,n.check=kr(n.check,_,2,0),c=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Ei;break}if((15&c)!==bi){e.msg="unknown compression method",n.mode=Ei;break}if(c>>>=4,d-=4,N=8+(15&c),0===n.wbits&&(n.wbits=N),N>15||N>n.wbits){e.msg="invalid window size",n.mode=Ei;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Ni,c=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==bi){e.msg="unknown compression method",n.mode=Ei;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Ei;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(_[0]=255&c,_[1]=c>>>8&255,n.check=kr(n.check,_,2,0)),c=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(_[0]=255&c,_[1]=c>>>8&255,_[2]=c>>>16&255,_[3]=c>>>24&255,n.check=kr(n.check,_,4,0)),c=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(_[0]=255&c,_[1]=c>>>8&255,n.check=kr(n.check,_,2,0)),c=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(_[0]=255&c,_[1]=c>>>8&255,n.check=kr(n.check,_,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(m=n.length,m>o&&(m=o),m&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+m),N)),512&n.flags&&4&n.wrap&&(n.check=kr(n.check,r,m,i)),o-=m,i+=m,n.length-=m),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;m=0;do{N=r[i+m++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N))}while(N&&m<o);if(512&n.flags&&4&n.wrap&&(n.check=kr(n.check,r,m,i)),o-=m,i+=m,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;m=0;do{N=r[i+m++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N))}while(N&&m<o);if(512&n.flags&&4&n.wrap&&(n.check=kr(n.check,r,m,i)),o-=m,i+=m,N)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Ei;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Ni;break;case 16189:for(;d<32;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}e.adler=n.check=Ti(c),c=0,d=0,n.mode=vi;case vi:if(0===n.havedict)return e.next_out=a,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=d,fi;e.adler=n.check=1,n.mode=Ni;case Ni:if(t===di||t===ui)break e;case Si:if(n.last){c>>>=7&d,d-=7&d,n.mode=Ii;break}for(;d<3;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=16193;break;case 1:if(Bi(n),n.mode=_i,t===ui){c>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Ei}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Ei;break}if(n.length=65535&c,c=0,d=0,n.mode=Ai,t===ui)break e;case Ai:n.mode=16195;case 16195:if(m=n.length,m){if(m>o&&(m=o),m>l&&(m=l),0===m)break e;s.set(r.subarray(i,i+m),a),o-=m,i+=m,l-=m,a+=m,n.length-=m;break}n.mode=Ni;break;case 16196:for(;d<14;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Ei;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.lens[E[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},S=li(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid code lengths set",n.mode=Ei;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;A=n.lencode[c&(1<<n.lenbits)-1],g=A>>>24,x=A>>>16&255,y=65535&A,!(g<=d);){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(y<16)c>>>=g,d-=g,n.lens[n.have++]=y;else{if(16===y){for(I=g+2;d<I;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(c>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=Ei;break}N=n.lens[n.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===y){for(I=g+3;d<I;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}c>>>=g,d-=g,N=0,m=3+(7&c),c>>>=3,d-=3}else{for(I=g+7;d<I;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}c>>>=g,d-=g,N=0,m=11+(127&c),c>>>=7,d-=7}if(n.have+m>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Ei;break}for(;m--;)n.lens[n.have++]=N}}if(n.mode===Ei)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Ei;break}if(n.lenbits=9,C={bits:n.lenbits},S=li(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid literal/lengths set",n.mode=Ei;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},S=li(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,S){e.msg="invalid distances set",n.mode=Ei;break}if(n.mode=_i,t===ui)break e;case _i:n.mode=Ci;case Ci:if(o>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=d,ni(e,h),a=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,d=n.bits,n.mode===Ni&&(n.back=-1);break}for(n.back=0;A=n.lencode[c&(1<<n.lenbits)-1],g=A>>>24,x=A>>>16&255,y=65535&A,!(g<=d);){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(x&&0===(240&x)){for(b=g,w=x,v=y;A=n.lencode[v+((c&(1<<b+w)-1)>>b)],g=A>>>24,x=A>>>16&255,y=65535&A,!(b+g<=d);){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=g,d-=g,n.back+=g,n.length=y,0===x){n.mode=16205;break}if(32&x){n.back=-1,n.mode=Ni;break}if(64&x){e.msg="invalid literal/length code",n.mode=Ei;break}n.extra=15&x,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;d<I;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;A=n.distcode[c&(1<<n.distbits)-1],g=A>>>24,x=A>>>16&255,y=65535&A,!(g<=d);){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(0===(240&x)){for(b=g,w=x,v=y;A=n.distcode[v+((c&(1<<b+w)-1)>>b)],g=A>>>24,x=A>>>16&255,y=65535&A,!(b+g<=d);){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=g,d-=g,n.back+=g,64&x){e.msg="invalid distance code",n.mode=Ei;break}n.offset=y,n.extra=15&x,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;d<I;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Ei;break}n.mode=16204;case 16204:if(0===l)break e;if(m=h-l,n.offset>m){if(m=n.offset-m,m>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Ei;break}m>n.wnext?(m-=n.wnext,f=n.wsize-m):f=n.wnext-m,m>n.length&&(m=n.length),p=n.window}else p=s,f=a-n.offset,m=n.length;m>l&&(m=l),l-=m,n.length-=m;do{s[a++]=p[f++]}while(--m);0===n.length&&(n.mode=Ci);break;case 16205:if(0===l)break e;s[a++]=n.length,l--,n.mode=Ci;break;case Ii:if(n.wrap){for(;d<32;){if(0===o)break e;o--,c|=r[i++]<<d,d+=8}if(h-=l,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?kr(n.check,s,h,a-h):Tr(n.check,s,h,a-h)),h=l,4&n.wrap&&(n.flags?c:Ti(c))!==n.check){e.msg="incorrect data check",n.mode=Ei;break}c=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===o)break e;o--,c+=r[i++]<<d,d+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Ei;break}c=0,d=0}n.mode=16208;case 16208:S=mi;break e;case Ei:S=gi;break e;case 16210:return xi;default:return pi}return e.next_out=a,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<Ei&&(n.mode<Ii||t!==ci))&&Ui(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?kr(n.check,s,h,e.next_out-h):Tr(n.check,s,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Ni?128:0)+(n.mode===_i||n.mode===Ai?256:0),(0===u&&0===h||t===ci)&&S===hi&&(S=yi),S},qi={inflateReset:Pi,inflateReset2:Ri,inflateResetKeep:Di,inflateInit:e=>Oi(e,15),inflateInit2:Oi,inflate:zi,inflateEnd:e=>{if(ki(e))return pi;let t=e.state;return t.window&&(t.window=null),e.state=null,hi},inflateGetHeader:(e,t)=>{if(ki(e))return pi;const n=e.state;return 0===(2&n.wrap)?pi:(n.head=t,t.done=!1,hi)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,s,i;return ki(e)?pi:(r=e.state,0!==r.wrap&&r.mode!==vi?pi:r.mode===vi&&(s=1,s=Tr(s,t,n,0),s!==r.check)?gi:(i=Ui(e,t,n,n),i?(r.mode=16210,xi):(r.havedict=1,hi)))},inflateInfo:"pako inflate (from Nodeca project)"};var Hi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Vi=Object.prototype.toString,{Z_NO_FLUSH:Wi,Z_FINISH:Gi,Z_OK:Yi,Z_STREAM_END:Xi,Z_NEED_DICT:Qi,Z_STREAM_ERROR:Ki,Z_DATA_ERROR:Zi,Z_MEM_ERROR:Ji}=Pr;function $i(e){this.options=Rs({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zs,this.strm.avail_out=0;let n=qi.inflateInit2(this.strm,t.windowBits);if(n!==Yi)throw new Error(Dr[n]);if(this.header=new Hi,qi.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=Fs(t.dictionary):"[object ArrayBuffer]"===Vi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=qi.inflateSetDictionary(this.strm,t.dictionary),n!==Yi)))throw new Error(Dr[n])}function ea(e,t){const n=new $i(t);if(n.push(e),n.err)throw n.msg||Dr[n.err];return n.result}$i.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let i,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Gi:Wi,"[object ArrayBuffer]"===Vi.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=qi.inflate(n,a),i===Qi&&s&&(i=qi.inflateSetDictionary(n,s),i===Yi?i=qi.inflate(n,a):i===Zi&&(i=Qi));n.avail_in>0&&i===Xi&&n.state.wrap>0&&0!==e[n.next_in];)qi.inflateReset(n),i=qi.inflate(n,a);switch(i){case Ki:case Zi:case Qi:case Ji:return this.onEnd(i),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||i===Xi))if("string"===this.options.to){let e=Us(n.output,n.next_out),t=n.next_out-e,s=Bs(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==Yi||0!==o){if(i===Xi)return i=qi.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},$i.prototype.onData=function(e){this.chunks.push(e)},$i.prototype.onEnd=function(e){e===Yi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Os(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ta={Inflate:$i,inflate:ea,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ea(e,t)},ungzip:ea,constants:Pr};const{Deflate:na,deflate:ra,deflateRaw:sa,gzip:ia}=ei,{Inflate:aa,inflate:oa,inflateRaw:la,ungzip:ca}=ta;var da=aa,ua=oa;const ha=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;ha[n]=e}const ma=4294967295;function fa(e,t){return(function(e,t,n){let r=e;for(let s=0;s<n;s++)r=ha[255&(r^t[s])]^r>>>8;return r}(ma,e,t)^ma)>>>0}function pa(e,t,n){const r=e.readUint32(),s=fa(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(s!==r)throw new Error("CRC mismatch for chunk ".concat(n,". Expected ").concat(r,", found ").concat(s))}function ga(e,t,n){for(let r=0;r<n;r++)t[r]=e[r]}function xa(e,t,n,r){let s=0;for(;s<r;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-r]&255}function ya(e,t,n,r){let s=0;if(0===n.length)for(;s<r;s++)t[s]=e[s];else for(;s<r;s++)t[s]=e[s]+n[s]&255}function ba(e,t,n,r,s){let i=0;if(0===n.length){for(;i<s;i++)t[i]=e[i];for(;i<r;i++)t[i]=e[i]+(t[i-s]>>1)&255}else{for(;i<s;i++)t[i]=e[i]+(n[i]>>1)&255;for(;i<r;i++)t[i]=e[i]+(t[i-s]+n[i]>>1)&255}}function wa(e,t,n,r,s){let i=0;if(0===n.length){for(;i<s;i++)t[i]=e[i];for(;i<r;i++)t[i]=e[i]+t[i-s]&255}else{for(;i<s;i++)t[i]=e[i]+n[i]&255;for(;i<r;i++)t[i]=e[i]+va(t[i-s],n[i],n[i-s])&255}}function va(e,t,n){const r=e+t-n,s=Math.abs(r-e),i=Math.abs(r-t),a=Math.abs(r-n);return s<=i&&s<=a?e:i<=a?t:n}function Na(e,t,n,r,s,i){switch(e){case 0:ga(t,n,s);break;case 1:xa(t,n,s,i);break;case 2:ya(t,n,r,s);break;case 3:ba(t,n,r,s,i);break;case 4:wa(t,n,r,s,i);break;default:throw new Error("Unsupported filter: ".concat(e))}}const Sa=new Uint16Array([255]),Aa=255===new Uint8Array(Sa.buffer)[0];function _a(e){return(255&e)<<8|e>>8&255}const Ca=new Uint16Array([255]),Ia=255===new Uint8Array(Ca.buffer)[0],Ea=new Uint8Array(0);function Ta(e){const{data:t,width:n,height:r,channels:s,depth:i}=e,a=Math.ceil(i/8)*s,o=Math.ceil(i/8*s*n),l=new Uint8Array(r*o);let c,d,u=Ea,h=0;for(let m=0;m<r;m++){switch(c=t.subarray(h+1,h+1+o),d=l.subarray(m*o,(m+1)*o),t[h]){case 0:ga(c,d,o);break;case 1:xa(c,d,o,a);break;case 2:ya(c,d,u,o);break;case 3:ba(c,d,u,o,a);break;case 4:wa(c,d,u,o,a);break;default:throw new Error("Unsupported filter: ".concat(t[h]))}u=d,h+=o+1}if(16===i){const e=new Uint16Array(l.buffer);if(Ia)for(let t=0;t<e.length;t++)e[t]=ja(e[t]);return e}return l}function ja(e){return(255&e)<<8|e>>8&255}const ka=Uint8Array.of(137,80,78,71,13,10,26,10);function Da(e){if(!function(e){if(e.length<ka.length)return!1;for(let t=0;t<ka.length;t++)if(e[t]!==ka[t])return!1;return!0}(e.readBytes(ka.length)))throw new Error("wrong PNG signature")}const Pa="tEXt",Ra=new TextDecoder("latin1");function Oa(e){if(Ma(e),0===e.length||e.length>79)throw new Error("keyword length must be between 1 and 79")}const La=/^[\u0000-\u00FF]*$/;function Ma(e){if(!La.test(e))throw new Error("invalid latin1 text")}function Fa(e,t,n){const r=Ba(t);e[r]=function(e,t){return Ra.decode(e.readBytes(t))}(t,n-r.length-1)}function Ba(e){for(e.mark();0!==e.readByte(););const t=e.offset;e.reset();const n=Ra.decode(e.readBytes(t-e.offset-1));return e.skip(1),Oa(n),n}const Ua=-1,za=0,qa=2,Ha=3,Va=4,Wa=6,Ga=-1,Ya=0,Xa=-1,Qa=0,Ka=-1,Za=0,Ja=1,$a=0,eo=1,to=2,no=0,ro=1;class so extends zn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),(0,Ln.A)(this,"_checkCrc",void 0),(0,Ln.A)(this,"_inflator",void 0),(0,Ln.A)(this,"_png",void 0),(0,Ln.A)(this,"_apng",void 0),(0,Ln.A)(this,"_end",void 0),(0,Ln.A)(this,"_hasPalette",void 0),(0,Ln.A)(this,"_palette",void 0),(0,Ln.A)(this,"_hasTransparency",void 0),(0,Ln.A)(this,"_transparency",void 0),(0,Ln.A)(this,"_compressionMethod",void 0),(0,Ln.A)(this,"_filterMethod",void 0),(0,Ln.A)(this,"_interlaceMethod",void 0),(0,Ln.A)(this,"_colorType",void 0),(0,Ln.A)(this,"_isAnimated",void 0),(0,Ln.A)(this,"_numberOfFrames",void 0),(0,Ln.A)(this,"_numberOfPlays",void 0),(0,Ln.A)(this,"_frames",void 0),(0,Ln.A)(this,"_writingDataChunks",void 0);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new da,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Ga,this._filterMethod=Xa,this._interlaceMethod=Ka,this._colorType=Ua,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Da(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(Da(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case Pa:Fa(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?pa(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?pa(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error("invalid bit depth: ".concat(e));return e}(this.readUint8());const t=this.readUint8();let n;switch(this._colorType=t,t){case za:n=1;break;case qa:n=3;break;case Ha:n=1;break;case Va:n=2;break;case Wa:n=4;break;default:throw new Error("Unknown color type: ".concat(t))}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==Ya)throw new Error("Unsupported compression method: ".concat(this._compressionMethod));this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError("PLTE field length must be a multiple of 3. Got ".concat(e));const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodetRNS(e){switch(this._colorType){case za:case qa:if(e%2!==0)throw new RangeError("tRNS chunk length must be a multiple of 2. Got ".concat(e));if(e/2>this._png.width*this._png.height)throw new Error("tRNS chunk contains more alpha values than there are pixels (".concat(e/2," vs ").concat(this._png.width*this._png.height,")"));this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case Ha:{if(e>this._palette.length)throw new Error("tRNS chunk contains more alpha values than there are palette colors (".concat(e," vs ").concat(this._palette.length,")"));let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error("tRNS chunk is not supported for color type ".concat(this._colorType))}}decodeiCCP(e){const t=Ba(this),n=this.readUint8();if(n!==Ya)throw new Error("Unsupported iCCP compression method: ".concat(n));const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:ua(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=Ta({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case $a:break;case eo:for(let t=0;t<this._png.height;t++)for(let r=0;r<this._png.width;r++){const s=(t*e.width+r)*this._png.channels;for(let e=0;e<this._png.channels;e++)n.data[s+e]=0}break;case to:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(e,n)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+n)*this._png.channels,frameIndex:(e*t.width+n)*this._png.channels});switch(t.blendOp){case no:for(let n=0;n<t.height;n++)for(let s=0;s<t.width;s++){const{index:i,frameIndex:a}=r(n,s);for(let n=0;n<this._png.channels;n++)e.data[i+n]=t.data[a+n]}break;case ro:for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const{index:a,frameIndex:o}=r(s,i);for(let r=0;r<this._png.channels;r++){const s=t.data[o+this._png.channels-1]/n,i=r%(this._png.channels-1)===0?1:t.data[o+r],l=Math.floor(s*i+(1-s)*e.data[a+r]);e.data[a+r]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var e;if(this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));const t=this._isAnimated?(null===(e=this._frames)||void 0===e?void 0:e.at(0)).data:this._inflator.result;if(this._filterMethod!==Qa)throw new Error("Filter method ".concat(this._filterMethod," not supported"));if(this._interlaceMethod===Za)this._png.data=Ta({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==Ja)throw new Error("Interlace method ".concat(this._interlaceMethod," not supported"));this._png.data=function(e){const{data:t,width:n,height:r,channels:s,depth:i}=e,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(i/8)*s,l=new Uint8Array(r*n*o);let c=0;for(let d=0;d<7;d++){const e=a[d],s=Math.ceil((n-e.x)/e.xStep),i=Math.ceil((r-e.y)/e.yStep);if(s<=0||i<=0)continue;const u=s*o,h=new Uint8Array(u);for(let a=0;a<i;a++){const i=t[c++],d=t.subarray(c,c+u);c+=u;const m=new Uint8Array(u);Na(i,d,m,h,u,o),h.set(m);for(let t=0;t<s;t++){const s=e.x+t*e.xStep,i=e.y+a*e.yStep;if(!(s>=n||i>=r))for(let e=0;e<o;e++)l[(i*n+s)*o+e]=m[t*o+e]}}}if(16===i){const e=new Uint16Array(l.buffer);if(Aa)for(let t=0;t<e.length;t++)e[t]=_a(e[t]);return e}return l}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:$a,blendOp:no,data:e}),this._inflator=new da,this._writingDataChunks=!1}}var io;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(io||(io={}));var ao=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function oo(){ao.console&&"function"==typeof ao.console.log&&ao.console.log.apply(ao.console,arguments)}var lo={log:oo,warn:function(e){ao.console&&("function"==typeof ao.console.warn?ao.console.warn.apply(ao.console,arguments):oo.call(null,arguments))},error:function(e){ao.console&&("function"==typeof ao.console.error?ao.console.error.apply(ao.console,arguments):oo(e))}};function co(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){mo(r.response,t,n)},r.onerror=function(){lo.error("could not download file")},r.send()}function uo(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(n){}return t.status>=200&&t.status<=299}function ho(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var mo=ao.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,Yt.A)(window))||window!==ao?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=ao.URL||ao.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener","string"==typeof e?(s.href=e,s.origin!==location.origin?uo(s.href)?co(e,t,n):ho(s,s.target="_blank"):ho(s)):(s.href=r.createObjectURL(e),setTimeout(function(){r.revokeObjectURL(s.href)},4e4),setTimeout(function(){ho(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(uo(e))co(e,t,n);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout(function(){ho(r)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,Yt.A)(t)&&(lo.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return co(e,t,n);var s="application/octet-stream"===e.type,i=/constructor/i.test(ao.HTMLElement)||ao.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||s&&i)&&"object"===("undefined"==typeof FileReader?"undefined":(0,Yt.A)(FileReader))){var o=new FileReader;o.onloadend=function(){var e=o.result;e=a?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},o.readAsDataURL(e)}else{var l=ao.URL||ao.webkitURL,c=l.createObjectURL(e);r?r.location=c:location.href=c,r=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function fo(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<n.length;r++){var s=n[r].re,i=n[r].process,a=s.exec(e);a&&(t=i(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}}var po=ao.atob.bind(ao),go=ao.btoa.bind(ao);function xo(e,t){var n=e[0],r=e[1],s=e[2],i=e[3];n=bo(n,r,s,i,t[0],7,-680876936),i=bo(i,n,r,s,t[1],12,-389564586),s=bo(s,i,n,r,t[2],17,606105819),r=bo(r,s,i,n,t[3],22,-1044525330),n=bo(n,r,s,i,t[4],7,-176418897),i=bo(i,n,r,s,t[5],12,1200080426),s=bo(s,i,n,r,t[6],17,-1473231341),r=bo(r,s,i,n,t[7],22,-45705983),n=bo(n,r,s,i,t[8],7,1770035416),i=bo(i,n,r,s,t[9],12,-1958414417),s=bo(s,i,n,r,t[10],17,-42063),r=bo(r,s,i,n,t[11],22,-1990404162),n=bo(n,r,s,i,t[12],7,1804603682),i=bo(i,n,r,s,t[13],12,-40341101),s=bo(s,i,n,r,t[14],17,-1502002290),n=wo(n,r=bo(r,s,i,n,t[15],22,1236535329),s,i,t[1],5,-165796510),i=wo(i,n,r,s,t[6],9,-1069501632),s=wo(s,i,n,r,t[11],14,643717713),r=wo(r,s,i,n,t[0],20,-373897302),n=wo(n,r,s,i,t[5],5,-701558691),i=wo(i,n,r,s,t[10],9,38016083),s=wo(s,i,n,r,t[15],14,-660478335),r=wo(r,s,i,n,t[4],20,-405537848),n=wo(n,r,s,i,t[9],5,568446438),i=wo(i,n,r,s,t[14],9,-1019803690),s=wo(s,i,n,r,t[3],14,-187363961),r=wo(r,s,i,n,t[8],20,1163531501),n=wo(n,r,s,i,t[13],5,-1444681467),i=wo(i,n,r,s,t[2],9,-51403784),s=wo(s,i,n,r,t[7],14,1735328473),n=vo(n,r=wo(r,s,i,n,t[12],20,-1926607734),s,i,t[5],4,-378558),i=vo(i,n,r,s,t[8],11,-2022574463),s=vo(s,i,n,r,t[11],16,1839030562),r=vo(r,s,i,n,t[14],23,-35309556),n=vo(n,r,s,i,t[1],4,-1530992060),i=vo(i,n,r,s,t[4],11,1272893353),s=vo(s,i,n,r,t[7],16,-155497632),r=vo(r,s,i,n,t[10],23,-1094730640),n=vo(n,r,s,i,t[13],4,681279174),i=vo(i,n,r,s,t[0],11,-358537222),s=vo(s,i,n,r,t[3],16,-722521979),r=vo(r,s,i,n,t[6],23,76029189),n=vo(n,r,s,i,t[9],4,-640364487),i=vo(i,n,r,s,t[12],11,-421815835),s=vo(s,i,n,r,t[15],16,530742520),n=No(n,r=vo(r,s,i,n,t[2],23,-995338651),s,i,t[0],6,-198630844),i=No(i,n,r,s,t[7],10,1126891415),s=No(s,i,n,r,t[14],15,-1416354905),r=No(r,s,i,n,t[5],21,-57434055),n=No(n,r,s,i,t[12],6,1700485571),i=No(i,n,r,s,t[3],10,-1894986606),s=No(s,i,n,r,t[10],15,-1051523),r=No(r,s,i,n,t[1],21,-2054922799),n=No(n,r,s,i,t[8],6,1873313359),i=No(i,n,r,s,t[15],10,-30611744),s=No(s,i,n,r,t[6],15,-1560198380),r=No(r,s,i,n,t[13],21,1309151649),n=No(n,r,s,i,t[4],6,-145523070),i=No(i,n,r,s,t[11],10,-1120210379),s=No(s,i,n,r,t[2],15,718787259),r=No(r,s,i,n,t[9],21,-343485551),e[0]=jo(n,e[0]),e[1]=jo(r,e[1]),e[2]=jo(s,e[2]),e[3]=jo(i,e[3])}function yo(e,t,n,r,s,i){return t=jo(jo(t,e),jo(r,i)),jo(t<<s|t>>>32-s,n)}function bo(e,t,n,r,s,i,a){return yo(t&n|~t&r,e,t,s,i,a)}function wo(e,t,n,r,s,i,a){return yo(t&r|n&~r,e,t,s,i,a)}function vo(e,t,n,r,s,i,a){return yo(t^n^r,e,t,s,i,a)}function No(e,t,n,r,s,i,a){return yo(n^(t|~r),e,t,s,i,a)}function So(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)xo(r,Ao(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(xo(r,s),t=0;t<16;t++)s[t]=0;return s[14]=8*n,xo(r,s),r}function Ao(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var _o="0123456789abcdef".split("");function Co(e){for(var t="",n=0;n<4;n++)t+=_o[e>>8*n+4&15]+_o[e>>8*n&15];return t}function Io(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Eo(e){return So(e).map(Io).join("")}var To="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=Co(e[t]);return e.join("")}(So("hello"));function jo(e,t){if(To){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}return e+t&4294967295}function ko(e,t){var n,r,s,i;if(e!==n){for(var a=(s=e,i=1+(256/e.length|0),new Array(i+1).join(s)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var d=o[l];c=(c+d+a.charCodeAt(l))%256,o[l]=o[c],o[c]=d}n=e,r=o}else o=r;var u=t.length,h=0,m=0,f="";for(l=0;l<u;l++)m=(m+(d=o[h=(h+1)%256]))%256,o[h]=o[m],o[m]=d,a=o[(o[h]+o[m])%256],f+=String.fromCharCode(t.charCodeAt(l)^a);return f}var Do={print:4,modify:8,copy:16,"annot-forms":32};function Po(e,t,n,r){this.v=1,this.r=2;var s=192;e.forEach(function(e){if(void 0!==Do.perm)throw new Error("Invalid permission: "+e);s+=Do[e]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var i=(t+this.padding).substr(0,32),a=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,a),this.P=-(1+(255^s)),this.encryptionKey=Eo(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=ko(this.encryptionKey,this.padding)}function Ro(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",n=e.length,r=0;r<n;r++){var s=e.charCodeAt(r);t+=s<33||35===s||37===s||40===s||41===s||47===s||60===s||62===s||91===s||93===s||123===s||125===s||s>126?"#"+("0"+s.toString(16)).slice(-2):e[r]}return t}function Oo(e){if("object"!==(0,Yt.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,r){if(r=r||!1,"string"!=typeof e||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[n,!!r],s},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],0===Object.keys(t[n]).length&&delete t[n],!0;return!1},this.publish=function(n){if(t.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),s=[];for(var i in t[n]){var a=t[n][i];try{a[0].apply(e,r)}catch(ho){ao.console&&lo.error("jsPDF PubSub Error",ho.message,ho)}a[1]&&s.push(i)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Lo(e){if(!(this instanceof Lo))return new Lo(e);var t="opacity,stroke-opacity".split(",");for(var n in e)e.hasOwnProperty(n)&&t.indexOf(n)>=0&&(this[n]=e[n]);this.id="",this.objectNumber=-1}function Mo(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Fo(e,t,n,r,s){if(!(this instanceof Fo))return new Fo(e,t,n,r,s);this.type="axial"===e?2:3,this.coords=t,this.colors=n,Mo.call(this,r,s)}function Bo(e,t,n,r,s){if(!(this instanceof Bo))return new Bo(e,t,n,r,s);this.boundingBox=e,this.xStep=t,this.yStep=n,this.stream="",this.cloneIndex=0,Mo.call(this,r,s)}function Uo(e){var t,n="string"==typeof arguments[0]?arguments[0]:"p",r=arguments[1],s=arguments[2],i=arguments[3],a=[],o=1,l=16,c="S",d=null;"object"===(0,Yt.A)(e=e||{})&&(n=e.orientation,r=e.unit||r,s=e.format||s,i=e.compress||e.compressPdf||i,null!==(d=e.encryption||null)&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),o="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),c=e.defaultPathOperation||"S"),a=e.filters||(!0===i?["FlateEncode"]:a),r=r||"mm",n=(""+(n||"P")).toLowerCase();var u=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=Oo;var f="1.3",p=m.__private__.getPdfVersion=function(){return f};m.__private__.setPdfVersion=function(e){f=e};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return g};var x=m.__private__.getPageFormat=function(e){return g[e]};s=s||"a4";var y="compat",b="advanced",w=y;function v(){this.saveGraphicsState(),Z(new ke(he,0,0,-he,0,fn()*he).toString()+" cm"),this.setFontSize(this.getFontSize()/he),c="n",w=b}function N(){this.restoreGraphicsState(),c="S",w=y}var S=m.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};m.advancedAPI=function(e){var t=w===y;return t&&v.call(this),"function"!=typeof e||(e(this),t&&N.call(this)),this},m.compatAPI=function(e){var t=w===b;return t&&N.call(this),"function"!=typeof e||(e(this),t&&v.call(this)),this},m.isAdvancedAPI=function(){return w===b};var A,_=function(e){if(w!==b)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},C=m.roundToPrecision=m.__private__.roundToPrecision=function(e,n){var r=t||n;if(isNaN(e)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(r).replace(/0+$/,"")};A=m.hpf=m.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return C(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return C(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return C(e,16)};var I=m.f2=m.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return C(e,2)},E=m.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return C(e,3)},T=m.scale=m.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return w===y?e*he:w===b?e:void 0},j=function(e){return T(function(e){return w===y?fn()-e:w===b?e:void 0}(e))};m.__private__.setPrecision=m.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var k,D="00000000000000000000000000000000",P=m.__private__.getFileId=function(){return D},R=m.__private__.setFileId=function(e){return D=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():D.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==d&&(yt=new Po(d.userPermissions,d.userPassword,d.ownerPassword,D)),D};m.setFileId=function(e){return R(e),this},m.getFileId=function(){return P()};var O=m.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),n=t<0?"+":"-",r=Math.floor(Math.abs(t/60)),s=Math.abs(t%60),i=[n,U(r),"'",U(s),"'"].join("");return["D:",e.getFullYear(),U(e.getMonth()+1),U(e.getDate()),U(e.getHours()),U(e.getMinutes()),U(e.getSeconds()),i].join("")},L=m.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),n=parseInt(e.substr(6,2),10)-1,r=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),i=parseInt(e.substr(12,2),10),a=parseInt(e.substr(14,2),10);return new Date(t,n,r,s,i,a,0)},M=m.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=O(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return k=t},F=m.__private__.getCreationDate=function(e){var t=k;return"jsDate"===e&&(t=L(k)),t};m.setCreationDate=function(e){return M(e),this},m.getCreationDate=function(e){return F(e)};var B,U=m.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},z=m.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},q=0,H=[],V=[],W=0,G=[],Y=[],X=!1,Q=V;m.__private__.setCustomOutputDestination=function(e){X=!0,Q=e};var K=function(e){X||(Q=e)};m.__private__.resetCustomOutputDestination=function(){X=!1,Q=V};var Z=m.__private__.out=function(e){return e=e.toString(),W+=e.length+1,Q.push(e),Q},J=m.__private__.write=function(e){return Z(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},$=m.__private__.getArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);t--;)r[t]=e.charCodeAt(t);return n},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(e){return te=w===b?e/he:e,this};var ne,re=m.__private__.getFontSize=m.getFontSize=function(){return w===y?te:te*he},se=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(e){return se=e,this},m.__private__.getR2L=m.getR2L=function(){return se};var ie,ae=m.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ne=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ne=e}else ne=parseInt(e,10)};m.__private__.getZoomMode=function(){return ne};var oe,le=m.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');ie=e};m.__private__.getPageMode=function(){return ie};var ce=m.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');oe=e};m.__private__.getLayoutMode=function(){return oe},m.__private__.setDisplayMode=m.setDisplayMode=function(e,t,n){return ae(e),ce(t),le(n),this};var de={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(e){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return de[e]},m.__private__.getDocumentProperties=function(){return de},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(e){for(var t in de)de.hasOwnProperty(t)&&e[t]&&(de[t]=e[t]);return this},m.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return de[e]=t};var ue,he,me,fe,pe,ge={},xe={},ye=[],be={},we={},ve={},Ne={},Se=null,Ae=0,_e=[],Ce=new Oo(m),Ie=e.hotfixes||[],Ee={},Te={},je=[],ke=function e(t,n,r,s,i,a){if(!(this instanceof e))return new e(t,n,r,s,i,a);isNaN(t)&&(t=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(s)&&(s=1),isNaN(i)&&(i=0),isNaN(a)&&(a=0),this._matrix=[t,n,r,s,i,a]};Object.defineProperty(ke.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(ke.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(ke.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(ke.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(ke.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(ke.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(ke.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(ke.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(ke.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(ke.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(ke.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(ke.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(ke.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(ke.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(ke.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(ke.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),ke.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(A).join(e)},ke.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,n=e.sx*this.shy+e.shy*this.sy,r=e.shx*this.sx+e.sy*this.shx,s=e.shx*this.shy+e.sy*this.sy,i=e.tx*this.sx+e.ty*this.shx+this.tx,a=e.tx*this.shy+e.ty*this.sy+this.ty;return new ke(t,n,r,s,i,a)},ke.prototype.decompose=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,s=this.tx,i=this.ty,a=Math.sqrt(e*e+t*t),o=(e/=a)*n+(t/=a)*r;n-=e*o,r-=t*o;var l=Math.sqrt(n*n+r*r);return o/=l,e*(r/=l)<t*(n/=l)&&(e=-e,t=-t,o=-o,a=-a),{scale:new ke(a,0,0,l,0,0),translate:new ke(1,0,0,1,s,i),rotate:new ke(e,t,-t,e,0,0),skew:new ke(1,0,o,1,0,0)}},ke.prototype.toString=function(e){return this.join(" ")},ke.prototype.inversed=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,s=this.tx,i=this.ty,a=1/(e*r-t*n),o=r*a,l=-t*a,c=-n*a,d=e*a;return new ke(o,l,c,d,-o*s-c*i,-l*s-d*i)},ke.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,n=e.x*this.shy+e.y*this.sy+this.ty;return new nn(t,n)},ke.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),n=this.applyToPoint(new nn(e.x+e.w,e.y+e.h));return new rn(t.x,t.y,n.x-t.x,n.y-t.y)},ke.prototype.clone=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,s=this.tx,i=this.ty;return new ke(e,t,n,r,s,i)},m.Matrix=ke;var De=m.matrixMult=function(e,t){return t.multiply(e)},Pe=new ke(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=Pe;var Re=function(e,t){if(!we[e]){var n=(t instanceof Fo?"Sh":"P")+(Object.keys(be).length+1).toString(10);t.id=n,we[e]=n,be[n]=t,Ce.publish("addPattern",t)}};m.ShadingPattern=Fo,m.TilingPattern=Bo,m.addShadingPattern=function(e,t){return _("addShadingPattern()"),Re(e,t),this},m.beginTilingPattern=function(e){_("beginTilingPattern()"),an(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},m.endTilingPattern=function(e,t){_("endTilingPattern()"),t.stream=Y[B].join("\n"),Re(e,t),Ce.publish("endTilingPattern",t),je.pop().restore()};var Oe,Le=m.__private__.newObject=function(){var e=Me();return Fe(e,!0),e},Me=m.__private__.newObjectDeferred=function(){return q++,H[q]=function(){return W},q},Fe=function(e,t){return t="boolean"==typeof t&&t,H[e]=W,t&&Z(e+" 0 obj"),e},Be=m.__private__.newAdditionalObject=function(){var e={objId:Me(),content:""};return G.push(e),e},Ue=Me(),ze=Me(),qe=m.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var n=parseFloat(t[0]);t=[n,n,n,"r"]}for(var r="#",s=0;s<3;s++)r+=("0"+Math.floor(255*parseFloat(t[s])).toString(16)).slice(-2);return r},He=m.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var n=e.ch1,r=e.ch2,s=e.ch3,i=e.ch4,a="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var o=new fo(n);if(o.ok)n=o.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,r=l>>8&255,s=255&l}if(void 0===r||void 0===i&&n===r&&r===s)t="string"==typeof n?n+" "+a[0]:2===e.precision?I(n/255)+" "+a[0]:E(n/255)+" "+a[0];else if(void 0===i||"object"===(0,Yt.A)(i)){if(i&&!isNaN(i.a)&&0===i.a)return["1.","1.","1.",a[1]].join(" ");t="string"==typeof n?[n,r,s,a[1]].join(" "):2===e.precision?[I(n/255),I(r/255),I(s/255),a[1]].join(" "):[E(n/255),E(r/255),E(s/255),a[1]].join(" ")}else t="string"==typeof n?[n,r,s,i,a[2]].join(" "):2===e.precision?[I(n),I(r),I(s),I(i),a[2]].join(" "):[E(n),E(r),E(s),E(i),a[2]].join(" ");return t},Ve=m.__private__.getFilters=function(){return a},We=m.__private__.putStream=function(e){var t=(e=e||{}).data||"",n=e.filters||Ve(),r=e.alreadyAppliedFilters||[],s=e.addLength1||!1,i=t.length,a=e.objectId,o=function(e){return e};if(null!==d&&void 0===a)throw new Error("ObjectId must be passed to putStream for file encryption");null!==d&&(o=yt.encryptor(a,0));var l={};!0===n&&(n=["FlateEncode"]);var c=e.additionalKeyValues||[],u=(l=void 0!==Uo.API.processDataByFilters?Uo.API.processDataByFilters(t,n):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===s&&c.push({key:"Length1",value:i})),0!=u.length)if(u.split("/").length-1==1)c.push({key:"Filter",value:u});else{c.push({key:"Filter",value:"["+u+"]"});for(var h=0;h<c.length;h+=1)if("DecodeParms"===c[h].key){for(var m=[],f=0;f<l.reverseChain.split("/").length-1;f+=1)m.push("null");m.push(c[h].value),c[h].value="["+m.join(" ")+"]"}}Z("<<");for(var p=0;p<c.length;p++)Z("/"+c[p].key+" "+c[p].value);Z(">>"),0!==l.data.length&&(Z("stream"),Z(o(l.data)),Z("endstream"))},Ge=m.__private__.putPage=function(e){var t=e.number,n=e.data,r=e.objId,s=e.contentsObjId;Fe(r,!0),Z("<</Type /Page"),Z("/Parent "+e.rootDictionaryObjId+" 0 R"),Z("/Resources "+e.resourceDictionaryObjId+" 0 R"),Z("/MediaBox ["+parseFloat(A(e.mediaBox.bottomLeftX))+" "+parseFloat(A(e.mediaBox.bottomLeftY))+" "+A(e.mediaBox.topRightX)+" "+A(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&Z("/CropBox ["+A(e.cropBox.bottomLeftX)+" "+A(e.cropBox.bottomLeftY)+" "+A(e.cropBox.topRightX)+" "+A(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&Z("/BleedBox ["+A(e.bleedBox.bottomLeftX)+" "+A(e.bleedBox.bottomLeftY)+" "+A(e.bleedBox.topRightX)+" "+A(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&Z("/TrimBox ["+A(e.trimBox.bottomLeftX)+" "+A(e.trimBox.bottomLeftY)+" "+A(e.trimBox.topRightX)+" "+A(e.trimBox.topRightY)+"]"),null!==e.artBox&&Z("/ArtBox ["+A(e.artBox.bottomLeftX)+" "+A(e.artBox.bottomLeftY)+" "+A(e.artBox.topRightX)+" "+A(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&Z("/UserUnit "+e.userUnit),Ce.publish("putPage",{objId:r,pageContext:_e[t],pageNumber:t,page:n}),Z("/Contents "+s+" 0 R"),Z(">>"),Z("endobj");var i=n.join("\n");return w===b&&(i+="\nQ"),Fe(s,!0),We({data:i,filters:Ve(),objectId:s}),Z("endobj"),r},Ye=m.__private__.putPages=function(){var e,t,n=[];for(e=1;e<=Ae;e++)_e[e].objId=Me(),_e[e].contentsObjId=Me();for(e=1;e<=Ae;e++)n.push(Ge({number:e,data:Y[e],objId:_e[e].objId,contentsObjId:_e[e].contentsObjId,mediaBox:_e[e].mediaBox,cropBox:_e[e].cropBox,bleedBox:_e[e].bleedBox,trimBox:_e[e].trimBox,artBox:_e[e].artBox,userUnit:_e[e].userUnit,rootDictionaryObjId:Ue,resourceDictionaryObjId:ze}));Fe(Ue,!0),Z("<</Type /Pages");var r="/Kids [";for(t=0;t<Ae;t++)r+=n[t]+" 0 R ";Z(r+"]"),Z("/Count "+Ae),Z(">>"),Z("endobj"),Ce.publish("postPutPages")},Xe=function(e){Ce.publish("putFont",{font:e,out:Z,newObject:Le,putStream:We}),!0!==e.isAlreadyPutted&&(e.objectNumber=Le(),Z("<<"),Z("/Type /Font"),Z("/BaseFont /"+Ro(e.postScriptName)),Z("/Subtype /Type1"),"string"==typeof e.encoding&&Z("/Encoding /"+e.encoding),Z("/FirstChar 32"),Z("/LastChar 255"),Z(">>"),Z("endobj"))},Qe=function(e){e.objectNumber=Le();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[A(e.x),A(e.y),A(e.x+e.width),A(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var n=e.pages[1].join("\n");We({data:n,additionalKeyValues:t,objectId:e.objectNumber}),Z("endobj")},Ke=function(e,t){t||(t=21);var n=Le(),r=function(e,t){var n,r=[],s=1/(t-1);for(n=0;n<1;n+=s)r.push(n);if(r.push(1),0!=e[0].offset){var i={offset:0,color:e[0].color};e.unshift(i)}if(1!=e[e.length-1].offset){var a={offset:1,color:e[e.length-1].color};e.push(a)}for(var o="",l=0,c=0;c<r.length;c++){for(n=r[c];n>e[l+1].offset;)l++;var d=e[l].offset,u=(n-d)/(e[l+1].offset-d),h=e[l].color,m=e[l+1].color;o+=z(Math.round((1-u)*h[0]+u*m[0]).toString(16))+z(Math.round((1-u)*h[1]+u*m[1]).toString(16))+z(Math.round((1-u)*h[2]+u*m[2]).toString(16))}return o.trim()}(e.colors,t),s=[];s.push({key:"FunctionType",value:"0"}),s.push({key:"Domain",value:"[0.0 1.0]"}),s.push({key:"Size",value:"["+t+"]"}),s.push({key:"BitsPerSample",value:"8"}),s.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),s.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),We({data:r,additionalKeyValues:s,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),Z("endobj"),e.objectNumber=Le(),Z("<< /ShadingType "+e.type),Z("/ColorSpace /DeviceRGB");var i="/Coords ["+A(parseFloat(e.coords[0]))+" "+A(parseFloat(e.coords[1]))+" ";2===e.type?i+=A(parseFloat(e.coords[2]))+" "+A(parseFloat(e.coords[3])):i+=A(parseFloat(e.coords[2]))+" "+A(parseFloat(e.coords[3]))+" "+A(parseFloat(e.coords[4]))+" "+A(parseFloat(e.coords[5])),Z(i+="]"),e.matrix&&Z("/Matrix ["+e.matrix.toString()+"]"),Z("/Function "+n+" 0 R"),Z("/Extend [true true]"),Z(">>"),Z("endobj")},Ze=function(e,t){var n=Me(),r=Le();t.push({resourcesOid:n,objectOid:r}),e.objectNumber=r;var s=[];s.push({key:"Type",value:"/Pattern"}),s.push({key:"PatternType",value:"1"}),s.push({key:"PaintType",value:"1"}),s.push({key:"TilingType",value:"1"}),s.push({key:"BBox",value:"["+e.boundingBox.map(A).join(" ")+"]"}),s.push({key:"XStep",value:A(e.xStep)}),s.push({key:"YStep",value:A(e.yStep)}),s.push({key:"Resources",value:n+" 0 R"}),e.matrix&&s.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),We({data:e.stream,additionalKeyValues:s,objectId:e.objectNumber}),Z("endobj")},Je=function(e){for(var t in e.objectNumber=Le(),Z("<<"),e)switch(t){case"opacity":Z("/ca "+I(e[t]));break;case"stroke-opacity":Z("/CA "+I(e[t]))}Z(">>"),Z("endobj")},$e=function(e){Fe(e.resourcesOid,!0),Z("<<"),Z("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in Z("/Font <<"),ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Z("/"+e+" "+ge[e].objectNumber+" 0 R");Z(">>")}(),function(){if(Object.keys(be).length>0){for(var e in Z("/Shading <<"),be)be.hasOwnProperty(e)&&be[e]instanceof Fo&&be[e].objectNumber>=0&&Z("/"+e+" "+be[e].objectNumber+" 0 R");Ce.publish("putShadingPatternDict"),Z(">>")}}(),function(e){if(Object.keys(be).length>0){for(var t in Z("/Pattern <<"),be)be.hasOwnProperty(t)&&be[t]instanceof m.TilingPattern&&be[t].objectNumber>=0&&be[t].objectNumber<e&&Z("/"+t+" "+be[t].objectNumber+" 0 R");Ce.publish("putTilingPatternDict"),Z(">>")}}(e.objectOid),function(){if(Object.keys(ve).length>0){var e;for(e in Z("/ExtGState <<"),ve)ve.hasOwnProperty(e)&&ve[e].objectNumber>=0&&Z("/"+e+" "+ve[e].objectNumber+" 0 R");Ce.publish("putGStateDict"),Z(">>")}}(),function(){for(var e in Z("/XObject <<"),Ee)Ee.hasOwnProperty(e)&&Ee[e].objectNumber>=0&&Z("/"+e+" "+Ee[e].objectNumber+" 0 R");Ce.publish("putXobjectDict"),Z(">>")}(),Z(">>"),Z("endobj")},et=function(e){xe[e.fontName]=xe[e.fontName]||{},xe[e.fontName][e.fontStyle]=e.id},tt=function(e,t,n,r,s){var i={id:"F"+(Object.keys(ge).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:n,encoding:r,isStandardFont:s||!1,metadata:{}};return Ce.publish("addFont",{font:i,instance:this}),ge[i.id]=i,et(i),i.id},nt=m.__private__.pdfEscape=m.pdfEscape=function(e,t){return function(e,t){var n,r,s,i,a,o,l,c,d;if(s=(t=t||{}).sourceEncoding||"Unicode",a=t.outputEncoding,(t.autoencode||a)&&ge[ue].metadata&&ge[ue].metadata[s]&&ge[ue].metadata[s].encoding&&(i=ge[ue].metadata[s].encoding,!a&&ge[ue].encoding&&(a=ge[ue].encoding),!a&&i.codePages&&(a=i.codePages[0]),"string"==typeof a&&(a=i[a]),a)){for(l=!1,o=[],n=0,r=e.length;n<r;n++)(c=a[e.charCodeAt(n)])?o.push(String.fromCharCode(c)):o.push(e[n]),o[n].charCodeAt(0)>>8&&(l=!0);e=o.join("")}for(n=e.length;void 0===l&&0!==n;)e.charCodeAt(n-1)>>8&&(l=!0),n--;if(!l)return e;for(o=t.noBOM?[]:[254,255],n=0,r=e.length;n<r;n++){if((d=(c=e.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(d),o.push(c-(d<<8))}return String.fromCharCode.apply(void 0,o)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rt=m.__private__.beginPage=function(e){Y[++Ae]=[],_e[Ae]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},at(Ae),K(Y[B])},st=function(e,t){var r,i,a;switch(n=t||n,"string"==typeof e&&(r=x(e.toLowerCase()),Array.isArray(r)&&(i=r[0],a=r[1])),Array.isArray(e)&&(i=e[0]*he,a=e[1]*he),isNaN(i)&&(i=s[0],a=s[1]),(i>14400||a>14400)&&(lo.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),i=Math.min(14400,i),a=Math.min(14400,a)),s=[i,a],n.substr(0,1)){case"l":a>i&&(s=[a,i]);break;case"p":i>a&&(s=[a,i])}rt(s),Ft(Lt),Z(Gt),0!==$t&&Z($t+" J"),0!==en&&Z(en+" j"),Ce.publish("addPage",{pageNumber:Ae})},it=function(e){e>0&&e<=Ae&&(Y.splice(e,1),_e.splice(e,1),Ae--,B>Ae&&(B=Ae),this.setPage(B))},at=function(e){e>0&&e<=Ae&&(B=e)},ot=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return Y.length-1},lt=function(e,t,n){var r,s=void 0;return n=n||{},e=void 0!==e?e:ge[ue].fontName,t=void 0!==t?t:ge[ue].fontStyle,r=e.toLowerCase(),void 0!==xe[r]&&void 0!==xe[r][t]?s=xe[r][t]:void 0!==xe[e]&&void 0!==xe[e][t]?s=xe[e][t]:!1===n.disableWarning&&lo.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),s||n.noFallback||null==(s=xe.times[t])&&(s=xe.times.normal),s},ct=m.__private__.putInfo=function(){var e=Le(),t=function(e){return e};for(var n in null!==d&&(t=yt.encryptor(e,0)),Z("<<"),Z("/Producer ("+nt(t("jsPDF "+Uo.version))+")"),de)de.hasOwnProperty(n)&&de[n]&&Z("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+nt(t(de[n]))+")");Z("/CreationDate ("+nt(t(k))+")"),Z(">>"),Z("endobj")},dt=m.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Ue;switch(Le(),Z("<<"),Z("/Type /Catalog"),Z("/Pages "+t+" 0 R"),ne||(ne="fullwidth"),ne){case"fullwidth":Z("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Z("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Z("/OpenAction [3 0 R /Fit]");break;case"original":Z("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+ne;"%"===n.substr(n.length-1)&&(ne=parseInt(ne)/100),"number"==typeof ne&&Z("/OpenAction [3 0 R /XYZ null null "+I(ne)+"]")}switch(oe||(oe="continuous"),oe){case"continuous":Z("/PageLayout /OneColumn");break;case"single":Z("/PageLayout /SinglePage");break;case"two":case"twoleft":Z("/PageLayout /TwoColumnLeft");break;case"tworight":Z("/PageLayout /TwoColumnRight")}ie&&Z("/PageMode /"+ie),Ce.publish("putCatalog"),Z(">>"),Z("endobj")},ut=m.__private__.putTrailer=function(){Z("trailer"),Z("<<"),Z("/Size "+(q+1)),Z("/Root "+q+" 0 R"),Z("/Info "+(q-1)+" 0 R"),null!==d&&Z("/Encrypt "+yt.oid+" 0 R"),Z("/ID [ <"+D+"> <"+D+"> ]"),Z(">>")},ht=m.__private__.putHeader=function(){Z("%PDF-"+f),Z("%\xba\xdf\xac\xe0")},mt=m.__private__.putXRef=function(){var e="0000000000";Z("xref"),Z("0 "+(q+1)),Z("0000000000 65535 f ");for(var t=1;t<=q;t++)"function"==typeof H[t]?Z((e+H[t]()).slice(-10)+" 00000 n "):void 0!==H[t]?Z((e+H[t]).slice(-10)+" 00000 n "):Z("0000000000 00000 n ")},ft=m.__private__.buildDocument=function(){var e;q=0,W=0,V=[],H=[],G=[],Ue=Me(),ze=Me(),K(V),Ce.publish("buildDocument"),ht(),Ye(),function(){Ce.publish("putAdditionalObjects");for(var e=0;e<G.length;e++){var t=G[e];Fe(t.objId,!0),Z(t.content),Z("endobj")}Ce.publish("postPutAdditionalObjects")}(),e=[],function(){for(var e in ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Xe(ge[e])}(),function(){var e;for(e in ve)ve.hasOwnProperty(e)&&Je(ve[e])}(),function(){for(var e in Ee)Ee.hasOwnProperty(e)&&Qe(Ee[e])}(),function(e){var t;for(t in be)be.hasOwnProperty(t)&&(be[t]instanceof Fo?Ke(be[t]):be[t]instanceof Bo&&Ze(be[t],e))}(e),Ce.publish("putResources"),e.forEach($e),$e({resourcesOid:ze,objectOid:Number.MAX_SAFE_INTEGER}),Ce.publish("postPutResources"),null!==d&&(yt.oid=Le(),Z("<<"),Z("/Filter /Standard"),Z("/V "+yt.v),Z("/R "+yt.r),Z("/U <"+yt.toHexString(yt.U)+">"),Z("/O <"+yt.toHexString(yt.O)+">"),Z("/P "+yt.P),Z(">>"),Z("endobj")),ct(),dt();var t=W;return mt(),ut(),Z("startxref"),Z(""+t),Z("%%EOF"),K(Y[B]),V.join("\n")},pt=m.__private__.getBlob=function(e){return new Blob([$(e)],{type:"application/pdf"})},gt=m.output=m.__private__.output=(Oe=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return ft();case"save":m.save(t.filename);break;case"arraybuffer":return $(ft());case"blob":return pt(ft());case"bloburi":case"bloburl":if(void 0!==ao.URL&&"function"==typeof ao.URL.createObjectURL)return ao.URL&&ao.URL.createObjectURL(pt(ft()))||void 0;lo.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=ft();try{n=go(r)}catch(d){n=go(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+t.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(ao)){var s="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",i=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(s=t.pdfObjectUrl,i="");var a='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+s+'"'+i+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",o=ao.open();return null!==o&&o.document.write(a),o}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(ao)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',c=ao.open();if(null!==c){c.document.write(l);var u=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=t.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(u.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(ao))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var h='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',f=ao.open();if(null!==f&&(f.document.write(h),f.document.title=t.filename),f||"undefined"==typeof safari)return f;break;case"datauri":case"dataurl":return ao.document.location.href=this.output("datauristring",t);default:return null}},Oe.foo=function(){try{return Oe.apply(this,arguments)}catch(t){var e=t.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var n="Error in function "+e.split("\n")[0].split("<")[0]+": "+t.message;if(!ao.console)throw new Error(n);ao.console.error(n,t),ao.alert&&alert(n)}},Oe.foo.bar=Oe,Oe.foo),xt=function(e){return!0===Array.isArray(Ie)&&Ie.indexOf(e)>-1};switch(r){case"pt":he=1;break;case"mm":he=72/25.4;break;case"cm":he=72/2.54;break;case"in":he=72;break;case"px":he=1==xt("px_scaling")?.75:96/72;break;case"pc":case"em":he=12;break;case"ex":he=6;break;default:if("number"!=typeof r)throw new Error("Invalid unit: "+r);he=r}var yt=null;M(),R();var bt=m.__private__.getPageInfo=m.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:_e[e].objId,pageNumber:e,pageContext:_e[e]}},wt=m.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in _e)if(_e[t].objId===e)break;return bt(t)},vt=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:_e[B].objId,pageNumber:B,pageContext:_e[B]}};m.addPage=function(){return st.apply(this,arguments),this},m.setPage=function(){return at.apply(this,arguments),K.call(this,Y[B]),this},m.insertPage=function(e){return this.addPage(),this.movePage(B,e),this},m.movePage=function(e,t){var n,r;if(e>t){n=Y[e],r=_e[e];for(var s=e;s>t;s--)Y[s]=Y[s-1],_e[s]=_e[s-1];Y[t]=n,_e[t]=r,this.setPage(t)}else if(e<t){n=Y[e],r=_e[e];for(var i=e;i<t;i++)Y[i]=Y[i+1],_e[i]=_e[i+1];Y[t]=n,_e[t]=r,this.setPage(t)}return this},m.deletePage=function(){return it.apply(this,arguments),this},m.__private__.text=m.text=function(e,t,n,r,s){var i,a,o,l,c,d,u,m,f,p=(r=r||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof n||Array.isArray(n))){var g=n;n=t,t=e,e=g}if(arguments[3]instanceof ke==0?(o=arguments[4],l=arguments[5],"object"===(0,Yt.A)(u=arguments[3])&&null!==u||("string"==typeof o&&(l=o,o=null),"string"==typeof u&&(l=u,u=null),"number"==typeof u&&(o=u,u=null),r={flags:u,angle:o,align:l})):(_("The transform parameter of text() with a Matrix value"),f=s),isNaN(t)||isNaN(n)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return p;var x,y="",v="number"==typeof r.lineHeightFactor?r.lineHeightFactor:Ot,N=p.internal.scaleFactor;function S(e){return e=e.split("\t").join(Array(r.TabLen||9).join(" ")),nt(e,u)}function C(e){for(var t,n=e.concat(),r=[],s=n.length;s--;)"string"==typeof(t=n.shift())?r.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?r.push(t[0]):r.push([t[0],t[1],t[2]]);return r}function I(e,t){var n;if("string"==typeof e)n=t(e)[0];else if(Array.isArray(e)){for(var r,s,i=e.concat(),a=[],o=i.length;o--;)"string"==typeof(r=i.shift())?a.push(t(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(s=t(r[0],r[1],r[2]),a.push([s[0],s[1],s[2]]));n=a}return n}var E=!1,j=!0;if("string"==typeof e)E=!0;else if(Array.isArray(e)){var k=e.concat();a=[];for(var D,P=k.length;P--;)("string"!=typeof(D=k.shift())||Array.isArray(D)&&"string"!=typeof D[0])&&(j=!1);E=j}if(!1===E)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var R=te/p.internal.scaleFactor,O=R*(v-1);switch(r.baseline){case"bottom":n-=O;break;case"top":n+=R-O;break;case"hanging":n+=R-2*O;break;case"middle":n+=R/2-O}if((d=r.maxWidth||0)>0&&("string"==typeof e?e=p.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(p.splitTextToSize(t,d))},[]))),i={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:ue,fonts:ge,activeFontSize:te}},Ce.publish("preProcessText",i),e=i.text,o=(r=i.options).angle,f instanceof ke==0&&o&&"number"==typeof o){o*=Math.PI/180,0===r.rotationDirection&&(o=-o),w===b&&(o=-o);var L=Math.cos(o),M=Math.sin(o);f=new ke(L,M,-M,L,0,0)}else o&&o instanceof ke&&(f=o);w!==b||f||(f=Pe),void 0!==(c=r.charSpace||Zt)&&(y+=A(T(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(m=r.horizontalScale)&&(y+=A(100*m)+" Tz\n"),r.lang;var F=-1,B=void 0!==r.renderingMode?r.renderingMode:r.stroke,U=p.internal.getCurrentPageInfo().pageContext;switch(B){case 0:case!1:case"fill":F=0;break;case 1:case!0:case"stroke":F=1;break;case 2:case"fillThenStroke":F=2;break;case 3:case"invisible":F=3;break;case 4:case"fillAndAddForClipping":F=4;break;case 5:case"strokeAndAddPathForClipping":F=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":F=6;break;case 7:case"addToPathForClipping":F=7}var z=void 0!==U.usedRenderingMode?U.usedRenderingMode:-1;-1!==F?y+=F+" Tr\n":-1!==z&&(y+="0 Tr\n"),-1!==F&&(U.usedRenderingMode=F),l=r.align||"left";var q,H=te*v,V=p.internal.pageSize.getWidth(),W=ge[ue];c=r.charSpace||Zt,d=r.maxWidth||0,u=Object.assign({autoencode:!0,noBOM:!0},r.flags);var G=[],Y=function(e){return p.getStringUnitWidth(e,{font:W,charSpace:c,fontSize:te,doKerning:!1})*te/N};if("[object Array]"===Object.prototype.toString.call(e)){var X;a=C(e),"left"!==l&&(q=a.map(Y));var Q,K=0;if("right"===l){t-=q[0],e=[],P=a.length;for(var J=0;J<P;J++)0===J?(Q=qt(t),X=Ht(n)):(Q=T(K-q[J]),X=-H),e.push([a[J],Q,X]),K=q[J]}else if("center"===l){t-=q[0]/2,e=[],P=a.length;for(var $=0;$<P;$++)0===$?(Q=qt(t),X=Ht(n)):(Q=T((K-q[$])/2),X=-H),e.push([a[$],Q,X]),K=q[$]}else if("left"===l){e=[],P=a.length;for(var ee=0;ee<P;ee++)e.push(a[ee])}else if("justify"===l&&"Identity-H"===W.encoding){e=[],P=a.length,d=0!==d?d:V;for(var ne=0,re=0;re<P;re++)if(X=0===re?Ht(n):-H,Q=0===re?qt(t):ne,re<P-1){var ie=T((d-q[re])/(a[re].split(" ").length-1)),ae=a[re].split(" ");e.push([ae[0]+" ",Q,X]),ne=0;for(var oe=1;oe<ae.length;oe++){var le=(Y(ae[oe-1]+" "+ae[oe])-Y(ae[oe]))*N+ie;oe==ae.length-1?e.push([ae[oe],le,0]):e.push([ae[oe]+" ",le,0]),ne-=le}}else e.push([a[re],Q,X]);e.push(["",ne,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],P=a.length,d=0!==d?d:V,re=0;re<P;re++){X=0===re?Ht(n):-H,Q=0===re?qt(t):0;var ce=a[re].split(" ").length-1,de=ce>0?(d-q[re])/ce:0;re<P-1?G.push(A(T(de))):G.push(0),e.push([a[re],Q,X])}}}!0===("boolean"==typeof r.R2L?r.R2L:se)&&(e=I(e,function(e,t,n){return[e.split("").reverse().join(""),t,n]})),i={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:ue,fonts:ge,activeFontSize:te}},Ce.publish("postProcessText",i),e=i.text,x=i.mutex.isHex||!1;var he=ge[ue].encoding;"WinAnsiEncoding"!==he&&"StandardEncoding"!==he||(e=I(e,function(e,t,n){return[S(e),t,n]})),a=C(e),e=[];for(var me,fe,pe,xe=Array.isArray(a[0])?1:0,ye="",be=function(e,t,n){var s="";return n instanceof ke?(n="number"==typeof r.angle?De(n,new ke(1,0,0,1,e,t)):De(new ke(1,0,0,1,e,t),n),w===b&&(n=De(new ke(1,0,0,-1,0,0),n)),s=n.join(" ")+" Tm\n"):s=A(e)+" "+A(t)+" Td\n",s},we=0;we<a.length;we++){switch(ye="",xe){case 1:pe=(x?"<":"(")+a[we][0]+(x?">":")"),me=parseFloat(a[we][1]),fe=parseFloat(a[we][2]);break;case 0:pe=(x?"<":"(")+a[we]+(x?">":")"),me=qt(t),fe=Ht(n)}void 0!==G&&void 0!==G[we]&&(ye=G[we]+" Tw\n"),0===we?e.push(ye+be(me,fe,f)+pe):0===xe?e.push(ye+pe):1===xe&&e.push(ye+be(me,fe,f)+pe)}e=0===xe?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var ve="BT\n/";return ve+=ue+" "+te+" Tf\n",ve+=A(te*v)+" TL\n",ve+=Qt+"\n",ve+=y,ve+=e,Z(ve+="ET"),h[ue]=!0,p};var Nt=m.__private__.clip=m.clip=function(e){return Z("evenodd"===e?"W*":"W"),this};m.clipEvenOdd=function(){return Nt("evenodd")},m.__private__.discardPath=m.discardPath=function(){return Z("n"),this};var St=m.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(e){return St(e)&&(c=e),this};var At=m.__private__.getStyle=m.getStyle=function(e){var t=c;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},_t=m.close=function(){return Z("h"),this};m.stroke=function(){return Z("S"),this},m.fill=function(e){return Ct("f",e),this},m.fillEvenOdd=function(e){return Ct("f*",e),this},m.fillStroke=function(e){return Ct("B",e),this},m.fillStrokeEvenOdd=function(e){return Ct("B*",e),this};var Ct=function(e,t){"object"===(0,Yt.A)(t)?Tt(t,e):Z(e)},It=function(e){null===e||w===b&&void 0===e||(e=At(e),Z(e))};function Et(e,t,n,r,s){var i=new Bo(t||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,s||this.matrix);i.stream=this.stream;var a=e+"$$"+this.cloneIndex+++"$$";return Re(a,i),i}var Tt=function(e,t){var n=we[e.key],r=be[n];if(r instanceof Fo)Z("q"),Z(jt(t)),r.gState&&m.setGState(r.gState),Z(e.matrix.toString()+" cm"),Z("/"+n+" sh"),Z("Q");else if(r instanceof Bo){var s=new ke(1,0,0,-1,0,fn());e.matrix&&(s=s.multiply(e.matrix||Pe),n=Et.call(r,e.key,e.boundingBox,e.xStep,e.yStep,s).id),Z("q"),Z("/Pattern cs"),Z("/"+n+" scn"),r.gState&&m.setGState(r.gState),Z(t),Z("Q")}},jt=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},kt=m.moveTo=function(e,t){return Z(A(T(e))+" "+A(j(t))+" m"),this},Dt=m.lineTo=function(e,t){return Z(A(T(e))+" "+A(j(t))+" l"),this},Pt=m.curveTo=function(e,t,n,r,s,i){return Z([A(T(e)),A(j(t)),A(T(n)),A(j(r)),A(T(s)),A(j(i)),"c"].join(" ")),this};m.__private__.line=m.line=function(e,t,n,r,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!St(s))throw new Error("Invalid arguments passed to jsPDF.line");return w===y?this.lines([[n-e,r-t]],e,t,[1,1],s||"S"):this.lines([[n-e,r-t]],e,t,[1,1]).stroke()},m.__private__.lines=m.lines=function(e,t,n,r,s,i){var a,o,l,c,d,u,h,m,f,p,g,x;if("number"==typeof e&&(x=n,n=t,t=e,e=x),r=r||[1,1],i=i||!1,isNaN(t)||isNaN(n)||!Array.isArray(e)||!Array.isArray(r)||!St(s)||"boolean"!=typeof i)throw new Error("Invalid arguments passed to jsPDF.lines");for(kt(t,n),a=r[0],o=r[1],c=e.length,p=t,g=n,l=0;l<c;l++)2===(d=e[l]).length?(p=d[0]*a+p,g=d[1]*o+g,Dt(p,g)):(u=d[0]*a+p,h=d[1]*o+g,m=d[2]*a+p,f=d[3]*o+g,p=d[4]*a+p,g=d[5]*o+g,Pt(u,h,m,f,p,g));return i&&_t(),It(s),this},m.path=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.c;switch(n.op){case"m":kt(r[0],r[1]);break;case"l":Dt(r[0],r[1]);break;case"c":Pt.apply(this,r);break;case"h":_t()}}return this},m.__private__.rect=m.rect=function(e,t,n,r,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!St(s))throw new Error("Invalid arguments passed to jsPDF.rect");return w===y&&(r=-r),Z([A(T(e)),A(j(t)),A(T(n)),A(T(r)),"re"].join(" ")),It(s),this},m.__private__.triangle=m.triangle=function(e,t,n,r,s,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(i)||!St(a))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-e,r-t],[s-n,i-r],[e-s,t-i]],e,t,[1,1],a,!0),this},m.__private__.roundedRect=m.roundedRect=function(e,t,n,r,s,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(i)||!St(a))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return s=Math.min(s,.5*n),i=Math.min(i,.5*r),this.lines([[n-2*s,0],[s*o,0,s,i-i*o,s,i],[0,r-2*i],[0,i*o,-s*o,i,-s,i],[2*s-n,0],[-s*o,0,-s,-i*o,-s,-i],[0,2*i-r],[0,-i*o,s*o,-i,s,-i]],e+s,t,[1,1],a,!0),this},m.__private__.ellipse=m.ellipse=function(e,t,n,r,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!St(s))throw new Error("Invalid arguments passed to jsPDF.ellipse");var i=4/3*(Math.SQRT2-1)*n,a=4/3*(Math.SQRT2-1)*r;return kt(e+n,t),Pt(e+n,t-a,e+i,t-r,e,t-r),Pt(e-i,t-r,e-n,t-a,e-n,t),Pt(e-n,t+a,e-i,t+r,e,t+r),Pt(e+i,t+r,e+n,t+a,e+n,t),It(s),this},m.__private__.circle=m.circle=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||!St(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,n,n,r)},m.setFont=function(e,t,n){return n&&(t=S(t,n)),ue=lt(e,t,{disableWarning:!1}),this};var Rt=m.__private__.getFont=m.getFont=function(){return ge[lt.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var e,t,n={};for(e in xe)if(xe.hasOwnProperty(e))for(t in n[e]=[],xe[e])xe[e].hasOwnProperty(t)&&n[e].push(t);return n},m.addFont=function(e,t,n,r,s){var i=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==i.indexOf(arguments[3])?s=arguments[3]:arguments[3]&&-1==i.indexOf(arguments[3])&&(n=S(n,r)),tt.call(this,e,t,n,s=s||"Identity-H")};var Ot,Lt=e.lineWidth||.200025,Mt=m.__private__.getLineWidth=m.getLineWidth=function(){return Lt},Ft=m.__private__.setLineWidth=m.setLineWidth=function(e){return Lt=e,Z(A(T(e))+" w"),this};m.__private__.setLineDash=Uo.API.setLineDash=Uo.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return A(T(e))}).join(" "),t=A(T(t)),Z("["+e+"] "+t+" d"),this};var Bt=m.__private__.getLineHeight=m.getLineHeight=function(){return te*Ot};m.__private__.getLineHeight=m.getLineHeight=function(){return te*Ot};var Ut=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Ot=e),this},zt=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return Ot};Ut(e.lineHeight);var qt=m.__private__.getHorizontalCoordinate=function(e){return T(e)},Ht=m.__private__.getVerticalCoordinate=function(e){return w===b?e:_e[B].mediaBox.topRightY-_e[B].mediaBox.bottomLeftY-T(e)},Vt=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(e){return A(qt(e))},Wt=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(e){return A(Ht(e))},Gt=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return qe(Gt)},m.__private__.setStrokeColor=m.setDrawColor=function(e,t,n,r){return Gt=He({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),Z(Gt),this};var Xt=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return qe(Xt)},m.__private__.setFillColor=m.setFillColor=function(e,t,n,r){return Xt=He({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),Z(Xt),this};var Qt=e.textColor||"0 g",Kt=m.__private__.getTextColor=m.getTextColor=function(){return qe(Qt)};m.__private__.setTextColor=m.setTextColor=function(e,t,n,r){return Qt=He({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var Zt=e.charSpace,Jt=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(Zt||0)};m.__private__.setCharSpace=m.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Zt=e,this};var $t=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $t=t,Z(t+" J"),this};var en=0;m.__private__.setLineJoin=m.setLineJoin=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return en=t,Z(t+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Z(A(T(e))+" M"),this},m.GState=Lo,m.setGState=function(e){(e="string"==typeof e?ve[Ne[e]]:tn(null,e)).equals(Se)||(Z("/"+e.id+" gs"),Se=e)};var tn=function(e,t){if(!e||!Ne[e]){var n=!1;for(var r in ve)if(ve.hasOwnProperty(r)&&ve[r].equals(t)){n=!0;break}if(n)t=ve[r];else{var s="GS"+(Object.keys(ve).length+1).toString(10);ve[s]=t,t.id=s}return e&&(Ne[e]=t.id),Ce.publish("addGState",t),t}};m.addGState=function(e,t){return tn(e,t),this},m.saveGraphicsState=function(){return Z("q"),ye.push({key:ue,size:te,color:Qt}),this},m.restoreGraphicsState=function(){Z("Q");var e=ye.pop();return ue=e.key,te=e.size,Qt=e.color,Se=null,this},m.setCurrentTransformationMatrix=function(e){return Z(e.toString()+" cm"),this},m.comment=function(e){return Z("#"+e),this};var nn=function(e,t){var n=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var r=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var s="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return s},set:function(e){s=e.toString()}}),this},rn=function(e,t,n,r){nn.call(this,e,t),this.type="rect";var s=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return s},set:function(e){isNaN(e)||(s=parseFloat(e))}});var i=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}}),this},sn=function(){this.page=Ae,this.currentPage=B,this.pages=Y.slice(0),this.pagesContext=_e.slice(0),this.x=me,this.y=fe,this.matrix=pe,this.width=ln(B),this.height=dn(B),this.outputDestination=Q,this.id="",this.objectNumber=-1};sn.prototype.restore=function(){Ae=this.page,B=this.currentPage,_e=this.pagesContext,Y=this.pages,me=this.x,fe=this.y,pe=this.matrix,cn(B,this.width),un(B,this.height),Q=this.outputDestination};var an=function(e,t,n,r,s){je.push(new sn),Ae=B=0,Y=[],me=e,fe=t,pe=s,rt([n,r])};for(var on in m.beginFormObject=function(e,t,n,r,s){return an(e,t,n,r,s),this},m.endFormObject=function(e){return function(e){if(Te[e])je.pop().restore();else{var t=new sn,n="Xo"+(Object.keys(Ee).length+1).toString(10);t.id=n,Te[e]=n,Ee[n]=t,Ce.publish("addFormObject",t),je.pop().restore()}}(e),this},m.doFormObject=function(e,t){var n=Ee[Te[e]];return Z("q"),Z(t.toString()+" cm"),Z("/"+n.id+" Do"),Z("Q"),this},m.getFormObject=function(e){var t=Ee[Te[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},m.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(mo(pt(ft()),e),"function"==typeof mo.unload&&ao.setTimeout&&setTimeout(mo.unload,911),this):new Promise(function(t,n){try{var s=mo(pt(ft()),e);"function"==typeof mo.unload&&ao.setTimeout&&setTimeout(mo.unload,911),t(s)}catch(r){n(r.message)}})},Uo.API)Uo.API.hasOwnProperty(on)&&("events"===on&&Uo.API.events.length?function(e,t){var n,r,s;for(s=t.length-1;-1!==s;s--)n=t[s][0],r=t[s][1],e.subscribe.apply(e,[n].concat("function"==typeof r?[r]:r))}(Ce,Uo.API.events):m[on]=Uo.API[on]);function ln(e){return _e[e].mediaBox.topRightX-_e[e].mediaBox.bottomLeftX}function cn(e,t){_e[e].mediaBox.topRightX=t+_e[e].mediaBox.bottomLeftX}function dn(e){return _e[e].mediaBox.topRightY-_e[e].mediaBox.bottomLeftY}function un(e,t){_e[e].mediaBox.topRightY=t+_e[e].mediaBox.bottomLeftY}var hn=m.getPageWidth=function(e){return ln(e=e||B)/he},mn=m.setPageWidth=function(e,t){cn(e,t*he)},fn=m.getPageHeight=function(e){return dn(e=e||B)/he},pn=m.setPageHeight=function(e,t){un(e,t*he)};return m.internal={pdfEscape:nt,getStyle:At,getFont:Rt,getFontSize:re,getCharSpace:Jt,getTextColor:Kt,getLineHeight:Bt,getLineHeightFactor:zt,getLineWidth:Mt,write:J,getHorizontalCoordinate:qt,getVerticalCoordinate:Ht,getCoordinateString:Vt,getVerticalCoordinateString:Wt,collections:{},newObject:Le,newAdditionalObject:Be,newObjectDeferred:Me,newObjectDeferredBegin:Fe,getFilters:Ve,putStream:We,events:Ce,scaleFactor:he,pageSize:{getWidth:function(){return hn(B)},setWidth:function(e){mn(B,e)},getHeight:function(){return fn(B)},setHeight:function(e){pn(B,e)}},encryptionOptions:d,encryption:yt,getEncryptor:function(e){return null!==d?yt.encryptor(e,0):function(e){return e}},output:gt,getNumberOfPages:ot,pages:Y,out:Z,f2:I,f3:E,getPageInfo:bt,getPageInfoByObjId:wt,getCurrentPageInfo:vt,getPDFVersion:p,Point:nn,Rectangle:rn,Matrix:ke,hasHotfix:xt},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return hn(B)},set:function(e){mn(B,e)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return fn(B)},set:function(e){pn(B,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,n=ee.length;t<n;t++){var r=tt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===u&&(h[r]=!0);var s=e[t][0].split("-");et({id:r,fontName:s[0],fontStyle:s[1]||""})}Ce.publish("addFonts",{fonts:ge,dictionary:xe})}.call(m,ee),ue="F1",st(s,n),Ce.publish("initialized"),m}Po.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},Po.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Po.prototype.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(String.fromCharCode(parseInt(e.substr(n,2),16)));return t.join("")},Po.prototype.processOwnerPassword=function(e,t){return ko(Eo(t).substr(0,5),e)},Po.prototype.encryptor=function(e,t){var n=Eo(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return ko(n,e)}},Lo.prototype.equals=function(e){var t,n="id,objectNumber,equals";if(!e||(0,Yt.A)(e)!==(0,Yt.A)(this))return!1;var r=0;for(t in this)if(!(n.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;r++}for(t in e)e.hasOwnProperty(t)&&n.indexOf(t)<0&&r--;return 0===r},Uo.API={events:[]},Uo.version="3.0.3";var zo=Uo.API,qo=1,Ho=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Vo=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Wo=function(e){return e.toFixed(2)},Go=function(e){return e.toFixed(5)};zo.__acroform__={};var Yo=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},Xo=function(e){return e*qo},Qo=function(e){var t=new ul,n=_l.internal.getHeight(e)||0,r=_l.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Wo(r)),Number(Wo(n))],t},Ko=zo.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},Zo=zo.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},Jo=zo.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},$o=zo.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Jo(e,t-1)},el=zo.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Ko(e,t-1)},tl=zo.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Zo(e,t-1)},nl=zo.__acroform__.calculateCoordinates=function(e,t){var n=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,s=e[0],i=e[1],a=e[2],o=e[3],l={};return l.lowerLeft_X=n(s)||0,l.lowerLeft_Y=r(i+o)||0,l.upperRight_X=n(s+a)||0,l.upperRight_Y=r(i)||0,[Number(Wo(l.lowerLeft_X)),Number(Wo(l.lowerLeft_Y)),Number(Wo(l.upperRight_X)),Number(Wo(l.upperRight_Y))]},rl=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],n=e._V||e.DV,r=sl(e,n),s=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+s+" "+Wo(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var i=Qo(e);return i.scope=e.scope,i.stream=t.join("\n"),i}},sl=function(e,t){var n=0===e.fontSize?e.maxFontSize:e.fontSize,r={text:"",fontSize:""},s=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");s=e.multiline?s.map(function(e){return e.split("\n")}):s.map(function(e){return[e]});var i=n,a=_l.internal.getHeight(e)||0;a=a<0?-a:a;var o=_l.internal.getWidth(e)||0;o=o<0?-o:o;var l=function(t,n,r){if(t+1<s.length){var i=n+" "+s[t+1][0];return il(i,e,r).width<=o-4}return!1};i++;e:for(;i>0;){t="",i--;var c,d,u=il("3",e,i).height,h=e.multiline?a-i:(a-u)/2,m=h+=2,f=0,p=0,g=0;if(i<=0){t="(...) Tj\n",t+="% Width of Text: "+il(t,e,i=12).width+", FieldWidth:"+o+"\n";break}for(var x="",y=0,b=0;b<s.length;b++)if(s.hasOwnProperty(b)){var w=!1;if(1!==s[b].length&&g!==s[b].length-1){if((u+2)*(y+2)+2>a)continue e;x+=s[b][g],w=!0,p=b,b--}else{x=" "==(x+=s[b][g]+" ").substr(x.length-1)?x.substr(0,x.length-1):x;var v=parseInt(b),N=l(v,x,i),S=b>=s.length-1;if(N&&!S){x+=" ",g=0;continue}if(N||S){if(S)p=v;else if(e.multiline&&(u+2)*(y+2)+2>a)continue e}else{if(!e.multiline)continue e;if((u+2)*(y+2)+2>a)continue e;p=v}}for(var A="",_=f;_<=p;_++){var C=s[_];if(e.multiline){if(_===p){A+=C[g]+" ",g=(g+1)%C.length;continue}if(_===f){A+=C[C.length-1]+" ";continue}}A+=C[0]+" "}switch(A=" "==A.substr(A.length-1)?A.substr(0,A.length-1):A,d=il(A,e,i).width,e.textAlign){case"right":c=o-d-2;break;case"center":c=(o-d)/2;break;default:c=2}t+=Wo(c)+" "+Wo(m)+" Td\n",t+="("+Ho(A)+") Tj\n",t+=-Wo(c)+" 0 Td\n",m=-(i+2),d=0,f=w?p:p+1,y++,x=""}break}return r.text=t,r.fontSize=i,r},il=function(e,t,n){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(e,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:s}},al={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},ol=function(e,t){var n={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===n.type&&e.object===n.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(n)},ll=zo.__acroform__.arrayToPdfArray=function(e,t,n){var r=function(e){return e};if(Array.isArray(e)){for(var s="[",i=0;i<e.length;i++)switch(0!==i&&(s+=" "),(0,Yt.A)(e[i])){case"boolean":case"number":case"object":s+=e[i].toString();break;case"string":"/"!==e[i].substr(0,1)?(void 0!==t&&n&&(r=n.internal.getEncryptor(t)),s+="("+Ho(r(e[i].toString()))+")"):s+=e[i].toString()}return s+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},cl=function(e,t,n){var r=function(e){return e};return void 0!==t&&n&&(r=n.internal.getEncryptor(t)),(e=e||"").toString(),"("+Ho(r(e))+")"},dl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};dl.prototype.toString=function(){return this.objId+" 0 R"},dl.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},dl.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var n in t)if(!1===Object.getOwnPropertyDescriptor(this,t[n]).configurable){var r=t[n],s=this[r];s&&(Array.isArray(s)?e.push({key:r,value:ll(s,this.objId,this.scope)}):s instanceof dl?(s.scope=this.scope,e.push({key:r,value:s.objId+" 0 R"})):"function"!=typeof s&&e.push({key:r,value:s}))}return e};var ul=function(){dl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};Yo(ul,dl);var hl=function(){dl.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Ho(t(e))+")"}},set:function(t){e=t}})};Yo(hl,dl);var ml=function e(){dl.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(t,3))},set:function(e){!0===Boolean(e)?this.F=el(t,3):this.F=tl(t,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');n=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof vl)return;i="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Ho(t(i))+")"},set:function(e){i=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){a=e}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(e){l=e}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/qo:c},set:function(e){c=e}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(e){d=e}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof vl||this instanceof Sl))return cl(u,this.objId,this.scope)},set:function(e){e=e.toString(),u=e}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof yl==0?cl(h,this.objId,this.scope):h},set:function(e){e=e.toString(),h=this instanceof yl==0?"("===e.substr(0,1)?Vo(e.substr(1,e.length-2)):Vo(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof yl==1?Vo(h.substr(1,h.length-1)):h},set:function(e){e=e.toString(),h=this instanceof yl==1?"/"+e:e}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof yl==0?cl(m,this.objId,this.scope):m},set:function(e){e=e.toString(),m=this instanceof yl==0?"("===e.substr(0,1)?Vo(e.substr(1,e.length-2)):Vo(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof yl==1?Vo(m.substr(1,m.length-1)):m},set:function(e){e=e.toString(),m=this instanceof yl==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var f,p=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return p},set:function(e){e=Boolean(e),p=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(f)return f},set:function(e){f=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,1):this.Ff=tl(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,2):this.Ff=tl(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,3):this.Ff=tl(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');g=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(g){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};Yo(ml,dl);var fl=function(){ml.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return ll(t,this.objId,this.scope)},set:function(e){var n,r;r=[],"string"==typeof(n=e)&&(r=function(e,t,n){n||(n=1);for(var r,s=[];r=t.exec(e);)s.push(r[n]);return s}(n,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,18):this.Ff=tl(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=el(this.Ff,19):this.Ff=tl(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=el(this.Ff,20),t.sort()):this.Ff=tl(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,22):this.Ff=tl(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,23):this.Ff=tl(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,27):this.Ff=tl(this.Ff,27)}}),this.hasAppearanceStream=!1};Yo(fl,ml);var pl=function(){fl.call(this),this.fontName="helvetica",this.combo=!1};Yo(pl,fl);var gl=function(){pl.call(this),this.combo=!0};Yo(gl,pl);var xl=function(){gl.call(this),this.edit=!0};Yo(xl,gl);var yl=function(){ml.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,15):this.Ff=tl(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,16):this.Ff=tl(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,17):this.Ff=tl(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,26):this.Ff=tl(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var n,r=[];for(n in r.push("<<"),t)r.push("/"+n+" ("+Ho(e(t[n]))+")");return r.push(">>"),r.join("\n")}},set:function(e){"object"===(0,Yt.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};Yo(yl,ml);var bl=function(){yl.call(this),this.pushButton=!0};Yo(bl,yl);var wl=function(){yl.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};Yo(wl,yl);var vl=function(){var e,t;ml.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,n=[];for(t in n.push("<<"),r)n.push("/"+t+" ("+Ho(e(r[t]))+")");return n.push(">>"),n.join("\n")},set:function(e){"object"===(0,Yt.A)(e)&&(r=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(e){"string"==typeof e&&(r.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=_l.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Yo(vl,ml),wl.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var n=this.Kids[t];n.appearanceStreamContent=e.createAppearanceStream(n.optionName),n.caption=e.getCA()}},wl.prototype.createOption=function(e){var t=new vl;return t.Parent=this,t.optionName=e,this.Kids.push(t),Cl.call(this.scope,t),t};var Nl=function(){yl.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=_l.CheckBox.createAppearanceStream()};Yo(Nl,yl);var Sl=function(){ml.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,13):this.Ff=tl(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,21):this.Ff=tl(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,23):this.Ff=tl(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,24):this.Ff=tl(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,25):this.Ff=tl(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,26):this.Ff=tl(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Yo(Sl,ml);var Al=function(){Sl.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean($o(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=el(this.Ff,14):this.Ff=tl(this.Ff,14)}}),this.password=!0};Yo(Al,Sl);var _l={CheckBox:{createAppearanceStream:function(){return{N:{On:_l.CheckBox.YesNormal},D:{On:_l.CheckBox.YesPushDown,Off:_l.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=[],r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),i=sl(e,e.caption);return n.push("0.749023 g"),n.push("0 0 "+Wo(_l.internal.getWidth(e))+" "+Wo(_l.internal.getHeight(e))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+Wo(i.fontSize)+" Tf "+s),n.push("BT"),n.push(i.text),n.push("ET"),n.push("Q"),n.push("EMC"),t.stream=n.join("\n"),t},YesNormal:function(e){var t=Qo(e);t.scope=e.scope;var n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color),s=[],i=_l.internal.getHeight(e),a=_l.internal.getWidth(e),o=sl(e,e.caption);return s.push("1 g"),s.push("0 0 "+Wo(a)+" "+Wo(i)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+Wo(a-1)+" "+Wo(i-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+n+" "+Wo(o.fontSize)+" Tf "+r),s.push(o.text),s.push("ET"),s.push("Q"),t.stream=s.join("\n"),t},OffPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Wo(_l.internal.getWidth(e))+" "+Wo(_l.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:_l.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=_l.RadioButton.Circle.YesNormal,t.D[e]=_l.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=Qo(e);t.scope=e.scope;var n=[],r=_l.internal.getWidth(e)<=_l.internal.getHeight(e)?_l.internal.getWidth(e)/4:_l.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var s=_l.internal.Bezier_C,i=Number((r*s).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+Go(_l.internal.getWidth(e)/2)+" "+Go(_l.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),n.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),n.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),n.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=[],r=_l.internal.getWidth(e)<=_l.internal.getHeight(e)?_l.internal.getWidth(e)/4:_l.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),i=Number((s*_l.internal.Bezier_C).toFixed(5)),a=Number((r*_l.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Go(_l.internal.getWidth(e)/2)+" "+Go(_l.internal.getHeight(e)/2)+" cm"),n.push(s+" 0 m"),n.push(s+" "+i+" "+i+" "+s+" 0 "+s+" c"),n.push("-"+i+" "+s+" -"+s+" "+i+" -"+s+" 0 c"),n.push("-"+s+" -"+i+" -"+i+" -"+s+" 0 -"+s+" c"),n.push(i+" -"+s+" "+s+" -"+i+" "+s+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+Go(_l.internal.getWidth(e)/2)+" "+Go(_l.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=[],r=_l.internal.getWidth(e)<=_l.internal.getHeight(e)?_l.internal.getWidth(e)/4:_l.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),i=Number((s*_l.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Go(_l.internal.getWidth(e)/2)+" "+Go(_l.internal.getHeight(e)/2)+" cm"),n.push(s+" 0 m"),n.push(s+" "+i+" "+i+" "+s+" 0 "+s+" c"),n.push("-"+i+" "+s+" -"+s+" "+i+" -"+s+" 0 c"),n.push("-"+s+" -"+i+" -"+i+" -"+s+" 0 -"+s+" c"),n.push(i+" -"+s+" "+s+" -"+i+" "+s+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:_l.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=_l.RadioButton.Cross.YesNormal,t.D[e]=_l.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=Qo(e);t.scope=e.scope;var n=[],r=_l.internal.calculateCross(e);return n.push("q"),n.push("1 1 "+Wo(_l.internal.getWidth(e)-2)+" "+Wo(_l.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Wo(r.x1.x)+" "+Wo(r.x1.y)+" m"),n.push(Wo(r.x2.x)+" "+Wo(r.x2.y)+" l"),n.push(Wo(r.x4.x)+" "+Wo(r.x4.y)+" m"),n.push(Wo(r.x3.x)+" "+Wo(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=_l.internal.calculateCross(e),r=[];return r.push("0.749023 g"),r.push("0 0 "+Wo(_l.internal.getWidth(e))+" "+Wo(_l.internal.getHeight(e))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Wo(_l.internal.getWidth(e)-2)+" "+Wo(_l.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Wo(n.x1.x)+" "+Wo(n.x1.y)+" m"),r.push(Wo(n.x2.x)+" "+Wo(n.x2.y)+" l"),r.push(Wo(n.x4.x)+" "+Wo(n.x4.y)+" m"),r.push(Wo(n.x3.x)+" "+Wo(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=Qo(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Wo(_l.internal.getWidth(e))+" "+Wo(_l.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+n}};_l.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=_l.internal.getWidth(e),n=_l.internal.getHeight(e),r=Math.min(t,n);return{x1:{x:(t-r)/2,y:(n-r)/2+r},x2:{x:(t-r)/2+r,y:(n-r)/2},x3:{x:(t-r)/2,y:(n-r)/2},x4:{x:(t-r)/2+r,y:(n-r)/2+r}}}},_l.internal.getWidth=function(e){var t=0;return"object"===(0,Yt.A)(e)&&(t=Xo(e.Rect[2])),t},_l.internal.getHeight=function(e){var t=0;return"object"===(0,Yt.A)(e)&&(t=Xo(e.Rect[3])),t};var Cl=zo.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(ml.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(al)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");qo=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new hl,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.objId=void 0,r.hasAnnotation&&ol(r,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var n=!e;for(var r in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(r)){var s=e[r],i=[],a=s.Rect;if(s.Rect&&(s.Rect=nl(s.Rect,t)),t.internal.newObjectDeferredBegin(s.objId,!0),s.DA=_l.createDefaultAppearanceStream(s),"object"===(0,Yt.A)(s)&&"function"==typeof s.getKeyValueListForStream&&(i=s.getKeyValueListForStream()),s.Rect=a,s.hasAppearanceStream&&!s.appearanceStreamContent){var o=rl(s);i.push({key:"AP",value:"<</N "+o+">>"}),t.internal.acroformPlugin.xForms.push(o)}if(s.appearanceStreamContent){var l="";for(var c in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(c)){var d=s.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(d).length>=1||Array.isArray(d)){for(var r in d)if(d.hasOwnProperty(r)){var u=d[r];"function"==typeof u&&(u=u.call(t,s)),l+="/"+r+" "+u+" ",t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u)}}else"function"==typeof(u=d)&&(u=u.call(t,s)),l+="/"+r+" "+u,t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u);l+=">>"}i.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:i,objectId:s.objId}),t.internal.out("endobj")}n&&function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=n,s=e[n];t.internal.newObjectDeferredBegin(s.objId,!0),"object"===(0,Yt.A)(s)&&"function"==typeof s.putStream&&s.putStream(),delete e[r]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof ml))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};zo.AcroFormChoiceField=fl,zo.AcroFormListBox=pl,zo.AcroFormComboBox=gl,zo.AcroFormEditBox=xl,zo.AcroFormButton=yl,zo.AcroFormPushButton=bl,zo.AcroFormRadioButton=wl,zo.AcroFormCheckBox=Nl,zo.AcroFormTextField=Sl,zo.AcroFormPasswordField=Al,zo.AcroFormAppearance=_l,zo.AcroForm={ChoiceField:fl,ListBox:pl,ComboBox:gl,EditBox:xl,Button:yl,PushButton:bl,RadioButton:wl,CheckBox:Nl,TextField:Sl,PasswordField:Al,Appearance:_l},Uo.AcroForm={ChoiceField:fl,ListBox:pl,ComboBox:gl,EditBox:xl,Button:yl,PushButton:bl,RadioButton:wl,CheckBox:Nl,TextField:Sl,PasswordField:Al,Appearance:_l};Uo.AcroForm;function Il(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})}!function(e){var t="addImage_";e.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},s=e.__addimage__.getImageFileTypeByImageData=function(e,t){var s,i,a,o,l,c=n;if("RGBA"===(t=t||n)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(N(e))for(l in r)for(a=r[l],s=0;s<a.length;s+=1){for(o=!0,i=0;i<a[s].length;i+=1)if(void 0!==a[s][i]&&a[s][i]!==e[i]){o=!1;break}if(!0===o){c=l;break}}else for(l in r)for(a=r[l],s=0;s<a.length;s+=1){for(o=!0,i=0;i<a[s].length;i+=1)if(void 0!==a[s][i]&&a[s][i]!==e.charCodeAt(i)){o=!1;break}if(!0===o){c=l;break}}return c===n&&t!==n&&(c=t),c},i=function e(t){for(var n=this.internal.write,r=this.internal.putStream,s=(0,this.internal.getFilters)();-1!==s.indexOf("FlateEncode");)s.splice(s.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var i=[];if(i.push({key:"Type",value:"/XObject"}),i.push({key:"Subtype",value:"/Image"}),i.push({key:"Width",value:t.width}),i.push({key:"Height",value:t.height}),t.colorSpace===x.INDEXED?i.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(i.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===x.DEVICE_CMYK&&i.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),i.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&i.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)&&t.transparency.length>0){for(var a="",o=0,l=t.transparency.length;o<l;o++)a+=t.transparency[o]+" "+t.transparency[o]+" ";i.push({key:"Mask",value:"["+a+"]"})}void 0!==t.sMask&&i.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:i,alreadyAppliedFilters:c,objectId:t.objectId}),n("endobj"),"sMask"in t&&void 0!==t.sMask){var d,u=null!==(d=t.sMaskBitsPerComponent)&&void 0!==d?d:t.bitsPerComponent,h={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:u,data:t.sMask};"filter"in t&&(h.decodeParameters="/Predictor ".concat(t.predictor," /Colors 1 /BitsPerComponent ").concat(u," /Columns ").concat(t.width),h.filter=t.filter),e.call(this,h)}if(t.colorSpace===x.INDEXED){var m=this.internal.newObject();r({data:A(new Uint8Array(t.palette)),objectId:m}),n("endobj")}},a=function(){var e=this.internal.collections[t+"images"];for(var n in e)i.call(this,e[n])},o=function(){var e,n=this.internal.collections[t+"images"],r=this.internal.write;for(var s in n)r("/I"+(e=n[s]).index,e.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var e=this.internal.collections[t+"images"];return l.call(this),e},d=function(){return Object.keys(this.internal.collections[t+"images"]).length},u=function(t){return"function"==typeof e["process"+t.toUpperCase()]},h=function(e){return"object"===(0,Yt.A)(e)&&1===e.nodeType},m=function(t,n){if("IMG"===t.nodeName&&t.hasAttribute("src")){var r=""+t.getAttribute("src");if(0===r.indexOf("data:image/"))return po(unescape(r).split("base64,").pop());var s=e.loadFile(r,!0);if(void 0!==s)return s}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var i;switch(n){case"PNG":i="image/png";break;case"WEBP":i="image/webp";break;default:i="image/jpeg"}return po(t.toDataURL(i,1).split("base64,").pop())}},f=function(e){var n=this.internal.collections[t+"images"];if(n)for(var r in n)if(e===n[r].alias)return n[r]},p=function(e,t,n){return e||t||(e=-96,t=-96),e<0&&(e=-1*n.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*n.height*72/t/this.internal.scaleFactor),0===e&&(e=t*n.width/n.height),0===t&&(t=e*n.height/n.width),[e,t]},g=function(e,t,n,r,s,i){var a=p.call(this,n,r,s),o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,d=c.call(this);if(n=a[0],r=a[1],d[s.index]=s,i){i*=Math.PI/180;var u=Math.cos(i),h=Math.sin(i),m=function(e){return e.toFixed(4)},f=[m(u),m(h),m(-1*h),m(u),0,0,"cm"]}this.internal.write("q"),i?(this.internal.write([1,"0","0",1,o(e),l(t+r),"cm"].join(" ")),this.internal.write(f.join(" ")),this.internal.write([o(n),"0","0",o(r),"0","0","cm"].join(" "))):this.internal.write([o(n),"0","0",o(r),o(e),l(t+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+s.index+" Do"),this.internal.write("Q")},x=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},b=e.__addimage__.sHashCode=function(e){var t,n,r=0;if("string"==typeof e)for(n=e.length,t=0;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;else if(N(e))for(n=e.byteLength/2,t=0;t<n;t++)r=(r<<5)-r+e[t],r|=0;return r},w=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},v=e.__addimage__.extractImageFromDataUrl=function(e){if(null==e)return null;if(!(e=e.trim()).startsWith("data:"))return null;var t=e.indexOf(",");return t<0?null:e.substring(0,t).trim().endsWith("base64")?e.substring(t+1):null};e.__addimage__.isArrayBuffer=function(e){return e instanceof ArrayBuffer};var N=e.__addimage__.isArrayBufferView=function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array},S=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n},A=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",n=N(e)?e:new Uint8Array(e),r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return t};e.addImage=function(){var e,t,r,s,i,a,o,c,d;if("number"==typeof arguments[1]?(t=n,r=arguments[1],s=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],c=arguments[6],d=arguments[7]):(t=arguments[1],r=arguments[2],s=arguments[3],i=arguments[4],a=arguments[5],o=arguments[6],c=arguments[7],d=arguments[8]),"object"===(0,Yt.A)(e=arguments[0])&&!h(e)&&"imageData"in e){var u=e;e=u.imageData,t=u.format||t||n,r=u.x||r||0,s=u.y||s||0,i=u.w||u.width||i,a=u.h||u.height||a,o=u.alias||o,c=u.compression||c,d=u.rotation||u.angle||d}var m=this.internal.getFilters();if(void 0===c&&-1!==m.indexOf("FlateEncode")&&(c="SLOW"),isNaN(r)||isNaN(s))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var f=_.call(this,e,t,o,c);return g.call(this,r,s,i,a,f,d),this};var _=function(t,r,i,a){var o,l,c;if("string"==typeof t&&s(t)===n){t=unescape(t);var p=C(t,!1);(""!==p||void 0!==(p=e.loadFile(t,!0)))&&(t=p)}if(h(t)&&(t=m(t,r)),r=s(t,r),!u(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(c=i)||0===c.length)&&(i=function(e){return"string"==typeof e||N(e)?b(e):N(e.data)?b(e.data):null}(t)),(o=f.call(this,i))||(t instanceof Uint8Array||"RGBA"===r||(l=t,t=S(t)),o=this["process"+r.toUpperCase()](t,d.call(this),i,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:y.NONE}(a),l)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},C=e.__addimage__.convertBase64ToBinaryString=function(e,t){t="boolean"!=typeof t||t;var n,r="";if("string"==typeof e){var i;n=null!==(i=v(e))&&void 0!==i?i:e;try{r=po(n)}catch(s){if(t)throw w(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+s.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return r};e.getImageProperties=function(t){var r,i,a="";if(h(t)&&(t=m(t)),"string"==typeof t&&s(t)===n&&(""===(a=C(t,!1))&&(a=e.loadFile(t)||""),t=a),i=s(t),!u(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if(t instanceof Uint8Array||(t=S(t)),!(r=this["process"+i.toUpperCase()](t)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=i,r}}(Uo.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};Uo.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var n,r,s,i=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(e.objId),l=e.pageContext.annotations,c=!1,d=0;d<l.length&&!c;d++)switch((n=l[d]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var u=0;u<l.length;u++){n=l[u];var h=this.internal.pdfEscape,m=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var f=this.internal.newAdditionalObject(),p=this.internal.newAdditionalObject(),g=this.internal.getEncryptor(f.objId),x=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(r="/Rect ["+i(n.bounds.x)+" "+a(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+a(n.bounds.y)+"] ")+"/Contents ("+h(g(n.contents))+")",s+=" /Popup "+p.objId+" 0 R",s+=" /P "+o.objId+" 0 R",s+=" /T ("+h(g(x))+") >>",f.content=s;var y=f.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+i(n.bounds.x+30)+" "+a(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+a(n.bounds.y)+"] ")+" /Parent "+y,n.open&&(s+=" /Open true"),s+=" >>",p.content=s,this.internal.write(f.objId,"0 R",p.objId,"0 R");break;case"freetext":r="/Rect ["+i(n.bounds.x)+" "+a(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+a(n.bounds.y+n.bounds.h)+"] ";var b=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+h(m(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+b+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var w=this.annotations._nameMap[n.options.name];n.options.pageNumber=w.page,n.options.top=w.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+h(m(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;default:var v=a(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+v+" "+n.options.zoom+"]"}""!=s&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,n,r,s){var i=this.internal.getCurrentPageInfo(),a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:a(e),y:o(t),w:a(e+n),h:o(t+r)},options:s,type:"link"})},e.textWithLink=function(e,t,n,r){var s,i,a=this.getTextWidth(e),o=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){i=r.maxWidth;var l=this.splitTextToSize(e,i).length;s=Math.ceil(o*l)}else i=a,s=o;return this.text(e,t,n,r),n+=.2*o,"center"===r.align&&(t-=a/2),"right"===r.align&&(t-=a),this.link(t,n-o,i,s,r),a},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(Uo.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];e.__arabicParser__={};var i=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},a=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},o=e.__arabicParser__.isArabicEndLetter=function(e){return a(e)&&i(e)&&t[e.charCodeAt(0)].length<=2},l=e.__arabicParser__.isArabicAlfLetter=function(e){return a(e)&&s.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return a(e)&&i(e)&&t[e.charCodeAt(0)].length>=1};var c=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return a(e)&&i(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return a(e)&&i(e)&&t[e.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return a(e)&&i(e)&&4==t[e.charCodeAt(0)].length},u=e.__arabicParser__.resolveLigatures=function(e){var t=0,r=n,s="",i=0;for(t=0;t<e.length;t+=1)void 0!==r[e.charCodeAt(t)]?(i++,"number"==typeof(r=r[e.charCodeAt(t)])&&(s+=String.fromCharCode(r),r=n,i=0),t===e.length-1&&(r=n,s+=e.charAt(t-(i-1)),t-=i-1,i=0)):(r=n,s+=e.charAt(t-i),t-=i,i=0);return s};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==r[e.charCodeAt(0)]};var h=e.__arabicParser__.getCorrectForm=function(e,t,n){return a(e)?!1===i(e)?-1:!c(e)||!a(t)&&!a(n)||!a(n)&&o(t)||o(e)&&!a(t)||o(e)&&l(t)||o(e)&&o(t)?0:d(e)&&a(t)&&!o(t)&&a(n)&&c(n)?3:o(e)||!a(n)?1:2:-1},m=function(e){var n=0,r=0,s=0,i="",o="",l="",c=(e=e||"").split("\\s+"),d=[];for(n=0;n<c.length;n+=1){for(d.push(""),r=0;r<c[n].length;r+=1)i=c[n][r],o=c[n][r-1],l=c[n][r+1],a(i)?(s=h(i,o,l),d[n]+=-1!==s?String.fromCharCode(t[i.charCodeAt(0)][s]):i):d[n]+=i;d[n]=u(d[n])}return d.join(" ")},f=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(t)){var r=0;for(n=[],r=0;r<t.length;r+=1)Array.isArray(t[r])?n.push([m(t[r][0]),t[r][1],t[r][2]]):n.push([m(t[r])]);e=n}else e=m(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",f])}(Uo.API),Uo.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform","javascript"===e.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(e){n=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(e){r=e}});var s={};Object.defineProperty(this,"style",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var n;if("2d"!==(e=e||"2d"))return null;for(n in t)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=t[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Uo.API),function(e){var t={left:0,top:0,bottom:0,right:0},n=!1,r=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var s=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return s},set:function(e){s=e}});var i=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var a=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return a},set:function(e){a=e}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return r.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){r.call(this);var n=(t=t||{}).fontSize||this.getFontSize(),s=t.font||this.getFont(),i=t.scaleFactor||this.internal.scaleFactor,a=0,o=0,l=0,c=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var d=t.maxWidth;d>0?"string"==typeof e?e=this.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(c.splitTextToSize(t,d))},[])):e=Array.isArray(e)?e:[e];for(var u=0;u<e.length;u++)a<(l=this.getStringUnitWidth(e[u],{font:s})*n)&&(a=l);return 0!==a&&(o=e.length),{w:a/=i,h:Math.max((o*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/i,0)}},e.cellAddPage=function(){r.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new i(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=e.cell=function(){var e;e=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var s=this.internal.__cell__.lastCell,a=this.internal.__cell__.padding,o=this.internal.__cell__.margins||t,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==s.lineNumber&&(s.lineNumber===e.lineNumber?(e.x=(s.x||0)+(s.width||0),e.y=s.y||0):s.y+s.height+e.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=o.top,c&&l&&(this.printHeaderRow(e.lineNumber,!0),e.y+=l[0].height)):e.y=s.y+s.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===n?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-a,e.y+a,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+a,{align:"center",baseline:"top",maxWidth:e.width-a-a}):this.text(e.text,e.x+a,e.y+a,{align:"left",baseline:"top",maxWidth:e.width-a-a})),this.internal.__cell__.lastCell=e,this};e.table=function(e,n,l,c,d){if(r.call(this),!l)throw new Error("No data for PDF table.");var u,h,m,f,p=[],g=[],x=[],y={},b={},w=[],v=[],N=(d=d||{}).autoSize||!1,S=!1!==d.printHeaders,A=d.css&&void 0!==d.css["font-size"]?16*d.css["font-size"]:d.fontSize||12,_=d.margins||Object.assign({width:this.getPageWidth()},t),C="number"==typeof d.padding?d.padding:3,I=d.headerBackgroundColor||"#c8c8c8",E=d.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=S,this.internal.__cell__.margins=_,this.internal.__cell__.table_font_size=A,this.internal.__cell__.padding=C,this.internal.__cell__.headerBackgroundColor=I,this.internal.__cell__.headerTextColor=E,this.setFontSize(A),null==c)g=p=Object.keys(l[0]),x=p.map(function(){return"left"});else if(Array.isArray(c)&&"object"===(0,Yt.A)(c[0]))for(p=c.map(function(e){return e.name}),g=c.map(function(e){return e.prompt||e.name||""}),x=c.map(function(e){return e.align||"left"}),u=0;u<c.length;u+=1)b[c[u].name]=.7499990551181103*c[u].width;else Array.isArray(c)&&"string"==typeof c[0]&&(g=p=c,x=p.map(function(){return"left"}));if(N||Array.isArray(c)&&"string"==typeof c[0])for(u=0;u<p.length;u+=1){for(y[f=p[u]]=l.map(function(e){return e[f]}),this.setFont(void 0,"bold"),w.push(this.getTextDimensions(g[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),h=y[f],this.setFont(void 0,"normal"),m=0;m<h.length;m+=1)w.push(this.getTextDimensions(h[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);b[f]=Math.max.apply(null,w)+C+C,w=[]}if(S){var T={};for(u=0;u<p.length;u+=1)T[p[u]]={},T[p[u]].text=g[u],T[p[u]].align=x[u];var j=o.call(this,T,b);v=p.map(function(t){return new i(e,n,b[t],j,T[t].text,void 0,T[t].align)}),this.setTableHeaderRow(v),this.printHeaderRow(1,!1)}var k=c.reduce(function(e,t){return e[t.name]=t.align,e},{});for(u=0;u<l.length;u+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:u,data:l[u]},this);var D=o.call(this,l[u],b);for(m=0;m<p.length;m+=1){var P=l[u][p[m]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:u,col:m,data:P},this),a.call(this,new i(e,n,b[p[m]],D,P,u+2,k[p[m]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=n,this};var o=function(e,t){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,s=this.internal.scaleFactor;return Object.keys(e).map(function(r){var s=e[r];return this.splitTextToSize(s.hasOwnProperty("text")?s.text:s,t[r]-n-n)},this).map(function(e){return this.getLineHeightFactor()*e.length*r/s+n+n},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){r.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var s;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var o=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(o[0],o[1],o[2],o[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){s=this.internal.__cell__.tableHeaderRow[c].clone(),t&&(s.y=this.internal.__cell__.margins.top||0,l.push(s)),s.lineNumber=e;var d=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,s),this.setTextColor(d)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),n=!1}}(Uo.API);var El={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Tl=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],jl=Il(Tl),kl=[100,200,300,400,500,600,700,800,900],Dl=Il(kl);function Pl(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),n=function(e){return El[e=e||"normal"]?e:"normal"}(e.style),r=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),s=function(e){return"number"==typeof jl[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:n,weight:r,stretch:s,src:e.src||[],ref:e.ref||{name:t,style:[s,n,r].join(" ")}}}function Rl(e,t,n,r){var s;for(s=n;s>=0&&s<t.length;s+=r)if(e[t[s]])return e[t[s]];for(s=n;s>=0&&s<t.length;s-=r)if(e[t[s]])return e[t[s]]}var Ol={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Ll={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Ml(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function Fl(e){return e.trimLeft()}function Bl(e,t){for(var n=0;n<e.length;){if(e.charAt(n)===t)return[e.substring(0,n),e.substring(n+1)];n+=1}return null}function Ul(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var zl,ql,Hl,Vl,Wl,Gl,Yl,Xl,Ql,Kl=["times"];function Zl(e,t,n,r,s){var i=4,a=ec;switch(s){case Uo.API.image_compression.FAST:i=1,a=$l;break;case Uo.API.image_compression.MEDIUM:i=6,a=tc;break;case Uo.API.image_compression.SLOW:i=9,a=nc}e=function(e,t,n,r){for(var s,i=e.length/t,a=new Uint8Array(e.length+i),o=[Jl,$l,ec,tc,nc],l=0;l<i;l+=1){var c=l*t,d=e.subarray(c,c+t);if(r)a.set(r(d,n,s),c+l);else{for(var u=o.length,h=[],m=0;m<u;m+=1)h[m]=o[m](d,n,s);var f=sc(h.concat());a.set(h[f],c+l)}s=d}return a}(e,t,Math.ceil(n*r/8),a);var o=Dn(e,{level:i});return Uo.API.__addimage__.arrayBufferToBinaryString(o)}function Jl(e){var t=Array.apply([],e);return t.unshift(0),t}function $l(e,t){var n=e.length,r=[];r[0]=1;for(var s=0;s<n;s+=1){var i=e[s-t]||0;r[s+1]=e[s]-i+256&255}return r}function ec(e,t,n){var r=e.length,s=[];s[0]=2;for(var i=0;i<r;i+=1){var a=n&&n[i]||0;s[i+1]=e[i]-a+256&255}return s}function tc(e,t,n){var r=e.length,s=[];s[0]=3;for(var i=0;i<r;i+=1){var a=e[i-t]||0,o=n&&n[i]||0;s[i+1]=e[i]+256-(a+o>>>1)&255}return s}function nc(e,t,n){var r=e.length,s=[];s[0]=4;for(var i=0;i<r;i+=1){var a=rc(e[i-t]||0,n&&n[i]||0,n&&n[i-t]||0);s[i+1]=e[i]-a+256&255}return s}function rc(e,t,n){if(e===t&&t===n)return e;var r=Math.abs(t-n),s=Math.abs(e-n),i=Math.abs(e+t-n-n);return r<=s&&r<=i?e:s<=i?t:n}function sc(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))}function ic(e,t,n){var r=t*n,s=Math.floor(r/8),i=16-(r-8*s+n),a=(1<<n)-1;return oc(e,s)>>i&a}function ac(e,t,n,r){var s=n*r,i=Math.floor(s/8),a=16-(s-8*i+r),o=(1<<r)-1,l=(t&o)<<a;!function(e,t,n){if(t+1<e.byteLength)e.setUint16(t,n,!1);else{var r=n>>8&255;e.setUint8(t,r)}}(e,i,oc(e,i)&~(o<<a)&65535|l)}function oc(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function lc(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,s=e[t++],i=s>>7,a=1<<1+(7&s);e[t++],e[t++];var o=null,l=null;i&&(o=t,l=a,t+=3*a);var c=!0,d=[],u=0,h=null,m=0,f=null;for(this.width=n,this.height=r;c&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,f=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var p=e[t++];u=e[t++]|e[t++]<<8,h=e[t++],1&p||(h=null),m=p>>2&7,t++;break;case 254:for(;;){if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,x=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,w=e[t++],v=w>>6&1,N=1<<1+(7&w),S=o,A=l,_=!1;w>>7&&(_=!0,S=t,A=N,t+=3*N);var C=t;for(t++;;){var I;if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}d.push({x:g,y:x,width:y,height:b,has_local_palette:_,palette_offset:S,palette_size:A,data_offset:C,data_length:t-C,transparent_index:h,interlaced:!!v,delay:u,disposal:m});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return f},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(t,r){var s=this.frameInfo(t),i=s.width*s.height,a=new Uint8Array(i);cc(e,s.data_offset,a,i);var o=s.palette_offset,l=s.transparent_index;null===l&&(l=256);var c=s.width,d=n-c,u=c,h=4*(s.y*n+s.x),m=4*((s.y+s.height)*n+s.x),f=h,p=4*d;!0===s.interlaced&&(p+=4*n*7);for(var g=8,x=0,y=a.length;x<y;++x){var b=a[x];if(0===u&&(u=c,(f+=p)>=m&&(p=4*d+4*n*(g-1),f=h+(c+d)*(g<<1),g>>=1)),b===l)f+=4;else{var w=e[o+3*b],v=e[o+3*b+1],N=e[o+3*b+2];r[f++]=N,r[f++]=v,r[f++]=w,r[f++]=255}--u}},this.decodeAndBlitFrameRGBA=function(t,r){var s=this.frameInfo(t),i=s.width*s.height,a=new Uint8Array(i);cc(e,s.data_offset,a,i);var o=s.palette_offset,l=s.transparent_index;null===l&&(l=256);var c=s.width,d=n-c,u=c,h=4*(s.y*n+s.x),m=4*((s.y+s.height)*n+s.x),f=h,p=4*d;!0===s.interlaced&&(p+=4*n*7);for(var g=8,x=0,y=a.length;x<y;++x){var b=a[x];if(0===u&&(u=c,(f+=p)>=m&&(p=4*d+4*n*(g-1),f=h+(c+d)*(g<<1),g>>=1)),b===l)f+=4;else{var w=e[o+3*b],v=e[o+3*b+1],N=e[o+3*b+2];r[f++]=w,r[f++]=v,r[f++]=N,r[f++]=255}--u}}}function cc(e,t,n,r){for(var s=e[t++],i=1<<s,a=i+1,o=a+1,l=s+1,c=(1<<l)-1,d=0,u=0,h=0,m=e[t++],f=new Int32Array(4096),p=null;;){for(;d<16&&0!==m;)u|=e[t++]<<d,d+=8,1===m?m=e[t++]:--m;if(d<l)break;var g=u&c;if(u>>=l,d-=l,g!==i){if(g===a)break;for(var x=g<o?g:p,y=0,b=x;b>i;)b=f[b]>>8,++y;var w=b;if(h+y+(x!==g?1:0)>r)return void lo.log("Warning, gif stream longer than expected.");n[h++]=w;var v=h+=y;for(x!==g&&(n[h++]=w),b=x;y--;)b=f[b],n[--v]=255&b,b>>=8;null!==p&&o<4096&&(f[o++]=p<<8|w,o>=c+1&&l<12&&(++l,c=c<<1|1)),p=g}else o=a+1,c=(1<<(l=s+1))-1,p=null}return h!==r&&lo.log("Warning, gif stream shorter than expected."),n}function dc(e){var t,n,r,s,i,a=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(65535),h=new Array(65535),m=new Array(64),f=new Array(64),p=[],g=0,x=7,y=new Array(64),b=new Array(64),w=new Array(64),v=new Array(256),N=new Array(2048),S=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],A=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],_=[0,1,2,3,4,5,6,7,8,9,10,11],C=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],E=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],j=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],k=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function D(e,t){for(var n=0,r=0,s=new Array,i=1;i<=16;i++){for(var a=1;a<=e[i];a++)s[t[r]]=[],s[t[r]][0]=n,s[t[r]][1]=i,r++,n++;n*=2}return s}function P(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(g|=1<<x),n--,--x<0&&(255==g?(R(255),R(0)):R(g),x=7,g=0)}function R(e){p.push(e)}function O(e){R(e>>8&255),R(255&e)}function L(e,t,n,r,s){for(var i,a=s[0],o=s[240],l=function(e,t){var n,r,s,i,a,o,l,c,d,u,h=0;for(d=0;d<8;++d){n=e[h],r=e[h+1],s=e[h+2],i=e[h+3],a=e[h+4],o=e[h+5],l=e[h+6];var f=n+(c=e[h+7]),p=n-c,g=r+l,x=r-l,y=s+o,b=s-o,w=i+a,v=i-a,N=f+w,S=f-w,A=g+y,_=g-y;e[h]=N+A,e[h+4]=N-A;var C=.707106781*(_+S);e[h+2]=S+C,e[h+6]=S-C;var I=.382683433*((N=v+b)-(_=x+p)),E=.5411961*N+I,T=1.306562965*_+I,j=.707106781*(A=b+x),k=p+j,D=p-j;e[h+5]=D+E,e[h+3]=D-E,e[h+1]=k+T,e[h+7]=k-T,h+=8}for(h=0,d=0;d<8;++d){n=e[h],r=e[h+8],s=e[h+16],i=e[h+24],a=e[h+32],o=e[h+40],l=e[h+48];var P=n+(c=e[h+56]),R=n-c,O=r+l,L=r-l,M=s+o,F=s-o,B=i+a,U=i-a,z=P+B,q=P-B,H=O+M,V=O-M;e[h]=z+H,e[h+32]=z-H;var W=.707106781*(V+q);e[h+16]=q+W,e[h+48]=q-W;var G=.382683433*((z=U+F)-(V=L+R)),Y=.5411961*z+G,X=1.306562965*V+G,Q=.707106781*(H=F+L),K=R+Q,Z=R-Q;e[h+40]=Z+Y,e[h+24]=Z-Y,e[h+8]=K+X,e[h+56]=K-X,h++}for(d=0;d<64;++d)u=e[d]*t[d],m[d]=u>0?u+.5|0:u-.5|0;return m}(e,t),c=0;c<64;++c)f[S[c]]=l[c];var d=f[0]-n;n=f[0],0==d?P(r[0]):(P(r[h[i=32767+d]]),P(u[i]));for(var p=63;p>0&&0==f[p];)p--;if(0==p)return P(a),n;for(var g,x=1;x<=p;){for(var y=x;0==f[x]&&x<=p;)++x;var b=x-y;if(b>=16){g=b>>4;for(var w=1;w<=g;++w)P(o);b&=15}i=32767+f[x],P(s[(b<<4)+h[i]]),P(u[i]),x++}return 63!=p&&P(a),n}function M(e){e=Math.min(Math.max(e,1),100),i!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=a((t[n]*e+50)/100);r=Math.min(Math.max(r,1),255),o[S[n]]=r}for(var s=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],i=0;i<64;i++){var u=a((s[i]*e+50)/100);u=Math.min(Math.max(u,1),255),l[S[i]]=u}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],m=0,f=0;f<8;f++)for(var p=0;p<8;p++)c[m]=1/(o[S[m]]*h[f]*h[p]*8),d[m]=1/(l[S[m]]*h[f]*h[p]*8),m++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),i=e)}this.encode=function(e,i){i&&M(i),p=new Array,g=0,x=7,O(65496),O(65504),O(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),O(1),O(1),R(0),R(0),function(){O(65499),O(132),R(0);for(var e=0;e<64;e++)R(o[e]);R(1);for(var t=0;t<64;t++)R(l[t])}(),function(e,t){O(65472),O(17),R(8),O(t),O(e),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(e.width,e.height),function(){O(65476),O(418),R(0);for(var e=0;e<16;e++)R(A[e+1]);for(var t=0;t<=11;t++)R(_[t]);R(16);for(var n=0;n<16;n++)R(C[n+1]);for(var r=0;r<=161;r++)R(I[r]);R(1);for(var s=0;s<16;s++)R(E[s+1]);for(var i=0;i<=11;i++)R(T[i]);R(17);for(var a=0;a<16;a++)R(j[a+1]);for(var o=0;o<=161;o++)R(k[o])}(),O(65498),O(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var a=0,u=0,h=0;g=0,x=7,this.encode.displayName="_encode_";for(var m,f,v,S,D,F,B,U,z,q=e.data,H=e.width,V=e.height,W=4*H,G=0;G<V;){for(m=0;m<W;){for(D=W*G+m,B=-1,U=0,z=0;z<64;z++)F=D+(U=z>>3)*W+(B=4*(7&z)),G+U>=V&&(F-=W*(G+1+U-V)),m+B>=W&&(F-=m+B-W+4),f=q[F++],v=q[F++],S=q[F++],y[z]=(N[f]+N[v+256|0]+N[S+512|0]>>16)-128,b[z]=(N[f+768|0]+N[v+1024|0]+N[S+1280|0]>>16)-128,w[z]=(N[f+1280|0]+N[v+1536|0]+N[S+1792|0]>>16)-128;a=L(y,c,a,t,r),u=L(b,d,u,n,s),h=L(w,d,h,n,s),m+=32}G+=8}if(x>=0){var Y=[];Y[1]=x+1,Y[0]=(1<<x+1)-1,P(Y)}return O(65497),new Uint8Array(p)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)v[t]=e(t)}(),t=D(A,_),n=D(E,T),r=D(C,I),s=D(j,k),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var r=e;r<t;r++)h[32767+r]=n,u[32767+r]=[],u[32767+r][1]=n,u[32767+r][0]=r;for(var s=-(t-1);s<=-e;s++)h[32767+s]=n,u[32767+s]=[],u[32767+s][1]=n,u[32767+s][0]=t-1+s;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)N[e]=19595*e,N[e+256|0]=38470*e,N[e+512|0]=7471*e+32768,N[e+768|0]=-11059*e,N[e+1024|0]=-21709*e,N[e+1280|0]=32768*e+8421375,N[e+1536|0]=-27439*e,N[e+1792|0]=-5329*e}(),M(e)}function uc(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function hc(e){function t(e){if(!e)throw Error("assert :P")}function n(e,t,n){for(var r=0;4>r;r++)if(e[t+r]!=n.charCodeAt(r))return!0;return!1}function r(e,t,n,r,s){for(var i=0;i<s;i++)e[t+i]=n[r+i]}function s(e,t,n,r){for(var s=0;s<r;s++)e[t+s]=n}function i(e){return new Int32Array(e)}function a(e,t){for(var n=[],r=0;r<e;r++)n.push(new t);return n}function o(e,t){var n=[];return function e(n,r,s){for(var i=s[r],a=0;a<i&&(n.push(s.length>r+1?[]:new t),!(s.length<r+1));a++)e(n[a],r+1,s)}(n,0,e),n}var l=function(){var e=this;function l(e,t){for(var n=1<<t-1>>>0;e&n;)n>>>=1;return n?(e&n-1)+n:e}function c(e,n,r,s,i){t(!(s%r));do{e[n+(s-=r)]=i}while(0<s)}function d(e,n,r,s,a){if(t(2328>=a),512>=a)var o=i(512);else if(null==(o=i(a)))return 0;return function(e,n,r,s,a,o){var d,h,m=n,f=1<<r,p=i(16),g=i(16);for(t(0!=a),t(null!=s),t(null!=e),t(0<r),h=0;h<a;++h){if(15<s[h])return 0;++p[s[h]]}if(p[0]==a)return 0;for(g[1]=0,d=1;15>d;++d){if(p[d]>1<<d)return 0;g[d+1]=g[d]+p[d]}for(h=0;h<a;++h)d=s[h],0<s[h]&&(o[g[d]++]=h);if(1==g[15])return(s=new u).g=0,s.value=o[0],c(e,m,1,f,s),f;var x,y=-1,b=f-1,w=0,v=1,N=1,S=1<<r;for(h=0,d=1,a=2;d<=r;++d,a<<=1){if(v+=N<<=1,0>(N-=p[d]))return 0;for(;0<p[d];--p[d])(s=new u).g=d,s.value=o[h++],c(e,m+w,a,S,s),w=l(w,d)}for(d=r+1,a=2;15>=d;++d,a<<=1){if(v+=N<<=1,0>(N-=p[d]))return 0;for(;0<p[d];--p[d]){if(s=new u,(w&b)!=y){for(m+=S,x=1<<(y=d)-r;15>y&&!(0>=(x-=p[y]));)++y,x<<=1;f+=S=1<<(x=y-r),e[n+(y=w&b)].g=x+r,e[n+y].value=m-n-y}s.g=d-r,s.value=o[h++],c(e,m+(w>>r),a,S,s),w=l(w,d)}}return v!=2*g[15]-1?0:f}(e,n,r,s,a,o)}function u(){this.value=this.g=0}function h(){this.value=this.g=0}function m(){this.G=a(5,u),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Fn,h)}function f(e,n,r,s){t(null!=e),t(null!=n),t(2147483648>s),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=n,e.pa=r,e.Jd=n,e.Yc=r+s,e.Zc=4<=s?r+s-4+1:r,C(e)}function p(e,t){for(var n=0;0<t--;)n|=E(e,128)<<t;return n}function g(e,t){var n=p(e,t);return I(e)?-n:n}function x(e,n,r,s){var i,a=0;for(t(null!=e),t(null!=n),t(4294967288>s),e.Sb=s,e.Ra=0,e.u=0,e.h=0,4<s&&(s=4),i=0;i<s;++i)a+=n[r+i]<<8*i;e.Ra=a,e.bb=s,e.oa=n,e.pa=r}function y(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<zn-8>>>0,++e.bb,e.u-=8;S(e)&&(e.h=1,e.u=0)}function b(e,n){if(t(0<=n),!e.h&&n<=Un){var r=N(e)&Bn[n];return e.u+=n,y(e),r}return e.h=1,e.u=0}function w(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function v(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function N(e){return e.Ra>>>(e.u&zn-1)>>>0}function S(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>zn}function A(e,t){e.u=t,e.h=S(e)}function _(e){e.u>=qn&&(t(e.u>=qn),y(e))}function C(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function I(e){return p(e,1)}function E(e,t){var n=e.Ca;0>e.b&&C(e);var r=e.b,s=n*t>>>8,i=(e.I>>>r>s)+0;for(i?(n-=s,e.I-=s+1<<r>>>0):n=s+1,r=n,s=0;256<=r;)s+=8,r>>=8;return r=7^s+Hn[r],e.b-=r,e.Ca=(n<<r)-1,i}function T(e,t,n){e[t+0]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function j(e,t){return e[t+0]|e[t+1]<<8}function k(e,t){return j(e,t)|e[t+2]<<16}function D(e,t){return j(e,t)|j(e,t+2)<<16}function P(e,n){var r=1<<n;return t(null!=e),t(0<n),e.X=i(r),null==e.X?0:(e.Mb=32-n,e.Xa=n,1)}function R(e,n){t(null!=e),t(null!=n),t(e.Xa==n.Xa),r(n.X,0,e.X,0,1<<n.Xa)}function O(){this.X=[],this.Xa=this.Mb=0}function L(e,n,r,s){t(null!=r),t(null!=s);var i=r[0],a=s[0];return 0==i&&(i=(e*a+n/2)/n),0==a&&(a=(n*i+e/2)/e),0>=i||0>=a?0:(r[0]=i,s[0]=a,1)}function M(e,t){return e+(1<<t)-1>>>t}function F(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function B(t,n){e[n]=function(n,r,s,i,a,o,l){var c;for(c=0;c<a;++c){var d=e[t](o[l+c-1],s,i+c);o[l+c]=F(n[r+c],d)}}}function U(){this.ud=this.hd=this.jd=0}function z(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function q(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function H(e,t){return q(e+(e-t+.5>>1))}function V(e,t,n){return Math.abs(t-n)-Math.abs(e-n)}function W(e,t,n,r,s,i,a){for(r=i[a-1],n=0;n<s;++n)i[a+n]=r=F(e[t+n],r)}function G(e,t,n,r,s){var i;for(i=0;i<n;++i){var a=e[t+i],o=a>>8&255,l=16711935&(l=(l=16711935&a)+((o<<16)+o));r[s+i]=(4278255360&a)+l>>>0}}function Y(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function X(e,t,n,r,s,i){var a;for(a=0;a<r;++a){var o=t[n+a],l=o>>>8,c=o,d=255&(d=(d=o>>>16)+((e.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(e.hd<<24>>24)*(l<<24>>24)>>>5)+((e.ud<<24>>24)*(d<<24>>24)>>>5)),s[i+a]=(4278255360&o)+(d<<16)+c}}function Q(t,n,r,s,i){e[n]=function(e,t,n,r,a,o,l,c,d){for(r=l;r<c;++r)for(l=0;l<d;++l)a[o++]=i(n[s(e[t++])])},e[t]=function(t,n,a,o,l,c,d){var u=8>>t.b,h=t.Ea,m=t.K[0],f=t.w;if(8>u)for(t=(1<<t.b)-1,f=(1<<u)-1;n<a;++n){var p,g=0;for(p=0;p<h;++p)p&t||(g=s(o[l++])),c[d++]=i(m[g&f]),g>>=u}else e["VP8LMapColor"+r](o,l,m,f,c,d,n,a,h)}}function K(e,t,n,r,s){for(n=t+n;t<n;){var i=e[t++];r[s++]=i>>16&255,r[s++]=i>>8&255,r[s++]=255&i}}function Z(e,t,n,r,s){for(n=t+n;t<n;){var i=e[t++];r[s++]=i>>16&255,r[s++]=i>>8&255,r[s++]=255&i,r[s++]=i>>24&255}}function J(e,t,n,r,s){for(n=t+n;t<n;){var i=(a=e[t++])>>16&240|a>>12&15,a=240&a|a>>28&15;r[s++]=i,r[s++]=a}}function $(e,t,n,r,s){for(n=t+n;t<n;){var i=(a=e[t++])>>16&248|a>>13&7,a=a>>5&224|a>>3&31;r[s++]=i,r[s++]=a}}function ee(e,t,n,r,s){for(n=t+n;t<n;){var i=e[t++];r[s++]=255&i,r[s++]=i>>8&255,r[s++]=i>>16&255}}function te(e,t,n,s,i,a){if(0==a)for(n=t+n;t<n;)T(s,((a=e[t++])[0]>>24|a[1]>>8&65280|a[2]<<8&16711680|a[3]<<24)>>>0),i+=32;else r(s,i,e,t,n)}function ne(t,n){e[n][0]=e[t+"0"],e[n][1]=e[t+"1"],e[n][2]=e[t+"2"],e[n][3]=e[t+"3"],e[n][4]=e[t+"4"],e[n][5]=e[t+"5"],e[n][6]=e[t+"6"],e[n][7]=e[t+"7"],e[n][8]=e[t+"8"],e[n][9]=e[t+"9"],e[n][10]=e[t+"10"],e[n][11]=e[t+"11"],e[n][12]=e[t+"12"],e[n][13]=e[t+"13"],e[n][14]=e[t+"0"],e[n][15]=e[t+"0"]}function re(e){return e==qr||e==Hr||e==Vr||e==Wr}function se(){this.eb=[],this.size=this.A=this.fb=0}function ie(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ae(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new se,this.f.kb=new ie,this.sd=null}function oe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function le(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function de(e,t){var n=e.T,s=t.ba.f.RGBA,i=s.eb,a=s.fb+e.ka*s.A,o=gs[t.ba.S],l=e.y,c=e.O,d=e.f,u=e.N,h=e.ea,m=e.W,f=t.cc,p=t.dc,g=t.Mc,x=t.Nc,y=e.ka,b=e.ka+e.T,w=e.U,v=w+1>>1;for(0==y?o(l,c,null,null,d,u,h,m,d,u,h,m,i,a,null,null,w):(o(t.ec,t.fc,l,c,f,p,g,x,d,u,h,m,i,a-s.A,i,a,w),++n);y+2<b;y+=2)f=d,p=u,g=h,x=m,u+=e.Rc,m+=e.Rc,a+=2*s.A,o(l,(c+=2*e.fa)-e.fa,l,c,f,p,g,x,d,u,h,m,i,a-s.A,i,a,w);return c+=e.fa,e.j+b<e.o?(r(t.ec,t.fc,l,c,w),r(t.cc,t.dc,d,u,v),r(t.Mc,t.Nc,h,m,v),n--):1&b||o(l,c,null,null,d,u,h,m,d,u,h,m,i,a+s.A,null,null,w),n}function ue(e,n,r){var s=e.F,i=[e.J];if(null!=s){var a=e.U,o=n.ba.S,l=o==Br||o==Vr;n=n.ba.f.RGBA;var c=[0],d=e.ka;c[0]=e.T,e.Kb&&(0==d?--c[0]:(--d,i[0]-=e.width),e.j+e.ka+e.T==e.o&&(c[0]=e.o-e.j-d));var u=n.eb;d=n.fb+d*n.A,e=Ar(s,i[0],e.width,a,c,u,d+(l?0:3),n.A),t(r==c),e&&re(o)&&Nr(u,d,l,a,c,n.A)}return 0}function he(e){var t=e.ma,n=t.ba.S,r=11>n,s=n==Lr||n==Fr||n==Br||n==Ur||12==n||re(n);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!On(t.Oa,e,s?11:12))return 0;if(s&&re(n)&&yn(),e.da)alert("todo:use_scaling");else{if(r){if(t.Ib=ce,e.Kb){if(n=e.U+1>>1,t.memory=i(e.U+2*n),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+n,t.Ib=de,yn()}}else alert("todo:EmitYUV");s&&(t.Jb=ue,r&&gn())}if(r&&!js){for(e=0;256>e;++e)ks[e]=89858*(e-128)+_s>>As,Rs[e]=-22014*(e-128)+_s,Ps[e]=-45773*(e-128),Ds[e]=113618*(e-128)+_s>>As;for(e=Cs;e<Is;++e)t=76283*(e-16)+_s>>As,Os[e-Cs]=We(t,255),Ls[e-Cs]=We(t+8>>4,15);js=1}return 1}function me(e){var n=e.ma,r=e.U,s=e.T;return t(!(1&e.ka)),0>=r||0>=s?0:(r=n.Ib(e,n),null!=n.Jb&&n.Jb(e,n,r),n.Dc+=r,1)}function fe(e){e.ma.memory=null}function pe(e,t,n,r){return 47!=b(e,8)?0:(t[0]=b(e,14)+1,n[0]=b(e,14)+1,r[0]=b(e,1),0!=b(e,3)?0:!e.h)}function ge(e,t){if(4>e)return e+1;var n=e-2>>1;return(2+(1&e)<<n)+b(t,n)+1}function xe(e,t){return 120<t?t-120:1<=(n=((n=Zr[t-1])>>4)*e+(8-(15&n)))?n:1;var n}function ye(e,t,n){var r=N(n),s=e[t+=255&r].g-8;return 0<s&&(A(n,n.u+8),r=N(n),t+=e[t].value,t+=r&(1<<s)-1),A(n,n.u+e[t].g),e[t].value}function be(e,n,r){return r.g+=e.g,r.value+=e.value<<n>>>0,t(8>=r.g),e.g}function we(e,n,r){var s=e.xc;return t((n=0==s?0:e.vc[e.md*(r>>s)+(n>>s)])<e.Wb),e.Ya[n]}function ve(e,n,s,i){var a=e.ab,o=e.c*n,l=e.C;n=l+n;var c=s,d=i;for(i=e.Ta,s=e.Ua;0<a--;){var u=e.gc[a],h=l,m=n,f=c,p=d,g=(d=i,c=s,u.Ea);switch(t(h<m),t(m<=u.nc),u.hc){case 2:Gn(f,p,(m-h)*g,d,c);break;case 0:var x=h,y=m,b=d,w=c,v=(C=u).Ea;0==x&&(Vn(f,p,null,null,1,b,w),W(f,p+1,0,0,v-1,b,w+1),p+=v,w+=v,++x);for(var N=1<<C.b,S=N-1,A=M(v,C.b),_=C.K,C=C.w+(x>>C.b)*A;x<y;){var I=_,E=C,T=1;for(Wn(f,p,b,w-v,1,b,w);T<v;){var j=(T&~S)+N;j>v&&(j=v),(0,Zn[I[E++]>>8&15])(f,p+ +T,b,w+T-v,j-T,b,w+T),T=j}p+=v,w+=v,++x&S||(C+=A)}m!=u.nc&&r(d,c-g,d,c+(m-h-1)*g,g);break;case 1:for(g=f,y=p,v=(f=u.Ea)-(w=f&~(b=(p=1<<u.b)-1)),x=M(f,u.b),N=u.K,u=u.w+(h>>u.b)*x;h<m;){for(S=N,A=u,_=new U,C=y+w,I=y+f;y<C;)Y(S[A++],_),Jn(_,g,y,p,d,c),y+=p,c+=p;y<I&&(Y(S[A++],_),Jn(_,g,y,v,d,c),y+=v,c+=v),++h&b||(u+=x)}break;case 3:if(f==d&&p==c&&0<u.b){for(y=d,f=g=c+(m-h)*g-(w=(m-h)*M(u.Ea,u.b)),p=d,b=c,x=[],w=(v=w)-1;0<=w;--w)x[w]=p[b+w];for(w=v-1;0<=w;--w)y[f+w]=x[w];Yn(u,h,m,d,g,d,c)}else Yn(u,h,m,f,p,d,c)}c=i,d=s}d!=s&&r(i,s,c,d,o)}function Ne(e,n){var r=e.V,s=e.Ba+e.c*e.C,i=n-e.C;if(t(n<=e.l.o),t(16>=i),0<i){var a=e.l,o=e.Ta,l=e.Ua,c=a.width;if(ve(e,i,r,s),i=l=[l],t((r=e.C)<(s=n)),t(a.v<a.va),s>a.o&&(s=a.o),r<a.j){var d=a.j-r;r=a.j,i[0]+=d*c}if(r>=s?r=0:(i[0]+=4*a.v,a.ka=r-a.j,a.U=a.va-a.v,a.T=s-r,r=1),r){if(l=l[0],11>(r=e.ca).S){var u=r.f.RGBA,h=(s=r.S,i=a.U,a=a.T,d=u.eb,u.A),m=a;for(u=u.fb+e.Ma*u.A;0<m--;){var f=o,p=l,g=i,x=d,y=u;switch(s){case Or:$n(f,p,g,x,y);break;case Lr:er(f,p,g,x,y);break;case qr:er(f,p,g,x,y),Nr(x,y,0,g,1,0);break;case Mr:rr(f,p,g,x,y);break;case Fr:te(f,p,g,x,y,1);break;case Hr:te(f,p,g,x,y,1),Nr(x,y,0,g,1,0);break;case Br:te(f,p,g,x,y,0);break;case Vr:te(f,p,g,x,y,0),Nr(x,y,1,g,1,0);break;case Ur:tr(f,p,g,x,y);break;case Wr:tr(f,p,g,x,y),Sr(x,y,g,1,0);break;case zr:nr(f,p,g,x,y);break;default:t(0)}l+=c,u+=h}e.Ma+=a}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=r.height)}}e.C=n,t(e.C<=e.i)}function Se(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var n=e.Ya[t].G,r=e.Ya[t].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Ae(e,n,r,s,i,a){if(0!=e.Z){var o=e.qd,l=e.rd;for(t(null!=ps[e.Z]);n<r;++n)ps[e.Z](o,l,s,i,s,i,a),o=s,l=i,i+=a;e.qd=o,e.rd=l}}function _e(e,n){var r=e.l.ma,s=0==r.Z||1==r.Z?e.l.j:e.C;if(s=e.C<s?s:e.C,t(n<=e.l.o),n>s){var i=e.l.width,a=r.ca,o=r.tb+i*s,l=e.V,c=e.Ba+e.c*s,d=e.gc;t(1==e.ab),t(3==d[0].hc),Qn(d[0],s,n,l,c,a,o),Ae(r,s,n,a,o,i)}e.C=e.Ma=n}function Ce(e,n,r,s,i,a,o){var l=e.$/s,c=e.$%s,d=e.m,u=e.s,h=r+e.$,m=h;i=r+s*i;var f=r+s*a,p=280+u.ua,g=e.Pb?l:16777216,x=0<u.ua?u.Wa:null,y=u.wc,b=h<f?we(u,c,l):null;t(e.C<a),t(f<=i);var w=!1;e:for(;;){for(;w||h<f;){var v=0;if(l>=g){var C=h-r;t((g=e).Pb),g.wd=g.m,g.xd=C,0<g.s.ua&&R(g.s.Wa,g.s.vb),g=l+$r}if(c&y||(b=we(u,c,l)),t(null!=b),b.Qb&&(n[h]=b.qb,w=!0),!w)if(_(d),b.jc){v=d,C=n;var I=h,E=b.pd[N(v)&Fn-1];t(b.jc),256>E.g?(A(v,v.u+E.g),C[I]=E.value,v=0):(A(v,v.u+E.g-256),t(256<=E.value),v=E.value),0==v&&(w=!0)}else v=ye(b.G[0],b.H[0],d);if(d.h)break;if(w||256>v){if(!w)if(b.nd)n[h]=(b.qb|v<<8)>>>0;else{if(_(d),w=ye(b.G[1],b.H[1],d),_(d),C=ye(b.G[2],b.H[2],d),I=ye(b.G[3],b.H[3],d),d.h)break;n[h]=(I<<24|w<<16|v<<8|C)>>>0}if(w=!1,++h,++c>=s&&(c=0,++l,null!=o&&l<=a&&!(l%16)&&o(e,l),null!=x))for(;m<h;)v=n[m++],x.X[(506832829*v&4294967295)>>>x.Mb]=v}else if(280>v){if(v=ge(v-256,d),C=ye(b.G[4],b.H[4],d),_(d),C=xe(s,C=ge(C,d)),d.h)break;if(h-r<C||i-h<v)break e;for(I=0;I<v;++I)n[h+I]=n[h+I-C];for(h+=v,c+=v;c>=s;)c-=s,++l,null!=o&&l<=a&&!(l%16)&&o(e,l);if(t(h<=i),c&y&&(b=we(u,c,l)),null!=x)for(;m<h;)v=n[m++],x.X[(506832829*v&4294967295)>>>x.Mb]=v}else{if(!(v<p))break e;for(w=v-280,t(null!=x);m<h;)v=n[m++],x.X[(506832829*v&4294967295)>>>x.Mb]=v;v=h,t(!(w>>>(C=x).Xa)),n[v]=C.X[w],w=!0}w||t(d.h==S(d))}if(e.Pb&&d.h&&h<i)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&R(e.s.vb,e.s.Wa);else{if(d.h)break e;null!=o&&o(e,l>a?a:l),e.a=0,e.$=h-r}return 1}return e.a=3,0}function Ie(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var n=e.Wa;null!=n&&(n.X=null),e.vb=null,t(null!=e)}function Ee(){var t=new an;return null==t?null:(t.a=0,t.xb=fs,ne("Predictor","VP8LPredictors"),ne("Predictor","VP8LPredictors_C"),ne("PredictorAdd","VP8LPredictorsAdd"),ne("PredictorAdd","VP8LPredictorsAdd_C"),Gn=G,Jn=X,$n=K,er=Z,tr=J,nr=$,rr=ee,e.VP8LMapColor32b=Xn,e.VP8LMapColor8b=Kn,t)}function Te(e,n,r,o,l){var c=1,h=[e],f=[n],p=o.m,g=o.s,x=null,y=0;e:for(;;){if(r)for(;c&&b(p,1);){var w=h,v=f,S=o,C=1,I=S.m,E=S.gc[S.ab],T=b(I,2);if(S.Oc&1<<T)c=0;else{switch(S.Oc|=1<<T,E.hc=T,E.Ea=w[0],E.nc=v[0],E.K=[null],++S.ab,t(4>=S.ab),T){case 0:case 1:E.b=b(I,3)+2,C=Te(M(E.Ea,E.b),M(E.nc,E.b),0,S,E.K),E.K=E.K[0];break;case 3:var j,k=b(I,8)+1,D=16<k?0:4<k?1:2<k?2:3;if(w[0]=M(E.Ea,D),E.b=D,j=C=Te(k,1,0,S,E.K)){var R,O=k,L=E,B=1<<(8>>L.b),U=i(B);if(null==U)j=0;else{var z=L.K[0],q=L.w;for(U[0]=L.K[0][0],R=1;R<1*O;++R)U[R]=F(z[q+R],U[R-1]);for(;R<4*B;++R)U[R]=0;L.K[0]=null,L.K[0]=U,j=1}}C=j;break;case 2:break;default:t(0)}c=C}}if(h=h[0],f=f[0],c&&b(p,1)&&!(c=1<=(y=b(p,4))&&11>=y)){o.a=3;break e}var H;if(H=c)t:{var V,W,G,Y=o,X=h,Q=f,K=y,Z=r,J=Y.m,$=Y.s,ee=[null],te=1,ne=0,re=Jr[K];n:for(;;){if(Z&&b(J,1)){var se=b(J,3)+2,ie=M(X,se),ae=M(Q,se),oe=ie*ae;if(!Te(ie,ae,0,Y,ee))break n;for(ee=ee[0],$.xc=se,V=0;V<oe;++V){var le=ee[V]>>8&65535;ee[V]=le,le>=te&&(te=le+1)}}if(J.h)break n;for(W=0;5>W;++W){var ce=Xr[W];!W&&0<K&&(ce+=1<<K),ne<ce&&(ne=ce)}var de=a(te*re,u),ue=te,he=a(ue,m);if(null==he)var me=null;else t(65536>=ue),me=he;var fe=i(ne);if(null==me||null==fe||null==de){Y.a=1;break n}var pe=de;for(V=G=0;V<te;++V){var ge=me[V],xe=ge.G,ye=ge.H,we=0,ve=1,Ne=0;for(W=0;5>W;++W){ce=Xr[W],xe[W]=pe,ye[W]=G,!W&&0<K&&(ce+=1<<K);r:{var Se,Ae=ce,_e=Y,Ee=fe,je=pe,ke=G,De=0,Pe=_e.m,Re=b(Pe,1);if(s(Ee,0,0,Ae),Re){var Oe=b(Pe,1)+1,Le=b(Pe,1),Me=b(Pe,0==Le?1:8);Ee[Me]=1,2==Oe&&(Ee[Me=b(Pe,8)]=1);var Fe=1}else{var Be=i(19),Ue=b(Pe,4)+4;if(19<Ue){_e.a=3;var ze=0;break r}for(Se=0;Se<Ue;++Se)Be[Kr[Se]]=b(Pe,3);var qe=void 0,He=void 0,Ve=_e,We=Be,Ge=Ae,Ye=Ee,Xe=0,Qe=Ve.m,Ke=8,Ze=a(128,u);s:for(;d(Ze,0,7,We,19);){if(b(Qe,1)){var Je=2+2*b(Qe,3);if((qe=2+b(Qe,Je))>Ge)break s}else qe=Ge;for(He=0;He<Ge&&qe--;){_(Qe);var $e=Ze[0+(127&N(Qe))];A(Qe,Qe.u+$e.g);var et=$e.value;if(16>et)Ye[He++]=et,0!=et&&(Ke=et);else{var tt=16==et,nt=et-16,rt=Yr[nt],st=b(Qe,Gr[nt])+rt;if(He+st>Ge)break s;for(var it=tt?Ke:0;0<st--;)Ye[He++]=it}}Xe=1;break s}Xe||(Ve.a=3),Fe=Xe}(Fe=Fe&&!Pe.h)&&(De=d(je,ke,8,Ee,Ae)),Fe&&0!=De?ze=De:(_e.a=3,ze=0)}if(0==ze)break n;if(ve&&1==Qr[W]&&(ve=0==pe[G].g),we+=pe[G].g,G+=ze,3>=W){var at,ot=fe[0];for(at=1;at<ce;++at)fe[at]>ot&&(ot=fe[at]);Ne+=ot}}if(ge.nd=ve,ge.Qb=0,ve&&(ge.qb=(xe[3][ye[3]+0].value<<24|xe[1][ye[1]+0].value<<16|xe[2][ye[2]+0].value)>>>0,0==we&&256>xe[0][ye[0]+0].value&&(ge.Qb=1,ge.qb+=xe[0][ye[0]+0].value<<8)),ge.jc=!ge.Qb&&6>Ne,ge.jc){var lt,ct=ge;for(lt=0;lt<Fn;++lt){var dt=lt,ut=ct.pd[dt],ht=ct.G[0][ct.H[0]+dt];256<=ht.value?(ut.g=ht.g+256,ut.value=ht.value):(ut.g=0,ut.value=0,dt>>=be(ht,8,ut),dt>>=be(ct.G[1][ct.H[1]+dt],16,ut),dt>>=be(ct.G[2][ct.H[2]+dt],0,ut),be(ct.G[3][ct.H[3]+dt],24,ut))}}}$.vc=ee,$.Wb=te,$.Ya=me,$.yc=de,H=1;break t}H=0}if(!(c=H)){o.a=3;break e}if(0<y){if(g.ua=1<<y,!P(g.Wa,y)){o.a=1,c=0;break e}}else g.ua=0;var mt=o,ft=h,pt=f,gt=mt.s,xt=gt.xc;if(mt.c=ft,mt.i=pt,gt.md=M(ft,xt),gt.wc=0==xt?-1:(1<<xt)-1,r){o.xb=ms;break e}if(null==(x=i(h*f))){o.a=1,c=0;break e}c=(c=Ce(o,x,0,h,f,f,null))&&!p.h;break e}return c?(null!=l?l[0]=x:(t(null==x),t(r)),o.$=0,r||Ie(g)):Ie(g),c}function je(e,n){var r=e.c*e.i,s=r+n+16*n;return t(e.c<=n),e.V=i(s),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+r+n,1)}function ke(e,n){var r=e.C,s=n-r,i=e.V,a=e.Ba+e.c*r;for(t(n<=e.l.o);0<s;){var o=16<s?16:s,l=e.l.ma,c=e.l.width,d=c*o,u=l.ca,h=l.tb+c*r,m=e.Ta,f=e.Ua;ve(e,o,i,a),_r(m,f,u,h,d),Ae(l,r,r+o,u,h,c),s-=o,i+=o*e.c,r+=o}t(r==n),e.C=e.Ma=n}function De(){this.ub=this.yd=this.td=this.Rb=0}function Pe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Re(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Oe(){this.Yb=function(){var e=[];return function e(t,n,r){for(var s=r[n],i=0;i<s&&(t.push(r.length>n+1?[]:0),!(r.length<n+1));i++)e(t[i],n+1,r)}(e,0,[3,11]),e}()}function Le(){this.jb=i(3),this.Wc=o([4,8],Oe),this.Xc=o([4,17],Oe)}function Me(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function Fe(){this.ld=this.La=this.dd=this.tc=0}function Be(){this.Na=this.la=0}function Ue(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ze(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function qe(){this.uc=this.M=this.Nb=0,this.wa=Array(new Fe),this.Y=0,this.ya=Array(new ze),this.aa=0,this.l=new Ge}function He(){this.y=i(16),this.f=i(8),this.ea=i(8)}function Ve(){this.cb=this.a=0,this.sc="",this.m=new w,this.Od=new De,this.Kc=new Pe,this.ed=new Me,this.Qa=new Re,this.Ic=this.$c=this.Aa=0,this.D=new qe,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,w),this.ia=0,this.pb=a(4,Ue),this.Pa=new Le,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new He),this.Hd=0,this.rb=Array(new Be),this.sb=0,this.wa=Array(new Fe),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ze),this.L=this.aa=0,this.gd=o([4,2],Fe),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function We(e,t){return 0>e?0:e>t?t:e}function Ge(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ye(){var e=new Ve;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ns||(ns=Ze)),e}function Xe(e,t,n){return 0==e.a&&(e.a=t,e.sc=n,e.cb=0),0}function Qe(e,t,n){return 3<=n&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Ke(e,n){if(null==e)return 0;if(e.a=0,e.sc="OK",null==n)return Xe(e,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,i=n.w,a=n.ha;if(4>a)return Xe(e,7,"Truncated header.");var o=r[i+0]|r[i+1]<<8|r[i+2]<<16,l=e.Od;if(l.Rb=!(1&o),l.td=o>>1&7,l.yd=o>>4&1,l.ub=o>>5,3<l.td)return Xe(e,3,"Incorrect keyframe parameters.");if(!l.yd)return Xe(e,4,"Frame not displayable.");i+=3,a-=3;var c=e.Kc;if(l.Rb){if(7>a)return Xe(e,7,"cannot parse picture header");if(!Qe(r,i,a))return Xe(e,3,"Bad code word");c.c=16383&(r[i+4]<<8|r[i+3]),c.Td=r[i+4]>>6,c.i=16383&(r[i+6]<<8|r[i+5]),c.Ud=r[i+6]>>6,i+=7,a-=7,e.za=c.c+15>>4,e.Ub=c.i+15>>4,n.width=c.c,n.height=c.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,s((o=e.Pa).jb,0,255,o.jb.length),t(null!=(o=e.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,s(o.Zb,0,0,o.Zb.length),s(o.Lb,0,0,o.Lb)}if(l.ub>a)return Xe(e,7,"bad partition length");f(o=e.m,r,i,l.ub),i+=l.ub,a-=l.ub,l.Rb&&(c.Ld=I(o),c.Kd=I(o)),c=e.Qa;var d,u=e.Pa;if(t(null!=o),t(null!=c),c.Cb=I(o),c.Cb){if(c.Bb=I(o),I(o)){for(c.Fb=I(o),d=0;4>d;++d)c.Zb[d]=I(o)?g(o,7):0;for(d=0;4>d;++d)c.Lb[d]=I(o)?g(o,6):0}if(c.Bb)for(d=0;3>d;++d)u.jb[d]=I(o)?p(o,8):255}else c.Bb=0;if(o.Ka)return Xe(e,3,"cannot parse segment header");if((c=e.ed).zd=I(o),c.Tb=p(o,6),c.wb=p(o,3),c.Pc=I(o),c.Pc&&I(o)){for(u=0;4>u;++u)I(o)&&(c.vd[u]=g(o,6));for(u=0;4>u;++u)I(o)&&(c.od[u]=g(o,6))}if(e.L=0==c.Tb?0:c.zd?1:2,o.Ka)return Xe(e,3,"cannot parse filter header");var h=a;if(a=d=i,i=d+h,c=h,e.Xb=(1<<p(e.m,2))-1,h<3*(u=e.Xb))r=7;else{for(d+=3*u,c-=3*u,h=0;h<u;++h){var m=r[a+0]|r[a+1]<<8|r[a+2]<<16;m>c&&(m=c),f(e.Jc[+h],r,d,m),d+=m,c-=m,a+=3}f(e.Jc[+u],r,d,c),r=d<i?0:5}if(0!=r)return Xe(e,r,"cannot parse partitions");for(r=p(d=e.m,7),a=I(d)?g(d,4):0,i=I(d)?g(d,4):0,c=I(d)?g(d,4):0,u=I(d)?g(d,4):0,d=I(d)?g(d,4):0,h=e.Qa,m=0;4>m;++m){if(h.Cb){var x=h.Zb[m];h.Fb||(x+=r)}else{if(0<m){e.pb[m]=e.pb[0];continue}x=r}var y=e.pb[m];y.Sc[0]=es[We(x+a,127)],y.Sc[1]=ts[We(x+0,127)],y.Eb[0]=2*es[We(x+i,127)],y.Eb[1]=101581*ts[We(x+c,127)]>>16,8>y.Eb[1]&&(y.Eb[1]=8),y.Qc[0]=es[We(x+u,117)],y.Qc[1]=ts[We(x+d,127)],y.lc=x+d}if(!l.Rb)return Xe(e,4,"Not a key frame.");for(I(o),l=e.Pa,r=0;4>r;++r){for(a=0;8>a;++a)for(i=0;3>i;++i)for(c=0;11>c;++c)u=E(o,ls[r][a][i][c])?p(o,8):as[r][a][i][c],l.Wc[r][a].Yb[i][c]=u;for(a=0;17>a;++a)l.Xc[r][a]=l.Wc[r][cs[a]]}return e.kc=I(o),e.kc&&(e.Bd=p(o,8)),e.cb=1}function Ze(e,t,n,r,s,i,a){var o=t[s].Yb[n];for(n=0;16>s;++s){if(!E(e,o[n+0]))return s;for(;!E(e,o[n+1]);)if(o=t[++s].Yb[0],n=0,16==s)return 16;var l=t[s+1].Yb;if(E(e,o[n+2])){var c=e,d=0;if(E(c,(h=o)[(u=n)+3]))if(E(c,h[u+6])){for(o=0,u=2*(d=E(c,h[u+8]))+(h=E(c,h[u+9+d])),d=0,h=rs[u];h[o];++o)d+=d+E(c,h[o]);d+=3+(8<<u)}else E(c,h[u+7])?(d=7+2*E(c,165),d+=E(c,145)):d=5+E(c,159);else d=E(c,h[u+4])?3+E(c,h[u+5]):2;o=l[2]}else d=1,o=l[1];l=a+ss[s],0>(c=e).b&&C(c);var u,h=c.b,m=(u=c.Ca>>1)-(c.I>>h)>>31;--c.b,c.Ca+=m,c.Ca|=1,c.I-=(u+1&m)<<h,i[l]=((d^m)-m)*r[(0<s)+0]}return 16}function Je(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,s(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,t,n,r,s){s=e[t+n+32*r]+(s>>3),e[t+n+32*r]=-256&s?0>s?0:255:s}function et(e,t,n,r,s,i){$e(e,t,0,n,r+s),$e(e,t,1,n,r+i),$e(e,t,2,n,r-i),$e(e,t,3,n,r-s)}function tt(e){return(20091*e>>16)+e}function nt(e,t,n,r){var s,a=0,o=i(16);for(s=0;4>s;++s){var l=e[t+0]+e[t+8],c=e[t+0]-e[t+8],d=(35468*e[t+4]>>16)-tt(e[t+12]),u=tt(e[t+4])+(35468*e[t+12]>>16);o[a+0]=l+u,o[a+1]=c+d,o[a+2]=c-d,o[a+3]=l-u,a+=4,t++}for(s=a=0;4>s;++s)l=(e=o[a+0]+4)+o[a+8],c=e-o[a+8],d=(35468*o[a+4]>>16)-tt(o[a+12]),$e(n,r,0,0,l+(u=tt(o[a+4])+(35468*o[a+12]>>16))),$e(n,r,1,0,c+d),$e(n,r,2,0,c-d),$e(n,r,3,0,l-u),a++,r+=32}function rt(e,t,n,r){var s=e[t+0]+4,i=35468*e[t+4]>>16,a=tt(e[t+4]),o=35468*e[t+1]>>16;et(n,r,0,s+a,e=tt(e[t+1]),o),et(n,r,1,s+i,e,o),et(n,r,2,s-i,e,o),et(n,r,3,s-a,e,o)}function st(e,t,n,r,s){nt(e,t,n,r),s&&nt(e,t+16,n,r+4)}function it(e,t,n,r){ir(e,t+0,n,r,1),ir(e,t+32,n,r+128,1)}function at(e,t,n,r){var s;for(e=e[t+0]+4,s=0;4>s;++s)for(t=0;4>t;++t)$e(n,r,t,s,e)}function ot(e,t,n,r){e[t+0]&&lr(e,t+0,n,r),e[t+16]&&lr(e,t+16,n,r+4),e[t+32]&&lr(e,t+32,n,r+128),e[t+48]&&lr(e,t+48,n,r+128+4)}function lt(e,t,n,r){var s,a=i(16);for(s=0;4>s;++s){var o=e[t+0+s]+e[t+12+s],l=e[t+4+s]+e[t+8+s],c=e[t+4+s]-e[t+8+s],d=e[t+0+s]-e[t+12+s];a[0+s]=o+l,a[8+s]=o-l,a[4+s]=d+c,a[12+s]=d-c}for(s=0;4>s;++s)o=(e=a[0+4*s]+3)+a[3+4*s],l=a[1+4*s]+a[2+4*s],c=a[1+4*s]-a[2+4*s],d=e-a[3+4*s],n[r+0]=o+l>>3,n[r+16]=d+c>>3,n[r+32]=o-l>>3,n[r+48]=d-c>>3,r+=64}function ct(e,t,n){var r,s=t-32,i=Pr,a=255-e[s-1];for(r=0;r<n;++r){var o,l=i,c=a+e[t-1];for(o=0;o<n;++o)e[t+o]=l[c+e[s+o]];t+=32}}function dt(e,t){ct(e,t,4)}function ut(e,t){ct(e,t,8)}function ht(e,t){ct(e,t,16)}function mt(e,t){var n;for(n=0;16>n;++n)r(e,t+32*n,e,t-32,16)}function ft(e,t){var n;for(n=16;0<n;--n)s(e,t,e[t-1],16),t+=32}function pt(e,t,n){var r;for(r=0;16>r;++r)s(t,n+32*r,e,16)}function gt(e,t){var n,r=16;for(n=0;16>n;++n)r+=e[t-1+32*n]+e[t+n-32];pt(r>>5,e,t)}function xt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t-1+32*n];pt(r>>4,e,t)}function yt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t+n-32];pt(r>>4,e,t)}function bt(e,t){pt(128,e,t)}function wt(e,t,n){return e+2*t+n+2>>2}function vt(e,t){var n,s=t-32;for(s=new Uint8Array([wt(e[s-1],e[s+0],e[s+1]),wt(e[s+0],e[s+1],e[s+2]),wt(e[s+1],e[s+2],e[s+3]),wt(e[s+2],e[s+3],e[s+4])]),n=0;4>n;++n)r(e,t+32*n,s,0,s.length)}function Nt(e,t){var n=e[t-1],r=e[t-1+32],s=e[t-1+64],i=e[t-1+96];T(e,t+0,16843009*wt(e[t-1-32],n,r)),T(e,t+32,16843009*wt(n,r,s)),T(e,t+64,16843009*wt(r,s,i)),T(e,t+96,16843009*wt(s,i,i))}function St(e,t){var n,r=4;for(n=0;4>n;++n)r+=e[t+n-32]+e[t-1+32*n];for(r>>=3,n=0;4>n;++n)s(e,t+32*n,r,4)}function At(e,t){var n=e[t-1+0],r=e[t-1+32],s=e[t-1+64],i=e[t-1-32],a=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+96]=wt(r,s,e[t-1+96]),e[t+1+96]=e[t+0+64]=wt(n,r,s),e[t+2+96]=e[t+1+64]=e[t+0+32]=wt(i,n,r),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=wt(a,i,n),e[t+3+64]=e[t+2+32]=e[t+1+0]=wt(o,a,i),e[t+3+32]=e[t+2+0]=wt(l,o,a),e[t+3+0]=wt(c,l,o)}function _t(e,t){var n=e[t+1-32],r=e[t+2-32],s=e[t+3-32],i=e[t+4-32],a=e[t+5-32],o=e[t+6-32],l=e[t+7-32];e[t+0+0]=wt(e[t+0-32],n,r),e[t+1+0]=e[t+0+32]=wt(n,r,s),e[t+2+0]=e[t+1+32]=e[t+0+64]=wt(r,s,i),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=wt(s,i,a),e[t+3+32]=e[t+2+64]=e[t+1+96]=wt(i,a,o),e[t+3+64]=e[t+2+96]=wt(a,o,l),e[t+3+96]=wt(o,l,l)}function Ct(e,t){var n=e[t-1+0],r=e[t-1+32],s=e[t-1+64],i=e[t-1-32],a=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+0]=e[t+1+64]=i+a+1>>1,e[t+1+0]=e[t+2+64]=a+o+1>>1,e[t+2+0]=e[t+3+64]=o+l+1>>1,e[t+3+0]=l+c+1>>1,e[t+0+96]=wt(s,r,n),e[t+0+64]=wt(r,n,i),e[t+0+32]=e[t+1+96]=wt(n,i,a),e[t+1+32]=e[t+2+96]=wt(i,a,o),e[t+2+32]=e[t+3+96]=wt(a,o,l),e[t+3+32]=wt(o,l,c)}function It(e,t){var n=e[t+0-32],r=e[t+1-32],s=e[t+2-32],i=e[t+3-32],a=e[t+4-32],o=e[t+5-32],l=e[t+6-32],c=e[t+7-32];e[t+0+0]=n+r+1>>1,e[t+1+0]=e[t+0+64]=r+s+1>>1,e[t+2+0]=e[t+1+64]=s+i+1>>1,e[t+3+0]=e[t+2+64]=i+a+1>>1,e[t+0+32]=wt(n,r,s),e[t+1+32]=e[t+0+96]=wt(r,s,i),e[t+2+32]=e[t+1+96]=wt(s,i,a),e[t+3+32]=e[t+2+96]=wt(i,a,o),e[t+3+64]=wt(a,o,l),e[t+3+96]=wt(o,l,c)}function Et(e,t){var n=e[t-1+0],r=e[t-1+32],s=e[t-1+64],i=e[t-1+96];e[t+0+0]=n+r+1>>1,e[t+2+0]=e[t+0+32]=r+s+1>>1,e[t+2+32]=e[t+0+64]=s+i+1>>1,e[t+1+0]=wt(n,r,s),e[t+3+0]=e[t+1+32]=wt(r,s,i),e[t+3+32]=e[t+1+64]=wt(s,i,i),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=i}function Tt(e,t){var n=e[t-1+0],r=e[t-1+32],s=e[t-1+64],i=e[t-1+96],a=e[t-1-32],o=e[t+0-32],l=e[t+1-32],c=e[t+2-32];e[t+0+0]=e[t+2+32]=n+a+1>>1,e[t+0+32]=e[t+2+64]=r+n+1>>1,e[t+0+64]=e[t+2+96]=s+r+1>>1,e[t+0+96]=i+s+1>>1,e[t+3+0]=wt(o,l,c),e[t+2+0]=wt(a,o,l),e[t+1+0]=e[t+3+32]=wt(n,a,o),e[t+1+32]=e[t+3+64]=wt(r,n,a),e[t+1+64]=e[t+3+96]=wt(s,r,n),e[t+1+96]=wt(i,s,r)}function jt(e,t){var n;for(n=0;8>n;++n)r(e,t+32*n,e,t-32,8)}function kt(e,t){var n;for(n=0;8>n;++n)s(e,t,e[t-1],8),t+=32}function Dt(e,t,n){var r;for(r=0;8>r;++r)s(t,n+32*r,e,8)}function Pt(e,t){var n,r=8;for(n=0;8>n;++n)r+=e[t+n-32]+e[t-1+32*n];Dt(r>>4,e,t)}function Rt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t+n-32];Dt(r>>3,e,t)}function Ot(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t-1+32*n];Dt(r>>3,e,t)}function Lt(e,t){Dt(128,e,t)}function Mt(e,t,n){var r=e[t-n],s=e[t+0],i=3*(s-r)+kr[1020+e[t-2*n]-e[t+n]],a=Dr[112+(i+4>>3)];e[t-n]=Pr[255+r+Dr[112+(i+3>>3)]],e[t+0]=Pr[255+s-a]}function Ft(e,t,n,r){var s=e[t+0],i=e[t+n];return Rr[255+e[t-2*n]-e[t-n]]>r||Rr[255+i-s]>r}function Bt(e,t,n,r){return 4*Rr[255+e[t-n]-e[t+0]]+Rr[255+e[t-2*n]-e[t+n]]<=r}function Ut(e,t,n,r,s){var i=e[t-3*n],a=e[t-2*n],o=e[t-n],l=e[t+0],c=e[t+n],d=e[t+2*n],u=e[t+3*n];return 4*Rr[255+o-l]+Rr[255+a-c]>r?0:Rr[255+e[t-4*n]-i]<=s&&Rr[255+i-a]<=s&&Rr[255+a-o]<=s&&Rr[255+u-d]<=s&&Rr[255+d-c]<=s&&Rr[255+c-l]<=s}function zt(e,t,n,r){var s=2*r+1;for(r=0;16>r;++r)Bt(e,t+r,n,s)&&Mt(e,t+r,n)}function qt(e,t,n,r){var s=2*r+1;for(r=0;16>r;++r)Bt(e,t+r*n,1,s)&&Mt(e,t+r*n,1)}function Ht(e,t,n,r){var s;for(s=3;0<s;--s)zt(e,t+=4*n,n,r)}function Vt(e,t,n,r){var s;for(s=3;0<s;--s)qt(e,t+=4,n,r)}function Wt(e,t,n,r,s,i,a,o){for(i=2*i+1;0<s--;){if(Ut(e,t,n,i,a))if(Ft(e,t,n,o))Mt(e,t,n);else{var l=e,c=t,d=n,u=l[c-2*d],h=l[c-d],m=l[c+0],f=l[c+d],p=l[c+2*d],g=27*(y=kr[1020+3*(m-h)+kr[1020+u-f]])+63>>7,x=18*y+63>>7,y=9*y+63>>7;l[c-3*d]=Pr[255+l[c-3*d]+y],l[c-2*d]=Pr[255+u+x],l[c-d]=Pr[255+h+g],l[c+0]=Pr[255+m-g],l[c+d]=Pr[255+f-x],l[c+2*d]=Pr[255+p-y]}t+=r}}function Gt(e,t,n,r,s,i,a,o){for(i=2*i+1;0<s--;){if(Ut(e,t,n,i,a))if(Ft(e,t,n,o))Mt(e,t,n);else{var l=e,c=t,d=n,u=l[c-d],h=l[c+0],m=l[c+d],f=Dr[112+(4+(p=3*(h-u))>>3)],p=Dr[112+(p+3>>3)],g=f+1>>1;l[c-2*d]=Pr[255+l[c-2*d]+g],l[c-d]=Pr[255+u+p],l[c+0]=Pr[255+h-f],l[c+d]=Pr[255+m-g]}t+=r}}function Yt(e,t,n,r,s,i){Wt(e,t,n,1,16,r,s,i)}function Xt(e,t,n,r,s,i){Wt(e,t,1,n,16,r,s,i)}function Qt(e,t,n,r,s,i){var a;for(a=3;0<a;--a)Gt(e,t+=4*n,n,1,16,r,s,i)}function Kt(e,t,n,r,s,i){var a;for(a=3;0<a;--a)Gt(e,t+=4,1,n,16,r,s,i)}function Zt(e,t,n,r,s,i,a,o){Wt(e,t,s,1,8,i,a,o),Wt(n,r,s,1,8,i,a,o)}function Jt(e,t,n,r,s,i,a,o){Wt(e,t,1,s,8,i,a,o),Wt(n,r,1,s,8,i,a,o)}function $t(e,t,n,r,s,i,a,o){Gt(e,t+4*s,s,1,8,i,a,o),Gt(n,r+4*s,s,1,8,i,a,o)}function en(e,t,n,r,s,i,a,o){Gt(e,t+4,1,s,8,i,a,o),Gt(n,r+4,1,s,8,i,a,o)}function tn(){this.ba=new ae,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new le,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function rn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function sn(){this.ua=0,this.Wa=new O,this.vb=new O,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new m,this.yc=new u}function an(){this.xb=this.a=0,this.l=new Ge,this.ca=new ae,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new v,this.Pb=0,this.wd=new v,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new sn,this.ab=0,this.gc=a(4,rn),this.Oc=0}function on(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ge,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(e,t,n,r,s,i,a){for(e=null==e?0:e[t+0],t=0;t<a;++t)s[i+t]=e+n[r+t]&255,e=s[i+t]}function cn(e,t,n,r,s,i,a){var o;if(null==e)ln(null,null,n,r,s,i,a);else for(o=0;o<a;++o)s[i+o]=e[t+o]+n[r+o]&255}function dn(e,t,n,r,s,i,a){if(null==e)ln(null,null,n,r,s,i,a);else{var o,l=e[t+0],c=l,d=l;for(o=0;o<a;++o)c=d+(l=e[t+o])-c,d=n[r+o]+(-256&c?0>c?0:255:c)&255,c=l,s[i+o]=d}}function un(e,n,s,a){var o=n.width,l=n.o;if(t(null!=e&&null!=n),0>s||0>=a||s+a>l)return null;if(!e.Cc){if(null==e.ga){var c;if(e.ga=new on,(c=null==e.ga)||(c=n.width*n.o,t(0==e.Gb.length),e.Gb=i(c),e.Uc=0,null==e.Gb?c=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,c=1),c=!c),!c){c=e.ga;var d=e.Fa,u=e.P,h=e.qc,m=e.mb,f=e.nb,p=u+1,g=h-1,y=c.l;if(t(null!=d&&null!=m&&null!=n),ps[0]=null,ps[1]=ln,ps[2]=cn,ps[3]=dn,c.ca=m,c.tb=f,c.c=n.width,c.i=n.height,t(0<c.c&&0<c.i),1>=h)n=0;else if(c.$a=3&d[u+0],c.Z=d[u+0]>>2&3,c.Lc=d[u+0]>>4&3,u=d[u+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||u)n=0;else if(y.put=me,y.ac=he,y.bc=fe,y.ma=c,y.width=n.width,y.height=n.height,y.Da=n.Da,y.v=n.v,y.va=n.va,y.j=n.j,y.o=n.o,c.$a)e:{t(1==c.$a),n=Ee();t:for(;;){if(null==n){n=0;break e}if(t(null!=c),c.mc=n,n.c=c.c,n.i=c.i,n.l=c.l,n.l.ma=c,n.l.width=c.c,n.l.height=c.i,n.a=0,x(n.m,d,p,g),!Te(c.c,c.i,1,n,null))break t;if(1==n.ab&&3==n.gc[0].hc&&Se(n.s)?(c.ic=1,d=n.c*n.i,n.Ta=null,n.Ua=0,n.V=i(d),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(c.ic=0,n=je(n,c.c)),!n)break t;n=1;break e}c.mc=null,n=0}else n=g>=c.c*c.i;c=!n}if(c)return null;1!=e.ga.Lc?e.Ga=0:a=l-s}t(null!=e.ga),t(s+a<=l);e:{if(n=(d=e.ga).c,l=d.l.o,0==d.$a){if(p=e.rc,g=e.Vc,y=e.Fa,u=e.P+1+s*n,h=e.mb,m=e.nb+s*n,t(u<=e.P+e.qc),0!=d.Z)for(t(null!=ps[d.Z]),c=0;c<a;++c)ps[d.Z](p,g,y,u,h,m,n),p=h,g=m,m+=n,u+=n;else for(c=0;c<a;++c)r(h,m,y,u,n),p=h,g=m,m+=n,u+=n;e.rc=p,e.Vc=g}else{if(t(null!=d.mc),n=s+a,t(null!=(c=d.mc)),t(n<=c.i),c.C>=n)n=1;else if(d.ic||gn(),d.ic){d=c.V,p=c.Ba,g=c.c;var b=c.i,w=(y=1,u=c.$/g,h=c.$%g,m=c.m,f=c.s,c.$),v=g*b,N=g*n,A=f.wc,C=w<N?we(f,h,u):null;t(w<=v),t(n<=b),t(Se(f));t:for(;;){for(;!m.h&&w<N;){if(h&A||(C=we(f,h,u)),t(null!=C),_(m),256>(b=ye(C.G[0],C.H[0],m)))d[p+w]=b,++w,++h>=g&&(h=0,++u<=n&&!(u%16)&&_e(c,u));else{if(!(280>b)){y=0;break t}b=ge(b-256,m);var I,E=ye(C.G[4],C.H[4],m);if(_(m),!(w>=(E=xe(g,E=ge(E,m)))&&v-w>=b)){y=0;break t}for(I=0;I<b;++I)d[p+w+I]=d[p+w+I-E];for(w+=b,h+=b;h>=g;)h-=g,++u<=n&&!(u%16)&&_e(c,u);w<N&&h&A&&(C=we(f,h,u))}t(m.h==S(m))}_e(c,u>n?n:u);break t}!y||m.h&&w<v?(y=0,c.a=m.h?5:3):c.$=w,n=y}else n=Ce(c,c.V,c.Ba,c.c,c.i,n,ke);if(!n){a=0;break e}}s+a>=l&&(e.Cc=1),a=1}if(!a)return null;if(e.Cc&&(null!=(a=e.ga)&&(a.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+s*o}function hn(e,t,n,r,s,i){for(;0<s--;){var a,o=e,l=t+(n?1:0),c=e,d=t+(n?0:3);for(a=0;a<r;++a){var u=c[d+4*a];255!=u&&(u*=32897,o[l+4*a+0]=o[l+4*a+0]*u>>23,o[l+4*a+1]=o[l+4*a+1]*u>>23,o[l+4*a+2]=o[l+4*a+2]*u>>23)}t+=i}}function mn(e,t,n,r,s){for(;0<r--;){var i;for(i=0;i<n;++i){var a=e[t+2*i+0],o=15&(c=e[t+2*i+1]),l=4369*o,c=(240&c|c>>4)*l>>16;e[t+2*i+0]=(240&a|a>>4)*l>>16&240|(15&a|a<<4)*l>>16>>4&15,e[t+2*i+1]=240&c|o}t+=s}}function fn(e,t,n,r,s,i,a,o){var l,c,d=255;for(c=0;c<s;++c){for(l=0;l<r;++l){var u=e[t+l];i[a+4*l]=u,d&=u}t+=n,a+=o}return 255!=d}function pn(e,t,n,r,s){var i;for(i=0;i<s;++i)n[r+i]=e[t+i]>>8}function gn(){Nr=hn,Sr=mn,Ar=fn,_r=pn}function xn(n,r,s){e[n]=function(e,n,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b){var w,v=b-1>>1,N=o[l+0]|c[d+0]<<16,S=u[h+0]|m[f+0]<<16;t(null!=e);var A=3*N+S+131074>>2;for(r(e[n+0],255&A,A>>16,p,g),null!=i&&(A=3*S+N+131074>>2,r(i[a+0],255&A,A>>16,x,y)),w=1;w<=v;++w){var _=o[l+w]|c[d+w]<<16,C=u[h+w]|m[f+w]<<16,I=N+_+S+C+524296,E=I+2*(_+S)>>3;A=E+N>>1,N=(I=I+2*(N+C)>>3)+_>>1,r(e[n+2*w-1],255&A,A>>16,p,g+(2*w-1)*s),r(e[n+2*w-0],255&N,N>>16,p,g+(2*w-0)*s),null!=i&&(A=I+S>>1,N=E+C>>1,r(i[a+2*w-1],255&A,A>>16,x,y+(2*w-1)*s),r(i[a+2*w+0],255&N,N>>16,x,y+(2*w+0)*s)),N=_,S=C}1&b||(A=3*N+S+131074>>2,r(e[n+b-1],255&A,A>>16,p,g+(b-1)*s),null!=i&&(A=3*S+N+131074>>2,r(i[a+b-1],255&A,A>>16,x,y+(b-1)*s)))}}function yn(){gs[Or]=xs,gs[Lr]=bs,gs[Mr]=ys,gs[Fr]=ws,gs[Br]=vs,gs[Ur]=Ns,gs[zr]=Ss,gs[qr]=bs,gs[Hr]=ws,gs[Vr]=vs,gs[Wr]=Ns}function bn(e){return e&~Ts?0>e?0:255:e>>Es}function wn(e,t){return bn((19077*e>>8)+(26149*t>>8)-14234)}function vn(e,t,n){return bn((19077*e>>8)-(6419*t>>8)-(13320*n>>8)+8708)}function Nn(e,t){return bn((19077*e>>8)+(33050*t>>8)-17685)}function Sn(e,t,n,r,s){r[s+0]=wn(e,n),r[s+1]=vn(e,t,n),r[s+2]=Nn(e,t)}function An(e,t,n,r,s){r[s+0]=Nn(e,t),r[s+1]=vn(e,t,n),r[s+2]=wn(e,n)}function _n(e,t,n,r,s){var i=vn(e,t,n);t=i<<3&224|Nn(e,t)>>3,r[s+0]=248&wn(e,n)|i>>5,r[s+1]=t}function Cn(e,t,n,r,s){var i=240&Nn(e,t)|15;r[s+0]=240&wn(e,n)|vn(e,t,n)>>4,r[s+1]=i}function In(e,t,n,r,s){r[s+0]=255,Sn(e,t,n,r,s+1)}function En(e,t,n,r,s){An(e,t,n,r,s),r[s+3]=255}function Tn(e,t,n,r,s){Sn(e,t,n,r,s),r[s+3]=255}function We(e,t){return 0>e?0:e>t?t:e}function jn(t,n,r){e[t]=function(e,t,s,i,a,o,l,c,d){for(var u=c+(-2&d)*r;c!=u;)n(e[t+0],s[i+0],a[o+0],l,c),n(e[t+1],s[i+0],a[o+0],l,c+r),t+=2,++i,++o,c+=2*r;1&d&&n(e[t+0],s[i+0],a[o+0],l,c)}}function kn(e,t,n){return 0==n?0==e?0==t?6:5:0==t?4:0:n}function Dn(e,t,n,r,s){switch(e>>>30){case 3:ir(t,n,r,s,0);break;case 2:ar(t,n,r,s);break;case 1:lr(t,n,r,s)}}function Pn(e,t){var n,i,a=t.M,o=t.Nb,l=e.oc,c=e.pc+40,d=e.oc,u=e.pc+584,h=e.oc,m=e.pc+600;for(n=0;16>n;++n)l[c+32*n-1]=129;for(n=0;8>n;++n)d[u+32*n-1]=129,h[m+32*n-1]=129;for(0<a?l[c-1-32]=d[u-1-32]=h[m-1-32]=129:(s(l,c-32-1,127,21),s(d,u-32-1,127,9),s(h,m-32-1,127,9)),i=0;i<e.za;++i){var f=t.ya[t.aa+i];if(0<i){for(n=-1;16>n;++n)r(l,c+32*n-4,l,c+32*n+12,4);for(n=-1;8>n;++n)r(d,u+32*n-4,d,u+32*n+4,4),r(h,m+32*n-4,h,m+32*n+4,4)}var p=e.Gd,g=e.Hd+i,x=f.ad,y=f.Hc;if(0<a&&(r(l,c-32,p[g].y,0,16),r(d,u-32,p[g].f,0,8),r(h,m-32,p[g].ea,0,8)),f.Za){var b=l,w=c-32+16;for(0<a&&(i>=e.za-1?s(b,w,p[g].y[15],4):r(b,w,p[g+1].y,0,4)),n=0;4>n;n++)b[w+128+n]=b[w+256+n]=b[w+384+n]=b[w+0+n];for(n=0;16>n;++n,y<<=2)b=l,w=c+Ms[n],us[f.Ob[n]](b,w),Dn(y,x,16*+n,b,w)}else if(b=kn(i,a,f.Ob[0]),ds[b](l,c),0!=y)for(n=0;16>n;++n,y<<=2)Dn(y,x,16*+n,l,c+Ms[n]);for(n=f.Gc,b=kn(i,a,f.Dd),hs[b](d,u),hs[b](h,m),y=x,b=d,w=u,255&(f=0|n)&&(170&f?or(y,256,b,w):cr(y,256,b,w)),f=h,y=m,255&(n>>=8)&&(170&n?or(x,320,f,y):cr(x,320,f,y)),a<e.Ub-1&&(r(p[g].y,0,l,c+480,16),r(p[g].f,0,d,u+224,8),r(p[g].ea,0,h,m+224,8)),n=8*o*e.B,p=e.sa,g=e.ta+16*i+16*o*e.R,x=e.qa,f=e.ra+8*i+n,y=e.Ha,b=e.Ia+8*i+n,n=0;16>n;++n)r(p,g+n*e.R,l,c+32*n,16);for(n=0;8>n;++n)r(x,f+n*e.B,d,u+32*n,8),r(y,b+n*e.B,h,m+32*n,8)}}function Rn(e,r,s,i,a,o,l,c,d){var u=[0],h=[0],m=0,f=null!=d?d.kd:0,p=null!=d?d:new nn;if(null==e||12>s)return 7;p.data=e,p.w=r,p.ha=s,r=[r],s=[s],p.gb=[p.gb];e:{var g=r,y=s,b=p.gb;if(t(null!=e),t(null!=y),t(null!=b),b[0]=0,12<=y[0]&&!n(e,g[0],"RIFF")){if(n(e,g[0]+8,"WEBP")){b=3;break e}var w=D(e,g[0]+4);if(12>w||4294967286<w){b=3;break e}if(f&&w>y[0]-8){b=7;break e}b[0]=w,g[0]+=12,y[0]-=12}b=0}if(0!=b)return b;for(w=0<p.gb[0],s=s[0];;){e:{var N=e;y=r,b=s;var S=u,A=h,_=g=[0];if((E=m=[m])[0]=0,8>b[0])b=7;else{if(!n(N,y[0],"VP8X")){if(10!=D(N,y[0]+4)){b=3;break e}if(18>b[0]){b=7;break e}var C=D(N,y[0]+8),I=1+k(N,y[0]+12);if(2147483648<=I*(N=1+k(N,y[0]+15))){b=3;break e}null!=_&&(_[0]=C),null!=S&&(S[0]=I),null!=A&&(A[0]=N),y[0]+=18,b[0]-=18,E[0]=1}b=0}}if(m=m[0],g=g[0],0!=b)return b;if(y=!!(2&g),!w&&m)return 3;if(null!=o&&(o[0]=!!(16&g)),null!=l&&(l[0]=y),null!=c&&(c[0]=0),l=u[0],g=h[0],m&&y&&null==d){b=0;break}if(4>s){b=7;break}if(w&&m||!w&&!m&&!n(e,r[0],"ALPH")){s=[s],p.na=[p.na],p.P=[p.P],p.Sa=[p.Sa];e:{C=e,b=r,w=s;var E=p.gb;S=p.na,A=p.P,_=p.Sa,I=22,t(null!=C),t(null!=w),N=b[0];var T=w[0];for(t(null!=S),t(null!=_),S[0]=null,A[0]=null,_[0]=0;;){if(b[0]=N,w[0]=T,8>T){b=7;break e}var j=D(C,N+4);if(4294967286<j){b=3;break e}var P=8+j+1&-2;if(I+=P,0<E&&I>E){b=3;break e}if(!n(C,N,"VP8 ")||!n(C,N,"VP8L")){b=0;break e}if(T[0]<P){b=7;break e}n(C,N,"ALPH")||(S[0]=C,A[0]=N+8,_[0]=j),N+=P,T-=P}}if(s=s[0],p.na=p.na[0],p.P=p.P[0],p.Sa=p.Sa[0],0!=b)break}s=[s],p.Ja=[p.Ja],p.xa=[p.xa];e:if(E=e,b=r,w=s,S=p.gb[0],A=p.Ja,_=p.xa,C=b[0],N=!n(E,C,"VP8 "),I=!n(E,C,"VP8L"),t(null!=E),t(null!=w),t(null!=A),t(null!=_),8>w[0])b=7;else{if(N||I){if(E=D(E,C+4),12<=S&&E>S-12){b=3;break e}if(f&&E>w[0]-8){b=7;break e}A[0]=E,b[0]+=8,w[0]-=8,_[0]=I}else _[0]=5<=w[0]&&47==E[C+0]&&!(E[C+4]>>5),A[0]=w[0];b=0}if(s=s[0],p.Ja=p.Ja[0],p.xa=p.xa[0],r=r[0],0!=b)break;if(4294967286<p.Ja)return 3;if(null==c||y||(c[0]=p.xa?2:1),l=[l],g=[g],p.xa){if(5>s){b=7;break}c=l,f=g,y=o,null==e||5>s?e=0:5<=s&&47==e[r+0]&&!(e[r+4]>>5)?(w=[0],E=[0],S=[0],x(A=new v,e,r,s),pe(A,w,E,S)?(null!=c&&(c[0]=w[0]),null!=f&&(f[0]=E[0]),null!=y&&(y[0]=S[0]),e=1):e=0):e=0}else{if(10>s){b=7;break}c=g,null==e||10>s||!Qe(e,r+3,s-3)?e=0:(f=e[r+0]|e[r+1]<<8|e[r+2]<<16,y=16383&(e[r+7]<<8|e[r+6]),e=16383&(e[r+9]<<8|e[r+8]),1&f||3<(f>>1&7)||!(f>>4&1)||f>>5>=p.Ja||!y||!e?e=0:(l&&(l[0]=y),c&&(c[0]=e),e=1))}if(!e)return 3;if(l=l[0],g=g[0],m&&(u[0]!=l||h[0]!=g))return 3;null!=d&&(d[0]=p,d.offset=r-d.w,t(4294967286>r-d.w),t(d.offset==d.ha-s));break}return 0==b||7==b&&m&&null==d?(null!=o&&(o[0]|=null!=p.na&&0<p.na.length),null!=i&&(i[0]=l),null!=a&&(a[0]=g),0):b}function On(e,t,n){var r=t.width,s=t.height,i=0,a=0,o=r,l=s;if(t.Da=null!=e&&0<e.Da,t.Da&&(o=e.cd,l=e.bd,i=e.v,a=e.j,11>n||(i&=-2,a&=-2),0>i||0>a||0>=o||0>=l||i+o>r||a+l>s))return 0;if(t.v=i,t.j=a,t.va=i+o,t.o=a+l,t.U=o,t.T=l,t.da=null!=e&&0<e.da,t.da){if(!L(o,l,n=[e.ib],i=[e.hb]))return 0;t.ib=n[0],t.hb=i[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*r/4&&t.hb<3*s/4,t.Kb=0),1}function Ln(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Mn(e,t,n,r){if(null==r||0>=e||0>=t)return 2;if(null!=n){if(n.Da){var s=n.cd,a=n.bd,o=-2&n.v,l=-2&n.j;if(0>o||0>l||0>=s||0>=a||o+s>e||l+a>t)return 2;e=s,t=a}if(n.da){if(!L(e,t,s=[n.ib],a=[n.hb]))return 2;e=s[0],t=a[0]}}r.width=e,r.height=t;e:{var c=r.width,d=r.height;if(e=r.S,0>=c||0>=d||!(e>=Or&&13>e))e=2;else{if(0>=r.Rd&&null==r.sd){o=a=s=t=0;var u=(l=c*Us[e])*d;if(11>e||(a=(d+1)/2*(t=(c+1)/2),12==e&&(o=(s=c)*d)),null==(d=i(u+2*a+o))){e=1;break e}r.sd=d,11>e?((c=r.f.RGBA).eb=d,c.fb=0,c.A=l,c.size=u):((c=r.f.kb).y=d,c.O=0,c.fa=l,c.Fd=u,c.f=d,c.N=0+u,c.Ab=t,c.Cd=a,c.ea=d,c.W=0+u+a,c.Db=t,c.Ed=a,12==e&&(c.F=d,c.J=0+u+2*a),c.Tc=o,c.lb=s)}if(t=1,s=r.S,a=r.width,o=r.height,s>=Or&&13>s)if(11>s)e=r.f.RGBA,t&=(l=Math.abs(e.A))*(o-1)+a<=e.size,t&=l>=a*Us[s],t&=null!=e.eb;else{e=r.f.kb,l=(a+1)/2,u=(o+1)/2,c=Math.abs(e.fa),d=Math.abs(e.Ab);var h=Math.abs(e.Db),m=Math.abs(e.lb),f=m*(o-1)+a;t&=c*(o-1)+a<=e.Fd,t&=d*(u-1)+l<=e.Cd,t=(t&=h*(u-1)+l<=e.Ed)&c>=a&d>=l&h>=l,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==s&&(t&=m>=a,t&=f<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=n&&n.fd&&(e=Ln(r)),e}var Fn=64,Bn=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Un=24,zn=32,qn=8,Hn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];B("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,n){return t[n+0]},e.Predictor3=function(e,t,n){return t[n+1]},e.Predictor4=function(e,t,n){return t[n-1]},e.Predictor5=function(e,t,n){return z(z(e,t[n+1]),t[n+0])},e.Predictor6=function(e,t,n){return z(e,t[n-1])},e.Predictor7=function(e,t,n){return z(e,t[n+0])},e.Predictor8=function(e,t,n){return z(t[n-1],t[n+0])},e.Predictor9=function(e,t,n){return z(t[n+0],t[n+1])},e.Predictor10=function(e,t,n){return z(z(e,t[n-1]),z(t[n+0],t[n+1]))},e.Predictor11=function(e,t,n){var r=t[n+0];return 0>=V(r>>24&255,e>>24&255,(t=t[n-1])>>24&255)+V(r>>16&255,e>>16&255,t>>16&255)+V(r>>8&255,e>>8&255,t>>8&255)+V(255&r,255&e,255&t)?r:e},e.Predictor12=function(e,t,n){var r=t[n+0];return(q((e>>24&255)+(r>>24&255)-((t=t[n-1])>>24&255))<<24|q((e>>16&255)+(r>>16&255)-(t>>16&255))<<16|q((e>>8&255)+(r>>8&255)-(t>>8&255))<<8|q((255&e)+(255&r)-(255&t)))>>>0},e.Predictor13=function(e,t,n){var r=t[n-1];return(H((e=z(e,t[n+0]))>>24&255,r>>24&255)<<24|H(e>>16&255,r>>16&255)<<16|H(e>>8&255,r>>8&255)<<8|H(255&e,255&r))>>>0};var Vn=e.PredictorAdd0;e.PredictorAdd1=W,B("Predictor2","PredictorAdd2"),B("Predictor3","PredictorAdd3"),B("Predictor4","PredictorAdd4"),B("Predictor5","PredictorAdd5"),B("Predictor6","PredictorAdd6"),B("Predictor7","PredictorAdd7"),B("Predictor8","PredictorAdd8"),B("Predictor9","PredictorAdd9"),B("Predictor10","PredictorAdd10"),B("Predictor11","PredictorAdd11"),B("Predictor12","PredictorAdd12"),B("Predictor13","PredictorAdd13");var Wn=e.PredictorAdd2;Q("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),Q("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Gn,Yn=e.ColorIndexInverseTransform,Xn=e.MapARGB,Qn=e.VP8LColorIndexInverseTransformAlpha,Kn=e.MapAlpha,Zn=e.VP8LPredictorsAdd=[];Zn.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Jn,$n,er,tr,nr,rr,sr,ir,ar,or,lr,cr,dr,ur,hr,mr,fr,pr,gr,xr,yr,br,wr,vr,Nr,Sr,Ar,_r,Cr=i(511),Ir=i(2041),Er=i(225),Tr=i(767),jr=0,kr=Ir,Dr=Er,Pr=Tr,Rr=Cr,Or=0,Lr=1,Mr=2,Fr=3,Br=4,Ur=5,zr=6,qr=7,Hr=8,Vr=9,Wr=10,Gr=[2,3,7],Yr=[3,3,11],Xr=[280,256,256,256,40],Qr=[0,1,1,1,0],Kr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Jr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$r=8,es=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ts=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ns=null,rs=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ss=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],is=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],as=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],os=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ls=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],cs=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ds=[],us=[],hs=[],ms=1,fs=2,ps=[],gs=[];xn("UpsampleRgbLinePair",Sn,3),xn("UpsampleBgrLinePair",An,3),xn("UpsampleRgbaLinePair",Tn,4),xn("UpsampleBgraLinePair",En,4),xn("UpsampleArgbLinePair",In,4),xn("UpsampleRgba4444LinePair",Cn,2),xn("UpsampleRgb565LinePair",_n,2);var xs=e.UpsampleRgbLinePair,ys=e.UpsampleBgrLinePair,bs=e.UpsampleRgbaLinePair,ws=e.UpsampleBgraLinePair,vs=e.UpsampleArgbLinePair,Ns=e.UpsampleRgba4444LinePair,Ss=e.UpsampleRgb565LinePair,As=16,_s=1<<As-1,Cs=-227,Is=482,Es=6,Ts=(256<<Es)-1,js=0,ks=i(256),Ds=i(256),Ps=i(256),Rs=i(256),Os=i(Is-Cs),Ls=i(Is-Cs);jn("YuvToRgbRow",Sn,3),jn("YuvToBgrRow",An,3),jn("YuvToRgbaRow",Tn,4),jn("YuvToBgraRow",En,4),jn("YuvToArgbRow",In,4),jn("YuvToRgba4444Row",Cn,2),jn("YuvToRgb565Row",_n,2);var Ms=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Fs=[0,2,8],Bs=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(e,n,o,l,c){var d=Lr,u=new tn,h=new ae;u.ba=h,h.S=d,h.width=[h.width],h.height=[h.height];var m=h.width,f=h.height,p=new oe;if(null==p||null==e)var g=2;else t(null!=p),g=Rn(e,n,o,p.width,p.height,p.Pd,p.Qd,p.format,null);if(0!=g?m=0:(null!=m&&(m[0]=p.width[0]),null!=f&&(f[0]=p.height[0]),m=1),m){h.width=h.width[0],h.height=h.height[0],null!=l&&(l[0]=h.width),null!=c&&(c[0]=h.height);e:{if(l=new Ge,(c=new nn).data=e,c.w=n,c.ha=o,c.kd=1,n=[0],t(null!=c),(0==(e=Rn(c.data,c.w,c.ha,null,null,null,n,null,c))||7==e)&&n[0]&&(e=4),0==(n=e)){if(t(null!=u),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=me,l.ac=he,l.bc=fe,l.ma=u,c.xa){if(null==(e=Ee())){u=1;break e}if(function(e,n){var r=[0],s=[0],i=[0];t:for(;;){if(null==e)return 0;if(null==n)return e.a=2,0;if(e.l=n,e.a=0,x(e.m,n.data,n.w,n.ha),!pe(e.m,r,s,i)){e.a=3;break t}if(e.xb=fs,n.width=r[0],n.height=s[0],!Te(r[0],s[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,l)){if(l=0==(n=Mn(l.width,l.height,u.Oa,u.ba))){t:{l=e;n:for(;;){if(null==l){l=0;break t}if(t(null!=l.s.yc),t(null!=l.s.Ya),t(0<l.s.Wb),t(null!=(o=l.l)),t(null!=(c=o.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,t(null!=l.ca),!On(c.Oa,o,Fr)){l.a=2;break n}if(!je(l,o.width))break n;if(o.da)break n;if((o.da||re(l.ca.S))&&gn(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&gn()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!P(l.s.vb,l.s.Wa.Xa)){l.a=1;break n}l.xb=0}if(!Ce(l,l.V,l.Ba,l.c,l.i,o.o,Ne))break n;c.Dc=l.Ma,l=1;break t}t(0!=l.a),l=0}l=!l}l&&(n=e.a)}else n=e.a}else{if(null==(e=new Ye)){u=1;break e}if(e.Fa=c.na,e.P=c.P,e.qc=c.Sa,Ke(e,l)){if(0==(n=Mn(l.width,l.height,u.Oa,u.ba))){if(e.Aa=0,o=u.Oa,t(null!=(c=e)),null!=o){if(0<(m=0>(m=o.Md)?0:100<m?255:255*m/100)){for(f=p=0;4>f;++f)12>(g=c.pb[f]).lc&&(g.ia=m*Bs[0>g.lc?0:g.lc]>>3),p|=g.ia;p&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=o.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(e,n){if(null==e)return 0;if(null==n)return Xe(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Ke(e,n))return 0;if(t(e.cb),null==n.ac||n.ac(n)){n.ob&&(e.L=0);var o=Fs[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=n.v-o>>4,e.zb=n.j-o>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=n.o+15+o>>4,e.Hb=n.va+15+o>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var l=e.ed;for(o=0;4>o;++o){var c;if(e.Qa.Cb){var d=e.Qa.Lb[o];e.Qa.Fb||(d+=l.Tb)}else d=l.Tb;for(c=0;1>=c;++c){var u=e.gd[o][c],h=d;if(l.Pc&&(h+=l.vd[0],c&&(h+=l.od[0])),0<(h=0>h?0:63<h?63:h)){var m=h;0<l.wb&&(m=4<l.wb?m>>2:m>>1)>9-l.wb&&(m=9-l.wb),1>m&&(m=1),u.dd=m,u.tc=2*h+m,u.ld=40<=h?2:15<=h?1:0}else u.tc=0;u.La=c}}}o=0}else Xe(e,6,"Frame setup failed"),o=e.a;if(o=0==o){if(o){e.$c=0,0<e.Aa||(e.Ic=1);t:{o=e.Ic,l=4*(m=e.za);var f=32*m,p=m+1,g=0<e.L?m*(0<e.Aa?2:1):0,x=(2==e.Aa?2:1)*m;if((u=l+832+(c=3*(16*o+Fs[e.L])/2*f)+(d=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=u)o=0;else{if(u>e.Vb){if(e.Vb=0,e.Ec=i(u),e.Fc=0,null==e.Ec){o=Xe(e,1,"no memory during frame initialization.");break t}e.Vb=u}u=e.Ec,h=e.Fc,e.Ac=u,e.Bc=h,h+=l,e.Gd=a(f,He),e.Hd=0,e.rb=a(p+1,Be),e.sb=1,e.wa=g?a(g,Fe):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=m),t(!0),e.oc=u,e.pc=h,h+=832,e.ya=a(x,ze),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=m),e.R=16*m,e.B=8*m,m=(f=Fs[e.L])*e.R,f=f/2*e.B,e.sa=u,e.ta=h+m,e.qa=e.sa,e.ra=e.ta+16*o*e.R+f,e.Ha=e.qa,e.Ia=e.ra+8*o*e.B+f,e.$c=0,h+=c,e.mb=d?u:null,e.nb=d?h:null,t(h+d<=e.Fc+e.Vb),Je(e),s(e.Ac,e.Bc,0,l),o=1}}if(o){if(n.ka=0,n.y=e.sa,n.O=e.ta,n.f=e.qa,n.N=e.ra,n.ea=e.Ha,n.Vd=e.Ia,n.fa=e.R,n.Rc=e.B,n.F=null,n.J=0,!jr){for(o=-255;255>=o;++o)Cr[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)Ir[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)Er[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)Tr[255+o]=0>o?0:255<o?255:o;jr=1}sr=lt,ir=st,or=it,lr=at,cr=ot,ar=rt,dr=Yt,ur=Xt,hr=Zt,mr=Jt,fr=Qt,pr=Kt,gr=$t,xr=en,yr=zt,br=qt,wr=Ht,vr=Vt,us[0]=St,us[1]=dt,us[2]=vt,us[3]=Nt,us[4]=At,us[5]=Ct,us[6]=_t,us[7]=It,us[8]=Tt,us[9]=Et,ds[0]=gt,ds[1]=ht,ds[2]=mt,ds[3]=ft,ds[4]=xt,ds[5]=yt,ds[6]=bt,hs[0]=Pt,hs[1]=ut,hs[2]=jt,hs[3]=kt,hs[4]=Ot,hs[5]=Rt,hs[6]=Lt,o=1}else o=0}o&&(o=function(e,n){for(e.M=0;e.M<e.Va;++e.M){var a,o=e.Jc[e.M&e.Xb],l=e.m,c=e;for(a=0;a<c.za;++a){var d=l,u=c,h=u.Ac,m=u.Bc+4*a,f=u.zc,p=u.ya[u.aa+a];if(u.Qa.Bb?p.$b=E(d,u.Pa.jb[0])?2+E(d,u.Pa.jb[2]):E(d,u.Pa.jb[1]):p.$b=0,u.kc&&(p.Ad=E(d,u.Bd)),p.Za=!E(d,145)+0,p.Za){var g=p.Ob,x=0;for(u=0;4>u;++u){var y,b=f[0+u];for(y=0;4>y;++y){b=os[h[m+y]][b];for(var w=is[E(d,b[0])];0<w;)w=is[2*w+E(d,b[w])];b=-w,h[m+y]=b}r(g,x,h,m,4),x+=4,f[0+u]=b}}else b=E(d,156)?E(d,128)?1:3:E(d,163)?2:0,p.Ob[0]=b,s(h,m,b,4),s(f,0,b,4);p.Dd=E(d,142)?E(d,114)?E(d,183)?1:3:2:0}if(c.m.Ka)return Xe(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(c=o,d=(l=e).rb[l.sb-1],h=l.rb[l.sb+l.ja],a=l.ya[l.aa+l.ja],m=l.kc?a.Ad:0)d.la=h.la=0,a.Za||(d.Na=h.Na=0),a.Hc=0,a.Gc=0,a.ia=0;else{var v,N;if(d=h,h=c,m=l.Pa.Xc,f=l.ya[l.aa+l.ja],p=l.pb[f.$b],u=f.ad,g=0,x=l.rb[l.sb-1],b=y=0,s(u,g,0,384),f.Za)var S=0,A=m[3];else{w=i(16);var _=d.Na+x.Na;if(_=ns(h,m[1],_,p.Eb,0,w,0),d.Na=x.Na=(0<_)+0,1<_)sr(w,0,u,g);else{var C=w[0]+3>>3;for(w=0;256>w;w+=16)u[g+w]=C}S=1,A=m[0]}var I=15&d.la,T=15&x.la;for(w=0;4>w;++w){var j=1&T;for(C=N=0;4>C;++C)I=I>>1|(j=(_=ns(h,A,_=j+(1&I),p.Sc,S,u,g))>S)<<7,N=N<<2|(3<_?3:1<_?2:0!=u[g+0]),g+=16;I>>=4,T=T>>1|j<<7,y=(y<<8|N)>>>0}for(A=I,S=T>>4,v=0;4>v;v+=2){for(N=0,I=d.la>>4+v,T=x.la>>4+v,w=0;2>w;++w){for(j=1&T,C=0;2>C;++C)_=j+(1&I),I=I>>1|(j=0<(_=ns(h,m[2],_,p.Qc,0,u,g)))<<3,N=N<<2|(3<_?3:1<_?2:0!=u[g+0]),g+=16;I>>=2,T=T>>1|j<<5}b|=N<<4*v,A|=I<<4<<v,S|=(240&T)<<v}d.la=A,x.la=S,f.Hc=y,f.Gc=b,f.ia=43690&b?0:p.ia,m=!(y|b)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[a.$b][a.Za],l.wa[l.Y+l.ja].La|=!m),c.Ka)return Xe(e,7,"Premature end-of-file encountered.")}if(Je(e),l=n,c=1,a=(o=e).D,d=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)t:{if(a.M=o.M,a.uc=d,Pn(o,a),c=1,a=(N=o.D).Nb,d=(b=Fs[o.L])*o.R,h=b/2*o.B,w=16*a*o.R,C=8*a*o.B,m=o.sa,f=o.ta-d+w,p=o.qa,u=o.ra-h+C,g=o.Ha,x=o.Ia-h+C,T=0==(I=N.M),y=I>=o.Va-1,2==o.Aa&&Pn(o,N),N.uc)for(j=(_=o).D.M,t(_.D.uc),N=_.yb;N<_.Hb;++N){S=N,A=j;var k=(D=(z=_).D).Nb;v=z.R;var D=D.wa[D.Y+S],P=z.sa,R=z.ta+16*k*v+16*S,O=D.dd,L=D.tc;if(0!=L)if(t(3<=L),1==z.L)0<S&&br(P,R,v,L+4),D.La&&vr(P,R,v,L),0<A&&yr(P,R,v,L+4),D.La&&wr(P,R,v,L);else{var M=z.B,F=z.qa,B=z.ra+8*k*M+8*S,U=z.Ha,z=z.Ia+8*k*M+8*S;k=D.ld,0<S&&(ur(P,R,v,L+4,O,k),mr(F,B,U,z,M,L+4,O,k)),D.La&&(pr(P,R,v,L,O,k),xr(F,B,U,z,M,L,O,k)),0<A&&(dr(P,R,v,L+4,O,k),hr(F,B,U,z,M,L+4,O,k)),D.La&&(fr(P,R,v,L,O,k),gr(F,B,U,z,M,L,O,k))}}if(o.ia&&alert("todo:DitherRow"),null!=l.put){if(N=16*I,I=16*(I+1),T?(l.y=o.sa,l.O=o.ta+w,l.f=o.qa,l.N=o.ra+C,l.ea=o.Ha,l.W=o.Ia+C):(N-=b,l.y=m,l.O=f,l.f=p,l.N=u,l.ea=g,l.W=x),y||(I-=b),I>l.o&&(I=l.o),l.F=null,l.J=null,null!=o.Fa&&0<o.Fa.length&&N<I&&(l.J=un(o,l,N,I-N),l.F=o.mb,null==l.F&&0==l.F.length)){c=Xe(o,3,"Could not decode alpha data.");break t}N<l.j&&(b=l.j-N,N=l.j,t(!(1&b)),l.O+=o.R*b,l.N+=o.B*(b>>1),l.W+=o.B*(b>>1),null!=l.F&&(l.J+=l.width*b)),N<I&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=N-l.j,l.U=l.va-l.v,l.T=I-N,c=l.put(l))}a+1!=o.Ic||y||(r(o.sa,o.ta-d,m,f+16*o.R,d),r(o.qa,o.ra-h,p,u+8*o.B,h),r(o.Ha,o.Ia-h,g,x+8*o.B,h))}if(!c)return Xe(e,6,"Output aborted.")}return 1}(e,n)),null!=n.bc&&n.bc(n),o&=1}return o?(e.cb=0,o):0})(e,l)||(n=e.a)}}else n=e.a}0==n&&null!=u.Oa&&u.Oa.fd&&(n=Ln(u.ba))}u=n}d=0!=u?null:11>d?h.f.RGBA.eb:h.f.kb.y}else d=null;return d};var Us=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(e,t){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(e[t++]);return n}function d(e,t){return e[t+0]|e[t+1]<<8}function u(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new l;var m=[0],f=[0],p=[],g=new l,x=e,y=function(e,t){var n={},r=0,s=!1,i=0,a=0;if(n.frames=[],!function(e,t){for(var n=0;n<4;n++)if(e[t+n]!="RIFF".charCodeAt(n))return!0;return!1}(e,t)){for(h(e,t+=4),t+=8;t<e.length;){var o=c(e,t),l=h(e,t+=4);t+=4;var m=l+(1&l);switch(o){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(g=n.frames[r]).src_off=s?a:t-8,g.src_size=i+l+8,r++,s&&(s=!1,i=0,a=0);break;case"VP8X":(g=n.header={}).feature_flags=e[t];var f=t+4;g.canvas_width=1+u(e,f),f+=3,g.canvas_height=1+u(e,f),f+=3;break;case"ALPH":s=!0,i=m+8,a=t-8;break;case"ANIM":(g=n.header).bgcolor=h(e,t),f=t+4,g.loop_count=d(e,f),f+=2;break;case"ANMF":var p,g;(g=n.frames[r]={}).offset_x=2*u(e,t),t+=3,g.offset_y=2*u(e,t),t+=3,g.width=1+u(e,t),t+=3,g.height=1+u(e,t),t+=3,g.duration=u(e,t),t+=3,p=e[t++],g.dispose=1&p,g.blend=p>>1&1}"ANMF"!=o&&(t+=m)}return n}}(x,0);y.response=x,y.rgbaoutput=!0,y.dataurl=!1;var b=y.header?y.header:null,w=y.frames?y.frames:null;if(b){b.loop_counter=b.loop_count,m=[b.canvas_height],f=[b.canvas_width];for(var v=0;v<w.length&&0!=w[v].blend;v++);}var N=w[0],S=g.WebPDecodeRGBA(x,N.src_off,N.src_size,f,m);N.rgba=S,N.imgwidth=f[0],N.imgheight=m[0];for(var A=0;A<f[0]*m[0]*4;A++)p[A]=S[A];return this.width=f,this.height=m,this.data=p,this}!function(e){var t,n,r,s,i,a,o,l,c,d=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new a,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new a,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new u(this),t=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new d}]);var u=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var s=0;Object.defineProperty(this,"posX",{get:function(){return s},set:function(e){isNaN(e)||(s=e)}});var i=0;Object.defineProperty(this,"posY",{get:function(){return i},set:function(e){isNaN(e)||(i=e)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),c.margin=t}});var a=!1;Object.defineProperty(this,"autoPaging",{get:function(){return a},set:function(e){a=e}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(e){o=e}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof d&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=h(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=h(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var m=null,f=null;Object.defineProperty(this,"fontFaces",{get:function(){return f},set:function(e){m=null,f=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var n=t[1];t[2];var r=t[3],s=t[4];t[5];var i=t[6],a=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(s)[2];s="px"===a?Math.floor(parseFloat(s)*this.pdf.internal.scaleFactor):"em"===a?Math.floor(parseFloat(s)*this.pdf.getFontSize()):Math.floor(parseFloat(s)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(s);var o=function(e){var t,n,r=[],s=e.trim();if(""===s)return Kl;if(s in Ll)return[Ll[s]];for(;""!==s;){switch(n=null,t=(s=Fl(s)).charAt(0)){case'"':case"'":n=Bl(s.substring(1),t);break;default:n=Ul(s)}if(null===n)return Kl;if(r.push(n[0]),""!==(s=Fl(n[1]))&&","!==s.charAt(0))return Kl;s=s.replace(/^,/,"")}return r}(i);if(this.fontFaces){var l=function(e,t){if(null===m){var n=function(e){var t=[];return Object.keys(e).forEach(function(n){e[n].forEach(function(e){var r=null;switch(e){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:e},t.push(r))})}),t}(e.getFontList());m=function(e){for(var t={},n=0;n<e.length;++n){var r=Pl(e[n]),s=r.family,i=r.stretch,a=r.style,o=r.weight;t[s]=t[s]||{},t[s][i]=t[s][i]||{},t[s][i][a]=t[s][i][a]||{},t[s][i][a][o]=r}return t}(n.concat(t))}return m}(this.pdf,this.fontFaces),c=o.map(function(e){return{family:e,stretch:"normal",weight:r,style:n}}),d=function(e,t,n){for(var r=(n=n||{}).defaultFontFamily||"times",s=Object.assign({},Ol,n.genericFontFamilies||{}),i=null,a=null,o=0;o<t.length;++o)if(s[(i=Pl(t[o])).family]&&(i.family=s[i.family]),e.hasOwnProperty(i.family)){a=e[i.family];break}if(!(a=a||e[r]))throw new Error("Could not find a font-family for the rule '"+Ml(i)+"' and default family '"+r+"'.");if(a=function(e,t){if(t[e])return t[e];var n=jl[e],r=n<=jl.normal?-1:1,s=Rl(t,Tl,n,r);if(!s)throw new Error("Could not find a matching font-stretch value for "+e);return s}(i.stretch,a),a=function(e,t){if(t[e])return t[e];for(var n=El[e],r=0;r<n.length;++r)if(t[n[r]])return t[n[r]];throw new Error("Could not find a matching font-style for "+e)}(i.style,a),!(a=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var n=Dl[e],r=Rl(t,kl,n,e<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+e);return r}(i.weight,a)))throw new Error("Failed to resolve a font for the rule '"+Ml(i)+"'.");return a}(l,c);this.pdf.setFont(d.ref.name,d.ref.style)}else{var u="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(u="bold"),"italic"===n&&(u+="italic"),0===u.length&&(u="normal");for(var h="",f={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},p=0;p<o.length;p++){if(void 0!==this.pdf.internal.getFont(o[p],u,{noFallback:!0,disableWarning:!0})){h=o[p];break}if("bolditalic"===u&&void 0!==this.pdf.internal.getFont(o[p],"bold",{noFallback:!0,disableWarning:!0}))h=o[p],u="bold";else if(void 0!==this.pdf.internal.getFont(o[p],"normal",{noFallback:!0,disableWarning:!0})){h=o[p],u="normal";break}}if(""===h)for(var g=0;g<o.length;g++)if(f[o[g]]){h=f[o[g]];break}h=""===h?"Times":h,this.pdf.setFont(h,u)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,M.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,M.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};u.prototype.setLineDash=function(e){this.lineDash=e},u.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},u.prototype.fill=function(){w.call(this,"fill",!1)},u.prototype.stroke=function(){w.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw lo.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new a(e,t)},u.prototype.closePath=function(){var e=new a(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,Yt.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new a(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(e.x,e.y)},u.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw lo.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new a(n.x,n.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),w.call(this,null,!0)},u.prototype.quadraticCurveTo=function(e,t,n,r){if(isNaN(n)||isNaN(r)||isNaN(e)||isNaN(t))throw lo.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var s=this.ctx.transform.applyToPoint(new a(n,r)),i=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"qct",x1:i.x,y1:i.y,x:s.x,y:s.y}),this.ctx.lastPoint=new a(s.x,s.y)},u.prototype.bezierCurveTo=function(e,t,n,r,s,i){if(isNaN(s)||isNaN(i)||isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw lo.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new a(s,i)),l=this.ctx.transform.applyToPoint(new a(e,t)),c=this.ctx.transform.applyToPoint(new a(n,r));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new a(o.x,o.y)},u.prototype.arc=function(e,t,n,r,s,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(s))throw lo.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(i=Boolean(i),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new a(e,t));e=o.x,t=o.y;var l=this.ctx.transform.applyToPoint(new a(0,n)),c=this.ctx.transform.applyToPoint(new a(0,0));n=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(s-r)>=2*Math.PI&&(r=0,s=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:n,startAngle:r,endAngle:s,counterclockwise:i})},u.prototype.arcTo=function(e,t,n,r,s){throw new Error("arcTo not implemented.")},u.prototype.rect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw lo.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.lineTo(e+n,t),this.lineTo(e,t)},u.prototype.fillRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw lo.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var s={};"butt"!==this.lineCap&&(s.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(s.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,n,r),this.fill(),s.hasOwnProperty("lineCap")&&(this.lineCap=s.lineCap),s.hasOwnProperty("lineJoin")&&(this.lineJoin=s.lineJoin)}},u.prototype.strokeRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw lo.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");f.call(this)||(this.beginPath(),this.rect(e,t,n,r),this.stroke())},u.prototype.clearRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw lo.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,n,r))},u.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},u.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(e){var t,n,r,s;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,n=0,r=0,s=0;else{var i=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==i)t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),s=1;else if(null!==(i=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),s=parseFloat(i[4]);else{if(s=1,"string"==typeof e&&"#"!==e.charAt(0)){var a=new fo(e);e=a.ok?a.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,n=e.substring(2,3),n+=n,r=e.substring(3,4),r+=r):(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7)),t=parseInt(t,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:t,g:n,b:r,a:s,style:e}},m=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},f=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};u.prototype.fillText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw lo.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!m.call(this)){var s=R(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;E.call(this,{text:e,x:t,y:n,scale:i,angle:s,align:this.textAlign,maxWidth:r})}},u.prototype.strokeText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw lo.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!f.call(this)){r=isNaN(r)?void 0:r;var s=R(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;E.call(this,{text:e,x:t,y:n,scale:i,renderingMode:"stroke",angle:s,align:this.textAlign,maxWidth:r})}},u.prototype.measureText=function(e){if("string"!=typeof e)throw lo.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,n=this.pdf.internal.scaleFactor,r=t.internal.getFontSize(),s=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:s*=Math.round(96*n/72*1e4)/1e4})},u.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw lo.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},u.prototype.rotate=function(e){if(isNaN(e))throw lo.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},u.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw lo.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(n)},u.prototype.transform=function(e,t,n,r,s,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(i))throw lo.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var a=new l(e,t,n,r,s,i);this.ctx.transform=this.ctx.transform.multiply(a)},u.prototype.setTransform=function(e,t,n,r,s,i){e=isNaN(e)?1:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,r=isNaN(r)?1:r,s=isNaN(s)?0:s,i=isNaN(i)?0:i,this.ctx.transform=new l(e,t,n,r,s,i)};var p=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};u.prototype.drawImage=function(e,t,n,r,s,i,a,c,d){var u=this.pdf.getImageProperties(e),h=1,m=1,f=1,x=1;void 0!==r&&void 0!==c&&(f=c/r,x=d/s,h=u.width/r*c/r,m=u.height/s*d/s),void 0===i&&(i=t,a=n,t=0,n=0),void 0!==r&&void 0===c&&(c=r,d=s),void 0===r&&void 0===c&&(c=u.width,d=u.height);for(var w,N=this.ctx.transform.decompose(),S=R(N.rotate.shx),A=new l,_=(A=(A=(A=A.multiply(N.translate)).multiply(N.skew)).multiply(N.scale)).applyToRectangle(new o(i-t*f,a-n*x,r*h,s*m)),C=g.call(this,_),I=[],E=0;E<C.length;E+=1)-1===I.indexOf(C[E])&&I.push(C[E]);if(b(I),this.autoPaging)for(var T=I[0],j=I[I.length-1],k=T;k<j+1;k++){this.pdf.setPage(k);var D=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],P=1===k?this.posY+this.margin[0]:this.margin[0],O=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],L=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],M=1===k?0:O+(k-2)*L;if(0!==this.ctx.clip_path.length){var F=this.path;w=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(w,this.posX+this.margin[3],-M+P+this.ctx.prevPageLastElemOffset),v.call(this,"fill",!0),this.path=F}var B=JSON.parse(JSON.stringify(_));B=y([B],this.posX+this.margin[3],-M+P+this.ctx.prevPageLastElemOffset)[0];var U=(k>T||k<j)&&p.call(this);U&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],D,L,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",B.x,B.y,B.w,B.h,null,null,S),U&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",_.x,_.y,_.w,_.h,null,null,S)};var g=function(e,t,n){var r=[];t=t||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var s=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":r.push(Math.floor((e.y+s)/n)+1);break;case"arc":r.push(Math.floor((e.y+s-e.radius)/n)+1),r.push(Math.floor((e.y+s+e.radius)/n)+1);break;case"qct":var i=O(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);r.push(Math.floor((i.y+s)/n)+1),r.push(Math.floor((i.y+i.h+s)/n)+1);break;case"bct":var a=L(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);r.push(Math.floor((a.y+s)/n)+1),r.push(Math.floor((a.y+a.h+s)/n)+1);break;case"rect":r.push(Math.floor((e.y+s)/n)+1),r.push(Math.floor((e.y+e.h+s)/n)+1)}for(var o=0;o<r.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<r[o];)x.call(this);return r},x=function(){var e=this.fillStyle,t=this.strokeStyle,n=this.font,r=this.lineCap,s=this.lineWidth,i=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=n,this.lineCap=r,this.lineWidth=s,this.lineJoin=i},y=function(e,t,n){for(var r=0;r<e.length;r++)switch(e[r].type){case"bct":e[r].x2+=t,e[r].y2+=n;case"qct":e[r].x1+=t,e[r].y1+=n;default:e[r].x+=t,e[r].y+=n}return e},b=function(e){return e.sort(function(e,t){return e-t})},w=function(e,t){for(var n,r,s=this.fillStyle,i=this.strokeStyle,a=this.lineCap,o=this.lineWidth,l=Math.abs(o*this.ctx.transform.scaleX),c=this.lineJoin,d=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),h=[],m=0;m<u.length;m++)if(void 0!==u[m].x)for(var f=g.call(this,u[m]),w=0;w<f.length;w+=1)-1===h.indexOf(f[w])&&h.push(f[w]);for(var N=0;N<h.length;N++)for(;this.pdf.internal.getNumberOfPages()<h[N];)x.call(this);if(b(h),this.autoPaging)for(var S=h[0],A=h[h.length-1],_=S;_<A+1;_++){this.pdf.setPage(_),this.fillStyle=s,this.strokeStyle=i,this.lineCap=a,this.lineWidth=l,this.lineJoin=c;var C=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],I=1===_?this.posY+this.margin[0]:this.margin[0],E=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],T=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],j=1===_?0:E+(_-2)*T;if(0!==this.ctx.clip_path.length){var k=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(n,this.posX+this.margin[3],-j+I+this.ctx.prevPageLastElemOffset),v.call(this,e,!0),this.path=k}if(r=JSON.parse(JSON.stringify(d)),this.path=y(r,this.posX+this.margin[3],-j+I+this.ctx.prevPageLastElemOffset),!1===t||0===_){var D=(_>S||_<A)&&p.call(this);D&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],C,T,null).clip().discardPath()),v.call(this,e,t),D&&this.pdf.restoreGraphicsState()}this.lineWidth=o}else this.lineWidth=l,v.call(this,e,t),this.lineWidth=o;this.path=d},v=function(e,t){if(("stroke"!==e||t||!f.call(this))&&("stroke"===e||t||!m.call(this))){for(var n,r,s=[],i=this.path,a=0;a<i.length;a++){var o=i[a];switch(o.type){case"begin":s.push({begin:!0});break;case"close":s.push({close:!0});break;case"mt":s.push({start:o,deltas:[],abs:[]});break;case"lt":var l=s.length;if(i[a-1]&&!isNaN(i[a-1].x)&&(n=[o.x-i[a-1].x,o.y-i[a-1].y],l>0))for(;l>=0;l--)if(!0!==s[l-1].close&&!0!==s[l-1].begin){s[l-1].deltas.push(n),s[l-1].abs.push(o);break}break;case"bct":n=[o.x1-i[a-1].x,o.y1-i[a-1].y,o.x2-i[a-1].x,o.y2-i[a-1].y,o.x-i[a-1].x,o.y-i[a-1].y],s[s.length-1].deltas.push(n);break;case"qct":var c=i[a-1].x+2/3*(o.x1-i[a-1].x),d=i[a-1].y+2/3*(o.y1-i[a-1].y),u=o.x+2/3*(o.x1-o.x),h=o.y+2/3*(o.y1-o.y),p=o.x,g=o.y;n=[c-i[a-1].x,d-i[a-1].y,u-i[a-1].x,h-i[a-1].y,p-i[a-1].x,g-i[a-1].y],s[s.length-1].deltas.push(n);break;case"arc":s.push({deltas:[],abs:[],arc:!0}),Array.isArray(s[s.length-1].abs)&&s[s.length-1].abs.push(o)}}r=t?null:"stroke"===e?"stroke":"fill";for(var x=!1,y=0;y<s.length;y++)if(s[y].arc)for(var b=s[y].abs,w=0;w<b.length;w++){var v=b[w];"arc"===v.type?A.call(this,v.x,v.y,v.radius,v.startAngle,v.endAngle,v.counterclockwise,void 0,t,!x):T.call(this,v.x,v.y),x=!0}else if(!0===s[y].close)this.pdf.internal.out("h"),x=!1;else if(!0!==s[y].begin){var N=s[y].start.x,S=s[y].start.y;j.call(this,s[y].deltas,N,S),x=!0}r&&_.call(this,r),t&&C.call(this)}},N=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-n;case"top":return e+t-n;case"hanging":return e+t-2*n;case"middle":return e+t/2-n;default:return e}},S=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};u.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var A=function(e,t,n,r,s,i,a,o,l){for(var c=D.call(this,n,r,s,i),d=0;d<c.length;d++){var u=c[d];0===d&&(l?I.call(this,u.x1+e,u.y1+t):T.call(this,u.x1+e,u.y1+t)),k.call(this,e,t,u.x2,u.y2,u.x3,u.y3,u.x4,u.y4)}o?C.call(this):_.call(this,a)},_=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},C=function(){this.pdf.clip(),this.pdf.discardPath()},I=function(e,t){this.pdf.internal.out(n(e)+" "+r(t)+" m")},E=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var n=this.pdf.getTextDimensions(e.text),r=N.call(this,e.y),s=S.call(this,r)-n.h,i=this.ctx.transform.applyToPoint(new a(e.x,r)),c=this.ctx.transform.decompose(),d=new l;d=(d=(d=d.multiply(c.translate)).multiply(c.skew)).multiply(c.scale);for(var u,h,m,f=this.ctx.transform.applyToRectangle(new o(e.x,r,n.w,n.h)),x=d.applyToRectangle(new o(e.x,s,n.w,n.h)),w=g.call(this,x),A=[],_=0;_<w.length;_+=1)-1===A.indexOf(w[_])&&A.push(w[_]);if(b(A),this.autoPaging)for(var C=A[0],I=A[A.length-1],E=C;E<I+1;E++){this.pdf.setPage(E);var T=1===E?this.posY+this.margin[0]:this.margin[0],j=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],k=this.pdf.internal.pageSize.height-this.margin[2],D=k-this.margin[0],P=this.pdf.internal.pageSize.width-this.margin[1],R=P-this.margin[3],O=1===E?0:j+(E-2)*D;if(0!==this.ctx.clip_path.length){var L=this.path;u=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(u,this.posX+this.margin[3],-1*O+T),v.call(this,"fill",!0),this.path=L}var M=y([JSON.parse(JSON.stringify(x))],this.posX+this.margin[3],-O+T+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),m=this.lineWidth,this.lineWidth=m*e.scale);var F="text"!==this.autoPaging;if(F||M.y+M.h<=k){if(F||M.y>=T&&M.x<=P){var B=F?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||P-M.x)[0],U=y([JSON.parse(JSON.stringify(f))],this.posX+this.margin[3],-O+T+this.ctx.prevPageLastElemOffset)[0],z=F&&(E>C||E<I)&&p.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],R,D,null).clip().discardPath()),this.pdf.text(B,U.x,U.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),z&&this.pdf.restoreGraphicsState()}}else M.y<k&&(this.ctx.prevPageLastElemOffset+=k-M.y);e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=m)}else e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),m=this.lineWidth,this.lineWidth=m*e.scale),this.pdf.text(e.text,i.x+this.posX,i.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=m)},T=function(e,t,s,i){s=s||0,i=i||0,this.pdf.internal.out(n(e+s)+" "+r(t+i)+" l")},j=function(e,t,n){return this.pdf.lines(e,t,n,null,null)},k=function(e,n,r,a,o,l,c,d){this.pdf.internal.out([t(s(r+e)),t(i(a+n)),t(s(o+e)),t(i(l+n)),t(s(c+e)),t(i(d+n)),"c"].join(" "))},D=function(e,t,n,r){for(var s=2*Math.PI,i=Math.PI/2;t>n;)t-=s;var a=Math.abs(n-t);a<s&&r&&(a=s-a);for(var o=[],l=r?-1:1,c=t;a>1e-5;){var d=c+l*Math.min(a,i);o.push(P.call(this,e,c,d)),a-=Math.abs(d-c),c=d}return o},P=function(e,t,n){var r=(n-t)/2,s=e*Math.cos(r),i=e*Math.sin(r),a=s,o=-i,l=a*a+o*o,c=l+a*s+o*i,d=4/3*(Math.sqrt(2*l*c)-c)/(a*i-o*s),u=a-d*o,h=o+d*a,m=u,f=-h,p=r+t,g=Math.cos(p),x=Math.sin(p);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:u*g-h*x,y2:u*x+h*g,x3:m*g-f*x,y3:m*x+f*g,x4:e*Math.cos(n),y4:e*Math.sin(n)}},R=function(e){return 180*e/Math.PI},O=function(e,t,n,r,s,i){var a=e+.5*(n-e),l=t+.5*(r-t),c=s+.5*(n-s),d=i+.5*(r-i),u=Math.min(e,s,a,c),h=Math.max(e,s,a,c),m=Math.min(t,i,l,d),f=Math.max(t,i,l,d);return new o(u,m,h-u,f-m)},L=function(e,t,n,r,s,i,a,l){var c,d,u,h,m,f,p,g,x,y,b,w,v,N,S=n-e,A=r-t,_=s-n,C=i-r,I=a-s,E=l-i;for(d=0;d<41;d++)x=(p=(u=e+(c=d/40)*S)+c*((m=n+c*_)-u))+c*(m+c*(s+c*I-m)-p),y=(g=(h=t+c*A)+c*((f=r+c*C)-h))+c*(f+c*(i+c*E-f)-g),0==d?(b=x,w=y,v=x,N=y):(b=Math.min(b,x),w=Math.min(w,y),v=Math.max(v,x),N=Math.max(N,y));return new o(Math.round(b),Math.round(w),Math.round(v-b),Math.round(N-w))},M=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,n=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(Uo.API),function(e){var t=function(e){var t,n,r,s,i,a,o,l,c,d;for(/[^\x00-\xFF]/.test(e),n=[],r=0,s=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;s>r;r+=4)0!==(i=(e.charCodeAt(r)<<24)+(e.charCodeAt(r+1)<<16)+(e.charCodeAt(r+2)<<8)+e.charCodeAt(r+3))?(a=(i=((i=((i=((i=(i-(d=i%85))/85)-(c=i%85))/85)-(l=i%85))/85)-(o=i%85))/85)%85,n.push(a+33,o+33,l+33,c+33,d+33)):n.push(122);return function(e,t){for(var n=t;n>0;n--)e.pop()}(n,t.length),String.fromCharCode.apply(String,n)+"~>"},n=function(e){var t,n,r,s,i,a=String,o="length",l=255,c="charCodeAt",d="slice",u="replace";for(e[d](-2),e=e[d](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),r=[],s=0,i=(e+=t="uuuuu"[d](e[o]%5||5))[o];i>s;s+=5)n=52200625*(e[c](s)-33)+614125*(e[c](s+1)-33)+7225*(e[c](s+2)-33)+85*(e[c](s+3)-33)+(e[c](s+4)-33),r.push(l&n>>24,l&n>>16,l&n>>8,l&n);return function(e,t){for(var n=t;n>0;n--)e.pop()}(r,t[o]),a.fromCharCode.apply(a,r)},r=function(e){return e.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">"},s=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var n="",r=0;r<e.length;r+=2)n+=String.fromCharCode("0x"+(e[r]+e[r+1]));return n},i=function(e){for(var t=new Uint8Array(e.length),n=e.length;n--;)t[n]=e.charCodeAt(n);return(t=Dn(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,a){var o=0,l=e||"",c=[];for("string"==typeof(a=a||[])&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":l=n(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=s(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=r(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=i(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(Uo.API),(Ql=Uo.API).loadFile=function(e,t,n){return function(e,t,n){t=!1!==t,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(e,t,n){var r=new XMLHttpRequest,s=0,i=function(e){var t=e.length,n=[],r=String.fromCharCode;for(s=0;s<t;s+=1)n.push(r(255&e.charCodeAt(s)));return n.join("")};if(r.open("GET",e,!t),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(r.onload=function(){200===r.status?n(i(this.responseText)):n(void 0)}),r.send(null),t&&200===r.status)return i(r.responseText)}(e,t,n)}catch(ln){}return r}(e,t,n)},Ql.loadImageFile=Ql.loadFile,function(e){function t(){return(ao.html2canvas?Promise.resolve(ao.html2canvas):n.e(239).then(n.t.bind(n,5239,23))).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function r(){return(ao.DOMPurify?Promise.resolve(ao.DOMPurify):n.e(977).then(n.bind(n,7977))).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var s=function(e){var t=(0,Yt.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},i=function(e,t){var n=document.createElement(e);for(var r in t.className&&(n.className=t.className),t.innerHTML&&t.dompurify&&(n.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)n.style[r]=t.style[r];return n},a=function e(t,n){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),s=t.firstChild;s;s=s.nextSibling)!0!==n&&1===s.nodeType&&"SCRIPT"===s.nodeName||r.appendChild(e(s,n));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft},!0)),r},o=function e(t){var n=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),r=e.convert(Promise.resolve(),n);return(r=r.setProgress(1,e,1,[e])).set(t)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(e,t){return e.__proto__=t||o.prototype,e},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(s(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e),t){case"string":return this.then(r).then(function(t){return this.set({src:i("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},o.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,s=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete s.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=n,n)for(var i=0;i<n.length;++i){var a=n[i],o=a.src.find(function(e){return"truetype"===e.format});o&&t.addFont(o.url,a.ref.name,a.ref.style)}return s.windowHeight=s.windowHeight||0,s.windowHeight=0==s.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):s.windowHeight,t.context2d.save(!0),e(this.prop.container,s)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(e,t,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},o.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},o.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},o.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(e){if("object"!==s(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in o.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},o.prototype.get=function(e,t){return this.then(function(){var n=e in o.template.prop?this.prop[e]:this.opt[e];return t?t(n):n})},o.prototype.setMargin=function(e){return this.then(function(){switch(s(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},o.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||Uo.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},o.prototype.setProgress=function(e,t,n,r){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(e,t,n,r){return this.setProgress(e?this.progress.val+e:null,t||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},o.prototype.then=function(e,t){var n=this;return this.thenCore(e,t,function(e,t){return n.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return n.updateProgress(null,e),t}).then(e,t).then(function(e){return n.updateProgress(1),e})})},o.prototype.thenCore=function(e,t,n){n=n||Promise.prototype.then;var r=this;e&&(e=e.bind(r)),t&&(t=t.bind(r));var s=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?r:o.convert(Object.assign({},r),Promise.prototype),i=n.call(s,e,t);return o.convert(i,r.__proto__)},o.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},o.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},o.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return o.convert(t,this)},o.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},o.prototype.error=function(e){return this.then(function(){throw new Error(e)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Uo.getPageSize=function(e,t,n){if("object"===(0,Yt.A)(e)){var r=e;e=r.orientation,t=r.unit||t,n=r.format||n}t=t||"mm",n=n||"a4",e=(""+(e||"P")).toLowerCase();var s,i=(""+n).toLowerCase(),a={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":s=1;break;case"mm":s=72/25.4;break;case"cm":s=72/2.54;break;case"in":s=72;break;case"px":s=.75;break;case"pc":case"em":s=12;break;case"ex":s=6;break;default:throw"Invalid unit: "+t}var o,l=0,c=0;if(a.hasOwnProperty(i))l=a[i][1]/s,c=a[i][0]/s;else try{l=n[1],c=n[0]}catch(fo){throw new Error("Invalid format: "+n)}if("p"===e||"portrait"===e)e="p",c>l&&(o=c,c=l,l=o);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>c&&(o=c,c=l,l=o)}return{width:c,height:l,unit:t,k:s,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(Pl):null;var n=new o(t);return t.worker?n:n.from(e).doCallback()}}(Uo.API),Uo.API.addJS=function(e){return Hl=e,this.internal.events.subscribe("postPutResources",function(){zl=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(zl+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),ql=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Hl+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==zl&&void 0!==ql&&this.internal.out("/Names <</JavaScript "+zl+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),s=0;s<r.length;s++){var i=r[s],a=n.exec(i);if(null!=a){var o=a[1];e.internal.newObjectDeferredBegin(o,!1)}e.internal.write(i)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(s=0;s<l;s++){var d=e.internal.newObject();c.push(d);var u=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var h=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<c.length;s++)e.internal.write("(page_"+(s+1)+")"+c[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+h+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,n){var r={title:t,options:n,children:[]};return null==e&&(e=this.root),e.children.push(r),r},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var n=0;n<t.children.length;n++)this.genIds_r(t.children[n])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<t.children.length;r++){var s=t.children[r];this.objStart(s),this.line("/Title "+this.makeString(s.title)),this.line("/Parent "+this.makeRef(t)),r>0&&this.line("/Prev "+this.makeRef(t.children[r-1])),r<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[r+1])),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1])));var i=this.count=this.count_r({count:0},s);if(i>0&&this.line("/Count "+i),s.options&&s.options.pageNumber){var a=e.internal.getPageInfo(s.options.pageNumber);this.line("/Dest ["+a.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var o=0;o<t.children.length;o++)this.renderItems(t.children[o])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var n=0;n<t.children.length;n++)e.count++,this.count_r(e,t.children[n]);return e.count}}])}(Uo.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,n,r,s,i,a){var o,l=this.decode.DCT_DECODE,c=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=i||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,o=function(e){for(var n,r=256*e.charCodeAt(4)+e.charCodeAt(5),s=e.length,i={width:0,height:0,numcomponents:1},a=4;a<s;a+=2){if(a+=r,-1!==t.indexOf(e.charCodeAt(a+1))){n=256*e.charCodeAt(a+5)+e.charCodeAt(a+6),i={width:256*e.charCodeAt(a+7)+e.charCodeAt(a+8),height:n,numcomponents:e.charCodeAt(a+9)};break}r=256*e.charCodeAt(a+2)+e.charCodeAt(a+3)}return i}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),o.numcomponents){case 1:a=this.color_spaces.DEVICE_GRAY;break;case 4:a=this.color_spaces.DEVICE_CMYK;break;case 3:a=this.color_spaces.DEVICE_RGB}c={data:e,width:o.width,height:o.height,colorSpace:a,bitsPerComponent:8,filter:l,index:n,alias:r}}return c}}(Uo.API),Uo.API.processPNG=function(e,t,n,r){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var s,i=function(e,t){return new so(e,t).decode()}(e,{checkCrc:!0}),a=i.width,o=i.height,l=i.channels,c=i.palette,d=i.depth;s=c&&1===l?function(e){for(var t=e.width,n=e.height,r=e.data,s=e.palette,i=e.depth,a=!1,o=[],l=[],c=void 0,d=!1,u=0,h=0;h<s.length;h++){var m=On(s[h],4),f=m[0],p=m[1],g=m[2],x=m[3];o.push(f,p,g),null!=x&&(0===x?(u++,l.length<1&&l.push(h)):x<255&&(d=!0))}if(d||u>1){a=!0,l=void 0;var y=t*n;c=new Uint8Array(y);for(var b=new DataView(r.buffer),w=0;w<y;w++){var v=On(s[ic(b,w,i)],4)[3];c[w]=v}}else 0===u&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:a?8:void 0,colorBytes:r,alphaBytes:c,needSMask:a,palette:o,mask:l}}(i):2===l||4===l?function(e){for(var t=e.data,n=e.width,r=e.height,s=e.channels,i=e.depth,a=2===s?"DeviceGray":"DeviceRGB",o=s-1,l=n*r,c=o,d=l*c,u=1*l,h=Math.ceil(d*i/8),m=Math.ceil(u*i/8),f=new Uint8Array(h),p=new Uint8Array(m),g=new DataView(t.buffer),x=new DataView(f.buffer),y=new DataView(p.buffer),b=!1,w=0;w<l;w++){for(var v=w*s,N=0;N<c;N++)ac(x,ic(g,v+N,i),w*c+N,i);var S=ic(g,v+c,i);S<(1<<i)-1&&(b=!0),ac(y,S,1*w,i)}return{colorSpace:a,colorsPerPixel:o,sMaskBitsPerComponent:b?i:void 0,colorBytes:f,alphaBytes:p,needSMask:b}}(i):function(e){var t=e.data,n=1===e.channels?"DeviceGray":"DeviceRGB";return{colorSpace:n,colorsPerPixel:"DeviceGray"===n?1:3,colorBytes:t instanceof Uint16Array?function(e){for(var t=e.length,n=new Uint8Array(2*t),r=new DataView(n.buffer,n.byteOffset,n.byteLength),s=0;s<t;s++)r.setUint16(2*s,e[s],!1);return n}(t):t,needSMask:!1}}(i);var u,h,m,f=s,p=f.colorSpace,g=f.colorsPerPixel,x=f.sMaskBitsPerComponent,y=f.colorBytes,b=f.alphaBytes,w=f.needSMask,v=f.palette,N=f.mask,S=null;return r!==Uo.API.image_compression.NONE?(S=function(e){var t;switch(e){case Uo.API.image_compression.FAST:t=11;break;case Uo.API.image_compression.MEDIUM:t=13;break;case Uo.API.image_compression.SLOW:t=14;break;default:t=12}return t}(r),u=this.decode.FLATE_DECODE,h="/Predictor ".concat(S," /Colors ").concat(g," /BitsPerComponent ").concat(d," /Columns ").concat(a),e=Zl(y,Math.ceil(a*g*d/8),g,d,r),w&&(m=Zl(b,Math.ceil(a*x/8),1,x,r))):(u=void 0,h=void 0,e=y,w&&(m=b)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:n,data:e,index:t,filter:u,decodeParameters:h,transparency:N,palette:v,sMask:m,predictor:S,width:a,height:o,bitsPerComponent:d,sMaskBitsPerComponent:x,colorSpace:p}}},function(e){e.processGIF89A=function(t,n,r,s){var i=new lc(t),a=i.width,o=i.height,l=[];i.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:a,height:o},d=new dc(100).encode(c,100);return e.processJPEG.call(this,d,n,r,s)},e.processGIF87A=e.processGIF89A}(Uo.API),uc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:r,blue:n,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},uc.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(n){lo.log("bit decode error:"+n)}},uc.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),n=t%4;for(e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,s=0;s<t;s++)for(var i=this.datav.getUint8(this.pos++,!0),a=r*this.width*4+8*s*4,o=0;o<8&&8*s+o<this.width;o++){var l=this.palette[i>>7-o&1];this.data[a+4*o]=l.blue,this.data[a+4*o+1]=l.green,this.data[a+4*o+2]=l.red,this.data[a+4*o+3]=255}0!==n&&(this.pos+=4-n)}},uc.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<e;s++){var i=this.datav.getUint8(this.pos++,!0),a=r*this.width*4+2*s*4,o=i>>4,l=15&i,c=this.palette[o];if(this.data[a]=c.blue,this.data[a+1]=c.green,this.data[a+2]=c.red,this.data[a+3]=255,2*s+1>=this.width)break;c=this.palette[l],this.data[a+4]=c.blue,this.data[a+4+1]=c.green,this.data[a+4+2]=c.red,this.data[a+4+3]=255}0!==t&&(this.pos+=4-t)}},uc.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+4*r;if(s<this.palette.length){var a=this.palette[s];this.data[i]=a.red,this.data[i+1]=a.green,this.data[i+2]=a.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}0!==e&&(this.pos+=4-e)}},uc.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(i&t)/t*255|0,o=(i>>5&t)/t*255|0,l=(i>>10&t)/t*255|0,c=i>>15?255:0,d=r*this.width*4+4*s;this.data[d]=l,this.data[d+1]=o,this.data[d+2]=a,this.data[d+3]=c}this.pos+=e}},uc.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,l=(a>>5&n)/n*255|0,c=(a>>11)/t*255|0,d=s*this.width*4+4*i;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=o,this.data[d+3]=255}this.pos+=e}},uc.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*n;this.data[a]=i,this.data[a+1]=s,this.data[a+2]=r,this.data[a+3]=255}this.pos+=this.width%4}},uc.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;this.data[o]=i,this.data[o+1]=s,this.data[o+2]=r,this.data[o+3]=a}},uc.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,n,r,s){var i=new uc(t,!1),a=i.width,o=i.height,l={data:i.getData(),width:a,height:o},c=new dc(100).encode(l,100);return e.processJPEG.call(this,c,n,r,s)}}(Uo.API),hc.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,n,r,s){var i=new hc(t),a=i.width,o=i.height,l={data:i.getData(),width:a,height:o},c=new dc(100).encode(l,100);return e.processJPEG.call(this,c,n,r,s)}}(Uo.API),Uo.API.processRGBA=function(e,t,n){for(var r=e.data,s=r.length,i=new Uint8Array(s/4*3),a=new Uint8Array(s/4),o=0,l=0,c=0;c<s;c+=4){var d=r[c],u=r[c+1],h=r[c+2],m=r[c+3];i[o++]=d,i[o++]=u,i[o++]=h,a[l++]=m}var f=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:f,index:t,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Uo.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Vl=Uo.API,Wl=Vl.getCharWidthsArray=function(e,t){var n,r,s=(t=t||{}).font||this.internal.getFont(),i=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:s.metadata.Unicode.widths,l=o.fof?o.fof:1,c=t.kerning?t.kerning:s.metadata.Unicode.kerning,d=c.fof?c.fof:1,u=!1!==t.doKerning,h=0,m=e.length,f=0,p=o[0]||l,g=[];for(n=0;n<m;n++)r=e.charCodeAt(n),"function"==typeof s.metadata.widthOfString?g.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(r))+a*(1e3/i)||0)/1e3):(h=u&&"object"===(0,Yt.A)(c[r])&&!isNaN(parseInt(c[r][f],10))?c[r][f]/d:0,g.push((o[r]||p)/l+h)),f=r;return g},Gl=Vl.getStringUnitWidth=function(e,t){var n=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return Vl.processArabic&&(e=Vl.processArabic(e)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(e,n,s)/n:Wl.apply(this,arguments).reduce(function(e,t){return e+t},0)},Yl=function(e,t,n,r){for(var s=[],i=0,a=e.length,o=0;i!==a&&o+t[i]<n;)o+=t[i],i++;s.push(e.slice(0,i));var l=i;for(o=0;i!==a;)o+t[i]>r&&(s.push(e.slice(l,i)),o=0,l=i),o+=t[i],i++;return l!==i&&s.push(e.slice(l,i)),s},Xl=function(e,t,n){n||(n={});var r,s,i,a,o,l,c,d=[],u=[d],h=n.textIndent||0,m=0,f=0,p=e.split(" "),g=Wl.apply(this,[" ",n])[0];if(l=-1===n.lineIndent?p[0].length+2:n.lineIndent||0){var x=Array(l).join(" "),y=[];p.map(function(e){(e=e.split(/\s*\n/)).length>1?y=y.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):y.push(e[0])}),p=y,l=Gl.apply(this,[x,n])}for(i=0,a=p.length;i<a;i++){var b=0;if(r=p[i],l&&"\n"==r[0]&&(r=r.substr(1),b=1),h+m+(f=(s=Wl.apply(this,[r,n])).reduce(function(e,t){return e+t},0))>t||b){if(f>t){for(o=Yl.apply(this,[r,s,t-(h+m),t]),d.push(o.shift()),d=[o.pop()];o.length;)u.push([o.shift()]);f=s.slice(r.length-(d[0]?d[0].length:0)).reduce(function(e,t){return e+t},0)}else d=[r];u.push(d),h=f+l,m=g}else d.push(r),h+=m+f,m=g}return c=l?function(e,t){return(t?x:"")+e.join(" ")}:function(e){return e.join(" ")},u.map(c)},Vl.splitTextToSize=function(e,t,n){var r,s=(n=n||{}).fontSize||this.internal.getFontSize(),i=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle),n="Unicode";return t.metadata[n]?{widths:t.metadata[n].widths||{0:1},kerning:t.metadata[n].kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(e)?e:String(e).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/s;i.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/s:0,i.lineIndent=n.lineIndent;var o,l,c=[];for(o=0,l=r.length;o<l;o++)c=c.concat(Xl.apply(this,[r[o],a,i]));return c},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",n="klmnopqrstuvwxyz",r={},s={},i=0;i<16;i++)r[n[i]]=t[i],s[t[i]]=n[i];var a=function(e){return"0x"+parseInt(e,10).toString(16)},o=e.__fontmetrics__.compress=function(e){var t,n,r,i,l=["{"];for(var c in e){if(t=e[c],isNaN(parseInt(c,10))?n="'"+c+"'":(c=parseInt(c,10),n=(n=a(c).slice(2)).slice(0,-1)+s[n.slice(-1)]),"number"==typeof t)t<0?(r=a(t).slice(3),i="-"):(r=a(t).slice(2),i=""),r=i+r.slice(0,-1)+s[r.slice(-1)];else{if("object"!==(0,Yt.A)(t))throw new Error("Don't know what to do with value type "+(0,Yt.A)(t)+".");r=o(t)}l.push(n+r)}return l.push("}"),l.join("")},l=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,n,s,i,a={},o=1,l=a,c=[],d="",u="",h=e.length-1,m=1;m<h;m+=1)"'"==(i=e[m])?t?(s=t.join(""),t=void 0):t=[]:t?t.push(i):"{"==i?(c.push([l,s]),l={},s=void 0):"}"==i?((n=c.pop())[0][n[1]]=l,s=void 0,l=n[0]):"-"==i?o=-1:void 0===s?r.hasOwnProperty(i)?(d+=r[i],s=parseInt(d,16)*o,o=1,d=""):d+=i:r.hasOwnProperty(i)?(u+=r[i],l[s]=parseInt(u,16)*o,o=1,s=void 0,u=""):u+=i;return a},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},u={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,n=u.Unicode[t.postScriptName];n&&(t.metadata.Unicode={},t.metadata.Unicode.widths=n.widths,t.metadata.Unicode.kerning=n.kerning);var r=d.Unicode[t.postScriptName];r&&(t.metadata.Unicode.encoding=r,t.encoding=r.codePages[0])}])}(Uo.API),function(e){var t=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n};e.API.events.push(["addFont",function(n){var r=void 0,s=n.font,i=n.instance;if(!s.isStandardFont){if(void 0===i)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if("string"!=typeof(r=!1===i.existsFileInVFS(s.postScriptName)?i.loadFile(s.postScriptName):i.getFileFromVFS(s.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?t(r):t(po(r)),n.metadata=e.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(s,r)}}])}(Uo),Uo.API.addSvgAsImage=function(e,t,r,s,i,a,o,l){if(isNaN(t)||isNaN(r))throw lo.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(i))throw lo.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=i;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},h=this;return(ao.canvg?Promise.resolve(ao.canvg):n.e(455).then(n.bind(n,8455))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e}).then(function(t){return t.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(u)}).then(function(){h.addImage(c.toDataURL("image/jpeg",1),t,r,s,i,o,l)})},Uo.API.putTotalPages=function(e){var t,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),n=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var s=0;s<this.internal.pages[r].length;s++)this.internal.pages[r][s]=this.internal.pages[r][s].replace(t,n);return this},Uo.API.viewerPreferences=function(e,t){var n;e=e||{},t=t||!1;var r,s,i,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),l=[],c=0,d=0,u=0;function h(e,t){var n,r=!1;for(n=0;n<e.length;n+=1)e[n]===t&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var m=o.length;for(u=0;u<m;u+=1)n[o[u]].value=n[o[u]].defaultValue,n[o[u]].explicitSet=!1}if("object"===(0,Yt.A)(e))for(s in e)if(i=e[s],h(o,s)&&void 0!==i){if("boolean"===n[s].type&&"boolean"==typeof i)n[s].value=i;else if("name"===n[s].type&&h(n[s].valueSet,i))n[s].value=i;else if("integer"===n[s].type&&Number.isInteger(i))n[s].value=i;else if("array"===n[s].type){for(c=0;c<i.length;c+=1)if(r=!0,1===i[c].length&&"number"==typeof i[c][0])l.push(String(i[c]-1));else if(i[c].length>1){for(d=0;d<i[c].length;d+=1)"number"!=typeof i[c][d]&&(r=!1);!0===r&&l.push([i[c][0]-1,i[c][1]-1].join(" "))}n[s].value="["+l.join(" ")+"]"}else n[s].value=n[s].defaultValue;n[s].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in n)!0===n[e].explicitSet&&("name"===n[e].type?t.push("/"+e+" /"+n[e].value):t.push("/"+e+" "+n[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(e)),r=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),i=unescape(encodeURIComponent("</x:xmpmeta>")),a=n.length+r.length+s.length+t.length+i.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+a+" >>"),this.internal.write("stream"),this.internal.write(t+n+r+s+i),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,r){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",t)),this}}(Uo.API),function(e){var t=e.API,n=t.pdfEscape16=function(e,t){for(var n,r=t.metadata.Unicode.widths,s=["","0","00","000","0000"],i=[""],a=0,o=e.length;a<o;++a){if(n=t.metadata.characterToGlyph(e.charCodeAt(a)),t.metadata.glyIdsUsed.push(n),t.metadata.toUnicode[n]=e.charCodeAt(a),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(t.metadata.widthOfGlyph(n),10)])),"0"==n)return i.join("");n=n.toString(16),i.push(s[4-n.length],n)}return i.join("")},r=function(e){var t,n,r,s,i,a,o;for(i="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],a=0,o=(n=Object.keys(e).sort(function(e,t){return e-t})).length;a<o;a++)t=n[a],r.length>=100&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(s=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),r.push("<"+t+"><"+s+">"));return r.length&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),i+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var n=t.font,s=t.out,i=t.newObject,a=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"Identity-H"===n.encoding){for(var o=n.metadata.Unicode.widths,l=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),c="",d=0;d<l.length;d++)c+=String.fromCharCode(l[d]);var u=i();a({data:c,addLength1:!0,objectId:u}),s("endobj");var h=i();a({data:r(n.metadata.toUnicode),addLength1:!0,objectId:h}),s("endobj");var m=i();s("<<"),s("/Type /FontDescriptor"),s("/FontName /"+Ro(n.fontName)),s("/FontFile2 "+u+" 0 R"),s("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),s("/Flags "+n.metadata.flags),s("/StemV "+n.metadata.stemV),s("/ItalicAngle "+n.metadata.italicAngle),s("/Ascent "+n.metadata.ascender),s("/Descent "+n.metadata.decender),s("/CapHeight "+n.metadata.capHeight),s(">>"),s("endobj");var f=i();s("<<"),s("/Type /Font"),s("/BaseFont /"+Ro(n.fontName)),s("/FontDescriptor "+m+" 0 R"),s("/W "+e.API.PDFObject.convert(o)),s("/CIDToGIDMap /Identity"),s("/DW 1000"),s("/Subtype /CIDFontType2"),s("/CIDSystemInfo"),s("<<"),s("/Supplement 0"),s("/Registry (Adobe)"),s("/Ordering ("+n.encoding+")"),s(">>"),s(">>"),s("endobj"),n.objectNumber=i(),s("<<"),s("/Type /Font"),s("/Subtype /Type0"),s("/ToUnicode "+h+" 0 R"),s("/BaseFont /"+Ro(n.fontName)),s("/Encoding /"+n.encoding),s("/DescendantFonts ["+f+" 0 R]"),s(">>"),s("endobj"),n.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var n=t.font,s=t.out,i=t.newObject,a=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var o=n.metadata.rawData,l="",c=0;c<o.length;c++)l+=String.fromCharCode(o[c]);var d=i();a({data:l,addLength1:!0,objectId:d}),s("endobj");var u=i();a({data:r(n.metadata.toUnicode),addLength1:!0,objectId:u}),s("endobj");var h=i();s("<<"),s("/Descent "+n.metadata.decender),s("/CapHeight "+n.metadata.capHeight),s("/StemV "+n.metadata.stemV),s("/Type /FontDescriptor"),s("/FontFile2 "+d+" 0 R"),s("/Flags 96"),s("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),s("/FontName /"+Ro(n.fontName)),s("/ItalicAngle "+n.metadata.italicAngle),s("/Ascent "+n.metadata.ascender),s(">>"),s("endobj"),n.objectNumber=i();for(var m=0;m<n.metadata.hmtx.widths.length;m++)n.metadata.hmtx.widths[m]=parseInt(n.metadata.hmtx.widths[m]*(1e3/n.metadata.head.unitsPerEm));s("<</Subtype/TrueType/Type/Font/ToUnicode "+u+" 0 R/BaseFont/"+Ro(n.fontName)+"/FontDescriptor "+h+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),s("endobj"),n.isAlreadyPutted=!0}}(t)}]);var s=function(e){var t,r=e.text||"",s=e.x,i=e.y,a=e.options||{},o=e.mutex||{},l=o.pdfEscape,c=o.activeFontKey,d=o.fonts,u=c,h="",m=0,f="",p=d[u].encoding;if("Identity-H"!==d[u].encoding)return{text:r,x:s,y:i,options:a,mutex:o};for(f=r,u=c,Array.isArray(r)&&(f=r[0]),m=0;m<f.length;m+=1)d[u].metadata.hasOwnProperty("cmap")&&(t=d[u].metadata.cmap.unicode.codeMap[f[m].charCodeAt(0)]),t||f[m].charCodeAt(0)<256&&d[u].metadata.hasOwnProperty("Unicode")?h+=f[m]:h+="";var g="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===p?g=l(h,u).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===p&&(g=n(h,d[u])),o.isHex=!0,{text:g,x:s,y:i,options:a,mutex:o}};t.events.push(["postProcessText",function(e){var t=e.text||"",n=[],r={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var i=0;for(i=0;i<t.length;i+=1)Array.isArray(t[i])&&3===t[i].length?n.push([s(Object.assign({},r,{text:t[i][0]})).text,t[i][1],t[i][2]]):n.push(s(Object.assign({},r,{text:t[i]})).text);e.text=n}else e.text=s(Object.assign({},r,{text:t})).text}])}(Uo),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(Uo.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var n,r,s,i,a,o,l,c=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],h={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},f=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],p=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,x=0;this.__bidiEngine__={};var y=function(e){var t=e.charCodeAt(),n=t>>8,r=m[n];return void 0!==r?c[256*r+(255&t)]:252===n||253===n?"AL":p.test(n)?"L":8===n?"R":"N"},b=function(e){for(var t,n=0;n<e.length;n++){if("L"===(t=y(e.charAt(n))))return!1;if("R"===t)return!0}return!1},w=function(e,t,a,o){var l,c,d,u,h=t[o];switch(h){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(h="AN");break;case"AL":g=!0,h="R";break;case"WS":case"BN":h="N";break;case"CS":o<1||o+1>=t.length||"EN"!==(l=a[o-1])&&"AN"!==l||"EN"!==(c=t[o+1])&&"AN"!==c?h="N":g&&(c="AN"),h=c===l?c:"N";break;case"ES":h="EN"===(l=o>0?a[o-1]:"B")&&o+1<t.length&&"EN"===t[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===a[o-1]){h="EN";break}if(g){h="N";break}for(d=o+1,u=t.length;d<u&&"ET"===t[d];)d++;h=d<u&&"EN"===t[d]?"EN":"N";break;case"NSM":if(s&&!i){for(u=t.length,d=o+1;d<u&&"NSM"===t[d];)d++;if(d<u){var m=e[o],f=m>=1425&&m<=2303||64286===m;if(l=t[d],f&&("R"===l||"AL"===l)){h="R";break}}}h=o<1||"B"===(l=t[o-1])?"N":a[o-1];break;case"B":g=!1,n=!0,h=x;break;case"S":r=!0,h="N"}return h},v=function(e,t,n){var r=e.split("");return n&&N(r,n,{hiLevel:x}),r.reverse(),t&&t.reverse(),r.join("")},N=function(e,t,s){var i,a,o,l,c,m=-1,f=e.length,p=0,b=[],v=x?u:d,N=[];for(g=!1,n=!1,r=!1,a=0;a<f;a++)N[a]=y(e[a]);for(o=0;o<f;o++){if(c=p,b[o]=w(e,N,b,o),i=240&(p=v[c][h[b[o]]]),p&=15,t[o]=l=v[p][5],i>0)if(16===i){for(a=m;a<o;a++)t[a]=1;m=-1}else m=-1;if(v[p][6])-1===m&&(m=o);else if(m>-1){for(a=m;a<o;a++)t[a]=l;m=-1}"B"===N[o]&&(t[o]=0),s.hiLevel|=l}r&&function(e,t,n){for(var r=0;r<n;r++)if("S"===e[r]){t[r]=x;for(var s=r-1;s>=0&&"WS"===e[s];s--)t[s]=x}}(N,t,f)},S=function(e,t,r,s,i){if(!(i.hiLevel<e)){if(1===e&&1===x&&!n)return t.reverse(),void(r&&r.reverse());for(var a,o,l,c,d=t.length,u=0;u<d;){if(s[u]>=e){for(l=u+1;l<d&&s[l]>=e;)l++;for(c=u,o=l-1;c<o;c++,o--)a=t[c],t[c]=t[o],t[o]=a,r&&(a=r[c],r[c]=r[o],r[o]=a);u=l}u++}}},A=function(e,t,n){var r=e.split(""),s={hiLevel:x};return n||(n=[]),N(r,n,s),function(e,t,n){if(0!==n.hiLevel&&l)for(var r,s=0;s<e.length;s++)1===t[s]&&(r=f.indexOf(e[s]))>=0&&(e[s]=f[r+1])}(r,n,s),S(2,r,t,n,s),S(1,r,t,n,s),r.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,n){if(function(e,t){if(t)for(var n=0;n<e.length;n++)t[n]=n;void 0===i&&(i=b(e)),void 0===o&&(o=b(e))}(e,t),s||!a||o)if(s&&a&&i^o)x=i?1:0,e=v(e,t,n);else if(!s&&a&&o)x=i?1:0,e=A(e,t,n),e=v(e,t);else if(!s||i||a||o){if(s&&!a&&i^o)e=v(e,t),i?(x=0,e=A(e,t,n)):(x=1,e=A(e,t,n),e=v(e,t));else if(s&&i&&!a&&o)x=1,e=A(e,t,n),e=v(e,t);else if(!s&&!a&&i^o){var r=l;i?(x=1,e=A(e,t,n),x=0,l=!1,e=A(e,t,n),l=r):(x=0,e=A(e,t,n),e=v(e,t),x=1,l=!1,e=A(e,t,n),l=r,e=v(e,t))}}else x=0,e=A(e,t,n);else x=i?1:0,e=A(e,t,n);return e},this.__bidiEngine__.setOptions=function(e){e&&(s=e.isInputVisual,a=e.isOutputVisual,i=e.isInputRtl,o=e.isOutputRtl,l=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text;e.x,e.y;var r=e.options||{};e.mutex,r.lang;var s=[];if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(t)){var i=0;for(s=[],i=0;i<t.length;i+=1)"[object Array]"===Object.prototype.toString.call(t[i])?s.push([n.doBidiReorder(t[i][0]),t[i][1],t[i][2]]):s.push([n.doBidiReorder(t[i])]);e.text=s}else e.text=n.doBidiReorder(t);n.setOptions({isInputVisual:!0})}])}(Uo),Uo.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new fc(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Pc(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new pc(this.contents),this.head=new yc(this),this.name=new _c(this),this.cmap=new wc(this),this.toUnicode={},this.hhea=new vc(this),this.maxp=new Cc(this),this.hmtx=new Ic(this),this.post=new Sc(this),this.os2=new Nc(this),this.loca=new Dc(this),this.glyf=new Tc(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,n,r,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,n,r,s;for(s=[],t=0,n=(r=this.bbox).length;t<n;t++)e=r[t],s.push(Math.round(e*this.scaleFactor));return s}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(s=this.familyClass)||2===s||3===s||4===s||5===s||7===s,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,n){var r,s,i,a;for(i=0,s=0,a=(e=""+e).length;0<=a?s<a:s>a;s=0<=a?++s:--s)r=e.charCodeAt(s),i+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return i*(t/1e3)},e.prototype.lineHeight=function(e,t){var n;return null==t&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},e}();var mc,fc=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,n,r,s,i,a,o;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),s=this.readByte(),i=this.readByte(),a=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^s)+65536*(255^i)+256*(255^a)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*s+65536*i+256*a+o},e.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},e.prototype.write=function(e){var t,n,r,s;for(s=[],n=0,r=e.length;n<r;n++)t=e[n],s.push(this.writeByte(t));return s},e}(),pc=function(){var e;function t(e){var t,n,r;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var n,r,s,i,a,o,l,c,d,u,h,m,f;for(f in h=Object.keys(t).length,o=Math.log(2),d=16*Math.floor(Math.log(h)/o),i=Math.floor(d/o),c=16*h-d,(r=new fc).writeInt(this.scalarType),r.writeShort(h),r.writeShort(d),r.writeShort(i),r.writeShort(c),s=16*h,l=r.pos+s,a=null,m=[],t)for(u=t[f],r.writeString(f),r.writeInt(e(u)),r.writeInt(l),r.writeInt(u.length),m=m.concat(u),"head"===f&&(a=l),l+=u.length;l%4;)m.push(0),l++;return r.write(m),n=2981146554-e(r.data),r.pos=a+8,r.writeUInt32(n),r.data},e=function(e){var t,n,r,s;for(e=Ec.call(e);e.length%4;)e.push(0);for(r=new fc(e),n=0,t=0,s=e.length;t<s;t=t+=4)n+=r.readUInt32();return 4294967295&n},t}(),gc={}.hasOwnProperty,xc=function(e,t){for(var n in t)gc.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};mc=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var yc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new fc).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),bc=function(){function e(e,t){var n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),d=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(h=e.readUInt16(),u=h/2,e.pos+=6,s=function(){var t,n;for(n=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)n.push(e.readUInt16());return n}(),e.pos+=2,f=function(){var t,n;for(n=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)n.push(e.readUInt16());return n}(),l=function(){var t,n;for(n=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)n.push(e.readUInt16());return n}(),c=function(){var t,n;for(n=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)n.push(e.readUInt16());return n}(),r=(this.length-e.pos+this.offset)/2,a=function(){var t,n;for(n=[],o=t=0;0<=r?t<r:t>r;o=0<=r?++t:--t)n.push(e.readUInt16());return n}(),o=g=0,y=s.length;g<y;o=++g)for(p=s[o],n=x=m=f[o];m<=p?x<=p:x>=p;n=m<=p?++x:--x)0===c[o]?i=n+l[o]:0!==(i=a[c[o]/2+(n-m)-(u-o)]||0)&&(i+=l[o]),this.codeMap[n]=65535&i}e.pos=d}return e.encode=function(e,t){var n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b,w,v,N,S,A,_,C,I,E,T,j,k,D,P,R,O,L,M,F,B,U,z,q,H,V,W,G,Y;switch(T=new fc,i=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(f=0,p=function(){var e=[];for(m=0;m<256;++m)e.push(0);return e}(),x={0:0},s={},j=0,R=i.length;j<R;j++)null==x[V=e[r=i[j]]]&&(x[V]=++f),s[r]={old:e[r],new:x[e[r]]},p[r]=x[e[r]];return T.writeUInt16(1),T.writeUInt16(0),T.writeUInt32(12),T.writeUInt16(0),T.writeUInt16(262),T.writeUInt16(0),T.write(p),{charMap:s,subtable:T.data,maxGlyphID:f+1};case"unicode":for(I=[],d=[],y=0,x={},n={},g=l=null,k=0,O=i.length;k<O;k++)null==x[w=e[r=i[k]]]&&(x[w]=++y),n[r]={old:w,new:x[w]},a=x[w]-r,null!=g&&a===l||(g&&d.push(g),I.push(r),l=a),g=r;for(g&&d.push(g),d.push(65535),I.push(65535),_=2*(A=I.length),S=2*Math.pow(Math.log(A)/Math.LN2,2),u=Math.log(S/2)/Math.LN2,N=2*A-S,o=[],v=[],h=[],m=D=0,L=I.length;D<L;m=++D){if(C=I[m],c=d[m],65535===C){o.push(0),v.push(0);break}if(C-(E=n[C].new)>=32768)for(o.push(0),v.push(2*(h.length+A-m)),r=P=C;C<=c?P<=c:P>=c;r=C<=c?++P:--P)h.push(n[r].new);else o.push(E-C),v.push(0)}for(T.writeUInt16(3),T.writeUInt16(1),T.writeUInt32(12),T.writeUInt16(4),T.writeUInt16(16+8*A+2*h.length),T.writeUInt16(0),T.writeUInt16(_),T.writeUInt16(S),T.writeUInt16(u),T.writeUInt16(N),q=0,M=d.length;q<M;q++)r=d[q],T.writeUInt16(r);for(T.writeUInt16(0),H=0,F=I.length;H<F;H++)r=I[H],T.writeUInt16(r);for(W=0,B=o.length;W<B;W++)a=o[W],T.writeUInt16(a);for(G=0,U=v.length;G<U;G++)b=v[G],T.writeUInt16(b);for(Y=0,z=h.length;Y<z;Y++)f=h[Y],T.writeUInt16(f);return{charMap:n,subtable:T.data,maxGlyphID:y+1}}},e}(),wc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new bc(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var n,r;return null==t&&(t="macroman"),n=bc.encode(e,t),(r=new fc).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(),vc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),Nc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),Sc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="post",e.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(n=e.readUInt16(),this.glyphNameIndex=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=function(){var t,n,r;for(r=[],s=t=0,n=this.file.maxp.numGlyphs;0<=n?t<n:t>n;s=0<=n?++t:--t)r.push(e.readUInt32());return r}.call(this)}},e}(),Ac=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},_c=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="name",e.prototype.parse=function(e){var t,n,r,s,i,a,o,l,c,d,u;for(e.pos=this.offset,e.readShort(),t=e.readShort(),a=e.readShort(),n=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+a+e.readShort()});for(o={},s=c=0,d=n.length;c<d;s=++c)r=n[s],e.pos=r.offset,l=e.readString(r.length),i=new Ac(l,r),null==o[u=r.nameID]&&(o[u]=[]),o[r.nameID].push(i);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(po){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(),Cc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),Ic=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,n,r,s,i,a,o;for(e.pos=this.offset,this.metrics=[],t=0,a=this.file.hhea.numberOfMetrics;0<=a?t<a:t>a;t=0<=a?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,s;for(s=[],t=n=0;0<=r?n<r:n>r;t=0<=r?++n:--n)s.push(e.readInt16());return s}(),this.widths=function(){var e,t,n,r;for(r=[],e=0,t=(n=this.metrics).length;e<t;e++)s=n[e],r.push(s.advance);return r}.call(this),n=this.widths[this.widths.length-1],o=[],t=i=0;0<=r?i<r:i>r;t=0<=r?++i:--i)o.push(this.widths.push(n));return o},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),Ec=[].slice,Tc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,n,r,s,i,a,o,l,c,d;return e in this.cache?this.cache[e]:(s=this.file.loca,t=this.file.contents,n=s.indexOf(e),0===(r=s.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+n,i=(a=new fc(t.read(r))).readShort(),l=a.readShort(),d=a.readShort(),o=a.readShort(),c=a.readShort(),this.cache[e]=-1===i?new kc(a,l,d,o,c):new jc(a,i,l,d,o,c),this.cache[e]))},e.prototype.encode=function(e,t,n){var r,s,i,a,o;for(i=[],s=[],a=0,o=t.length;a<o;a++)r=e[t[a]],s.push(i.length),r&&(i=i.concat(r.encode(n)));return s.push(i.length),{table:i,offsets:s}},e}(),jc=function(){function e(e,t,n,r,s,i){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=s,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),kc=function(){function e(e,t,n,r,s){var i,a;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;a=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&a;)i.pos+=1&a?4:2,128&a?i.pos+=8:64&a?i.pos+=4:8&a&&(i.pos+=2)}return e.prototype.encode=function(){var e,t,n;for(t=new fc(Ec.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),Dc=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return xc(e,mc),e.prototype.tag="loca",e.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=2)r.push(2*e.readUInt16());return r}.call(this):function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=4)r.push(e.readUInt32());return r}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,s=0,i=0;i<n.length;++i)if(n[i]=r,s<t.length&&t[s]==i){++s,n[i]=r;var a=this.offsets[i],o=this.offsets[i+1]-a;o>0&&(r+=o)}for(var l=new Array(4*n.length),c=0;c<n.length;++c)l[4*c+3]=255&n[c],l[4*c+2]=(65280&n[c])>>8,l[4*c+1]=(16711680&n[c])>>16,l[4*c]=(4278190080&n[c])>>24;return l},e}(),Pc=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,n,r,s;for(t in r=this.font.cmap.tables[0].codeMap,e={},s=this.subset)n=s[t],e[t]=r[n];return e},e.prototype.glyphsFor=function(e){var t,n,r,s,i,a,o;for(r={},i=0,a=e.length;i<a;i++)r[s=e[i]]=this.font.glyf.glyphFor(s);for(s in t=[],r)(null!=(n=r[s])?n.compound:void 0)&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(s in o=this.glyphsFor(t))n=o[s],r[s]=n;return r},e.prototype.encode=function(e,t){var n,r,s,i,a,o,l,c,d,u,h,m,f,p,g;for(r in n=wc.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(e),h={0:0},g=n.charMap)h[(o=g[r]).old]=o.new;for(m in u=n.maxGlyphID,i)m in h||(h[m]=u++);return c=function(e){var t,n;for(t in n={},e)n[e[t]]=t;return n}(h),d=Object.keys(c).sort(function(e,t){return e-t}),f=function(){var e,t,n;for(n=[],e=0,t=d.length;e<t;e++)a=d[e],n.push(c[a]);return n}(),s=this.font.glyf.encode(i,f,h),l=this.font.loca.encode(s.offsets,f),p={cmap:this.font.cmap.raw(),glyf:s.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(p["OS/2"]=this.font.os2.raw()),this.font.directory.encode(p)},e}();Uo.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(n){var r,s,i,a;if(Array.isArray(n))return"["+function(){var e,s,i;for(i=[],e=0,s=n.length;e<s;e++)r=n[e],i.push(t.convert(r));return i}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+e(n.getUTCFullYear(),4)+e(n.getUTCMonth(),2)+e(n.getUTCDate(),2)+e(n.getUTCHours(),2)+e(n.getUTCMinutes(),2)+e(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(s in i=["<<"],n)a=n[s],i.push("/"+s+" "+t.convert(a));return i.push(">>"),i.join("\n")}return""+n},t}();const Rc=e=>{let{onClose:n,onSubmit:r,existingCustomers:s=[],planLimitError:o="",onClearPlanLimitError:l}=e;const{state:c}=(0,i.nm)(),[d,u]=(0,t.useState)({name:"",mobileNumber:"",email:"",address:"",balanceDue:""}),[h,m]=(0,t.useState)(""),[f,p]=(0,t.useState)(""),g=e=>{const{name:t,value:n}=e.target;let r="mobileNumber"===t?It(n):n;"balanceDue"===t&&""===d.balanceDue&&"0"===n&&(r=""),u(e=>(0,a.A)((0,a.A)({},e),{},{[t]:"balanceDue"===t?""===r?"":parseFloat(r)||0:r})),!h||"mobileNumber"!==t&&"email"!==t||m(""),o&&l&&l(),f&&p("")};return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 px-3 sm:px-0",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] mx-auto p-0 flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-100",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Add New Customer"}),(0,Pe.jsx)("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=c.customers.filter(e=>!e.isDeleted).length,{maxCustomers:n}=(0,Je.ay)(c.currentPlan,c.currentPlanDetails);if(!(0,Je.sp)(t,c.currentPlan,c.currentPlanDetails)){var i;const e=n===1/0?"Unlimited":n,t=(null===(i=c.currentPlanDetails)||void 0===i?void 0:i.planName)||(c.currentPlan?"".concat(c.currentPlan.charAt(0).toUpperCase()).concat(c.currentPlan.slice(1)):"Current"),r="Your limit is full! You've reached the customer limit (".concat(e,") for the ").concat(t," plan. Upgrade your plan to add more customers.");return p(r),void(window.showToast&&window.showToast(r,"error",5e3))}if(p(""),!d.name.trim())return void alert("Please enter customer name");const o=It(d.mobileNumber),l=d.email.trim().toLowerCase();if(!o){const e="Please enter customer mobile number";return void(window.showToast?window.showToast(e,"error"):alert(e))}if(!Et(o)){const e="Please enter a valid 10-digit mobile number starting with 6-9.";return void(window.showToast?window.showToast(e,"error"):alert(e))}if(o||l){const e=s.find(e=>{const t=It(e.mobileNumber||e.phone||""),n=(e.email||"").trim().toLowerCase();return o&&t&&t===o||l&&n&&n===l});if(e){var u;const t="Duplicate customer detected\n\n".concat(e.name," \u0928\u093e\u092e \u0915\u093e \u090f\u0915 \u0917\u094d\u0930\u093e\u0939\u0915 \u092a\u0939\u0932\u0947 \u0938\u0947 \u092e\u094c\u091c\u0942\u0926 \u0939\u0948").concat(o?" (\u092e\u094b\u092c\u093e\u0907\u0932: ".concat(o,")"):"").concat(l?" (\u0908\u092e\u0947\u0932: ".concat(d.email.trim(),")"):"",". \u0915\u0943\u092a\u092f\u093e \u0928\u092f\u093e \u0935\u093f\u0935\u0930\u0923 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902\u0964");return m(t),void(null!==(u=window)&&void 0!==u&&u.showToast&&window.showToast(t,"warning",6e3))}}const h=parseFloat(d.balanceDue)||0,f=(0,a.A)((0,a.A)({},d),{},{mobileNumber:o,dueAmount:h,balanceDue:h});console.log("AddCustomerModal - Submitting customer data:",f),console.log("dueAmount:",f.dueAmount,"balanceDue:",f.balanceDue),r(f)},className:"flex-1 overflow-y-auto px-6 py-5 space-y-4",children:[(()=>{const e=c.customers.filter(e=>!e.isDeleted).length,{maxCustomers:t}=(0,Je.ay)(c.currentPlan,c.currentPlanDetails),n=t===1/0?"Unlimited":t,r=(0,Je.sp)(e,c.currentPlan,c.currentPlanDetails);return(0,Pe.jsxs)("div",{className:"rounded-lg border p-3 ".concat(r?"border-blue-200 bg-blue-50":"border-red-200 bg-red-50"),children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,Pe.jsx)("span",{className:"font-medium ".concat(r?"text-blue-700":"text-red-700"),children:"Customer Limit:"}),(0,Pe.jsxs)("span",{className:"font-semibold ".concat(r?"text-blue-900":"text-red-900"),children:[e," / ",n===1/0?"\u221e":n,!r&&" (Full)"]})]}),t!==1/0&&(0,Pe.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:(0,Pe.jsx)("div",{className:"h-2 rounded-full transition-all ".concat(r?"bg-blue-500":"bg-red-500"),style:{width:"".concat(Math.min(100,e/t*100),"%")}})})]})})(),(o||f)&&(0,Pe.jsx)("div",{className:"rounded-2xl border border-red-200 bg-gradient-to-r from-red-50 via-red-100 to-red-50 p-4 shadow-md",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-3",children:[(0,Pe.jsx)("span",{className:"mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-red-500/10 text-red-600",children:(0,Pe.jsx)(lt,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-semibold text-red-700",children:"Limit Full"}),(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-700 leading-relaxed",children:f||o})]})]})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-600 mb-1",children:"Customer Name *"}),(0,Pe.jsx)("input",{type:"text",id:"name",name:"name",value:d.name,onChange:g,className:"input-field",placeholder:"Enter customer name",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-600 mb-1",children:"Mobile Number *"}),(0,Pe.jsx)("input",{type:"tel",id:"mobileNumber",name:"mobileNumber",value:d.mobileNumber,onChange:g,className:"input-field",maxLength:10,placeholder:"Enter mobile number",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-600 mb-1",children:"Email (Optional)"}),(0,Pe.jsx)("input",{type:"email",id:"email",name:"email",value:d.email,onChange:g,className:"input-field",placeholder:"Enter email address"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-600 mb-1",children:"Address (Optional)"}),(0,Pe.jsx)("textarea",{id:"address",name:"address",value:d.address,onChange:g,rows:3,className:"input-field",placeholder:"Enter address"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"balanceDue",className:"block text-sm font-medium text-gray-600 mb-1",children:"Initial Balance Due (\u20b9)"}),(0,Pe.jsx)("input",{type:"number",id:"balanceDue",name:"balanceDue",value:d.balanceDue,onChange:g,step:"0.01",min:"0",className:"input-field",placeholder:"0.00"})]}),(0,Pe.jsxs)("div",{className:"sticky bottom-0 flex justify-end gap-3 pt-4 pb-1 bg-white",children:[(0,Pe.jsx)("button",{type:"button",onClick:n,className:"btn-secondary",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"btn-primary",children:"Save Customer"})]})]})]})})},Oc=e=>{var n,r;let{customer:s,onClose:i,onSubmit:o}=e;const[l,c]=(0,t.useState)({name:s.name||"",mobileNumber:It(s.mobileNumber||s.phone||""),email:s.email||"",address:s.address||"",balanceDue:null!==(n=null!==(r=s.balanceDue)&&void 0!==r?r:s.dueAmount)&&void 0!==n?n:0}),[d,u]=(0,t.useState)(""),h=e=>{const{name:t,value:n}=e.target;u(""),c(e=>{let r=n;return"balanceDue"===t?r=""===n?"":parseFloat(n)||0:"mobileNumber"===t&&(r=It(n)),(0,a.A)((0,a.A)({},e),{},{[t]:r})})};return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 px-3 sm:px-0",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] mx-auto p-0 flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-100",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Edit Customer"}),(0,Pe.jsx)("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!l.name.trim()){const e="Please enter customer name";return u(e),void(window.showToast&&window.showToast(e,"error"))}const t=It(l.mobileNumber);if(!t){const e="Please enter customer mobile number";return u(e),void(window.showToast&&window.showToast(e,"error"))}if(!Et(t)){const e="Please enter a valid 10-digit mobile number starting with 6-9.";return u(e),void(window.showToast&&window.showToast(e,"error"))}const n=parseFloat(l.balanceDue)||0,r=(0,a.A)((0,a.A)((0,a.A)({},s),l),{},{mobileNumber:t,dueAmount:n,balanceDue:n});o(r)},className:"flex-1 overflow-y-auto px-6 py-5 space-y-4",children:[d&&(0,Pe.jsxs)("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4 flex items-start gap-3 text-sm text-red-700",children:[(0,Pe.jsx)("span",{className:"mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-red-500/10 text-red-600",children:(0,Pe.jsx)(lt,{className:"h-4 w-4"})}),(0,Pe.jsx)("span",{children:d})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-600 mb-1",children:"Customer Name *"}),(0,Pe.jsx)("input",{type:"text",id:"name",name:"name",value:l.name,onChange:h,className:"input-field",placeholder:"Enter customer name",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-600 mb-1",children:"Mobile Number *"}),(0,Pe.jsx)("input",{type:"tel",id:"mobileNumber",name:"mobileNumber",value:l.mobileNumber,onChange:h,className:"input-field",maxLength:10,placeholder:"Enter mobile number",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-600 mb-1",children:"Email (Optional)"}),(0,Pe.jsx)("input",{type:"email",id:"email",name:"email",value:l.email,onChange:h,className:"input-field",placeholder:"Enter email address"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-600 mb-1",children:"Address (Optional)"}),(0,Pe.jsx)("textarea",{id:"address",name:"address",value:l.address,onChange:h,rows:3,className:"input-field",placeholder:"Enter address"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"balanceDue",className:"block text-sm font-medium text-gray-600 mb-1",children:"Balance Due (\u20b9)"}),(0,Pe.jsx)("input",{type:"number",id:"balanceDue",name:"balanceDue",value:l.balanceDue,onChange:h,step:"0.01",className:"input-field",placeholder:"0.00"})]}),(0,Pe.jsxs)("div",{className:"sticky bottom-0 flex justify-end gap-3 pt-4 pb-1 bg-white",children:[(0,Pe.jsx)("button",{type:"button",onClick:i,className:"btn-secondary",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Customer"})]})]})]})})},Lc=Ee("ArrowDownCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),Mc=Ee("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Fc=e=>{let{customer:n,onClose:r,onSubmit:s}=e;const[i,a]=(0,t.useState)(""),[o,l]=(0,t.useState)("theyGive");return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25)] w-full max-w-md border border-slate-200/60 my-auto max-h-[95vh] flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 pb-4 flex-shrink-0 border-b border-slate-200/60",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"Record Payment"}),(0,Pe.jsx)("button",{onClick:r,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"overflow-y-auto flex-1 p-6",children:[(0,Pe.jsxs)("div",{className:"mb-6 p-4 rounded-xl bg-gradient-to-br from-slate-50 to-white border border-slate-200/60",children:[(0,Pe.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Customer"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-slate-900",children:n.name}),(0,Pe.jsxs)("div",{className:"mt-3 pt-3 border-t border-slate-200/60",children:[(0,Pe.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Current Balance"}),(0,Pe.jsxs)("p",{className:"text-2xl font-bold ".concat((n.balanceDue||0)>=0?"text-slate-900":"text-green-600"),children:["\u20b9",(n.balanceDue||0).toFixed(2)]})]})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(i);t<=0?alert("Please enter a valid payment amount"):s(t,o)},className:"space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Payment Type *"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>l("theyGive"),className:"flex flex-col items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all duration-200 ".concat("theyGive"===o?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 text-indigo-700 shadow-[0_4px_12px_-2px_rgba(99,102,241,0.2)]":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,Pe.jsx)(Lc,{className:"h-6 w-6 ".concat("theyGive"===o?"text-indigo-600":"text-slate-500")}),(0,Pe.jsx)("span",{className:"font-semibold text-sm",children:"They give"})]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>l("youGive"),className:"flex flex-col items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all duration-200 ".concat("youGive"===o?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 text-indigo-700 shadow-[0_4px_12px_-2px_rgba(99,102,241,0.2)]":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,Pe.jsx)(Mc,{className:"h-6 w-6 ".concat("youGive"===o?"text-indigo-600":"text-slate-500")}),(0,Pe.jsx)("span",{className:"font-semibold text-sm",children:"You give"})]})]}),(0,Pe.jsx)("p",{className:"text-xs text-slate-500 mt-3 text-center",children:"theyGive"===o?"Customer is paying you (reduces balance)":"You are paying/refunding customer (increases balance)"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Payment Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"number",id:"amount",value:i,onChange:e=>a(e.target.value),step:"0.01",min:"0.01",className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter amount",required:!0})]}),(0,Pe.jsxs)("div",{className:"flex justify-end gap-3 pt-6 pb-2",children:[(0,Pe.jsx)("button",{type:"button",onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 font-semibold hover:bg-slate-50 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-indigo-600 to-blue-600 text-white font-semibold shadow-[0_4px_12px_-2px_rgba(99,102,241,0.4)] hover:shadow-[0_6px_16px_-2px_rgba(99,102,241,0.5)] transition-all active:scale-[0.98]",children:"Save Payment"})]})]})]})]})})},Bc=Ee("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Uc=e=>{const t=Number(e||0)||0;return"\u20b9".concat(t.toFixed(2))},zc=e=>{try{const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-IN",n).format(t)}catch(t){return e}},qc=e=>{let{customer:n,orders:r,onClose:s}=e;const{state:a}=(0,i.nm)(),[o,l]=(0,t.useState)("all"),[c,d]=(0,t.useState)(()=>(new Date).toISOString().split("T")[0]),u=(0,t.useMemo)(()=>{if(!n||null===r||void 0===r||!r.length)return[];const e=It(n.mobileNumber||n.phone||"");return e?r.filter(t=>{if(!t||t.isDeleted)return!1;const n=It(t.customerMobile||"");return!(!n||!e||n!==e)}).sort((e,t)=>new Date(t.createdAt||t.date||0)-new Date(e.createdAt||e.date||0)):[]},[n,r]),h=e=>{const t=Number(e);return Number.isFinite(t)?t:null},m=e=>{const t=Number(e)||0;return Math.round(100*(t+Number.EPSILON))/100},f=e=>{var t,n,r,s,i,a,o,l,c;const d=null!==(t=h(e.subtotal))&&void 0!==t?t:0,u=(e=>e&&Array.isArray(e.items)?e.items.reduce((e,t)=>{var n,r,s;return e+(null!==(n=null!==(r=h(t.sellingPrice))&&void 0!==r?r:h(t.price))&&void 0!==n?n:0)*(null!==(s=h(t.quantity))&&void 0!==s?s:0)},0):0)(e),f=null!==(n=null!==(r=h(e.totalAmount))&&void 0!==r?r:h(e.total))&&void 0!==n?n:0,p=d>0?d:u>0?u:f,g=h(e.discountPercent),x=null!==(s=null!==(i=h(e.discountAmount))&&void 0!==i?i:h(e.discount))&&void 0!==s?s:0;let y=g;null===y&&(y=p>0?x/p*100:0),Number.isFinite(y)||(y=0);const b=m(x>0?x:p*y/100),w=Math.max(0,p-b),v=h(e.taxPercent),N=null!==(a=null!==(o=h(e.taxAmount))&&void 0!==o?o:h(e.tax))&&void 0!==a?a:0;let S=v;null===S&&(S=w>0?N/w*100:0),Number.isFinite(S)||(S=0);const A=m(N>0?N:w*S/100),_=null!==(l=null!==(c=h(e.totalAmount))&&void 0!==c?c:h(e.total))&&void 0!==l?l:0,C=_>0?_:m(Math.max(0,w+A));return{subtotal:m(p),discountPercent:m(y),discountAmount:b,taxPercent:m(S),taxAmount:A,netTotal:C}},p=(0,t.useCallback)(e=>{if(!e)return null;const t=new Date(e);if(Number.isNaN(t.getTime()))return null;const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(s)},[]),g=(0,t.useCallback)(e=>{if(!e)return null;const t=e.date||e.createdAt||e.updatedAt||e.invoiceDate;return p(t)},[p]),x=(0,t.useMemo)(()=>{if("all"===o)return u;const e=p(Date.now());return"today"===o?u.filter(t=>g(t)===e):"date"===o&&c?u.filter(e=>g(e)===c):u},[u,g,o,c,p]),y=x.reduce((e,t)=>{const n=f(t);return e.totalSpend+=n.netTotal,e.totalSubtotal+=n.subtotal,e.totalDiscount+=n.discountAmount,e.totalTax+=n.taxAmount,e},{totalSpend:0,totalSubtotal:0,totalDiscount:0,totalTax:0}),{totalSpend:b,totalSubtotal:w,totalDiscount:v,totalTax:N}=y,S=(0,t.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;"undefined"!==typeof window&&"function"===typeof window.showToast&&window.showToast(e,t,n)},[]),A=(0,t.useCallback)(e=>{var t,r,s,i,o,l,c;if(!e)return"";const d=f(e),u=zc(e.createdAt||e.date||(new Date).toISOString()),h=(()=>{try{const t=new Date(e.createdAt||e.date||Date.now());return Number.isNaN(t.getTime())?u:t.toLocaleDateString("en-IN")}catch(t){return u}})(),m=e=>null===e||void 0===e||""===e?"null":e,p=m(a.storeName||(null===(t=a.currentUser)||void 0===t?void 0:t.shopName)||(null===(r=a.currentUser)||void 0===r?void 0:r.username)),g=m((null===(s=a.currentUser)||void 0===s?void 0:s.address)||a.shopAddress),x=(null===(i=a.currentUser)||void 0===i?void 0:i.phoneNumber)||(null===(o=a.currentUser)||void 0===o?void 0:o.mobile)||(null===(l=a.currentUser)||void 0===l?void 0:l.mobileNumber)||(null===(c=a.currentUser)||void 0===c?void 0:c.contact)||"",y=It(x),b=y?"+91 ".concat(y):m(x),w=m((null===n||void 0===n?void 0:n.name)||e.customerName),v=It((null===n||void 0===n?void 0:n.mobileNumber)||(null===n||void 0===n?void 0:n.phone)||e.customerMobile||"")||"null",N="".concat("Item".padEnd(12," ")).concat("Qty".padStart(8," "),"   ").concat("Rate".padStart(8," "),"   ").concat("Amount".padStart(10," ")),S=(e.items||[]).map(e=>{var t,n,r;const s=Number(null!==(t=e.quantity)&&void 0!==t?t:0)||0,i=Number(null!==(n=null!==(r=e.sellingPrice)&&void 0!==r?r:e.price)&&void 0!==n?n:0)||0,a=s*i,o=Number.isInteger(s)?s.toString():s.toFixed(2),l=i.toFixed(2),c=a.toFixed(2),d=(e.name||"null").slice(0,12).padEnd(12," "),u=o.padStart(8," "),h=l.padStart(8," "),m=c.padStart(10," ");return"".concat(d).concat(u,"   ").concat(h,"   ").concat(m)}).join("\n"),A="--------------------------------",_="Shop Name : ".concat(p),C="Address   : ".concat(g),I="Phone     : ".concat(b),E="Date      : ".concat(m(h)),T=(e.paymentMethod||"null").toString().trim(),j="null"===T.toLowerCase()?"null":T.charAt(0).toUpperCase()+T.slice(1).toLowerCase(),k=Number.isFinite(d.discountAmount)?"\u20b9".concat(d.discountAmount.toFixed(2)):"\u20b9null",D=Number.isFinite(d.subtotal)?"\u20b9".concat(d.subtotal.toFixed(2)):"\u20b9null",P=Number.isFinite(d.netTotal)?"\u20b9".concat(d.netTotal.toFixed(2)):"\u20b9null",R=Number.isFinite(d.taxPercent)?d.taxPercent:null,O=null===R?"null":"".concat(R%1===0?R.toFixed(0):R.toFixed(2),"%"),L=Number.isFinite(d.taxAmount)?"\u20b9".concat(d.taxAmount.toFixed(2)):"\u20b9null";return["             INVOICE","",A,_,C,I,E,A,"Customer Name : ".concat(w),"Customer Phone: ".concat(v),A,N,S||"".concat("null".padEnd(12," ")).concat("null".padStart(8," "),"   ").concat("null".padStart(8," "),"   ").concat("null".padStart(10," ")),A,"Subtotal     : ".concat(D),"Discount     : ".concat(k),"Tax (".concat(O,")     : ").concat(L),A,"Grand Total  : ".concat(P),"Payment Mode : ".concat(j),"Thank you for shopping with us!",A,"        Powered by Drag & Drop",A].join("\n")},[null===n||void 0===n?void 0:n.name,null===n||void 0===n?void 0:n.mobileNumber,null===n||void 0===n?void 0:n.phone,a]),_=(0,t.useCallback)(e=>{const t=A(e);if(!t)return void S("Unable to prepare invoice details for sharing.","error");const r=(null===n||void 0===n?void 0:n.mobileNumber)||(null===n||void 0===n?void 0:n.phone)||(null===e||void 0===e?void 0:e.customerMobile)||"",s=It(r);if(!s)return void S("No valid customer mobile number found to share the bill.","warning");const i=encodeURIComponent(t),a=10===s.length?"91".concat(s):s,o="https://wa.me/".concat(a,"?text=").concat(i);window.open(o,"_blank")},[A,n,S]);return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-[1050] p-0 sm:p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-none sm:rounded-2xl shadow-2xl w-full h-full sm:h-auto sm:max-w-3xl sm:max-h-[90vh] flex flex-col overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 border-b border-gray-200 px-4 sm:px-6 py-4 flex-shrink-0",children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Pe.jsxs)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 flex items-center gap-2",children:[(0,Pe.jsx)(Be,{className:"h-5 w-5 text-primary-600 flex-shrink-0"}),"Order History"]}),(0,Pe.jsx)("button",{type:"button",onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg sm:hidden transition-colors","aria-label":"Close order history",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 mb-2 break-words",children:[(null===n||void 0===n?void 0:n.name)||"Customer"," \u2022 ",x.length," orders \u2022 Net paid ",Uc(b)]}),(0,Pe.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-gray-500",children:[(0,Pe.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1",children:[(0,Pe.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-blue-500"}),"Subtotal ",Uc(w)]}),(0,Pe.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1",children:[(0,Pe.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500"}),"Discount ",Uc(m(v))]}),(0,Pe.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1",children:[(0,Pe.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-purple-500"}),"Tax ",Uc(m(N))]}),(0,Pe.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1",children:[(0,Pe.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-indigo-500"}),"Total ",Uc(m(b))]})]})]}),(0,Pe.jsxs)("div",{className:"hidden sm:flex items-center gap-2 flex-shrink-0",children:[(0,Pe.jsx)(Bc,{className:"h-4 w-4 text-gray-400"}),(0,Pe.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"input-field !py-1.5 !px-3 text-sm",children:[(0,Pe.jsx)("option",{value:"all",children:"All Orders"}),(0,Pe.jsx)("option",{value:"today",children:"Today"}),(0,Pe.jsx)("option",{value:"date",children:"Specific Date"})]}),"date"===o&&(0,Pe.jsx)("input",{type:"date",value:c,max:(new Date).toISOString().split("T")[0],onChange:e=>d(e.target.value),className:"input-field !py-1.5 !px-3 text-sm"})]}),(0,Pe.jsx)("button",{type:"button",onClick:s,className:"hidden sm:flex p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0","aria-label":"Close order history",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"px-4 pt-3 pb-3 sm:hidden border-b border-gray-200 flex-shrink-0",children:(0,Pe.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,Pe.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Filter Orders"}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"input-field text-sm flex-1",children:[(0,Pe.jsx)("option",{value:"all",children:"All Orders"}),(0,Pe.jsx)("option",{value:"today",children:"Today"}),(0,Pe.jsx)("option",{value:"date",children:"Specific Date"})]}),"date"===o&&(0,Pe.jsx)("input",{type:"date",value:c,max:(new Date).toISOString().split("T")[0],onChange:e=>d(e.target.value),className:"input-field text-sm flex-1"})]})]})}),(0,Pe.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-4 sm:px-6 pb-4 pt-4 space-y-4 min-h-0",children:0===x.length?(0,Pe.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-gray-500",children:[(0,Pe.jsx)(bt,{className:"h-12 w-12 text-gray-300 mb-4"}),(0,Pe.jsx)("p",{className:"text-sm font-medium",children:"No orders found for this selection."})]}):x.map(e=>{var t;const n=e.items||[],r=f(e);return(0,Pe.jsxs)("div",{className:"rounded-lg sm:rounded-xl border border-gray-200 bg-gray-50/40 hover:border-primary-200 transition-colors",children:[(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 px-4 sm:px-5 py-4",children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("p",{className:"text-sm font-semibold text-gray-900",children:["Invoice ID: ",(null===(t=e.id)||void 0===t?void 0:t.slice(-8))||"\u2014"]}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 break-words",children:zc(e.createdAt||e.date)})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between sm:block sm:text-right",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-lg sm:text-xl font-semibold text-primary-600",children:Uc(r.netTotal)}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mt-0.5",children:e.paymentMethod||"cash"})]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>_(e),className:"sm:mt-2 inline-flex items-center gap-1.5 rounded-lg border border-primary-100 bg-primary-50 px-3 py-1.5 text-xs font-medium text-primary-600 hover:bg-primary-100 transition-colors active:scale-95",children:[(0,Pe.jsx)(At,{className:"h-3.5 w-3.5"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Share Bill"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Share"})]})]})]}),(()=>{if("split"===(e.paymentMethod||"").toString().toLowerCase().trim()){const t=e.splitPaymentDetails||{},n=Number(t.cashAmount)||0,r=Number(t.onlineAmount)||0,s=Number(t.dueAmount)||0;return(0,Pe.jsxs)("div",{className:"px-4 sm:px-5 pb-3",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-2 font-medium",children:"Split Payment Breakdown"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[(0,Pe.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-[10px] sm:text-xs text-green-700 font-medium mb-0.5 sm:mb-1",children:"Cash"}),(0,Pe.jsx)("p",{className:"text-sm sm:text-lg font-bold text-green-900",children:Uc(n)})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-[10px] sm:text-xs text-blue-700 font-medium mb-0.5 sm:mb-1",children:"Online"}),(0,Pe.jsx)("p",{className:"text-sm sm:text-lg font-bold text-blue-900",children:Uc(r)})]}),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-[10px] sm:text-xs text-red-700 font-medium mb-0.5 sm:mb-1",children:"Due"}),(0,Pe.jsx)("p",{className:"text-sm sm:text-lg font-bold text-red-900",children:Uc(s)})]})]})]})}return null})(),n.length>0&&(0,Pe.jsxs)("div",{className:"px-4 sm:px-5 pb-4 space-y-3",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[(0,Pe.jsxs)("div",{className:"rounded-lg bg-white border border-gray-200 px-2.5 sm:px-3 py-2 sm:py-2.5",children:[(0,Pe.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Subtotal"}),(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-gray-900 break-words",children:Uc(r.subtotal)})]}),(0,Pe.jsxs)("div",{className:"rounded-lg bg-white border border-gray-200 px-2.5 sm:px-3 py-2 sm:py-2.5",children:[(0,Pe.jsxs)("p",{className:"text-[10px] sm:text-xs text-gray-500 uppercase tracking-wide mb-1",children:["Discount (",(r.discountPercent||0).toFixed(2),"%)"]}),(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm font-semibold text-emerald-600 break-words",children:["- ",Uc(r.discountAmount)]})]}),(0,Pe.jsxs)("div",{className:"rounded-lg bg-white border border-gray-200 px-2.5 sm:px-3 py-2 sm:py-2.5",children:[(0,Pe.jsxs)("p",{className:"text-[10px] sm:text-xs text-gray-500 uppercase tracking-wide mb-1",children:["Tax (",(r.taxPercent||0).toFixed(2),"%)"]}),(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm font-semibold text-purple-600 break-words",children:["+ ",Uc(r.taxAmount)]})]}),(0,Pe.jsxs)("div",{className:"rounded-lg bg-white border border-gray-200 px-2.5 sm:px-3 py-2 sm:py-2.5",children:[(0,Pe.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Net Total"}),(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-primary-600 break-words",children:Uc(r.netTotal)})]})]}),(0,Pe.jsx)("div",{className:"bg-white rounded-lg sm:rounded-xl border border-gray-200 overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-xs sm:text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-gray-100",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-3 sm:px-4 py-2 text-left font-medium text-gray-600 whitespace-nowrap",children:"Item"}),(0,Pe.jsx)("th",{className:"px-3 sm:px-4 py-2 text-center font-medium text-gray-600 whitespace-nowrap",children:"Qty"}),(0,Pe.jsx)("th",{className:"px-3 sm:px-4 py-2 text-right font-medium text-gray-600 whitespace-nowrap",children:"Rate"}),(0,Pe.jsx)("th",{className:"px-3 sm:px-4 py-2 text-right font-medium text-gray-600 whitespace-nowrap",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-gray-100",children:n.map((e,t)=>{var n,r,s,i,a,o,l,c,d,u;const h=Number(null!==(n=null!==(r=e.quantity)&&void 0!==r?r:null===(s=e.originalQuantity)||void 0===s?void 0:s.quantity)&&void 0!==n?n:0)||0,m=Number(null!==(i=null!==(a=null!==(o=null!==(l=e.totalSellingPrice)&&void 0!==l?l:e.total)&&void 0!==o?o:e.sellingPrice)&&void 0!==a?a:e.price)&&void 0!==i?i:0)||0,f=h>0?m/h:Number(null!==(c=null!==(d=null!==(u=e.unitSellingPrice)&&void 0!==u?u:e.sellingPrice)&&void 0!==d?d:e.price)&&void 0!==c?c:0)||0,p=Number(f*h)||m;return(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("td",{className:"px-3 sm:px-4 py-2 text-gray-800 break-words max-w-[120px] sm:max-w-none",children:e.name}),(0,Pe.jsxs)("td",{className:"px-3 sm:px-4 py-2 text-center text-gray-600 whitespace-nowrap",children:[h," ",e.unit||e.quantityUnit||""]}),(0,Pe.jsx)("td",{className:"px-3 sm:px-4 py-2 text-right text-gray-600 whitespace-nowrap",children:Uc(f)}),(0,Pe.jsx)("td",{className:"px-3 sm:px-4 py-2 text-right font-medium text-gray-700 whitespace-nowrap",children:Uc(p)})]},t)})})]})})]})]},e.id)})})]})})},Hc=()=>{var e;const{state:n,dispatch:r}=(0,i.nm)(),[s,o]=(0,t.useState)(""),[l,c]=(0,t.useState)(!1),[d,u]=(0,t.useState)(!1),[h,m]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1),[g,x]=(0,t.useState)(null),[y,b]=(0,t.useState)(null),[w,v]=(0,t.useState)(1),[N,S]=(0,t.useState)(""),[A,_]=(0,t.useState)(!1),[C,I]=(0,t.useState)(!1),[E,T]=(0,t.useState)(null),j=(0,t.useRef)(null);(0,t.useEffect)(()=>{let e=!0;const t=async()=>{try{const t=await(0,Ae.getAllItems)(Ae.STORES.orders).catch(()=>[]);if(!e)return;const s=(t||[]).filter(e=>e&&!0!==e.isDeleted),a=(n.orders||[]).filter(e=>e&&!0!==e.isDeleted);if(s.length!==a.length)return void r({type:i.ActionTypes.SET_ORDERS,payload:s});const o=new Map(a.map(e=>[(e.id||e._id||e.createdAt||"").toString(),e]));let l=!1;for(const e of s){const t=(e.id||e._id||e.createdAt||"").toString(),n=o.get(t);if(!n){l=!0;break}if(["totalAmount","subtotal","discountPercent","taxPercent","updatedAt","isSynced"].some(t=>{var r,s;const i=null!==(r=e[t])&&void 0!==r?r:null,a=null!==(s=n[t])&&void 0!==s?s:null;return JSON.stringify(i)!==JSON.stringify(a)})){l=!0;break}}l&&r({type:i.ActionTypes.SET_ORDERS,payload:s})}catch(t){console.error("Customers: Failed to refresh orders from IndexedDB",t)}};t();const s=()=>t();return window.addEventListener("focus",s),()=>{e=!1,window.removeEventListener("focus",s)}},[r,n.orders]),(0,t.useEffect)(()=>{const e=e=>{j.current&&!j.current.contains(e.target)&&_(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const[k,D]=(0,t.useState)(10);(0,t.useEffect)(()=>{const e=()=>{window.innerWidth>=1025?D(25):D(10)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const P=n.customers.filter(e=>!e.isDeleted),{maxCustomers:R}=(0,Je.ay)(n.currentPlan,n.currentPlanDetails),O=P.length,L=!(0,Je.sp)(O,n.currentPlan,n.currentPlanDetails),M=R===1/0?"Unlimited":R,F=(null===(e=n.currentPlanDetails)||void 0===e?void 0:e.planName)||(n.currentPlan?"".concat(n.currentPlan.charAt(0).toUpperCase()).concat(n.currentPlan.slice(1)):"Current"),B=()=>{const e="You've reached the customer limit (".concat(M,") for the ").concat(F," plan. Upgrade now to unlock more customer slots instantly.");S(e),window.showToast&&window.showToast(e,"warning",5e3)},U=P.filter(e=>{var t;const n=e.mobileNumber||e.phone||"";return e.name.toLowerCase().includes(s.toLowerCase())||n.includes(s)||(null===(t=e.email)||void 0===t?void 0:t.toLowerCase().includes(s.toLowerCase()))}),z=Math.ceil(U.length/k),q=(w-1)*k,H=U.slice(q,q+k);(0,t.useEffect)(()=>{v(1)},[s,k]);const V=()=>{L?B():(S(""),c(!0))},W=e=>{v(e)},G=(e,t,n)=>{const r=new Blob([t],{type:n}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)};return(0,Pe.jsxs)("div",{className:"space-y-6 pb-6",children:[(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pb-4 border-b border-gray-200",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),(0,Pe.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:[O," ",1===O?"customer":"customers"," \u2022 Limit: ",M]})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[(0,Pe.jsxs)("div",{className:"relative w-full sm:w-auto",ref:j,children:[(0,Pe.jsxs)("button",{onClick:()=>_(e=>!e),className:"btn-secondary flex items-center justify-center gap-2 w-full sm:w-auto",children:[(0,Pe.jsx)(st,{className:"h-4 w-4"}),"Export"]}),A&&(0,Pe.jsxs)("div",{className:"absolute left-0 right-0 mt-2 w-full sm:w-48 sm:right-0 sm:left-auto rounded-xl border border-gray-200 bg-white shadow-lg overflow-hidden z-50",children:[(0,Pe.jsxs)("button",{onClick:()=>{_(!1),(()=>{try{const e=new Uo("p","mm","a4"),t=e.internal.pageSize.getWidth(),r=e.internal.pageSize.getHeight();e.setFont("helvetica","normal"),e.setFontSize(18),e.text("Customer Report",t/2,15,{align:"center"}),e.setFontSize(11),e.text("".concat(n.username||"Grocery Store","  |  Generated: ").concat((new Date).toLocaleDateString()),t/2,22,{align:"center"}),e.setDrawColor(230),e.setFillColor(245,247,250),e.rect(10,28,t-20,18,"F"),e.setTextColor(60),e.setFontSize(10);const s=n.customers.length,i=n.customers.filter(e=>(e.balanceDue||0)>0).length,a=n.customers.reduce((e,t)=>e+(t.balanceDue||0),0).toFixed(2);e.text("Total Customers: ".concat(s),14,40),e.text("With Balance Due: ".concat(i),70,40),e.text("Total Outstanding: Rs ".concat(a),130,40);const o=52,l={idx:12,name:25,mobileNumber:90,email:130,balance:180};e.setFillColor(234,238,243),e.setDrawColor(220),e.rect(10,o-6,t-20,8,"F"),e.setTextColor(30),e.setFontSize(10),e.text("#",l.idx,o),e.text("Name",l.name,o),e.text("Mobile Number",l.mobileNumber,o),e.text("Email",l.email,o),e.text("Balance Due (Rs)",l.balance,o,{align:"right"});let c=o+6;e.setTextColor(50),e.setFontSize(9),n.customers.forEach((n,s)=>{c>r-20&&(e.addPage(),e.setFillColor(234,238,243),e.setDrawColor(220),e.rect(10,10,t-20,8,"F"),e.setTextColor(30),e.setFontSize(10),e.text("#",l.idx,16),e.text("Name",l.name,16),e.text("Mobile Number",l.mobileNumber,16),e.text("Email",l.email,16),e.text("Balance Due (Rs)",l.balance,16,{align:"right"}),c=24,e.setTextColor(50),e.setFontSize(9));const i=(n.balanceDue||0).toFixed(2),a=n.mobileNumber||n.phone||"";e.text(String(s+1),l.idx,c),e.text((n.name||"").toString().substring(0,20),l.name,c),e.text(a.toString().substring(0,12),l.mobileNumber,c),e.text((n.email||"").toString().substring(0,18),l.email,c),e.text("Rs ".concat(i),l.balance,c,{align:"right"}),c+=6});const d=e.internal.getNumberOfPages();for(let u=1;u<=d;u++)e.setPage(u),e.setFontSize(8),e.setTextColor(120),e.text("Page ".concat(u," of ").concat(d),12,r-8),e.text("".concat(n.username||"Grocery Store"," \u2022 Customer Report"),t-12,r-8,{align:"right"});e.save("customers-report-".concat((new Date).toISOString().split("T")[0],".pdf")),window.showToast&&window.showToast("Customer report exported successfully!","success")}catch(e){console.error("Error generating PDF:",e),window.showToast&&window.showToast("Error generating PDF. Please try again.","error")}})()},className:"flex w-full items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[(0,Pe.jsx)(Lt,{className:"h-4 w-4 text-gray-600"}),"PDF Report"]}),(0,Pe.jsxs)("button",{onClick:()=>{_(!1),(()=>{try{const e=["Name","Mobile Number","Email","Address","Balance Due"],t=e=>{if(null===e||void 0===e)return"";const t=String(e);return t.includes('"')?'"'.concat(t.replace(/"/g,'""'),'"'):t.includes(",")||t.includes("\n")?'"'.concat(t,'"'):t},r=n.customers.map(e=>{var n,r;return[t(e.name||""),t(e.mobileNumber||e.phone||""),t(e.email||""),t(e.address||""),t((Number(null!==(n=null!==(r=e.balanceDue)&&void 0!==r?r:e.dueAmount)&&void 0!==n?n:0)||0).toFixed(2))]}),s=[e.join(","),...r.map(e=>e.join(","))].join("\n");G("customers-".concat((new Date).toISOString().split("T")[0],".csv"),s,"text/csv;charset=utf-8;"),window.showToast&&window.showToast("Customer data exported as CSV.","success")}catch(e){console.error("Error exporting CSV:",e),window.showToast&&window.showToast("Error exporting CSV. Please try again.","error")}})()},className:"flex w-full items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4 text-gray-600"}),"CSV Spreadsheet"]}),(0,Pe.jsxs)("button",{onClick:()=>{_(!1),(()=>{try{const e=n.customers.map(e=>{var t,n;return{id:e.id,name:e.name,mobileNumber:e.mobileNumber||e.phone||"",email:e.email||"",address:e.address||"",balanceDue:Number(null!==(t=null!==(n=e.balanceDue)&&void 0!==n?n:e.dueAmount)&&void 0!==t?t:0)||0,createdAt:e.createdAt,updatedAt:e.updatedAt}});G("customers-".concat((new Date).toISOString().split("T")[0],".json"),JSON.stringify(e,null,2),"application/json"),window.showToast&&window.showToast("Customer data exported as JSON.","success")}catch(e){console.error("Error exporting JSON:",e),window.showToast&&window.showToast("Error exporting JSON. Please try again.","error")}})()},className:"flex w-full items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4 text-gray-600"}),"JSON Dataset"]})]})]}),(0,Pe.jsxs)("button",{onClick:V,className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4"}),"Add Customer"]})]})]}),(0,Pe.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,Pe.jsxs)("div",{className:"flex-1 relative",children:[(0,Pe.jsx)("label",{htmlFor:"customer-search",className:"sr-only",children:"Search customers"}),(0,Pe.jsx)("input",{id:"customer-search",type:"text",placeholder:"Search by name, phone, or email...",value:s,onChange:e=>o(e.target.value),className:"input-field h-11 w-full rounded-lg border border-gray-300 bg-white text-sm placeholder:text-gray-400 transition-colors focus:border-[#2F3C7E] focus:ring-2 focus:ring-[#2F3C7E]/20 ".concat(s?"pr-10":"")}),s&&(0,Pe.jsx)("button",{type:"button",onClick:()=>o(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",children:"\xd7"})]})}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:H.length>0?H.map(e=>{var t,r;const s=null!==(t=null!==(r=e.balanceDue)&&void 0!==r?r:e.dueAmount)&&void 0!==t?t:0,i="number"===typeof s?s:parseFloat(s)||0,a=i<0,o=0!==i;return(0,Pe.jsxs)("div",{className:"card hover:shadow-md transition-shadow duration-200 overflow-hidden",children:[(0,Pe.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,Pe.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-white font-semibold text-base ".concat(i>0?"bg-red-500":i<0?"bg-emerald-500":"bg-[#2F3C7E]"),children:(e.name||"C")[0].toUpperCase()}),(0,Pe.jsx)("div",{className:"flex-1 min-w-0 pr-2",children:(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 truncate",title:e.name,children:e.name})})]}),(e.mobileNumber||e.phone)&&(0,Pe.jsx)("p",{className:"text-sm text-gray-600 ml-[52px] mb-1",children:e.mobileNumber||e.phone}),e.email&&(0,Pe.jsx)("p",{className:"text-sm text-gray-600 ml-[52px] truncate",title:e.email,children:e.email})]})}),(0,Pe.jsx)("div",{className:"mb-4 ml-0 sm:ml-[52px]",children:(0,Pe.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium ".concat(i>0?"bg-red-50 text-red-700":i<0?"bg-emerald-50 text-emerald-700":"bg-gray-50 text-gray-600"),children:[(0,Pe.jsx)(De,{className:"h-3 w-3"}),a?"Credit: \u20b9".concat(Math.abs(i).toFixed(2)):o?"Due: \u20b9".concat(i.toFixed(2)):"No Balance"]})}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2 pt-4 mt-4 border-t border-gray-100 flex-wrap",children:[(0,Pe.jsxs)("button",{onClick:()=>(e=>{b(e),m(!0)})(e),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-emerald-50 hover:bg-emerald-100 text-emerald-700 text-sm font-medium transition-colors",title:"Record Payment",children:[(0,Pe.jsx)(De,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Pay"})]}),(0,Pe.jsx)("button",{onClick:()=>{b(e),u(!0)},className:"p-2 rounded-lg text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"Edit Customer",children:(0,Pe.jsx)(Ut,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>(e=>{x(e),p(!0)})(e),className:"p-2 rounded-lg text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 transition-colors",title:"View Order History",children:(0,Pe.jsx)(zt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>(e=>{const t=n.customers.find(t=>t.id===e);if(!t||!t.isWalkIn&&"walk-in customer"!==(t.name||"").trim().toLowerCase()){if(t&&0!==(t.balanceDue||0)){const e=Math.abs(t.balanceDue||0);return void(window.showToast&&window.showToast("Cannot delete customer. Outstanding balance of \u20b9".concat(e.toFixed(2)," must be cleared first."),"error"))}T(t),I(!0)}else window.showToast&&window.showToast("Walk-in customer cannot be deleted.","warning")})(e.id),disabled:0!==(e.balanceDue||0),className:"p-2 rounded-lg transition-colors ".concat(0!==(e.balanceDue||0)?"text-gray-300 cursor-not-allowed opacity-50":"text-gray-600 hover:text-red-600 hover:bg-red-50"),title:0!==(e.balanceDue||0)?"Cannot delete. Outstanding balance: \u20b9".concat(Math.abs(e.balanceDue||0).toFixed(2)):"Delete Customer",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})]},e.id)}):(0,Pe.jsx)("div",{className:"col-span-full",children:(0,Pe.jsxs)("div",{className:"text-center py-16 px-4 rounded-lg bg-gray-50 border border-gray-200",children:[(0,Pe.jsx)(Le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No customers found"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:s?"Try adjusting your search terms.":"Get started by adding your first customer."}),!s&&(0,Pe.jsxs)("button",{onClick:V,className:"btn-primary inline-flex items-center gap-2",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4"}),"Add Customer"]})]})})}),z>1&&(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mt-6 px-4 py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:q+1})," to ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(q+k,U.length)})," of ",(0,Pe.jsx)("span",{className:"font-semibold",children:U.length})," ",1===U.length?"customer":"customers"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>W(1),disabled:1===w,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"First page",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>W(w-1),disabled:1===w,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous page",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4"})}),(0,Pe.jsx)("div",{className:"flex items-center gap-1 mx-2",children:(()=>{const e=[];if(z<=5)for(let t=1;t<=z;t++)e.push(t);else if(w<=3){for(let t=1;t<=4;t++)e.push(t);e.push("ellipsis"),e.push(z)}else if(w>=z-2){e.push(1),e.push("ellipsis");for(let t=z-3;t<=z;t++)e.push(t)}else{e.push(1),e.push("ellipsis");for(let t=w-1;t<=w+1;t++)e.push(t);e.push("ellipsis"),e.push(z)}return e})().map((e,t)=>"ellipsis"===e?(0,Pe.jsx)("span",{className:"px-2 text-gray-500",children:"..."},"ellipsis-".concat(t)):(0,Pe.jsx)("button",{onClick:()=>W(e),className:"min-w-[36px] px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(w===e?"bg-[#2f3c7e] text-white shadow-sm":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e},e))}),(0,Pe.jsx)("button",{onClick:()=>W(w+1),disabled:w===z,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next page",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>W(z),disabled:w===z,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Last page",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4"})})]})]}),l&&(0,Pe.jsx)(Rc,{existingCustomers:n.customers,planLimitError:N,onClearPlanLimitError:()=>S(""),onClose:()=>{c(!1),S("")},onSubmit:e=>{if("walk-in customer"===(e.name||"").trim().toLowerCase())return window.showToast&&window.showToast("Walk-in customer already exists.","info"),c(!1),!1;if(L)return B(),!1;const t=(0,a.A)((0,a.A)({id:Date.now().toString()},e),{},{createdAt:(new Date).toISOString()});return r({type:"ADD_CUSTOMER",payload:t}),c(!1),S(""),!0}}),d&&y&&(0,Pe.jsx)(Oc,{customer:y,onClose:()=>{u(!1),b(null)},onSubmit:e=>{r({type:"UPDATE_CUSTOMER",payload:e}),u(!1),b(null)}}),h&&y&&(0,Pe.jsx)(Fc,{customer:y,onClose:()=>{m(!1),b(null)},onSubmit:function(e){var t,n;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"theyGive";if(!y||e<=0)return;const i=null!==(t=null!==(n=y.dueAmount)&&void 0!==n?n:y.balanceDue)&&void 0!==t?t:0,o=parseFloat(i)||0,l=parseFloat(e)||0,c="theyGive"===s?parseFloat((o-l).toFixed(2)):parseFloat((o+l).toFixed(2)),d=(0,a.A)((0,a.A)({},y),{},{dueAmount:c,balanceDue:c});if(console.log("Payment submit - Customer data:",d),console.log("Payment type:",s),console.log("dueAmount:",d.dueAmount,"balanceDue:",d.balanceDue),r({type:"UPDATE_CUSTOMER",payload:d}),window.showToast){const e="theyGive"===s?"Payment received":"Payment given";c<0?window.showToast("".concat(e,". Customer now has \u20b9").concat(Math.abs(c).toFixed(2)," credit."),"success"):0===c?window.showToast("".concat(e,". Balance cleared."),"success"):window.showToast("".concat(e,". Remaining balance \u20b9").concat(c.toFixed(2),"."),"success")}m(!1),b(null)}}),f&&g&&(0,Pe.jsx)(qc,{customer:g,orders:n.orders,onClose:()=>{p(!1),x(null)}}),C&&E&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 animate-fade-in",children:[(0,Pe.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,Pe.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,Pe.jsx)(lt,{className:"h-6 w-6 text-red-600"})}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:"Delete Customer?"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"This action cannot be undone. The customer will be permanently removed from your records."})]}),(0,Pe.jsx)("button",{onClick:()=>{I(!1),T(null)},className:"flex-shrink-0 p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"space-y-2",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Name:"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-900",children:E.name})]}),E.mobileNumber&&(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Phone:"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-900",children:E.mobileNumber})]}),E.email&&(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Email:"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-900",children:E.email})]})]})}),(0,Pe.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,Pe.jsx)("button",{onClick:()=>{I(!1),T(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>{E&&(r({type:"DELETE_CUSTOMER",payload:E.id}),window.showToast&&window.showToast("Customer deleted successfully.","success")),I(!1),T(null)},className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors font-medium",children:"Delete Customer"})]})]})})]})},Vc=Ee("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Wc=Ee("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),Gc=Ee("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Yc=Ee("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Xc={mg:.001,g:1,gm:1,gram:1,grams:1,kg:1e3,kilogram:1e3,kilograms:1e3,ml:1,milliliter:1,milliliters:1,l:1e3,liter:1e3,liters:1e3,litre:1e3,litres:1e3,pcs:1,pieces:1,box:1,boxes:1,packet:1,packets:1,bottle:1,bottles:1,unit:1,units:1},Qc=e=>{var t;const n=null===e||void 0===e||null===(t=e.toLowerCase())||void 0===t?void 0:t.trim();return n?["mg","g","gm","gram","grams","kg","kilogram","kilograms"].includes(n)?"g":["ml","milliliter","milliliters","l","liter","liters","litre","litres"].includes(n)?"ml":"pcs":"pcs"},Kc=(e,t)=>{var n;const r=(null===t||void 0===t||null===(n=t.toLowerCase())||void 0===n?void 0:n.trim())||"pcs";return e*(Xc[r]||1)},Zc=(e,t)=>{var n;const r=(null===t||void 0===t||null===(n=t.toLowerCase())||void 0===n?void 0:n.trim())||"pcs";return e/(Xc[r]||1)},Jc=(e,t)=>Qc(e)===Qc(t),$c=["pcs","piece","pieces","box","boxes","packet","packets","bottle","bottles","unit","units"],ed=["mg","g","gm","gram","grams","kg","kilogram","kilograms","ml","milliliter","milliliters","l","liter","liters","litre","litres"],td=e=>{var t;const n=null===e||void 0===e||null===(t=e.toLowerCase())||void 0===t?void 0:t.trim();return!!n&&$c.includes(n)},nd=e=>{var t;const n=null===e||void 0===e||null===(t=e.toLowerCase())||void 0===t?void 0:t.trim();return!!n&&ed.includes(n)},rd=(e,t)=>{var n;const r=(null===t||void 0===t||null===(n=t.toLowerCase())||void 0===n?void 0:n.trim())||"pcs";return nd(r)?"".concat(e," ").concat(r):"".concat(Math.round(e)," ").concat(r)},sd=(e,t,n)=>{const r=e.quantity||e.stock||0,s=e.unit||e.quantityUnit||"pcs",i=Kc(r,s),a=Kc(t,n);return Jc(s,n)?{available:a<=i,stockInBaseUnit:i,requestedInBaseUnit:a,baseUnit:Qc(s),stockDisplay:rd(r,s),requestedDisplay:rd(t,n)}:{available:!1,error:"Unit mismatch: Cannot compare ".concat(s," with ").concat(n),stockInBaseUnit:i,requestedInBaseUnit:a,baseUnit:Qc(s)}},id=e=>{var n,r;let{product:s,onClose:a,onAdd:o}=e;const{state:l}=(0,i.nm)(),c=s._isEdit,d=s._currentQuantity,u=s._currentUnit,[h,m]=(0,t.useState)(c&&d?d.toString():""),f=(s.quantityUnit||s.unit||"pcs").toLowerCase(),p=Qc(f),g="g"===p?["kg","g"]:"ml"===p?["l","ml"]:[f],x=c&&u?u:f,[y,b]=(0,t.useState)(g.includes(x)?x:g[0]),w=Number(null!==(n=null!==(r=s.quantity)&&void 0!==r?r:s.stock)&&void 0!==n?n:0);return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:c?Ze("editQuantity",l.currentLanguage)||"Edit Quantity":Ze("addQuantity",l.currentLanguage)}),(0,Pe.jsx)("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(h);var n,r,i,l;if(!Number.isFinite(t)||t<=0)return void(null===(n=(r=window).showToast)||void 0===n||n.call(r,"Please enter a valid quantity greater than zero.","warning"));if(td(y)&&!Number.isInteger(t))return void(null===(i=(l=window).showToast)||void 0===i||i.call(l,"Quantity must be a whole number for pieces, packets and boxes.","warning"));!1!==o(s,t,y)&&a()},className:"space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[Ze("product",l.currentLanguage),": ",s.name]}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600",children:[Ze("price",l.currentLanguage),": \u20b9",(s.sellingPrice||s.costPrice||0).toFixed(2)," per ",s.quantityUnit||"pcs"]}),(0,Pe.jsxs)("p",{className:"mt-1 text-sm text-blue-600 font-medium",children:[Ze("available",l.currentLanguage),": ",w," ",s.quantityUnit||s.unit||"pcs"]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:Ze("quantity",l.currentLanguage)}),(0,Pe.jsx)("input",{type:"text",value:h,onChange:e=>{const t=e.target.value,n=nd(y)||"g"===p||"ml"===p;(""===t||(n?/^[0-9]*\.?[0-9]*$/:/^[0-9]*$/).test(t))&&m(t)},className:"input-field",inputMode:"decimal",placeholder:"Enter quantity",required:!0,autoFocus:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:Ze("unit",l.currentLanguage)}),(0,Pe.jsx)("select",{value:y,onChange:e=>b(e.target.value),className:"input-field",children:g.map(e=>(0,Pe.jsx)("option",{value:e,children:"pcs"===e?Ze("pieces",l.currentLanguage):"kg"===e?Ze("kilograms",l.currentLanguage):"g"===e?Ze("grams",l.currentLanguage):e},e))})]}),(0,Pe.jsx)("button",{type:"submit",className:"w-full bg-emerald-600 text-white py-2.5 px-4 rounded-md hover:bg-emerald-700 transition-colors",children:c?Ze("updateQuantity",l.currentLanguage)||"Update Quantity":Ze("addToBill",l.currentLanguage)})]})]})})},ad=Ee("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),od=Ee("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]);var ld=n(8970);const cd="Drag & Drop",dd=(e,t,n)=>{if(!n||!n.trim()||!n.includes("@"))throw new Error("Valid seller UPI ID is required to create UPI payment URL.");const r=Math.max(0,parseFloat(e)||0).toFixed(2),s=new URLSearchParams;return s.set("pa",n.trim()),s.set("am",r),t&&s.set("tr",t),"upi://pay?".concat(s.toString())},ud=e=>"\u20b9".concat(parseFloat(e).toFixed(2)),hd=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{console.log("\ud83d\udd27 generateBillPaymentQR called with bill:",e),console.log("\ud83d\udd27 Options passed:",t);const n=(()=>{const e=Date.now(),t=Math.random().toString(36).substring(2,8);return"TXN".concat(e).concat(t).toUpperCase()})();let r=t.upiId||e.upiId;if(!r||!r.trim()||!r.includes("@"))throw new Error("Seller UPI ID is required. Please enter your UPI ID to generate QR code.");r=r.trim(),console.log("\ud83d\udd27 Using seller UPI ID for QR generation:",r);const s=t.merchantName||e.storeName||cd;let i=e.total,a=!1;if(e.splitPaymentDetails&&e.splitPaymentDetails.onlineAmount>0&&(i=parseFloat(e.splitPaymentDetails.onlineAmount)||0,a=!0,console.log("\ud83d\udd27 Split payment detected - using online amount:",i)),!i||i<=0)throw new Error("Invalid payment amount: ".concat(i,". Cannot generate QR code."));console.log("\ud83d\udd27 Payment amount for QR code:",i);t.description||(a?"Split Payment (Online) for Bill #".concat(e.id," - ").concat(e.customerName):"Payment for Bill #".concat(e.id," - ").concat(e.customerName));const o=await(async(e,t,n)=>{if(!n||!n.trim()||!n.includes("@"))throw new Error("Valid seller UPI ID is required to generate QR code.");try{const r=dd(e,t,n);return await ld.toDataURL(r,{errorCorrectionLevel:"M",margin:1,scale:8})}catch(r){throw console.error("Error generating UPI QR code:",r),r}})(i,n,r);return{qrCodeDataURL:o,paymentSummary:{transactionId:n,upiId:r,amount:i,formattedAmount:ud(i),merchantName:s,billId:e.id,customerName:e.customerName,items:e.items.length,paymentMethod:a?"Split Payment (Online)":"UPI",status:"pending",createdAt:(new Date).toISOString(),isSplitPayment:a,splitPaymentDetails:e.splitPaymentDetails},upiUrl:dd(i,n,r)}}catch(n){throw console.error("Error generating bill payment QR:",n),n}},md=e=>{let{onSave:n,onCancel:r}=e;const[s,i]=(0,t.useState)(""),[a,o]=(0,t.useState)(""),[l,c]=(0,t.useState)(!1);return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full shadow-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsx)("div",{className:"p-2 bg-indigo-100 rounded-lg",children:(0,Pe.jsx)(ad,{className:"h-6 w-6 text-indigo-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Enter Your UPI ID"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-500",children:"Required for online payments"})]})]}),(0,Pe.jsx)("button",{onClick:r,className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"p-6",children:(0,Pe.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(e=>{const t=e.trim();return t?/^[a-zA-Z0-9._-]{2,}@[a-zA-Z]{2,}[a-zA-Z0-9]{0,}$/.test(t)?null:"Please enter a valid UPI ID (e.g., myname@paytm, shop@ybl).":"Please enter your UPI ID."})(s);if(t)o(t);else{c(!0);try{await n(s.trim())}catch(r){o(r.message||"Failed to save UPI ID. Please try again.")}finally{c(!1)}}},className:"space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"upiId",className:"block text-sm font-medium text-gray-700 mb-2",children:"UPI ID *"}),(0,Pe.jsx)("input",{type:"text",id:"upiId",value:s,onChange:e=>{const t=e.target.value;i(t),o("")},placeholder:"e.g., myname@paytm, shop@ybl",className:"w-full px-4 py-3 rounded-lg border ".concat(a?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"," focus:outline-none focus:ring-2 transition-all"),autoFocus:!0}),a&&(0,Pe.jsxs)("div",{className:"mt-2 flex items-center space-x-1 text-red-600 text-sm",children:[(0,Pe.jsx)(St,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{children:a})]}),(0,Pe.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Your UPI ID will be saved and used for all future online payments."})]}),(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Pe.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Examples:"}),(0,Pe.jsxs)("ul",{className:"text-xs text-gray-600 space-y-1",children:[(0,Pe.jsx)("li",{children:"\u2022 myname@paytm"}),(0,Pe.jsx)("li",{children:"\u2022 shop@ybl"}),(0,Pe.jsx)("li",{children:"\u2022 business@phonepe"}),(0,Pe.jsx)("li",{children:"\u2022 store@googlepay"})]})]}),(0,Pe.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,Pe.jsx)("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-colors",disabled:l,children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 transition-colors flex items-center justify-center",disabled:l,children:l?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(od,{className:"h-4 w-4 mr-2"}),"Save & Continue"]})})]})]})})]})})},fd=e=>{let{bill:n,onClose:r,onPaymentReceived:s,onSaveUPIId:i}=e;const[a,o]=(0,t.useState)("pending"),[l,c]=(0,t.useState)(null),[d,u]=(0,t.useState)(null),[h,m]=(0,t.useState)(""),[f,p]=(0,t.useState)(!0),[g,x]=(0,t.useState)(!1);t.useEffect(()=>{y()},[n]);const y=async()=>{try{var e;const t=null===n||void 0===n?void 0:n.upiId;if(console.log("\ud83d\udd27 UPIPaymentModal - Bill object:",n),console.log("\ud83d\udd27 UPIPaymentModal - Seller UPI ID from bill:",t),console.log("\ud83d\udd27 UPIPaymentModal - Seller UPI ID type:",typeof t),console.log("\ud83d\udd27 UPIPaymentModal - Seller UPI ID trimmed:",null===t||void 0===t?void 0:t.trim()),!t||!t.trim()||!t.includes("@"))return console.warn("\u26a0\ufe0f Seller UPI ID is missing or invalid, showing input modal"),x(!0),void p(!1);const r=t.trim();p(!0),console.log("\ud83d\udd27 Generating QR code for bill:",n),console.log("\ud83d\udd27 Using seller UPI ID (trimmed):",r);const s=await hd(n,{upiId:r,merchantName:n.storeName||"Drag & Drop"});console.log("\ud83d\udd27 QR generation result:",s),console.log("\ud83d\udd27 QR code generated with UPI ID:",null===(e=s.paymentSummary)||void 0===e?void 0:e.upiId),console.log("\ud83d\udd27 UPI URL contains:",s.upiUrl),s.upiUrl&&!s.upiUrl.includes(r)&&(console.error("\u274c ERROR: Generated UPI URL does not contain seller UPI ID!"),console.error("Expected UPI ID:",r),console.error("UPI URL:",s.upiUrl)),c(s.qrCodeDataURL),u(s.paymentSummary),m(s.upiUrl),console.log("\ud83d\udd27 QR code data URL set:",s.qrCodeDataURL?"Success":"Failed")}catch(t){console.error("\u274c Error generating QR code:",t),window.showToast(t.message||"Error generating QR code","error")}finally{p(!1)}};return(0,Pe.jsxs)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4",children:[(0,Pe.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Pe.jsx)(ad,{className:"h-6 w-6 text-green-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0?"Split Payment - Online Portion":"UPI Payment"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-500",children:n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0?"Pay \u20b9".concat((n.splitPaymentDetails.onlineAmount||0).toFixed(2)," online"):"Scan QR code to pay"})]})]}),(0,Pe.jsx)("button",{onClick:r,className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Pe.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Bill Summary"}),(0,Pe.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Bill ID:"}),(0,Pe.jsxs)("span",{className:"font-medium",children:["#",n.id]})]}),(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Customer:"}),(0,Pe.jsx)("span",{className:"font-medium",children:n.customerName})]}),(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"UPI ID:"}),(0,Pe.jsx)("span",{className:"font-medium break-all",children:n.upiId})]}),(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,Pe.jsx)("span",{className:"font-medium",children:new Date(n.date).toLocaleDateString()})]}),n.splitPaymentDetails&&(0,Pe.jsxs)("div",{className:"mt-3 p-3 bg-indigo-50 border border-indigo-200 rounded-lg",children:[(0,Pe.jsx)("h5",{className:"font-medium text-indigo-900 mb-2",children:"Split Payment Breakdown:"}),(0,Pe.jsxs)("div",{className:"space-y-1 text-xs",children:[n.splitPaymentDetails.cashAmount>0&&(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-indigo-700",children:"Cash:"}),(0,Pe.jsx)("span",{className:"font-semibold text-indigo-900",children:ud(n.splitPaymentDetails.cashAmount)})]}),n.splitPaymentDetails.onlineAmount>0&&(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-indigo-700",children:"Online:"}),(0,Pe.jsx)("span",{className:"font-semibold text-indigo-900",children:ud(n.splitPaymentDetails.onlineAmount)})]}),n.splitPaymentDetails.dueAmount>0&&(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-indigo-700",children:"Due:"}),(0,Pe.jsx)("span",{className:"font-semibold text-indigo-900",children:ud(n.splitPaymentDetails.dueAmount)})]}),(0,Pe.jsxs)("div",{className:"flex justify-between border-t border-indigo-200 pt-1 mt-1",children:[(0,Pe.jsx)("span",{className:"text-indigo-700 font-medium",children:"Bill Total:"}),(0,Pe.jsx)("span",{className:"font-semibold text-indigo-900",children:ud(n.total)})]})]})]}),(0,Pe.jsxs)("div",{className:"mt-3",children:[(0,Pe.jsx)("h5",{className:"font-medium text-gray-800 mb-2",children:"Items:"}),(0,Pe.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:n.items.map((e,t)=>(0,Pe.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:e.name}),(0,Pe.jsxs)("span",{className:"font-medium",children:[e.quantity," ",e.unit," \xd7 \u20b9",(e.price||0).toFixed(2)," = \u20b9",(e.total||(e.price||0)*(e.quantity||0)).toFixed(2)]})]},t))})]}),(0,Pe.jsxs)("div",{className:"flex justify-between text-lg font-semibold border-t pt-2 mt-3",children:[(0,Pe.jsx)("span",{className:"text-gray-900",children:n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0?"Online Payment Amount:":"Total Amount:"}),(0,Pe.jsx)("span",{className:"text-green-600",children:n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0?ud(n.splitPaymentDetails.onlineAmount):ud(n.total)})]})]})]}),(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("h4",{className:"font-medium text-gray-900 mb-4",children:"Scan to Pay"}),f?(0,Pe.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 rounded-lg",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-2"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Generating QR Code..."})]})}):l?(0,Pe.jsxs)("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 inline-block",children:[(0,Pe.jsx)("img",{src:l,alt:"UPI Payment QR Code",className:"w-64 h-64 mx-auto"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Scan with any UPI app (Paytm, PhonePe, Google Pay, etc.)"})]}):(0,Pe.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 rounded-lg",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)(St,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Failed to generate QR code"})]})})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,Pe.jsx)("h5",{className:"font-medium text-blue-900 mb-2",children:"Payment Instructions:"}),(0,Pe.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,Pe.jsx)("li",{children:"\u2022 Open your UPI app (Paytm, PhonePe, Google Pay)"}),(0,Pe.jsx)("li",{children:"\u2022 Scan the QR code above"}),(0,Pe.jsxs)("li",{children:["\u2022 Verify the amount: ",(0,Pe.jsx)("span",{className:"font-semibold",children:n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0?ud(n.splitPaymentDetails.onlineAmount):ud(n.total)})]}),n.splitPaymentDetails&&n.splitPaymentDetails.onlineAmount>0&&(0,Pe.jsx)("li",{className:"text-indigo-700 font-medium",children:"\u2022 This is a split payment - paying only the online portion"}),(0,Pe.jsx)("li",{children:"\u2022 Complete the payment"}),(0,Pe.jsx)("li",{children:'\u2022 Click "Payment Received" below to confirm'})]})]}),(0,Pe.jsxs)("div",{className:"space-y-3",children:[(0,Pe.jsx)("h5",{className:"font-medium text-gray-900",children:"Alternative Payment:"}),(0,Pe.jsxs)("div",{className:"flex space-x-2",children:[(0,Pe.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(h),window.showToast("UPI URL copied to clipboard","success")},className:"flex-1 btn-secondary flex items-center justify-center text-sm",children:[(0,Pe.jsx)(De,{className:"h-4 w-4 mr-2"}),"Copy UPI Link"]}),(0,Pe.jsxs)("button",{onClick:()=>{window.open(h,"_blank")},className:"flex-1 btn-primary flex items-center justify-center text-sm",children:[(0,Pe.jsx)(ad,{className:"h-4 w-4 mr-2"}),"Open UPI App"]})]})]}),(0,Pe.jsxs)("div",{className:"text-center",children:["pending"===a&&(0,Pe.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-orange-600",children:[(0,Pe.jsx)(rt,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{className:"font-medium",children:"Waiting for Payment..."})]}),"completed"===a&&(0,Pe.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[(0,Pe.jsx)(od,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{className:"font-medium",children:"Payment Confirmed!"})]})]})]}),(0,Pe.jsxs)("div",{className:"flex space-x-3 p-6 border-t border-gray-200",children:[(0,Pe.jsx)("button",{onClick:r,className:"flex-1 btn-secondary",disabled:"completed"===a,children:"completed"===a?"Close":"Cancel"}),(0,Pe.jsxs)("button",{onClick:()=>{o("completed"),s(d),window.showToast("Payment confirmed successfully!","success")},className:"flex-1 btn-primary flex items-center justify-center",disabled:"completed"===a,children:[(0,Pe.jsx)(od,{className:"h-4 w-4 mr-2"}),"Payment Received"]})]})]}),g&&(0,Pe.jsx)(md,{onSave:async e=>{i&&(await i(e),x(!1),p(!0),setTimeout(()=>{y()},200))},onCancel:()=>{x(!1),r()}})]})},pd=e=>{let{totalAmount:n,onClose:r,onSubmit:s,sellerUpiId:i}=e;const[a,o]=(0,t.useState)("cash_online"),[l,c]=(0,t.useState)(""),[d,u]=(0,t.useState)(""),[h,m]=(0,t.useState)(""),f=e=>{o(e),c(""),u(""),m("")},p=e=>{let t=e.replace(/[^0-9.]/g,"");const n=t.split(".");return n.length>2&&(t=n[0]+"."+n.slice(1).join("")),2===n.length&&n[1].length>2&&(t=n[0]+"."+n[1].substring(0,2)),t},g=e=>{const t=p(e);c(t);const r=parseFloat(t);if(!isNaN(r)&&r>=0&&""!==t){if("cash_online"===a){const e=Math.max(0,Math.min(n,n-r));u(e>0?e.toFixed(2):"")}else if("cash_due"===a){const e=Math.max(0,Math.min(n,n-r));m(e>0?e.toFixed(2):"")}}else""===t&&("cash_online"===a?u(""):"cash_due"===a&&m(""))},x=e=>{const t=p(e);u(t);const r=parseFloat(t);if(!isNaN(r)&&r>=0&&""!==t){if("cash_online"===a){const e=Math.max(0,Math.min(n,n-r));c(e>0?e.toFixed(2):"")}else if("online_due"===a){const e=Math.max(0,Math.min(n,n-r));m(e>0?e.toFixed(2):"")}}else""===t&&("cash_online"===a?c(""):"online_due"===a&&m(""))},y=e=>{const t=p(e);m(t);const r=parseFloat(t);if(!isNaN(r)&&r>=0&&""!==t){if("online_due"===a){const e=Math.max(0,Math.min(n,n-r));u(e>0?e.toFixed(2):"")}else if("cash_due"===a){const e=Math.max(0,Math.min(n,n-r));c(e>0?e.toFixed(2):"")}}else""===t&&("online_due"===a?u(""):"cash_due"===a&&c(""))},b=(()=>{let e=0;return"cash_online"===a?e=(parseFloat(l)||0)+(parseFloat(d)||0):"online_due"===a?e=(parseFloat(d)||0)+(parseFloat(h)||0):"cash_due"===a&&(e=(parseFloat(l)||0)+(parseFloat(h)||0)),n-e})();return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25)] w-full max-w-md border border-slate-200/60 my-auto max-h-[95vh] flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 pb-4 flex-shrink-0 border-b border-slate-200/60",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"Split Payment"}),(0,Pe.jsx)("button",{onClick:r,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"overflow-y-auto flex-1 p-6",children:[(0,Pe.jsxs)("div",{className:"mb-6 p-4 rounded-xl bg-gradient-to-br from-slate-50 to-white border border-slate-200/60",children:[(0,Pe.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Total Amount"}),(0,Pe.jsxs)("p",{className:"text-2xl font-bold text-slate-900",children:["\u20b9",n.toFixed(2)]})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=0,r=0,o=0;"cash_online"===a?(t=parseFloat(l)||0,r=parseFloat(d)||0):"online_due"===a?(r=parseFloat(d)||0,o=parseFloat(h)||0):"cash_due"===a&&(t=parseFloat(l)||0,o=parseFloat(h)||0);const c=t+r+o,u=n-c;Math.abs(u)>.01?alert("Total split amount (\u20b9".concat(c.toFixed(2),") must equal bill total (\u20b9").concat(n.toFixed(2),"). Remaining: \u20b9").concat(u.toFixed(2))):"cash_online"===a&&r>0&&!i||"online_due"===a&&r>0&&!i?alert("Please add your UPI ID in Settings before accepting online payments."):s({splitType:a,cashAmount:t,onlineAmount:r,dueAmount:o})},className:"space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Payment Combination *"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>f("cash_online"),className:"flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 ".concat("cash_online"===a?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 text-indigo-700 shadow-[0_4px_12px_-2px_rgba(99,102,241,0.2)]":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)(Ve,{className:"h-5 w-5 ".concat("cash_online"===a?"text-indigo-600":"text-slate-500")}),(0,Pe.jsx)(De,{className:"h-5 w-5 ".concat("cash_online"===a?"text-indigo-600":"text-slate-500")})]}),(0,Pe.jsx)("span",{className:"font-semibold",children:"Cash + Online"})]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>f("online_due"),className:"flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 ".concat("online_due"===a?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 text-indigo-700 shadow-[0_4px_12px_-2px_rgba(99,102,241,0.2)]":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)(De,{className:"h-5 w-5 ".concat("online_due"===a?"text-indigo-600":"text-slate-500")}),(0,Pe.jsx)(Be,{className:"h-5 w-5 ".concat("online_due"===a?"text-indigo-600":"text-slate-500")})]}),(0,Pe.jsx)("span",{className:"font-semibold",children:"Online + Due"})]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>f("cash_due"),className:"flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 ".concat("cash_due"===a?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 text-indigo-700 shadow-[0_4px_12px_-2px_rgba(99,102,241,0.2)]":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)(Ve,{className:"h-5 w-5 ".concat("cash_due"===a?"text-indigo-600":"text-slate-500")}),(0,Pe.jsx)(Be,{className:"h-5 w-5 ".concat("cash_due"===a?"text-indigo-600":"text-slate-500")})]}),(0,Pe.jsx)("span",{className:"font-semibold",children:"Cash + Due"})]})]})]}),(0,Pe.jsxs)("div",{className:"space-y-3",children:["cash_online"===a&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"cashAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Cash Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"cashAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:l,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter cash amount",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"onlineAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Online Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"onlineAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:d,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter online amount",required:!0})]})]}),"online_due"===a&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"onlineAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Online Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"onlineAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:d,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter online amount",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"dueAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Due Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"dueAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:h,onChange:e=>y(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter due amount",required:!0})]})]}),"cash_due"===a&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"cashAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Cash Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"cashAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:l,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter cash amount",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"dueAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Due Amount (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",id:"dueAmount",inputMode:"decimal",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:h,onChange:e=>y(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200/80 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Enter due amount",required:!0})]})]})]}),0!==b&&(0,Pe.jsx)("div",{className:"p-3 rounded-lg ".concat(Math.abs(b)<.01?"bg-green-50 border border-green-200":"bg-yellow-50 border border-yellow-200"),children:(0,Pe.jsx)("p",{className:"text-sm font-medium ".concat(Math.abs(b)<.01?"text-green-700":"text-yellow-700"),children:Math.abs(b)<.01?"\u2713 Amounts match total":"Remaining: \u20b9".concat(b.toFixed(2))})}),(0,Pe.jsxs)("div",{className:"flex justify-end gap-3 pt-6 pb-2",children:[(0,Pe.jsx)("button",{type:"button",onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 font-semibold hover:bg-slate-50 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-indigo-600 to-blue-600 text-white font-semibold shadow-[0_4px_12px_-2px_rgba(99,102,241,0.4)] hover:shadow-[0_6px_16px_-2px_rgba(99,102,241,0.5)] transition-all active:scale-[0.98]",disabled:Math.abs(b)>.01,children:"Confirm Split Payment"})]})]})]})]})})},gd=Ee("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),xd=Ee("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),yd=e=>{let{billItems:n,total:r,onClose:s,onSubmit:i,sellerUpiId:a,customers:o,useCustomName:l,customCustomerName:c,selectedCustomer:d,billingMobile:u,paymentMethod:h,sendWhatsAppInvoice:m,onCustomNameChange:f,onSelectedCustomerChange:p,onBillingMobileChange:g,onPaymentMethodChange:x,onSendWhatsAppInvoiceChange:y}=e;const[b,w]=(0,t.useState)(l||!1),[v,N]=(0,t.useState)(c||""),[S,A]=(0,t.useState)(d||""),[_,C]=(0,t.useState)(u||""),[I,E]=(0,t.useState)(h||"cash"),[T,j]=(0,t.useState)(m||!1),[k,D]=(0,t.useState)(!1),[P,R]=(0,t.useState)(null),[O,L]=(0,t.useState)(!0),[M,F]=(0,t.useState)(!1),[B,U]=(0,t.useState)([]),[z,q]=(0,t.useState)(""),[H,V]=(0,t.useState)(""),[W,G]=(0,t.useState)(""),[Y,X]=(0,t.useState)("");(0,t.useEffect)(()=>{f&&f(b),p&&p(S),g&&g(_),x&&x(I),y&&y(T)},[b,S,_,I,T]),(0,t.useEffect)(()=>{if(!b&&S){const e=o.find(e=>e.id===S||e.name===S);if(e){const t=It(e.mobileNumber||e.phone||e.phoneNumber||""),n=t.length>10?t.slice(-10):t;n&&(C(n),L(Et(n)),g&&g(n))}}else b||S||(C(""),L(!0),g&&g(""))},[S,b,o]);const Q=()=>{F(!1),U([]),w(!0),A(""),v&&""!==v.trim()||N("")};(()=>{if(v&&v.trim())return v.trim();if(b)return(v||"").trim();{const e=o.find(e=>e.name===S||e.id===S);e?e.name.trim():(S||"").trim()}})();return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25)] w-full max-w-md border border-slate-200/60 my-auto max-h-[95vh] flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 pb-4 flex-shrink-0 border-b border-slate-200/60",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"Complete Payment"}),(0,Pe.jsxs)("p",{className:"text-sm text-slate-500 mt-1",children:["Total: \u20b9",r.toFixed(2)]})]}),(0,Pe.jsx)("button",{onClick:s,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("div",{className:"overflow-y-auto flex-1 p-6",children:(0,Pe.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),q(""),V(""),G(""),X(""),_&&_.trim()){const e=_.replace(/\D/g,"");if(e.length>0){if(!O||10!==e.length)return void V("Please enter a valid 10-digit mobile number");if(!/^[6-9]\d{9}$/.test(e))return void V("Please enter a valid 10-digit mobile number starting with 6-9")}}let t="";if(v&&v.trim())t=v.trim();else if(b)t=(v||"").trim();else{const e=o.find(e=>e.name===S||e.id===S);t=e?e.name.trim():(S||"").trim()}const n=P||"split"===I,r=P?"split":I;if(("cash"!==r&&"upi"!==r&&"split"!==r||n)&&(!t||""===t||"Walk-in Customer"===t)){return void q(n?"Customer name is required for split payment":"Customer name is required")}if(n){const e=_.replace(/\D/g,"");if(!e||10!==e.length)return void V("Please enter a valid 10-digit mobile number for split payment");if(!/^[6-9]\d{9}$/.test(e))return void V("Please enter a valid 10-digit mobile number starting with 6-9")}if("due"===r||"credit"===r){const e=_.replace(/\D/g,"");if(!e||10!==e.length)return void V("Please enter a valid 10-digit mobile number for due payment");if(!t||""===t||"Walk-in Customer"===t)return void q("Customer name is required for due payment")}"upi"!==r||a?!n||P?i({useCustomName:b,customCustomerName:v,selectedCustomer:S,billingMobile:_,paymentMethod:r,sendWhatsAppInvoice:T,splitPaymentDetails:P}):G("Please configure split payment details"):X("Please add your UPI ID in Settings before accepting online payments")},className:"space-y-5",noValidate:!0,children:[(0,Pe.jsxs)("div",{className:"space-y-4",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-slate-900 flex items-center gap-2",children:[(0,Pe.jsx)(gd,{className:"h-5 w-5"}),"Customer Details"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,Pe.jsx)("input",{type:"checkbox",id:"customName",checked:b,onChange:e=>w(e.target.checked),className:"h-4 w-4 rounded",style:{accentColor:"var(--brand-primary)"}}),(0,Pe.jsx)("label",{htmlFor:"customName",className:"cursor-pointer text-slate-700",children:"Use custom name"})]}),b?(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"customerName",className:"block text-sm font-medium text-slate-700 mb-2",children:"Customer Name *"}),(0,Pe.jsx)("input",{type:"text",id:"customerName",value:v,onChange:e=>{N(e.target.value),z&&q("")},placeholder:"Enter customer name",className:"w-full px-4 py-3 rounded-xl border bg-white focus:outline-none focus:ring-2 transition-all text-slate-900 placeholder:text-slate-400 ".concat(z?"border-red-500 focus:ring-red-500/20 focus:border-red-500":"border-slate-200/80 focus:ring-indigo-500/20 focus:border-indigo-500")}),z&&(0,Pe.jsx)("p",{className:"text-xs mt-1.5 text-red-600",children:z})]}):(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"selectCustomer",className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Customer"}),(0,Pe.jsxs)("select",{id:"selectCustomer",value:S,onChange:e=>{A(e.target.value),z&&q("")},className:"w-full px-4 py-3 rounded-xl border bg-white focus:outline-none focus:ring-2 transition-all text-slate-900 ".concat(z?"border-red-500 focus:ring-red-500/20 focus:border-red-500":"border-slate-200/80 focus:ring-indigo-500/20 focus:border-indigo-500"),children:[(0,Pe.jsx)("option",{value:"",children:"Select customer"}),o.map(e=>{const t=e.mobileNumber||e.phone||"";return(0,Pe.jsxs)("option",{value:e.name,children:[e.name," ",t?"(".concat(t,")"):""," ",e.balanceDue||e.dueAmount?"- \u20b9".concat((e.dueAmount||e.balanceDue||0).toFixed(2)," due"):""]},e.id)})]}),z&&(0,Pe.jsx)("p",{className:"text-xs mt-1.5 text-red-600",children:z})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("label",{htmlFor:"mobile",className:"block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2",children:[(0,Pe.jsx)(xd,{className:"h-4 w-4"}),"Mobile Number",!b&&S&&(0,Pe.jsx)("span",{className:"text-xs text-slate-500 font-normal",children:"(Auto-filled from customer)"})]}),(0,Pe.jsx)("input",{type:"tel",id:"mobile",value:_,onChange:e=>{(e=>{if(!b&&S)return;const t=It(e);if(C(t),0===t.length)L(!0),F(!1),U([]),w(!1),A(""),N("");else{const e=Et(t);if(L(e),10===t.length&&Et(t)){const e=o.filter(e=>{const n=It(e.mobileNumber||e.phone||e.phoneNumber||"");return n===t&&10===n.length});e.length>0?(U(e),F(!0),w(!1)):(F(!1),U([]),w(!0),A(""),v&&""!==v.trim()||N(""))}else F(!1),U([])}g&&g(t)})(e.target.value),H&&V("")},placeholder:"Enter mobile number",disabled:!b&&S,className:"w-full px-4 py-3 rounded-xl border bg-white focus:outline-none focus:ring-2 transition-all text-slate-900 placeholder:text-slate-400 ".concat(!b&&S?"bg-slate-50 cursor-not-allowed opacity-75":""," ").concat(H||_&&!O?"border-red-500 focus:ring-red-500/20 focus:border-red-500":"border-slate-200/80 focus:ring-indigo-500/20 focus:border-indigo-500"),maxLength:10}),(H||_&&!O)&&(0,Pe.jsx)("p",{className:"text-xs mt-1.5 text-red-600",children:H||"Invalid mobile number"})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,Pe.jsx)("input",{type:"checkbox",id:"sendWhatsApp",checked:T,onChange:e=>j(e.target.checked),className:"h-4 w-4 rounded",style:{accentColor:"var(--brand-primary)"}}),(0,Pe.jsx)("label",{htmlFor:"sendWhatsApp",className:"cursor-pointer text-slate-700",children:"Send WhatsApp invoice"})]})]}),(0,Pe.jsxs)("div",{className:"space-y-4 pt-4 border-t border-slate-200/60",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-slate-900 flex items-center gap-2",children:[(0,Pe.jsx)(Ve,{className:"h-5 w-5"}),"Payment Method"]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("select",{value:P?"split":I,onChange:e=>{return t=e.target.value,q(""),V(""),G(""),X(""),void("split"===t?(D(!0),E("split")):(E(t),R(null),x&&x(t)));var t},className:"w-full px-4 py-3 rounded-xl border bg-white focus:outline-none focus:ring-2 transition-all text-slate-900 ".concat(W||Y?"border-red-500 focus:ring-red-500/20 focus:border-red-500":"border-slate-200/80 focus:ring-indigo-500/20 focus:border-indigo-500"),children:[(0,Pe.jsx)("option",{value:"cash",children:"Cash"}),(0,Pe.jsx)("option",{value:"upi",children:"Online Payment"}),(0,Pe.jsx)("option",{value:"due",children:"Due (Credit)"}),(0,Pe.jsx)("option",{value:"split",children:"Split Payment"})]}),Y&&(0,Pe.jsx)("p",{className:"text-xs mt-1.5 text-red-600",children:Y}),W&&(0,Pe.jsx)("p",{className:"text-xs mt-1.5 text-red-600",children:W})]}),P&&!W&&(0,Pe.jsx)("div",{className:"mt-3 p-3 rounded-lg bg-indigo-50 border border-indigo-200",children:(0,Pe.jsxs)("p",{className:"text-xs font-medium text-indigo-800",children:["Split Payment: ",P.cashAmount>0&&"Cash: \u20b9".concat(P.cashAmount.toFixed(2)," "),P.onlineAmount>0&&"Online: \u20b9".concat(P.onlineAmount.toFixed(2)," "),P.dueAmount>0&&"Due: \u20b9".concat(P.dueAmount.toFixed(2))]})})]}),(0,Pe.jsxs)("div",{className:"flex justify-end gap-3 pt-6 pb-2",children:[(0,Pe.jsx)("button",{type:"button",onClick:s,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 font-semibold hover:bg-slate-50 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-indigo-600 to-blue-600 text-white font-semibold shadow-[0_4px_12px_-2px_rgba(99,102,241,0.4)] hover:shadow-[0_6px_16px_-2px_rgba(99,102,241,0.5)] transition-all active:scale-[0.98]",children:"Generate Bill"})]})]})})]})}),k&&(0,Pe.jsx)(pd,{totalAmount:r,sellerUpiId:a,onClose:()=>{D(!1),P||(E("cash"),x&&x("cash"))},onSubmit:e=>{G("");const t=parseFloat(e.cashAmount)||0,n=parseFloat(e.onlineAmount)||0,r=parseFloat(e.dueAmount)||0;if(1===[t,n,r].filter(e=>e>0).length){let e="split";t>0&&0===n&&0===r?e="cash":n>0&&0===t&&0===r?e="upi":r>0&&0===t&&0===n&&(e="due"),R(null),E(e),x&&x(e)}else R(e),E("split"),x&&x("split");D(!1)}}),M&&B.length>0&&(0,Pe.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:Q,children:(0,Pe.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 20px 60px -12px rgba(0, 0, 0, 0.25)"},onClick:e=>e.stopPropagation(),children:[(0,Pe.jsx)("h3",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#111827"},children:"Customer Found"}),(0,Pe.jsxs)("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"20px"},children:["We found ",B.length," customer(s) with this mobile number. Select one or continue as new customer."]}),(0,Pe.jsx)("div",{style:{marginBottom:"20px"},children:B.map((e,t)=>{const n=It(e.mobileNumber||e.phone||e.phoneNumber||""),r=e.dueAmount||e.balanceDue||0;return(0,Pe.jsxs)("button",{type:"button",onClick:()=>(e=>{if(e){N(e.name);const t=It(e.mobileNumber||e.phone||e.phoneNumber||"");C(t),L(!0),w(!0),F(!1),U([]),g&&g(t)}})(e),style:{width:"100%",textAlign:"left",padding:"16px",marginBottom:"12px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.backgroundColor="#f3f4f6",e.target.style.borderColor="#3b82f6"},onMouseLeave:e=>{e.target.style.backgroundColor="#f9fafb",e.target.style.borderColor="#e5e7eb"},children:[(0,Pe.jsx)("div",{style:{fontWeight:"600",fontSize:"16px",color:"#111827",marginBottom:"8px"},children:e.name}),(0,Pe.jsxs)("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"4px"},children:["\ud83d\udcf1 Mobile: ",n]}),(0,Pe.jsxs)("div",{style:{fontSize:"14px",color:r>0?"#ea580c":"#6b7280",fontWeight:"500"},children:["Due Amount: \u20b9",r.toFixed(2)]})]},e.id||e._id||t)})}),(0,Pe.jsx)("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:(0,Pe.jsx)("button",{type:"button",onClick:Q,style:{padding:"10px 20px",backgroundColor:"#f3f4f6",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},children:"Continue as New Customer"})})]})})]})};var bd;!function(e){e[e.QR_CODE=0]="QR_CODE",e[e.AZTEC=1]="AZTEC",e[e.CODABAR=2]="CODABAR",e[e.CODE_39=3]="CODE_39",e[e.CODE_93=4]="CODE_93",e[e.CODE_128=5]="CODE_128",e[e.DATA_MATRIX=6]="DATA_MATRIX",e[e.MAXICODE=7]="MAXICODE",e[e.ITF=8]="ITF",e[e.EAN_13=9]="EAN_13",e[e.EAN_8=10]="EAN_8",e[e.PDF_417=11]="PDF_417",e[e.RSS_14=12]="RSS_14",e[e.RSS_EXPANDED=13]="RSS_EXPANDED",e[e.UPC_A=14]="UPC_A",e[e.UPC_E=15]="UPC_E",e[e.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"}(bd||(bd={}));var wd,vd,Nd=new Map([[bd.QR_CODE,"QR_CODE"],[bd.AZTEC,"AZTEC"],[bd.CODABAR,"CODABAR"],[bd.CODE_39,"CODE_39"],[bd.CODE_93,"CODE_93"],[bd.CODE_128,"CODE_128"],[bd.DATA_MATRIX,"DATA_MATRIX"],[bd.MAXICODE,"MAXICODE"],[bd.ITF,"ITF"],[bd.EAN_13,"EAN_13"],[bd.EAN_8,"EAN_8"],[bd.PDF_417,"PDF_417"],[bd.RSS_14,"RSS_14"],[bd.RSS_EXPANDED,"RSS_EXPANDED"],[bd.UPC_A,"UPC_A"],[bd.UPC_E,"UPC_E"],[bd.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function Sd(e){return Object.values(bd).includes(e)}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.URL=1]="URL"}(wd||(wd={})),function(e){e[e.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",e[e.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"}(vd||(vd={}));var Ad,_d=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[vd.SCAN_TYPE_CAMERA,vd.SCAN_TYPE_FILE],e}(),Cd=function(){function e(e,t){this.format=e,this.formatName=t}return e.prototype.toString=function(){return this.formatName},e.create=function(t){if(!Nd.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new e(t,Nd.get(t))},e}(),Id=function(){function e(){}return e.createFromText=function(e){return{decodedText:e,result:{text:e}}},e.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},e}();!function(e){e[e.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",e[e.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",e[e.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"}(Ad||(Ad={}));var Ed=function(){function e(){}return e.createFrom=function(e){return{errorMessage:e,type:Ad.UNKWOWN_ERROR}},e}(),Td=function(){function e(e){this.verbose=e}return e.prototype.log=function(e){this.verbose&&console.log(e)},e.prototype.warn=function(e){this.verbose&&console.warn(e)},e.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},e.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},e}();function jd(e){return"undefined"===typeof e||null===e}var kd,Dd=function(){function e(){}return e.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},e.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),Pd=function(){function e(){}return e.scanningStatus=function(){return"Scanning"},e.idleStatus=function(){return"Idle"},e.errorStatus=function(){return"Error"},e.permissionStatus=function(){return"Permission"},e.noCameraFoundErrorStatus=function(){return"No Cameras"},e.lastMatch=function(e){return"Last Match: ".concat(e)},e.codeScannerTitle=function(){return"Code Scanner"},e.cameraPermissionTitle=function(){return"Request Camera Permissions"},e.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},e.noCameraFound=function(){return"No camera found"},e.scanButtonStopScanningText=function(){return"Stop Scanning"},e.scanButtonStartScanningText=function(){return"Start Scanning"},e.torchOnButton=function(){return"Switch On Torch"},e.torchOffButton=function(){return"Switch Off Torch"},e.torchOnFailedMessage=function(){return"Failed to turn on torch"},e.torchOffFailedMessage=function(){return"Failed to turn off torch"},e.scanButtonScanningStarting=function(){return"Launching Camera..."},e.textIfCameraScanSelected=function(){return"Scan an Image File"},e.textIfFileScanSelected=function(){return"Scan using camera directly"},e.selectCamera=function(){return"Select Camera"},e.fileSelectionChooseImage=function(){return"Choose Image"},e.fileSelectionChooseAnother=function(){return"Choose Another"},e.fileSelectionNoImageSelected=function(){return"No image choosen"},e.anonymousCameraPrefix=function(){return"Anonymous Camera"},e.dragAndDropMessage=function(){return"Or drop an image to scan"},e.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},e.zoom=function(){return"zoom"},e.loadingImage=function(){return"Loading image..."},e.cameraScanAltText=function(){return"Camera based scan"},e.fileScanAltText=function(){return"Fule based scan"},e}(),Rd=function(){function e(){}return e.poweredBy=function(){return"Powered by "},e.reportIssues=function(){return"Report issues"},e}(),Od=function(){function e(){}return e.isMediaStreamConstraintsValid=function(e,t){if("object"!==typeof e){var n=typeof e;return t.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(n,"."),!0),!1}for(var r=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),s=0,i=Object.keys(e);s<i.length;s++){var a=i[s];if(r.has(a))return t.logError("".concat(a," is not supported videoConstaints."),!0),!1}return!0},e}(),Ld=n(2072),Md=function(){function e(e,t,n){if(this.formatMap=new Map([[bd.QR_CODE,Ld.BarcodeFormat.QR_CODE],[bd.AZTEC,Ld.BarcodeFormat.AZTEC],[bd.CODABAR,Ld.BarcodeFormat.CODABAR],[bd.CODE_39,Ld.BarcodeFormat.CODE_39],[bd.CODE_93,Ld.BarcodeFormat.CODE_93],[bd.CODE_128,Ld.BarcodeFormat.CODE_128],[bd.DATA_MATRIX,Ld.BarcodeFormat.DATA_MATRIX],[bd.MAXICODE,Ld.BarcodeFormat.MAXICODE],[bd.ITF,Ld.BarcodeFormat.ITF],[bd.EAN_13,Ld.BarcodeFormat.EAN_13],[bd.EAN_8,Ld.BarcodeFormat.EAN_8],[bd.PDF_417,Ld.BarcodeFormat.PDF_417],[bd.RSS_14,Ld.BarcodeFormat.RSS_14],[bd.RSS_EXPANDED,Ld.BarcodeFormat.RSS_EXPANDED],[bd.UPC_A,Ld.BarcodeFormat.UPC_A],[bd.UPC_E,Ld.BarcodeFormat.UPC_E],[bd.UPC_EAN_EXTENSION,Ld.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Ld)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=n;var r=this.createZXingFormats(e),s=new Map;s.set(Ld.DecodeHintType.POSSIBLE_FORMATS,r),s.set(Ld.DecodeHintType.TRY_HARDER,!1),this.hints=s}return e.prototype.decodeAsync=function(e){var t=this;return new Promise(function(n,r){try{n(t.decode(e))}catch(s){r(s)}})},e.prototype.decode=function(e){var t=new Ld.MultiFormatReader(this.verbose,this.hints),n=new Ld.HTMLCanvasElementLuminanceSource(e),r=new Ld.BinaryBitmap(new Ld.HybridBinarizer(n)),s=t.decode(r);return{text:s.text,format:Cd.create(this.toHtml5QrcodeSupportedFormats(s.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,n,r){e.set(t,n)}),e},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createZXingFormats=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var s=r[n];this.formatMap.has(s)?t.push(this.formatMap.get(s)):this.logger.logError("".concat(s," is not supported by")+"ZXingHtml5QrcodeShim")}return t},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),Fd=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},Bd=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Ud=function(){function e(t,n,r){if(this.formatMap=new Map([[bd.QR_CODE,"qr_code"],[bd.AZTEC,"aztec"],[bd.CODABAR,"codabar"],[bd.CODE_39,"code_39"],[bd.CODE_93,"code_93"],[bd.CODE_128,"code_128"],[bd.DATA_MATRIX,"data_matrix"],[bd.ITF,"itf"],[bd.EAN_13,"ean_13"],[bd.EAN_8,"ean_8"],[bd.PDF_417,"pdf417"],[bd.UPC_A,"upc_a"],[bd.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=r;var s=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(s),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){return"BarcodeDetector"in window&&"undefined"!==typeof new BarcodeDetector({formats:["qr_code"]})},e.prototype.decodeAsync=function(e){return Fd(this,void 0,void 0,function(){var t,n;return Bd(this,function(r){switch(r.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=r.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(n=this.selectLargestBarcode(t)).rawValue,format:Cd.create(this.toHtml5QrcodeSupportedFormats(n.format)),debugData:this.createDebugData()}]}})})},e.prototype.selectLargestBarcode=function(e){for(var t=null,n=0,r=0,s=e;r<s.length;r++){var i=s[r],a=i.boundingBox.width*i.boundingBox.height;a>n&&(n=a,t=i)}if(!t)throw"No largest barcode found";return t},e.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var s=r[n];this.formatMap.has(s)?t.push(this.formatMap.get(s)):this.logger.warn("".concat(s," is not supported by")+"BarcodeDetectorDelegate")}return{formats:t}},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,n,r){e.set(t,n)}),e},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),zd=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},qd=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Hd=function(){function e(e,t,n,r){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=n,t&&Ud.isSupported()?(this.primaryDecoder=new Ud(e,n,r),this.secondaryDecoder=new Md(e,n,r)):this.primaryDecoder=new Md(e,n,r)}return e.prototype.decodeAsync=function(e){return zd(this,void 0,void 0,function(){var t;return qd(this,function(n){switch(n.label){case 0:t=performance.now(),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,n.sent()];case 3:return this.possiblyLogPerformance(t),[7];case 4:return[2]}})})},e.prototype.decodeRobustlyAsync=function(e){return zd(this,void 0,void 0,function(){var t,n;return qd(this,function(r){switch(r.label){case 0:t=performance.now(),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,r.sent()];case 3:if(n=r.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw n;case 4:return this.possiblyLogPerformance(t),[7];case 5:return[2]}})})},e.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(e){if(this.verbose){var t=performance.now()-e;this.executionResults.push(t),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,n=this.executionResults;t<n.length;t++){e+=n[t]}var r=e/this.executionResults.length;console.log("".concat(r," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},e}(),Vd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wd=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},Gd=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Yd=function(){function e(e,t){this.name=e,this.track=t}return e.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},e.prototype.apply=function(e){var t={};t[this.name]=e;var n={advanced:[t]};return this.track.applyConstraints(n)},e.prototype.value=function(){var e=this.track.getSettings();return this.name in e?e[this.name]:null},e}(),Xd=function(e){function t(t){return e.call(this,"zoom",t)||this}return Vd(t,e),t}(function(e){function t(t,n){return e.call(this,t,n)||this}return Vd(t,e),t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var t={};t[this.name]=e;var n={advanced:[t]};return this.track.applyConstraints(n)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities()[this.name];return{min:e.min,max:e.max,step:e.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(Yd)),Qd=function(e){function t(t){return e.call(this,"torch",t)||this}return Vd(t,e),t}(Yd),Kd=function(){function e(e){this.track=e}return e.prototype.zoomFeature=function(){return new Xd(this.track)},e.prototype.torchFeature=function(){return new Qd(this.track)},e}(),Zd=function(){function e(e,t,n){this.isClosed=!1,this.parentElement=e,this.mediaStream=t,this.callbacks=n,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return e.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width="".concat(e,"px"),t.style.display="block",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},e.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var t=function(){var n=e.surface.clientWidth,r=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(n,r),e.surface.removeEventListener("playing",t)};this.surface.addEventListener("playing",t),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(t,n,r,s){return Wd(this,void 0,void 0,function(){var i,a;return Gd(this,function(o){switch(o.label){case 0:return i=new e(t,n,s),r.aspectRatio?(a={aspectRatio:r.aspectRatio},[4,i.getFirstTrackOrFail().applyConstraints(a)]):[3,2];case 1:o.sent(),o.label=2;case 2:return i.setupSurface(),[2,i]}})})},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(e){this.failIfClosed();var t=this,n=function(){setTimeout(e,200),t.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(e){return Wd(this,void 0,void 0,function(){return Gd(this,function(t){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(t,n){var r=e.mediaStream.getVideoTracks().length,s=0;e.mediaStream.getVideoTracks().forEach(function(n){e.mediaStream.removeTrack(n),n.stop(),++s>=r&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),t())})})},e.prototype.getCapabilities=function(){return new Kd(this.getFirstTrackOrFail())},e}(),Jd=function(){function e(e){this.mediaStream=e}return e.prototype.render=function(e,t,n){return Wd(this,void 0,void 0,function(){return Gd(this,function(r){return[2,Zd.create(e,this.mediaStream,t,n)]})})},e.create=function(t){return Wd(this,void 0,void 0,function(){var n;return Gd(this,function(r){switch(r.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return[2,new e(r.sent())]}})})},e}(),$d=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},eu=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},tu=function(){function e(){}return e.failIfNotSupported=function(){return $d(this,void 0,void 0,function(){return eu(this,function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]})})},e.prototype.create=function(e){return $d(this,void 0,void 0,function(){return eu(this,function(t){return[2,Jd.create(e)]})})},e}(),nu=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},ru=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},su=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var t=Dd.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(t=Dd.insecureContextCameraQueryError()),Promise.reject(t)},e.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var e=location.host.split(":")[0];return"127.0.0.1"===e||"localhost"===e},e.getCamerasFromMediaDevices=function(){return nu(this,void 0,void 0,function(){var e,t,n,r,s,i,a;return ru(this,function(o){switch(o.label){case 0:return e=function(e){for(var t=0,n=e.getVideoTracks();t<n.length;t++){var r=n[t];r.enabled=!1,r.stop(),e.removeTrack(r)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return t=o.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(n=o.sent(),r=[],s=0,i=n;s<i.length;s++)"videoinput"===(a=i[s]).kind&&r.push({id:a.deviceId,label:a.label});return e(t),[2,r]}})})},e.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,t){MediaStreamTrack.getSources(function(t){for(var n=[],r=0,s=t;r<s.length;r++){var i=s[r];"video"===i.kind&&n.push({id:i.id,label:i.label})}e(n)})})},e}();!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NOT_STARTED=1]="NOT_STARTED",e[e.SCANNING=2]="SCANNING",e[e.PAUSED=3]="PAUSED"}(kd||(kd={}));var iu,au=function(){function e(){this.state=kd.NOT_STARTED,this.onGoingTransactionNewState=kd.UNKNOWN}return e.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},e.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===kd.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=kd.UNKNOWN,this.directTransition(e)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===kd.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=kd.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==kd.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(e){switch(this.state){case kd.UNKNOWN:throw"Transition from unknown is not allowed";case kd.NOT_STARTED:this.failIfNewStateIs(e,[kd.PAUSED]);case kd.SCANNING:case kd.PAUSED:}},e.prototype.failIfNewStateIs=function(e,t){for(var n=0,r=t;n<r.length;n++){if(e===r[n])throw"Cannot transition from ".concat(this.state," to ").concat(e)}},e}(),ou=function(){function e(e){this.stateManager=e}return e.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},e.prototype.directTransition=function(e){this.stateManager.directTransition(e)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===kd.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==kd.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===kd.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===kd.PAUSED},e}(),lu=function(){function e(){}return e.create=function(){return new ou(new au)},e}(),cu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),du=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cu(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(_d),uu=function(){function e(e,t){this.logger=t,this.fps=du.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=du.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Od.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!jd(this.qrbox)},e.create=function(t,n){return new e(t,n)},e}(),hu=function(){function e(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");var n;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(n=t,this.verbose=!0===n.verbose,n.experimentalFeatures),this.logger=new Td(this.verbose),this.qrcode=new Hd(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(n),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=lu.create()}return e.prototype.start=function(e,t,n,r){var s,i=this;if(!e)throw"cameraIdOrConfig is required";if(!n||"function"!=typeof n)throw"qrCodeSuccessCallback is required and should be a function.";s=r||(this.verbose?this.logger.log:function(){});var a=uu.create(t,this.logger);this.clearElement();var o=!1;a.videoConstraints&&(a.isMediaStreamConstraintsValid()?o=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var l=o,c=document.getElementById(this.elementId);c.clientWidth?c.clientWidth:du.DEFAULT_WIDTH;c.style.position="relative",this.shouldScan=!0,this.element=c;var d=this,u=this.stateManagerProxy.startTransition(kd.SCANNING);return new Promise(function(t,r){var o=l?a.videoConstraints:d.createVideoConstraints(e);if(!o)return u.cancel(),void r("videoConstraints should be defined");var c={};l&&!a.aspectRatio||(c.aspectRatio=a.aspectRatio);var h={onRenderSurfaceReady:function(e,t){d.setupUi(e,t,a),d.isScanning=!0,d.foreverScan(a,n,s)}};tu.failIfNotSupported().then(function(e){e.create(o).then(function(e){return e.render(i.element,c,h).then(function(e){d.renderedCamera=e,u.execute(),t(null)}).catch(function(e){u.cancel(),r(e)})}).catch(function(e){u.cancel(),r(Dd.errorGettingUserMedia(e))})}).catch(function(e){u.cancel(),r(Dd.cameraStreamingNotSupported())})})},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(kd.PAUSED),this.showPausedState(),(jd(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(kd.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume(function(){t()}):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(kd.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var n=this;return this.renderedCamera.close().then(function(){return n.renderedCamera=null,n.element&&(n.element.removeChild(n.canvasElement),n.canvasElement=null),function(){if(e.element){var t=document.getElementById(du.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}}(),n.qrRegion&&(n.qrRegion=null),n.context&&(n.context=null),t.execute(),n.hidePausedState(),n.isScanning=!1,Promise.resolve()})},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then(function(e){return e.decodedText})},e.prototype.scanFileV2=function(e,t){var n=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(jd(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(r,s){n.possiblyCloseLastScanImageFile(),n.clearElement(),n.lastScanImageFile=URL.createObjectURL(e);var i=new Image;i.onload=function(){var e=i.width,a=i.height,o=document.getElementById(n.elementId),l=o.clientWidth?o.clientWidth:du.DEFAULT_WIDTH,c=Math.max(o.clientHeight?o.clientHeight:a,du.FILE_SCAN_MIN_HEIGHT),d=n.computeCanvasDrawConfig(e,a,l,c);if(t){var u=n.createCanvasElement(l,c,"qr-canvas-visible");u.style.display="inline-block",o.appendChild(u);var h=u.getContext("2d");if(!h)throw"Unable to get 2d context from canvas";h.canvas.width=l,h.canvas.height=c,h.drawImage(i,0,0,e,a,d.x,d.y,d.width,d.height)}var m=du.FILE_SCAN_HIDDEN_CANVAS_PADDING,f=Math.max(i.width,d.width),p=Math.max(i.height,d.height),g=f+2*m,x=p+2*m,y=n.createCanvasElement(g,x);o.appendChild(y);var b=y.getContext("2d");if(!b)throw"Unable to get 2d context from canvas";b.canvas.width=g,b.canvas.height=x,b.drawImage(i,0,0,e,a,m,m,f,p);try{n.qrcode.decodeRobustlyAsync(y).then(function(e){r(Id.createFromQrcodeResult(e))}).catch(s)}catch(w){s("QR code parse error, error = ".concat(w))}},i.onerror=s,i.onabort=s,i.onstalled=s,i.onsuspend=s,i.src=URL.createObjectURL(e)})},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return su.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(!e)throw"videoConstaints is required argument.";if(!Od.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[bd.QR_CODE,bd.AZTEC,bd.CODABAR,bd.CODE_39,bd.CODE_93,bd.CODE_128,bd.DATA_MATRIX,bd.MAXICODE,bd.ITF,bd.EAN_13,bd.EAN_8,bd.PDF_417,bd.RSS_14,bd.RSS_EXPANDED,bd.UPC_A,bd.UPC_E,bd.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var n=[],r=0,s=e.formatsToSupport;r<s.length;r++){var i=s[r];Sd(i)?n.push(i):this.logger.warn("Invalid format: ".concat(i," passed in config, ignoring."))}if(0===n.length)throw"None of formatsToSupport match supported values.";return n},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(jd(e))return!0;if(!jd(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(jd(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!jd(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,n){var r=this,s=n.qrbox;this.validateQrboxConfig(s);var i,a=this.toQrdimensions(e,t,s),o=function(e){if(e<du.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(du.MIN_QR_BOX_SIZE,"px.")};o(a.width),o(a.height),a.width=((i=a.width)>e&&(r.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),i=e),i)},e.prototype.validateQrboxConfig=function(e){if("number"!==typeof e&&"function"!==typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,n){if("number"===typeof n)return{width:n,height:n};if("function"===typeof n)try{return n(e,t)}catch(r){throw new Error("qrbox config was passed as a function but it failed with unknown error"+r)}return n},e.prototype.setupUi=function(e,t,n){n.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,n);var r=jd(n.qrbox)?{width:e,height:t}:n.qrbox;this.validateQrboxConfig(r);var s=this.toQrdimensions(e,t,r);s.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var i=n.isShadedBoxEnabled()&&s.height<=t,a={x:0,y:0,width:e,height:t},o=i?this.getShadedRegionBounds(e,t,s):a,l=this.createCanvasElement(o.width,o.height),c=l.getContext("2d",{willReadFrequently:!0});c.canvas.width=o.width,c.canvas.height=o.height,this.element.append(l),i&&this.possiblyInsertShadingElement(this.element,e,t,s),this.createScannerPausedUiElement(this.element),this.qrRegion=o,this.context=c,this.canvasElement=l},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText=Dd.scannerPaused(),t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="rgba(9, 9, 9, 0.46)",t.style.color="#FFECEC",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var n=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(t){return e(t.text,Id.createFromQrcodeResult(t)),n.possiblyUpdateShaders(!0),!0}).catch(function(e){n.possiblyUpdateShaders(!1);var r=Dd.codeParseError(e);return t(r,Ed.createFrom(r)),!1})},e.prototype.foreverScan=function(e,t,n){var r=this;if(this.shouldScan&&this.renderedCamera){var s=this.renderedCamera.getSurface(),i=s.videoWidth/s.clientWidth,a=s.videoHeight/s.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var o=this.qrRegion.width*i,l=this.qrRegion.height*a,c=this.qrRegion.x*i,d=this.qrRegion.y*a;this.context.drawImage(s,c,d,o,l,0,0,this.qrRegion.width,this.qrRegion.height);var u=function(){r.foreverScanTimeout=setTimeout(function(){r.foreverScan(e,t,n)},r.getTimeoutFps(e.fps))};this.scanContext(t,n).then(function(s){s||!0===e.disableFlip?u():(r.context.translate(r.context.canvas.width,0),r.context.scale(-1,1),r.scanContext(t,n).finally(function(){u()}))}).catch(function(e){r.logger.logError("Error happend while scanning context",e),u()})}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",n="deviceId",r={user:!0,environment:!0},s="exact",i=function(e){if(e in r)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(e,"'")},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(a.length," keys");var o=Object.keys(e)[0];if(o!==t&&o!==n)throw"Only '".concat(t,"' and '").concat(n,"' ")+" are supported for 'cameraIdOrConfig'";if(o!==t){var l=e.deviceId;if("string"==typeof l)return{deviceId:l};if("object"==typeof l){if(s in l)return{deviceId:{exact:l["".concat(s)]}};throw"'deviceId' should be string or object with"+" ".concat(s," as key.")}throw"Invalid type of 'deviceId' = ".concat(typeof l)}var c=e.facingMode;if("string"==typeof c){if(i(c))return{facingMode:c}}else{if("object"!=typeof c)throw"Invalid type of 'facingMode' = ".concat(typeof c);if(!(s in c))throw"'facingMode' should be string or object with"+" ".concat(s," as key.");if(i(c["".concat(s)]))return{facingMode:{exact:c["".concat(s)]}}}}throw"Invalid type of 'cameraIdOrConfig' = ".concat(typeof e)},e.prototype.computeCanvasDrawConfig=function(e,t,n,r){if(e<=n&&t<=r)return{x:(n-e)/2,y:(r-t)/2,width:e,height:t};var s=e,i=t;return e>n&&(t*=n/e,e=n),t>r&&(e*=r/t,t=r),this.logger.log("Image downsampled from "+"".concat(s,"X").concat(i)+" to ".concat(e,"X").concat(t,".")),this.computeCanvasDrawConfig(e,t,n,r)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(t){t.style.backgroundColor=e?du.BORDER_SHADER_MATCH_COLOR:du.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,n){var r=e,s=t,i=document.createElement("canvas");return i.style.width="".concat(r,"px"),i.style.height="".concat(s,"px"),i.style.display="none",i.id=jd(n)?"qr-canvas":n,i},e.prototype.getShadedRegionBounds=function(e,t,n){if(n.width>e||n.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-n.width)/2,y:(t-n.height)/2,width:n.width,height:n.height}},e.prototype.possiblyInsertShadingElement=function(e,t,n,r){if(!(t-r.width<1||n-r.height<1)){var s=document.createElement("div");s.style.position="absolute";var i=(t-r.width)/2,a=(n-r.height)/2;if(s.style.borderLeft="".concat(i,"px solid rgba(0, 0, 0, 0.48)"),s.style.borderRight="".concat(i,"px solid rgba(0, 0, 0, 0.48)"),s.style.borderTop="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),s.style.borderBottom="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),s.style.boxSizing="border-box",s.style.top="0px",s.style.bottom="0px",s.style.left="0px",s.style.right="0px",s.id="".concat(du.SHADED_REGION_ELEMENT_ID),t-r.width<11||n-r.height<11)this.hasBorderShaders=!1;else{var o=40;this.insertShaderBorders(s,o,5,-5,null,0,!0),this.insertShaderBorders(s,o,5,-5,null,0,!1),this.insertShaderBorders(s,o,5,null,-5,0,!0),this.insertShaderBorders(s,o,5,null,-5,0,!1),this.insertShaderBorders(s,5,45,-5,null,-5,!0),this.insertShaderBorders(s,5,45,null,-5,-5,!0),this.insertShaderBorders(s,5,45,-5,null,-5,!1),this.insertShaderBorders(s,5,45,null,-5,-5,!1),this.hasBorderShaders=!0}e.append(s)}},e.prototype.insertShaderBorders=function(e,t,n,r,s,i,a){var o=document.createElement("div");o.style.position="absolute",o.style.backgroundColor=du.BORDER_SHADER_DEFAULT_COLOR,o.style.width="".concat(t,"px"),o.style.height="".concat(n,"px"),null!==r&&(o.style.top="".concat(r,"px")),null!==s&&(o.style.bottom="".concat(s,"px")),a?o.style.left="".concat(i,"px"):o.style.right="".concat(i,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(o),e.appendChild(o)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}(),mu="data:image/svg+xml;base64,",fu=mu+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",pu=mu+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",gu=mu+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",xu=function(){function e(){}return e.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},e}(),yu=function(){function e(){this.data=xu.createDefault();var t=localStorage.getItem(e.LOCAL_STORAGE_KEY);t?this.data=JSON.parse(t):this.reset()}return e.prototype.hasCameraPermissions=function(){return this.data.hasPermission},e.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},e.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},e.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},e.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},e.prototype.reset=function(){this.data=xu.createDefault(),this.flush()},e.prototype.flush=function(){localStorage.setItem(e.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},e.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",e}(),bu=function(){function e(){this.infoDiv=document.createElement("div")}return e.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=Rd.poweredBy();var t=document.createElement("a");t.innerText="ScanApp",t.href="https://scanapp.org",t.target="new",t.style.color="white",this.infoDiv.appendChild(t);var n=document.createElement("br"),r=document.createElement("br");this.infoDiv.appendChild(n),this.infoDiv.appendChild(r);var s=document.createElement("a");s.innerText=Rd.reportIssues(),s.href="https://github.com/mebjas/html5-qrcode/issues",s.target="new",s.style.color="white",this.infoDiv.appendChild(s),e.appendChild(this.infoDiv)},e.prototype.show=function(){this.infoDiv.style.display="block"},e.prototype.hide=function(){this.infoDiv.style.display="none"},e}(),wu=function(){function e(e,t){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=t,this.infoIcon=document.createElement("img")}return e.prototype.renderInto=function(e){var t=this;this.infoIcon.alt="Info icon",this.infoIcon.src=gu,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(e){return t.onHoverIn()},this.infoIcon.onmouseout=function(e){return t.onHoverOut()},this.infoIcon.onclick=function(e){return t.onClick()},e.appendChild(this.infoIcon)},e.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},e.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},e.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=gu,this.infoIcon.style.opacity="0.6")},e}(),vu=function(){function e(){var e=this;this.infoDiv=new bu,this.infoIcon=new wu(function(){e.infoDiv.show()},function(){e.infoDiv.hide()})}return e.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},e}(),Nu=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},Su=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Au=function(){function e(){}return e.hasPermissions=function(){return Nu(this,void 0,void 0,function(){var e,t,n,r;return Su(this,function(s){switch(s.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(e=s.sent(),t=0,n=e;t<n.length;t++)if("videoinput"===(r=n[t]).kind&&r.label)return[2,!0];return[2,!1]}})})},e}(),_u=function(){function e(e){this.supportedScanTypes=this.validateAndReturnScanTypes(e)}return e.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},e.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},e.prototype.isCameraScanRequired=function(){for(var t=0,n=this.supportedScanTypes;t<n.length;t++){var r=n[t];if(e.isCameraScanType(r))return!0}return!1},e.isCameraScanType=function(e){return e===vd.SCAN_TYPE_CAMERA},e.isFileScanType=function(e){return e===vd.SCAN_TYPE_FILE},e.prototype.validateAndReturnScanTypes=function(e){if(!e||0===e.length)return _d.DEFAULT_SUPPORTED_SCAN_TYPE;var t=_d.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(e.length>t)throw"Max ".concat(t," values expected for ")+"supportedScanTypes";for(var n=0,r=e;n<r.length;n++){var s=r[n];if(!_d.DEFAULT_SUPPORTED_SCAN_TYPE.includes(s))throw"Unsupported scan type ".concat(s)}return e},e}(),Cu=function(){function e(){}return e.ALL_ELEMENT_CLASS="html5-qrcode-element",e.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",e.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",e.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",e.TORCH_BUTTON_ID="html5-qrcode-button-torch",e.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",e.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",e.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",e.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",e.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",e.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",e}(),Iu=function(){function e(){}return e.createElement=function(e,t){var n=document.createElement(e);return n.id=t,n.classList.add(Cu.ALL_ELEMENT_CLASS),"button"===e&&n.setAttribute("type","button"),n},e}(),Eu=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(qb){i(qb)}}function o(e){try{l(r.throw(e))}catch(qb){i(qb)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})},Tu=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(qb){o=[6,qb],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},ju=function(){function e(e,t,n){this.isTorchOn=!1,this.torchCapability=e,this.buttonController=t,this.onTorchActionFailureCallback=n}return e.prototype.isTorchEnabled=function(){return this.isTorchOn},e.prototype.flipState=function(){return Eu(this,void 0,void 0,function(){var e,t;return Tu(this,function(n){switch(n.label){case 0:this.buttonController.disable(),e=!this.isTorchOn,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.torchCapability.apply(e)];case 2:return n.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),e),[3,4];case 3:return t=n.sent(),this.propagateFailure(e,t),this.buttonController.enable(),[3,4];case 4:return[2]}})})},e.prototype.updateUiBasedOnLatestSettings=function(e,t){e===t?(this.buttonController.setText(t?Pd.torchOffButton():Pd.torchOnButton()),this.isTorchOn=t):this.propagateFailure(t),this.buttonController.enable()},e.prototype.propagateFailure=function(e,t){var n=e?Pd.torchOnFailedMessage():Pd.torchOffFailedMessage();t&&(n+="; Error = "+t),this.onTorchActionFailureCallback(n)},e.prototype.reset=function(){this.isTorchOn=!1},e}(),ku=function(){function e(e,t){this.onTorchActionFailureCallback=t,this.torchButton=Iu.createElement("button",Cu.TORCH_BUTTON_ID),this.torchController=new ju(e,this,t)}return e.prototype.render=function(e,t){var n=this;this.torchButton.innerText=Pd.torchOnButton(),this.torchButton.style.display=t.display,this.torchButton.style.marginLeft=t.marginLeft;var r=this;this.torchButton.addEventListener("click",function(e){return Eu(n,void 0,void 0,function(){return Tu(this,function(e){switch(e.label){case 0:return[4,r.torchController.flipState()];case 1:return e.sent(),r.torchController.isTorchEnabled()?(r.torchButton.classList.remove(Cu.TORCH_BUTTON_CLASS_TORCH_OFF),r.torchButton.classList.add(Cu.TORCH_BUTTON_CLASS_TORCH_ON)):(r.torchButton.classList.remove(Cu.TORCH_BUTTON_CLASS_TORCH_ON),r.torchButton.classList.add(Cu.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),e.appendChild(this.torchButton)},e.prototype.updateTorchCapability=function(e){this.torchController=new ju(e,this,this.onTorchActionFailureCallback)},e.prototype.getTorchButton=function(){return this.torchButton},e.prototype.hide=function(){this.torchButton.style.display="none"},e.prototype.show=function(){this.torchButton.style.display="inline-block"},e.prototype.disable=function(){this.torchButton.disabled=!0},e.prototype.enable=function(){this.torchButton.disabled=!1},e.prototype.setText=function(e){this.torchButton.innerText=e},e.prototype.reset=function(){this.torchButton.innerText=Pd.torchOnButton(),this.torchController.reset()},e.create=function(t,n,r,s){var i=new e(n,s);return i.render(t,r),i},e}(),Du=function(){function e(e,t,n){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=t?"block":"none",e.appendChild(this.fileBasedScanRegion);var r=document.createElement("label");r.setAttribute("for",this.getFileScanInputId()),r.style.display="inline-block",this.fileBasedScanRegion.appendChild(r),this.fileSelectionButton=Iu.createElement("button",Cu.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(e){r.click()}),r.append(this.fileSelectionButton),this.fileScanInput=Iu.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",r.appendChild(this.fileScanInput);var s=this;this.fileScanInput.addEventListener("change",function(e){if(null!=e&&null!=e.target){var t=e.target;if(!t.files||0!==t.files.length){var r=t.files[0],i=r.name;s.setImageNameToButton(i),n(r)}}});var i=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(i),this.fileBasedScanRegion.addEventListener("dragenter",function(e){s.fileBasedScanRegion.style.border=s.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(e){s.fileBasedScanRegion.style.border=s.fileBasedScanRegionDefaultBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(e){s.fileBasedScanRegion.style.border=s.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),s.fileBasedScanRegion.style.border=s.fileBasedScanRegionDefaultBorder();var t=e.dataTransfer;if(t){var r=t.files;if(!r||0===r.length)return;for(var a=!1,o=0;o<r.length;++o){var l=r.item(o);if(l){if(l.type.match(/image.*/)){a=!0;var c=l.name;s.setImageNameToButton(c),n(l),i.innerText=Pd.dragAndDropMessage();break}}}a||(i.innerText=Pd.dragAndDropMessageOnlyImages())}})}return e.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},e.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},e.prototype.isShowing=function(){return"block"===this.fileBasedScanRegion.style.display},e.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},e.prototype.createFileBasedScanRegion=function(){var e=document.createElement("div");return e.style.textAlign="center",e.style.margin="auto",e.style.width="80%",e.style.maxWidth="600px",e.style.border=this.fileBasedScanRegionDefaultBorder(),e.style.padding="10px",e.style.marginBottom="10px",e},e.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},e.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},e.prototype.createDragAndDropMessage=function(){var e=document.createElement("div");return e.innerText=Pd.dragAndDropMessage(),e.style.fontWeight="400",e},e.prototype.setImageNameToButton=function(e){if(e.length>20){var t=e.substring(0,8),n=e.length,r=e.substring(n-8,n);e="".concat(t,"....").concat(r)}var s=Pd.fileSelectionChooseAnother()+" - "+e;this.fileSelectionButton.innerText=s},e.prototype.setInitialValueToButton=function(){var e=Pd.fileSelectionChooseImage()+" - "+Pd.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=e},e.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},e.create=function(t,n,r){return new e(t,n,r)},e}(),Pu=function(){function e(e){this.selectElement=Iu.createElement("select",Cu.CAMERA_SELECTION_SELECT_ID),this.cameras=e,this.options=[]}return e.prototype.render=function(e){var t=document.createElement("span");t.style.marginRight="10px";var n=this.cameras.length;if(0===n)throw new Error("No cameras found");if(1===n)t.style.display="none";else{var r=Pd.selectCamera();t.innerText="".concat(r," (").concat(this.cameras.length,")  ")}for(var s=1,i=0,a=this.cameras;i<a.length;i++){var o=a[i],l=o.id,c=null==o.label?l:o.label;c&&""!==c||(c=[Pd.anonymousCameraPrefix(),s++].join(" "));var d=document.createElement("option");d.value=l,d.innerText=c,this.options.push(d),this.selectElement.appendChild(d)}t.appendChild(this.selectElement),e.appendChild(t)},e.prototype.disable=function(){this.selectElement.disabled=!0},e.prototype.isDisabled=function(){return!0===this.selectElement.disabled},e.prototype.enable=function(){this.selectElement.disabled=!1},e.prototype.getValue=function(){return this.selectElement.value},e.prototype.hasValue=function(e){for(var t=0,n=this.options;t<n.length;t++){if(n[t].value===e)return!0}return!1},e.prototype.setValue=function(e){if(!this.hasValue(e))throw new Error("".concat(e," is not present in the camera list."));this.selectElement.value=e},e.prototype.hasSingleItem=function(){return 1===this.cameras.length},e.prototype.numCameras=function(){return this.cameras.length},e.create=function(t,n){var r=new e(n);return r.render(t),r},e}(),Ru=function(){function e(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=Iu.createElement("input",Cu.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return e.prototype.render=function(e,t){this.zoomElementContainer.style.display=t?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",e.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var n=Pd.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(n),this.rangeText.style.marginRight="10px";var r=this;this.rangeInput.addEventListener("input",function(){return r.onValueChange()}),this.rangeInput.addEventListener("change",function(){return r.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},e.prototype.onValueChange=function(){var e=Pd.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(e),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},e.prototype.setValues=function(e,t,n,r){this.rangeInput.min=e.toString(),this.rangeInput.max=t.toString(),this.rangeInput.step=r.toString(),this.rangeInput.value=n.toString(),this.onValueChange()},e.prototype.show=function(){this.zoomElementContainer.style.display="block"},e.prototype.hide=function(){this.zoomElementContainer.style.display="none"},e.prototype.setOnCameraZoomValueChangeCallback=function(e){this.onChangeCallback=e},e.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},e.create=function(t,n){var r=new e;return r.render(t,n),r},e}();!function(e){e[e.STATUS_DEFAULT=0]="STATUS_DEFAULT",e[e.STATUS_SUCCESS=1]="STATUS_SUCCESS",e[e.STATUS_WARNING=2]="STATUS_WARNING",e[e.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"}(iu||(iu={}));!function(){function e(e,t,n){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===n,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.scanTypeSelector=new _u(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new Td(this.verbose),this.persistedDataManager=new yu,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}e.prototype.render=function(e,t){var n=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(t,r){if(e)e(t,r);else{if(n.lastMatchFound===t)return;n.lastMatchFound=t,n.setHeaderMessage(Pd.lastMatch(t),iu.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(e,n){t&&t(e,n)};var r,s,i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id=".concat(this.elementId," not found");i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new hu(this.getScanRegionId(),(r=this.config,s=this.verbose,{formatsToSupport:r.formatsToSupport,useBarCodeDetectorIfSupported:r.useBarCodeDetectorIfSupported,experimentalFeatures:r.experimentalFeatures,verbose:s}))},e.prototype.pause=function(e){(jd(e)||!0!==e)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)},e.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},e.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},e.prototype.clear=function(){var e=this,t=function(){var t=document.getElementById(e.elementId);t&&(t.innerHTML="",e.resetBasicLayout(t))};return this.html5Qrcode?new Promise(function(n,r){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then(function(r){e.html5Qrcode?(e.html5Qrcode.clear(),t(),n()):n()}).catch(function(t){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",t),r(t)}):(e.html5Qrcode.clear(),t(),n()):n()}):Promise.resolve()},e.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},e.prototype.applyVideoConstraints=function(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)},e.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},e.prototype.createConfig=function(e){return e?(e.fps||(e.fps=_d.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!_d.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=_d.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=_d.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:_d.SCAN_DEFAULT_FPS,rememberLastUsedCamera:_d.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:_d.DEFAULT_SUPPORTED_SCAN_TYPE}},e.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div"),n=this.getScanRegionId();t.id=n,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),_u.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var r=document.createElement("div"),s=this.getDashboardId();r.id=s,r.style.width="100%",e.appendChild(r),this.setupInitialDashboard(r)},e.prototype.resetBasicLayout=function(e){e.style.border="none"},e.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},e.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new vu).renderInto(t);var n=document.createElement("div");n.id=this.getHeaderMessageContainerId(),n.style.display="none",n.style.textAlign="center",n.style.fontSize="14px",n.style.padding="2px 10px",n.style.margin="4px",n.style.borderTop="1px solid #f6f6f6",t.appendChild(n)},e.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},e.prototype.createCameraListUi=function(e,t,n){var r=this;r.showHideScanTypeSwapLink(!1),r.setHeaderMessage(Pd.cameraPermissionRequesting());var s=function(){n||r.createPermissionButton(e,t)};hu.getCameras().then(function(n){r.persistedDataManager.setHasPermission(!0),r.showHideScanTypeSwapLink(!0),r.resetHeaderMessage(),n&&n.length>0?(e.removeChild(t),r.renderCameraSelection(n)):(r.setHeaderMessage(Pd.noCameraFound(),iu.STATUS_WARNING),s())}).catch(function(e){r.persistedDataManager.setHasPermission(!1),n?n.disabled=!1:s(),r.setHeaderMessage(e,iu.STATUS_WARNING),r.showHideScanTypeSwapLink(!0)})},e.prototype.createPermissionButton=function(e,t){var n=this,r=Iu.createElement("button",this.getCameraPermissionButtonId());r.innerText=Pd.cameraPermissionTitle(),r.addEventListener("click",function(){r.disabled=!0,n.createCameraListUi(e,t,r)}),t.appendChild(r)},e.prototype.createPermissionsUi=function(e,t){var n=this;_u.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?Au.hasPermissions().then(function(r){r?n.createCameraListUi(e,t):(n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t))}).catch(function(r){n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t)}):this.createPermissionButton(e,t)},e.prototype.createSectionControlPanel=function(){var e=document.getElementById(this.getDashboardSectionId()),t=document.createElement("div");e.appendChild(t);var n=document.createElement("div");n.id=this.getDashboardSectionCameraScanRegionId(),n.style.display=_u.isCameraScanType(this.currentScanType)?"block":"none",t.appendChild(n);var r=document.createElement("div");r.style.textAlign="center",n.appendChild(r),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(n,r),this.renderFileScanUi(t)},e.prototype.renderFileScanUi=function(e){var t=_u.isFileScanType(this.currentScanType),n=this;this.fileSelectionUi=Du.create(e,t,function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";_u.isFileScanType(n.currentScanType)&&(n.setHeaderMessage(Pd.loadingImage()),n.html5Qrcode.scanFileV2(e,!0).then(function(e){n.resetHeaderMessage(),n.qrCodeSuccessCallback(e.decodedText,e)}).catch(function(e){n.setHeaderMessage(e,iu.STATUS_WARNING),n.qrCodeErrorCallback(e,Ed.createFrom(e))}))})},e.prototype.renderCameraSelection=function(e){var t=this,n=this,r=document.getElementById(this.getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var s=Ru.create(r,!1),i=Pu.create(r,e),a=document.createElement("span"),o=Iu.createElement("button",Cu.CAMERA_START_BUTTON_ID);o.innerText=Pd.scanButtonStartScanningText(),a.appendChild(o);var l,c=Iu.createElement("button",Cu.CAMERA_STOP_BUTTON_ID);c.innerText=Pd.scanButtonStopScanningText(),c.style.display="none",c.disabled=!0,a.appendChild(c);r.appendChild(a);var d=function(e){e||(o.style.display="none"),o.innerText=Pd.scanButtonStartScanningText(),o.style.opacity="1",o.disabled=!1,e&&(o.style.display="inline-block")};if(o.addEventListener("click",function(e){o.innerText=Pd.scanButtonScanningStarting(),i.disable(),o.disabled=!0,o.style.opacity="0.5",t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var r,u=i.getValue();n.persistedDataManager.setLastUsedCameraId(u),n.html5Qrcode.start(u,(r=n.config,{fps:r.fps,qrbox:r.qrbox,aspectRatio:r.aspectRatio,disableFlip:r.disableFlip,videoConstraints:r.videoConstraints}),n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then(function(e){c.disabled=!1,c.style.display="inline-block",d(!1);var r=n.html5Qrcode.getRunningTrackCameraCapabilities();!0===t.config.showTorchButtonIfSupported&&function(e){e.torchFeature().isSupported()?(l?l.updateTorchCapability(e.torchFeature()):l=ku.create(a,e.torchFeature(),{display:"none",marginLeft:"5px"},function(e){n.setHeaderMessage(e,iu.STATUS_WARNING)}),l.show()):l&&l.hide()}(r),!0===t.config.showZoomSliderIfSupported&&function(e){var n=e.zoomFeature();if(n.isSupported()){s.setOnCameraZoomValueChangeCallback(function(e){n.apply(e)});var r,i,a,o=1;t.config.defaultZoomValueIfSupported&&(o=t.config.defaultZoomValueIfSupported),r=o,i=n.min(),o=r>(a=n.max())?a:r<i?i:r,s.setValues(n.min(),n.max(),o,n.step()),s.show()}}(r)}).catch(function(e){n.showHideScanTypeSwapLink(!0),i.enable(),d(!0),n.setHeaderMessage(e,iu.STATUS_WARNING)})}),i.hasSingleItem()&&o.click(),c.addEventListener("click",function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";c.disabled=!0,n.html5Qrcode.stop().then(function(e){t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),i.enable(),o.disabled=!1,c.style.display="none",o.style.display="inline-block",l&&(l.reset(),l.hide()),s.removeOnCameraZoomValueChangeCallback(),s.hide(),n.insertCameraScanImageToScanRegion()}).catch(function(e){c.disabled=!1,n.setHeaderMessage(e,iu.STATUS_WARNING)})}),n.persistedDataManager.getLastUsedCameraId()){var u=n.persistedDataManager.getLastUsedCameraId();i.hasValue(u)?(i.setValue(u),o.click()):n.persistedDataManager.resetLastUsedCameraId()}},e.prototype.createSectionSwap=function(){var e=this,t=Pd.textIfCameraScanSelected(),n=Pd.textIfFileScanSelected(),r=document.getElementById(this.getDashboardSectionId()),s=document.createElement("div");s.style.textAlign="center";var i=Iu.createElement("span",this.getDashboardSectionSwapLinkId());i.style.textDecoration="underline",i.style.cursor="pointer",i.innerText=_u.isCameraScanType(this.currentScanType)?t:n,i.addEventListener("click",function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,_u.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),i.innerText=n,e.currentScanType=vd.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),i.innerText=t,e.currentScanType=vd.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")}),s.appendChild(i),r.appendChild(s)},e.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var e=this,t=this;this.persistedDataManager.hasCameraPermissions()&&Au.hasPermissions().then(function(n){if(n){var r=document.getElementById(t.getCameraPermissionButtonId());if(!r)throw e.logger.logError("Permission button not found, fail;"),"Permission button not found";r.click()}else t.persistedDataManager.setHasPermission(!1)}).catch(function(e){t.persistedDataManager.setHasPermission(!1)})},e.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},e.prototype.setHeaderMessage=function(e,t){t||(t=iu.STATUS_DEFAULT);var n=this.getHeaderMessageDiv();switch(n.innerText=e,n.style.display="block",t){case iu.STATUS_SUCCESS:n.style.background="rgba(106, 175, 80, 0.26)",n.style.color="#477735";break;case iu.STATUS_WARNING:n.style.background="rgba(203, 36, 49, 0.14)",n.style.color="#cb2431";break;case iu.STATUS_DEFAULT:default:n.style.background="rgba(0, 0, 0, 0)",n.style.color="rgb(17, 17, 17)"}},e.prototype.showHideScanTypeSwapLink=function(e){this.scanTypeSelector.hasMoreThanOneScanType()&&(!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none")},e.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=fu,this.cameraScanImage.alt=Pd.cameraScanAltText()},e.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=pu,this.fileScanImage.alt=Pd.fileScanAltText()},e.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},e.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},e.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},e.prototype.getDashboardSectionSwapLinkId=function(){return Cu.SCAN_TYPE_CHANGE_ANCHOR_ID},e.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},e.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},e.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},e.prototype.getCameraPermissionButtonId=function(){return Cu.CAMERA_PERMISSION_BUTTON_ID},e.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},e.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},e.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())}}();const Ou=Ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Lu=e=>{let{onScan:n,onClose:r}=e;const s=(0,t.useRef)(null),i=(0,t.useRef)(null),a=(0,t.useRef)("qr-reader-".concat(Math.random().toString(36).slice(2,10))),[o,l]=(0,t.useState)(""),[c,d]=(0,t.useState)([]),[u,h]=(0,t.useState)(0),[m,f]=(0,t.useState)(!1),p=(0,t.useRef)(n),g=(0,t.useRef)(r),x=(0,t.useRef)(!1),y=(0,t.useRef)(!1),b=(0,t.useRef)(null);(0,t.useEffect)(()=>{p.current=n,g.current=r},[n,r]);const w=async()=>{const e=s.current;if(e){try{var t;2===(null===(t=e.getState)||void 0===t?void 0:t.call(e))&&await e.stop()}catch(n){console.log("Scanner stop error:",n)}try{const t=e._localMediaStream;t&&"function"===typeof t.getTracks&&t.getTracks().forEach(e=>{try{e.stop()}catch(t){console.log("Track stop error:",t)}})}catch(r){console.log("Stream cleanup error:",r)}try{await e.clear()}catch(n){console.log("Scanner clear error:",n)}s.current=null,x.current=!1}},v=async e=>{l("");const t=i.current;if(!t||!t.isConnected)return console.error("Scanner container not ready"),void l("Camera preview is not ready. Please close and reopen the scanner.");y.current=!1,await w();const n=new hu(a.current);s.current=n;const r={fps:10,qrbox:{width:320,height:150},aspectRatio:2,supportedScanTypes:[hu.SCAN_TYPE_CAMERA],useBarCodeDetectorIfSupported:!0,verbose:!1,disableFlip:!1,showTorchButtonIfSupported:!1,showZoomSliderIfSupported:!1,tryHarder:!0},o=e?{deviceId:{exact:e}}:{facingMode:"environment"},c=(e,t)=>{y.current||e&&e.trim()&&(y.current=!0,(()=>{try{if(!b.current){const e=window.AudioContext||window.webkitAudioContext;if(!e)return;b.current=new e}const e=b.current;"suspended"===e.state&&e.resume().catch(()=>{});const t=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.setValueAtTime(880,e.currentTime),n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.3,e.currentTime+.01),n.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.18),t.connect(n),n.connect(e.destination),t.start(e.currentTime),t.stop(e.currentTime+.2)}catch(e){console.log("Beep playback error:",e)}})(),p.current(e.trim()),w().finally(()=>{setTimeout(()=>g.current(),500)}))},d=e=>{e.includes("NotFound")||e.includes("parse error")||e.includes("No MultiFormat Readers")||e.includes("continuous scanning")||console.log("Scanning error:",e)};try{await n.start(o,r,c,d),x.current=!0}catch(f){console.error("Scanner startup error:",f);try{await n.clear().catch(()=>{});const e=new hu(a.current);s.current=e,await e.start(o,{fps:10,qrbox:{width:320,height:150}},c,()=>{}),x.current=!0}catch(v){var u,h,m;console.error("Fallback scanner failed:",v);let e="Camera not available. ";null!==v&&void 0!==v&&null!==(u=v.message)&&void 0!==u&&u.includes("Permission")?e+="Please allow camera access in your browser settings.":null!==v&&void 0!==v&&null!==(h=v.message)&&void 0!==h&&h.includes("NotFound")?e+="No camera found. Check if a camera is connected and free.":null!==v&&void 0!==v&&null!==(m=v.message)&&void 0!==m&&m.includes("NotAllowed")?e+="Camera access denied. Grant permission and refresh the page.":e+=(null===v||void 0===v?void 0:v.message)||"Unknown error",l(e),x.current=!1,await w()}}};(0,t.useEffect)(()=>{let e=!0;return(async()=>{try{const t=await hu.getCameras();if(!e)return;if(d(t||[]),t&&t.length>0){let e=0;const n=t.findIndex(e=>{const t=(e.label||"").toLowerCase();return t.includes("back")||t.includes("rear")||t.includes("environment")||t.includes("facing back")||t.includes("facing: back")});-1!==n&&(e=n),h(e),await v(t[e].id)}else await v()}catch(t){console.log("Unable to enumerate cameras:",t),await v()}})(),()=>{e=!1,w(),b.current&&b.current.close().catch(()=>{})}},[]);return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl z-10",children:[(0,Pe.jsx)("h2",{className:"text-lg sm:text-2xl font-bold text-gray-800",children:"Barcode Scanner"}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[c.length>1&&(0,Pe.jsx)("button",{onClick:async()=>{if(c.length<2||m)return;const e=(u+1)%c.length;f(!0);try{await v(c[e].id),h(e)}catch(t){console.error("Camera switch failed:",t)}finally{f(!1)}},disabled:m,className:"p-2 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition disabled:opacity-50",title:"Switch camera",children:(0,Pe.jsx)(Ou,{className:"h-5 w-5"})}),(0,Pe.jsx)("button",{onClick:async()=>{await w(),g.current()},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition","aria-label":"Close scanner",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]})]}),(0,Pe.jsx)("div",{className:"flex flex-col items-center justify-center space-y-4 p-4 sm:p-6",children:o?(0,Pe.jsxs)("div",{className:"text-red-600 text-center p-4",children:[(0,Pe.jsx)("p",{className:"text-sm sm:text-base font-medium",children:o}),(0,Pe.jsxs)("div",{className:"text-xs sm:text-sm mt-3 space-y-2 text-left bg-red-50 p-3 rounded-lg",children:[(0,Pe.jsx)("p",{className:"font-medium mb-2",children:"Troubleshooting steps:"}),(0,Pe.jsxs)("ul",{className:"space-y-1 list-disc list-inside",children:[(0,Pe.jsx)("li",{children:"Check if camera permission is granted in browser settings"}),(0,Pe.jsx)("li",{children:"Close other apps that might be using the camera"}),(0,Pe.jsx)("li",{children:"Try refreshing the page"}),(0,Pe.jsx)("li",{children:"Use a supported browser (Chrome, Firefox, Edge)"}),(0,Pe.jsx)("li",{children:"Ensure you're on HTTPS or localhost"})]})]})]}):(0,Pe.jsx)(Pe.Fragment,{children:(0,Pe.jsx)("div",{className:"relative w-full mx-auto overflow-hidden rounded-lg",style:{maxWidth:"100%",minHeight:"220px"},children:(0,Pe.jsx)("div",{id:a.current,ref:i,className:"w-full h-full bg-gray-100"})})})})]})})},Mu=e=>{const{getAllItems:t,updateItem:r,deleteItem:s}=n(1337),{STORES:i}=n(1337);return{products:{getAllItems:()=>t(i.products),updateItem:e=>r(i.products,e),deleteItem:e=>s(i.products,e)},customers:{getAllItems:()=>t(i.customers),updateItem:e=>r(i.customers,e),deleteItem:e=>s(i.customers,e)},orders:{getAllItems:()=>t(i.orders),updateItem:e=>r(i.orders,e)},transactions:{getAllItems:()=>t(i.transactions),updateItem:e=>r(i.transactions,e)},purchaseOrders:{getAllItems:()=>t(i.purchaseOrders),updateItem:e=>r(i.purchaseOrders,e),deleteItem:e=>s(i.purchaseOrders,e)},categories:{getAllItems:()=>t(i.categories),updateItem:e=>r(i.categories,e),deleteItem:e=>s(i.categories,e)}}[e]||null},Fu=()=>{var e,n;const{state:r,dispatch:s}=(0,i.nm)(),[o,l]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(""),[m,f]=(0,t.useState)(""),[p,g]=(0,t.useState)(!1),[x,y]=(0,t.useState)(!0),[b,w]=(0,t.useState)(!1),[v,N]=(0,t.useState)(""),[S,A]=(0,t.useState)([]),[_,C]=(0,t.useState)(0),[I,E]=(0,t.useState)(0),[T,j]=(0,t.useState)("cash"),[k,D]=(0,t.useState)(""),[P,R]=(0,t.useState)(!1),O=(0,t.useRef)(null),[L,M]=(0,t.useState)(null),[F,B]=(0,t.useState)(!1),U=(0,t.useRef)(null),z=(0,t.useRef)(""),q=(0,t.useRef)(null),H=(0,t.useRef)(0),V=(0,t.useRef)(null),W=(0,t.useRef)(null),[G,Y]=(0,t.useState)(!1),[X,Q]=(0,t.useState)(null),[K,Z]=(0,t.useState)(!1),[J,$]=(0,t.useState)(!1),[ee,te]=(0,t.useState)(!1),[ne,re]=(0,t.useState)(null),[se,ie]=(0,t.useState)(null),[ae,oe]=(0,t.useState)(null),le=(0,t.useRef)(!1),ce=(0,t.useRef)(new Set),[de,ue]=(0,t.useState)(!1),[he,me]=(0,t.useState)([]),fe=((null===(e=r.currentUser)||void 0===e?void 0:e.upiId)||r.upiId||"").trim(),[pe,ge]=(0,t.useState)(fe),[xe,ye]=(0,t.useState)(!1),be=(0,t.useRef)(!1),we=(0,t.useRef)(!1),ve=(0,t.useRef)(null),[Ne,Ae]=(0,t.useState)(!1),[_e,Ce]=(0,t.useState)(""),Ie=(0,t.useRef)(null),Ee=(0,t.useRef)(new Set),Te=(0,t.useRef)(!1),[je,ke]=(0,t.useState)(!1),[De,Re]=(0,t.useState)(!1),Oe=(0,t.useRef)(S),Le=(0,t.useRef)(""),Me=(0,t.useRef)(null),[Fe,Ue]=(0,t.useState)(!1),[ze,qe]=(0,t.useState)(""),[He,Ve]=(0,t.useState)(new Set);(0,t.useEffect)(()=>{Oe.current=S},[S]),(0,t.useEffect)(()=>{Fe?(Le.current="",qe(""),Ce(""),Ve(new Set),setTimeout(()=>{Rt()},100)):Ne&&Ot()},[Fe]);const{maxOrders:We,maxCustomers:Ge}=(0,Je.ay)(r.currentPlan,r.currentPlanDetails),Xe=r.orders.filter(e=>!e.isDeleted),Qe=r.customers.filter(e=>!e.isDeleted),Ke=(()=>{var e;return r.currentPlan&&Je.WK[r.currentPlan]?"".concat(r.currentPlan.charAt(0).toUpperCase()).concat(r.currentPlan.slice(1)):(null===(e=r.currentPlanDetails)||void 0===e?void 0:e.planName)||(r.currentPlan?"".concat(r.currentPlan.charAt(0).toUpperCase()).concat(r.currentPlan.slice(1)):"Current")})(),$e=Xe.length,et=!(0,Je.cR)($e,r.currentPlan,r.currentPlanDetails);var tt;et&&console.log("[ORDER LIMIT REACHED CHECK]",{activeOrdersCount:$e,maxOrders:We,currentPlan:r.currentPlan,totalOrdersFromDetails:null===(tt=r.currentPlanDetails)||void 0===tt?void 0:tt.totalOrders,allOrdersCount:r.orders.length,deletedOrdersCount:r.orders.filter(e=>e.isDeleted).length,canAddResult:(0,Je.cR)($e,r.currentPlan,r.currentPlanDetails)});const nt=!(0,Je.sp)(Qe.length,r.currentPlan,r.currentPlanDetails),rt=We===1/0?"Unlimited":We,it=Ge===1/0?"Unlimited":Ge,at=$e,ot=Qe.length,lt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;"undefined"!==typeof window&&"function"===typeof window.showToast&&window.showToast(e,t,n)},ct=(e,t)=>{var n,r;const s=Number(e),i=null!==(n=null===t||void 0===t||null===(r=t.toLowerCase)||void 0===r?void 0:r.call(t))&&void 0!==n?n:"pcs";return Number.isFinite(s)?s<=0?{valid:!1,message:"Quantity must be greater than zero."}:td(i)?Number.isInteger(s)?{valid:!0,quantity:s}:{valid:!1,message:"Quantity must be a whole number for pieces, packets and boxes."}:(nd(i),{valid:!0,quantity:parseFloat(s.toFixed(3))}):{valid:!1,message:"Please enter a valid quantity."}},dt=()=>{ue(!1),me([])};(0,t.useEffect)(()=>{if(be.current)return;const e=r.billingDraft;if(e){Array.isArray(e.billItems)&&A(e.billItems),l(e.selectedCustomer||""),w(Boolean(e.useCustomName)),d(e.customCustomerName||"");const t=It(e.customCustomerMobile||"");h(t);const n=It(e.billingMobile||"");f(n),y(!n||Et(n)),g(Boolean(e.sendWhatsAppInvoice));const r="number"===typeof e.discount?e.discount:Number(e.discount||0),s="number"===typeof e.tax?e.tax:Number(e.tax||0);C(r),E(s),j(e.paymentMethod||"cash");const i={billItems:Array.isArray(e.billItems)?e.billItems:[],selectedCustomer:e.selectedCustomer||"",useCustomName:Boolean(e.useCustomName),customCustomerName:e.customCustomerName||"",customCustomerMobile:t,billingMobile:n,sendWhatsAppInvoice:Boolean(e.sendWhatsAppInvoice),discount:r,tax:s,paymentMethod:e.paymentMethod||"cash"};ve.current=JSON.stringify(i)}else ve.current=null;be.current=!0,we.current=!0},[r.billingDraft]),(0,t.useEffect)(()=>{if(!be.current||!we.current)return;const e=It(m||""),t={billItems:S,selectedCustomer:o,useCustomName:b,customCustomerName:c,customCustomerMobile:u,billingMobile:e,sendWhatsAppInvoice:p,discount:"number"===typeof _?_:Number(_||0),tax:"number"===typeof I?I:Number(I||0),paymentMethod:T},n=Array.isArray(S)&&S.length>0||Boolean(b?c:o)||Boolean(u)||Boolean(e)||0!==("number"===typeof _?_:Number(_||0))||0!==("number"===typeof I?I:Number(I||0))||"cash"!==T||p,r=n?JSON.stringify(t):null;r!==ve.current&&(ve.current=r,s({type:i.ActionTypes.SET_BILLING_DRAFT,payload:n?t:null}))},[S,o,b,c,u,m,p,_,I,T,s]);const ut=e=>{e&&(U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{Nt(e)},300))},ht=()=>!et||((()=>{var e;console.log("[ORDER LIMIT WARNING]",{activeOrdersCount:Xe.length,maxOrders:We,currentPlan:r.currentPlan,totalOrdersFromDetails:null===(e=r.currentPlanDetails)||void 0===e?void 0:e.totalOrders,ordersInState:r.orders.length,deletedOrders:r.orders.filter(e=>e.isDeleted).length});const t="You've reached the order limit (".concat(rt,") for the ").concat(Ke," plan. Upgrade your plan to create more orders instantly.");lt(t,"warning")})(),!1),mt=()=>{const e="You've reached the customer limit (".concat(it,") for the ").concat(Ke," plan. Upgrade to store more customers.");lt(e,"warning")};(0,t.useEffect)(()=>{ge(fe)},[fe]);(0,t.useEffect)(()=>{(()=>{try{const e=new Audio("/assets/beep-401570.mp3");e.volume=1,e.preload="auto",e.addEventListener("loadeddata",()=>{console.log("\u2705 MP3 beep sound loaded successfully"),V.current=e}),e.addEventListener("error",e=>{console.warn("MP3 file failed, will use Web Audio API beep instead"),V.current=null}),e.load()}catch(e){console.error("Error creating beep sound:",e)}})()},[]),(0,t.useEffect)(()=>{(async()=>{try{const t="/assets/cash-register-kaching-376867.mp3";try{const e=await fetch(t);if(!e.ok)return void console.warn("Cash register sound file not accessible:",t);const n=await e.blob(),r=URL.createObjectURL(n),s=new Audio(r);s.volume=1,s.preload="auto",s.addEventListener("loadeddata",()=>{console.log("\u2705 Cash register sound loaded successfully"),W.current=s}),s.addEventListener("error",e=>{console.warn("Cash register sound failed to load:",s.error),s.error&&console.warn("Audio error code:",s.error.code,"Message:",s.error.message),W.current=null,URL.revokeObjectURL(r)}),s.load()}catch(e){console.warn("Could not load cash register sound via fetch, trying direct path:",e);const n=new Audio(t);n.volume=1,n.preload="auto",n.addEventListener("loadeddata",()=>{console.log("\u2705 Cash register sound loaded successfully (direct path)"),W.current=n}),n.addEventListener("error",e=>{console.warn("Cash register sound failed to load:",n.error),W.current=null}),n.load()}}catch(t){console.error("Error loading cash register sound:",t)}})()},[]),(0,t.useEffect)(()=>()=>{U.current&&clearTimeout(U.current),q.current&&clearTimeout(q.current)},[]),(0,t.useEffect)(()=>{if(b)f(u),y(!u||Et(u));else if(o){const e=r.customers.find(e=>e.id===o||e.name===o),t=(null===e||void 0===e?void 0:e.mobileNumber)||(null===e||void 0===e?void 0:e.phone)||"",n=It(t),s=n.length>10?n.slice(-10):n;f(s),y(!s||Et(s))}else f(""),y(!0)},[b,u,o,r.customers]);const ft=r.customers,gt=r.products.filter(e=>{var t;return e.name.toLowerCase().includes(v.toLowerCase())||(null===(t=e.category)||void 0===t?void 0:t.toLowerCase().includes(v.toLowerCase()))}),xt=S.reduce((e,t)=>e+Wt(t),0),yt=xt*_/100,wt=(xt-yt)*I/100,vt=xt-yt+wt,Nt=e=>{console.log("Barcode scan handler called with:",e),console.log("All products:",r.products.map(e=>({name:e.name,barcode:e.barcode})));const t=r.products.find(t=>t.barcode===e);if(console.log("Found product:",t),t){const e=()=>{try{if(V.current&&V.current.readyState>=2){V.current.currentTime=0;const e=V.current.play();void 0!==e&&e.then(()=>{console.log("\u2705 Beep sound played successfully")}).catch(e=>{console.warn("MP3 playback failed, using Web Audio API:",e),n()})}else n()}catch(e){console.error("Error playing beep sound:",e),n()}},n=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.value=800,t.type="sine",n.gain.setValueAtTime(1,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1),console.log("\u2705 Web Audio API beep played")}catch(e){console.error("Error creating Web Audio beep:",e)}};e(),St(t)}else{const t=(r.currentLanguage,"".concat(Ze("productNotFound",r.currentLanguage),": ").concat(e,". ").concat(Ze("pleaseAddProductFirst",r.currentLanguage),"."));lt(t,"error")}D("")};(0,t.useEffect)(()=>{const e=e=>{const t=e.target,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName,r=t===O.current;if(!n||r)if(1!==e.key.length||e.ctrlKey||e.metaKey||e.altKey){if("Enter"===e.key&&z.current.length>0){e.preventDefault();const t=z.current.trim();t.length>0&&(O.current&&O.current.focus(),D(t),Nt(t),z.current="")}}else{const t=Date.now();t-H.current<100||0===z.current.length?(z.current+=e.key,H.current=t,q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{const e=z.current.trim();e.length>0&&(O.current&&O.current.focus(),D(e),Nt(e),z.current="")},300)):z.current=""}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),q.current&&clearTimeout(q.current)}},[r.products]);const St=e=>{M(e),B(!0)},_t=function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=ct(t,n);if(!i.valid)return lt(i.message,"warning"),!1;const a=i.quantity,o={stockError:null};return A(t=>{const i=t.findIndex(t=>t.id===e.id);if(i>=0){const l=t[i],c=l.unit||l.quantityUnit||"pcs",d=Qc(c),u=Qc(n);let h=a,m=n;if(d===u){const e=Kc(a,n);h=Zc(e,c),m=c}else m=n,h=a;const f=sd(e,h,m);if(!f.available)return o.stockError=f.error||(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("lowStockWarning",r.currentLanguage),"! ").concat(Ze("available",r.currentLanguage),": ").concat(f.stockDisplay,".")),t;const p=Gt(e,h,m,f.baseUnit,s);return t.map((e,t)=>t===i?p:e)}const l=sd(e,a,n);if(!l.available)return o.stockError=l.error||(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("lowStockWarning",r.currentLanguage),"! ").concat(Ze("available",r.currentLanguage),": ").concat(l.stockDisplay,".")),t;const c=Gt(e,a,n,l.baseUnit);return[...t,c]}),!o.stockError||(lt(o.stockError,o.stockError.includes("error")?"error":"warning"),!1)},Ct=function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=ct(t,n);if(!i.valid)return lt(i.message,"warning"),!1;const a=i.quantity,o={merged:!1,stockError:null};return A(t=>{const i=t.findIndex(t=>t.id===e.id);if(i>=0){o.merged=!0;const s=t[i],l=s.unit||s.quantityUnit||"pcs",c=Qc(l),d=Qc(n);let u;const h=["pcs","piece","pieces","peace"].includes(n.toLowerCase()),m=["pcs","piece","pieces","peace"].includes(l.toLowerCase());if(h&&m)u=s.quantity+a;else if(c===d){const e=Kc(s.quantity,l),t=Kc(a,n);u=Zc(e+t,l)}else{const e=["kg","g","gm","ml","l","liter","liters"].includes(l.toLowerCase());if(h&&e)u=s.quantity+a;else{const e=Kc(s.quantity,l),t=Kc(a,n);u=Zc(e+t,l)}}const f=sd(e,u,l);if(!f.available)return o.stockError=f.error||(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("lowStockWarning",r.currentLanguage),"! ").concat(Ze("available",r.currentLanguage),": ").concat(f.stockDisplay,".")),t;const p=Gt(e,u,l,f.baseUnit);return t.map((e,t)=>t===i?p:e)}const l=sd(e,a,n);if(!l.available)return o.stockError=l.error||(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("lowStockWarning",r.currentLanguage),"! ").concat(Ze("available",r.currentLanguage),": ").concat(l.stockDisplay,".")),t;const c=Gt(e,a,n,l.baseUnit,s);return[...t,c]}),!o.stockError||(lt(o.stockError,o.stockError.includes("error")?"error":"warning"),!1)},Tt=e=>{if(!e||""===e.trim())return null;const t=e.toLowerCase().trim();let n=r.products.find(e=>e.name.toLowerCase()===t);if(n)return n;if(n=r.products.find(e=>e.name.toLowerCase().includes(t)||t.includes(e.name.toLowerCase())),n)return n;const s=t.split(/\s+/);return n=r.products.find(e=>{const t=e.name.toLowerCase().split(/\s+/);return s.some(e=>t.some(t=>t.includes(e)||e.includes(t)))}),n||null},jt=e=>{let t=e.replace(/\d+\.?\d*\s*(kg|kilogram|kilograms|kilo|killo|g|gram|grams|gm|ml|milliliter|milliliters|l|liter|liters|litre|litres|pcs|piece|pieces|peace|packet|packets|box|boxes|bottle|bottles)/gi,"").trim();return t=t.replace(/\b(the|a|an|is|are|and|or|but|in|on|at|to|for|of|with|add|give|take)\b/gi,"").trim(),t},kt=()=>{const e=Oe.current||S;if(console.log("Speaking items, count:",e.length,e),!e||0===e.length){const e=new SpeechSynthesisUtterance("Cart is empty, sir");e.lang="en-IN",e.rate=.75,e.pitch=1.1,e.volume=1;const t=()=>{const t=window.speechSynthesis.getVoices(),n=e=>{const t=e.name.toLowerCase();return t.includes("female")||t.includes("woman")||t.includes("zira")||t.includes("priya")||t.includes("neha")||t.includes("kavya")},r=t.find(e=>("en-IN"===e.lang||e.lang.startsWith("en-IN"))&&n(e))||t.find(e=>e.lang.includes("IN")&&n(e))||t.find(e=>"en-IN"===e.lang||e.lang.startsWith("en-IN"))||t.find(e=>e.name.toLowerCase().includes("indian"));r&&(e.voice=r),window.speechSynthesis.speak(e)};return void(0===window.speechSynthesis.getVoices().length?window.speechSynthesis.onvoiceschanged=t:t())}const t=e.map((e,t)=>{const n=e.name||e.productName||"item",r=e.quantity||0;let s=(e.unit||e.quantityUnit||"pcs").toLowerCase(),i="";return i="kg"===s||"kilogram"===s||"kilograms"===s?"kilo":"g"===s||"gram"===s||"grams"===s||"gm"===s?"gram":"l"===s||"liter"===s||"liters"===s||"litre"===s||"litres"===s?"liter":"ml"===s||"milliliter"===s||"milliliters"===s?"milliliter":"pcs"===s||"piece"===s||"pieces"===s||"peace"===s?"piece":"packet"===s||"packets"===s?"packet":"box"===s||"boxes"===s?"box":"bottle"===s||"bottles"===s?"bottle":s,"".concat(n," ke ").concat(r," ").concat(i," he")});let n="";if(1===t.length)n=t[0];else if(2===t.length)n="".concat(t[0]," aur ").concat(t[1]);else{const e=t.pop();n="".concat(t.join(", "),", aur ").concat(e)}n="Sir, ".concat(n);const r=new SpeechSynthesisUtterance(n);r.lang="en-IN",r.rate=.75,r.pitch=1.1,r.volume=1;const s=()=>{(()=>{const e=window.speechSynthesis.getVoices(),t=e=>{const t=e.name.toLowerCase();return t.includes("female")||t.includes("woman")||t.includes("zira")||t.includes("priya")||t.includes("neha")||t.includes("kavya")||t.includes("female")||e.name.includes("Female")&&!t.includes("male")},n=e.find(e=>("en-IN"===e.lang||e.lang.startsWith("en-IN"))&&t(e)&&(e.name.toLowerCase().includes("neural")||e.name.toLowerCase().includes("indian")))||e.find(e=>("en-IN"===e.lang||e.lang.startsWith("en-IN"))&&t(e))||e.find(e=>e.lang.includes("IN")&&t(e))||e.find(e=>t(e)&&e.name.toLowerCase().includes("neural"))||e.find(e=>"en-IN"===e.lang||e.lang.startsWith("en-IN"))||e.find(e=>e.lang.includes("IN"));n&&(r.voice=n,console.log("Selected voice:",n.name,n.lang,"Female:",t(n)))})(),window.speechSynthesis.speak(r)};0===window.speechSynthesis.getVoices().length?window.speechSynthesis.onvoiceschanged=s:s()},Dt=e=>{if(!e||""===e.trim())return[];let t=e.toLowerCase().trim();const n=/(\d+\.?\d*)\s*(kg|kilogram|kilograms|kilo|killo)\s+(\d+\.?\d*)\s*(g|gram|grams|gm)\b/gi,r=[];let s;for(;null!==(s=n.exec(t));){const e=parseFloat(s[1]),t=parseFloat(s[3]),n=Kc(e,"kg"),i=Kc(t,"g"),a=Zc(n+i,"kg");r.push({original:s[0],replacement:"".concat(a,"kg"),index:s.index,length:s[0].length})}const i=/(\d+\.?\d*)\s*(l|liter|liters|litre|litres)\s+(\d+\.?\d*)\s*(ml|milliliter|milliliters)\b/gi,a=[];let o;for(;null!==(o=i.exec(t));){const e=parseFloat(o[1]),t=parseFloat(o[3]),n=Kc(e,"l"),r=Kc(t,"ml"),s=Zc(n+r,"l");a.push({original:o[0],replacement:"".concat(s,"l"),index:o.index,length:o[0].length})}const l=[...r,...a].sort((e,t)=>t.index-e.index);l.forEach(e=>{t=t.substring(0,e.index)+e.replacement+t.substring(e.index+e.length)});const c=[],d=[],u=/(\d+\.?\d*)\s*(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|\u20b9|amount)/gi;let h;for(;null!==(h=u.exec(t));){const e=parseFloat(h[1]);d.push({amount:e,index:h.index,length:h[0].length,matchedText:h[0]})}const m=/\u20b9\s*(\d+\.?\d*)/gi;for(u.lastIndex=0;null!==(h=m.exec(t));){const e=parseFloat(h[1]),t=d.some(t=>Math.abs(t.index-h.index)<5&&Math.abs(t.amount-e)<.01);t||d.push({amount:e,index:h.index,length:h[0].length,matchedText:h[0]})}const f=/(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|amount)\s*(\d+\.?\d*)/gi;for(m.lastIndex=0;null!==(h=f.exec(t));){const e=parseFloat(h[2]),t=d.some(t=>Math.abs(t.index-h.index)<5&&Math.abs(t.amount-e)<.01);t||d.push({amount:e,index:h.index,length:h[0].length,matchedText:h[0]})}d.sort((e,t)=>e.index-t.index);const p=/(\d+\.?\d*)\s*(kg|kilogram|kilograms|kilo|killo|g|gram|grams|gm|ml|milliliter|milliliters|l|liter|liters|litre|litres|pcs|piece|pieces|peace|packet|packets|box|boxes|bottle|bottles)/gi,g=[];let x;for(;null!==(x=p.exec(t));){const e=parseFloat(x[1]);let t=x[2].toLowerCase();"kilo"===t||"killo"===t||"kilogram"===t||"kilograms"===t?t="kg":"gram"===t||"grams"===t||"gm"===t?t="g":"liter"===t||"liters"===t||"litre"===t||"litres"===t?t="l":"milliliter"===t||"milliliters"===t?t="ml":"piece"!==t&&"pieces"!==t&&"peace"!==t||(t="pcs"),g.push({quantity:e,unit:t,index:x.index,length:x[0].length,matchedText:x[0]})}if(d.length>0&&d.forEach((e,n)=>{const r=e.index,s=e.index+e.length;if(g.some(e=>{const t=e.index,n=e.index+e.length;return Math.abs(r-t)<10||r>=t&&r<=n||s>=t&&s<=n}))return;const i=e.index;let a=0;if(n>0){a=d[n-1].index+d[n-1].length}const o=g.find(e=>{const t=e.index+e.length;return t<i&&i-t<100});if(o){const e=o.index+o.length;a=Math.max(a,e)}let l=t.substring(a,i).trim();const u=l.split(/\s+/);u.length>5&&(l=u.slice(-5).join(" "));let h=l.replace(e.matchedText,"").trim();h=h.replace(/\b(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|amount|\u20b9)\b/gi,"").trim();const m=h.replace(/\b(the|a|an|is|are|and|or|but|in|on|at|to|for|of|with|add|give|take)\b/gi,"").trim();if(m){const t=Tt(m);if(t){const r=t.unit||t.quantityUnit||"pcs";if(["kg","g","gm","l","liter","liters","ml","milliliter","milliliters"].includes(r.toLowerCase())){const s=t.sellingPrice||t.sellingUnitPrice||t.costPrice||t.unitPrice||0;if(s>0){const i=e.amount/s;c.push({id:"amt-".concat(n,"-").concat(c.length),product:t.name,spokenName:m,quantity:i,unit:r,amount:e.amount,isAmountBased:!0,matched:!0})}else c.push({id:"amt-".concat(n,"-").concat(c.length),product:t.name,spokenName:m,quantity:0,unit:r,amount:e.amount,isAmountBased:!0,matched:!1,error:"Price not set"})}else c.push({id:"amt-".concat(n,"-").concat(c.length),product:t.name,spokenName:m,quantity:0,unit:r,amount:e.amount,isAmountBased:!1,matched:!0,error:"Cannot calculate quantity from amount for pieces"})}else c.push({id:"amt-".concat(n,"-").concat(c.length),product:m,quantity:0,unit:"pcs",amount:e.amount,isAmountBased:!1,matched:!1})}}),g.length>0)g.forEach((e,n)=>{const r=e.index;let s=0;if(n>0){s=g[n-1].index+g[n-1].length}const i=d.find(e=>{const t=e.index+e.length;return t<r&&r-t<100});if(i){const e=i.index+i.length;s=Math.max(s,e)}let a=t.substring(s,r).trim();const o=a.split(/\s+/);o.length>5&&(a=o.slice(-5).join(" "));const l=a.replace(e.matchedText,"").trim().replace(/\b(the|a|an|is|are|and|or|but|in|on|at|to|for|of|with|add|give|take)\b/gi,"").trim();if(l){const t=Tt(l);c.push({id:"qty-".concat(n,"-").concat(c.length),product:t?t.name:l,spokenName:l,quantity:e.quantity,unit:e.unit,matched:!!t})}});else{const e=t.split(/[,;]| and | then | also | plus /i).map(e=>e.trim()).filter(e=>e.length>0);0===e.length&&e.push(t),e.forEach(e=>{const t=e.replace(/\b(the|a|an|is|are|and|or|but|in|on|at|to|for|of|with|add|give|take)\b/gi,"").trim();if(t){const e=Tt(t);c.push({id:"seg-".concat(c.length),product:e?e.name:t,spokenName:t,quantity:1,unit:"pcs",matched:!!e})}})}return c},Pt=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e||""===e.trim())return;let n=e.toLowerCase().trim();const r=n.includes("recheck")||n.includes("re check")||n.includes("re-check"),s="check"===n||n.startsWith("check ")||n.includes("check bill")||n.includes("check items")||n.includes("check cart")||n.includes("check the")||n.includes("check all");if(r||s)return Ot(),setTimeout(()=>{kt()},500),void lt("Reading all items in cart...","info",2e3);const i=new Map;let a=n;const o=/(\d+\.?\d*)\s*(kg|kilogram|kilograms|kilo|killo)\s+(\d+\.?\d*)\s*(g|gram|grams|gm)\b/gi,l=[];let c;for(;null!==(c=o.exec(n));){const e=parseFloat(c[1]),t=parseFloat(c[3]),n=Kc(e,"kg"),r=Kc(t,"g"),s=Zc(n+r,"kg");l.push({original:c[0],replacement:"".concat(s,"kg"),index:c.index,length:c[0].length})}const d=/(\d+\.?\d*)\s*(l|liter|liters|litre|litres)\s+(\d+\.?\d*)\s*(ml|milliliter|milliliters)\b/gi,u=[];let h;for(;null!==(h=d.exec(n));){const e=parseFloat(h[1]),t=parseFloat(h[3]),n=Kc(e,"l"),r=Kc(t,"ml"),s=Zc(n+r,"l");u.push({original:h[0],replacement:"".concat(s,"l"),index:h.index,length:h[0].length})}const m=[...l,...u].sort((e,t)=>t.index-e.index);m.forEach(e=>{a=a.substring(0,e.index)+e.replacement+a.substring(e.index+e.length)}),n=a;const f=[],p=/(\d+\.?\d*)\s*(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|\u20b9|amount)/gi;let g;for(;null!==(g=p.exec(n));){const e=parseFloat(g[1]);f.push({amount:e,index:g.index,length:g[0].length,matchedText:g[0]})}const x=/\u20b9\s*(\d+\.?\d*)/gi;for(p.lastIndex=0;null!==(g=x.exec(n));){const e=parseFloat(g[1]),t=f.some(t=>Math.abs(t.index-g.index)<5&&Math.abs(t.amount-e)<.01);t||f.push({amount:e,index:g.index,length:g[0].length,matchedText:g[0]})}const y=/(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|amount)\s*(\d+\.?\d*)/gi;for(x.lastIndex=0;null!==(g=y.exec(n));){const e=parseFloat(g[2]),t=f.some(t=>Math.abs(t.index-g.index)<5&&Math.abs(t.amount-e)<.01);t||f.push({amount:e,index:g.index,length:g[0].length,matchedText:g[0]})}f.sort((e,t)=>e.index-t.index);const b=[],w=/(\d+\.?\d*)\s*(kg|kilogram|kilograms|kilo|killo|g|gram|grams|gm|ml|milliliter|milliliters|l|liter|liters|litre|litres|pcs|piece|pieces|peace|packet|packets|box|boxes|bottle|bottles)/gi;let v;for(;null!==(v=w.exec(n));){const e=parseFloat(v[1]);let t=v[2].toLowerCase();"kilo"===t||"killo"===t||"kilogram"===t||"kilograms"===t?t="kg":"gram"===t||"grams"===t||"gm"===t?t="g":"liter"===t||"liters"===t||"litre"===t||"litres"===t?t="l":"milliliter"===t||"milliliters"===t?t="ml":"piece"!==t&&"pieces"!==t&&"peace"!==t||(t="pcs"),b.push({quantity:e,unit:t,index:v.index,length:v[0].length,matchedText:v[0]})}if(f.length>0&&f.forEach((e,r)=>{const s=e.index,a=e.index+e.length;if(b.some(e=>{const t=e.index,n=e.index+e.length;return Math.abs(s-t)<10||s>=t&&s<=n||a>=t&&a<=n}))return;const o=e.index;let l=0;if(r>0){l=f[r-1].index+f[r-1].length}const c=b.find(e=>{const t=e.index+e.length;return t<o&&o-t<100});if(c){const e=c.index+c.length;l=Math.max(l,e)}let d=n.substring(l,o).trim();const u=d.split(/\s+/);u.length>5&&(d=u.slice(-5).join(" "));let h=d.replace(e.matchedText,"").trim();h=h.replace(/\b(rupey|rupee|rupees|ruppes|ruppey|rs\.|rs|amount|\u20b9)\b/gi,"").trim();const m=jt(h||d);if(m&&m.length>0){const n=Tt(m);if(n){const r=n.id||n.name.toLowerCase(),s=n.unit||n.quantityUnit||"pcs";if(["kg","g","gm","l","liter","liters","ml","milliliter","milliliters"].includes(s.toLowerCase())){const a=n.sellingPrice||n.sellingUnitPrice||n.costPrice||n.unitPrice||0;if(a>0){const t=e.amount/a;i.set(r,{product:n,quantity:t,unit:s,amount:e.amount,isAmountBased:!0})}else t&&lt("".concat(m," - Product price not set. Cannot calculate quantity from amount."),"warning",3e3)}else t&&lt("".concat(m," - Cannot calculate quantity from amount for pieces. Please specify quantity."),"warning",3e3)}else t&&lt("".concat(m," - This product not found"),"error",3e3)}}),b.length>0)b.forEach((e,r)=>{const s=e.index;let a=0;if(r>0){a=b[r-1].index+b[r-1].length}const o=f.find(e=>{const t=e.index+e.length;return t<s&&s-t<100});if(o){const e=o.index+o.length;a=Math.max(a,e)}let l=n.substring(a,s).trim();const c=l.split(/\s+/);c.length>5&&(l=c.slice(-5).join(" "));let d=l;const u=new RegExp(e.matchedText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");u.test(l)&&(d=l.replace(u,"").trim()),d!==l&&""!==d||(d=l.replace(/\d+\.?\d*\s*(kg|kilogram|kilograms|kilo|killo|g|gram|grams|gm|ml|milliliter|milliliters|l|liter|liters|litre|litres|pcs|piece|pieces|peace|packet|packets|box|boxes|bottle|bottles)/gi,"").trim());const h=jt(d||l);if(console.log("\ud83d\udd0d [processVoiceInput] Product extraction:",{segment:l,productNameText:d,productName:h,qtyUnit:e.matchedText,quantity:e.quantity,unit:e.unit}),h&&h.length>0){const n=Tt(h);if(console.log("\ud83d\udd0d [processVoiceInput] Product match result:",{searchedName:h,found:n?n.name:null}),n){const t=n.id||n.name.toLowerCase(),r=n.unit||n.quantityUnit||"pcs";let s=r,a=e.quantity;const o=["pcs","piece","pieces","peace"].includes(e.unit.toLowerCase()),l=["pcs","piece","pieces","peace"].includes(r.toLowerCase());if(o&&l)a=e.quantity,s=r;else{if(Qc(e.unit)===Qc(r)){const t=Kc(e.quantity,e.unit);a=Zc(t,r),s=r}else{const t=["kg","g","gm","ml","l","liter","liters"].includes(r.toLowerCase());o&&t||!o&&l?(a=e.quantity,s=r):(s=e.unit,a=e.quantity)}}if(i.has(t)){const e=i.get(t).quantity+a;i.set(t,{product:n,quantity:e,unit:r})}else i.set(t,{product:n,quantity:a,unit:s})}else t&&lt("".concat(h," - This product not found"),"error",3e3)}});else{let e=n.split(/[,;]| and | then | also | plus /i).map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length&&e.push(n),1!==e.length||n.match(/[,;]| and | then | also | plus /i))e.forEach(e=>{const n=jt(e);if(n){const e=Tt(n);if(e){const t=e.id||e.name.toLowerCase();if(!i.has(t)){const n=e.unit||e.quantityUnit||"pcs";i.set(t,{product:e,quantity:1,unit:n})}}else t&&lt("".concat(n," - This product not found"),"error",3e3)}});else{const n=e[0].split(/\s+/).filter(e=>e.length>0);if(n.length>=3||e[0].length>=20){const r=new Set,s=[];for(let e=0;e<n.length;e++)e+1<n.length&&s.push("".concat(n[e]," ").concat(n[e+1])),e+2<n.length&&s.push("".concat(n[e]," ").concat(n[e+1]," ").concat(n[e+2]));if(n.forEach(e=>{e.length>2&&s.push(e)}),s.forEach(e=>{const t=jt(e);if(t&&t.length>2){const e=Tt(t);if(e&&!r.has(e.id)){r.add(e.id);const t=e.id||e.name.toLowerCase();if(!i.has(t)){const n=e.unit||e.quantityUnit||"pcs";i.set(t,{product:e,quantity:1,unit:n})}}}}),0===r.size){const n=jt(e[0]);if(n){const e=Tt(n);if(e){const t=e.id||e.name.toLowerCase();if(!i.has(t)){const n=e.unit||e.quantityUnit||"pcs";i.set(t,{product:e,quantity:1,unit:n})}}else t&&lt("".concat(n," - This product not found"),"error",3e3)}}}else{const n=jt(e[0]);if(n){const e=Tt(n);if(e){const t=e.id||e.name.toLowerCase();if(!i.has(t)){const n=e.unit||e.quantityUnit||"pcs";i.set(t,{product:e,quantity:1,unit:n})}}else t&&lt("".concat(n," - This product not found"),"error",3e3)}}}}if(0===i.size)return console.log("\u26a0\ufe0f [processVoiceInput] No products found in productMap. Original text:",e),console.log("\u26a0\ufe0f [processVoiceInput] Processed text:",n),console.log("\u26a0\ufe0f [processVoiceInput] Quantity matches found:",b.length),void(t&&lt("No products detected. Please try again.","warning"));console.log("\u2705 [processVoiceInput] Found ".concat(i.size," product(s) to add:"),Array.from(i.values()).map(e=>{let{product:t,quantity:n,unit:r}=e;return"".concat(t.name," ").concat(n).concat(r)})),i.forEach(e=>{let{product:n,quantity:r,unit:s,amount:i,isAmountBased:a}=e;if(S.findIndex(e=>e.id===n.id)>=0){const e=_t(n,r,s,a&&i?i:null);e&&t?setTimeout(()=>{const e=S.find(e=>e.id===n.id);if(e){const t=e.quantity,r=e.unit||e.quantityUnit||s,o=a&&i?"Updated: ".concat(n.name," \u20b9").concat(i," (").concat(rd(t,r),")"):"Updated: ".concat(n.name," ").concat(rd(t,r));lt(o,"success",2e3)}else{const e=a&&i?"Updated: ".concat(n.name," \u20b9").concat(i," (").concat(rd(r,s),")"):"Updated: ".concat(n.name," ").concat(rd(r,s));lt(e,"success",2e3)}},100):e||console.error("\u274c [processVoiceInput] Failed to replace quantity for product:",n.name)}else{const e=Ct(n,r,s,a&&i?i:null);if(e&&t){const e=a&&i?"Added: ".concat(n.name," \u20b9").concat(i," (").concat(rd(r,s),")"):"Added: ".concat(n.name," ").concat(rd(r,s));lt(e,"success",2e3)}else e||console.error("\u274c [processVoiceInput] Failed to add product:",n.name,"quantity:",r,"unit:",s)}}),setTimeout(()=>{Ee.current.clear()},3e3)},Rt=()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e){if(Ie.current)try{Ie.current.stop(),Ie.current=null}catch(qb){}setTimeout(()=>{if(!Fe)return;Te.current=!0;const t=new e;t.continuous=!0,t.interimResults=!0,t.lang="en-US",t.onstart=()=>{Ae(!0),Fe||(Ce(""),Le.current="",Ee.current.clear()),Me.current&&(clearTimeout(Me.current),Me.current=null)},t.onresult=e=>{let t="",n="";for(let s=e.resultIndex;s<e.results.length;s++){const r=e.results[s][0].transcript;e.results[s].isFinal?n+=r+" ":t+=r}n&&(Le.current=Fe?(Le.current||"")+n:n);const r=((Le.current||"")+t).trim();if(Ce(r),Fe&&qe(r),!Fe){Me.current&&clearTimeout(Me.current);const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?2500:1500;Me.current=setTimeout(()=>{Le.current.trim()&&(Pt(Le.current.trim()),Le.current="",setTimeout(()=>{Ce("")},1e3))},e)}},t.onerror=e=>{"no-speech"===e.error?Fe&&Te.current?setTimeout(()=>{if(Te.current&&Fe&&Ie.current===t)try{t.start()}catch(qb){}},1e3):Fe||(Ae(!1),Te.current=!1):(Ae(!1),Te.current=!1,"aborted"!==e.error&&lt("Speech recognition error. Please try again.","error"))},t.onend=()=>{if(Ae(!1),Fe||(Me.current&&(clearTimeout(Me.current),Me.current=null),Le.current.trim()&&(Pt(Le.current.trim()),Le.current="",setTimeout(()=>{Ce("")},1e3))),Te.current&&Fe){setTimeout(()=>{if(Te.current&&Fe&&Ie.current===t)try{t.start()}catch(qb){console.log("Recognition restart skipped:",qb.message)}},300)}},Ie.current=t;try{t.start()}catch(qb){console.error("Failed to start recognition:",qb),Ie.current=null,Ae(!1),Te.current=!1,qb.message&&!qb.message.includes("already started")&&lt("Failed to start listening. Please try again.","error")}},200)}else lt("Speech recognition not supported in your browser","error")},Ot=()=>{if(Te.current=!1,Me.current&&(clearTimeout(Me.current),Me.current=null),!Fe&&Le.current.trim()&&(Pt(Le.current.trim()),Le.current=""),Ie.current){try{Ie.current.stop()}catch(qb){}Ie.current=null}Ae(!1),Ce(""),Ee.current.clear()};(0,t.useEffect)(()=>()=>{Ot()},[]);const Lt=(e,t)=>{const n=S.findIndex(t=>t.id===e);if(-1===n)return;const s=S[n],i=ct(t,s.unit);if(!i.valid)return void lt(i.message,"warning");const a=i.quantity;if(a<=0)return void A(t=>t.filter(t=>t.id!==e));const o=r.products.find(t=>t.id===e);if(!o)return;const l=sd(o,a,s.unit);if(!l.available){if(l.error)return void lt(l.error,"error");const e=(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("lowStock",r.currentLanguage),"! ").concat(Ze("available",r.currentLanguage),": ").concat(l.stockDisplay,". ").concat(Ze("youCannotAddMore",r.currentLanguage),"."));return void lt(e,"warning")}const c=Gt(o,a,s.unit,l.baseUnit);A(e=>e.map((e,t)=>t===n?c:e))},Mt=e=>{var t;let{order:n,bill:o,billItemsSnapshot:c,matchedDueCustomer:u,isDueLikePayment:m,customerName:p,sanitizedMobile:x,useCustomNameFlag:b,sendWhatsAppInvoiceFlag:v,effectiveMobile:N}=e;const S=n.id;if(ce.current.has(S))return console.warn("\u26a0\ufe0f Order is already being finalized, skipping duplicate call:",S),le.current=!1,!1;if(ce.current.add(S),!ht())return ce.current.delete(S),le.current=!1,!1;console.log("\ud83d\udd27 [FINALIZE] Starting finalization for order:",S),console.log("\ud83d\udd27 [FINALIZE] Split payment type:",null===(t=n.splitPaymentDetails)||void 0===t?void 0:t.type),console.log("\ud83d\udd27 [FINALIZE] Order stockDeducted flag:",n.stockDeducted);const _=r.orders.find(e=>e.id===S);if(_)return console.warn("\u26a0\ufe0f Order already exists, skipping duplicate finalization:",S),console.warn("\u26a0\ufe0f Existing order stockDeducted:",_.stockDeducted),ce.current.delete(S),le.current=!1,!1;if(!0===n.stockDeducted)return console.warn("\u26a0\ufe0f Stock already deducted for this order, skipping stock deduction:",S),s({type:i.ActionTypes.ADD_ORDER,payload:n}),ce.current.delete(S),le.current=!1,!0;console.log("\ud83d\udd27 Finalizing order:",S);const I=r.orders.filter(e=>!e.isDeleted),T=I.length,{maxOrders:k}=(0,Je.ay)(r.currentPlan,r.currentPlanDetails);if(!(0,Je.cR)(T,r.currentPlan,r.currentPlanDetails)){var P;const e=k===1/0?"Unlimited":k,t=(null===(P=r.currentPlanDetails)||void 0===P?void 0:P.planName)||(r.currentPlan?"".concat(r.currentPlan.charAt(0).toUpperCase()).concat(r.currentPlan.slice(1)):"Current"),n="Your limit is full! You've reached the order limit (".concat(e,") for the ").concat(t," plan. Upgrade your plan to create more orders.");return console.error("Order limit reached during finalization:",n),window.showToast&&window.showToast(n,"error",5e3),ce.current.delete(S),le.current=!1,!1}const O=r.orders.find(e=>e.id===S);if(O)return console.error("\u274c CRITICAL: Order already exists in state, aborting finalization!",S),console.error("\u274c Existing order stockDeducted:",O.stockDeducted),ce.current.delete(S),le.current=!1,!1;console.log("\ud83d\udd27 Starting stock deduction for order:",n.id),console.log("\ud83d\udd27 Order does NOT exist in state, proceeding with stock deduction"),c.forEach((e,t)=>{var n,o,l,d,u;const h=[e.productId,null===(n=e.product)||void 0===n?void 0:n.id,null===(o=e.product)||void 0===o?void 0:o.productId,e.id,e._id].filter(Boolean),m=r.products.find(e=>[e.id,e._id].filter(Boolean).some(e=>h.includes(e)));if(!m)return void console.warn("\u26a0\ufe0f Unable to match billed item to a product for stock deduction:",e);const f=m.unit||m.quantityUnit||"pcs",p=Number(null!==(l=null!==(d=m.quantity)&&void 0!==d?d:m.stock)&&void 0!==l?l:0)||0,g=Kc(p,f),x=e.unit||e.quantityUnit||f,y=Number(null!==(u=e.quantity)&&void 0!==u?u:0);if(y<=0)return;const b=Number.isFinite(Number(e.quantityInBaseUnit))?Number(e.quantityInBaseUnit):Kc(y,x);console.log("\ud83d\udd27 Stock deduction [".concat(t+1,"/").concat(c.length,"]:"),{productName:m.name,productId:m.id,currentStock:p,billedQuantity:y,billedUnit:x,billedQuantityInBaseUnit:b});const w=Math.max(0,g-b),v=Zc(w,f),N=Math.round(1e3*(Number.isFinite(v)?v:0))/1e3;console.log("\ud83d\udd27 Stock updated for ".concat(m.name,":"),{before:p,after:N,deducted:p-N});const S=(0,a.A)((0,a.A)({},m),{},{quantity:N,stock:N}),A=(0,a.A)((0,a.A)({},S),{},{isSynced:!1,syncedAt:void 0});s({type:i.ActionTypes.UPDATE_PRODUCT,payload:A,meta:{suppressProductSync:!0}})}),console.log("\ud83d\udd27 Completed stock deduction for order:",n.id);const L=(0,a.A)((0,a.A)({},n),{},{stockDeducted:!0});console.log("\ud83d\udd27 Adding order to state after stock deduction:",S),s({type:i.ActionTypes.ADD_ORDER,payload:L}),setTimeout(()=>{pt.Ay.isOnline()?(console.log("\ud83d\udd27 Triggering product sync to MongoDB after order creation..."),pt.Ay.syncAll(Mu).catch(e=>{console.error("\u274c Error syncing products after order creation:",e)})):console.log("\u26a0\ufe0f Offline - products will sync when connection is restored")},100);const M="split"===o.paymentMethod&&o.splitPaymentDetails,F=M&&o.splitPaymentDetails.dueAmount||0,B=m||M&&F>0;if(p&&""!==p.trim()&&"walk-in customer"!==p.trim().toLowerCase()){const e=x;let t=null;if(n.customerId&&(t=ft.find(e=>e.id===n.customerId)),!t&&p&&e){const n=p.trim().toLowerCase();t=ft.find(t=>{const r=(t.name||"").trim().toLowerCase(),s=It(t.mobileNumber||t.phone||"");return r===n&&(s&&e&&s===e)})}if(!t&&u&&(t=u),t)if(B){const e=M?F:o.total,n=(0,a.A)((0,a.A)({},t),{},{balanceDue:(t.balanceDue||t.dueAmount||0)+e,dueAmount:(t.dueAmount||t.balanceDue||0)+e});s({type:i.ActionTypes.UPDATE_CUSTOMER,payload:n})}else{const n=(0,a.A)((0,a.A)({},t),{},{name:p.trim(),mobileNumber:e||t.mobileNumber||"",phone:e||t.phone||""});n.name===t.name&&n.mobileNumber===(t.mobileNumber||t.phone)||s({type:i.ActionTypes.UPDATE_CUSTOMER,payload:n})}else{if(nt)return mt(),le.current=!1,!1;const t={id:Date.now().toString(),name:p.trim(),mobileNumber:e||"",phone:e||"",email:"",address:"",balanceDue:B?M?F:o.total:0,dueAmount:B?M?F:o.total:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),source:"billing_auto"};s({type:i.ActionTypes.ADD_CUSTOMER,payload:t})}}s({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:"Order created for ".concat(p," - \u20b9").concat(o.total.toFixed(2)," (").concat(o.paymentMethod,")"),timestamp:(new Date).toISOString(),type:"order_created"}});return(async()=>{const e="/assets/cash-register-kaching-376867.mp3";(async()=>new Promise(async(t,n)=>{try{let s,i=null;try{const t=await fetch(e);if(t.ok){const e=await t.blob();i=URL.createObjectURL(e),s=new Audio(i)}else s=new Audio(e)}catch(r){s=new Audio(e)}s.volume=1,s.currentTime=0;const a=()=>{const e=s.play();void 0!==e?e.then(()=>{console.log("\u2705 Cash register sound played successfully"),t()}).catch(n):t()},o=e=>{i&&URL.revokeObjectURL(i),n(s.error||new Error("MP3 playback failed"))};s.readyState>=2?a():(s.addEventListener("canplaythrough",a,{once:!0}),s.addEventListener("error",o,{once:!0}),s.load())}catch(s){n(s)}}))().catch(e=>{console.error("\u274c MP3 playback failed:",e),console.warn("Using Web Audio API fallback (lower quality)");try{const e=new(window.AudioContext||window.webkitAudioContext),t=(t,n,r)=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination),s.frequency.value=t,s.type="sine",i.gain.setValueAtTime(.5,n),i.gain.exponentialRampToValueAtTime(.01,n+r),s.start(n),s.stop(n+r)},n=e.currentTime;t(800,n,.05),t(1e3,n+.05,.05),t(1200,n+.1,.1)}catch(qb){console.error("\u274c Fallback also failed:",qb)}})})(),v&&((e,t)=>{const n=It(t);if(!n)return void lt("Mobile number is missing. Please add it before sending via WhatsApp.","warning");if(!Et(n))return void lt("Mobile number is incorrect. Please enter a valid 10-digit number starting with 6-9.","error");const r="91".concat(n),s=(e.items||[]).map((e,t)=>{const n=e.unit||e.quantityUnit||"",r=Wt(e).toFixed(2);return"".concat(t+1,". ").concat(e.name," \u2022 ").concat(e.quantity," ").concat(n," x \u20b9").concat(e.price.toFixed(2)," = \u20b9").concat(r)}).join("\n"),i=(e.subtotal||0)*(e.discountPercent||0)/100,a=((e.subtotal||0)-i)*(e.taxPercent||0)/100,o=["\u2728 *Drag & Drop Billing* \u2728","","\ud83e\uddfe *Invoice*: ".concat(e.id),"\ud83d\udc64 *Customer*: ".concat(e.customerName),"\ud83d\udcb3 *Payment*: ".concat(Vt(e.paymentMethod||"cash")),"","*Items*",s||"\u2014","","Subtotal: \u20b9".concat((e.subtotal||0).toFixed(2)),"Discount (".concat(e.discountPercent||0,"%): \u20b9").concat(i.toFixed(2)),"Tax (".concat(e.taxPercent||0,"%): \u20b9").concat(a.toFixed(2)),"*Total*: \u20b9".concat((e.total||0).toFixed(2)),"","\ud83d\udcc5 ".concat(new Date(e.date||e.createdAt||Date.now()).toLocaleString()),"","\ud83d\ude80 Powered by *Drag & Drop*"],l=encodeURIComponent(o.join("\n")),c="https://wa.me/".concat(r,"?text=").concat(l);window.open(c,"_blank")})(o,x||N),we.current=!1,A([]),l(""),d(""),h(""),w(!1),C(0),E(0),j("cash"),f(""),g(!1),D(""),Q(null),Y(!1),R(!1),$(!1),re(null),ie(null),y(!0),s({type:i.ActionTypes.SET_BILLING_DRAFT,payload:null}),ve.current=null,setTimeout(()=>{we.current=!0},0),oe(null),Z(!1),le.current=!1,setTimeout(()=>{ce.current.delete(S),console.log("\ud83d\udd27 Removed order from finalizing set:",S)},1e3),!0},Ft=b?(c||"").trim():((null===(n=r.customers.find(e=>e.id===o))||void 0===n?void 0:n.name)||o||"").toString().trim(),Ut=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(le.current)return void lt("hi"===r.currentLanguage?"\u092c\u093f\u0932 \u091c\u0928\u0930\u0947\u0936\u0928 \u092a\u0939\u0932\u0947 \u0938\u0947 \u091a\u0932 \u0930\u0939\u093e \u0939\u0948, \u0915\u0943\u092a\u092f\u093e \u092a\u094d\u0930\u0924\u0940\u0915\u094d\u0937\u093e \u0915\u0930\u0947\u0902...":"Bill generation already in progress, please wait...","warning");if(console.log("\ud83d\udd27 Generate Bill clicked"),console.log("\ud83d\udd27 Bill items:",S),console.log("\ud83d\udd27 Selected customer:",o),console.log("\ud83d\udd27 Use custom name:",b),console.log("\ud83d\udd27 Custom customer name:",c),0===S.length)return void lt(Ze("pleaseAddItems",r.currentLanguage),"warning");if(ae)return void lt("hi"===r.currentLanguage?"\u0915\u0943\u092a\u092f\u093e \u0928\u092f\u093e \u092c\u093f\u0932 \u092c\u0928\u093e\u0928\u0947 \u0938\u0947 \u092a\u0939\u0932\u0947 \u0932\u0902\u092c\u093f\u0924 \u0911\u0928\u0932\u093e\u0907\u0928 \u092d\u0941\u0917\u0924\u093e\u0928 (UPI) \u092a\u0942\u0930\u093e \u0915\u0930\u0947\u0902\u0964":"Please complete the pending online payment before creating a new bill.","warning");if(le.current=!0,m&&!x)return lt("hi"===r.currentLanguage?"\u0915\u0943\u092a\u092f\u093e \u0938\u0939\u0940 \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 (10 \u0905\u0902\u0915, 6-9 \u0938\u0947 \u0936\u0941\u0930\u0942)\u0964":"Please enter a valid 10-digit mobile number starting with 6-9.","error"),void(le.current=!1);if(Ft&&(!m||!Et(It(m))))return lt("hi"===r.currentLanguage?"\u0917\u094d\u0930\u093e\u0939\u0915 \u0928\u093e\u092e \u0915\u0947 \u0932\u093f\u090f \u0935\u0948\u0927 \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 (10 \u0905\u0902\u0915, 6-9 \u0938\u0947 \u0936\u0941\u0930\u0942)\u0964":"Please enter a valid 10-digit mobile number starting with 6-9 for the customer.","error"),void(le.current=!1);for(const a of S){const e=r.products.find(e=>e.id===a.id);if(e){const t=sd(e,a.quantity,a.unit);if(!t.available){if(t.error)return lt(t.error,"error"),void(le.current=!1);const n=(r.currentLanguage,"\u26a0\ufe0f ".concat(Ze("stockError",r.currentLanguage),"! ").concat(Ze("product",r.currentLanguage),": ").concat(e.name," (").concat(Ze("available",r.currentLanguage),": ").concat(t.stockDisplay,", ").concat(Ze("requested",r.currentLanguage),": ").concat(t.requestedDisplay,"). ").concat(Ze("cannotGenerateBill",r.currentLanguage),"."));return lt(n,"error"),void(le.current=!1)}}}const t=e?e.useCustomName:b,n=e?e.customCustomerName:c,s=e?e.selectedCustomer:o,i=e?e.paymentMethod:T,l=e?e.splitPaymentDetails:ne,d=e?e.billingMobile:m;let u="";if(n&&n.trim())u=n.trim();else if(t)u=(n||"").trim();else{const e=r.customers.find(e=>e.name===s||e.id===s);u=e?e.name.trim():(s||"").trim()}const h="split"===i&&l;if("cash"!==i&&"upi"!==i||h){if(!u||""===u||"Walk-in Customer"===u){const e=h?"hi"===r.currentLanguage?"\u0938\u094d\u092a\u094d\u0932\u093f\u091f \u092d\u0941\u0917\u0924\u093e\u0928 \u0915\u0947 \u0932\u093f\u090f \u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u0928\u093e\u092e \u0906\u0935\u0936\u094d\u092f\u0915 \u0939\u0948\u0964 \u0915\u0943\u092a\u092f\u093e \u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u0928\u093e\u092e \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902\u0964":"Customer name is required for split payment. Please enter customer name.":Ze("pleaseEnterCustomerName",r.currentLanguage);return lt(e,"warning"),void(le.current=!1)}}else u&&""!==u.trim()||(u="Walk-in Customer");const f=e?e.sendWhatsAppInvoice:p,g=d.trim(),y=It(g);if(h){if(!y)return lt("hi"===r.currentLanguage?"\u0938\u094d\u092a\u094d\u0932\u093f\u091f \u092d\u0941\u0917\u0924\u093e\u0928 \u0915\u0947 \u0932\u093f\u090f \u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0906\u0935\u0936\u094d\u092f\u0915 \u0939\u0948\u0964 \u0915\u0943\u092a\u092f\u093e \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902\u0964":"Mobile number is required for split payment. Please enter mobile number.","error"),void(le.current=!1);if(!/^[6-9]\d{9}$/.test(y))return lt("hi"===r.currentLanguage?"\u0915\u0943\u092a\u092f\u093e \u090f\u0915 \u0935\u0948\u0927 \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 (10 \u0905\u0902\u0915, 6-9 \u0938\u0947 \u0936\u0941\u0930\u0942)\u0964":"Please enter a valid mobile number (10 digits, starting with 6-9).","error"),void(le.current=!1)}if(f){if(!y)return lt("Please enter a mobile number before sending via WhatsApp.","warning"),void(le.current=!1);if(!/^[6-9]\d{9}$/.test(y))return lt("Enter a valid 10-digit mobile number starting with 6-9 for WhatsApp invoices.","error"),void(le.current=!1)}const w="split"===i&&l&&l.dueAmount>0;if("due"===i||"credit"===i||w){if(!y)return lt("hi"===r.currentLanguage?"\u0921\u094d\u092f\u0942 \u092d\u0941\u0917\u0924\u093e\u0928 \u0915\u0947 \u0932\u093f\u090f \u0917\u094d\u0930\u093e\u0939\u0915 \u0915\u093e \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0906\u0935\u0936\u094d\u092f\u0915 \u0939\u0948\u0964 \u0915\u0943\u092a\u092f\u093e \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902\u0964":"Mobile number is required for due payment. Please enter mobile number.","error"),void(le.current=!1);if(!/^[6-9]\d{9}$/.test(y))return lt("hi"===r.currentLanguage?"\u0915\u0943\u092a\u092f\u093e \u090f\u0915 \u0935\u0948\u0927 \u092e\u094b\u092c\u093e\u0907\u0932 \u0928\u0902\u092c\u0930 \u0926\u0930\u094d\u091c \u0915\u0930\u0947\u0902 (10 \u0905\u0902\u0915, 6-9 \u0938\u0947 \u0936\u0941\u0930\u0942)\u0964":"Please enter a valid mobile number (10 digits, starting with 6-9).","error"),void(le.current=!1)}const v="due"===i||"credit"===i||w;let N=null;if(("due"===i||"credit"===i||w)&&u&&y){const e=u.trim().toLowerCase();if(N=Qe.find(t=>{const n=(t.name||"").trim().toLowerCase(),r=It(t.mobileNumber||t.phone||"");return n===e&&(r&&y&&r===y)}),!N&&nt)return mt(),void(le.current=!1)}const A=(0,Se.$u)();if(!A)return lt("hi"===r.currentLanguage?"\u0935\u093f\u0915\u094d\u0930\u0947\u0924\u093e \u092a\u094d\u0930\u092e\u093e\u0923\u0940\u0915\u0930\u0923 \u0924\u094d\u0930\u0941\u091f\u093f\u0964 \u0915\u0943\u092a\u092f\u093e \u092a\u0941\u0928\u0903 \u092a\u094d\u0930\u0935\u0947\u0936 \u0915\u0930\u0947\u0902\u0964":"Seller authentication error. Please login again.","error"),void(le.current=!1);let C=null;if(!b&&o){const e=r.customers.find(e=>e.id===o||e.name===o);e&&(C=e.id)}if(!C&&y&&u&&""!==u.trim()&&"walk-in customer"!==u.trim().toLowerCase()){const e=u.trim().toLowerCase(),t=r.customers.find(t=>{const n=(t.name||"").trim().toLowerCase(),r=It(t.mobileNumber||t.phone||"");return n===e&&(r&&y&&r===y)});t&&(C=t.id)}const E=S.map(e=>{var t,n;const s=r.products.find(t=>t.id===e.id),i=(null===s||void 0===s?void 0:s.quantityUnit)||(null===s||void 0===s?void 0:s.unit)||e.productUnit||e.quantityUnit||e.unit||"pcs",a=null!==(t=e.totalSellingPrice)&&void 0!==t?t:Math.floor((e.price||0)*(e.quantity||0)*100)/100,o=null!==(n=e.totalCostPrice)&&void 0!==n?n:s?function(e,t){var n,r,s,i;if(void 0!==(null===e||void 0===e?void 0:e.totalCostPrice)&&null!==(null===e||void 0===e?void 0:e.totalCostPrice))return Math.floor(100*(Number(e.totalCostPrice)||0))/100;const a=e.productUnit||(null===t||void 0===t?void 0:t.quantityUnit)||(null===t||void 0===t?void 0:t.unit)||"pcs",o=null!==(n=null!==(r=null!==(s=e.productCostPricePerUnit)&&void 0!==s?s:null===t||void 0===t?void 0:t.costPrice)&&void 0!==r?r:null===t||void 0===t?void 0:t.unitPrice)&&void 0!==n?n:0,l=null!==(i=e.selectedQuantityInProductUnits)&&void 0!==i?i:Kc(e.quantity,e.unit)/(Kc(1,a)||1);return Math.floor(o*l*100)/100}(e,s):Math.floor(((null===s||void 0===s?void 0:s.costPrice)||(null===s||void 0===s?void 0:s.unitPrice)||0)*(e.quantity||0)*100)/100,l="number"===typeof a?a:parseFloat(a)||0,c="number"===typeof o?o:parseFloat(o)||0,d=(Number.isFinite(Number(e.quantityInBaseUnit))?Number(e.quantityInBaseUnit):Kc("number"===typeof e.quantity?e.quantity:parseFloat(e.quantity)||0,e.unit||e.quantityUnit||i))/(Kc(1,i)||1),u=Math.round(1e3*(Number.isFinite(d)?d:0))/1e3,h=0!==u?Math.floor(l/u*100)/100:0,m=0!==u?Math.floor(c/u*100)/100:0,f=Math.floor(100*l)/100,p=Math.floor(100*c)/100;return{productId:(null===s||void 0===s?void 0:s._id)||e.productId||null,name:e.name||(null===s||void 0===s?void 0:s.name)||"",sellingPrice:f,costPrice:p,quantity:u,unit:i,totalSellingPrice:f,totalCostPrice:p,unitSellingPrice:h,unitCostPrice:m,originalQuantity:{quantity:Number.isFinite(Number(e.quantity))?Number(e.quantity):parseFloat(e.quantity)||0,unit:e.unit||e.quantityUnit||i}}}),j=Math.floor(100*vt)/100;if(!ht())return;let k=null;if(h&&l){let e=l.splitType||l.type;if(!e){const t=l.cashAmount||0,n=l.onlineAmount||0,r=l.dueAmount||0;t>0&&n>0?e="cash_online":n>0&&r>0?e="online_due":t>0&&r>0&&(e="cash_due")}k={type:e,cashAmount:l.cashAmount||0,onlineAmount:l.onlineAmount||0,dueAmount:l.dueAmount||0},console.log("\ud83d\udd27 Created splitDetails:",k)}const D={id:Date.now().toString(),sellerId:A,customerId:C,customerName:u,customerMobile:y||g||"",paymentMethod:i,splitPaymentDetails:k,items:E,totalAmount:j,subtotal:xt,discountPercent:_,taxPercent:I,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isSynced:!1,stockDeducted:!1};console.log("\ud83c\udfaf Preparing Order (MongoDB schema):",D);const P=S.map(e=>{var t;return(0,a.A)((0,a.A)({},e),{},{total:null!==(t=e.total)&&void 0!==t?t:(e.price||0)*(e.quantity||0)})}),R={id:D.id,customerId:D.customerId,customerName:u,items:P,subtotal:xt,discountPercent:_,taxPercent:I,total:D.totalAmount,paymentMethod:D.paymentMethod,splitPaymentDetails:k,customerMobile:y||g,date:D.createdAt,status:"upi"===i||h&&k&&k.onlineAmount>0?"pending":"completed",storeName:r.storeName||"Grocery Store",upiId:fe};console.log("\ud83d\udd27 Bill object created with seller UPI ID:",fe);const O={order:D,bill:R,billItemsSnapshot:P,matchedDueCustomer:N,isDueLikePayment:v,customerName:u,sanitizedMobile:y,useCustomNameFlag:t,sendWhatsAppInvoiceFlag:f,effectiveMobile:g};if(h&&k&&k.onlineAmount>0){if(console.log("\ud83d\udd27 Split payment with online amount detected:",k),!fe)return lt("Please add your business UPI ID in Settings before accepting online payments.","error"),void(le.current=!1);if(ae)return lt("Please complete the pending online payment before creating a new bill.","warning"),void(le.current=!1);const e=(0,a.A)((0,a.A)({},R),{},{upiId:fe,splitPaymentDetails:k});return console.log("\ud83d\udd27 Setting pending order for split payment with online:",{order:D,splitDetails:k,bill:e,sellerUpiId:fe}),console.log("\ud83d\udd27 Seller UPI ID being used for QR generation:",fe),oe((0,a.A)((0,a.A)({},O),{},{bill:e})),ie(e),Z(!0),void(le.current=!1)}if(h&&k&&(!k.onlineAmount||0===k.onlineAmount)){console.log("\ud83d\udd27 Split payment without online amount - finalizing immediately:",k);if(Mt(O)){const e="".concat(Ze("billGeneratedSuccessfully",r.currentLanguage),"! ").concat(Ze("customers",r.currentLanguage),": ").concat(R.customerName,", ").concat(Ze("total",r.currentLanguage),": \u20b9").concat(R.total.toFixed(2));lt(e,"success")}return}if("upi"===i){if(!fe)return lt("Please add your business UPI ID in Settings before accepting online payments.","error"),void(le.current=!1);if(ae)return lt("Please complete the pending online payment before creating a new bill.","warning"),void(le.current=!1);const e=(0,a.A)((0,a.A)({},R),{},{upiId:fe});return console.log("\ud83d\udd27 Setting pending order for UPI payment with seller UPI ID:",fe),oe((0,a.A)((0,a.A)({},O),{},{bill:e})),ie(e),Z(!0),void(le.current=!1)}if(Mt(O)){const e="".concat(Ze("billGeneratedSuccessfully",r.currentLanguage),"! ").concat(Ze("customers",r.currentLanguage),": ").concat(R.customerName,", ").concat(Ze("total",r.currentLanguage),": \u20b9").concat(R.total.toFixed(2));lt(e,"success")}},zt=()=>{if(0!==S.length)try{var e;const t=new Uo("p","mm","a4"),n=t.internal.pageSize.getWidth(),s=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setFontSize(18),t.text("TAX INVOICE",n/2,15,{align:"center"}),t.setFontSize(11);const i=r.username||"Grocery Store",a=r.gstNumber||"N/A";t.text(i,14,26),t.text("GST: ".concat(a),14,32);const l="BILL-".concat(Date.now().toString().slice(-6)),d=b?c:(null===(e=r.customers.find(e=>e.id===o))||void 0===e?void 0:e.name)||"Walk-in Customer";t.text("Invoice: ".concat(l),n-14,26,{align:"right"}),t.text("Date: ".concat((new Date).toLocaleDateString()),n-14,32,{align:"right"}),t.text("Customer: ".concat(d),14,42),t.text("Payment: ".concat(Vt(T)),14,48);const u=58;t.setFillColor(234,238,243),t.setDrawColor(220),t.rect(10,u-6,n-20,8,"F"),t.setFontSize(10),t.setTextColor(30),t.text("Item",14,u),t.text("Qty",100,u),t.text("Rate (Rs)",130,u,{align:"right"}),t.text("Amount (Rs)",n-14,u,{align:"right"});let h=u+6;t.setTextColor(50),t.setFontSize(9),S.forEach(e=>{h>s-40&&(t.addPage(),t.setFillColor(234,238,243),t.setDrawColor(220),t.rect(10,10,n-20,8,"F"),t.setFontSize(10),t.setTextColor(30),t.text("Item",14,16),t.text("Qty",100,16),t.text("Rate (Rs)",130,16,{align:"right"}),t.text("Amount (Rs)",n-14,16,{align:"right"}),h=24,t.setTextColor(50),t.setFontSize(9));const r=Wt(e).toFixed(2);t.text(e.name.substring(0,30),14,h),t.text("".concat(e.quantity," ").concat(e.unit||""),100,h),t.text("".concat(e.price.toFixed(2)),130,h,{align:"right"}),t.text("".concat(r),n-14,h,{align:"right"}),h+=5}),h+=4,t.setDrawColor(220),t.rect(n-80,h,70,28),t.setFontSize(10),t.text("Subtotal: Rs ".concat(xt.toFixed(2)),n-76,h+8),t.text("Discount: Rs ".concat(yt.toFixed(2)),n-76,h+14),t.text("Tax: Rs ".concat(wt.toFixed(2)),n-76,h+20),t.setFontSize(12),t.text("TOTAL: Rs ".concat(vt.toFixed(2)),n-76,h+26),t.setFontSize(9),t.setTextColor(120),t.text("Thank you for your business!",n/2,s-10,{align:"center"}),t.save("invoice-".concat(d.replace(/\s+/g,"-"),"-").concat(Date.now(),".pdf")),window.showToast&&window.showToast("Bill downloaded successfully!","success")}catch(t){console.error("Error generating PDF:",t),window.showToast&&window.showToast("Error generating PDF. Please try again.","error")}};(0,t.useEffect)(()=>{const e=e=>{115!==e.keyCode&&"F4"!==e.key||(e.preventDefault(),S.length>0?zt():lt("Please add items to the bill first","warning"))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[S]);const Ht=e=>{const t=Number(e);if(!Number.isFinite(t))return"\u20b90.00";const n=Math.floor(100*t)/100;return"\u20b9".concat(n.toFixed(2))},Vt=e=>{if(!e)return"Cash";switch(e){case"upi":return"Online Payment";case"due":case"credit":return"Due (Credit)";default:return e.charAt(0).toUpperCase()+e.slice(1)}};function Wt(e){var t,n,r;const s=null!==(t=null===e||void 0===e?void 0:e.totalSellingPrice)&&void 0!==t?t:(null!==(n=null===e||void 0===e?void 0:e.price)&&void 0!==n?n:0)*(null!==(r=null===e||void 0===e?void 0:e.quantity)&&void 0!==r?r:0);return Math.floor(100*(Number(s)||0))/100}const Gt=function(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const i=e.quantityUnit||e.unit||"pcs",a=r||Qc(i),o=Kc(t,n),l=Kc(1,i),c=o/(0===l?1:l),d=Number(e.sellingPrice||e.costPrice||0),u=Number(e.costPrice||e.unitPrice||0),h=null!==s?Math.floor(100*(Number(s)||0))/100:Math.floor(d*c*100)/100,m=Math.floor(u*c*100)/100,f=((e,t,n,r)=>{const s=Kc(e,t),i=s/Kc(1,r)*n;return{quantityInBaseUnit:s,totalPrice:Math.round(100*i)/100,displayQuantity:rd(e,t)}})(t,n,e.sellingPrice||e.costPrice||0,e.quantityUnit||"pcs");return{id:e.id,productId:e._id||e.id,name:e.name,price:0!==t?Math.floor(h/t*100)/100:0,quantity:t,unit:n,quantityUnit:e.quantityUnit||"pcs",category:e.category,displayQuantity:f.displayQuantity,maxQuantity:e.quantity||e.stock||0,baseUnit:a,productUnit:i,productSellingPricePerUnit:d,productCostPricePerUnit:u,selectedQuantityInProductUnits:c,totalSellingPrice:h,totalCostPrice:m,quantityInBaseUnit:o}};return(0,Pe.jsxs)("div",{className:"min-h-screen pb-8",children:[(0,Pe.jsxs)("div",{className:"mb-8",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-2xl font-bold mb-1",style:{color:"var(--text-primary)"},children:Ze("billingSystem",r.currentLanguage)}),(0,Pe.jsx)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:Ze("createAndManageBills",r.currentLanguage)})]}),(0,Pe.jsxs)("div",{className:"flex gap-2",children:[(0,Pe.jsxs)("button",{onClick:zt,className:"btn-secondary text-sm px-4 py-2 flex items-center justify-center gap-2",disabled:0===S.length,children:[(0,Pe.jsx)(st,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Download"})]}),("standard"===r.currentPlan||"premium"===r.currentPlan)&&(0,Pe.jsxs)("button",{onClick:()=>{if(0!==S.length)try{var e;const t=new Uo("p","mm","a4"),n=t.internal.pageSize.getWidth(),s=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setFontSize(18),t.text("TAX INVOICE",n/2,15,{align:"center"}),t.setFontSize(11);const i=r.username||"Grocery Store",a=r.gstNumber||"N/A";t.text(i,14,26),t.text("GST: ".concat(a),14,32);const l="BILL-".concat(Date.now().toString().slice(-6)),d=b?c:(null===(e=r.customers.find(e=>e.id===o))||void 0===e?void 0:e.name)||"Walk-in Customer";t.text("Invoice: ".concat(l),n-14,26,{align:"right"}),t.text("Date: ".concat((new Date).toLocaleDateString()),n-14,32,{align:"right"}),t.text("Customer: ".concat(d),14,42),t.text("Payment: ".concat(Vt(T)),14,48);const u=58;t.setFillColor(234,238,243),t.setDrawColor(220),t.rect(10,u-6,n-20,8,"F"),t.setFontSize(10),t.setTextColor(30),t.text("Item",14,u),t.text("Qty",100,u),t.text("Rate (Rs)",130,u,{align:"right"}),t.text("Amount (Rs)",n-14,u,{align:"right"});let h=u+6;t.setTextColor(50),t.setFontSize(9),S.forEach(e=>{h>s-40&&(t.addPage(),t.setFillColor(234,238,243),t.setDrawColor(220),t.rect(10,10,n-20,8,"F"),t.setFontSize(10),t.setTextColor(30),t.text("Item",14,16),t.text("Qty",100,16),t.text("Rate (Rs)",130,16,{align:"right"}),t.text("Amount (Rs)",n-14,16,{align:"right"}),h=24,t.setTextColor(50),t.setFontSize(9));const r=Wt(e).toFixed(2);t.text(e.name.substring(0,30),14,h),t.text("".concat(e.quantity," ").concat(e.unit||""),100,h),t.text("".concat(e.price.toFixed(2)),130,h,{align:"right"}),t.text("".concat(r),n-14,h,{align:"right"}),h+=5}),h+=4,t.setDrawColor(220),t.rect(n-80,h,70,28),t.setFontSize(10),t.text("Subtotal: Rs ".concat(xt.toFixed(2)),n-76,h+8),t.text("Discount: Rs ".concat(yt.toFixed(2)),n-76,h+14),t.text("Tax: Rs ".concat(wt.toFixed(2)),n-76,h+20),t.setFontSize(12),t.text("TOTAL: Rs ".concat(vt.toFixed(2)),n-76,h+26),t.setFontSize(9),t.setTextColor(120),t.text("Thank you for your business!",n/2,s-10,{align:"center"});const m=t.output("blob"),f=URL.createObjectURL(m),p=document.createElement("a");p.href=f,p.download="invoice-".concat(d.replace(/\s+/g,"-"),"-").concat(Date.now(),".pdf"),document.body.appendChild(p),p.click(),document.body.removeChild(p);const g="Invoice from ".concat(i,"\nCustomer: ").concat(d,"\nTotal: Rs ").concat(vt.toFixed(2),"\n\nPlease check the downloaded PDF file."),x="https://web.whatsapp.com/send?text=".concat(encodeURIComponent(g));window.open(x,"_blank"),setTimeout(()=>{URL.revokeObjectURL(f)},1e3),window.showToast&&window.showToast("PDF downloaded! WhatsApp Web opened - attach the PDF file manually.","success")}catch(t){console.error("Error sharing to WhatsApp:",t),window.showToast&&window.showToast("Error sharing to WhatsApp. Please try again.","error")}},className:"btn-primary text-sm px-4 py-2 flex items-center justify-center gap-2",disabled:0===S.length,children:[(0,Pe.jsx)(At,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Share"})]})]})]}),(0,Pe.jsxs)("div",{className:"flex gap-3 text-xs",children:[(0,Pe.jsxs)("span",{className:"px-2.5 py-1 rounded-md font-medium",style:{background:"var(--brand-primary-soft)",color:"var(--brand-primary)"},children:["Orders: ",at,"/",rt]}),(0,Pe.jsxs)("span",{className:"px-2.5 py-1 rounded-md font-medium",style:{background:"var(--brand-accent-soft)",color:"#C2410C"},children:["Customers: ",ot,"/",it]})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Pe.jsxs)("div",{className:"lg:col-span-2 space-y-5",children:[(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Add Products"}),(0,Pe.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,Pe.jsxs)("div",{className:"relative",children:[(0,Pe.jsx)("input",{type:"text",placeholder:"Search products...",value:v,onChange:e=>N(e.target.value),className:"input-field pr-24"}),(0,Pe.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>Ue(!0),className:"p-1.5 rounded-lg transition-all duration-200 hover:scale-110 active:scale-95",style:{color:"var(--brand-primary)",background:"rgba(47, 60, 126, 0.08)",border:"1px solid rgba(47, 60, 126, 0.15)"},title:"Voice input - Say product names with quantities",children:(0,Pe.jsx)(Vc,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>R(!0),className:"p-1.5 rounded-lg transition-all duration-200 hover:scale-110 active:scale-95",style:{color:"var(--brand-primary)",background:"rgba(47, 60, 126, 0.08)",border:"1px solid rgba(47, 60, 126, 0.15)"},title:"Camera Scanner",children:(0,Pe.jsx)(Wc,{className:"h-4 w-4"})})]})]}),Ne&&(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,Pe.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,Pe.jsx)("p",{className:"text-sm text-blue-800 font-semibold",children:"Listening..."})]}),_e&&(0,Pe.jsx)("div",{className:"mt-2 p-2 bg-white rounded border border-blue-200",children:(0,Pe.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,Pe.jsx)("span",{className:"text-gray-500 italic",children:"You said:"})," ",_e]})}),!_e&&(0,Pe.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:'Say product names in a sentence (e.g., "Rice Sugar Oil")'})]}),(0,Pe.jsx)("div",{className:"relative hidden",children:(0,Pe.jsx)("input",{type:"text",placeholder:"Scan barcode...",value:k,ref:O,onChange:e=>{const t=e.target.value;D(t);const n=t.trim();n?ut(n):U.current&&clearTimeout(U.current)},onPaste:e=>{var t;const n=((null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text"))||"").trim();n&&(D(n),ut(n))},onKeyPress:e=>{if("Enter"===e.key){const e=k.trim();e&&Nt(e)}},className:"input-field pr-12"})})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto",children:gt.map(e=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors border",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsx)("h4",{className:"font-medium truncate",style:{color:"var(--text-primary)"},title:e.name,children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:["\u20b9",(e.sellingPrice||e.costPrice||0).toFixed(2),"/",e.quantityUnit||e.unit||"pcs"," \u2022 Stock: ",e.quantity||e.stock||0]})]}),(0,Pe.jsx)("button",{onClick:()=>St(e),className:"btn-primary p-2 ml-2 flex-shrink-0 rounded-lg",style:{minWidth:"36px",minHeight:"36px"},children:(0,Pe.jsx)(Bt,{className:"h-4 w-4"})})]},e.id))})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,Pe.jsxs)("h3",{className:"text-lg font-semibold",style:{color:"var(--text-primary)"},children:["Cart (",S.length,")"]})}),0===S.length?(0,Pe.jsxs)("div",{className:"text-center py-12",children:[(0,Pe.jsx)(bt,{className:"h-12 w-12 mx-auto mb-3",style:{color:"var(--text-secondary)",opacity:.3}}),(0,Pe.jsx)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"No items yet"})]}):(0,Pe.jsx)("div",{className:"space-y-2",children:S.map(e=>{const t=r.products.find(t=>t.id===e.id)||e,n=(e,t,n)=>_t(e,t,n);return(0,Pe.jsxs)("div",{onClick:()=>{M((0,a.A)((0,a.A)({},t),{},{_isEdit:!0,_editHandler:n,_currentQuantity:e.quantity,_currentUnit:e.unit||e.quantityUnit||"pcs"})),B(!0)},className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-3 rounded-lg border cursor-pointer transition-all duration-200 hover:shadow-md",style:{borderColor:"var(--border-subtle)"},onMouseEnter:e=>{e.currentTarget.style.borderColor="var(--brand-primary)",e.currentTarget.style.backgroundColor="rgba(47, 60, 126, 0.02)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--border-subtle)",e.currentTarget.style.backgroundColor="transparent"},children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,Pe.jsx)("h4",{className:"font-medium break-words sm:truncate",style:{color:"var(--text-primary)"},children:e.name}),(0,Pe.jsx)("span",{className:"text-xs font-semibold px-2 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200",children:rd(e.quantity,e.unit||e.quantityUnit||"pcs")})]}),(0,Pe.jsxs)("p",{className:"text-xs mt-0.5 break-words",style:{color:"var(--text-secondary)"},children:["\u20b9",e.price.toFixed(2),"/",e.unit||e.quantityUnit||"pcs"]})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-3 flex-shrink-0",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-1.5 sm:gap-2 border rounded-lg px-1.5 sm:px-2 py-1 flex-shrink-0",style:{borderColor:"var(--border-subtle)"},onClick:e=>e.stopPropagation(),children:[(0,Pe.jsx)("button",{onClick:()=>Lt(e.id,e.quantity-1),className:"w-8 h-8 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center font-semibold transition-all duration-200 active:scale-95 touch-manipulation",style:{color:"var(--text-primary)",background:"rgba(47, 60, 126, 0.05)",border:"1px solid rgba(47, 60, 126, 0.1)"},"aria-label":"Decrease quantity",children:"\u2212"}),(0,Pe.jsx)("span",{className:"min-w-[60px] sm:min-w-[50px] text-center text-sm font-semibold",style:{color:"var(--text-primary)"},children:rd(e.quantity,e.unit||e.quantityUnit||"pcs")}),(0,Pe.jsx)("button",{onClick:()=>Lt(e.id,e.quantity+1),className:"w-8 h-8 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center font-semibold transition-all duration-200 active:scale-95 touch-manipulation",style:{color:"var(--text-primary)",background:"rgba(47, 60, 126, 0.05)",border:"1px solid rgba(47, 60, 126, 0.1)"},"aria-label":"Increase quantity",children:"+"})]}),(0,Pe.jsxs)("span",{className:"font-bold text-base sm:text-base sm:w-20 sm:text-right flex-shrink-0",style:{color:"var(--text-primary)"},children:["\u20b9",Wt(e).toFixed(2)]}),(0,Pe.jsx)("button",{onClick:t=>{var n;t.stopPropagation(),n=e.id,A(e=>e.filter(e=>e.id!==n))},className:"p-2 sm:p-1.5 rounded-lg transition-all duration-200 active:scale-95 touch-manipulation flex-shrink-0",style:{color:"#BE123C",background:"rgba(190, 18, 60, 0.08)",border:"1px solid rgba(190, 18, 60, 0.15)"},"aria-label":"Remove item",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})]},e.id)})})]})]}),(0,Pe.jsx)("div",{className:"lg:col-span-1",children:(0,Pe.jsxs)("div",{className:"card sticky top-4",children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Summary"}),(0,Pe.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Pe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Pe.jsx)("span",{style:{color:"var(--text-secondary)"},children:"Subtotal"}),(0,Pe.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:Ht(xt)})]}),(0,Pe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Pe.jsx)("span",{style:{color:"var(--text-secondary)"},children:"Discount"}),(0,Pe.jsxs)("span",{className:"font-medium",style:{color:"#BE123C"},children:["-\u20b9",yt.toFixed(2)]})]}),(0,Pe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Pe.jsx)("span",{style:{color:"var(--text-secondary)"},children:"Tax"}),(0,Pe.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:Ht(wt)})]}),(0,Pe.jsx)("div",{className:"h-px my-3",style:{background:"var(--border-subtle)"}}),(0,Pe.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,Pe.jsx)("span",{style:{color:"var(--text-primary)"},children:"Total"}),(0,Pe.jsx)("span",{style:{color:"var(--brand-primary)"},children:Ht(vt)})]})]}),(0,Pe.jsxs)("div",{className:"space-y-3 pt-4 border-t",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Discount (%)"}),(0,Pe.jsx)("input",{type:"number",value:_||"",onChange:e=>{const t=e.target.value;C(""===t?0:parseFloat(t)||0)},className:"input-field text-sm",min:"0",max:"100",placeholder:"0"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Tax (%)"}),(0,Pe.jsx)("input",{type:"number",value:I||"",onChange:e=>{const t=e.target.value;E(""===t?0:parseFloat(t)||0)},className:"input-field text-sm",min:"0",max:"100",placeholder:"0"})]}),(0,Pe.jsxs)("button",{onClick:()=>{0!==S.length?te(!0):lt(Ze("pleaseAddItems",r.currentLanguage),"warning")},className:"w-full btn-primary mt-4 flex items-center justify-center",disabled:le.current||0===S.length,children:[(0,Pe.jsx)(Be,{className:"h-4 w-4 mr-2"}),"Generate Bill"]})]})]})}),F&&L&&(0,Pe.jsx)(id,{product:L,onClose:()=>{B(!1),M(null)},onAdd:L._editHandler||Ct}),P&&(0,Pe.jsx)(Lu,{onScan:e=>{D(e),Nt(e),R(!1)},onClose:()=>R(!1)}),G&&X&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,Pe.jsx)(Wc,{className:"h-5 w-5 mr-2 text-primary-600"}),"Bill QR Code"]}),(0,Pe.jsx)("button",{onClick:()=>Y(!1),className:"text-gray-500 hover:text-gray-700",children:"\xd7"})]}),(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:[(0,Pe.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Bill ID: ",X.billId]}),(0,Pe.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Customer: ",X.customerName]}),(0,Pe.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Total: \u20b9",X.total.toFixed(2)]}),(0,Pe.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Date: ",new Date(X.date).toLocaleDateString()]})]}),(0,Pe.jsx)("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg mb-4 inline-block",children:(0,Pe.jsx)("div",{className:"grid grid-cols-8 gap-1",children:Array.from({length:64},(e,t)=>(0,Pe.jsx)("div",{className:"w-3 h-3 ".concat(Math.random()>.5?"bg-black":"bg-white")},t))})}),(0,Pe.jsx)("div",{className:"text-xs text-gray-500 mb-4",children:"Scan this QR code to view bill details"}),(0,Pe.jsxs)("div",{className:"flex space-x-3",children:[(0,Pe.jsxs)("button",{onClick:()=>{(e=>{try{const t=new Uo("p","mm","a4");t.setFont("helvetica"),t.setFontSize(20),t.setTextColor(16,185,129),t.text("Grocery Store Invoice",105,15,{align:"center"}),t.setFontSize(10),t.setTextColor(0,0,0),t.text("Customer Name: ".concat(e.customerName),20,25),t.text("Date: ".concat(new Date(e.date).toLocaleDateString()),20,30),t.text("Invoice #: ".concat(e.id),20,35),r.gstNumber&&t.text("GST #: ".concat(r.gstNumber),105,25,{align:"right"}),t.setFillColor(243,244,246),t.rect(20,42,170,8,"F"),t.setFontSize(10),t.setTextColor(0,0,0),t.text("Product Name",22,48),t.text("Qty",110,48),t.text("Price",135,48),t.text("Total",170,48);let n=54;e.items.forEach(e=>{t.setFontSize(9);const r=e.name.length>25?e.name.substring(0,25)+"...":e.name;t.text(r,22,n);const s=e.displayQuantity||"".concat(e.quantity," ").concat(e.unit||e.quantityUnit||"pcs");t.text(s,110,n),t.text("INR ".concat(e.price.toFixed(2)),135,n),t.text("INR ".concat(Wt(e).toFixed(2)),170,n),n+=7}),n+=5,t.setLineWidth(.5),t.line(20,n,190,n),n+=5,t.setFontSize(10),t.text("Subtotal:",120,n),t.text("INR ".concat(e.subtotal.toFixed(2)),170,n,{align:"right"});const s=(e.subtotal||0)*(e.discountPercent||0)/100,i=((e.subtotal||0)-s)*(e.taxPercent||0)/100;s>0&&(n+=5,t.text("Discount (".concat(e.discountPercent||0,"%):"),120,n),t.text("INR -".concat(s.toFixed(2)),170,n,{align:"right"})),i>0&&(n+=5,t.text("Tax (".concat(e.taxPercent||0,"%):"),120,n),t.text("INR ".concat(i.toFixed(2)),170,n,{align:"right"})),n+=5,t.line(20,n,190,n),n+=5,t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Total Amount:",120,n),t.text("INR ".concat(e.total.toFixed(2)),170,n,{align:"right"}),n+=10,t.setFont("helvetica","normal"),t.setFontSize(10),t.text("Payment Method: ".concat(Vt(e.paymentMethod)),20,n),n+=8,t.setFontSize(10),t.text("Thank you for your business!",105,n,{align:"center"}),t.save("invoice_".concat(e.customerName.replace(/\s+/g,"_"),"_").concat(e.id,".pdf"))}catch(t){console.error("Error generating PDF:",t),alert("Error generating PDF. Please try again.")}})(X),Y(!1)},className:"flex-1 btn-secondary flex items-center justify-center",children:[(0,Pe.jsx)(st,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,Pe.jsx)("button",{onClick:()=>Y(!1),className:"flex-1 btn-primary",children:"Close"})]})]})]})}),K&&se&&("upi"===se.paymentMethod||"split"===se.paymentMethod&&se.splitPaymentDetails&&se.splitPaymentDetails.onlineAmount>0)&&(0,Pe.jsx)(fd,{bill:se,onClose:()=>{Z(!1),ie(null),oe(null),le.current=!1},onPaymentReceived:e=>{var t,n,i;if(!ae)return lt("No pending online payment to confirm.","warning"),Z(!1),void ie(null);const o=null===(t=ae.order)||void 0===t?void 0:t.id,l=o?r.orders.find(e=>e.id===o):null;if(l&&!0===l.stockDeducted)return console.warn("\u26a0\ufe0f Order already finalized with stock deducted, skipping duplicate finalization:",o),lt("Order already processed.","warning"),oe(null),Z(!1),ie(null),void(le.current=!1);console.log("\ud83d\udd27 Payment received, finalizing order:",{pendingOrder:ae,order:ae.order,splitPaymentDetails:null===(n=ae.order)||void 0===n?void 0:n.splitPaymentDetails,orderId:o,stockDeducted:null===(i=ae.order)||void 0===i?void 0:i.stockDeducted});const c=(0,a.A)((0,a.A)({},ae),{},{order:(0,a.A)((0,a.A)({},ae.order),{},{stockDeducted:!1})}),d=Mt(c);if(!d)return console.error("\u274c Failed to finalize order after payment received"),void lt("Failed to create order. Please try again.","error");if(d){const t=async()=>{const e="/assets/cash-register-kaching-376867.mp3";(async()=>new Promise(async(t,n)=>{try{let s,i=null;try{const t=await fetch(e);if(t.ok){const e=await t.blob();i=URL.createObjectURL(e),s=new Audio(i)}else s=new Audio(e)}catch(r){s=new Audio(e)}s.volume=1,s.currentTime=0;const a=()=>{const e=s.play();void 0!==e?e.then(()=>{console.log("\u2705 Cash register sound played successfully"),t()}).catch(n):t()},o=e=>{i&&URL.revokeObjectURL(i),n(s.error||new Error("MP3 playback failed"))};s.readyState>=2?a():(s.addEventListener("canplaythrough",a,{once:!0}),s.addEventListener("error",o,{once:!0}),s.load())}catch(s){n(s)}}))().catch(e=>{console.error("\u274c MP3 playback failed:",e),console.warn("Using Web Audio API fallback (lower quality)");try{const e=new(window.AudioContext||window.webkitAudioContext),t=(t,n,r)=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination),s.frequency.value=t,s.type="sine",i.gain.setValueAtTime(.5,n),i.gain.exponentialRampToValueAtTime(.01,n+r),s.start(n),s.stop(n+r)},n=e.currentTime;t(800,n,.05),t(1e3,n+.05,.05),t(1200,n+.1,.1)}catch(qb){console.error("\u274c Fallback also failed:",qb)}})};t(),s({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:"Online payment (UPI) received for Bill #".concat(ae.bill.id," - \u20b9").concat(ae.bill.total.toFixed(2)).concat(null!==e&&void 0!==e&&e.transactionId?" (Txn: ".concat(e.transactionId,")"):""),timestamp:(new Date).toISOString(),type:"payment_received"}}),lt("Payment of \u20b9".concat(ae.bill.total.toFixed(2)," received successfully!"),"success"),Z(!1),ie(null),oe(null)}},onSaveUPIId:async e=>{s({type:i.ActionTypes.SET_UPI_ID,payload:e}),ie((0,a.A)((0,a.A)({},se),{},{upiId:e})),ae&&oe((0,a.A)((0,a.A)({},ae),{},{bill:(0,a.A)((0,a.A)({},ae.bill),{},{upiId:e})})),lt("UPI ID saved successfully!","success")}}),ee&&(0,Pe.jsx)(yd,{billItems:S,total:vt,sellerUpiId:fe,customers:ft,useCustomName:b,customCustomerName:c,selectedCustomer:o,billingMobile:m,paymentMethod:T,sendWhatsAppInvoice:p,onClose:()=>te(!1),onSubmit:e=>{w(e.useCustomName),d(e.customCustomerName),l(e.selectedCustomer),f(e.billingMobile),j(e.paymentMethod),g(e.sendWhatsAppInvoice),re(e.splitPaymentDetails),te(!1),Ut(e)},onCustomNameChange:w,onSelectedCustomerChange:l,onBillingMobileChange:f,onPaymentMethodChange:j,onSendWhatsAppInvoiceChange:g}),de&&he.length>0&&(0,Pe.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:dt,children:(0,Pe.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},onClick:e=>e.stopPropagation(),children:[(0,Pe.jsx)("h3",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#111827"},children:1===he.length?"Customer Found":"Multiple Customers Found"}),(0,Pe.jsx)("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"20px"},children:1===he.length?"Found 1 customer with this mobile number":"Found ".concat(he.length," customers with this mobile number")}),(0,Pe.jsx)("div",{style:{marginBottom:"24px",maxHeight:"400px",overflowY:"auto"},children:he.map((e,t)=>{const n=It(e.mobileNumber||e.phone||e.phoneNumber||""),r=e.dueAmount||e.balanceDue||0;return(0,Pe.jsxs)("button",{type:"button",onClick:()=>(e=>{if(e){d(e.name);const t=It(e.mobileNumber||e.phone||e.phoneNumber||"");h(t),f(t),y(!0),w(!0),ue(!1),me([])}})(e),style:{width:"100%",textAlign:"left",padding:"16px",marginBottom:"12px",backgroundColor:"#f9fafb",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.backgroundColor="#f3f4f6",e.target.style.borderColor="#3b82f6"},onMouseLeave:e=>{e.target.style.backgroundColor="#f9fafb",e.target.style.borderColor="#e5e7eb"},children:[(0,Pe.jsx)("div",{style:{fontWeight:"600",fontSize:"16px",color:"#111827",marginBottom:"8px"},children:e.name}),(0,Pe.jsxs)("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"4px"},children:["\ud83d\udcf1 Mobile: ",n]}),(0,Pe.jsxs)("div",{style:{fontSize:"14px",color:r>0?"#ea580c":"#6b7280",fontWeight:"500"},children:["Due Amount: \u20b9",r.toFixed(2)]})]},e.id||e._id||t)})}),(0,Pe.jsx)("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:(0,Pe.jsx)("button",{type:"button",onClick:dt,style:{padding:"12px 24px",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"14px",transition:"background-color 0.2s",flex:1},onMouseEnter:e=>e.target.style.backgroundColor="#e5e7eb",onMouseLeave:e=>e.target.style.backgroundColor="#f3f4f6",children:"New Customer"})})]})})]}),je&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] flex flex-col mx-4",children:[(0,Pe.jsx)("div",{className:"flex items-center justify-between p-6 pb-4 flex-shrink-0",children:(0,Pe.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[(0,Pe.jsx)(Vc,{className:"h-6 w-6",style:{color:"var(--brand-primary)"}}),"How to Use Voice Input"]})}),(0,Pe.jsx)("div",{className:"overflow-y-auto px-6 flex-1",children:(0,Pe.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,Pe.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udce2 Speaking Instructions:"}),(0,Pe.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[(0,Pe.jsxs)("li",{className:"flex items-start gap-2",children:[(0,Pe.jsx)("span",{className:"text-blue-600 font-bold",children:"\u2022"}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)("strong",{children:"Single product:"}),' Say "Sugar 500g" or "Rice 1 kg"']})]}),(0,Pe.jsxs)("li",{className:"flex items-start gap-2",children:[(0,Pe.jsx)("span",{className:"text-blue-600 font-bold",children:"\u2022"}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)("strong",{children:"Multiple products:"}),' Say "Kaju 500g Badam 50g Sugar 1kg"']})]}),(0,Pe.jsxs)("li",{className:"flex items-start gap-2",children:[(0,Pe.jsx)("span",{className:"text-blue-600 font-bold",children:"\u2022"}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)("strong",{children:"Quantity updates:"}),' Say "Sugar 1 kg" again to merge with existing quantity']})]}),(0,Pe.jsxs)("li",{className:"flex items-start gap-2",children:[(0,Pe.jsx)("span",{className:"text-blue-600 font-bold",children:"\u2022"}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)("strong",{children:"Units supported:"})," kg, g, ml, l, pcs, piece, pieces, peace, packet, box, bottle"]})]}),(0,Pe.jsxs)("li",{className:"flex items-start gap-2",children:[(0,Pe.jsx)("span",{className:"text-blue-600 font-bold",children:"\u2022"}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)("strong",{children:"For pieces:"}),' Say "Product 5 piece" or "Product 3 pcs"']})]})]})]}),(0,Pe.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,Pe.jsx)("h3",{className:"font-semibold text-gray-800 mb-2",children:"\ud83d\udca1 Tips:"}),(0,Pe.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[(0,Pe.jsx)("li",{children:"\u2022 Speak clearly and at a normal pace"}),(0,Pe.jsx)("li",{children:"\u2022 The system will automatically merge quantities for the same product"}),(0,Pe.jsx)("li",{children:"\u2022 Click the mic button again to stop listening"})]})]})]})}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2 p-6 pt-4 border-t border-gray-200 flex-shrink-0",children:[(0,Pe.jsx)("input",{type:"checkbox",id:"dontShowAgain",checked:De,onChange:e=>Re(e.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"}),(0,Pe.jsx)("label",{htmlFor:"dontShowAgain",className:"text-sm text-gray-700 cursor-pointer",children:"Don't show this again"})]}),(0,Pe.jsx)("div",{className:"flex justify-end gap-3 p-6 pt-0 flex-shrink-0",children:(0,Pe.jsx)("button",{onClick:()=>{return e=De,ke(!1),e&&localStorage.setItem("voiceInstructionsDismissed","true"),void Rt();var e},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"OK"})})]})}),Fe&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center",children:(0,Pe.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-3 sm:p-6",children:[(0,Pe.jsx)("button",{onClick:()=>{Ot(),Ue(!1),Le.current="",qe("")},className:"absolute top-3 right-3 sm:top-4 sm:right-4 p-2.5 sm:p-3 rounded-full bg-white/10 hover:bg-white/20 active:bg-white/25 transition-colors touch-manipulation",style:{color:"white"},"aria-label":"Close voice input modal",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),(0,Pe.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1 max-w-2xl w-full px-2",children:[(0,Pe.jsxs)("div",{className:"relative mb-4 sm:mb-8 ".concat(Ne?"animate-pulse":""),children:[(0,Pe.jsx)("div",{className:"w-24 h-24 sm:w-32 sm:h-32 rounded-full flex items-center justify-center shadow-2xl",style:{background:Ne?"linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))":"linear-gradient(135deg, rgba(47, 60, 126, 0.2), rgba(47, 60, 126, 0.1))",border:"3px solid ".concat(Ne?"rgba(239, 68, 68, 0.5)":"rgba(47, 60, 126, 0.5)")},children:Ne?(0,Pe.jsx)(Gc,{className:"h-12 w-12 sm:h-16 sm:w-16",style:{color:"#ef4444"}}):(0,Pe.jsx)(Vc,{className:"h-12 w-12 sm:h-16 sm:w-16",style:{color:"var(--brand-primary)"}})}),Ne&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"absolute inset-0 rounded-full animate-ping",style:{background:"rgba(239, 68, 68, 0.3)",animation:"ping 2s cubic-bezier(0, 0, 0.2, 1) infinite"}}),(0,Pe.jsx)("div",{className:"absolute inset-0 rounded-full animate-ping",style:{background:"rgba(239, 68, 68, 0.2)",animation:"ping 2s cubic-bezier(0, 0, 0.2, 1) infinite",animationDelay:"0.5s"}})]})]}),(0,Pe.jsx)("p",{className:"text-white text-lg sm:text-xl font-semibold mb-2 px-2",children:Ne?"Listening...":"Starting..."}),(0,Pe.jsx)("p",{className:"text-white/70 text-xs sm:text-sm mb-6 sm:mb-8 px-2",children:'Say product names with quantities (e.g., "sugar 5 kg rice 2 kg")'}),(0,Pe.jsx)("div",{className:"w-full max-w-2xl bg-white/10 backdrop-blur-md rounded-2xl p-3 sm:p-6 mb-6 sm:mb-8 min-h-[200px] max-h-[300px] sm:max-h-[400px] overflow-y-auto",children:ze?(0,Pe.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[Dt(ze).filter(e=>!He.has(e.id)).map((e,t)=>(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 text-white text-base sm:text-lg py-3 sm:py-2 px-3 sm:px-4 rounded-xl sm:rounded-lg bg-white/5 hover:bg-white/10 transition-colors ".concat(e.matched?"":"opacity-60"),children:[(0,Pe.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3 flex-1 min-w-0",children:[(0,Pe.jsxs)("span",{className:"text-white/60 font-mono text-xs sm:text-sm w-5 sm:w-6 flex-shrink-0",children:[t+1,"."]}),(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsx)("span",{className:"font-medium capitalize block break-words",children:e.product}),e.spokenName&&e.spokenName.toLowerCase()!==e.product.toLowerCase()&&(0,Pe.jsxs)("span",{className:"text-white/50 text-xs sm:text-sm font-normal block mt-0.5",children:["(said: ",e.spokenName,")"]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-3 flex-shrink-0",children:[(0,Pe.jsxs)("span",{className:"text-white/90 sm:text-white/80 font-semibold text-sm sm:text-base whitespace-nowrap",children:[e.isAmountBased&&e.amount?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("span",{className:"text-white font-bold",children:["\u20b9",e.amount]}),e.quantity>0&&e.matched&&(0,Pe.jsxs)("span",{className:"text-white/60 text-xs sm:text-sm ml-1 sm:ml-2",children:["(",e.quantity.toFixed(2)," ",e.unit,")"]})]}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("span",{className:"font-bold",children:e.quantity}),(0,Pe.jsx)("span",{className:"text-white/70 ml-1",children:e.unit})]}),!e.matched&&(0,Pe.jsx)("span",{className:"text-yellow-400 text-xs sm:text-sm ml-1 sm:ml-2 block sm:inline",children:"\u26a0 Not found"})]}),(0,Pe.jsx)("button",{onClick:()=>{Ve(t=>new Set([...t,e.id]))},className:"p-2 sm:p-1.5 rounded-lg hover:bg-red-500/20 active:bg-red-500/30 transition-colors flex-shrink-0 touch-manipulation",title:"Remove this item","aria-label":"Remove this item",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 sm:h-4 sm:w-4 text-red-400 hover:text-red-300"})})]})]},e.id)),0===Dt(ze).length&&(0,Pe.jsx)("p",{className:"text-white text-sm sm:text-lg leading-relaxed whitespace-pre-wrap px-2",children:ze})]}):(0,Pe.jsx)("p",{className:"text-white/50 text-center italic text-sm sm:text-base px-2",children:"Your voice input will appear here..."})}),(0,Pe.jsxs)("div",{className:"flex gap-3 sm:gap-4 w-full max-w-md px-2 sm:px-0",children:[(0,Pe.jsx)("button",{onClick:()=>{Ot(),Ue(!1),Le.current="",qe("")},className:"flex-1 px-4 sm:px-6 py-3 sm:py-4 rounded-xl bg-white/10 hover:bg-white/20 active:bg-white/25 text-white font-semibold text-sm sm:text-base transition-colors border border-white/20 touch-manipulation",children:"Cancel"}),(0,Pe.jsxs)("button",{onClick:()=>{const e=Le.current.trim()||ze.trim();if(!e)return void lt("No products detected. Please speak product names.","warning");const t=Dt(e).filter(e=>!He.has(e.id)&&e.matched);0!==t.length?(t.forEach(e=>{const t=Tt(e.product);if(t&&e.matched&&e.quantity>0){const n=e.quantity,r=e.unit,s=e.isAmountBased&&e.amount?e.amount:null;S.findIndex(e=>e.id===t.id)>=0?_t(t,n,r,s):Ct(t,n,r,s)}}),lt("".concat(t.length," product(s) added to cart!"),"success"),Ot(),Ue(!1),Le.current="",qe(""),Ve(new Set)):lt("No valid products to add. Please check your input.","warning")},className:"flex-1 px-4 sm:px-6 py-3 sm:py-4 rounded-xl font-semibold text-white text-sm sm:text-base transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-2 touch-manipulation",style:{background:"linear-gradient(135deg, var(--brand-primary), #18224f)",boxShadow:"0 4px 14px 0 rgba(47, 60, 126, 0.4)"},children:[(0,Pe.jsx)(Yc,{className:"h-4 w-4 sm:h-5 sm:w-5"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Confirm & Add"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Confirm"})]})]})]})]})})]})},Bu=Ee("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Uu=["mfgDate","expiryDate"],zu=e=>{let{onClose:n,onSave:r,scannedBarcode:s="",planLimitError:o="",onClearPlanLimitError:l}=e;const{state:c,dispatch:d}=(0,i.nm)(),u=e=>e?"string"===typeof e?e.trim():"number"===typeof e?String(e):"object"===typeof e?e.barcode&&"string"===typeof e.barcode?e.barcode.trim():e.code&&"string"===typeof e.code?e.code.trim():"":"":"",h=u(s),[m,f]=(0,t.useState)({name:"",description:"",category:"",quantity:"",barcode:h,expiryDate:"",mfgDate:"",costPrice:"",sellingPrice:"",quantityUnit:"pcs"}),[p,g]=(0,t.useState)(!1),[x,y]=(0,t.useState)(""),[b,w]=(0,t.useState)(!1),[v,N]=(0,t.useState)(!1),[S,A]=(0,t.useState)(""),[_,C]=(0,t.useState)("");(0,t.useEffect)(()=>{const e=u(s);f(t=>(0,a.A)((0,a.A)({},t),{},{barcode:e}))},[s]);const I=(0,Se.$u)(),E=c.categories.filter(e=>!e.sellerId||I&&e.sellerId===I).map(e=>(e.name||"").toLowerCase()).filter(Boolean).sort(),T=()=>{if(!x.trim())return void(window.showToast?window.showToast("Please enter a category name","error"):alert("Please enter a category name"));const e=x.trim().toLowerCase();if(E.includes(e))return void(window.showToast?window.showToast("Category already exists","warning"):alert("Category already exists"));const t={id:"cat-".concat(Date.now()),name:e,createdAt:(new Date).toISOString()};d({type:i.ActionTypes.ADD_CATEGORY,payload:t}),f(t=>(0,a.A)((0,a.A)({},t),{},{category:e})),y(""),g(!1),window.showToast&&window.showToast('Category "'.concat(e,'" created and selected'),"success")},j=e=>{const{name:t}=e.target;let{value:n}=e.target;if("quantity"===t){const e=n.replace(/,/g,".");if(!(["kg","gm","liters","ml"].includes((m.quantityUnit||"").toLowerCase())?/^[0-9]*\.?[0-9]*$/:/^[0-9]*$/).test(e))return;n=e}if("costPrice"===t||"sellingPrice"===t){if(""!==n&&!/^[0-9]*\.?[0-9]{0,2}$/.test(n))return}f(e=>{const r=(0,a.A)((0,a.A)({},e),{},{[t]:n});return"quantity"!==t||""!==n&&null!==n||(r.quantity=""),r}),o&&l&&l(),_&&C(""),"barcode"===t&&n.trim()?(D(n),k(n)):"barcode"!==t||n.trim()||A("")},k=e=>{if(!e||!e.trim())return void A("");const t=e.trim(),n=c.products.find(e=>e.barcode&&e.barcode.trim()===t&&!e.isDeleted);A(n?'Barcode already exists for product "'.concat(n.name,'"'):"")},D=e=>{if(!e.trim())return;const t=c.products.find(t=>t.barcode===e);if(t){const e=e=>{if(!e)return"";try{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(s)}catch(t){return""}};f(n=>(0,a.A)((0,a.A)({},n),{},{name:t.name,description:t.description||"",category:t.category||"",costPrice:t.costPrice||"",sellingPrice:t.sellingPrice||"",quantityUnit:t.quantityUnit||t.unit||"pcs",mfgDate:e(t.mfgDate||t.mfg||""),expiryDate:e(t.expiryDate||t.expiry||"")})),N(Boolean(t.expiryDate||t.expiry||t.mfgDate||t.mfg)),window.showToast&&window.showToast('Product "'.concat(t.name,'" found! Details auto-filled.'),"success")}};return(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[95vh] overflow-y-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-1.5 sm:p-2 bg-blue-100 rounded-lg mr-2 sm:mr-3",children:(0,Pe.jsx)(Me,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"})}),(0,Pe.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Add New Product"})]}),(0,Pe.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close modal",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 text-gray-500"})})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=c.products.filter(e=>!e.isDeleted).length,{maxProducts:n}=(0,Je.ay)(c.currentPlan,c.currentPlanDetails);if(!(0,Je.Nx)(t,c.currentPlan,c.currentPlanDetails)){var s;const e=n===1/0?"Unlimited":n,t=(null===(s=c.currentPlanDetails)||void 0===s?void 0:s.planName)||(c.currentPlan?"".concat(c.currentPlan.charAt(0).toUpperCase()).concat(c.currentPlan.slice(1)):"Current"),r="Your limit is full! You've reached the product limit (".concat(e,") for the ").concat(t," plan. Upgrade your plan to add more products.");return C(r),void(window.showToast&&window.showToast(r,"error",5e3))}C("");const i=[];m.name&&m.name.trim()||i.push("Product name is required"),m.quantityUnit&&m.quantityUnit.trim()||i.push("Quantity unit is required");const o=m.quantity?Number(m.quantity):0;(!Number.isFinite(o)||o<0)&&i.push("Quantity must be a valid number and 0 or greater");["pcs","pieces","piece","packet","packets","box","boxes"].includes((m.quantityUnit||"").toLowerCase())&&!Number.isInteger(o)&&i.push("Quantity must be a whole number for pieces, packets, and boxes");const l=o,d=parseFloat(m.costPrice)||0,u=parseFloat(m.sellingPrice)||0;if(d<0&&i.push("Cost price must be 0 or greater"),u<0&&i.push("Selling price must be 0 or greater"),v&&(m.mfgDate||i.push("Manufacturing date (MFG Date) is required"),m.expiryDate||i.push("Expiry date is required")),m.description&&m.description.trim()||i.push("Product description is required"),m.barcode&&m.barcode.trim()){const e=m.barcode.trim(),t=c.products.find(t=>t.barcode&&t.barcode.trim()===e&&!t.isDeleted);t&&i.push('Barcode "'.concat(e,'" already exists for product "').concat(t.name,'". Each product must have a unique barcode.'))}if(v&&m.mfgDate&&m.expiryDate){const e=new Date(m.mfgDate);new Date(m.expiryDate)<e&&i.push("Expiry date must be after manufacturing date")}if(i.length>0){const e=i.join("\n");return void(window.showToast?window.showToast(e,"error"):alert(e))}const{mfgDate:h,expiryDate:f}=m,p=(0,_e.A)(m,Uu),g=(0,a.A)((0,a.A)({},p),{},{quantity:l,costPrice:d,unitPrice:d,sellingPrice:u,sellingUnitPrice:u,quantityUnit:m.quantityUnit||"pcs",unit:m.quantityUnit||"pcs"});v&&m.mfgDate&&m.mfgDate.trim()&&m.expiryDate&&m.expiryDate.trim()&&(g.mfg=m.mfgDate.trim(),g.mfgDate=m.mfgDate.trim(),g.expiryDate=m.expiryDate.trim()),delete g.stock,r(g),window.showToast&&window.showToast('Product "'.concat(m.name,'" added successfully.'),"success")},className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[(()=>{const e=c.products.filter(e=>!e.isDeleted).length,{maxProducts:t}=(0,Je.ay)(c.currentPlan,c.currentPlanDetails),n=t===1/0?"Unlimited":t,r=(0,Je.Nx)(e,c.currentPlan,c.currentPlanDetails);t===1/0||Math.max(0,t-e);return(0,Pe.jsxs)("div",{className:"rounded-lg border p-3 ".concat(r?"border-blue-200 bg-blue-50":"border-red-200 bg-red-50"),children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,Pe.jsx)("span",{className:"font-medium ".concat(r?"text-blue-700":"text-red-700"),children:"Product Limit:"}),(0,Pe.jsxs)("span",{className:"font-semibold ".concat(r?"text-blue-900":"text-red-900"),children:[e," / ",n===1/0?"\u221e":n,!r&&" (Full)"]})]}),t!==1/0&&(0,Pe.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:(0,Pe.jsx)("div",{className:"h-2 rounded-full transition-all ".concat(r?"bg-blue-500":"bg-red-500"),style:{width:"".concat(Math.min(100,e/t*100),"%")}})})]})})(),(o||_)&&(0,Pe.jsx)("div",{className:"rounded-2xl border border-red-200 bg-gradient-to-r from-red-50 via-red-100 to-red-50 p-4 shadow-md",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-3",children:[(0,Pe.jsx)("span",{className:"mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-red-500/10 text-red-600",children:(0,Pe.jsx)(lt,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-semibold text-red-700",children:"Limit Full"}),(0,Pe.jsx)("p",{className:"mt-1 text-xs text-red-700 leading-relaxed",children:_||o})]})]})}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name *"}),(0,Pe.jsx)("input",{type:"text",name:"name",value:m.name,onChange:j,className:"input-field",placeholder:"Enter product name",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,Pe.jsxs)("div",{className:"flex gap-2",children:[(0,Pe.jsxs)("select",{name:"category",value:m.category,onChange:j,className:"input-field flex-1",children:[(0,Pe.jsx)("option",{value:"",children:0===E.length?"No categories yet - Create one":"Select Category"}),E.map(e=>(0,Pe.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," ")},e))]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex items-center space-x-2 whitespace-nowrap",title:"Create New Category",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"New"})]})]})]})]}),(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,Pe.jsx)("textarea",{name:"description",value:m.description,onChange:j,className:"input-field",rows:3,placeholder:"Enter product description",required:!0})]}),(0,Pe.jsxs)("label",{className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-600 select-none",children:[(0,Pe.jsx)("input",{id:"trackExpiry",type:"checkbox",checked:v,onChange:e=>{const t=e.target.checked;N(t),t||f(e=>(0,a.A)((0,a.A)({},e),{},{mfgDate:"",expiryDate:""}))},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Track product expiry"]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",name:"costPrice",value:m.costPrice,onChange:j,className:"input-field",placeholder:"0.00",inputMode:"decimal",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",name:"sellingPrice",value:m.sellingPrice,onChange:j,className:"input-field",placeholder:"0.00",inputMode:"decimal",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity Unit *"}),(0,Pe.jsxs)("select",{name:"quantityUnit",value:m.quantityUnit||"pcs",onChange:j,className:"input-field",required:!0,children:[(0,Pe.jsx)("option",{value:"pcs",children:"Pieces (pcs)"}),(0,Pe.jsx)("option",{value:"kg",children:"Kilograms (kg)"}),(0,Pe.jsx)("option",{value:"gm",children:"Grams (gm)"}),(0,Pe.jsx)("option",{value:"liters",children:"Liters (L)"}),(0,Pe.jsx)("option",{value:"ml",children:"Milliliters (mL)"}),(0,Pe.jsx)("option",{value:"boxes",children:"Boxes"}),(0,Pe.jsx)("option",{value:"packets",children:"Packets"}),(0,Pe.jsx)("option",{value:"bottles",children:"Bottles"})]})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),(0,Pe.jsx)("input",{type:"text",name:"quantity",value:m.quantity,onChange:j,onWheel:e=>e.currentTarget.blur(),className:"input-field",placeholder:"0",inputMode:"decimal",required:!0})]}),v&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturing Date (MFG) *"}),(0,Pe.jsx)("input",{type:"date",name:"mfgDate",value:m.mfgDate,onChange:j,className:"input-field",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date *"}),(0,Pe.jsx)("input",{type:"date",name:"expiryDate",value:m.expiryDate,onChange:j,className:"input-field",required:!0})]})]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Barcode"}),(0,Pe.jsxs)("div",{className:"relative",children:[(0,Pe.jsx)("input",{type:"text",name:"barcode",value:m.barcode,onChange:j,className:"input-field w-full pr-12 ".concat(S?"border-red-500 focus:border-red-500 focus:ring-red-500":""),placeholder:"Enter or scan barcode"}),(0,Pe.jsx)("button",{type:"button",onClick:()=>w(!0),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white border border-primary-500 text-primary-600 rounded-lg hover:bg-primary-50 transition-colors",title:"Scan with camera",children:(0,Pe.jsx)(Wc,{className:"h-4 w-4"})})]}),S&&(0,Pe.jsx)("p",{className:"mt-1 text-sm text-red-600",children:S})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4 sm:pt-6 border-t border-gray-200",children:[(0,Pe.jsx)("button",{type:"button",onClick:n,className:"btn-secondary w-full sm:w-auto order-2 sm:order-1",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"btn-primary w-full sm:w-auto order-1 sm:order-2",children:"Add Product"})]})]}),b&&(0,Pe.jsx)(Lu,{onScan:e=>{if(e&&e.trim()){const t=e.trim();f(e=>(0,a.A)((0,a.A)({},e),{},{barcode:t})),k(t),D(t)}w(!1)},onClose:()=>w(!1)}),p&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg mr-3",children:(0,Pe.jsx)(Bt,{className:"h-5 w-5 text-blue-600"})}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Category"})]}),(0,Pe.jsx)("button",{onClick:()=>{g(!1),y("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close modal",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 text-gray-500"})})]}),(0,Pe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),(0,Pe.jsx)("input",{type:"text",value:x,onChange:e=>y(e.target.value),className:"input-field w-full",placeholder:"Enter category name (e.g., Electronics, Frozen Foods)",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),T())},autoFocus:!0}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Category will be saved and can be used for future products"})]}),(0,Pe.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,Pe.jsx)("button",{type:"button",onClick:()=>{g(!1),y("")},className:"btn-secondary",children:"Cancel"}),(0,Pe.jsx)("button",{type:"button",onClick:T,className:"btn-primary",children:"Create & Select"})]})]})]})})]})})},qu=e=>{var n,r,s,o;let{product:l,onClose:c,onSave:d}=e;const u=e=>{if(!e)return"";try{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(s)}catch(t){return""}},{state:h,dispatch:m}=(0,i.nm)(),[f,p]=(0,t.useState)(!1),[g,x]=(0,t.useState)(""),[y,b]=(0,t.useState)({id:l.id,name:l.name||"",description:l.description||"",category:l.category||"",quantity:(null!==(n=null!==(r=l.quantity)&&void 0!==r?r:l.stock)&&void 0!==n?n:"").toString(),barcode:l.barcode||"",expiryDate:u(l.expiryDate||l.expiry||""),mfgDate:u(l.mfgDate||l.mfg||""),costPrice:(null!==(s=l.costPrice)&&void 0!==s?s:"").toString(),sellingPrice:(null!==(o=l.sellingPrice)&&void 0!==o?o:"").toString(),quantityUnit:l.quantityUnit||l.unit||"pcs"}),[w,v]=(0,t.useState)(Boolean(l.expiryDate||l.expiry||l.mfgDate||l.mfg)),[N,S]=(0,t.useState)(!1),[A,_]=(0,t.useState)(""),C=(0,t.useRef)(""),I=(0,t.useRef)(null),E=(0,t.useRef)(0),T=(0,t.useRef)(null),j=()=>{const e=(g||"").trim().toLowerCase();if(!e)return void(window.showToast&&window.showToast("Please enter a category name","error"));const t=(0,Se.$u)();if(h.categories.filter(e=>!e.sellerId||t&&e.sellerId===t).some(t=>(t.name||"").toLowerCase()===e))return void(window.showToast&&window.showToast("Category already exists","warning"));const n={id:"cat-".concat(Date.now()),name:e,createdAt:(new Date).toISOString()};m({type:i.ActionTypes.ADD_CATEGORY,payload:n}),b(t=>(0,a.A)((0,a.A)({},t),{},{category:e})),x(""),p(!1),window.showToast&&window.showToast('Category "'.concat(e,'" created and selected'),"success")},k=e=>{const{name:t}=e.target;let{value:n}=e.target;if("quantity"===t){const e=n.replace(/,/g,".");if(!(["kg","gm","liters","ml"].includes((y.quantityUnit||"").toLowerCase())?/^[0-9]*\.?[0-9]*$/:/^[0-9]*$/).test(e))return;n=e}if("costPrice"===t||"sellingPrice"===t){if(""!==n&&!/^[0-9]*\.?[0-9]{0,2}$/.test(n))return}b(e=>{const r=(0,a.A)((0,a.A)({},e),{},{[t]:n});return"quantity"!==t||""!==n&&null!==n||(r.quantity=""),r}),"barcode"===t&&n.trim()?D(n):"barcode"!==t||n.trim()||_("")},D=e=>{if(!e||!e.trim())return void _("");const t=e.trim(),n=String(l.id||""),r=String(l._id||""),s=h.products.find(e=>{if(!e.barcode||e.isDeleted)return!1;if(e.barcode.trim()!==t)return!1;const s=String(e.id||""),i=String(e._id||"");return(!n||!s||n!==s)&&((!r||!i||r!==i)&&!(!n&&!s&&l.name===e.name))});_(s?'Barcode already exists for product "'.concat(s.name,'"'):"")},P=e=>{if(console.log("Barcode scanned on Edit Product modal:",e),e&&e.trim().length>0){const t=e.trim();b(e=>(0,a.A)((0,a.A)({},e),{},{barcode:t})),D(t),T.current&&T.current.focus()}};return(0,t.useEffect)(()=>{const e=e=>{const t=e.target,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName,r=t===T.current;if(!n||r)if(1!==e.key.length||e.ctrlKey||e.metaKey||e.altKey){if("Enter"===e.key&&C.current.length>0){e.preventDefault();const t=C.current.trim();t.length>0&&(T.current&&T.current.focus(),P(t),C.current="")}}else{const t=Date.now();t-E.current<100||0===C.current.length?(C.current+=e.key,E.current=t,I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{const e=C.current.trim();e.length>0&&(T.current&&T.current.focus(),P(e),C.current="")},300)):C.current=""}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),I.current&&clearTimeout(I.current)}},[]),(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[95vh] overflow-y-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-1.5 sm:p-2 bg-blue-100 rounded-lg mr-2 sm:mr-3",children:(0,Pe.jsx)(Me,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"})}),(0,Pe.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Edit Product"})]}),(0,Pe.jsx)("button",{onClick:c,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close modal",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 text-gray-500"})})]}),(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=[];y.name&&y.name.trim()||t.push("Product name is required"),y.quantityUnit&&y.quantityUnit.trim()||t.push("Quantity unit is required");const n=y.quantity?Number(y.quantity):0;(!Number.isFinite(n)||n<0)&&t.push("Quantity must be a valid number and 0 or greater");["pcs","pieces","piece","packet","packets","box","boxes"].includes((y.quantityUnit||"").toLowerCase())&&!Number.isInteger(n)&&t.push("Quantity must be a whole number for pieces, packets, and boxes");const r=n,s=parseFloat(y.costPrice)||0,i=parseFloat(y.sellingPrice)||0;if(s<0&&t.push("Cost price must be 0 or greater"),i<0&&t.push("Selling price must be 0 or greater"),w&&(y.mfgDate||t.push("Manufacturing date (MFG Date) is required"),y.expiryDate||t.push("Expiry date is required")),y.description&&y.description.trim()||t.push("Product description is required"),y.barcode&&y.barcode.trim()){const e=y.barcode.trim(),n=String(l.id||""),r=String(l._id||""),s=h.products.find(t=>{if(!t.barcode||t.isDeleted)return!1;if(t.barcode.trim()!==e)return!1;const s=String(t.id||""),i=String(t._id||"");return(!n||!s||n!==s)&&((!r||!i||r!==i)&&!(!n&&!s&&l.name===t.name))});s&&t.push('Barcode "'.concat(e,'" already exists for product "').concat(s.name,'". Each product must have a unique barcode.'))}if(w&&y.mfgDate&&y.expiryDate){const e=new Date(y.mfgDate);new Date(y.expiryDate)<e&&t.push("Expiry date must be after manufacturing date")}if(t.length>0){const e=t.join("\n");return void(window.showToast?window.showToast(e,"error"):alert(e))}const o=(0,a.A)((0,a.A)({},l),{},{name:y.name.trim(),description:y.description.trim(),category:y.category||"",quantity:r,barcode:y.barcode||"",costPrice:s,unitPrice:s,sellingPrice:i,sellingUnitPrice:i,quantityUnit:y.quantityUnit||"pcs",unit:y.quantityUnit||"pcs",updatedAt:(new Date).toISOString()});w&&y.mfgDate&&y.mfgDate.trim()&&y.expiryDate&&y.expiryDate.trim()?(o.mfg=y.mfgDate.trim(),o.mfgDate=y.mfgDate.trim(),o.expiryDate=y.expiryDate.trim()):(delete o.mfg,delete o.mfgDate,delete o.expiryDate,delete o.expiry),delete o.stock,o.id=l.id,l._id&&(o._id=l._id),l.sellerId&&(o.sellerId=l.sellerId),l.createdAt&&(o.createdAt=l.createdAt),console.log("\ud83d\udce4 [EditProductModal] Sending product update:",{id:o.id,idType:typeof o.id,_id:o._id,name:o.name,originalId:l.id,originalIdType:typeof l.id}),d(o),window.showToast&&window.showToast('Product "'.concat(y.name,'" updated successfully.'),"success")},className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name *"}),(0,Pe.jsx)("input",{type:"text",name:"name",value:y.name,onChange:k,className:"input-field",placeholder:"Enter product name",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,Pe.jsxs)("div",{className:"flex gap-2",children:[(0,Pe.jsxs)("select",{name:"category",value:y.category,onChange:k,className:"input-field flex-1",children:[(0,Pe.jsx)("option",{value:"",children:"Select Category"}),h.categories.filter(e=>{const t=(0,Se.$u)();return!e.sellerId||t&&e.sellerId===t}).map(e=>(e.name||"").toLowerCase()).filter(Boolean).sort().map(e=>(0,Pe.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," ")},e))]}),(0,Pe.jsx)("button",{type:"button",onClick:()=>p(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex items-center space-x-2 whitespace-nowrap",title:"Create New Category",children:"New"})]})]})]}),(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,Pe.jsx)("textarea",{name:"description",value:y.description,onChange:k,className:"input-field",rows:3,placeholder:"Enter product description",required:!0})]}),(0,Pe.jsxs)("label",{className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-600 select-none",children:[(0,Pe.jsx)("input",{id:"trackExpiry",type:"checkbox",checked:w,onChange:e=>{const t=e.target.checked;v(t),t||b(e=>(0,a.A)((0,a.A)({},e),{},{mfgDate:"",expiryDate:""}))},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Track product expiry"]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",name:"costPrice",value:y.costPrice,onChange:k,className:"input-field",placeholder:"0.00",inputMode:"decimal",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price (\u20b9) *"}),(0,Pe.jsx)("input",{type:"text",name:"sellingPrice",value:y.sellingPrice,onChange:k,className:"input-field",placeholder:"0.00",inputMode:"decimal",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity Unit *"}),(0,Pe.jsxs)("select",{name:"quantityUnit",value:y.quantityUnit||"pcs",onChange:k,className:"input-field",required:!0,children:[(0,Pe.jsx)("option",{value:"pcs",children:"Pieces (pcs)"}),(0,Pe.jsx)("option",{value:"kg",children:"Kilograms (kg)"}),(0,Pe.jsx)("option",{value:"gm",children:"Grams (gm)"}),(0,Pe.jsx)("option",{value:"liters",children:"Liters (L)"}),(0,Pe.jsx)("option",{value:"ml",children:"Milliliters (mL)"}),(0,Pe.jsx)("option",{value:"boxes",children:"Boxes"}),(0,Pe.jsx)("option",{value:"packets",children:"Packets"}),(0,Pe.jsx)("option",{value:"bottles",children:"Bottles"})]})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),(0,Pe.jsx)("input",{type:"text",name:"quantity",value:y.quantity,onChange:k,onWheel:e=>e.currentTarget.blur(),className:"input-field",placeholder:"0",inputMode:"decimal",required:!0})]}),w&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturing Date (MFG) *"}),(0,Pe.jsx)("input",{type:"date",name:"mfgDate",value:y.mfgDate,onChange:k,className:"input-field",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date *"}),(0,Pe.jsx)("input",{type:"date",name:"expiryDate",value:y.expiryDate,onChange:k,className:"input-field",required:!0})]})]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Barcode"}),(0,Pe.jsxs)("div",{className:"relative",children:[(0,Pe.jsx)("input",{ref:T,type:"text",name:"barcode",value:y.barcode,onChange:k,className:"input-field w-full pr-12 ".concat(A?"border-red-500 focus:border-red-500 focus:ring-red-500":""),placeholder:"Enter barcode or scan"}),(0,Pe.jsx)("button",{type:"button",onClick:()=>S(!0),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white border border-primary-500 text-primary-600 rounded-lg hover:bg-primary-50 transition-colors",title:"Scan with camera",children:(0,Pe.jsx)(Wc,{className:"h-4 w-4"})})]}),A&&(0,Pe.jsx)("p",{className:"mt-1 text-sm text-red-600",children:A})]}),N&&(0,Pe.jsx)(Lu,{onScan:e=>{if(e&&e.trim()){const t=e.trim();b(e=>(0,a.A)((0,a.A)({},e),{},{barcode:t})),D(t),T.current&&T.current.focus()}S(!1)},onClose:()=>S(!1)}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4 sm:pt-6 border-t border-gray-200",children:[(0,Pe.jsx)("button",{type:"button",onClick:c,className:"btn-secondary w-full sm:w-auto order-2 sm:order-1",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"btn-primary w-full sm:w-auto order-1 sm:order-2",children:"Update Product"})]})]}),f&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg mr-3"}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Category"})]}),(0,Pe.jsx)("button",{onClick:()=>{p(!1),x("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close modal",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 text-gray-500"})})]}),(0,Pe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),(0,Pe.jsx)("input",{type:"text",value:g,onChange:e=>x(e.target.value),className:"input-field w-full",placeholder:"Enter category name",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),j())},autoFocus:!0})]}),(0,Pe.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,Pe.jsx)("button",{type:"button",onClick:()=>{p(!1),x("")},className:"btn-secondary",children:"Cancel"}),(0,Pe.jsx)("button",{type:"button",onClick:j,className:"btn-primary",children:"Create & Select"})]})]})]})})]})})},Hu=["mfg","mfgDate","expiryDate"],Vu=()=>{var e;const{state:n,dispatch:r}=(0,i.nm)(),s=ee(),[o,l]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(!1),[m,f]=(0,t.useState)(!1),[p,g]=(0,t.useState)(null),[x,y]=(0,t.useState)(1),[b,w]=(0,t.useState)(""),[v,N]=(0,t.useState)(null),[S,A]=(0,t.useState)(!1),[_,C]=(0,t.useState)(!1),[I,E]=(0,t.useState)(null),[T,j]=(0,t.useState)({total:0,processed:0,success:0,errors:[]}),[k,D]=(0,t.useState)(!1),[P,R]=(0,t.useState)([]),[O,L]=(0,t.useState)(null),M=(0,t.useRef)(null),F=(0,t.useRef)(null),B=(0,t.useRef)(""),U=(0,t.useRef)(null),z=(0,t.useRef)(0),[q,H]=(0,t.useState)(""),[V,W]=(0,t.useState)(10);(0,t.useEffect)(()=>{const e=()=>{window.innerWidth>=1025?W(25):W(10)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,t.useEffect)(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&A(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.useEffect)(()=>{n.currentProduct&&(g(n.currentProduct),f(!0),r({type:"SET_CURRENT_PRODUCT",payload:null}))},[n.currentProduct,r]);const G=n.products.filter(e=>!e.isDeleted),{maxProducts:Y}=(0,Je.ay)(n.currentPlan,n.currentPlanDetails),X=G.length,Q=!(0,Je.Nx)(X,n.currentPlan,n.currentPlanDetails),K=Y===1/0?"Unlimited":Y,Z=(null===(e=n.currentPlanDetails)||void 0===e?void 0:e.planName)||(n.currentPlan?"".concat(n.currentPlan.charAt(0).toUpperCase()).concat(n.currentPlan.slice(1)):"Current"),J=()=>{const e="You've reached the product limit (".concat(K,") for the ").concat(Z," plan. Upgrade to keep adding products.");w(e),window.showToast&&window.showToast(e,"warning",5e3)},$=(0,Se.$u)(),te=Array.from(new Set(n.categories.filter(e=>!e.sellerId||$&&e.sellerId===$).map(e=>(e.name||"").trim().toLowerCase()).filter(Boolean))).sort(),ne=G.filter(e=>{var t,n;const r=e.name.toLowerCase().includes(o.toLowerCase())||(null===(t=e.category)||void 0===t?void 0:t.toLowerCase().includes(o.toLowerCase()))||(null===(n=e.barcode)||void 0===n?void 0:n.includes(o)),s=!c||(e.category||"").toLowerCase()===c;return r&&s}),re=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Q?J():(w(""),H(e),h(!0))},se=e=>{if(console.log("Barcode scanned on Products page:",e),e&&e.trim().length>0){const t=e.trim(),r=n.products.find(e=>e.barcode&&e.barcode.trim()===t&&!e.isDeleted);if(r){const e="hi"===n.currentLanguage?'\u092c\u093e\u0930\u0915\u094b\u0921 "'.concat(t,'" \u092a\u0939\u0932\u0947 \u0938\u0947 \u092e\u094c\u091c\u0942\u0926 \u0939\u0948\u0964 \u0909\u0924\u094d\u092a\u093e\u0926: "').concat(r.name,'"'):'Barcode "'.concat(t,'" already exists for product "').concat(r.name,'".');return void(window.showToast?window.showToast(e,"error"):alert(e))}re(t)}};(0,t.useEffect)(()=>{const e=e=>{if(m)return;const t=e.target;if(!("INPUT"===t.tagName||"TEXTAREA"===t.tagName))if(1!==e.key.length||e.ctrlKey||e.metaKey||e.altKey){if("Enter"===e.key&&B.current.length>0){e.preventDefault();const t=B.current.trim();t.length>0&&(se(t),B.current="")}}else{const t=Date.now();t-z.current<100||0===B.current.length?(B.current+=e.key,z.current=t,U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{const e=B.current.trim();e.length>0&&(se(e),B.current="")},300)):B.current=""}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),U.current&&clearTimeout(U.current)}},[Q,m]);const ie=Math.ceil(ne.length/V),ae=(x-1)*V,oe=ne.slice(ae,ae+V);(0,t.useEffect)(()=>{y(1)},[o,c,V]);const le=()=>{const e=[];if(ie<=5)for(let t=1;t<=ie;t++)e.push(t);else if(x<=3){for(let t=1;t<=4;t++)e.push(t);e.push("ellipsis"),e.push(ie)}else if(x>=ie-2){e.push(1),e.push("ellipsis");for(let t=ie-3;t<=ie;t++)e.push(t)}else{e.push(1),e.push("ellipsis");for(let t=x-1;t<=x+1;t++)e.push(t);e.push("ellipsis"),e.push(ie)}return e},ce=n.products.filter(e=>(e.quantity||e.stock||0)<=n.lowStockThreshold).length,de=n.products.filter(e=>{if(!e.expiryDate)return!1;const t=new Date(e.expiryDate)-new Date,r=Math.ceil(t/864e5);return r<=n.expiryDaysThreshold&&r>=0}).length,ue=e=>{const t=n.products.find(t=>t.id===e);t&&N(t)},he=e=>{g(e),f(!0)},me=(e,t,n)=>{const r=new Blob([t],{type:n}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=e,i.click(),window.URL.revokeObjectURL(s)},fe=e=>{if(null===e||void 0===e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t},pe=e=>{const t=e.split("\n").filter(e=>e.trim());if(t.length<2)throw new Error("CSV file must have at least a header row and one data row");const n=t[0].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),r=[];for(let s=1;s<t.length;s++){const e=t[s],i=[];let a="",o=!1;for(let t=0;t<e.length;t++){const n=e[t];'"'===n?o&&'"'===e[t+1]?(a+='"',t++):o=!o:","!==n||o?a+=n:(i.push(a.trim()),a="")}if(i.push(a.trim()),i.length>0&&i.some(e=>e)){const e={};n.forEach((t,n)=>{const r=i[n]||"",s=t.toLowerCase();s.includes("name")?e.name=r:s.includes("category")?e.category=r:s.includes("unit")?e.unit=r||"pcs":s.includes("stock")||s.includes("quantity")?e.stock=parseFloat(r)||0:s.includes("cost")?e.costPrice=parseFloat(r)||0:s.includes("selling")||s.includes("price")?e.sellingPrice=parseFloat(r)||0:s.includes("barcode")?e.barcode=r:s.includes("expiry")?e.expiryDate=r:s.includes("description")&&(e.description=r)}),r.push(e)}}return r},ge=e=>{try{const t=JSON.parse(e);if(!Array.isArray(t))throw new Error("JSON file must contain an array of products");return t.map(e=>({name:e.name||e.Name||"",category:e.category||e.Category||"",unit:e.unit||e.Unit||e.quantityUnit||"pcs",stock:parseFloat(e.stock||e.Stock||e.quantity||e.Quantity||0)||0,costPrice:parseFloat(e.costPrice||e.CostPrice||e.cost||e.Cost||0)||0,sellingPrice:parseFloat(e.sellingPrice||e.SellingPrice||e.price||e.Price||e.sellingUnitPrice||0)||0,barcode:e.barcode||e.Barcode||"",expiryDate:e.expiryDate||e.ExpiryDate||e.expiry||"",description:e.description||e.Description||""}))}catch(t){throw new Error("Invalid JSON format: ".concat(t.message))}},xe=(e,t)=>{const n=[];return e.name&&e.name.trim()||n.push("Row ".concat(t+1,": Product name is required")),e.unit||(e.unit="pcs"),(void 0===e.stock||null===e.stock||isNaN(e.stock))&&(e.stock=0),(void 0===e.costPrice||null===e.costPrice||isNaN(e.costPrice))&&(e.costPrice=0),(void 0===e.sellingPrice||null===e.sellingPrice||isNaN(e.sellingPrice))&&(e.sellingPrice=0),{product:e,errors:n}},ye=()=>{C(!1),E(null),j({total:0,processed:0,success:0,errors:[]}),D(!1),L(null),R([]),F.current&&(F.current.value="")};return(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6 pb-6",children:[(0,Pe.jsxs)("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Products"}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600",children:["Manage your product inventory",(0,Pe.jsxs)("span",{className:"ml-2 text-blue-600 font-medium",children:["(Used: ",X," / ",K,")"]})]})]}),(0,Pe.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,Pe.jsxs)("button",{onClick:()=>{"offline"!==n.systemStatus&&navigator.onLine?C(!0):window.showToast&&window.showToast("Import is not available offline. Please connect to the internet to import products.","warning")},disabled:"offline"===n.systemStatus||!navigator.onLine,className:"btn-secondary flex items-center text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-gray-50",title:"offline"!==n.systemStatus&&navigator.onLine?"Import products from file":"Import is not available offline",children:[(0,Pe.jsx)(Bu,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Import"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Import"})]}),(0,Pe.jsxs)("div",{className:"relative",ref:M,children:[(0,Pe.jsxs)("button",{onClick:()=>A(!S),className:"btn-secondary flex items-center text-sm",children:[(0,Pe.jsx)(st,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Export"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Export"})]}),S&&(0,Pe.jsxs)("div",{className:"absolute left-0 sm:left-auto sm:right-0 mt-2 w-48 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-lg border border-gray-200 z-50 py-2",children:[(0,Pe.jsxs)("button",{onClick:()=>{try{var e;const r=new Uo("l","mm","a4"),s=r.internal.pageSize.getWidth(),i=r.internal.pageSize.getHeight();r.setFont("helvetica","normal"),r.setFontSize(18),r.text("Products Report",s/2,15,{align:"center"}),r.setFontSize(11),r.text("".concat((null===(e=n.currentUser)||void 0===e?void 0:e.shopName)||"Store","  |  Generated: ").concat((new Date).toLocaleDateString()),s/2,22,{align:"center"}),r.setDrawColor(230),r.setFillColor(245,247,250),r.rect(10,28,s-20,18,"F"),r.setTextColor(60),r.setFontSize(10);const a=ne.length,o=ne.filter(e=>{const t=e.quantity||e.stock||0;return t>0&&t<=n.lowStockThreshold}).length,l=ne.filter(e=>0===(e.quantity||e.stock||0)).length,c=ne.reduce((e,t)=>e+(t.quantity||t.stock||0)*(t.sellingPrice||t.price||t.costPrice||0),0);r.text("Total Products: ".concat(a),14,40),r.text("Low Stock: ".concat(o),70,40),r.text("Out of Stock: ".concat(l),120,40),r.text("Total Value: \u20b9".concat(c.toFixed(2)),180,40);const d=["#","Name","Category","Unit","Stock","Cost","Price","Barcode","Expiry"],u=[12,70,45,22,22,28,28,45,38],h=2.5,m=12,f=52,p=16,g=4,x=[];let y=m;d.forEach((e,t)=>{x[t]=y,y+=u[t]});const b=y-m,w=e=>(r.setFillColor(234,238,243),r.setDrawColor(210),r.rect(m,e-8,b,8,"F"),r.setTextColor(30),r.setFontSize(9.5),d.forEach((t,n)=>{const s=n>=d.length-3?"right":"left",i="right"===s?x[n]+u[n]-h:x[n]+h;r.text(t,i,e-2,{align:s})}),r.setDrawColor(210),d.forEach((t,n)=>{const s=x[n];r.line(s,e-8,s,i-p)}),r.line(m+b,e-8,m+b,i-p),r.line(m,e,m+b,e),e+2);let v=w(f);ne.forEach((e,t)=>{const n=e.quantity||e.stock||0,s=e.costPrice||0,a=e.sellingPrice||e.price||s,o=e.barcode||"\u2014",l=e.expiryDate?new Date(e.expiryDate).toLocaleDateString():"\u2014",c=[t+1,e.name||"",e.category||"",e.quantityUnit||e.unit||"pcs",n,"\u20b9".concat(s.toFixed(2)),"\u20b9".concat(a.toFixed(2)),o,l].map((e,t)=>{let n="string"===typeof e?e:String(e);const s=u[t]-2*h,i=r.splitTextToSize(n,s);return i.length?i:[""]}),y=Math.max(...c.map(e=>e.length))*g+h;v+y>i-p&&(r.addPage(),v=w(f));const N=t%2===1?{r:247,g:249,b:252}:{r:255,g:255,b:255};r.setFillColor(N.r,N.g,N.b),r.rect(m,v-g+1,b,y,"F"),r.setDrawColor(220),d.forEach((e,t)=>{const n=x[t];r.line(n,v-g+1,n,v-g+1+y)}),r.line(m+b,v-g+1,m+b,v-g+1+y),r.line(m,v-g+1+y,m+b,v-g+1+y),r.setTextColor(40),r.setFontSize(8.5),c.forEach((e,t)=>{const n=t>=d.length-3?"right":"left";e.forEach((e,s)=>{const i=v+s*g,a="right"===n?x[t]+u[t]-h:x[t]+h;r.text(e,a,i,{align:n})})}),v+=y});const N=r.internal.getNumberOfPages();for(let e=1;e<=N;e++){var t;r.setPage(e),r.setFontSize(8),r.setTextColor(120),r.text("Page ".concat(e," of ").concat(N),12,i-8),r.text("".concat((null===(t=n.currentUser)||void 0===t?void 0:t.shopName)||"Store"," \u2022 Products Report"),s-12,i-8,{align:"right"})}r.save("products-report-".concat((new Date).toISOString().split("T")[0],".pdf")),window.showToast&&window.showToast("Products exported as PDF.","success"),A(!1)}catch(r){console.error("Error exporting products PDF:",r),window.showToast&&window.showToast("Error generating PDF. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 active:bg-gray-100 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Lt,{className:"h-4 w-4 text-red-600 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"truncate",children:"Export as PDF"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{const e=ne.map(e=>({id:e.id,name:e.name,category:e.category||"",unit:e.quantityUnit||e.unit||"pcs",stock:e.quantity||e.stock||0,costPrice:e.costPrice||0,sellingPrice:e.sellingPrice||e.price||0,barcode:e.barcode||"",expiryDate:e.expiryDate||"",description:e.description||"",createdAt:e.createdAt||""}));me("products-".concat((new Date).toISOString().split("T")[0],".json"),JSON.stringify(e,null,2),"application/json"),window.showToast&&window.showToast("Products exported as JSON.","success"),A(!1)}catch(e){console.error("Error exporting products JSON:",e),window.showToast&&window.showToast("Error exporting JSON. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 active:bg-gray-100 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4 text-yellow-600 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"truncate",children:"Export as JSON"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{const e=["Name","Category","Unit","Stock","Cost Price","Selling Price","Barcode","Expiry Date","Description"],t=ne.map(e=>[fe(e.name||""),fe(e.category||""),fe(e.quantityUnit||e.unit||"pcs"),fe(e.quantity||e.stock||0),fe(e.costPrice||0),fe(e.sellingPrice||e.price||0),fe(e.barcode||""),fe(e.expiryDate||"")]),n=[e.join(","),...t.map(e=>e.join(","))].join("\n");me("products-".concat((new Date).toISOString().split("T")[0],".csv"),n,"text/csv;charset=utf-8;"),window.showToast&&window.showToast("Products exported as CSV.","success"),A(!1)}catch(e){console.error("Error exporting products CSV:",e),window.showToast&&window.showToast("Error exporting CSV. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 active:bg-gray-100 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"truncate",children:"Export as CSV"})]})]})]}),(0,Pe.jsxs)("button",{onClick:re,className:"btn-primary flex items-center text-sm",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Add Product"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Add"})]})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,Pe.jsx)("div",{className:"card",children:(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-blue-100 rounded-lg",children:(0,Pe.jsx)(Me,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"})}),(0,Pe.jsxs)("div",{className:"ml-3 sm:ml-4",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600",children:"Total Products"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:X})]})]})}),(0,Pe.jsx)("div",{className:"card",children:(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-red-100 rounded-lg",children:(0,Pe.jsx)(lt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-red-600"})}),(0,Pe.jsxs)("div",{className:"ml-3 sm:ml-4",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600",children:"Low Stock"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:ce})]})]})}),(0,Pe.jsx)("div",{className:"card",children:(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-yellow-100 rounded-lg",children:(0,Pe.jsx)(rt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-yellow-600"})}),(0,Pe.jsxs)("div",{className:"ml-3 sm:ml-4",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600",children:"Expiring Soon"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:de})]})]})})]}),(0,Pe.jsx)("div",{className:"card",children:(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,Pe.jsx)("div",{className:"w-full sm:max-w-lg",children:(0,Pe.jsx)("input",{type:"text",placeholder:"Search by name, category, or barcode",value:o,onChange:e=>l(e.target.value),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-200 transition"})}),(0,Pe.jsx)("div",{className:"w-full sm:w-60",children:(0,Pe.jsxs)("select",{value:c,onChange:e=>{d(e.target.value),y(1)},className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-200 transition",children:[(0,Pe.jsx)("option",{value:"",children:"All Categories"}),te.map(e=>(0,Pe.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," ")},e))]})})]})}),(0,Pe.jsxs)("div",{className:"card hidden md:block",children:[(0,Pe.jsx)("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gray-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Barcode"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expiry"}),(0,Pe.jsx)("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:oe.map(e=>(0,Pe.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4",style:{maxWidth:"300px"},children:(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsxs)("div",{className:"flex-shrink-0 h-10 w-10",children:[e.imageUrl?(0,Pe.jsx)("img",{src:e.imageUrl,alt:e.name,className:"h-10 w-10 rounded-lg object-cover border border-gray-200",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.nextSibling.style.display="flex"}}):null,(0,Pe.jsx)("div",{className:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center ".concat(e.imageUrl?"hidden":"flex"),children:(0,Pe.jsx)(Me,{className:"h-5 w-5 text-blue-600"})})]}),(0,Pe.jsxs)("div",{className:"ml-4 min-w-0 flex-1 overflow-hidden",children:[(0,Pe.jsx)("div",{className:"text-sm font-medium text-gray-900 break-words line-clamp-2",title:e.name,children:e.name}),(0,Pe.jsx)("div",{className:"text-sm text-gray-500 break-words line-clamp-2",title:e.description||"No description",children:e.description||"No description"})]})]})}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap",children:(0,Pe.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 max-w-[150px] truncate",title:e.category||"Uncategorized",children:e.category||"Uncategorized"})}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.quantityUnit||e.unit||"pcs"}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap",children:(0,Pe.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((e.quantity||e.stock||0)<=n.lowStockThreshold?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.quantity||e.stock||0})}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,Pe.jsx)("span",{className:"truncate block max-w-[120px]",title:e.barcode||"N/A",children:e.barcode||"N/A"})}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.expiryDate?new Date(e.expiryDate).toLocaleDateString():"N/A"}),(0,Pe.jsx)("td",{className:"px-4 sm:px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Pe.jsxs)("div",{className:"flex space-x-2",children:[(0,Pe.jsx)("button",{onClick:()=>he(e),className:"text-blue-600 hover:text-blue-900",children:(0,Pe.jsx)(Ut,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>ue(e.id),className:"text-red-600 hover:text-red-900",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})})]},e.id))})]})}),ie>1&&(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mt-6 px-4 py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:ae+1})," to ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(ae+V,ne.length)})," of ",(0,Pe.jsx)("span",{className:"font-semibold",children:ne.length})," ",1===ne.length?"result":"results"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>y(1),disabled:1===x,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"First page",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>y(Math.max(1,x-1)),disabled:1===x,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous page",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4"})}),(0,Pe.jsx)("div",{className:"flex items-center gap-1 mx-2",children:le().map((e,t)=>"ellipsis"===e?(0,Pe.jsx)("span",{className:"px-2 text-gray-500",children:"..."},"ellipsis-".concat(t)):(0,Pe.jsx)("button",{onClick:()=>y(e),className:"min-w-[36px] px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(x===e?"bg-[#2f3c7e] text-white shadow-sm":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e},e))}),(0,Pe.jsx)("button",{onClick:()=>y(Math.min(ie,x+1)),disabled:x===ie,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next page",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>y(ie),disabled:x===ie,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Last page",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4"})})]})]})]}),(0,Pe.jsxs)("div",{className:"md:hidden space-y-3",children:[oe.map(e=>(0,Pe.jsx)("div",{className:"card",style:{maxWidth:"100%",overflow:"hidden"},children:(0,Pe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Pe.jsxs)("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex-shrink-0 h-12 w-12",children:[e.imageUrl?(0,Pe.jsx)("img",{src:e.imageUrl,alt:e.name,className:"h-12 w-12 rounded-lg object-cover border border-gray-200",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.nextSibling.style.display="flex"}}):null,(0,Pe.jsx)("div",{className:"h-12 w-12 rounded-lg bg-blue-100 flex items-center justify-center ".concat(e.imageUrl?"hidden":"flex"),children:(0,Pe.jsx)(Me,{className:"h-6 w-6 text-blue-600"})})]}),(0,Pe.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,Pe.jsx)("div",{className:"text-sm font-medium text-gray-900 break-words line-clamp-2",title:e.name,children:e.name}),(0,Pe.jsx)("div",{className:"text-xs text-gray-500 line-clamp-2 break-words",title:e.description||"No description",children:e.description||"No description"}),(0,Pe.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,Pe.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 truncate max-w-[150px]",title:e.category||"Uncategorized",children:e.category||"Uncategorized"}),(0,Pe.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-600",children:e.quantityUnit||e.unit||"pcs"}),(0,Pe.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat((e.quantity||e.stock||0)<=n.lowStockThreshold?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:["Quantity: ",e.quantity||e.stock||0]})]}),(0,Pe.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:[(0,Pe.jsxs)("div",{children:["Barcode: ",e.barcode||"N/A"]}),(0,Pe.jsxs)("div",{children:["Expiry: ",e.expiryDate?new Date(e.expiryDate).toLocaleDateString():"N/A"]})]})]})]}),(0,Pe.jsxs)("div",{className:"flex flex-col space-y-2 ml-2",children:[(0,Pe.jsx)("button",{onClick:()=>he(e),className:"p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded-lg transition",children:(0,Pe.jsx)(Ut,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>ue(e.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-lg transition",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})]})},e.id)),ie>1&&(0,Pe.jsxs)("div",{className:"flex flex-col items-center justify-between gap-4 pt-4 px-4 py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-sm text-gray-700 text-center",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:ae+1})," to ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(ae+V,ne.length)})," of ",(0,Pe.jsx)("span",{className:"font-semibold",children:ne.length})," ",1===ne.length?"result":"results"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1 w-full",children:[(0,Pe.jsx)("button",{onClick:()=>y(1),disabled:1===x,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"First page",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>y(Math.max(1,x-1)),disabled:1===x,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous page",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4"})}),(0,Pe.jsx)("div",{className:"flex items-center gap-1 mx-2 flex-1 justify-center overflow-x-auto",children:le().map((e,t)=>"ellipsis"===e?(0,Pe.jsx)("span",{className:"px-2 text-gray-500",children:"..."},"ellipsis-".concat(t)):(0,Pe.jsx)("button",{onClick:()=>y(e),className:"min-w-[36px] px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(x===e?"bg-[#2f3c7e] text-white shadow-sm":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e},e))}),(0,Pe.jsx)("button",{onClick:()=>y(Math.min(ie,x+1)),disabled:x===ie,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next page",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>y(ie),disabled:x===ie,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Last page",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4"})})]})]})]}),u&&(0,Pe.jsx)(zu,{scannedBarcode:q,onClose:()=>{h(!1),w(""),H("")},onSave:e=>{(e=>{if(Q)return J(),!1;const t=$||(0,Se.$u)(),n=e.quantity||e.stock||0,s=void 0!==e.stock?e.stock:n,i=e.description||e.name||"",o=e.unit||e.quantityUnit||"pcs",l=void 0!==e.costPrice?e.costPrice:e.unitPrice||0,c=void 0!==e.sellingUnitPrice?e.sellingUnitPrice:e.sellingPrice||0,{mfg:d,mfgDate:u,expiryDate:m}=e,f=(0,_e.A)(e,Hu),p=(0,a.A)((0,a.A)({id:Date.now().toString()},f),{},{sellerId:t,quantity:n,stock:s,unit:o,costPrice:l,unitPrice:l,sellingUnitPrice:c,sellingPrice:c,description:i,createdAt:(new Date).toISOString(),isSynced:!1});if(e.mfg&&e.mfg.trim()||e.mfgDate&&e.mfgDate.trim()){const t=e.mfg&&e.mfg.trim()||e.mfgDate&&e.mfgDate.trim();t&&(p.mfg=t,p.mfgDate=t)}e.expiryDate&&e.expiryDate.trim()&&(p.expiryDate=e.expiryDate.trim()),r({type:"ADD_PRODUCT",payload:p}),r({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:'Product "'.concat(p.name,'" added'),timestamp:(new Date).toISOString(),type:"product_added"}}),h(!1),w("")})(e)},planLimitError:b,onClearPlanLimitError:()=>w("")}),m&&p&&(0,Pe.jsx)(qu,{product:p,onClose:()=>{f(!1),g(null)},onSave:e=>{r({type:"UPDATE_PRODUCT",payload:e}),r({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:'Product "'.concat(e.name,'" updated'),timestamp:(new Date).toISOString(),type:"product_updated"}}),f(!1),g(null)}}),v&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm px-4",children:(0,Pe.jsxs)("div",{className:"w-full max-w-sm rounded-3xl bg-white border border-slate-200 shadow-[0_32px_80px_-40px_rgba(15,23,42,0.55)] p-6 space-y-4",children:[(0,Pe.jsxs)("div",{className:"space-y-2 text-center",children:[(0,Pe.jsx)(lt,{className:"mx-auto h-10 w-10 text-amber-500"}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Delete product?"}),(0,Pe.jsxs)("p",{className:"text-sm text-slate-600",children:["Removing ",(0,Pe.jsx)("span",{className:"font-semibold",children:v.name})," will delete all related inventory details."]})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-end sm:gap-3 gap-2",children:[(0,Pe.jsx)("button",{type:"button",onClick:()=>N(null),className:"btn-secondary w-full sm:w-auto",children:"Cancel"}),(0,Pe.jsx)("button",{type:"button",onClick:()=>{r({type:"DELETE_PRODUCT",payload:v.id}),r({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:'Product "'.concat(v.name,'" deleted'),timestamp:(new Date).toISOString(),type:"product_deleted"}}),N(null)},className:"btn-danger w-full sm:w-auto",children:"Delete"})]})]})}),_&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,Pe.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl flex items-center justify-between z-10",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Import Products"}),(0,Pe.jsx)("button",{onClick:ye,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select File (CSV or JSON)"}),(0,Pe.jsx)("input",{ref:F,type:"file",accept:".csv,.json",onChange:async e=>{const t=e.target.files[0];if(t){const e=t.name.split(".").pop().toLowerCase();if("csv"!==e&&"json"!==e)return void(window.showToast&&window.showToast("Please select a CSV or JSON file","error"));E(t),j({total:0,processed:0,success:0,errors:[]}),D(!1),L(null);try{const r=await new Promise((e,n)=>{const r=new FileReader;r.onload=t=>e(t.target.result),r.onerror=n,r.readAsText(t)});let s=[];if("csv"===e?s=pe(r):"json"===e&&(s=ge(r)),s.length>0){const{maxProducts:e}=(0,Je.ay)(n.currentPlan,n.currentPlanDetails),t=X,r=s.length;if(e!==1/0&&t+r>e){const n=e-t;D(!0),R(s),L({currentProducts:t,productsToImport:r,maxProducts:e,availableSlots:n})}else D(!1),R(s)}}catch(r){console.error("Error parsing file:",r)}}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer"}),(0,Pe.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"CSV format: Name, Category, Unit, Stock, Cost Price, Selling Price, Barcode, Expiry Date, Description"}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:"JSON format: Array of objects with product fields"})]}),I&&(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Selected file:"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:I.name}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Size: ",(I.size/1024).toFixed(2)," KB"]}),P.length>0&&(0,Pe.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["Products found: ",P.length]})]}),k&&O&&(0,Pe.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-3",children:[(0,Pe.jsx)(lt,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h4",{className:"text-sm font-semibold text-orange-900 mb-2",children:"Product Limit Exceeded"}),(0,Pe.jsxs)("p",{className:"text-xs text-orange-800 mb-3",children:["You are trying to import ",(0,Pe.jsxs)("strong",{children:[O.productsToImport," products"]}),", but your current plan allows only ",(0,Pe.jsxs)("strong",{children:[O.maxProducts," products"]}),".",(0,Pe.jsx)("br",{}),"You currently have ",(0,Pe.jsxs)("strong",{children:[O.currentProducts," products"]})," and can add ",(0,Pe.jsxs)("strong",{children:[O.availableSlots," more"]}),"."]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mt-4",children:[(0,Pe.jsx)("button",{onClick:ye,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors text-sm",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>{s("/upgrade"),ye()},className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg font-medium hover:bg-orange-600 transition-colors text-sm",children:"Upgrade Plan"})]})]})]})}),T.total>0&&(0,Pe.jsxs)("div",{className:"space-y-2",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Pe.jsx)("span",{className:"text-gray-700",children:"Progress:"}),(0,Pe.jsxs)("span",{className:"text-gray-600",children:[T.processed," / ",T.total]})]}),(0,Pe.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Pe.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(T.processed/T.total*100,"%")}})}),T.success>0&&(0,Pe.jsxs)("p",{className:"text-sm text-green-600",children:["\u2713 Successfully imported: ",T.success]}),T.errors.length>0&&(0,Pe.jsxs)("div",{className:"mt-2 max-h-32 overflow-y-auto",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-red-600 mb-1",children:"Errors:"}),(0,Pe.jsxs)("ul",{className:"text-xs text-red-600 space-y-1",children:[T.errors.slice(0,5).map((e,t)=>(0,Pe.jsxs)("li",{children:["\u2022 ",e]},t)),T.errors.length>5&&(0,Pe.jsxs)("li",{children:["... and ",T.errors.length-5," more"]})]})]})]}),!k&&(0,Pe.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,Pe.jsx)("button",{onClick:ye,className:"flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>{I?k?window.showToast&&window.showToast("Please choose an option: Cancel, Upload Half Data, or Upgrade Plan","warning"):async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{j({total:0,processed:0,success:0,errors:[]});const i=e.name.split(".").pop().toLowerCase();let o=[];if(t&&Array.isArray(t))o=t;else{const t=await new Promise((t,n)=>{const r=new FileReader;r.onload=e=>t(e.target.result),r.onerror=n,r.readAsText(e)});if("csv"===i)o=pe(t);else{if("json"!==i)throw new Error("Unsupported file format. Please use CSV or JSON.");o=ge(t)}}if(0===o.length)throw new Error("No products found in file");s&&s>0&&(o=o.slice(0,s)),j(e=>(0,a.A)((0,a.A)({},e),{},{total:o.length}));const l=(0,Se.$u)(),c=[];let d=0;for(let e=0;e<o.length;e++){const{product:t,errors:s}=xe(o[e],e);if(s.length>0){c.push(...s),j(t=>(0,a.A)((0,a.A)({},t),{},{processed:e+1,errors:c}));continue}if(Q){c.push("Row ".concat(e+1,": Product limit reached. Cannot add more products.")),j(t=>(0,a.A)((0,a.A)({},t),{},{processed:e+1,errors:c}));break}if(t.barcode){const r=n.products.find(e=>e.barcode&&e.barcode.trim()===t.barcode.trim()&&!e.isDeleted);if(r){c.push("Row ".concat(e+1,': Barcode "').concat(t.barcode,'" already exists for product "').concat(r.name,'"')),j(t=>(0,a.A)((0,a.A)({},t),{},{processed:e+1,errors:c}));continue}}const i={id:"prod-".concat(Date.now(),"-").concat(e),name:t.name.trim(),category:t.category||"",quantityUnit:t.unit||"pcs",unit:t.unit||"pcs",quantity:t.stock||0,stock:t.stock||0,costPrice:t.costPrice||0,sellingPrice:t.sellingPrice||0,price:t.sellingPrice||0,barcode:t.barcode||"",expiryDate:t.expiryDate||"",description:t.description||"",isActive:!0,isDeleted:!1,createdAt:(new Date).toISOString(),sellerId:l};r({type:"ADD_PRODUCT",payload:i}),d++,j(t=>(0,a.A)((0,a.A)({},t),{},{processed:e+1,success:d}))}if(d>0&&window.showToast&&window.showToast("Successfully imported ".concat(d," product(s)").concat(c.length>0?". ".concat(c.length," error(s) occurred."):""),c.length>0?"warning":"success"),c.length>0&&0===d)throw new Error("Import failed: ".concat(c.join("; ")));setTimeout(()=>{C(!1),E(null),j({total:0,processed:0,success:0,errors:[]}),F.current&&(F.current.value="")},2e3)}catch(i){console.error("Error importing products:",i),window.showToast&&window.showToast("Import error: ".concat(i.message),"error"),j(e=>(0,a.A)((0,a.A)({},e),{},{errors:[...e.errors,i.message]}))}}(I):window.showToast&&window.showToast("Please select a file first","error")},disabled:!I||T.total>0,className:"flex-1 px-4 py-2.5 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:T.total>0?"Importing...":"Import Products"})]})]})]})})]})},Wu=Ee("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Gu=()=>{const{state:e,dispatch:n}=(0,i.nm)(),r=ee(),[s,a]=(0,t.useState)(""),[o,l]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("name"),[m,f]=(0,t.useState)("asc"),[p,g]=(0,t.useState)(1),[x,y]=(0,t.useState)(!1),[b,w]=(0,t.useState)({show:!1,productId:null,productName:null}),v=(0,t.useRef)(null);(0,t.useEffect)(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const[N,S]=(0,t.useState)(10);(0,t.useEffect)(()=>{const e=()=>{window.innerWidth>=1025?S(25):S(10)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const A=e=>{n({type:i.ActionTypes.SET_CURRENT_VIEW,payload:e}),r((0,$e.k_)(e))},_=e=>{var t,n;return Number(null!==(t=null!==(n=e.quantity)&&void 0!==n?n:e.stock)&&void 0!==t?t:0)||0},C=e=>{var t,n,r;return Number(null!==(t=null!==(n=null!==(r=e.costPrice)&&void 0!==r?r:e.unitPrice)&&void 0!==n?n:e.price)&&void 0!==t?t:0)||0},I=e=>{var t,n,r,s,i;return Number(null!==(t=null!==(n=null!==(r=null!==(s=null!==(i=e.sellingPrice)&&void 0!==i?i:e.sellingUnitPrice)&&void 0!==s?s:e.price)&&void 0!==r?r:e.costPrice)&&void 0!==n?n:e.unitPrice)&&void 0!==t?t:0)||0},E=e.products.filter(t=>{var n,r;const i=t.name.toLowerCase().includes(s.toLowerCase())||(null===(n=t.category)||void 0===n?void 0:n.toLowerCase().includes(s.toLowerCase()))||(null===(r=t.barcode)||void 0===r?void 0:r.includes(s)),a=!o||t.category===o,l=_(t),d=!c||"low-stock"===c&&l<=e.lowStockThreshold||"out-of-stock"===c&&0===l||"expiring"===c&&t.expiryDate&&new Date(t.expiryDate)<=new Date(Date.now()+24*e.expiryDaysThreshold*60*60*1e3);return i&&a&&d}).sort((e,t)=>{let n=e[u],r=t[u];return"stock"!==u&&"quantity"!==u||(n=_(e),r=_(t)),"price"===u&&(n=I(e),r=I(t)),"asc"===m?n>r?1:-1:n<r?1:-1}),T=Math.ceil(E.length/N),j=(p-1)*N,k=E.slice(j,j+N);(0,t.useEffect)(()=>{g(1)},[s,o,c,u,m,N]);const D=e.products.length,P=e.products.filter(t=>_(t)<=e.lowStockThreshold&&_(t)>0).length,R=e.products.filter(e=>0===_(e)).length,O=(e.products.filter(t=>!!t.expiryDate&&new Date(t.expiryDate)<=new Date(Date.now()+24*e.expiryDaysThreshold*60*60*1e3)).length,e.products.reduce((e,t)=>e+_(t)*I(t),0)),L=[...new Set(e.products.map(e=>e.category).filter(Boolean))],M=t=>0===t?{label:"Out of Stock",color:"bg-red-100 text-red-800"}:t<=e.lowStockThreshold?{label:"Low Stock",color:"bg-yellow-100 text-yellow-800"}:{label:"In Stock",color:"bg-green-100 text-green-800"},F=(e,t,n)=>{const r=new Blob([t],{type:n}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)};return(0,Pe.jsxs)("div",{className:"fade-in-up max-w-6xl mx-auto space-y-8",children:[(0,Pe.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Inventory Management"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-2",children:"Monitor and manage your product inventory"})]}),(0,Pe.jsx)("div",{className:"flex flex-wrap gap-3",children:(0,Pe.jsxs)("div",{className:"relative",ref:v,children:[(0,Pe.jsxs)("button",{onClick:()=>y(e=>!e),className:"btn-secondary flex items-center",children:[(0,Pe.jsx)(st,{className:"h-4 w-4 mr-2"}),"Export"]}),x&&(0,Pe.jsxs)("div",{className:"absolute right-0 mt-2 w-48 rounded-2xl border border-slate-200 bg-white/90 shadow-xl backdrop-blur-sm ring-1 ring-black/5 overflow-hidden z-10",children:[(0,Pe.jsxs)("button",{onClick:()=>{y(!1),(()=>{try{const t=new Uo("l","mm","a4"),n=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setFontSize(18),t.text("Inventory Report",n/2,15,{align:"center"}),t.setFontSize(11),t.text("".concat(e.username||"Grocery Store","  |  Generated: ").concat((new Date).toLocaleDateString()),n/2,22,{align:"center"}),t.setDrawColor(230),t.setFillColor(245,247,250),t.rect(10,28,n-20,18,"F"),t.setTextColor(60),t.setFontSize(10);const s=e.products.length,i=e.products.filter(t=>{const n=_(t);return n>0&&n<=e.lowStockThreshold}).length,a=e.products.filter(e=>0===_(e)).length,o=e.products.reduce((e,t)=>e+_(t)*I(t),0);t.text("Total Products: ".concat(s),14,40),t.text("Low Stock: ".concat(i),70,40),t.text("Out of Stock: ".concat(a),120,40),t.text("Inventory Value: \u20b9".concat(o.toFixed(2)),180,40);const l=["#","Name","Category","Qty","Cost","Price","Value","Status","Barcode","Expiry"],c=[12,68,42,20,26,26,32,30,40,38],d=2.5,u=12,h=52,m=16,f=4,p=[];let g=u;l.forEach((e,t)=>{p[t]=g,g+=c[t]});const x=g-u,y=l.indexOf("Status"),b=e=>(t.setFillColor(234,238,243),t.setDrawColor(210),t.rect(u,e-8,x,8,"F"),t.setTextColor(30),t.setFontSize(9.5),l.forEach((n,r)=>{const s=r>=l.length-4?"right":"left",i="right"===s?p[r]+c[r]-d:p[r]+d;t.text(n,i,e-2,{align:s})}),t.setDrawColor(210),l.forEach((n,s)=>{const i=p[s];t.line(i,e-8,i,r-m)}),t.line(u+x,e-8,u+x,r-m),t.line(u,e,u+x,e),e+2);let w=b(h);e.products.forEach((e,n)=>{const s=_(e),i=C(e),a=I(e)||i,o=s*a,g=M(s).label,v=e.barcode||"\u2014",N=e.expiryDate?new Date(e.expiryDate).toLocaleDateString():"\u2014",S=[n+1,e.name||"",e.category||"",s,"\u20b9".concat(i.toFixed(2)),"\u20b9".concat(a.toFixed(2)),"\u20b9".concat(o.toFixed(2)),g,v,N].map((e,n)=>{let r="string"===typeof e?e:String(e);r=r.replace(/[\xb9\xb2\xb3\u2074\u2075\u2076\u2077\u2078\u2079\u2070]/g,e=>String("\u2070\xb9\xb2\xb3\u2074\u2075\u2076\u2077\u2078\u2079".indexOf(e)));const s=c[n]-2*d,i=t.splitTextToSize(r,s);return i.length?i:[""]}),A=Math.max(...S.map(e=>e.length))*f+d;w+A>r-m&&(t.addPage(),w=b(h));const E=n%2===1?{r:247,g:249,b:252}:{r:255,g:255,b:255};t.setFillColor(E.r,E.g,E.b),t.rect(u,w-f+1,x,A,"F");const T={"Out of Stock":{r:254,g:226,b:226},"Low Stock":{r:255,g:247,b:237},"In Stock":{r:237,g:247,b:237}}[g]||E;-1!==y&&(t.setFillColor(T.r,T.g,T.b),t.rect(p[y],w-f+1,c[y],A,"F")),t.setDrawColor(220),l.forEach((e,n)=>{const r=p[n];t.line(r,w-f+1,r,w-f+1+A)}),t.line(u+x,w-f+1,u+x,w-f+1+A),t.line(u,w-f+1+A,u+x,w-f+1+A),t.setTextColor(40),t.setFontSize(8.5),S.forEach((e,n)=>{const r=n>=l.length-4?"right":"left";e.forEach((e,s)=>{const i=w+s*f,a="right"===r?p[n]+c[n]-d:p[n]+d;t.text(e,a,i,{align:r})})}),w+=A});const v=t.internal.getNumberOfPages();for(let N=1;N<=v;N++)t.setPage(N),t.setFontSize(8),t.setTextColor(120),t.text("Page ".concat(N," of ").concat(v),12,r-8),t.text("".concat(e.username||"Grocery Store"," \u2022 Inventory Report"),n-12,r-8,{align:"right"});t.setPage(v),t.setFontSize(8),t.setTextColor(100),t.text("Status legend: In Stock = adequate quantity \u2022 Low Stock = below threshold \u2022 Out of Stock = zero quantity",12,r-14),t.save("inventory-report-".concat((new Date).toISOString().split("T")[0],".pdf")),window.showToast&&window.showToast("Inventory exported as PDF.","success")}catch(t){console.error("Error exporting inventory PDF:",t),window.showToast&&window.showToast("Error generating PDF. Please try again.","error")}})()},className:"flex w-full items-center gap-2 px-4 py-3 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-indigo-50 hover:via-sky-50 hover:to-blue-50 transition",children:[(0,Pe.jsx)(Lt,{className:"h-4 w-4 text-indigo-500"}),"PDF Report"]}),(0,Pe.jsxs)("button",{onClick:()=>{y(!1),(()=>{try{const t=["Name","Category","Quantity","Cost Price","Selling Price","Inventory Value","Status","Barcode","Expiry Date"],n=e=>{if(null===e||void 0===e)return"";const t=String(e);return t.includes('"')?'"'.concat(t.replace(/"/g,'""'),'"'):t.includes(",")||t.includes("\n")?'"'.concat(t,'"'):t},r=e.products.map(e=>{const t=_(e),r=C(e),s=I(e)||r,i=t*s,a=M(t).label;return[n(e.name||""),n(e.category||""),n(t),n(r.toFixed(2)),n(s.toFixed(2)),n(i.toFixed(2)),n(a),n(e.barcode||""),n(e.expiryDate||"")]}),s=[t.join(","),...r.map(e=>e.join(","))].join("\n");F("inventory-".concat((new Date).toISOString().split("T")[0],".csv"),s,"text/csv;charset=utf-8;"),window.showToast&&window.showToast("Inventory exported as CSV.","success")}catch(t){console.error("Error exporting inventory CSV:",t),window.showToast&&window.showToast("Error exporting CSV. Please try again.","error")}})()},className:"flex w-full items-center gap-2 px-4 py-3 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-emerald-50 hover:via-teal-50 hover:to-cyan-50 transition",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4 text-emerald-500"}),"CSV Spreadsheet"]}),(0,Pe.jsxs)("button",{onClick:()=>{y(!1),(()=>{try{const t=e.products.map(e=>{const t=_(e),n=C(e),r=I(e)||n;return{id:e.id,name:e.name,category:e.category||"",quantity:t,costPrice:n,sellingPrice:r,inventoryValue:t*r,status:M(t).label,barcode:e.barcode||"",expiryDate:e.expiryDate||""}});F("inventory-".concat((new Date).toISOString().split("T")[0],".json"),JSON.stringify(t,null,2),"application/json"),window.showToast&&window.showToast("Inventory exported as JSON.","success")}catch(t){console.error("Error exporting inventory JSON:",t),window.showToast&&window.showToast("Error exporting JSON. Please try again.","error")}})()},className:"flex w-full items-center gap-2 px-4 py-3 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-amber-50 hover:via-orange-50 hover:to-yellow-50 transition",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4 text-amber-500"}),"JSON Dataset"]})]})]})})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[(0,Pe.jsx)("div",{className:"stat-card flex items-center justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Pe.jsx)("div",{className:"rounded-xl bg-blue-100 p-3",children:(0,Pe.jsx)(Me,{className:"h-6 w-6 text-blue-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:D})]})]})}),(0,Pe.jsx)("div",{className:"stat-card flex items-center justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Pe.jsx)("div",{className:"rounded-xl bg-yellow-100 p-3",children:(0,Pe.jsx)(lt,{className:"h-6 w-6 text-yellow-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Low Stock"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:P})]})]})}),(0,Pe.jsx)("div",{className:"stat-card flex items-center justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Pe.jsx)("div",{className:"rounded-xl bg-red-100 p-3",children:(0,Pe.jsx)(Wu,{className:"h-6 w-6 text-red-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Out of Stock"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:R})]})]})}),(0,Pe.jsx)("div",{className:"stat-card flex items-center justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Pe.jsx)("div",{className:"rounded-xl bg-emerald-100 p-3",children:(0,Pe.jsx)(je,{className:"h-6 w-6 text-emerald-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Inventory Value"}),(0,Pe.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20b9",O.toLocaleString("en-IN",{maximumFractionDigits:2})]})]})]})})]}),(0,Pe.jsx)("div",{className:"bg-white border border-slate-200 rounded-2xl shadow-sm p-5 space-y-4",children:(0,Pe.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-5",children:[(0,Pe.jsx)("div",{className:"xl:col-span-2",children:(0,Pe.jsx)("input",{type:"text",placeholder:"Search products...",value:s,onChange:e=>a(e.target.value),className:"input-field"})}),(0,Pe.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"input-field",children:[(0,Pe.jsx)("option",{value:"",children:"All Categories"}),L.map(e=>(0,Pe.jsx)("option",{value:e,children:e},e))]}),(0,Pe.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"input-field",children:[(0,Pe.jsx)("option",{value:"",children:"All Status"}),(0,Pe.jsx)("option",{value:"low-stock",children:"Low Stock"}),(0,Pe.jsx)("option",{value:"out-of-stock",children:"Out of Stock"}),(0,Pe.jsx)("option",{value:"expiring",children:"Expiring Soon"})]}),(0,Pe.jsxs)("select",{value:"".concat(u,"-").concat(m),onChange:e=>{const[t,n]=e.target.value.split("-");h(t),f(n)},className:"input-field",children:[(0,Pe.jsx)("option",{value:"name-asc",children:"Name A-Z"}),(0,Pe.jsx)("option",{value:"name-desc",children:"Name Z-A"}),(0,Pe.jsx)("option",{value:"stock-asc",children:"Stock Low-High"}),(0,Pe.jsx)("option",{value:"stock-desc",children:"Stock High-Low"}),(0,Pe.jsx)("option",{value:"price-asc",children:"Price Low-High"}),(0,Pe.jsx)("option",{value:"price-desc",children:"Price High-Low"})]})]})}),(0,Pe.jsxs)("div",{className:"bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden",children:[(0,Pe.jsx)("div",{className:"overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Product"}),(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Category"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Stock"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Price"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Value"}),(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Expiry"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:k.map(e=>{const t=_(e),r=M(t),s=I(e),i=t*s;return(0,Pe.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,Pe.jsx)("td",{className:"px-4 py-4",style:{maxWidth:"300px"},children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100 flex-shrink-0",children:(0,Pe.jsx)(Me,{className:"h-5 w-5 text-blue-600"})}),(0,Pe.jsxs)("div",{className:"min-w-0 flex-1 overflow-hidden",children:[(0,Pe.jsx)("p",{className:"font-semibold text-slate-900 break-words line-clamp-2",title:e.name,children:e.name}),(0,Pe.jsx)("p",{className:"text-xs text-slate-500 break-words line-clamp-1",title:e.barcode||"No barcode",children:e.barcode||"No barcode"})]})]})}),(0,Pe.jsx)("td",{className:"px-4 py-4",children:(0,Pe.jsx)("span",{className:"inline-flex max-w-[160px] items-center rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 truncate",title:e.category||"Uncategorized",children:e.category||"Uncategorized"})}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-right font-semibold text-slate-900",children:t}),(0,Pe.jsxs)("td",{className:"px-4 py-4 text-right text-slate-900",children:["\u20b9",s.toFixed(2)]}),(0,Pe.jsxs)("td",{className:"px-4 py-4 text-right font-semibold text-emerald-600",children:["\u20b9",i.toFixed(2)]}),(0,Pe.jsx)("td",{className:"px-4 py-4",children:(0,Pe.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold ".concat(r.color),children:r.label})}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-slate-600",children:e.expiryDate?new Date(e.expiryDate).toLocaleDateString():"N/A"}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-right",children:(0,Pe.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,Pe.jsx)("button",{onClick:()=>(e=>{n({type:"SET_CURRENT_PRODUCT",payload:e}),A("products")})(e),className:"rounded-md p-1.5 text-blue-600 hover:bg-blue-50 hover:text-blue-800 transition",title:"Edit Product",children:(0,Pe.jsx)(Ut,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>{return t=e.id,n=e.name,void w({show:!0,productId:t,productName:n||"this product"});var t,n},className:"rounded-md p-1.5 text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors",title:"Delete Product",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===k.length&&(0,Pe.jsxs)("div",{className:"text-center py-12",children:[(0,Pe.jsx)(Me,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),(0,Pe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Products Found"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:"Try adjusting your search or filters"}),(0,Pe.jsx)("button",{onClick:()=>A("products"),className:"btn-primary",children:"Add First Product"})]}),T>1&&(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mt-6 px-4 py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:j+1})," to ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(j+N,E.length)})," of ",(0,Pe.jsx)("span",{className:"font-semibold",children:E.length})," ",1===E.length?"result":"results"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>g(1),disabled:1===p,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"First page",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>g(Math.max(1,p-1)),disabled:1===p,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous page",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4"})}),(0,Pe.jsx)("div",{className:"flex items-center gap-1 mx-2",children:(()=>{const e=[];if(T<=5)for(let t=1;t<=T;t++)e.push(t);else if(p<=3){for(let t=1;t<=4;t++)e.push(t);e.push("ellipsis"),e.push(T)}else if(p>=T-2){e.push(1),e.push("ellipsis");for(let t=T-3;t<=T;t++)e.push(t)}else{e.push(1),e.push("ellipsis");for(let t=p-1;t<=p+1;t++)e.push(t);e.push("ellipsis"),e.push(T)}return e})().map((e,t)=>"ellipsis"===e?(0,Pe.jsx)("span",{className:"px-2 text-gray-500",children:"..."},"ellipsis-".concat(t)):(0,Pe.jsx)("button",{onClick:()=>g(e),className:"min-w-[36px] px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(p===e?"bg-[#2f3c7e] text-white shadow-sm":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e},e))}),(0,Pe.jsx)("button",{onClick:()=>g(Math.min(T,p+1)),disabled:p===T,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next page",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>g(T),disabled:p===T,className:"p-2 text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Last page",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4"})})]})]})]}),b.show&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-[1001] flex items-center justify-center p-4",style:{background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(8px)"},children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 border",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Pe.jsx)("div",{className:"p-3 rounded-xl mr-4",style:{background:"rgba(251, 113, 133, 0.16)"},children:(0,Pe.jsx)(lt,{className:"h-6 w-6",style:{color:"#BE123C"}})}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h3",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Delete Product?"}),(0,Pe.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"This action cannot be undone"})]})]}),(0,Pe.jsxs)("div",{className:"mb-6 p-4 rounded-xl",style:{background:"var(--surface-alt)"},children:[(0,Pe.jsxs)("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Are you sure you want to delete ",(0,Pe.jsxs)("span",{className:"font-bold",children:['"',b.productName,'"']}),"?"]}),(0,Pe.jsx)("p",{className:"text-xs mt-2",style:{color:"var(--text-secondary)"},children:"This product will be permanently removed from your inventory. All associated data will be lost."})]}),(0,Pe.jsxs)("div",{className:"flex gap-3",children:[(0,Pe.jsx)("button",{onClick:()=>w({show:!1,productId:null,productName:null}),className:"btn-secondary flex-1",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>{b.productId&&(n({type:"DELETE_PRODUCT",payload:b.productId}),window.showToast&&window.showToast('"'.concat(b.productName,'" has been deleted successfully'),"success",4e3),w({show:!1,productId:null,productName:null}))},className:"flex-1 px-4 py-2.5 rounded-xl font-semibold text-white transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",style:{background:"linear-gradient(135deg, #BE123C, #991F3D)",boxShadow:"0 4px 14px 0 rgba(190, 18, 60, 0.25)"},children:"Delete Product"})]})]})})]})},Yu=Ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Xu=e=>{let{onClose:n,onSave:r}=e;const{state:s}=(0,i.nm)(),[o,l]=(0,t.useState)({supplierName:"",items:[],notes:""}),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(!1),m=e=>{const{name:t,value:n}=e.target;l(e=>(0,a.A)((0,a.A)({},e),{},{[t]:n}))},f=(e,t,n)=>{l(r=>(0,a.A)((0,a.A)({},r),{},{items:r.items.map((r,s)=>s===e?(0,a.A)((0,a.A)({},r),{},{[t]:n}):r)}))},p=s.products.filter(e=>{var t;return e.name.toLowerCase().includes(c.toLowerCase())||(null===(t=e.category)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))});return(0,Pe.jsx)("div",{className:"professional-modal",children:(0,Pe.jsxs)("div",{className:"professional-modal-content max-h-[95vh] sm:max-h-[90vh]",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[(0,Pe.jsx)("div",{className:"p-2 rounded-xl mr-2 sm:mr-3 shrink-0",style:{background:"rgba(47, 60, 126, 0.12)"},children:(0,Pe.jsx)(qe,{className:"h-5 w-5 sm:h-6 sm:w-6",style:{color:"#2F3C7E"}})}),(0,Pe.jsx)("h2",{className:"text-lg sm:text-xl font-semibold truncate",style:{color:"var(--text-primary)"},children:"New Purchase Order"})]}),(0,Pe.jsx)("button",{onClick:n,className:"p-2 rounded-lg transition-colors active:bg-gray-100 touch-manipulation shrink-0 ml-2",style:{color:"var(--text-secondary)"},"aria-label":"Close",children:(0,Pe.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Pe.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Pe.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(95vh - 80px)"},children:(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=[];if(o.supplierName&&o.supplierName.trim()||t.push("Supplier name is required"),o.items&&0!==o.items.length?o.items.forEach((e,n)=>{e.productName&&e.productName.trim()||t.push("Item ".concat(n+1,": Product name is required"));const r=parseInt(e.quantity)||0;(!r||r<1)&&t.push("Item ".concat(n+1,": Quantity must be at least 1"));(parseFloat(e.price)||0)<0&&t.push("Item ".concat(n+1,": Price must be 0 or greater")),e.unit&&e.unit.trim()||t.push("Item ".concat(n+1,": Unit is required"));const s=["pcs","kg","g","mg","l","ml","box","packet","bottle","dozen"];e.unit&&!s.includes(e.unit)&&t.push("Item ".concat(n+1,": Unit must be one of: ").concat(s.join(", ")))}):t.push("Purchase order must have at least one item"),t.length>0){const e=t.join("\n");return void(window.showToast?window.showToast(e,"error"):alert(e))}const n=o.items.map(e=>(0,a.A)((0,a.A)({},e),{},{quantity:parseInt(e.quantity)||0,price:parseFloat(e.price)||0,subtotal:(parseFloat(e.price)||0)*(parseInt(e.quantity)||0)})),s=n.reduce((e,t)=>e+t.subtotal,0);s<0?window.showToast?window.showToast("Total must be 0 or greater","error"):alert("Total must be 0 or greater"):r((0,a.A)((0,a.A)({},o),{},{items:n,total:s}))},className:"p-4 sm:p-6 space-y-4 sm:space-y-6",style:{position:"relative"},children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:["Supplier Name * ",(0,Pe.jsx)("span",{className:"text-red-500",children:"(Required)"})]}),(0,Pe.jsx)("input",{type:"text",name:"supplierName",value:o.supplierName,onChange:m,className:"input-field w-full text-sm sm:text-base",placeholder:"Enter supplier name",required:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[(0,Pe.jsxs)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700",children:["Items (",o.items.length,")"]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>h(!0),className:"btn-secondary text-xs sm:text-sm px-3 py-2 touch-manipulation flex items-center justify-center",children:[(0,Pe.jsx)(Yu,{className:"h-4 w-4 mr-1"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Search Products"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Search"})]}),(0,Pe.jsxs)("button",{type:"button",onClick:()=>{l(e=>(0,a.A)((0,a.A)({},e),{},{items:[...e.items,{productId:"",productName:"",quantity:"",price:"",unit:"pcs",isCustomProduct:!1}]}))},className:"btn-secondary text-xs sm:text-sm px-3 py-2 touch-manipulation flex items-center justify-center",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4 mr-1"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Add Manually"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Add"})]})]})]}),u&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-lg p-4 sm:p-6 w-full max-w-2xl max-h-[90vh] sm:max-h-96 overflow-hidden flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[(0,Pe.jsx)("h3",{className:"text-base sm:text-lg font-semibold",children:"Search Products"}),(0,Pe.jsx)("button",{onClick:()=>{h(!1),d("")},className:"text-gray-500 active:text-gray-700 p-2 touch-manipulation","aria-label":"Close",children:"\xd7"})]}),(0,Pe.jsxs)("div",{className:"mb-4 flex-shrink-0",children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",htmlFor:"product-search-input",children:"Search products"}),(0,Pe.jsx)("input",{id:"product-search-input",type:"text",placeholder:"Search products by name or category...",value:c,onChange:e=>d(e.target.value),className:"input-field w-full text-sm sm:text-base",autoFocus:!0})]}),(0,Pe.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-2 min-h-0",children:[p.map(e=>(0,Pe.jsxs)("div",{onClick:()=>(e=>{const t=o.items.findIndex(t=>t.productId===e.id);if(t>=0)f(t,"quantity",(parseInt(o.items[t].quantity)||0)+1);else{const t=e.costPrice||e.unitPrice||e.price||"";l(n=>(0,a.A)((0,a.A)({},n),{},{items:[...n.items,{productId:e.id,productName:e.name,quantity:"1",price:t,unit:e.unit||e.quantityUnit||"pcs",isCustomProduct:!1}]}))}h(!1),d("")})(e),className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg active:bg-blue-50 cursor-pointer transition-colors touch-manipulation",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1 pr-2",children:[(0,Pe.jsx)("p",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:e.name}),(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:[e.category," \u2022 Qty: ",e.quantity||e.stock||0," ",e.quantityUnit||e.unit||"pcs"]})]}),(0,Pe.jsxs)("div",{className:"text-right shrink-0",children:[(0,Pe.jsxs)("p",{className:"font-semibold text-blue-600 text-sm sm:text-base",children:["\u20b9",(Number(e.price)||0).toFixed(2)]}),(0,Pe.jsx)("button",{type:"button",className:"text-xs text-blue-600 active:text-blue-800",children:"Add"})]})]},e.id)),0===p.length&&c&&(0,Pe.jsxs)("div",{className:"text-center py-8 text-gray-500 text-sm",children:['No products found matching "',c,'"']})]})]})}),(0,Pe.jsxs)("div",{className:"space-y-3",children:[o.items.map((e,t)=>{const n=s.products.find(t=>t.id===e.productId);return(0,Pe.jsx)("div",{className:"p-4 rounded-xl border",style:{background:"var(--surface-alt)",borderColor:"var(--border-subtle)"},children:(0,Pe.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 lg:grid-cols-12 lg:items-end",children:[(0,Pe.jsxs)("div",{className:"lg:col-span-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Pe.jsx)("label",{className:"block text-xs font-semibold",style:{color:"var(--text-primary)"},children:"Product"}),(0,Pe.jsx)("button",{type:"button",onClick:()=>(e=>{o.items[e].isCustomProduct?(f(e,"isCustomProduct",!1),f(e,"productName","")):(f(e,"isCustomProduct",!0),f(e,"productId",""))})(t),className:"text-xs px-2 py-1 rounded-lg font-medium transition-colors touch-manipulation ".concat(e.isCustomProduct?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:e.isCustomProduct?"Custom":"Existing"})]}),e.isCustomProduct?(0,Pe.jsx)("input",{type:"text",value:e.productName,onChange:e=>f(t,"productName",e.target.value),className:"input-field w-full",placeholder:"Enter product name",required:!0}):(0,Pe.jsx)("div",{style:{position:"relative",zIndex:1e3-t},children:(0,Pe.jsxs)("select",{value:e.productId,onChange:e=>{const n=s.products.find(t=>t.id===e.target.value);if(f(t,"productId",e.target.value),n){const e=n.costPrice||n.unitPrice||n.price||"";f(t,"price",e),f(t,"unit",n.unit||n.quantityUnit||"pcs"),f(t,"productName",n.name)}},className:"input-field w-full",required:!0,style:{position:"relative",zIndex:1e3-t},children:[(0,Pe.jsx)("option",{value:"",children:"Select Product"}),s.products.map(e=>{const t=e.costPrice||e.unitPrice||e.price||0;return(0,Pe.jsxs)("option",{value:e.id,children:[e.name," (\u20b9",t.toFixed(2),"/",e.unit||e.quantityUnit||"pcs",")"]},e.id)})]})}),n&&!e.isCustomProduct&&(0,Pe.jsxs)("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:["Stock: ",n.quantity||n.stock||0," ",n.quantityUnit||n.unit||"pcs"]})]}),(0,Pe.jsxs)("div",{className:"lg:col-span-2",children:[(0,Pe.jsx)("label",{className:"block text-xs font-semibold mb-1",style:{color:"var(--text-primary)"},children:"Quantity *"}),(0,Pe.jsx)("input",{type:"number",value:e.quantity,onChange:e=>f(t,"quantity",e.target.value),className:"input-field w-full",placeholder:"Qty",min:"1",required:!0})]}),(0,Pe.jsxs)("div",{className:"lg:col-span-2",style:{position:"relative",zIndex:1e3-t},children:[(0,Pe.jsx)("label",{className:"block text-xs font-semibold mb-1",style:{color:"var(--text-primary)"},children:"Unit *"}),(0,Pe.jsxs)("select",{value:e.unit,onChange:e=>f(t,"unit",e.target.value),className:"input-field w-full",required:!0,style:{position:"relative",zIndex:1e3-t},children:[(0,Pe.jsx)("option",{value:"",children:"Select"}),(0,Pe.jsx)("option",{value:"pcs",children:"Pieces"}),(0,Pe.jsx)("option",{value:"kg",children:"Kilogram"}),(0,Pe.jsx)("option",{value:"g",children:"Gram"}),(0,Pe.jsx)("option",{value:"mg",children:"Milligram"}),(0,Pe.jsx)("option",{value:"l",children:"Liter"}),(0,Pe.jsx)("option",{value:"ml",children:"Milliliter"}),(0,Pe.jsx)("option",{value:"box",children:"Box"}),(0,Pe.jsx)("option",{value:"packet",children:"Packet"}),(0,Pe.jsx)("option",{value:"bottle",children:"Bottle"}),(0,Pe.jsx)("option",{value:"dozen",children:"Dozen"})]})]}),(0,Pe.jsxs)("div",{className:"lg:col-span-2",children:[(0,Pe.jsx)("label",{className:"block text-xs font-semibold mb-1",style:{color:"var(--text-primary)"},children:"Price (\u20b9) *"}),(0,Pe.jsx)("input",{type:"number",value:e.price,onChange:e=>f(t,"price",e.target.value),className:"input-field w-full",placeholder:"0.00",min:"0",step:"0.01",required:!0})]}),(0,Pe.jsxs)("div",{className:"lg:col-span-2 flex items-end gap-2",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("p",{className:"text-xs mb-1",style:{color:"var(--text-secondary)"},children:"Total"}),(0,Pe.jsxs)("p",{className:"font-bold text-lg",style:{color:"#047857"},children:["\u20b9",((parseFloat(e.price)||0)*(parseInt(e.quantity)||0)).toFixed(2)]})]}),(0,Pe.jsx)("button",{type:"button",onClick:()=>(e=>{l(t=>(0,a.A)((0,a.A)({},t),{},{items:t.items.filter((t,n)=>n!==e)}))})(t),className:"p-2 rounded-lg transition-colors hover:bg-red-50 mb-1",style:{color:"#BE123C"},title:"Remove item",children:(0,Pe.jsx)(qt,{className:"h-5 w-5"})})]})]})},t)}),0===o.items.length&&(0,Pe.jsxs)("div",{className:"text-center py-12 rounded-xl border-2 border-dashed",style:{background:"var(--surface-alt)",borderColor:"var(--border-subtle)"},children:[(0,Pe.jsx)("div",{className:"inline-flex p-4 rounded-full mb-4",style:{background:"var(--surface-alt)"},children:(0,Pe.jsx)(Me,{className:"h-12 w-12",style:{color:"var(--text-secondary)",opacity:.4}})}),(0,Pe.jsx)("p",{className:"font-medium mb-2",style:{color:"var(--text-secondary)"},children:"No items added yet"}),(0,Pe.jsx)("p",{className:"text-sm",style:{color:"var(--text-secondary)",opacity:.7},children:'Click "Search Products" or "Add Manually" to get started'})]})]}),o.items.length>0&&(0,Pe.jsxs)("div",{className:"mt-6 p-5 rounded-xl border-2",style:{background:"rgba(47, 60, 126, 0.08)",borderColor:"rgba(47, 60, 126, 0.2)"},children:[(0,Pe.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,Pe.jsx)("span",{className:"font-semibold text-lg",style:{color:"#2F3C7E"},children:"Order Total:"}),(0,Pe.jsxs)("span",{className:"text-3xl font-bold",style:{color:"#2F3C7E"},children:["\u20b9",o.items.reduce((e,t)=>e+(parseFloat(t.price)||0)*(parseInt(t.quantity)||0),0).toFixed(2)]})]}),(0,Pe.jsxs)("p",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:[o.items.length," item",1!==o.items.length?"s":""," \u2022 Total Quantity: ",o.items.reduce((e,t)=>e+(parseInt(t.quantity)||0),0)," units"]})]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,Pe.jsx)("textarea",{name:"notes",value:o.notes,onChange:m,className:"input-field",rows:3,placeholder:"Additional notes..."})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:space-x-3 pt-4 sm:pt-6 border-t",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsx)("button",{type:"button",onClick:n,className:"btn-secondary w-full sm:w-auto text-sm sm:text-base px-4 py-2 touch-manipulation",children:"Cancel"}),(0,Pe.jsx)("button",{type:"submit",className:"btn-primary w-full sm:w-auto text-sm sm:text-base px-4 py-2 touch-manipulation",children:"Create Purchase Order"})]})]})})]})})},Qu=()=>{var e,n;const{state:r,dispatch:s}=(0,i.nm)(),[o,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("all"),[m,f]=(0,t.useState)(1),[p,g]=(0,t.useState)({show:!1,orderId:null,orderInfo:null}),x=r.purchaseOrders.filter(e=>{var t;if(!0===e.isDeleted)return!1;const n=(null===(t=e.supplierName)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))||e.id.includes(c),r="all"===u||e.status===u;return n&&r}),y=Math.ceil(x.length/10),b=10*(m-1),w=x.slice(b,b+10),v=r.purchaseOrders.filter(e=>!0!==e.isDeleted),N=v.length,S=v.filter(e=>"pending"===e.status).length,A=v.filter(e=>"completed"===e.status).length,_=v.reduce((e,t)=>e+(Number(t.total)||0),0),C=e=>{switch(e){case"pending":return(0,Pe.jsx)(rt,{className:"h-4 w-4 text-yellow-600"});case"completed":return(0,Pe.jsx)(od,{className:"h-4 w-4 text-green-600"});case"cancelled":return(0,Pe.jsx)(St,{className:"h-4 w-4 text-red-600"});default:return(0,Pe.jsx)(rt,{className:"h-4 w-4 text-gray-600"})}},I=e=>{const t="px-3 py-1 rounded-full text-xs font-semibold";switch(e){case"pending":return"".concat(t," bg-yellow-100 text-yellow-800");case"completed":return"".concat(t," bg-green-100 text-green-800");case"cancelled":return"".concat(t," bg-red-100 text-red-800");default:return"".concat(t," bg-gray-100 text-gray-800")}},E=async(e,t)=>{const n=r.purchaseOrders.find(t=>String(t.id)===String(e)||t._id&&String(t._id)===String(e));if(!n)return console.error("Purchase order not found:",e),void(window.showToast&&window.showToast("Purchase order not found","error"));const i=n.createdAt?new Date(n.createdAt).getTime():0,o=Date.now()-i;o<2e3&&!n.isSynced&&(console.log("\u23f3 [handleStatusChange] Newly created PO detected, waiting for IndexedDB save...",{orderId:e,timeSinceCreation:"".concat(o,"ms")}),await new Promise(e=>setTimeout(e,300)));const l=(0,a.A)((0,a.A)({},n),{},{status:t,id:n.id,_id:n._id,createdAt:n.createdAt,date:n.date||n.createdAt});console.log("\ud83d\udd04 [handleStatusChange] Updating purchase order:",{orderId:e,oldStatus:n.status,newStatus:t,orderIdType:typeof n.id,order_idType:typeof n._id,isSynced:n.isSynced,timeSinceCreation:o<2e3?"".concat(o,"ms"):"N/A"}),s({type:"UPDATE_PURCHASE_ORDER",payload:l}),s({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:"Purchase order ".concat(e," status changed to ").concat(t),timestamp:(new Date).toISOString(),type:"po_status_changed"}}),window.showToast&&window.showToast("Purchase order status changed to ".concat(t),"success")},T=e=>{const t=r.purchaseOrders.find(t=>t.id===e),n=t?{id:e,supplierName:t.supplierName||"Unknown Supplier",total:t.total||0,date:t.orderDate||t.createdAt||""}:{id:e,supplierName:"Unknown Supplier",total:0,date:""};g({show:!0,orderId:e,orderInfo:n})};return(0,Pe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6 fade-in-up",children:[(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 sm:flex-row sm:items-start sm:justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",style:{color:"var(--text-primary)"},children:"Purchase Orders"}),(0,Pe.jsx)("p",{className:"mt-1 sm:mt-2 text-sm sm:text-base font-medium",style:{color:"var(--text-secondary)"},children:"Manage supplier orders and inventory"})]}),(0,Pe.jsxs)("button",{onClick:()=>l(!0),className:"btn-primary flex items-center justify-center mt-3 sm:mt-0 text-sm sm:text-base px-4 py-2 touch-manipulation",children:[(0,Pe.jsx)(Bt,{className:"h-4 w-4 mr-2"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"New Purchase Order"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"New Order"})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6",children:[(0,Pe.jsx)("div",{className:"stat-card h-full p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-blue-100 rounded-xl shrink-0",children:(0,Pe.jsx)(qe,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"})}),(0,Pe.jsxs)("div",{className:"ml-2 sm:ml-4 flex-1 min-w-0",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Total Orders"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 leading-tight truncate",children:N})]})]})}),(0,Pe.jsx)("div",{className:"stat-card h-full p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-yellow-100 rounded-xl shrink-0",children:(0,Pe.jsx)(rt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-yellow-600"})}),(0,Pe.jsxs)("div",{className:"ml-2 sm:ml-4 flex-1 min-w-0",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Pending"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 leading-tight truncate",children:S})]})]})}),(0,Pe.jsx)("div",{className:"stat-card h-full p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-green-100 rounded-xl shrink-0",children:(0,Pe.jsx)(od,{className:"h-5 w-5 sm:h-6 sm:w-6 text-green-600"})}),(0,Pe.jsxs)("div",{className:"ml-2 sm:ml-4 flex-1 min-w-0",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Completed"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 leading-tight truncate",children:A})]})]})}),(0,Pe.jsx)("div",{className:"stat-card h-full p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("div",{className:"p-2 sm:p-3 bg-purple-100 rounded-xl shrink-0",children:(0,Pe.jsx)(Me,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600"})}),(0,Pe.jsxs)("div",{className:"ml-2 sm:ml-4 flex-1 min-w-0",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:"Total Value"}),(0,Pe.jsxs)("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 leading-tight truncate",children:["\u20b9",_.toFixed(2)]})]})]})})]}),(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,Pe.jsxs)("div",{className:"w-full lg:max-w-lg",children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",htmlFor:"purchase-search",children:"Search purchase orders"}),(0,Pe.jsx)("input",{id:"purchase-search",type:"text",placeholder:"Type supplier name or order ID",value:c,onChange:e=>d(e.target.value),className:"input-field w-full text-sm sm:text-base"})]}),(0,Pe.jsxs)("div",{className:"flex w-full flex-col gap-3 sm:flex-row sm:items-center lg:w-auto",children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 sm:hidden",htmlFor:"purchase-status-filter",children:"Filter by status"}),(0,Pe.jsxs)("select",{id:"purchase-status-filter",value:u,onChange:e=>h(e.target.value),className:"input-field w-full sm:w-48 text-sm sm:text-base",children:[(0,Pe.jsx)("option",{value:"all",children:"All Status"}),(0,Pe.jsx)("option",{value:"pending",children:"Pending"}),(0,Pe.jsx)("option",{value:"completed",children:"Completed"}),(0,Pe.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]})}),(0,Pe.jsx)("div",{className:"card hidden lg:block",children:(0,Pe.jsx)("div",{className:"overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Order ID"}),(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Supplier"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center",children:"Items"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Total Value"}),(0,Pe.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Date"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:w.map(e=>{var t,n;return(0,Pe.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,Pe.jsx)("td",{className:"px-4 py-4 align-top",children:(0,Pe.jsxs)("div",{className:"flex flex-col",children:[(0,Pe.jsxs)("span",{className:"font-semibold text-slate-900",children:["#",e.id]}),(0,Pe.jsxs)("span",{className:"text-xs text-slate-500",children:["Created ",e.createdAt?new Date(e.createdAt).toLocaleString():"N/A"]})]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 align-top",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600",children:(0,Pe.jsx)(qe,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("p",{className:"font-medium text-slate-900 truncate",title:e.supplierName||"Unknown Supplier",children:e.supplierName||"Unknown Supplier"}),(0,Pe.jsxs)("p",{className:"text-xs text-slate-500 truncate",children:["PO Value \u2022 \u20b9",Number(e.total||0).toFixed(2)]})]})]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-center align-top",children:(0,Pe.jsxs)("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700",children:[(null===(t=e.items)||void 0===t?void 0:t.length)||0," ",1===(null===(n=e.items)||void 0===n?void 0:n.length)?"item":"items"]})}),(0,Pe.jsxs)("td",{className:"px-4 py-4 text-right font-semibold text-slate-900 align-top whitespace-nowrap",children:["\u20b9",Number(e.total||0).toFixed(2)]}),(0,Pe.jsx)("td",{className:"px-4 py-4 align-top",children:(0,Pe.jsxs)("span",{className:"".concat(I(e.status)," inline-flex items-center gap-1"),children:[C(e.status),(0,Pe.jsx)("span",{className:"capitalize",children:e.status})]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-right text-slate-600 align-top whitespace-nowrap",children:e.date?new Date(e.date).toLocaleDateString():"N/A"}),(0,Pe.jsx)("td",{className:"px-4 py-4 text-right align-top",children:(0,Pe.jsxs)("div",{className:"inline-flex items-center gap-2",children:["pending"===e.status&&(0,Pe.jsx)("button",{onClick:()=>E(e.id,"completed"),className:"rounded-md border border-green-100 bg-green-50 p-2 text-green-600 transition hover:bg-green-100 hover:text-green-700",title:"Mark as completed",children:(0,Pe.jsx)(od,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>E(e.id,"cancelled"),className:"rounded-md border border-red-100 bg-red-50 p-2 text-red-600 transition hover:bg-red-100 hover:text-red-700",title:"Cancel order",children:(0,Pe.jsx)(St,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>T(e.id),className:"rounded-md p-1.5 text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors",title:"Delete order",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})})]},e.id)})})]})})}),(0,Pe.jsx)("div",{className:"lg:hidden space-y-3",children:w.length>0?w.map(e=>{var t,n;return(0,Pe.jsxs)("div",{className:"card p-4 hover:shadow-md transition-shadow",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Pe.jsx)("div",{className:"flex-1 min-w-0",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,Pe.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600 shrink-0",children:(0,Pe.jsx)(qe,{className:"h-4 w-4"})}),(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate",children:e.supplierName||"Unknown Supplier"}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 truncate",children:["#",e.id]})]})]})}),(0,Pe.jsxs)("div",{className:"ml-3 flex items-center gap-2 flex-shrink-0",children:["pending"===e.status&&(0,Pe.jsx)("button",{onClick:()=>E(e.id,"completed"),className:"p-2.5 rounded-lg border border-green-100 bg-green-50 text-green-600 active:bg-green-100 transition-colors touch-manipulation",title:"Mark as completed",children:(0,Pe.jsx)(od,{className:"h-5 w-5"})}),(0,Pe.jsx)("button",{onClick:()=>T(e.id),className:"p-2.5 rounded-lg text-red-600 active:bg-red-50 transition-colors touch-manipulation",title:"Delete order",children:(0,Pe.jsx)(qt,{className:"h-5 w-5"})})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Total Value"}),(0,Pe.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["\u20b9",Number(e.total||0).toFixed(2)]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Items"}),(0,Pe.jsxs)("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-1 text-xs font-semibold text-blue-700",children:[(null===(t=e.items)||void 0===t?void 0:t.length)||0," ",1===(null===(n=e.items)||void 0===n?void 0:n.length)?"item":"items"]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,Pe.jsxs)("span",{className:"".concat(I(e.status)," inline-flex items-center gap-1"),children:[C(e.status),(0,Pe.jsx)("span",{className:"capitalize",children:e.status})]}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:e.date?new Date(e.date).toLocaleDateString():"N/A"})]})]},e.id)}):(0,Pe.jsxs)("div",{className:"card p-12 text-center",children:[(0,Pe.jsx)(qe,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),(0,Pe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Purchase Orders"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:"Get started by creating your first purchase order"}),(0,Pe.jsx)("button",{onClick:()=>l(!0),className:"btn-primary",children:"Create Purchase Order"})]})}),y>1&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{className:"hidden lg:flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4 mt-4 sm:mt-6 px-3 sm:px-4 py-3 sm:py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:b+1})," to"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(b+10,x.length)})," of"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:x.length})," results"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("button",{onClick:()=>f(Math.max(1,m-1)),disabled:1===m,className:"px-3 py-2 text-xs sm:text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation",children:"Previous"}),(0,Pe.jsxs)("span",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium text-gray-700",children:["Page ",m," of ",y]}),(0,Pe.jsx)("button",{onClick:()=>f(Math.min(y,m+1)),disabled:m===y,className:"px-3 py-2 text-xs sm:text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation",children:"Next"})]})]}),(0,Pe.jsxs)("div",{className:"lg:hidden flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4 px-3 sm:px-4 py-3 sm:py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:b+1})," to"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(b+10,x.length)})," of"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:x.length})," results"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("button",{onClick:()=>f(Math.max(1,m-1)),disabled:1===m,className:"px-3 py-2 text-xs sm:text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation",children:"Previous"}),(0,Pe.jsxs)("span",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium text-gray-700",children:["Page ",m," of ",y]}),(0,Pe.jsx)("button",{onClick:()=>f(Math.min(y,m+1)),disabled:m===y,className:"px-3 py-2 text-xs sm:text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation",children:"Next"})]})]})]}),o&&(0,Pe.jsx)(Xu,{onClose:()=>l(!1),onSave:e=>{const t=(0,a.A)((0,a.A)({id:"PO-".concat(Date.now())},e),{},{status:"pending",date:(new Date).toISOString(),createdAt:(new Date).toISOString(),items:e.items.map(e=>({productId:e.productId||null,productName:e.productName||"",quantity:parseInt(e.quantity)||0,price:parseFloat(e.price)||0,unit:e.unit||"pcs",subtotal:parseFloat(e.subtotal)||(parseFloat(e.price)||0)*(parseInt(e.quantity)||0),isCustomProduct:e.isCustomProduct||!1}))});s({type:"ADD_PURCHASE_ORDER",payload:t}),s({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:"New purchase order ".concat(t.id," created"),timestamp:(new Date).toISOString(),type:"po_created"}}),l(!1)}}),p.show&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-[1001] flex items-center justify-center p-4",style:{background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(8px)"},children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 border",style:{borderColor:"var(--border-subtle)"},children:[(0,Pe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Pe.jsx)("div",{className:"p-3 rounded-xl mr-4",style:{background:"rgba(251, 113, 133, 0.16)"},children:(0,Pe.jsx)(St,{className:"h-6 w-6",style:{color:"#BE123C"}})}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h3",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Delete Purchase Order?"}),(0,Pe.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"This action cannot be undone"})]})]}),(0,Pe.jsxs)("div",{className:"mb-6 p-4 rounded-xl",style:{background:"var(--surface-alt)"},children:[(0,Pe.jsxs)("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Are you sure you want to delete purchase order from ",(0,Pe.jsxs)("span",{className:"font-bold",children:['"',null===(e=p.orderInfo)||void 0===e?void 0:e.supplierName,'"']}),"?"]}),(null===(n=p.orderInfo)||void 0===n?void 0:n.total)>0&&(0,Pe.jsxs)("p",{className:"text-xs mt-2",style:{color:"var(--text-secondary)"},children:["Order Total: ",(0,Pe.jsxs)("span",{className:"font-semibold",children:["\u20b9",p.orderInfo.total.toFixed(2)]})]}),(0,Pe.jsx)("p",{className:"text-xs mt-2",style:{color:"var(--text-secondary)"},children:"This purchase order will be permanently removed. All associated data will be lost."})]}),(0,Pe.jsxs)("div",{className:"flex gap-3",children:[(0,Pe.jsx)("button",{onClick:()=>g({show:!1,orderId:null,orderInfo:null}),className:"btn-secondary flex-1",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>{p.orderId&&(s({type:"DELETE_PURCHASE_ORDER",payload:p.orderId}),s({type:"ADD_ACTIVITY",payload:{id:Date.now().toString(),message:"Purchase order ".concat(p.orderId," deleted"),timestamp:(new Date).toISOString(),type:"po_deleted"}}),window.showToast&&window.showToast('Purchase order "'.concat(p.orderInfo.supplierName,'" has been deleted successfully'),"success",4e3),g({show:!1,orderId:null,orderInfo:null}))},className:"flex-1 px-4 py-2.5 rounded-xl font-semibold text-white transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",style:{background:"linear-gradient(135deg, #BE123C, #991F3D)",boxShadow:"0 4px 14px 0 rgba(190, 18, 60, 0.25)"},children:"Delete Order"})]})]})})]})},Ku=Ee("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Zu=Ee("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),Ju=Ee("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);function $u(){}const eh=function(){let e=0;return function(){return e++}}();function th(e){return null===e||"undefined"===typeof e}function nh(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function rh(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}const sh=e=>("number"===typeof e||e instanceof Number)&&isFinite(+e);function ih(e,t){return sh(e)?e:t}function ah(e,t){return"undefined"===typeof e?t:e}const oh=(e,t)=>"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function lh(e,t,n){if(e&&"function"===typeof e.call)return e.apply(n,t)}function ch(e,t,n,r){let s,i,a;if(nh(e))if(i=e.length,r)for(s=i-1;s>=0;s--)t.call(n,e[s],s);else for(s=0;s<i;s++)t.call(n,e[s],s);else if(rh(e))for(a=Object.keys(e),i=a.length,s=0;s<i;s++)t.call(n,e[a[s]],a[s])}function dh(e,t){let n,r,s,i;if(!e||!t||e.length!==t.length)return!1;for(n=0,r=e.length;n<r;++n)if(s=e[n],i=t[n],s.datasetIndex!==i.datasetIndex||s.index!==i.index)return!1;return!0}function uh(e){if(nh(e))return e.map(uh);if(rh(e)){const t=Object.create(null),n=Object.keys(e),r=n.length;let s=0;for(;s<r;++s)t[n[s]]=uh(e[n[s]]);return t}return e}function hh(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function mh(e,t,n,r){if(!hh(e))return;const s=t[e],i=n[e];rh(s)&&rh(i)?fh(s,i,r):t[e]=uh(i)}function fh(e,t,n){const r=nh(t)?t:[t],s=r.length;if(!rh(e))return e;const i=(n=n||{}).merger||mh;for(let a=0;a<s;++a){if(!rh(t=r[a]))continue;const s=Object.keys(t);for(let r=0,a=s.length;r<a;++r)i(s[r],e,t,n)}return e}function ph(e,t){return fh(e,t,{merger:gh})}function gh(e,t,n){if(!hh(e))return;const r=t[e],s=n[e];rh(r)&&rh(s)?ph(r,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=uh(s))}const xh={"":e=>e,x:e=>e.x,y:e=>e.y};function yh(e,t){const n=xh[t]||(xh[t]=function(e){const t=function(e){const t=e.split("."),n=[];let r="";for(const s of t)r+=s,r.endsWith("\\")?r=r.slice(0,-1)+".":(n.push(r),r="");return n}(e);return e=>{for(const n of t){if(""===n)break;e=e&&e[n]}return e}}(t));return n(e)}function bh(e){return e.charAt(0).toUpperCase()+e.slice(1)}const wh=e=>"undefined"!==typeof e,vh=e=>"function"===typeof e,Nh=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};const Sh=Math.PI,Ah=2*Sh,_h=Ah+Sh,Ch=Number.POSITIVE_INFINITY,Ih=Sh/180,Eh=Sh/2,Th=Sh/4,jh=2*Sh/3,kh=Math.log10,Dh=Math.sign;function Ph(e){const t=Math.round(e);e=Oh(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(kh(e))),r=e/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function Rh(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Oh(e,t,n){return Math.abs(e-t)<n}function Lh(e,t,n){let r,s,i;for(r=0,s=e.length;r<s;r++)i=e[r][n],isNaN(i)||(t.min=Math.min(t.min,i),t.max=Math.max(t.max,i))}function Mh(e){return e*(Sh/180)}function Fh(e){return e*(180/Sh)}function Bh(e){if(!sh(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function Uh(e,t){const n=t.x-e.x,r=t.y-e.y,s=Math.sqrt(n*n+r*r);let i=Math.atan2(r,n);return i<-.5*Sh&&(i+=Ah),{angle:i,distance:s}}function zh(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function qh(e,t){return(e-t+_h)%Ah-Sh}function Hh(e){return(e%Ah+Ah)%Ah}function Vh(e,t,n,r){const s=Hh(e),i=Hh(t),a=Hh(n),o=Hh(i-s),l=Hh(a-s),c=Hh(s-i),d=Hh(s-a);return s===i||s===a||r&&i===a||o>l&&c<d}function Wh(e,t,n){return Math.max(t,Math.min(n,e))}function Gh(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return e>=Math.min(t,n)-r&&e<=Math.max(t,n)+r}function Yh(e,t,n){n=n||(n=>e[n]<t);let r,s=e.length-1,i=0;for(;s-i>1;)r=i+s>>1,n(r)?i=r:s=r;return{lo:i,hi:s}}const Xh=(e,t,n,r)=>Yh(e,n,r?r=>e[r][t]<=n:r=>e[r][t]<n),Qh=(e,t,n)=>Yh(e,n,r=>e[r][t]>=n);const Kh=["push","pop","shift","splice","unshift"];function Zh(e,t){const n=e._chartjs;if(!n)return;const r=n.listeners,s=r.indexOf(t);-1!==s&&r.splice(s,1),r.length>0||(Kh.forEach(t=>{delete e[t]}),delete e._chartjs)}function Jh(e){const t=new Set;let n,r;for(n=0,r=e.length;n<r;++n)t.add(e[n]);return t.size===r?e:Array.from(t)}const $h="undefined"===typeof window?function(e){return e()}:window.requestAnimationFrame;function em(e,t,n){const r=n||(e=>Array.prototype.slice.call(e));let s=!1,i=[];return function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];i=r(a),s||(s=!0,$h.call(window,()=>{s=!1,e.apply(t,i)}))}}const tm=e=>"start"===e?"left":"end"===e?"right":"center",nm=(e,t,n)=>"start"===e?t:"end"===e?n:(t+n)/2;function rm(e,t,n){const r=t.length;let s=0,i=r;if(e._sorted){const{iScale:a,_parsed:o}=e,l=a.axis,{min:c,max:d,minDefined:u,maxDefined:h}=a.getUserBounds();u&&(s=Wh(Math.min(Xh(o,a.axis,c).lo,n?r:Xh(t,l,a.getPixelForValue(c)).lo),0,r-1)),i=h?Wh(Math.max(Xh(o,a.axis,d,!0).hi+1,n?0:Xh(t,l,a.getPixelForValue(d),!0).hi+1),s,r)-s:r-s}return{start:s,count:i}}function sm(e){const{xScale:t,yScale:n,_scaleRanges:r}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!r)return e._scaleRanges=s,!0;const i=r.xmin!==t.min||r.xmax!==t.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,s),i}const im=e=>0===e||1===e,am=(e,t,n)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*Ah/n),om=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*Ah/n)+1,lm={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*Eh),easeOutSine:e=>Math.sin(e*Eh),easeInOutSine:e=>-.5*(Math.cos(Sh*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>im(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>im(e)?e:am(e,.075,.3),easeOutElastic:e=>im(e)?e:om(e,.075,.3),easeInOutElastic(e){const t=.1125;return im(e)?e:e<.5?.5*am(2*e,t,.45):.5+.5*om(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-lm.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInOutBounce:e=>e<.5?.5*lm.easeInBounce(2*e):.5*lm.easeOutBounce(2*e-1)+.5};function cm(e){return e+.5|0}const dm=(e,t,n)=>Math.max(Math.min(e,n),t);function um(e){return dm(cm(2.55*e),0,255)}function hm(e){return dm(cm(255*e),0,255)}function mm(e){return dm(cm(e/2.55)/100,0,1)}function fm(e){return dm(cm(100*e),0,100)}const pm={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},gm=[..."0123456789ABCDEF"],xm=e=>gm[15&e],ym=e=>gm[(240&e)>>4]+gm[15&e],bm=e=>(240&e)>>4===(15&e);function wm(e){var t=(e=>bm(e.r)&&bm(e.g)&&bm(e.b)&&bm(e.a))(e)?xm:ym;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const vm=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Nm(e,t,n){const r=t*Math.min(n,1-n),s=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t+e/30)%12;return n-r*Math.max(Math.min(s-3,9-s,1),-1)};return[s(0),s(8),s(4)]}function Sm(e,t,n){const r=function(r){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(r+e/60)%6;return n-n*t*Math.max(Math.min(s,4-s,1),0)};return[r(5),r(3),r(1)]}function Am(e,t,n){const r=Nm(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)r[s]*=1-t-n,r[s]+=t;return r}function _m(e){const t=e.r/255,n=e.g/255,r=e.b/255,s=Math.max(t,n,r),i=Math.min(t,n,r),a=(s+i)/2;let o,l,c;return s!==i&&(c=s-i,l=a>.5?c/(2-s-i):c/(s+i),o=function(e,t,n,r,s){return e===s?(t-n)/r+(t<n?6:0):t===s?(n-e)/r+2:(e-t)/r+4}(t,n,r,c,s),o=60*o+.5),[0|o,l||0,a]}function Cm(e,t,n,r){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,r)).map(hm)}function Im(e,t,n){return Cm(Nm,e,t,n)}function Em(e){return(e%360+360)%360}function Tm(e){const t=vm.exec(e);let n,r=255;if(!t)return;t[5]!==n&&(r=t[6]?um(+t[5]):hm(+t[5]));const s=Em(+t[2]),i=+t[3]/100,a=+t[4]/100;return n="hwb"===t[1]?function(e,t,n){return Cm(Am,e,t,n)}(s,i,a):"hsv"===t[1]?function(e,t,n){return Cm(Sm,e,t,n)}(s,i,a):Im(s,i,a),{r:n[0],g:n[1],b:n[2],a:r}}const jm={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},km={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Dm;function Pm(e){Dm||(Dm=function(){const e={},t=Object.keys(km),n=Object.keys(jm);let r,s,i,a,o;for(r=0;r<t.length;r++){for(a=o=t[r],s=0;s<n.length;s++)i=n[s],o=o.replace(i,jm[i]);i=parseInt(km[a],16),e[o]=[i>>16&255,i>>8&255,255&i]}return e}(),Dm.transparent=[0,0,0,0]);const t=Dm[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const Rm=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Om=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,Lm=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Mm(e,t,n){if(e){let r=_m(e);r[t]=Math.max(0,Math.min(r[t]+r[t]*n,0===t?360:1)),r=Im(r),e.r=r[0],e.g=r[1],e.b=r[2]}}function Fm(e,t){return e?Object.assign(t||{},e):e}function Bm(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=hm(e[3]))):(t=Fm(e,{r:0,g:0,b:0,a:1})).a=hm(t.a),t}function Um(e){return"r"===e.charAt(0)?function(e){const t=Rm.exec(e);let n,r,s,i=255;if(t){if(t[7]!==n){const e=+t[7];i=t[8]?um(e):dm(255*e,0,255)}return n=+t[1],r=+t[3],s=+t[5],n=255&(t[2]?um(n):dm(n,0,255)),r=255&(t[4]?um(r):dm(r,0,255)),s=255&(t[6]?um(s):dm(s,0,255)),{r:n,g:r,b:s,a:i}}}(e):Tm(e)}class zm{constructor(e){if(e instanceof zm)return e;const t=typeof e;let n;"object"===t?n=Bm(e):"string"===t&&(n=function(e){var t,n=e.length;return"#"===e[0]&&(4===n||5===n?t={r:255&17*pm[e[1]],g:255&17*pm[e[2]],b:255&17*pm[e[3]],a:5===n?17*pm[e[4]]:255}:7!==n&&9!==n||(t={r:pm[e[1]]<<4|pm[e[2]],g:pm[e[3]]<<4|pm[e[4]],b:pm[e[5]]<<4|pm[e[6]],a:9===n?pm[e[7]]<<4|pm[e[8]]:255})),t}(e)||Pm(e)||Um(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=Fm(this._rgb);return e&&(e.a=mm(e.a)),e}set rgb(e){this._rgb=Bm(e)}rgbString(){return this._valid?function(e){return e&&(e.a<255?"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(mm(e.a),")"):"rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")"))}(this._rgb):void 0}hexString(){return this._valid?wm(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=_m(e),n=t[0],r=fm(t[1]),s=fm(t[2]);return e.a<255?"hsla(".concat(n,", ").concat(r,"%, ").concat(s,"%, ").concat(mm(e.a),")"):"hsl(".concat(n,", ").concat(r,"%, ").concat(s,"%)")}(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,r=e.rgb;let s;const i=t===s?.5:t,a=2*i-1,o=n.a-r.a,l=((a*o===-1?a:(a+o)/(1+a*o))+1)/2;s=1-l,n.r=255&l*n.r+s*r.r+.5,n.g=255&l*n.g+s*r.g+.5,n.b=255&l*n.b+s*r.b+.5,n.a=i*n.a+(1-i)*r.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,n){const r=Lm(mm(e.r)),s=Lm(mm(e.g)),i=Lm(mm(e.b));return{r:hm(Om(r+n*(Lm(mm(t.r))-r))),g:hm(Om(s+n*(Lm(mm(t.g))-s))),b:hm(Om(i+n*(Lm(mm(t.b))-i))),a:e.a+n*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new zm(this.rgb)}alpha(e){return this._rgb.a=hm(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=cm(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Mm(this._rgb,2,e),this}darken(e){return Mm(this._rgb,2,-e),this}saturate(e){return Mm(this._rgb,1,e),this}desaturate(e){return Mm(this._rgb,1,-e),this}rotate(e){return function(e,t){var n=_m(e);n[0]=Em(n[0]+t),n=Im(n),e.r=n[0],e.g=n[1],e.b=n[2]}(this._rgb,e),this}}function qm(e){return new zm(e)}function Hm(e){if(e&&"object"===typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function Vm(e){return Hm(e)?e:qm(e)}function Wm(e){return Hm(e)?e:qm(e).saturate(.5).darken(.1).hexString()}const Gm=Object.create(null),Ym=Object.create(null);function Xm(e,t){if(!t)return e;const n=t.split(".");for(let r=0,s=n.length;r<s;++r){const t=n[r];e=e[t]||(e[t]=Object.create(null))}return e}function Qm(e,t,n){return"string"===typeof t?fh(Xm(e,t),n):fh(Xm(e,""),t)}var Km=new class{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>Wm(t.backgroundColor),this.hoverBorderColor=(e,t)=>Wm(t.borderColor),this.hoverColor=(e,t)=>Wm(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,t){return Qm(this,e,t)}get(e){return Xm(this,e)}describe(e,t){return Qm(Ym,e,t)}override(e,t){return Qm(Gm,e,t)}route(e,t,n,r){const s=Xm(this,e),i=Xm(this,n),a="_"+t;Object.defineProperties(s,{[a]:{value:s[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[a],t=i[r];return rh(e)?Object.assign({},t,e):ah(e,t)},set(e){this[a]=e}}})}}({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function Zm(e,t,n,r,s){let i=t[s];return i||(i=t[s]=e.measureText(s).width,n.push(s)),i>r&&(r=i),r}function Jm(e,t,n,r){let s=(r=r||{}).data=r.data||{},i=r.garbageCollect=r.garbageCollect||[];r.font!==t&&(s=r.data={},i=r.garbageCollect=[],r.font=t),e.save(),e.font=t;let a=0;const o=n.length;let l,c,d,u,h;for(l=0;l<o;l++)if(u=n[l],void 0!==u&&null!==u&&!0!==nh(u))a=Zm(e,s,i,a,u);else if(nh(u))for(c=0,d=u.length;c<d;c++)h=u[c],void 0===h||null===h||nh(h)||(a=Zm(e,s,i,a,h));e.restore();const m=i.length/2;if(m>n.length){for(l=0;l<m;l++)delete s[i[l]];i.splice(0,m)}return a}function $m(e,t,n){const r=e.currentDevicePixelRatio,s=0!==n?Math.max(n/2,.5):0;return Math.round((t-s)*r)/r+s}function ef(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function tf(e,t,n,r){nf(e,t,n,r,null)}function nf(e,t,n,r,s){let i,a,o,l,c,d;const u=t.pointStyle,h=t.rotation,m=t.radius;let f=(h||0)*Ih;if(u&&"object"===typeof u&&(i=u.toString(),"[object HTMLImageElement]"===i||"[object HTMLCanvasElement]"===i))return e.save(),e.translate(n,r),e.rotate(f),e.drawImage(u,-u.width/2,-u.height/2,u.width,u.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),u){default:s?e.ellipse(n,r,s/2,m,0,0,Ah):e.arc(n,r,m,0,Ah),e.closePath();break;case"triangle":e.moveTo(n+Math.sin(f)*m,r-Math.cos(f)*m),f+=jh,e.lineTo(n+Math.sin(f)*m,r-Math.cos(f)*m),f+=jh,e.lineTo(n+Math.sin(f)*m,r-Math.cos(f)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,a=Math.cos(f+Th)*l,o=Math.sin(f+Th)*l,e.arc(n-a,r-o,c,f-Sh,f-Eh),e.arc(n+o,r-a,c,f-Eh,f),e.arc(n+a,r+o,c,f,f+Eh),e.arc(n-o,r+a,c,f+Eh,f+Sh),e.closePath();break;case"rect":if(!h){l=Math.SQRT1_2*m,d=s?s/2:l,e.rect(n-d,r-l,2*d,2*l);break}f+=Th;case"rectRot":a=Math.cos(f)*m,o=Math.sin(f)*m,e.moveTo(n-a,r-o),e.lineTo(n+o,r-a),e.lineTo(n+a,r+o),e.lineTo(n-o,r+a),e.closePath();break;case"crossRot":f+=Th;case"cross":a=Math.cos(f)*m,o=Math.sin(f)*m,e.moveTo(n-a,r-o),e.lineTo(n+a,r+o),e.moveTo(n+o,r-a),e.lineTo(n-o,r+a);break;case"star":a=Math.cos(f)*m,o=Math.sin(f)*m,e.moveTo(n-a,r-o),e.lineTo(n+a,r+o),e.moveTo(n+o,r-a),e.lineTo(n-o,r+a),f+=Th,a=Math.cos(f)*m,o=Math.sin(f)*m,e.moveTo(n-a,r-o),e.lineTo(n+a,r+o),e.moveTo(n+o,r-a),e.lineTo(n-o,r+a);break;case"line":a=s?s/2:Math.cos(f)*m,o=Math.sin(f)*m,e.moveTo(n-a,r-o),e.lineTo(n+a,r+o);break;case"dash":e.moveTo(n,r),e.lineTo(n+Math.cos(f)*m,r+Math.sin(f)*m)}e.fill(),t.borderWidth>0&&e.stroke()}}function rf(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function sf(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function af(e){e.restore()}function of(e,t,n,r,s){if(!t)return e.lineTo(n.x,n.y);if("middle"===s){const r=(t.x+n.x)/2;e.lineTo(r,t.y),e.lineTo(r,n.y)}else"after"===s!==!!r?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function lf(e,t,n,r){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(r?t.cp1x:t.cp2x,r?t.cp1y:t.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function cf(e,t,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=nh(t)?t:[t],o=i.strokeWidth>0&&""!==i.strokeColor;let l,c;for(e.save(),e.font=s.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]);th(t.rotation)||e.rotate(t.rotation);t.color&&(e.fillStyle=t.color);t.textAlign&&(e.textAlign=t.textAlign);t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,i),l=0;l<a.length;++l)c=a[l],o&&(i.strokeColor&&(e.strokeStyle=i.strokeColor),th(i.strokeWidth)||(e.lineWidth=i.strokeWidth),e.strokeText(c,n,r,i.maxWidth)),e.fillText(c,n,r,i.maxWidth),df(e,n,r,c,i),r+=s.lineHeight;e.restore()}function df(e,t,n,r,s){if(s.strikethrough||s.underline){const i=e.measureText(r),a=t-i.actualBoundingBoxLeft,o=t+i.actualBoundingBoxRight,l=n-i.actualBoundingBoxAscent,c=n+i.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(a,d),e.lineTo(o,d),e.stroke()}}function uf(e,t){const{x:n,y:r,w:s,h:i,radius:a}=t;e.arc(n+a.topLeft,r+a.topLeft,a.topLeft,-Eh,Sh,!0),e.lineTo(n,r+i-a.bottomLeft),e.arc(n+a.bottomLeft,r+i-a.bottomLeft,a.bottomLeft,Sh,Eh,!0),e.lineTo(n+s-a.bottomRight,r+i),e.arc(n+s-a.bottomRight,r+i-a.bottomRight,a.bottomRight,Eh,0,!0),e.lineTo(n+s,r+a.topRight),e.arc(n+s-a.topRight,r+a.topRight,a.topRight,0,-Eh,!0),e.lineTo(n+a.topLeft,r)}const hf=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),mf=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function ff(e,t){const n=(""+e).match(hf);if(!n||"normal"===n[1])return 1.2*t;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100}return t*e}const pf=e=>+e||0;function gf(e,t){const n={},r=rh(t),s=r?Object.keys(t):t,i=rh(e)?r?n=>ah(e[n],e[t[n]]):t=>e[t]:()=>e;for(const a of s)n[a]=pf(i(a));return n}function xf(e){return gf(e,{top:"y",right:"x",bottom:"y",left:"x"})}function yf(e){return gf(e,["topLeft","topRight","bottomLeft","bottomRight"])}function bf(e){const t=xf(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function wf(e,t){e=e||{},t=t||Km.font;let n=ah(e.size,t.size);"string"===typeof n&&(n=parseInt(n,10));let r=ah(e.style,t.style);r&&!(""+r).match(mf)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const s={family:ah(e.family,t.family),lineHeight:ff(ah(e.lineHeight,t.lineHeight),n),size:n,style:r,weight:ah(e.weight,t.weight),string:""};return s.string=function(e){return!e||th(e.size)||th(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(s),s}function vf(e,t,n,r){let s,i,a,o=!0;for(s=0,i=e.length;s<i;++s)if(a=e[s],void 0!==a&&(void 0!==t&&"function"===typeof a&&(a=a(t),o=!1),void 0!==n&&nh(a)&&(a=a[n%a.length],o=!1),void 0!==a))return r&&!o&&(r.cacheable=!1),a}function Nf(e,t){return Object.assign(Object.create(e),t)}function Sf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>e[0];wh(r)||(r=Rf("_fallback",e));const i={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:n,_fallback:r,_getTarget:s,override:s=>Sf([s,...e],t,n,r)};return new Proxy(i,{deleteProperty:(t,n)=>(delete t[n],delete t._keys,delete e[0][n],!0),get:(n,r)=>Ef(n,r,()=>function(e,t,n,r){let s;for(const i of t)if(s=Rf(Cf(i,e),n),wh(s))return If(e,s)?Df(n,r,e,s):s}(r,t,e,n)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>Of(e).includes(t),ownKeys:e=>Of(e),set(e,t,n){const r=e._storage||(e._storage=s());return e[t]=r[t]=n,delete e._keys,!0}})}function Af(e,t,n,r){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:_f(e,r),setContext:t=>Af(e,t,n,r),override:s=>Af(e.override(s),t,n,r)};return new Proxy(s,{deleteProperty:(t,n)=>(delete t[n],delete e[n],!0),get:(e,t,n)=>Ef(e,t,()=>function(e,t,n){const{_proxy:r,_context:s,_subProxy:i,_descriptors:a}=e;let o=r[t];vh(o)&&a.isScriptable(t)&&(o=function(e,t,n,r){const{_proxy:s,_context:i,_subProxy:a,_stack:o}=n;if(o.has(e))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+e);o.add(e),t=t(i,a||r),o.delete(e),If(e,t)&&(t=Df(s._scopes,s,e,t));return t}(t,o,e,n));nh(o)&&o.length&&(o=function(e,t,n,r){const{_proxy:s,_context:i,_subProxy:a,_descriptors:o}=n;if(wh(i.index)&&r(e))t=t[i.index%t.length];else if(rh(t[0])){const n=t,r=s._scopes.filter(e=>e!==n);t=[];for(const l of n){const n=Df(r,s,e,l);t.push(Af(n,i,a&&a[e],o))}}return t}(t,o,e,a.isIndexable));If(t,o)&&(o=Af(o,s,i&&i[t],a));return o}(e,t,n)),getOwnPropertyDescriptor:(t,n)=>t._descriptors.allKeys?Reflect.has(e,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,n),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,n)=>Reflect.has(e,n),ownKeys:()=>Reflect.ownKeys(e),set:(t,n,r)=>(e[n]=r,delete t[n],!0)})}function _f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=t.scriptable,_indexable:r=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:r,isScriptable:vh(n)?n:()=>n,isIndexable:vh(r)?r:()=>r}}const Cf=(e,t)=>e?e+bh(t):t,If=(e,t)=>rh(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function Ef(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const r=n();return e[t]=r,r}function Tf(e,t,n){return vh(e)?e(t,n):e}const jf=(e,t)=>!0===e?t:"string"===typeof e?yh(t,e):void 0;function kf(e,t,n,r,s){for(const i of t){const t=jf(n,i);if(t){e.add(t);const i=Tf(t._fallback,n,s);if(wh(i)&&i!==n&&i!==r)return i}else if(!1===t&&wh(r)&&n!==r)return null}return!1}function Df(e,t,n,r){const s=t._rootScopes,i=Tf(t._fallback,n,r),a=[...e,...s],o=new Set;o.add(r);let l=Pf(o,a,n,i||n,r);return null!==l&&((!wh(i)||i===n||(l=Pf(o,a,i,l,r),null!==l))&&Sf(Array.from(o),[""],s,i,()=>function(e,t,n){const r=e._getTarget();t in r||(r[t]={});const s=r[t];if(nh(s)&&rh(n))return n;return s}(t,n,r)))}function Pf(e,t,n,r,s){for(;n;)n=kf(e,t,n,r,s);return n}function Rf(e,t){for(const n of t){if(!n)continue;const t=n[e];if(wh(t))return t}}function Of(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const n of e)for(const e of Object.keys(n).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}function Lf(e,t,n,r){const{iScale:s}=e,{key:i="r"}=this._parsing,a=new Array(r);let o,l,c,d;for(o=0,l=r;o<l;++o)c=o+n,d=t[c],a[o]={r:s.parse(yh(d,i),c)};return a}const Mf=Number.EPSILON||1e-14,Ff=(e,t)=>t<e.length&&!e[t].skip&&e[t],Bf=e=>"x"===e?"y":"x";function Uf(e,t,n,r){const s=e.skip?t:e,i=t,a=n.skip?t:n,o=zh(i,s),l=zh(a,i);let c=o/(o+l),d=l/(o+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=r*c,h=r*d;return{previous:{x:i.x-u*(a.x-s.x),y:i.y-u*(a.y-s.y)},next:{x:i.x+h*(a.x-s.x),y:i.y+h*(a.y-s.y)}}}function zf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=Bf(t),r=e.length,s=Array(r).fill(0),i=Array(r);let a,o,l,c=Ff(e,0);for(a=0;a<r;++a)if(o=l,l=c,c=Ff(e,a+1),l){if(c){const e=c[t]-l[t];s[a]=0!==e?(c[n]-l[n])/e:0}i[a]=o?c?Dh(s[a-1])!==Dh(s[a])?0:(s[a-1]+s[a])/2:s[a-1]:s[a]}!function(e,t,n){const r=e.length;let s,i,a,o,l,c=Ff(e,0);for(let d=0;d<r-1;++d)l=c,c=Ff(e,d+1),l&&c&&(Oh(t[d],0,Mf)?n[d]=n[d+1]=0:(s=n[d]/t[d],i=n[d+1]/t[d],o=Math.pow(s,2)+Math.pow(i,2),o<=9||(a=3/Math.sqrt(o),n[d]=s*a*t[d],n[d+1]=i*a*t[d])))}(e,s,i),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const r=Bf(n),s=e.length;let i,a,o,l=Ff(e,0);for(let c=0;c<s;++c){if(a=o,o=l,l=Ff(e,c+1),!o)continue;const s=o[n],d=o[r];a&&(i=(s-a[n])/3,o["cp1".concat(n)]=s-i,o["cp1".concat(r)]=d-i*t[c]),l&&(i=(l[n]-s)/3,o["cp2".concat(n)]=s+i,o["cp2".concat(r)]=d+i*t[c])}}(e,i,t)}function qf(e,t,n){return Math.max(Math.min(e,n),t)}function Hf(e,t,n,r,s){let i,a,o,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)zf(e,s);else{let n=r?e[e.length-1]:e[0];for(i=0,a=e.length;i<a;++i)o=e[i],l=Uf(n,o,e[Math.min(i+1,a-(r?0:1))%a],t.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,n=o}t.capBezierPoints&&function(e,t){let n,r,s,i,a,o=rf(e[0],t);for(n=0,r=e.length;n<r;++n)a=i,i=o,o=n<r-1&&rf(e[n+1],t),i&&(s=e[n],a&&(s.cp1x=qf(s.cp1x,t.left,t.right),s.cp1y=qf(s.cp1y,t.top,t.bottom)),o&&(s.cp2x=qf(s.cp2x,t.left,t.right),s.cp2y=qf(s.cp2y,t.top,t.bottom)))}(e,n)}function Vf(){return"undefined"!==typeof window&&"undefined"!==typeof document}function Wf(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function Gf(e,t,n){let r;return"string"===typeof e?(r=parseInt(e,10),-1!==e.indexOf("%")&&(r=r/100*t.parentNode[n])):r=e,r}const Yf=e=>window.getComputedStyle(e,null);const Xf=["top","right","bottom","left"];function Qf(e,t,n){const r={};n=n?"-"+n:"";for(let s=0;s<4;s++){const i=Xf[s];r[i]=parseFloat(e[t+"-"+i+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function Kf(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:r}=t,s=Yf(n),i="border-box"===s.boxSizing,a=Qf(s,"padding"),o=Qf(s,"border","width"),{x:l,y:c,box:d}=function(e,t){const n=e.touches,r=n&&n.length?n[0]:e,{offsetX:s,offsetY:i}=r;let a,o,l=!1;if(((e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot))(s,i,e.target))a=s,o=i;else{const e=t.getBoundingClientRect();a=r.clientX-e.left,o=r.clientY-e.top,l=!0}return{x:a,y:o,box:l}}(e,n),u=a.left+(d&&o.left),h=a.top+(d&&o.top);let{width:m,height:f}=t;return i&&(m-=a.width+o.width,f-=a.height+o.height),{x:Math.round((l-u)/m*n.width/r),y:Math.round((c-h)/f*n.height/r)}}const Zf=e=>Math.round(10*e)/10;function Jf(e,t,n,r){const s=Yf(e),i=Qf(s,"margin"),a=Gf(s.maxWidth,e,"clientWidth")||Ch,o=Gf(s.maxHeight,e,"clientHeight")||Ch,l=function(e,t,n){let r,s;if(void 0===t||void 0===n){const i=Wf(e);if(i){const e=i.getBoundingClientRect(),a=Yf(i),o=Qf(a,"border","width"),l=Qf(a,"padding");t=e.width-l.width-o.width,n=e.height-l.height-o.height,r=Gf(a.maxWidth,i,"clientWidth"),s=Gf(a.maxHeight,i,"clientHeight")}else t=e.clientWidth,n=e.clientHeight}return{width:t,height:n,maxWidth:r||Ch,maxHeight:s||Ch}}(e,t,n);let{width:c,height:d}=l;if("content-box"===s.boxSizing){const e=Qf(s,"border","width"),t=Qf(s,"padding");c-=t.width+e.width,d-=t.height+e.height}return c=Math.max(0,c-i.width),d=Math.max(0,r?Math.floor(c/r):d-i.height),c=Zf(Math.min(c,a,l.maxWidth)),d=Zf(Math.min(d,o,l.maxHeight)),c&&!d&&(d=Zf(c/2)),{width:c,height:d}}function $f(e,t,n){const r=t||1,s=Math.floor(e.height*r),i=Math.floor(e.width*r);e.height=s/r,e.width=i/r;const a=e.canvas;return a.style&&(n||!a.style.height&&!a.style.width)&&(a.style.height="".concat(e.height,"px"),a.style.width="".concat(e.width,"px")),(e.currentDevicePixelRatio!==r||a.height!==s||a.width!==i)&&(e.currentDevicePixelRatio=r,a.height=s,a.width=i,e.ctx.setTransform(r,0,0,r,0,0),!0)}const ep=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(qb){}return e}();function tp(e,t){const n=function(e,t){return Yf(e).getPropertyValue(t)}(e,t),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function np(e,t,n,r){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function rp(e,t,n,r){return{x:e.x+n*(t.x-e.x),y:"middle"===r?n<.5?e.y:t.y:"after"===r?n<1?e.y:t.y:n>0?t.y:e.y}}function sp(e,t,n,r){const s={x:e.cp2x,y:e.cp2y},i={x:t.cp1x,y:t.cp1y},a=np(e,s,n),o=np(s,i,n),l=np(i,t,n),c=np(a,o,n),d=np(o,l,n);return np(c,d,n)}const ip=new Map;function ap(e,t,n){return function(e,t){t=t||{};const n=e+JSON.stringify(t);let r=ip.get(n);return r||(r=new Intl.NumberFormat(e,t),ip.set(n,r)),r}(t,n).format(e)}function op(e,t,n){return e?function(e,t){return{x:n=>e+e+t-n,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,n):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function lp(e,t){let n,r;"ltr"!==t&&"rtl"!==t||(n=e.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=r)}function cp(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function dp(e){return"angle"===e?{between:Vh,compare:qh,normalize:Hh}:{between:Gh,compare:(e,t)=>e-t,normalize:e=>e}}function up(e){let{start:t,end:n,count:r,loop:s,style:i}=e;return{start:t%r,end:n%r,loop:s&&(n-t+1)%r===0,style:i}}function hp(e,t,n){if(!n)return[e];const{property:r,start:s,end:i}=n,a=t.length,{compare:o,between:l,normalize:c}=dp(r),{start:d,end:u,loop:h,style:m}=function(e,t,n){const{property:r,start:s,end:i}=n,{between:a,normalize:o}=dp(r),l=t.length;let c,d,{start:u,end:h,loop:m}=e;if(m){for(u+=l,h+=l,c=0,d=l;c<d&&a(o(t[u%l][r]),s,i);++c)u--,h--;u%=l,h%=l}return h<u&&(h+=l),{start:u,end:h,loop:m,style:e.style}}(e,t,n),f=[];let p,g,x,y=!1,b=null;const w=()=>y||l(s,x,p)&&0!==o(s,x),v=()=>!y||0===o(i,p)||l(i,x,p);for(let N=d,S=d;N<=u;++N)g=t[N%a],g.skip||(p=c(g[r]),p!==x&&(y=l(p,s,i),null===b&&w()&&(b=0===o(p,s)?N:S),null!==b&&v()&&(f.push(up({start:b,end:N,loop:h,count:a,style:m})),b=null),S=N,x=p));return null!==b&&f.push(up({start:b,end:u,loop:h,count:a,style:m})),f}function mp(e,t){const n=[],r=e.segments;for(let s=0;s<r.length;s++){const i=hp(r[s],e.points,t);i.length&&n.push(...i)}return n}function fp(e,t,n,r){return r&&r.setContext&&n?function(e,t,n,r){const s=e._chart.getContext(),i=pp(e.options),{_datasetIndex:a,options:{spanGaps:o}}=e,l=n.length,c=[];let d=i,u=t[0].start,h=u;function m(e,t,r,s){const i=o?-1:1;if(e!==t){for(e+=l;n[e%l].skip;)e-=i;for(;n[t%l].skip;)t+=i;e%l!==t%l&&(c.push({start:e%l,end:t%l,loop:r,style:s}),d=s,u=t%l)}}for(const f of t){u=o?u:f.start;let e,t=n[u%l];for(h=u+1;h<=f.end;h++){const i=n[h%l];e=pp(r.setContext(Nf(s,{type:"segment",p0:t,p1:i,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),gp(e,d)&&m(u,h-1,f.loop,d),t=i,d=e}u<h-1&&m(u,h-1,f.loop,d)}return c}(e,t,n,r):t}function pp(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function gp(e,t){return t&&JSON.stringify(e)!==JSON.stringify(t)}var xp=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,r){const s=t.listeners[r],i=t.duration;s.forEach(r=>r({chart:e,initial:t.initial,numSteps:i,currentStep:Math.min(n-t.start,i)}))}_refresh(){this._request||(this._running=!0,this._request=$h.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=0;this._charts.forEach((n,r)=>{if(!n.running||!n.items.length)return;const s=n.items;let i,a=s.length-1,o=!1;for(;a>=0;--a)i=s[a],i._active?(i._total>n.duration&&(n.duration=i._total),i.tick(e),o=!0):(s[a]=s[s.length-1],s.pop());o&&(r.draw(),this._notify(r,n,e,"progress")),s.length||(n.running=!1,this._notify(r,n,e,"complete"),n.initial=!1),t+=s.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let r=n.length-1;for(;r>=0;--r)n[r].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}};const yp="transparent",bp={boolean:(e,t,n)=>n>.5?t:e,color(e,t,n){const r=Vm(e||yp),s=r.valid&&Vm(t||yp);return s&&s.valid?s.mix(r,n).hexString():t},number:(e,t,n)=>e+(t-e)*n};class wp{constructor(e,t,n,r){const s=t[n];r=vf([e.to,r,s,e.from]);const i=vf([e.from,s,r]);this._active=!0,this._fn=e.fn||bp[e.type||typeof i],this._easing=lm[e.easing]||lm.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=i,this._to=r,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const r=this._target[this._prop],s=n-this._start,i=this._duration-s;this._start=n,this._duration=Math.floor(Math.max(i,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=vf([e.to,t,r,e.from]),this._from=vf([e.from,r,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,r=this._prop,s=this._from,i=this._loop,a=this._to;let o;if(this._active=s!==a&&(i||t<n),!this._active)return this._target[r]=a,void this._notify(!0);t<0?this._target[r]=s:(o=t/n%2,o=i&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[r]=this._fn(s,a,o))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let r=0;r<n.length;r++)n[r][t]()}}Km.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const vp=Object.keys(Km.animation);Km.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),Km.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),Km.describe("animations",{_fallback:"animation"}),Km.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}});class Np{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!rh(e))return;const t=this._properties;Object.getOwnPropertyNames(e).forEach(n=>{const r=e[n];if(!rh(r))return;const s={};for(const e of vp)s[e]=r[e];(nh(r.properties)&&r.properties||[n]).forEach(e=>{e!==n&&t.has(e)||t.set(e,s)})})}_animateOptions(e,t){const n=t.options,r=function(e,t){if(!t)return;let n=e.options;if(!n)return void(e.options=t);n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(e,n);if(!r)return[];const s=this._createAnimations(r,n);return n.$shared&&function(e,t){const n=[],r=Object.keys(t);for(let s=0;s<r.length;s++){const t=e[r[s]];t&&t.active()&&n.push(t.wait())}return Promise.all(n)}(e.options.$animations,n).then(()=>{e.options=n},()=>{}),s}_createAnimations(e,t){const n=this._properties,r=[],s=e.$animations||(e.$animations={}),i=Object.keys(t),a=Date.now();let o;for(o=i.length-1;o>=0;--o){const l=i[o];if("$"===l.charAt(0))continue;if("options"===l){r.push(...this._animateOptions(e,t));continue}const c=t[l];let d=s[l];const u=n.get(l);if(d){if(u&&d.active()){d.update(u,c,a);continue}d.cancel()}u&&u.duration?(s[l]=d=new wp(u,e,l,c),r.push(d)):e[l]=c}return r}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const n=this._createAnimations(e,t);return n.length?(xp.add(this._chart,n),!0):void 0}}function Sp(e,t){const n=e&&e.options||{},r=n.reverse,s=void 0===n.min?t:0,i=void 0===n.max?t:0;return{start:r?i:s,end:r?s:i}}function Ap(e,t){const n=[],r=e._getSortedDatasetMetas(t);let s,i;for(s=0,i=r.length;s<i;++s)n.push(r[s].index);return n}function _p(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=e.keys,i="single"===r.mode;let a,o,l,c;if(null!==t){for(a=0,o=s.length;a<o;++a){if(l=+s[a],l===n){if(r.all)continue;break}c=e.values[l],sh(c)&&(i||0===t||Dh(t)===Dh(c))&&(t+=c)}return t}}function Cp(e,t){const n=e&&e.options.stacked;return n||void 0===n&&void 0!==t.stack}function Ip(e,t,n){const r=e[t]||(e[t]={});return r[n]||(r[n]={})}function Ep(e,t,n,r){for(const s of t.getMatchingVisibleMetas(r).reverse()){const t=e[s.index];if(n&&t>0||!n&&t<0)return s.index}return null}function Tp(e,t){const{chart:n,_cachedMeta:r}=e,s=n._stacks||(n._stacks={}),{iScale:i,vScale:a,index:o}=r,l=i.axis,c=a.axis,d=function(e,t,n){return"".concat(e.id,".").concat(t.id,".").concat(n.stack||n.type)}(i,a,r),u=t.length;let h;for(let m=0;m<u;++m){const e=t[m],{[l]:n,[c]:i}=e;h=(e._stacks||(e._stacks={}))[c]=Ip(s,d,n),h[o]=i,h._top=Ep(h,a,!0,r.type),h._bottom=Ep(h,a,!1,r.type)}}function jp(e,t){const n=e.scales;return Object.keys(n).filter(e=>n[e].axis===t).shift()}function kp(e,t){const n=e.controller.index,r=e.vScale&&e.vScale.axis;if(r){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[r]||void 0===t[r][n])return;delete t[r][n]}}}const Dp=e=>"reset"===e||"none"===e,Pp=(e,t)=>t?e:Object.assign({},e);class Rp{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Cp(e.vScale,e),this.addElements()}updateIndex(e){this.index!==e&&kp(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),r=(e,t,n,r)=>"x"===e?t:"r"===e?r:n,s=t.xAxisID=ah(n.xAxisID,jp(e,"x")),i=t.yAxisID=ah(n.yAxisID,jp(e,"y")),a=t.rAxisID=ah(n.rAxisID,jp(e,"r")),o=t.indexAxis,l=t.iAxisID=r(o,s,i,a),c=t.vAxisID=r(o,i,s,a);t.xScale=this.getScaleForId(s),t.yScale=this.getScaleForId(i),t.rScale=this.getScaleForId(a),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&Zh(this._data,this),e._stacked&&kp(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(rh(t))this._data=function(e){const t=Object.keys(e),n=new Array(t.length);let r,s,i;for(r=0,s=t.length;r<s;++r)i=t[r],n[r]={x:i,y:e[i]};return n}(t);else if(n!==t){if(n){Zh(n,this);const e=this._cachedMeta;kp(e),e._parsed=[]}t&&Object.isExtensible(t)&&(s=this,(r=t)._chartjs?r._chartjs.listeners.push(s):(Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),Kh.forEach(e=>{const t="_onData"+bh(e),n=r[e];Object.defineProperty(r,e,{configurable:!0,enumerable:!1,value(){for(var e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];const a=n.apply(this,s);return r._chartjs.listeners.forEach(e=>{"function"===typeof e[t]&&e[t](...s)}),a}})}))),this._syncList=[],this._data=t}var r,s}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let r=!1;this._dataCheck();const s=t._stacked;t._stacked=Cp(t.vScale,t),t.stack!==n.stack&&(r=!0,kp(t),t.stack=n.stack),this._resyncElements(e),(r||s!==t._stacked)&&Tp(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:r}=this,{iScale:s,_stacked:i}=n,a=s.axis;let o,l,c,d=0===e&&t===r.length||n._sorted,u=e>0&&n._parsed[e-1];if(!1===this._parsing)n._parsed=r,n._sorted=!0,c=r;else{c=nh(r[e])?this.parseArrayData(n,r,e,t):rh(r[e])?this.parseObjectData(n,r,e,t):this.parsePrimitiveData(n,r,e,t);const s=()=>null===l[a]||u&&l[a]<u[a];for(o=0;o<t;++o)n._parsed[o+e]=l=c[o],d&&(s()&&(d=!1),u=l);n._sorted=d}i&&Tp(this,c)}parsePrimitiveData(e,t,n,r){const{iScale:s,vScale:i}=e,a=s.axis,o=i.axis,l=s.getLabels(),c=s===i,d=new Array(r);let u,h,m;for(u=0,h=r;u<h;++u)m=u+n,d[u]={[a]:c||s.parse(l[m],m),[o]:i.parse(t[m],m)};return d}parseArrayData(e,t,n,r){const{xScale:s,yScale:i}=e,a=new Array(r);let o,l,c,d;for(o=0,l=r;o<l;++o)c=o+n,d=t[c],a[o]={x:s.parse(d[0],c),y:i.parse(d[1],c)};return a}parseObjectData(e,t,n,r){const{xScale:s,yScale:i}=e,{xAxisKey:a="x",yAxisKey:o="y"}=this._parsing,l=new Array(r);let c,d,u,h;for(c=0,d=r;c<d;++c)u=c+n,h=t[u],l[c]={x:s.parse(yh(h,a),u),y:i.parse(yh(h,o),u)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const r=this.chart,s=this._cachedMeta,i=t[e.axis];return _p({keys:Ap(r,!0),values:t._stacks[e.axis]},i,s.index,{mode:n})}updateRangeFromParsed(e,t,n,r){const s=n[t.axis];let i=null===s?NaN:s;const a=r&&n._stacks[t.axis];r&&a&&(r.values=a,i=_p(r,s,this._cachedMeta.index)),e.min=Math.min(e.min,i),e.max=Math.max(e.max,i)}getMinMax(e,t){const n=this._cachedMeta,r=n._parsed,s=n._sorted&&e===n.iScale,i=r.length,a=this._getOtherScale(e),o=((e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:Ap(n,!0),values:null})(t,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=function(e){const{min:t,max:n,minDefined:r,maxDefined:s}=e.getUserBounds();return{min:r?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}(a);let u,h;function m(){h=r[u];const t=h[a.axis];return!sh(h[e.axis])||c>t||d<t}for(u=0;u<i&&(m()||(this.updateRangeFromParsed(l,e,h,o),!s));++u);if(s)for(u=i-1;u>=0;--u)if(!m()){this.updateRangeFromParsed(l,e,h,o);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let r,s,i;for(r=0,s=t.length;r<s;++r)i=t[r][e.axis],sh(i)&&n.push(i);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,r=t.vScale,s=this.getParsed(e);return{label:n?""+n.getLabelForValue(s[n.axis]):"",value:r?""+r.getLabelForValue(s[r.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,n,r,s;return rh(e)?(t=e.top,n=e.right,r=e.bottom,s=e.left):t=n=r=s=e,{top:t,right:n,bottom:r,left:s,disabled:!1===e}}(ah(this.options.clip,function(e,t,n){if(!1===n)return!1;const r=Sp(e,n),s=Sp(t,n);return{top:s.end,right:r.end,bottom:s.start,left:r.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,r=n.data||[],s=t.chartArea,i=[],a=this._drawStart||0,o=this._drawCount||r.length-a,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(e,s,a,o),c=a;c<a+o;++c){const t=r[c];t.hidden||(t.active&&l?i.push(t):t.draw(e,s))}for(c=0;c<i.length;++c)i[c].draw(e,s)}getStyle(e,t){const n=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const r=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];s=t.$context||(t.$context=function(e,t,n){return Nf(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),s.parsed=this.getParsed(e),s.raw=r.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=function(e,t){return Nf(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=r,s.index=s.datasetIndex=this.index;return s.active=!!t,s.mode=n,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const r="active"===t,s=this._cachedDataOpts,i=e+"-"+t,a=s[i],o=this.enableOptionSharing&&wh(n);if(a)return Pp(a,o);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),d=r?["".concat(e,"Hover"),"hover",e,""]:[e,""],u=l.getOptionScopes(this.getDataset(),c),h=Object.keys(Km.elements[e]),m=l.resolveNamedOptions(u,h,()=>this.getContext(n,r),d);return m.$shared&&(m.$shared=o,s[i]=Object.freeze(Pp(m,o))),m}_resolveAnimations(e,t,n){const r=this.chart,s=this._cachedDataOpts,i="animation-".concat(t),a=s[i];if(a)return a;let o;if(!1!==r.options.animation){const r=this.chart.config,s=r.datasetAnimationScopeKeys(this._type,t),i=r.getOptionScopes(this.getDataset(),s);o=r.createResolver(i,this.getContext(e,n,t))}const l=new Np(r,o&&o.animations);return o&&o._cacheable&&(s[i]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Dp(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),r=this._sharedOptions,s=this.getSharedOptions(n),i=this.includeOptions(t,s)||s!==r;return this.updateSharedOptions(s,t,n),{sharedOptions:s,includeOptions:i}}updateElement(e,t,n,r){Dp(r)?Object.assign(e,n):this._resolveAnimations(t,r).update(e,n)}updateSharedOptions(e,t,n){e&&!Dp(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,r){e.active=r;const s=this.getStyle(t,r);this._resolveAnimations(t,n,r).update(e,{options:!r&&this.getSharedOptions(s)||s})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[a,o,l]of this._syncList)this[a](o,l);this._syncList=[];const r=n.length,s=t.length,i=Math.min(s,r);i&&this.parse(0,i),s>r?this._insertElements(r,s-r,e):s<r&&this._removeElements(s,r-s)}_insertElements(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this._cachedMeta,s=r.data,i=e+t;let a;const o=e=>{for(e.length+=t,a=e.length-1;a>=i;a--)e[a]=e[a-t]};for(o(s),a=e;a<i;++a)s[a]=new this.dataElementType;this._parsing&&o(r._parsed),this.parse(e,t),n&&this.updateElements(s,e,t,"reset")}updateElements(e,t,n,r){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const r=n._parsed.splice(e,t);n._stacked&&kp(n,r)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,r]=e;this[t](n,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Op(e){const t=e.iScale,n=function(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let r=[];for(let t=0,s=n.length;t<s;t++)r=r.concat(n[t].controller.getAllParsedValues(e));e._cache.$bar=Jh(r.sort((e,t)=>e-t))}return e._cache.$bar}(t,e.type);let r,s,i,a,o=t._length;const l=()=>{32767!==i&&-32768!==i&&(wh(a)&&(o=Math.min(o,Math.abs(i-a)||o)),a=i)};for(r=0,s=n.length;r<s;++r)i=t.getPixelForValue(n[r]),l();for(a=void 0,r=0,s=t.ticks.length;r<s;++r)i=t.getPixelForTick(r),l();return o}function Lp(e,t,n,r){return nh(e)?function(e,t,n,r){const s=n.parse(e[0],r),i=n.parse(e[1],r),a=Math.min(s,i),o=Math.max(s,i);let l=a,c=o;Math.abs(a)>Math.abs(o)&&(l=o,c=a),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:i,min:a,max:o}}(e,t,n,r):t[n.axis]=n.parse(e,r),t}function Mp(e,t,n,r){const s=e.iScale,i=e.vScale,a=s.getLabels(),o=s===i,l=[];let c,d,u,h;for(c=n,d=n+r;c<d;++c)h=t[c],u={},u[s.axis]=o||s.parse(a[c],c),l.push(Lp(h,u,i,c));return l}function Fp(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function Bp(e,t,n,r){let s=t.borderSkipped;const i={};if(!s)return void(e.borderSkipped=i);if(!0===s)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:a,end:o,reverse:l,top:c,bottom:d}=function(e){let t,n,r,s,i;return e.horizontal?(t=e.base>e.x,n="left",r="right"):(t=e.base<e.y,n="bottom",r="top"),t?(s="end",i="start"):(s="start",i="end"),{start:n,end:r,reverse:t,top:s,bottom:i}}(e);"middle"===s&&n&&(e.enableBorderRadius=!0,(n._top||0)===r?s=c:(n._bottom||0)===r?s=d:(i[Up(d,a,o,l)]=!0,s=c)),i[Up(s,a,o,l)]=!0,e.borderSkipped=i}function Up(e,t,n,r){var s,i,a;return r?(a=n,e=zp(e=(s=e)===(i=t)?a:s===a?i:s,n,t)):e=zp(e,t,n),e}function zp(e,t,n){return"start"===e?t:"end"===e?n:e}function qp(e,t,n){let{inflateAmount:r}=t;e.inflateAmount="auto"===r?1===n?.33:0:r}Rp.defaults={},Rp.prototype.datasetElementType=null,Rp.prototype.dataElementType=null;class Hp extends Rp{parsePrimitiveData(e,t,n,r){return Mp(e,t,n,r)}parseArrayData(e,t,n,r){return Mp(e,t,n,r)}parseObjectData(e,t,n,r){const{iScale:s,vScale:i}=e,{xAxisKey:a="x",yAxisKey:o="y"}=this._parsing,l="x"===s.axis?a:o,c="x"===i.axis?a:o,d=[];let u,h,m,f;for(u=n,h=n+r;u<h;++u)f=t[u],m={},m[s.axis]=s.parse(yh(f,l),u),d.push(Lp(yh(f,c),m,i,u));return d}updateRangeFromParsed(e,t,n,r){super.updateRangeFromParsed(e,t,n,r);const s=n._custom;s&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:r}=t,s=this.getParsed(e),i=s._custom,a=Fp(i)?"["+i.start+", "+i.end+"]":""+r.getLabelForValue(s[r.axis]);return{label:""+n.getLabelForValue(s[n.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,r){const s="reset"===r,{index:i,_cachedMeta:{vScale:a}}=this,o=a.getBasePixel(),l=a.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:u}=this._getSharedOptions(t,r);for(let h=t;h<t+n;h++){const t=this.getParsed(h),n=s||th(t[a.axis])?{base:o,head:o}:this._calculateBarValuePixels(h),m=this._calculateBarIndexPixels(h,c),f=(t._stacks||{})[a.axis],p={horizontal:l,base:n.base,enableBorderRadius:!f||Fp(t._custom)||i===f._top||i===f._bottom,x:l?n.head:m.center,y:l?m.center:n.head,height:l?m.size:Math.abs(n.size),width:l?Math.abs(n.size):m.size};u&&(p.options=d||this.resolveDataElementOptions(h,e[h].active?"active":r));const g=p.options||e[h].options;Bp(p,g,f,i),qp(p,g,c.ratio),this.updateElement(e[h],h,p,r)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,r=n.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),s=n.options.stacked,i=[],a=e=>{const n=e.controller.getParsed(t),r=n&&n[e.vScale.axis];if(th(r)||isNaN(r))return!0};for(const o of r)if((void 0===t||!a(o))&&((!1===s||-1===i.indexOf(o.stack)||void 0===s&&void 0===o.stack)&&i.push(o.stack),o.index===e))break;return i.length||i.push(void 0),i}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const r=this._getStacks(e,n),s=void 0!==t?r.indexOf(t):-1;return-1===s?r.length-1:s}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,r=[];let s,i;for(s=0,i=t.data.length;s<i;++s)r.push(n.getPixelForValue(this.getParsed(s)[n.axis],s));const a=e.barThickness;return{min:a||Op(t),pixels:r,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n},options:{base:r,minBarLength:s}}=this,i=r||0,a=this.getParsed(e),o=a._custom,l=Fp(o);let c,d,u=a[t.axis],h=0,m=n?this.applyStack(t,a,n):u;m!==u&&(h=m-u,m=u),l&&(u=o.barStart,m=o.barEnd-o.barStart,0!==u&&Dh(u)!==Dh(o.barEnd)&&(h=0),h+=u);const f=th(r)||l?h:r;let p=t.getPixelForValue(f);if(c=this.chart.getDataVisibility(e)?t.getPixelForValue(h+m):p,d=c-p,Math.abs(d)<s){d=function(e,t,n){return 0!==e?Dh(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}(d,t,i)*s,u===i&&(p-=d/2);const e=t.getPixelForDecimal(0),n=t.getPixelForDecimal(1),r=Math.min(e,n),a=Math.max(e,n);p=Math.max(Math.min(p,a),r),c=p+d}if(p===t.getPixelForValue(i)){const e=Dh(d)*t.getLineWidthForValue(i)/2;p+=e,d-=e}return{size:d,base:p,head:c,center:c+d/2}}_calculateBarIndexPixels(e,t){const n=t.scale,r=this.options,s=r.skipNull,i=ah(r.maxBarThickness,1/0);let a,o;if(t.grouped){const n=s?this._getStackCount(e):t.stackCount,l="flex"===r.barThickness?function(e,t,n,r){const s=t.pixels,i=s[e];let a=e>0?s[e-1]:null,o=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;null===a&&(a=i-(null===o?t.end-t.start:o-i)),null===o&&(o=i+i-a);const c=i-(i-Math.min(a,o))/2*l;return{chunk:Math.abs(o-a)/2*l/r,ratio:n.barPercentage,start:c}}(e,t,r,n):function(e,t,n,r){const s=n.barThickness;let i,a;return th(s)?(i=t.min*n.categoryPercentage,a=n.barPercentage):(i=s*r,a=1),{chunk:i/r,ratio:a,start:t.pixels[e]-i/2}}(e,t,r,n),c=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0);a=l.start+l.chunk*c+l.chunk/2,o=Math.min(i,l.chunk*l.ratio)}else a=n.getPixelForValue(this.getParsed(e)[n.axis],e),o=Math.min(i,t.min*t.ratio);return{base:a-o/2,head:a+o/2,center:a,size:o}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,r=n.length;let s=0;for(;s<r;++s)null!==this.getParsed(s)[t.axis]&&n[s].draw(this._ctx)}}Hp.id="bar",Hp.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},Hp.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Vp extends Rp{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,r){const s=super.parsePrimitiveData(e,t,n,r);for(let i=0;i<s.length;i++)s[i]._custom=this.resolveDataElementOptions(i+n).radius;return s}parseArrayData(e,t,n,r){const s=super.parseArrayData(e,t,n,r);for(let i=0;i<s.length;i++){const e=t[n+i];s[i]._custom=ah(e[2],this.resolveDataElementOptions(i+n).radius)}return s}parseObjectData(e,t,n,r){const s=super.parseObjectData(e,t,n,r);for(let i=0;i<s.length;i++){const e=t[n+i];s[i]._custom=ah(e&&e.r&&+e.r,this.resolveDataElementOptions(i+n).radius)}return s}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,{xScale:n,yScale:r}=t,s=this.getParsed(e),i=n.getLabelForValue(s.x),a=r.getLabelForValue(s.y),o=s._custom;return{label:t.label,value:"("+i+", "+a+(o?", "+o:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,r){const s="reset"===r,{iScale:i,vScale:a}=this._cachedMeta,{sharedOptions:o,includeOptions:l}=this._getSharedOptions(t,r),c=i.axis,d=a.axis;for(let u=t;u<t+n;u++){const t=e[u],n=!s&&this.getParsed(u),h={},m=h[c]=s?i.getPixelForDecimal(.5):i.getPixelForValue(n[c]),f=h[d]=s?a.getBasePixel():a.getPixelForValue(n[d]);h.skip=isNaN(m)||isNaN(f),l&&(h.options=o||this.resolveDataElementOptions(u,t.active?"active":r),s&&(h.options.radius=0)),this.updateElement(t,u,h,r)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let r=super.resolveDataElementOptions(e,t);r.$shared&&(r=Object.assign({},r,{$shared:!1}));const s=r.radius;return"active"!==t&&(r.radius=0),r.radius+=ah(n&&n._custom,s),r}}Vp.id="bubble",Vp.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Vp.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class Wp extends Rp{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,r=this._cachedMeta;if(!1===this._parsing)r._parsed=n;else{let s,i,a=e=>+n[e];if(rh(n[e])){const{key:e="value"}=this._parsing;a=t=>+yh(n[t],e)}for(s=e,i=e+t;s<i;++s)r._parsed[s]=a(s)}}_getRotation(){return Mh(this.options.rotation-90)}_getCircumference(){return Mh(this.options.circumference)}_getRotationExtents(){let e=Ah,t=-Ah;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){const r=this.chart.getDatasetMeta(n).controller,s=r._getRotation(),i=r._getCircumference();e=Math.min(e,s),t=Math.max(t,s+i)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,r=this._cachedMeta,s=r.data,i=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,a=Math.max((Math.min(n.width,n.height)-i)/2,0),o=Math.min((l=this.options.cutout,c=a,"string"===typeof l&&l.endsWith("%")?parseFloat(l)/100:l/c),1);var l,c;const d=this._getRingWeight(this.index),{circumference:u,rotation:h}=this._getRotationExtents(),{ratioX:m,ratioY:f,offsetX:p,offsetY:g}=function(e,t,n){let r=1,s=1,i=0,a=0;if(t<Ah){const o=e,l=o+t,c=Math.cos(o),d=Math.sin(o),u=Math.cos(l),h=Math.sin(l),m=(e,t,r)=>Vh(e,o,l,!0)?1:Math.max(t,t*n,r,r*n),f=(e,t,r)=>Vh(e,o,l,!0)?-1:Math.min(t,t*n,r,r*n),p=m(0,c,u),g=m(Eh,d,h),x=f(Sh,c,u),y=f(Sh+Eh,d,h);r=(p-x)/2,s=(g-y)/2,i=-(p+x)/2,a=-(g+y)/2}return{ratioX:r,ratioY:s,offsetX:i,offsetY:a}}(h,u,o),x=(n.width-i)/m,y=(n.height-i)/f,b=Math.max(Math.min(x,y)/2,0),w=oh(this.options.radius,b),v=(w-Math.max(w*o,0))/this._getVisibleDatasetWeightTotal();this.offsetX=p*w,this.offsetY=g*w,r.total=this.calculateTotal(),this.outerRadius=w-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*d,0),this.updateElements(s,0,s.length,e)}_circumference(e,t){const n=this.options,r=this._cachedMeta,s=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||null===r._parsed[e]||r.data[e].hidden?0:this.calculateCircumference(r._parsed[e]*s/Ah)}updateElements(e,t,n,r){const s="reset"===r,i=this.chart,a=i.chartArea,o=i.options.animation,l=(a.left+a.right)/2,c=(a.top+a.bottom)/2,d=s&&o.animateScale,u=d?0:this.innerRadius,h=d?0:this.outerRadius,{sharedOptions:m,includeOptions:f}=this._getSharedOptions(t,r);let p,g=this._getRotation();for(p=0;p<t;++p)g+=this._circumference(p,s);for(p=t;p<t+n;++p){const t=this._circumference(p,s),n=e[p],i={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:h,innerRadius:u};f&&(i.options=m||this.resolveDataElementOptions(p,n.active?"active":r)),g+=t,this.updateElement(n,p,i,r)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n,r=0;for(n=0;n<t.length;n++){const s=e._parsed[n];null===s||isNaN(s)||!this.chart.getDataVisibility(n)||t[n].hidden||(r+=Math.abs(s))}return r}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?Ah*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,r=n.data.labels||[],s=ap(t._parsed[e],n.options.locale);return{label:r[e]||"",value:s}}getMaxBorderWidth(e){let t=0;const n=this.chart;let r,s,i,a,o;if(!e)for(r=0,s=n.data.datasets.length;r<s;++r)if(n.isDatasetVisible(r)){i=n.getDatasetMeta(r),e=i.data,a=i.controller;break}if(!e)return 0;for(r=0,s=e.length;r<s;++r)o=a.resolveDataElementOptions(r),"inner"!==o.borderAlign&&(t=Math.max(t,o.borderWidth||0,o.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,r=e.length;n<r;++n){const e=this.resolveDataElementOptions(n);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(ah(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Wp.id="doughnut",Wp.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},Wp.descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e},Wp.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n}}=e.legend.options;return t.labels.map((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label(e){let t=e.label;const n=": "+e.formattedValue;return nh(t)?(t=t.slice(),t[0]+=n):t+=n,t}}}}};class Gp extends Rp{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:r=[],_dataset:s}=t,i=this.chart._animationsDisabled;let{start:a,count:o}=rm(t,r,i);this._drawStart=a,this._drawCount=o,sm(t)&&(a=0,o=r.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!s._decimated,n.points=r;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!i,options:l},e),this.updateElements(r,a,o,e)}updateElements(e,t,n,r){const s="reset"===r,{iScale:i,vScale:a,_stacked:o,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(t,r),u=i.axis,h=a.axis,{spanGaps:m,segment:f}=this.options,p=Rh(m)?m:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||s||"none"===r;let x=t>0&&this.getParsed(t-1);for(let y=t;y<t+n;++y){const t=e[y],n=this.getParsed(y),m=g?t:{},b=th(n[h]),w=m[u]=i.getPixelForValue(n[u],y),v=m[h]=s||b?a.getBasePixel():a.getPixelForValue(o?this.applyStack(a,n,o):n[h],y);m.skip=isNaN(w)||isNaN(v)||b,m.stop=y>0&&Math.abs(n[u]-x[u])>p,f&&(m.parsed=n,m.raw=l.data[y]),d&&(m.options=c||this.resolveDataElementOptions(y,t.active?"active":r)),g||this.updateElement(t,y,m,r),x=n}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,r=e.data||[];if(!r.length)return n;const s=r[0].size(this.resolveDataElementOptions(0)),i=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(n,s,i)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}Gp.id="line",Gp.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},Gp.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class Yp extends Rp{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,r=n.data.labels||[],s=ap(t._parsed[e].r,n.options.locale);return{label:r[e]||"",value:s}}parseObjectData(e,t,n,r){return Lf.bind(this)(e,t,n,r)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((e,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<t.min&&(t.min=r),r>t.max&&(t.max=r))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,r=Math.min(t.right-t.left,t.bottom-t.top),s=Math.max(r/2,0),i=(s-Math.max(n.cutoutPercentage?s/100*n.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=s-i*this.index,this.innerRadius=this.outerRadius-i}updateElements(e,t,n,r){const s="reset"===r,i=this.chart,a=i.options.animation,o=this._cachedMeta.rScale,l=o.xCenter,c=o.yCenter,d=o.getIndexAngle(0)-.5*Sh;let u,h=d;const m=360/this.countVisibleElements();for(u=0;u<t;++u)h+=this._computeAngle(u,r,m);for(u=t;u<t+n;u++){const t=e[u];let n=h,f=h+this._computeAngle(u,r,m),p=i.getDataVisibility(u)?o.getDistanceFromCenterForValue(this.getParsed(u).r):0;h=f,s&&(a.animateScale&&(p=0),a.animateRotate&&(n=f=d));const g={x:l,y:c,innerRadius:0,outerRadius:p,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(u,t.active?"active":r)};this.updateElement(t,u,g,r)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((e,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?Mh(this.resolveDataElementOptions(e,t).angle||n):0}}Yp.id="polarArea",Yp.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},Yp.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n}}=e.legend.options;return t.labels.map((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label:e=>e.chart.data.labels[e.dataIndex]+": "+e.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class Xp extends Wp{}Xp.id="pie",Xp.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Qp extends Rp{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,r){return Lf.bind(this)(e,t,n,r)}update(e){const t=this._cachedMeta,n=t.dataset,r=t.data||[],s=t.iScale.getLabels();if(n.points=r,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const i={_loop:!0,_fullLoop:s.length===r.length,options:t};this.updateElement(n,void 0,i,e)}this.updateElements(r,0,r.length,e)}updateElements(e,t,n,r){const s=this._cachedMeta.rScale,i="reset"===r;for(let a=t;a<t+n;a++){const t=e[a],n=this.resolveDataElementOptions(a,t.active?"active":r),o=s.getPointPositionForValue(a,this.getParsed(a).r),l=i?s.xCenter:o.x,c=i?s.yCenter:o.y,d={x:l,y:c,angle:o.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(t,a,d,r)}}}Qp.id="radar",Qp.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},Qp.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class Kp{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return Rh(this.x)&&Rh(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const r={};return e.forEach(e=>{r[e]=n[e]&&n[e].active()?n[e]._to:this[e]}),r}}Kp.defaults={},Kp.defaultRoutes=void 0;const Zp={values:e=>nh(e)?e:""+e,numeric(e,t,n){if(0===e)return"0";const r=this.chart.options.locale;let s,i=e;if(n.length>1){const t=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(t<1e-4||t>1e15)&&(s="scientific"),i=function(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e));return n}(e,n)}const a=kh(Math.abs(i)),o=Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:s,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),ap(e,r,l)},logarithmic(e,t,n){if(0===e)return"0";const r=e/Math.pow(10,Math.floor(kh(e)));return 1===r||2===r||5===r?Zp.numeric.call(this,e,t,n):""}};var Jp={formatters:Zp};function $p(e,t){const n=e.options.ticks,r=n.maxTicksLimit||function(e){const t=e.options.offset,n=e._tickSize(),r=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(r,s))}(e),s=n.major.enabled?function(e){const t=[];let n,r;for(n=0,r=e.length;n<r;n++)e[n].major&&t.push(n);return t}(t):[],i=s.length,a=s[0],o=s[i-1],l=[];if(i>r)return function(e,t,n,r){let s,i=0,a=n[0];for(r=Math.ceil(r),s=0;s<e.length;s++)s===a&&(t.push(e[s]),i++,a=n[i*r])}(t,l,s,i/r),l;const c=function(e,t,n){const r=function(e){const t=e.length;let n,r;if(t<2)return!1;for(r=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==r)return!1;return r}(e),s=t.length/n;if(!r)return Math.max(s,1);const i=function(e){const t=[],n=Math.sqrt(e);let r;for(r=1;r<n;r++)e%r===0&&(t.push(r),t.push(e/r));return n===(0|n)&&t.push(n),t.sort((e,t)=>e-t).pop(),t}(r);for(let a=0,o=i.length-1;a<o;a++){const e=i[a];if(e>s)return e}return Math.max(s,1)}(s,t,r);if(i>0){let e,n;const r=i>1?Math.round((o-a)/(i-1)):null;for(eg(t,l,c,th(r)?0:a-r,a),e=0,n=i-1;e<n;e++)eg(t,l,c,s[e],s[e+1]);return eg(t,l,c,o,th(r)?t.length:o+r),l}return eg(t,l,c),l}function eg(e,t,n,r,s){const i=ah(r,0),a=Math.min(ah(s,e.length),e.length);let o,l,c,d=0;for(n=Math.ceil(n),s&&(o=s-r,n=o/Math.floor(o/n)),c=i;c<0;)d++,c=Math.round(i+d*n);for(l=Math.max(i,0);l<a;l++)l===c&&(t.push(e[l]),d++,c=Math.round(i+d*n))}Km.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Jp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),Km.route("scale.ticks","color","","color"),Km.route("scale.grid","color","","borderColor"),Km.route("scale.grid","borderColor","","borderColor"),Km.route("scale.title","color","","color"),Km.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e}),Km.describe("scales",{_fallback:"scale"}),Km.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e});const tg=(e,t,n)=>"top"===t||"left"===t?e[t]+n:e[t]-n;function ng(e,t){const n=[],r=e.length/t,s=e.length;let i=0;for(;i<s;i+=r)n.push(e[Math.floor(i)]);return n}function rg(e,t,n){const r=e.ticks.length,s=Math.min(t,r-1),i=e._startPixel,a=e._endPixel,o=1e-6;let l,c=e.getPixelForTick(s);if(!(n&&(l=1===r?Math.max(c-i,a-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(s-1))/2,c+=s<t?l:-l,c<i-o||c>a+o)))return c}function sg(e){return e.drawTicks?e.tickLength:0}function ig(e,t){if(!e.display)return 0;const n=wf(e.font,t),r=bf(e.padding);return(nh(e.text)?e.text.length:1)*n.lineHeight+r.height}function ag(e,t,n){let r=tm(e);return(n&&"right"!==t||!n&&"right"===t)&&(r=(e=>"left"===e?"right":"right"===e?"left":e)(r)),r}class og extends Kp{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:r}=this;return e=ih(e,Number.POSITIVE_INFINITY),t=ih(t,Number.NEGATIVE_INFINITY),n=ih(n,Number.POSITIVE_INFINITY),r=ih(r,Number.NEGATIVE_INFINITY),{min:ih(e,n),max:ih(t,r),minDefined:sh(e),maxDefined:sh(t)}}getMinMax(e){let t,{min:n,max:r,minDefined:s,maxDefined:i}=this.getUserBounds();if(s&&i)return{min:n,max:r};const a=this.getMatchingVisibleMetas();for(let o=0,l=a.length;o<l;++o)t=a[o].controller.getMinMax(this,e),s||(n=Math.min(n,t.min)),i||(r=Math.max(r,t.max));return n=i&&n>r?r:n,r=s&&n>r?n:r,{min:ih(n,ih(r,n)),max:ih(r,ih(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){lh(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:r,grace:s,ticks:i}=this.options,a=i.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,n){const{min:r,max:s}=e,i=oh(t,(s-r)/2),a=(e,t)=>n&&0===e?0:e+t;return{min:a(r,-Math.abs(i)),max:a(s,i)}}(this,s,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=a<this.ticks.length;this._convertTicksToLabels(o?ng(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),i.display&&(i.autoSkip||"auto"===i.source)&&(this.ticks=$p(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,n=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,n=!n),this._startPixel=e,this._endPixel=t,this._reversePixels=n,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){lh(this.options.afterUpdate,[this])}beforeSetDimensions(){lh(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){lh(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),lh(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){lh(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,r,s;for(n=0,r=e.length;n<r;n++)s=e[n],s.label=lh(t.callback,[s.value,n,e],this)}afterTickToLabelConversion(){lh(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){lh(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=this.ticks.length,r=t.minRotation||0,s=t.maxRotation;let i,a,o,l=r;if(!this._isVisible()||!t.display||r>=s||n<=1||!this.isHorizontal())return void(this.labelRotation=r);const c=this._getLabelSizes(),d=c.widest.width,u=c.highest.height,h=Wh(this.chart.width-d,0,this.maxWidth);i=e.offset?this.maxWidth/n:h/(n-1),d+6>i&&(i=h/(n-(e.offset?.5:1)),a=this.maxHeight-sg(e.grid)-t.padding-ig(e.title,this.chart.options.font),o=Math.sqrt(d*d+u*u),l=Fh(Math.min(Math.asin(Wh((c.highest.height+6)/i,-1,1)),Math.asin(Wh(a/o,-1,1))-Math.asin(Wh(u/o,-1,1)))),l=Math.max(r,Math.min(s,l))),this.labelRotation=l}afterCalculateLabelRotation(){lh(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){lh(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:r,grid:s}}=this,i=this._isVisible(),a=this.isHorizontal();if(i){const i=ig(r,t.options.font);if(a?(e.width=this.maxWidth,e.height=sg(s)+i):(e.height=this.maxHeight,e.width=sg(s)+i),n.display&&this.ticks.length){const{first:t,last:r,widest:s,highest:i}=this._getLabelSizes(),o=2*n.padding,l=Mh(this.labelRotation),c=Math.cos(l),d=Math.sin(l);if(a){const t=n.mirror?0:d*s.width+c*i.height;e.height=Math.min(this.maxHeight,e.height+t+o)}else{const t=n.mirror?0:c*s.width+d*i.height;e.width=Math.min(this.maxWidth,e.width+t+o)}this._calculatePadding(t,r,d,c)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,r){const{ticks:{align:s,padding:i},position:a}=this.options,o=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,u=0;o?l?(d=r*e.width,u=n*t.height):(d=n*e.height,u=r*t.width):"start"===s?u=t.width:"end"===s?d=e.width:"inner"!==s&&(d=e.width/2,u=t.width/2),this.paddingLeft=Math.max((d-a+i)*this.width/(this.width-a),0),this.paddingRight=Math.max((u-c+i)*this.width/(this.width-c),0)}else{let n=t.height/2,r=e.height/2;"start"===s?(n=0,r=e.height):"end"===s&&(n=t.height,r=0),this.paddingTop=n+i,this.paddingBottom=r+i}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){lh(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,n=e.length;t<n;t++)th(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=ng(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length)}return e}_computeLabelSizes(e,t){const{ctx:n,_longestTextCache:r}=this,s=[],i=[];let a,o,l,c,d,u,h,m,f,p,g,x=0,y=0;for(a=0;a<t;++a){if(c=e[a].label,d=this._resolveTickFontOptions(a),n.font=u=d.string,h=r[u]=r[u]||{data:{},gc:[]},m=d.lineHeight,f=p=0,th(c)||nh(c)){if(nh(c))for(o=0,l=c.length;o<l;++o)g=c[o],th(g)||nh(g)||(f=Zm(n,h.data,h.gc,f,g),p+=m)}else f=Zm(n,h.data,h.gc,f,c),p=m;s.push(f),i.push(p),x=Math.max(f,x),y=Math.max(p,y)}!function(e,t){ch(e,e=>{const n=e.gc,r=n.length/2;let s;if(r>t){for(s=0;s<r;++s)delete e.data[n[s]];n.splice(0,r)}})}(r,t);const b=s.indexOf(x),w=i.indexOf(y),v=e=>({width:s[e]||0,height:i[e]||0});return{first:v(0),last:v(t-1),widest:v(b),highest:v(w),widths:s,heights:i}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return Wh(this._alignToPixels?$m(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=function(e,t,n){return Nf(e,{tick:n,index:t,type:"tick"})}(this.getContext(),e,n))}return this.$context||(this.$context=Nf(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=Mh(this.labelRotation),n=Math.abs(Math.cos(t)),r=Math.abs(Math.sin(t)),s=this._getLabelSizes(),i=e.autoSkipPadding||0,a=s?s.widest.width+i:0,o=s?s.highest.height+i:0;return this.isHorizontal()?o*n>a*r?a/n:o/r:o*r<a*n?o/n:a/r}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,r=this.options,{grid:s,position:i}=r,a=s.offset,o=this.isHorizontal(),l=this.ticks.length+(a?1:0),c=sg(s),d=[],u=s.setContext(this.getContext()),h=u.drawBorder?u.borderWidth:0,m=h/2,f=function(e){return $m(n,e,h)};let p,g,x,y,b,w,v,N,S,A,_,C;if("top"===i)p=f(this.bottom),w=this.bottom-c,N=p-m,A=f(e.top)+m,C=e.bottom;else if("bottom"===i)p=f(this.top),A=e.top,C=f(e.bottom)-m,w=p+m,N=this.top+c;else if("left"===i)p=f(this.right),b=this.right-c,v=p-m,S=f(e.left)+m,_=e.right;else if("right"===i)p=f(this.left),S=e.left,_=f(e.right)-m,b=p+m,v=this.left+c;else if("x"===t){if("center"===i)p=f((e.top+e.bottom)/2+.5);else if(rh(i)){const e=Object.keys(i)[0],t=i[e];p=f(this.chart.scales[e].getPixelForValue(t))}A=e.top,C=e.bottom,w=p+m,N=w+c}else if("y"===t){if("center"===i)p=f((e.left+e.right)/2);else if(rh(i)){const e=Object.keys(i)[0],t=i[e];p=f(this.chart.scales[e].getPixelForValue(t))}b=p-m,v=b-c,S=e.left,_=e.right}const I=ah(r.ticks.maxTicksLimit,l),E=Math.max(1,Math.ceil(l/I));for(g=0;g<l;g+=E){const e=s.setContext(this.getContext(g)),t=e.lineWidth,r=e.color,i=e.borderDash||[],l=e.borderDashOffset,c=e.tickWidth,u=e.tickColor,h=e.tickBorderDash||[],m=e.tickBorderDashOffset;x=rg(this,g,a),void 0!==x&&(y=$m(n,x,t),o?b=v=S=_=y:w=N=A=C=y,d.push({tx1:b,ty1:w,tx2:v,ty2:N,x1:S,y1:A,x2:_,y2:C,width:t,color:r,borderDash:i,borderDashOffset:l,tickWidth:c,tickColor:u,tickBorderDash:h,tickBorderDashOffset:m}))}return this._ticksLength=l,this._borderValue=p,d}_computeLabelItems(e){const t=this.axis,n=this.options,{position:r,ticks:s}=n,i=this.isHorizontal(),a=this.ticks,{align:o,crossAlign:l,padding:c,mirror:d}=s,u=sg(n.grid),h=u+c,m=d?-c:h,f=-Mh(this.labelRotation),p=[];let g,x,y,b,w,v,N,S,A,_,C,I,E="middle";if("top"===r)v=this.bottom-m,N=this._getXAxisLabelAlignment();else if("bottom"===r)v=this.top+m,N=this._getXAxisLabelAlignment();else if("left"===r){const e=this._getYAxisLabelAlignment(u);N=e.textAlign,w=e.x}else if("right"===r){const e=this._getYAxisLabelAlignment(u);N=e.textAlign,w=e.x}else if("x"===t){if("center"===r)v=(e.top+e.bottom)/2+h;else if(rh(r)){const e=Object.keys(r)[0],t=r[e];v=this.chart.scales[e].getPixelForValue(t)+h}N=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===r)w=(e.left+e.right)/2-h;else if(rh(r)){const e=Object.keys(r)[0],t=r[e];w=this.chart.scales[e].getPixelForValue(t)}N=this._getYAxisLabelAlignment(u).textAlign}"y"===t&&("start"===o?E="top":"end"===o&&(E="bottom"));const T=this._getLabelSizes();for(g=0,x=a.length;g<x;++g){y=a[g],b=y.label;const e=s.setContext(this.getContext(g));S=this.getPixelForTick(g)+s.labelOffset,A=this._resolveTickFontOptions(g),_=A.lineHeight,C=nh(b)?b.length:1;const t=C/2,n=e.color,o=e.textStrokeColor,c=e.textStrokeWidth;let u,h=N;if(i?(w=S,"inner"===N&&(h=g===x-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),I="top"===r?"near"===l||0!==f?-C*_+_/2:"center"===l?-T.highest.height/2-t*_+_:-T.highest.height+_/2:"near"===l||0!==f?_/2:"center"===l?T.highest.height/2-t*_:T.highest.height-C*_,d&&(I*=-1)):(v=S,I=(1-C)*_/2),e.showLabelBackdrop){const t=bf(e.backdropPadding),n=T.heights[g],r=T.widths[g];let s=v+I-t.top,i=w-t.left;switch(E){case"middle":s-=n/2;break;case"bottom":s-=n}switch(N){case"center":i-=r/2;break;case"right":i-=r}u={left:i,top:s,width:r+t.width,height:n+t.height,color:e.backdropColor}}p.push({rotation:f,label:b,font:A,color:n,strokeColor:o,strokeWidth:c,textOffset:I,textAlign:h,textBaseline:E,translation:[w,v],backdrop:u})}return p}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Mh(this.labelRotation))return"top"===e?"left":"right";let n="center";return"start"===t.align?n="left":"end"===t.align?n="right":"inner"===t.align&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:r,padding:s}}=this.options,i=e+s,a=this._getLabelSizes().widest.width;let o,l;return"left"===t?r?(l=this.right+s,"near"===n?o="left":"center"===n?(o="center",l+=a/2):(o="right",l+=a)):(l=this.right-i,"near"===n?o="right":"center"===n?(o="center",l-=a/2):(o="left",l=this.left)):"right"===t?r?(l=this.left+s,"near"===n?o="right":"center"===n?(o="center",l-=a/2):(o="left",l-=a)):(l=this.left+i,"near"===n?o="left":"center"===n?(o="center",l+=a/2):(o="right",l=this.right)):o="right",{textAlign:o,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:r,width:s,height:i}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,r,s,i),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const n=this.ticks.findIndex(t=>t.value===e);if(n>=0){return t.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,n=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,i;const a=(e,t,r)=>{r.width&&r.color&&(n.save(),n.lineWidth=r.width,n.strokeStyle=r.color,n.setLineDash(r.borderDash||[]),n.lineDashOffset=r.borderDashOffset,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke(),n.restore())};if(t.display)for(s=0,i=r.length;s<i;++s){const e=r[s];t.drawOnChartArea&&a({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&a({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{grid:n}}=this,r=n.setContext(this.getContext()),s=n.drawBorder?r.borderWidth:0;if(!s)return;const i=n.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let o,l,c,d;this.isHorizontal()?(o=$m(e,this.left,s)-s/2,l=$m(e,this.right,i)+i/2,c=d=a):(c=$m(e,this.top,s)-s/2,d=$m(e,this.bottom,i)+i/2,o=l=a),t.save(),t.lineWidth=r.borderWidth,t.strokeStyle=r.borderColor,t.beginPath(),t.moveTo(o,c),t.lineTo(l,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,n=this._computeLabelArea();n&&sf(t,n);const r=this._labelItems||(this._labelItems=this._computeLabelItems(e));let s,i;for(s=0,i=r.length;s<i;++s){const e=r[s],n=e.font,i=e.label;e.backdrop&&(t.fillStyle=e.backdrop.color,t.fillRect(e.backdrop.left,e.backdrop.top,e.backdrop.width,e.backdrop.height)),cf(t,i,0,e.textOffset,n,e)}n&&af(t)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:r}}=this;if(!n.display)return;const s=wf(n.font),i=bf(n.padding),a=n.align;let o=s.lineHeight/2;"bottom"===t||"center"===t||rh(t)?(o+=i.bottom,nh(n.text)&&(o+=s.lineHeight*(n.text.length-1))):o+=i.top;const{titleX:l,titleY:c,maxWidth:d,rotation:u}=function(e,t,n,r){const{top:s,left:i,bottom:a,right:o,chart:l}=e,{chartArea:c,scales:d}=l;let u,h,m,f=0;const p=a-s,g=o-i;if(e.isHorizontal()){if(h=nm(r,i,o),rh(n)){const e=Object.keys(n)[0],r=n[e];m=d[e].getPixelForValue(r)+p-t}else m="center"===n?(c.bottom+c.top)/2+p-t:tg(e,n,t);u=o-i}else{if(rh(n)){const e=Object.keys(n)[0],r=n[e];h=d[e].getPixelForValue(r)-g+t}else h="center"===n?(c.left+c.right)/2-g+t:tg(e,n,t);m=nm(r,a,s),f="left"===n?-Eh:Eh}return{titleX:h,titleY:m,maxWidth:u,rotation:f}}(this,o,t,a);cf(e,n.text,0,0,s,{color:n.color,maxWidth:d,rotation:u,textAlign:ag(a,t,r),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=ah(e.grid&&e.grid.z,-1);return this._isVisible()&&this.draw===og.prototype.draw?[{z:n,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",r=[];let s,i;for(s=0,i=t.length;s<i;++s){const i=t[s];i[n]!==this.id||e&&i.type!==e||r.push(i)}return r}_resolveTickFontOptions(e){return wf(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class lg{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;(function(e){return"id"in e&&"defaults"in e})(t)&&(n=this.register(t));const r=this.items,s=e.id,i=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in r||(r[s]=e,function(e,t,n){const r=fh(Object.create(null),[n?Km.get(n):{},Km.get(t),e.defaults]);Km.set(t,r),e.defaultRoutes&&function(e,t){Object.keys(t).forEach(n=>{const r=n.split("."),s=r.pop(),i=[e].concat(r).join("."),a=t[n].split("."),o=a.pop(),l=a.join(".");Km.route(i,s,l,o)})}(t,e.defaultRoutes);e.descriptors&&Km.describe(t,e.descriptors)}(e,i,n),this.override&&Km.override(e.id,e.overrides)),i}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,r=this.scope;n in t&&delete t[n],r&&n in Km[r]&&(delete Km[r][n],this.override&&delete Gm[n])}}var cg=new class{constructor(){this.controllers=new lg(Rp,"datasets",!0),this.elements=new lg(Kp,"elements"),this.plugins=new lg(Object,"plugins"),this.scales=new lg(og,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t)}remove(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t)}addControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.controllers)}addElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.elements)}addPlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.plugins)}addScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.controllers)}removeElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.elements)}removePlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.plugins)}removeScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.scales)}_each(e,t,n){[...t].forEach(t=>{const r=n||this._getRegistryForType(t);n||r.isForType(t)||r===this.plugins&&t.id?this._exec(e,r,t):ch(t,t=>{const r=n||this._getRegistryForType(t);this._exec(e,r,t)})})}_exec(e,t,n){const r=bh(e);lh(n["before"+r],[],n),t[e](n),lh(n["after"+r],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const r=t.get(e);if(void 0===r)throw new Error('"'+e+'" is not a registered '+n+".");return r}};class dg extends Rp{update(e){const t=this._cachedMeta,{data:n=[]}=t,r=this.chart._animationsDisabled;let{start:s,count:i}=rm(t,n,r);if(this._drawStart=s,this._drawCount=i,sm(t)&&(s=0,i=n.length),this.options.showLine){const{dataset:s,_dataset:i}=t;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!i._decimated,s.points=n;const a=this.resolveDatasetElementOptions(e);a.segment=this.options.segment,this.updateElement(s,void 0,{animated:!r,options:a},e)}this.updateElements(n,s,i,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=cg.getElement("line")),super.addElements()}updateElements(e,t,n,r){const s="reset"===r,{iScale:i,vScale:a,_stacked:o,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,r),d=this.getSharedOptions(c),u=this.includeOptions(r,d),h=i.axis,m=a.axis,{spanGaps:f,segment:p}=this.options,g=Rh(f)?f:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||s||"none"===r;let y=t>0&&this.getParsed(t-1);for(let b=t;b<t+n;++b){const t=e[b],n=this.getParsed(b),c=x?t:{},f=th(n[m]),w=c[h]=i.getPixelForValue(n[h],b),v=c[m]=s||f?a.getBasePixel():a.getPixelForValue(o?this.applyStack(a,n,o):n[m],b);c.skip=isNaN(w)||isNaN(v)||f,c.stop=b>0&&Math.abs(n[h]-y[h])>g,p&&(c.parsed=n,c.raw=l.data[b]),u&&(c.options=d||this.resolveDataElementOptions(b,t.active?"active":r)),x||this.updateElement(t,b,c,r),y=n}this.updateSharedOptions(d,r,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}const n=e.dataset,r=n.options&&n.options.borderWidth||0;if(!t.length)return r;const s=t[0].size(this.resolveDataElementOptions(0)),i=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(r,s,i)/2}}dg.id="scatter",dg.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},dg.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:e=>"("+e.label+", "+e.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};function ug(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class hg{constructor(e){this.options=e||{}}init(e){}formats(){return ug()}parse(e,t){return ug()}format(e,t){return ug()}add(e,t,n){return ug()}diff(e,t,n){return ug()}startOf(e,t,n){return ug()}endOf(e,t){return ug()}}hg.override=function(e){Object.assign(hg.prototype,e)};var mg={_date:hg};function fg(e,t,n,r){const{controller:s,data:i,_sorted:a}=e,o=s._cachedMeta.iScale;if(o&&t===o.axis&&"r"!==t&&a&&i.length){const e=o._reversePixels?Qh:Xh;if(!r)return e(i,t,n);if(s._sharedOptions){const r=i[0],s="function"===typeof r.getRange&&r.getRange(t);if(s){const r=e(i,t,n-s),a=e(i,t,n+s);return{lo:r.lo,hi:a.hi}}}}return{lo:0,hi:i.length-1}}function pg(e,t,n,r,s){const i=e.getSortedVisibleDatasetMetas(),a=n[t];for(let o=0,l=i.length;o<l;++o){const{index:e,data:n}=i[o],{lo:l,hi:c}=fg(i[o],t,a,s);for(let t=l;t<=c;++t){const s=n[t];s.skip||r(s,e,t)}}}function gg(e,t,n,r,s){const i=[];if(!s&&!e.isPointInArea(t))return i;return pg(e,n,t,function(n,a,o){(s||rf(n,e.chartArea,0))&&n.inRange(t.x,t.y,r)&&i.push({element:n,datasetIndex:a,index:o})},!0),i}function xg(e,t,n,r,s,i){let a=[];const o=function(e){const t=-1!==e.indexOf("x"),n=-1!==e.indexOf("y");return function(e,r){const s=t?Math.abs(e.x-r.x):0,i=n?Math.abs(e.y-r.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(i,2))}}(n);let l=Number.POSITIVE_INFINITY;return pg(e,n,t,function(n,c,d){const u=n.inRange(t.x,t.y,s);if(r&&!u)return;const h=n.getCenterPoint(s);if(!(!!i||e.isPointInArea(h))&&!u)return;const m=o(t,h);m<l?(a=[{element:n,datasetIndex:c,index:d}],l=m):m===l&&a.push({element:n,datasetIndex:c,index:d})}),a}function yg(e,t,n,r,s,i){return i||e.isPointInArea(t)?"r"!==n||r?xg(e,t,n,r,s,i):function(e,t,n,r){let s=[];return pg(e,n,t,function(e,n,i){const{startAngle:a,endAngle:o}=e.getProps(["startAngle","endAngle"],r),{angle:l}=Uh(e,{x:t.x,y:t.y});Vh(l,a,o)&&s.push({element:e,datasetIndex:n,index:i})}),s}(e,t,n,s):[]}function bg(e,t,n,r,s){const i=[],a="x"===n?"inXRange":"inYRange";let o=!1;return pg(e,n,t,(e,r,l)=>{e[a](t[n],s)&&(i.push({element:e,datasetIndex:r,index:l}),o=o||e.inRange(t.x,t.y,s))}),r&&!o?[]:i}var wg={evaluateInteractionItems:pg,modes:{index(e,t,n,r){const s=Kf(t,e),i=n.axis||"x",a=n.includeInvisible||!1,o=n.intersect?gg(e,s,i,r,a):yg(e,s,i,!1,r,a),l=[];return o.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{const t=o[0].index,n=e.data[t];n&&!n.skip&&l.push({element:n,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,n,r){const s=Kf(t,e),i=n.axis||"xy",a=n.includeInvisible||!1;let o=n.intersect?gg(e,s,i,r,a):yg(e,s,i,!1,r,a);if(o.length>0){const t=o[0].datasetIndex,n=e.getDatasetMeta(t).data;o=[];for(let e=0;e<n.length;++e)o.push({element:n[e],datasetIndex:t,index:e})}return o},point:(e,t,n,r)=>gg(e,Kf(t,e),n.axis||"xy",r,n.includeInvisible||!1),nearest(e,t,n,r){const s=Kf(t,e),i=n.axis||"xy",a=n.includeInvisible||!1;return yg(e,s,i,n.intersect,r,a)},x:(e,t,n,r)=>bg(e,Kf(t,e),"x",n.intersect,r),y:(e,t,n,r)=>bg(e,Kf(t,e),"y",n.intersect,r)}};const vg=["left","top","right","bottom"];function Ng(e,t){return e.filter(e=>e.pos===t)}function Sg(e,t){return e.filter(e=>-1===vg.indexOf(e.pos)&&e.box.axis===t)}function Ag(e,t){return e.sort((e,n)=>{const r=t?n:e,s=t?e:n;return r.weight===s.weight?r.index-s.index:r.weight-s.weight})}function _g(e,t){const n=function(e){const t={};for(const n of e){const{stack:e,pos:r,stackWeight:s}=n;if(!e||!vg.includes(r))continue;const i=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});i.count++,i.weight+=s}return t}(e),{vBoxMaxWidth:r,hBoxMaxHeight:s}=t;let i,a,o;for(i=0,a=e.length;i<a;++i){o=e[i];const{fullSize:a}=o.box,l=n[o.stack],c=l&&o.stackWeight/l.weight;o.horizontal?(o.width=c?c*r:a&&t.availableWidth,o.height=s):(o.width=r,o.height=c?c*s:a&&t.availableHeight)}return n}function Cg(e,t,n,r){return Math.max(e[n],t[n])+Math.max(e[r],t[r])}function Ig(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Eg(e,t,n,r){const{pos:s,box:i}=n,a=e.maxPadding;if(!rh(s)){n.size&&(e[s]-=n.size);const t=r[n.stack]||{size:0,count:1};t.size=Math.max(t.size,n.horizontal?i.height:i.width),n.size=t.size/t.count,e[s]+=n.size}i.getPadding&&Ig(a,i.getPadding());const o=Math.max(0,t.outerWidth-Cg(a,e,"left","right")),l=Math.max(0,t.outerHeight-Cg(a,e,"top","bottom")),c=o!==e.w,d=l!==e.h;return e.w=o,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function Tg(e,t){const n=t.maxPadding;function r(e){const r={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{r[e]=Math.max(t[e],n[e])}),r}return r(e?["left","right"]:["top","bottom"])}function jg(e,t,n,r){const s=[];let i,a,o,l,c,d;for(i=0,a=e.length,c=0;i<a;++i){o=e[i],l=o.box,l.update(o.width||t.w,o.height||t.h,Tg(o.horizontal,t));const{same:a,other:u}=Eg(t,n,o,r);c|=a&&s.length,d=d||u,l.fullSize||s.push(o)}return c&&jg(s,t,n,r)||d}function kg(e,t,n,r,s){e.top=n,e.left=t,e.right=t+r,e.bottom=n+s,e.width=r,e.height=s}function Dg(e,t,n,r){const s=n.padding;let{x:i,y:a}=t;for(const o of e){const e=o.box,l=r[o.stack]||{count:1,placed:0,weight:1},c=o.stackWeight/l.weight||1;if(o.horizontal){const r=t.w*c,i=l.size||e.height;wh(l.start)&&(a=l.start),e.fullSize?kg(e,s.left,a,n.outerWidth-s.right-s.left,i):kg(e,t.left+l.placed,a,r,i),l.start=a,l.placed+=r,a=e.bottom}else{const r=t.h*c,a=l.size||e.width;wh(l.start)&&(i=l.start),e.fullSize?kg(e,i,s.top,a,n.outerHeight-s.bottom-s.top):kg(e,i,t.top+l.placed,a,r),l.start=i,l.placed+=r,i=e.right}}t.x=i,t.y=a}Km.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Pg={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;-1!==n&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,r){if(!e)return;const s=bf(e.options.layout.padding),i=Math.max(t-s.width,0),a=Math.max(n-s.height,0),o=function(e){const t=function(e){const t=[];let n,r,s,i,a,o;for(n=0,r=(e||[]).length;n<r;++n)s=e[n],({position:i,options:{stack:a,stackWeight:o=1}}=s),t.push({index:n,box:s,pos:i,horizontal:s.isHorizontal(),weight:s.weight,stack:a&&i+a,stackWeight:o});return t}(e),n=Ag(t.filter(e=>e.box.fullSize),!0),r=Ag(Ng(t,"left"),!0),s=Ag(Ng(t,"right")),i=Ag(Ng(t,"top"),!0),a=Ag(Ng(t,"bottom")),o=Sg(t,"x"),l=Sg(t,"y");return{fullSize:n,leftAndTop:r.concat(i),rightAndBottom:s.concat(l).concat(a).concat(o),chartArea:Ng(t,"chartArea"),vertical:r.concat(s).concat(l),horizontal:i.concat(a).concat(o)}}(e.boxes),l=o.vertical,c=o.horizontal;ch(e.boxes,e=>{"function"===typeof e.beforeLayout&&e.beforeLayout()});const d=l.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:i,availableHeight:a,vBoxMaxWidth:i/2/d,hBoxMaxHeight:a/2}),h=Object.assign({},s);Ig(h,bf(r));const m=Object.assign({maxPadding:h,w:i,h:a,x:s.left,y:s.top},s),f=_g(l.concat(c),u);jg(o.fullSize,m,u,f),jg(l,m,u,f),jg(c,m,u,f)&&jg(l,m,u,f),function(e){const t=e.maxPadding;function n(n){const r=Math.max(t[n]-e[n],0);return e[n]+=r,r}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}(m),Dg(o.leftAndTop,m,u,f),m.x+=m.w,m.y+=m.h,Dg(o.rightAndBottom,m,u,f),e.chartArea={left:m.left,top:m.top,right:m.left+m.w,bottom:m.top+m.h,height:m.h,width:m.w},ch(o.chartArea,t=>{const n=t.box;Object.assign(n,e.chartArea),n.update(m.w,m.h,{left:0,top:0,right:0,bottom:0})})}};class Rg{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,r){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,r?Math.floor(t/r):n)}}isAttached(e){return!0}updateConfig(e){}}class Og extends Rg{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Lg="$chartjs",Mg={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Fg=e=>null===e||""===e;const Bg=!!ep&&{passive:!0};function Ug(e,t,n){e.canvas.removeEventListener(t,n,Bg)}function zg(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function qg(e,t,n){const r=e.canvas,s=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||zg(n.addedNodes,r),t=t&&!zg(n.removedNodes,r);t&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function Hg(e,t,n){const r=e.canvas,s=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||zg(n.removedNodes,r),t=t&&!zg(n.addedNodes,r);t&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const Vg=new Map;let Wg=0;function Gg(){const e=window.devicePixelRatio;e!==Wg&&(Wg=e,Vg.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function Yg(e,t,n){const r=e.canvas,s=r&&Wf(r);if(!s)return;const i=em((e,t)=>{const r=s.clientWidth;n(e,t),r<s.clientWidth&&n()},window),a=new ResizeObserver(e=>{const t=e[0],n=t.contentRect.width,r=t.contentRect.height;0===n&&0===r||i(n,r)});return a.observe(s),function(e,t){Vg.size||window.addEventListener("resize",Gg),Vg.set(e,t)}(e,i),a}function Xg(e,t,n){n&&n.disconnect(),"resize"===t&&function(e){Vg.delete(e),Vg.size||window.removeEventListener("resize",Gg)}(e)}function Qg(e,t,n){const r=e.canvas,s=em(t=>{null!==e.ctx&&n(function(e,t){const n=Mg[e.type]||e.type,{x:r,y:s}=Kf(e,t);return{type:n,chart:t,native:e,x:void 0!==r?r:null,y:void 0!==s?s:null}}(t,e))},e,e=>{const t=e[0];return[t,t.offsetX,t.offsetY]});return function(e,t,n){e.addEventListener(t,n,Bg)}(r,t,s),s}class Kg extends Rg{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(function(e,t){const n=e.style,r=e.getAttribute("height"),s=e.getAttribute("width");if(e[Lg]={initial:{height:r,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Fg(s)){const t=tp(e,"width");void 0!==t&&(e.width=t)}if(Fg(r))if(""===e.style.height)e.height=e.width/(t||2);else{const t=tp(e,"height");void 0!==t&&(e.height=t)}}(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[Lg])return!1;const n=t[Lg].initial;["height","width"].forEach(e=>{const r=n[e];th(r)?t.removeAttribute(e):t.setAttribute(e,r)});const r=n.style||{};return Object.keys(r).forEach(e=>{t.style[e]=r[e]}),t.width=t.width,delete t[Lg],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const r=e.$proxies||(e.$proxies={}),s={attach:qg,detach:Hg,resize:Yg}[t]||Qg;r[t]=s(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),r=n[t];if(!r)return;({attach:Xg,detach:Xg,resize:Xg}[t]||Ug)(e,t,r),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,r){return Jf(e,t,n,r)}isAttached(e){const t=Wf(e);return!(!t||!t.isConnected)}}class Zg{constructor(){this._init=[]}notify(e,t,n,r){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const s=r?this._descriptors(e).filter(r):this._descriptors(e),i=this._notify(s,e,t,n);return"afterDestroy"===t&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),i}_notify(e,t,n,r){r=r||{};for(const s of e){const e=s.plugin;if(!1===lh(e[n],[t,r,s.options],e)&&r.cancelable)return!1}return!0}invalidate(){th(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,r=ah(n.options&&n.options.plugins,{}),s=function(e){const t={},n=[],r=Object.keys(cg.plugins.items);for(let i=0;i<r.length;i++)n.push(cg.getPlugin(r[i]));const s=e.plugins||[];for(let i=0;i<s.length;i++){const e=s[i];-1===n.indexOf(e)&&(n.push(e),t[e.id]=!0)}return{plugins:n,localIds:t}}(n);return!1!==r||t?function(e,t,n,r){let{plugins:s,localIds:i}=t;const a=[],o=e.getContext();for(const l of s){const t=l.id,s=Jg(n[t],r);null!==s&&a.push({plugin:l,options:$g(e.config,{plugin:l,local:i[t]},s,o)})}return a}(e,s,r,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,r=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(r(t,n),e,"stop"),this._notify(r(n,t),e,"start")}}function Jg(e,t){return t||!1!==e?!0===e?{}:e:null}function $g(e,t,n,r){let{plugin:s,local:i}=t;const a=e.pluginScopeKeys(s),o=e.getOptionScopes(n,a);return i&&s.defaults&&o.push(s.defaults),e.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ex(e,t){const n=Km.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function tx(e,t){return"x"===e||"y"===e?e:t.axis||("top"===(n=t.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||e.charAt(0).toLowerCase();var n}function nx(e){const t=e.options||(e.options={});t.plugins=ah(t.plugins,{}),t.scales=function(e,t){const n=Gm[e.type]||{scales:{}},r=t.scales||{},s=ex(e.type,t),i=Object.create(null),a=Object.create(null);return Object.keys(r).forEach(e=>{const t=r[e];if(!rh(t))return console.error("Invalid scale configuration for scale: ".concat(e));if(t._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(e));const o=tx(e,t),l=function(e,t){return e===t?"_index_":"_value_"}(o,s),c=n.scales||{};i[o]=i[o]||e,a[e]=ph(Object.create(null),[{axis:o},t,c[o],c[l]])}),e.data.datasets.forEach(n=>{const s=n.type||e.type,o=n.indexAxis||ex(s,t),l=(Gm[s]||{}).scales||{};Object.keys(l).forEach(e=>{const t=function(e,t){let n=e;return"_index_"===e?n=t:"_value_"===e&&(n="x"===t?"y":"x"),n}(e,o),s=n[t+"AxisID"]||i[t]||t;a[s]=a[s]||Object.create(null),ph(a[s],[{axis:t},r[s],l[e]])})}),Object.keys(a).forEach(e=>{const t=a[e];ph(t,[Km.scales[t.type],Km.scale])}),a}(e,t)}function rx(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const sx=new Map,ix=new Set;function ax(e,t){let n=sx.get(e);return n||(n=t(),sx.set(e,n),ix.add(n)),n}const ox=(e,t,n)=>{const r=yh(t,n);void 0!==r&&e.add(r)};class lx{constructor(e){this._config=function(e){return(e=e||{}).data=rx(e.data),nx(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=rx(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),nx(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return ax(e,()=>[["datasets.".concat(e),""]])}datasetAnimationScopeKeys(e,t){return ax("".concat(e,".transition.").concat(t),()=>[["datasets.".concat(e,".transitions.").concat(t),"transitions.".concat(t)],["datasets.".concat(e),""]])}datasetElementScopeKeys(e,t){return ax("".concat(e,"-").concat(t),()=>[["datasets.".concat(e,".elements.").concat(t),"datasets.".concat(e),"elements.".concat(t),""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return ax("".concat(n,"-plugin-").concat(t),()=>[["plugins.".concat(t),...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let r=n.get(e);return r&&!t||(r=new Map,n.set(e,r)),r}getOptionScopes(e,t,n){const{options:r,type:s}=this,i=this._cachedScopes(e,n),a=i.get(t);if(a)return a;const o=new Set;t.forEach(t=>{e&&(o.add(e),t.forEach(t=>ox(o,e,t))),t.forEach(e=>ox(o,r,e)),t.forEach(e=>ox(o,Gm[s]||{},e)),t.forEach(e=>ox(o,Km,e)),t.forEach(e=>ox(o,Ym,e))});const l=Array.from(o);return 0===l.length&&l.push(Object.create(null)),ix.has(t)&&i.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,Gm[t]||{},Km.datasets[t]||{},{type:t},Km,Ym]}resolveNamedOptions(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const s={$shared:!0},{resolver:i,subPrefixes:a}=cx(this._resolverCache,e,r);let o=i;if(function(e,t){const{isScriptable:n,isIndexable:r}=_f(e);for(const s of t){const t=n(s),i=r(s),a=(i||t)&&e[s];if(t&&(vh(a)||dx(a))||i&&nh(a))return!0}return!1}(i,t)){s.$shared=!1;o=Af(i,n=vh(n)?n():n,this.createResolver(e,n,a))}for(const l of t)s[l]=o[l];return s}createResolver(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],r=arguments.length>3?arguments[3]:void 0;const{resolver:s}=cx(this._resolverCache,e,n);return rh(t)?Af(s,t,void 0,r):s}}function cx(e,t,n){let r=e.get(t);r||(r=new Map,e.set(t,r));const s=n.join();let i=r.get(s);if(!i){i={resolver:Sf(t,n),subPrefixes:n.filter(e=>!e.toLowerCase().includes("hover"))},r.set(s,i)}return i}const dx=e=>rh(e)&&Object.getOwnPropertyNames(e).reduce((t,n)=>t||vh(e[n]),!1);const ux=["top","bottom","left","right","chartArea"];function hx(e,t){return"top"===e||"bottom"===e||-1===ux.indexOf(e)&&"x"===t}function mx(e,t){return function(n,r){return n[e]===r[e]?n[t]-r[t]:n[e]-r[e]}}function fx(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),lh(n&&n.onComplete,[e],t)}function px(e){const t=e.chart,n=t.options.animation;lh(n&&n.onProgress,[e],t)}function gx(e){return Vf()&&"string"===typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const xx={},yx=e=>{const t=gx(e);return Object.values(xx).filter(e=>e.canvas===t).pop()};function bx(e,t,n){const r=Object.keys(e);for(const s of r){const r=+s;if(r>=t){const i=e[s];delete e[s],(n>0||r>t)&&(e[r+n]=i)}}}class wx{constructor(e,t){const n=this.config=new lx(t),r=gx(e),s=yx(r);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const i=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(e){return!Vf()||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?Og:Kg}(r)),this.platform.updateConfig(n);const a=this.platform.acquireContext(r,i.aspectRatio),o=a&&a.canvas,l=o&&o.height,c=o&&o.width;this.id=eh(),this.ctx=a,this.canvas=o,this.width=c,this.height=l,this._options=i,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Zg,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let n;return function(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return t?(clearTimeout(n),n=setTimeout(e,t,s)):e.apply(this,s),t}}(e=>this.update(e),i.resizeDelay||0),this._dataChanges=[],xx[this.id]=this,a&&o?(xp.listen(this,"complete",fx),xp.listen(this,"progress",px),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:r,_aspectRatio:s}=this;return th(e)?t&&s?s:r?n/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():$f(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return ef(this.canvas,this.ctx),this}stop(){return xp.stop(this),this}resize(e,t){xp.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,r=this.canvas,s=n.maintainAspectRatio&&this.aspectRatio,i=this.platform.getMaximumSize(r,e,t,s),a=n.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=i.width,this.height=i.height,this._aspectRatio=this.aspectRatio,$f(this,a,!0)&&(this.notifyPlugins("resize",{size:i}),lh(n.onResize,[this,i],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){ch(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,r=Object.keys(n).reduce((e,t)=>(e[t]=!1,e),{});let s=[];t&&(s=s.concat(Object.keys(t).map(e=>{const n=t[e],r=tx(e,n),s="r"===r,i="x"===r;return{options:n,dposition:s?"chartArea":i?"bottom":"left",dtype:s?"radialLinear":i?"category":"linear"}}))),ch(s,t=>{const s=t.options,i=s.id,a=tx(i,s),o=ah(s.type,t.dtype);void 0!==s.position&&hx(s.position,a)===hx(t.dposition)||(s.position=t.dposition),r[i]=!0;let l=null;if(i in n&&n[i].type===o)l=n[i];else{l=new(cg.getScale(o))({id:i,type:o,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(s,e)}),ch(r,(e,t)=>{e||delete n[t]}),ch(n,e=>{Pg.configure(this,e,e.options),Pg.addBox(this,e)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((e,t)=>e.index-t.index),n>t){for(let e=t;e<n;++e)this._destroyDatasetMeta(e);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(mx("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,n)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,r;for(this._removeUnreferencedMetasets(),n=0,r=t.length;n<r;n++){const r=t[n];let s=this.getDatasetMeta(n);const i=r.type||this.config.type;if(s.type&&s.type!==i&&(this._destroyDatasetMeta(n),s=this.getDatasetMeta(n)),s.type=i,s.indexAxis=r.indexAxis||ex(i,this.options),s.order=r.order||0,s.index=n,s.label=""+r.label,s.visible=this.isDatasetVisible(n),s.controller)s.controller.updateIndex(n),s.controller.linkScales();else{const t=cg.getController(i),{datasetElementType:r,dataElementType:a}=Km.datasets[i];Object.assign(t.prototype,{dataElementType:cg.getElement(a),datasetElementType:r&&cg.getElement(r)}),s.controller=new t(this,n),e.push(s.controller)}}return this._updateMetasets(),e}_resetElements(){ch(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let i=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:e}=this.getDatasetMeta(l),t=!r&&-1===s.indexOf(e);e.buildOrUpdateElements(t),i=Math.max(+e.getMaxOverflow(),i)}i=this._minPadding=n.layout.autoPadding?i:0,this._updateLayout(i),r||ch(s,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(mx("z","_idx"));const{_active:a,_lastEvent:o}=this;o?this._eventHandler(o,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){ch(this.scales,e=>{Pg.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);Nh(t,n)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:r,count:s}of t){bx(e,r,"_removeElements"===n?-s:s)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),r=n(0);for(let s=1;s<t;s++)if(!Nh(r,n(s)))return;return Array.from(r).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Pg.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],ch(this.boxes,e=>{n&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,vh(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),r={meta:n,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",r)&&(n.controller._update(t),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(xp.has(this)?this.attached&&!xp.running(this)&&xp.start(this):(this.draw(),fx({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let r,s;for(r=0,s=t.length;r<s;++r){const s=t[r];e&&!s.visible||n.push(s)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n=e._clip,r=!n.disabled,s=this.chartArea,i={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",i)&&(r&&sf(t,{left:!1===n.left?0:s.left-n.left,right:!1===n.right?this.width:s.right+n.right,top:!1===n.top?0:s.top-n.top,bottom:!1===n.bottom?this.height:s.bottom+n.bottom}),e.controller.draw(),r&&af(t),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(e){return rf(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,r){const s=wg.modes[t];return"function"===typeof s?s(this,e,n,r):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let r=n.filter(e=>e&&e._dataset===t).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(r)),r}getContext(){return this.$context||(this.$context=Nf(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return"boolean"===typeof n.hidden?!n.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const r=n?"show":"hide",s=this.getDatasetMeta(e),i=s.controller._resolveAnimations(void 0,r);wh(t)?(s.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),i.update(s,{visible:n}),this.update(t=>t.datasetIndex===e?r:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),xp.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),ef(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete xx[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(n,r)=>{t.addEventListener(this,n,r),e[n]=r},r=(e,t,n)=>{e.offsetX=t,e.offsetY=n,this._eventHandler(e)};ch(this.options.events,e=>n(e,r))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(n,r)=>{t.addEventListener(this,n,r),e[n]=r},r=(n,r)=>{e[n]&&(t.removeEventListener(this,n,r),delete e[n])},s=(e,t)=>{this.canvas&&this.resize(e,t)};let i;const a=()=>{r("attach",a),this.attached=!0,this.resize(),n("resize",s),n("detach",i)};i=()=>{this.attached=!1,r("resize",s),this._stop(),this._resize(0,0),n("attach",a)},t.isAttached(this.canvas)?a():i()}unbindEvents(){ch(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},ch(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const r=n?"set":"remove";let s,i,a,o;for("dataset"===t&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+r+"DatasetHoverStyle"]()),a=0,o=e.length;a<o;++a){i=e[a];const t=i&&this.getDatasetMeta(i.datasetIndex).controller;t&&t[r+"HoverStyle"](i.element,i.datasetIndex,i.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(e=>{let{datasetIndex:t,index:n}=e;const r=this.getDatasetMeta(t);if(!r)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:r.data[n],index:n}});!dh(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}_updateHoverStyles(e,t,n){const r=this.options.hover,s=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),i=s(t,e),a=n?e:s(e,t);i.length&&this.updateHoverStyle(i,r.mode,!1),a.length&&r.mode&&this.updateHoverStyle(a,r.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},r=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",n,r))return;const s=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,r),(s||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:r=[],options:s}=this,i=t,a=this._getActiveElements(e,r,n,i),o=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,n,r){return n&&"mouseout"!==e.type?r?t:e:null}(e,this._lastEvent,n,o);n&&(this._lastEvent=null,lh(s.onHover,[e,a,this],this),o&&lh(s.onClick,[e,a,this],this));const c=!dh(a,r);return(c||t)&&(this._active=a,this._updateHoverStyles(a,r,t)),this._lastEvent=l,c}_getActiveElements(e,t,n,r){if("mouseout"===e.type)return[];if(!n)return t;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,r)}}const vx=()=>ch(wx.instances,e=>e._plugins.invalidate()),Nx=!0;function Sx(e,t,n){const{startAngle:r,pixelMargin:s,x:i,y:a,outerRadius:o,innerRadius:l}=t;let c=s/o;e.beginPath(),e.arc(i,a,o,r-c,n+c),l>s?(c=s/l,e.arc(i,a,l,n+c,r-c,!0)):e.arc(i,a,s,n+Eh,r-Eh),e.closePath(),e.clip()}function Ax(e,t,n,r){const s=gf(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const i=(n-t)/2,a=Math.min(i,r*t/2),o=e=>{const t=(n-Math.min(i,e))*r/2;return Wh(e,0,Math.min(i,t))};return{outerStart:o(s.outerStart),outerEnd:o(s.outerEnd),innerStart:Wh(s.innerStart,0,a),innerEnd:Wh(s.innerEnd,0,a)}}function _x(e,t,n,r){return{x:n+e*Math.cos(t),y:r+e*Math.sin(t)}}function Cx(e,t,n,r,s,i){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+r+n-c,0),h=d>0?d+r+n+c:0;let m=0;const f=s-l;if(r){const e=((d>0?d-r:0)+(u>0?u-r:0))/2;m=(f-(0!==e?f*e/(e+r):f))/2}const p=(f-Math.max(.001,f*u-n/Sh)/u)/2,g=l+p+m,x=s-p-m,{outerStart:y,outerEnd:b,innerStart:w,innerEnd:v}=Ax(t,h,u,x-g),N=u-y,S=u-b,A=g+y/N,_=x-b/S,C=h+w,I=h+v,E=g+w/C,T=x-v/I;if(e.beginPath(),i){if(e.arc(a,o,u,A,_),b>0){const t=_x(S,_,a,o);e.arc(t.x,t.y,b,_,x+Eh)}const t=_x(I,x,a,o);if(e.lineTo(t.x,t.y),v>0){const t=_x(I,T,a,o);e.arc(t.x,t.y,v,x+Eh,T+Math.PI)}if(e.arc(a,o,h,x-v/h,g+w/h,!0),w>0){const t=_x(C,E,a,o);e.arc(t.x,t.y,w,E+Math.PI,g-Eh)}const n=_x(N,g,a,o);if(e.lineTo(n.x,n.y),y>0){const t=_x(N,A,a,o);e.arc(t.x,t.y,y,g-Eh,A)}}else{e.moveTo(a,o);const t=Math.cos(A)*u+a,n=Math.sin(A)*u+o;e.lineTo(t,n);const r=Math.cos(_)*u+a,s=Math.sin(_)*u+o;e.lineTo(r,s)}e.closePath()}function Ix(e,t,n,r,s,i){const{options:a}=t,{borderWidth:o,borderJoinStyle:l}=a,c="inner"===a.borderAlign;o&&(c?(e.lineWidth=2*o,e.lineJoin=l||"round"):(e.lineWidth=o,e.lineJoin=l||"bevel"),t.fullCircles&&function(e,t,n){const{x:r,y:s,startAngle:i,pixelMargin:a,fullCircles:o}=t,l=Math.max(t.outerRadius-a,0),c=t.innerRadius+a;let d;for(n&&Sx(e,t,i+Ah),e.beginPath(),e.arc(r,s,c,i+Ah,i,!0),d=0;d<o;++d)e.stroke();for(e.beginPath(),e.arc(r,s,l,i,i+Ah),d=0;d<o;++d)e.stroke()}(e,t,c),c&&Sx(e,t,s),Cx(e,t,n,r,s,i),e.stroke())}Object.defineProperties(wx,{defaults:{enumerable:Nx,value:Km},instances:{enumerable:Nx,value:xx},overrides:{enumerable:Nx,value:Gm},registry:{enumerable:Nx,value:cg},version:{enumerable:Nx,value:"3.9.1"},getChart:{enumerable:Nx,value:yx},register:{enumerable:Nx,value:function(){cg.add(...arguments),vx()}},unregister:{enumerable:Nx,value:function(){cg.remove(...arguments),vx()}}});class Ex extends Kp{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){const r=this.getProps(["x","y"],n),{angle:s,distance:i}=Uh(r,{x:e,y:t}),{startAngle:a,endAngle:o,innerRadius:l,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),u=this.options.spacing/2,h=ah(d,o-a)>=Ah||Vh(s,a,o),m=Gh(i,l+u,c+u);return h&&m}getCenterPoint(e){const{x:t,y:n,startAngle:r,endAngle:s,innerRadius:i,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:o,spacing:l}=this.options,c=(r+s)/2,d=(i+a+l+o)/2;return{x:t+Math.cos(c)*d,y:n+Math.sin(c)*d}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:n}=this,r=(t.offset||0)/2,s=(t.spacing||0)/2,i=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=n>Ah?Math.floor(n/Ah):0,0===n||this.innerRadius<0||this.outerRadius<0)return;e.save();let a=0;if(r){a=r/2;const t=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(t)*a,Math.sin(t)*a),this.circumference>=Sh&&(a=r)}e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor;const o=function(e,t,n,r,s){const{fullCircles:i,startAngle:a,circumference:o}=t;let l=t.endAngle;if(i){Cx(e,t,n,r,a+Ah,s);for(let t=0;t<i;++t)e.fill();isNaN(o)||(l=a+o%Ah,o%Ah===0&&(l+=Ah))}return Cx(e,t,n,r,l,s),e.fill(),l}(e,this,a,s,i);Ix(e,this,a,s,o,i),e.restore()}}function Tx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;e.lineCap=ah(n.borderCapStyle,t.borderCapStyle),e.setLineDash(ah(n.borderDash,t.borderDash)),e.lineDashOffset=ah(n.borderDashOffset,t.borderDashOffset),e.lineJoin=ah(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=ah(n.borderWidth,t.borderWidth),e.strokeStyle=ah(n.borderColor,t.borderColor)}function jx(e,t,n){e.lineTo(n.x,n.y)}function kx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.length,{start:s=0,end:i=r-1}=n,{start:a,end:o}=t,l=Math.max(s,a),c=Math.min(i,o),d=s<a&&i<a||s>o&&i>o;return{count:r,start:l,loop:t.loop,ilen:c<l&&!d?r+c-l:c-l}}function Dx(e,t,n,r){const{points:s,options:i}=t,{count:a,start:o,loop:l,ilen:c}=kx(s,n,r),d=function(e){return e.stepped?of:e.tension||"monotone"===e.cubicInterpolationMode?lf:jx}(i);let u,h,m,{move:f=!0,reverse:p}=r||{};for(u=0;u<=c;++u)h=s[(o+(p?c-u:u))%a],h.skip||(f?(e.moveTo(h.x,h.y),f=!1):d(e,m,h,p,i.stepped),m=h);return l&&(h=s[(o+(p?c:0))%a],d(e,m,h,p,i.stepped)),!!l}function Px(e,t,n,r){const s=t.points,{count:i,start:a,ilen:o}=kx(s,n,r),{move:l=!0,reverse:c}=r||{};let d,u,h,m,f,p,g=0,x=0;const y=e=>(a+(c?o-e:e))%i,b=()=>{m!==f&&(e.lineTo(g,f),e.lineTo(g,m),e.lineTo(g,p))};for(l&&(u=s[y(0)],e.moveTo(u.x,u.y)),d=0;d<=o;++d){if(u=s[y(d)],u.skip)continue;const t=u.x,n=u.y,r=0|t;r===h?(n<m?m=n:n>f&&(f=n),g=(x*g+t)/++x):(b(),e.lineTo(t,n),h=r,x=0,m=f=n),p=n}b()}function Rx(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&"monotone"!==t.cubicInterpolationMode&&!t.stepped&&!n?Px:Dx}Ex.id="arc",Ex.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0},Ex.defaultRoutes={backgroundColor:"backgroundColor"};const Ox="function"===typeof Path2D;function Lx(e,t,n,r){Ox&&!t.options.segment?function(e,t,n,r){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,r)&&s.closePath()),Tx(e,t.options),e.stroke(s)}(e,t,n,r):function(e,t,n,r){const{segments:s,options:i}=t,a=Rx(t);for(const o of s)Tx(e,i,o.style),e.beginPath(),a(e,t,o,{start:n,end:n+r-1})&&e.closePath(),e.stroke()}(e,t,n,r)}class Mx extends Kp{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const r=n.spanGaps?this._loop:this._fullLoop;Hf(this._points,n,e,r,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const n=e.points,r=e.options.spanGaps,s=n.length;if(!s)return[];const i=!!e._loop,{start:a,end:o}=function(e,t,n,r){let s=0,i=t-1;if(n&&!r)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(i+=s);i>s&&e[i%t].skip;)i--;return i%=t,{start:s,end:i}}(n,s,i,r);return fp(e,!0===r?[{start:a,end:o,loop:i}]:function(e,t,n,r){const s=e.length,i=[];let a,o=t,l=e[t];for(a=t+1;a<=n;++a){const n=e[a%s];n.skip||n.stop?l.skip||(r=!1,i.push({start:t%s,end:(a-1)%s,loop:r}),t=o=n.stop?a:null):(o=a,l.skip&&(t=a)),l=n}return null!==o&&i.push({start:t%s,end:o%s,loop:r}),i}(n,a,o<a?o+s:o,!!e._fullLoop&&0===a&&o===s-1),n,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,r=e[t],s=this.points,i=mp(this,{property:t,start:r,end:r});if(!i.length)return;const a=[],o=function(e){return e.stepped?rp:e.tension||"monotone"===e.cubicInterpolationMode?sp:np}(n);let l,c;for(l=0,c=i.length;l<c;++l){const{start:c,end:d}=i[l],u=s[c],h=s[d];if(u===h){a.push(u);continue}const m=o(u,h,Math.abs((r-u[t])/(h[t]-u[t])),n.stepped);m[t]=e[t],a.push(m)}return 1===a.length?a[0]:a}pathSegment(e,t,n){return Rx(this)(e,this,t,n)}path(e,t,n){const r=this.segments,s=Rx(this);let i=this._loop;t=t||0,n=n||this.points.length-t;for(const a of r)i&=s(e,this,a,{start:t,end:t+n-1});return!!i}draw(e,t,n,r){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),Lx(e,this,n,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Fx(e,t,n,r){const s=e.options,{[n]:i}=e.getProps([n],r);return Math.abs(t-i)<s.radius+s.hitRadius}Mx.id="line",Mx.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},Mx.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},Mx.descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};class Bx extends Kp{constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,n){const r=this.options,{x:s,y:i}=this.getProps(["x","y"],n);return Math.pow(e-s,2)+Math.pow(t-i,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,t){return Fx(this,e,"x",t)}inYRange(e,t){return Fx(this,e,"y",t)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const n=this.options;this.skip||n.radius<.1||!rf(this,t,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,tf(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function Ux(e,t){const{x:n,y:r,base:s,width:i,height:a}=e.getProps(["x","y","base","width","height"],t);let o,l,c,d,u;return e.horizontal?(u=a/2,o=Math.min(n,s),l=Math.max(n,s),c=r-u,d=r+u):(u=i/2,o=n-u,l=n+u,c=Math.min(r,s),d=Math.max(r,s)),{left:o,top:c,right:l,bottom:d}}function zx(e,t,n,r){return e?0:Wh(t,n,r)}function qx(e){const t=Ux(e),n=t.right-t.left,r=t.bottom-t.top,s=function(e,t,n){const r=e.options.borderWidth,s=e.borderSkipped,i=xf(r);return{t:zx(s.top,i.top,0,n),r:zx(s.right,i.right,0,t),b:zx(s.bottom,i.bottom,0,n),l:zx(s.left,i.left,0,t)}}(e,n/2,r/2),i=function(e,t,n){const{enableBorderRadius:r}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,i=yf(s),a=Math.min(t,n),o=e.borderSkipped,l=r||rh(s);return{topLeft:zx(!l||o.top||o.left,i.topLeft,0,a),topRight:zx(!l||o.top||o.right,i.topRight,0,a),bottomLeft:zx(!l||o.bottom||o.left,i.bottomLeft,0,a),bottomRight:zx(!l||o.bottom||o.right,i.bottomRight,0,a)}}(e,n/2,r/2);return{outer:{x:t.left,y:t.top,w:n,h:r,radius:i},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:r-s.t-s.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,i.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(s.b,s.r))}}}}function Hx(e,t,n,r){const s=null===t,i=null===n,a=e&&!(s&&i)&&Ux(e,r);return a&&(s||Gh(t,a.left,a.right))&&(i||Gh(n,a.top,a.bottom))}function Vx(e,t){e.rect(t.x,t.y,t.w,t.h)}function Wx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,i=(e.x+e.w!==n.x+n.w?t:0)-r,a=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+r,y:e.y+s,w:e.w+i,h:e.h+a,radius:e.radius}}Bx.id="point",Bx.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},Bx.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class Gx extends Kp{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:r}}=this,{inner:s,outer:i}=qx(this),a=(o=i.radius).topLeft||o.topRight||o.bottomLeft||o.bottomRight?uf:Vx;var o;e.save(),i.w===s.w&&i.h===s.h||(e.beginPath(),a(e,Wx(i,t,s)),e.clip(),a(e,Wx(s,-t,i)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),a(e,Wx(s,t)),e.fillStyle=r,e.fill(),e.restore()}inRange(e,t,n){return Hx(this,e,t,n)}inXRange(e,t){return Hx(this,e,null,t)}inYRange(e,t){return Hx(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:r,horizontal:s}=this.getProps(["x","y","base","horizontal"],e);return{x:s?(t+r)/2:t,y:s?n:(n+r)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}Gx.id="bar",Gx.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Gx.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};const Yx=(e,t)=>{let{boxHeight:n=t,boxWidth:r=t}=e;return e.usePointStyle&&(n=Math.min(n,t),r=e.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(t,n)}};class Xx extends Kp{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=lh(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,n)=>e.sort(t,n,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const n=e.labels,r=wf(n.font),s=r.size,i=this._computeTitleHeight(),{boxWidth:a,itemHeight:o}=Yx(n,s);let l,c;t.font=r.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(i,s,a,o)+10):(c=this.maxHeight,l=this._fitCols(i,s,a,o)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,r){const{ctx:s,maxWidth:i,options:{labels:{padding:a}}}=this,o=this.legendHitBoxes=[],l=this.lineWidths=[0],c=r+a;let d=e;s.textAlign="left",s.textBaseline="middle";let u=-1,h=-c;return this.legendItems.forEach((e,m)=>{const f=n+t/2+s.measureText(e.text).width;(0===m||l[l.length-1]+f+2*a>i)&&(d+=c,l[l.length-(m>0?0:1)]=0,h+=c,u++),o[m]={left:0,top:h,row:u,width:f,height:r},l[l.length-1]+=f+a}),d}_fitCols(e,t,n,r){const{ctx:s,maxHeight:i,options:{labels:{padding:a}}}=this,o=this.legendHitBoxes=[],l=this.columnSizes=[],c=i-e;let d=a,u=0,h=0,m=0,f=0;return this.legendItems.forEach((e,i)=>{const p=n+t/2+s.measureText(e.text).width;i>0&&h+r+2*a>c&&(d+=u+a,l.push({width:u,height:h}),m+=u+a,f++,u=h=0),o[i]={left:m,top:h,col:f,width:p,height:r},u=Math.max(u,p),h+=r+a}),d+=u,l.push({width:u,height:h}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:r},rtl:s}}=this,i=op(s,this.left,this.width);if(this.isHorizontal()){let s=0,a=nm(n,this.left+r,this.right-this.lineWidths[s]);for(const o of t)s!==o.row&&(s=o.row,a=nm(n,this.left+r,this.right-this.lineWidths[s])),o.top+=this.top+e+r,o.left=i.leftForLtr(i.x(a),o.width),a+=o.width+r}else{let s=0,a=nm(n,this.top+e+r,this.bottom-this.columnSizes[s].height);for(const o of t)o.col!==s&&(s=o.col,a=nm(n,this.top+e+r,this.bottom-this.columnSizes[s].height)),o.top=a,o.left+=this.left+r,o.left=i.leftForLtr(i.x(o.left),o.width),a+=o.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;sf(e,this),this._draw(),af(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:r}=this,{align:s,labels:i}=e,a=Km.color,o=op(e.rtl,this.left,this.width),l=wf(i.font),{color:c,padding:d}=i,u=l.size,h=u/2;let m;this.drawTitle(),r.textAlign=o.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=l.string;const{boxWidth:f,boxHeight:p,itemHeight:g}=Yx(i,u),x=this.isHorizontal(),y=this._computeTitleHeight();m=x?{x:nm(s,this.left+d,this.right-n[0]),y:this.top+d+y,line:0}:{x:this.left+d,y:nm(s,this.top+y+d,this.bottom-t[0].height),line:0},lp(this.ctx,e.textDirection);const b=g+d;this.legendItems.forEach((w,v)=>{r.strokeStyle=w.fontColor||c,r.fillStyle=w.fontColor||c;const N=r.measureText(w.text).width,S=o.textAlign(w.textAlign||(w.textAlign=i.textAlign)),A=f+h+N;let _=m.x,C=m.y;o.setWidth(this.width),x?v>0&&_+A+d>this.right&&(C=m.y+=b,m.line++,_=m.x=nm(s,this.left+d,this.right-n[m.line])):v>0&&C+b>this.bottom&&(_=m.x=_+t[m.line].width+d,m.line++,C=m.y=nm(s,this.top+y+d,this.bottom-t[m.line].height));!function(e,t,n){if(isNaN(f)||f<=0||isNaN(p)||p<0)return;r.save();const s=ah(n.lineWidth,1);if(r.fillStyle=ah(n.fillStyle,a),r.lineCap=ah(n.lineCap,"butt"),r.lineDashOffset=ah(n.lineDashOffset,0),r.lineJoin=ah(n.lineJoin,"miter"),r.lineWidth=s,r.strokeStyle=ah(n.strokeStyle,a),r.setLineDash(ah(n.lineDash,[])),i.usePointStyle){const a={radius:p*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:s},l=o.xPlus(e,f/2);nf(r,a,l,t+h,i.pointStyleWidth&&f)}else{const i=t+Math.max((u-p)/2,0),a=o.leftForLtr(e,f),l=yf(n.borderRadius);r.beginPath(),Object.values(l).some(e=>0!==e)?uf(r,{x:a,y:i,w:f,h:p,radius:l}):r.rect(a,i,f,p),r.fill(),0!==s&&r.stroke()}r.restore()}(o.x(_),C,w),_=((e,t,n,r)=>e===(r?"left":"right")?n:"center"===e?(t+n)/2:t)(S,_+f+h,x?_+A:this.right,e.rtl),function(e,t,n){cf(r,n.text,e,t+g/2,l,{strikethrough:n.hidden,textAlign:o.textAlign(n.textAlign)})}(o.x(_),C,w),x?m.x+=A+d:m.y+=b}),cp(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=wf(t.font),r=bf(t.padding);if(!t.display)return;const s=op(e.rtl,this.left,this.width),i=this.ctx,a=t.position,o=n.size/2,l=r.top+o;let c,d=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),c=this.top+l,d=nm(e.align,d,this.right-u);else{const t=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);c=l+nm(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const h=nm(a,d,d+u);i.textAlign=s.textAlign(tm(a)),i.textBaseline="middle",i.strokeStyle=t.color,i.fillStyle=t.color,i.font=n.string,cf(i,t.text,h,c,n)}_computeTitleHeight(){const e=this.options.title,t=wf(e.font),n=bf(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,r,s;if(Gh(e,this.left,this.right)&&Gh(t,this.top,this.bottom))for(s=this.legendHitBoxes,n=0;n<s.length;++n)if(r=s[n],Gh(e,r.left,r.left+r.width)&&Gh(t,r.top,r.top+r.height))return this.legendItems[n];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const r=this._hoveredItem,s=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(r,n);r&&!s&&lh(t.onLeave,[e,r,this],this),this._hoveredItem=n,n&&!s&&lh(t.onHover,[e,n,this],this)}else n&&lh(t.onClick,[e,n,this],this)}}var Qx={id:"legend",_element:Xx,start(e,t,n){const r=e.legend=new Xx({ctx:e.ctx,options:n,chart:e});Pg.configure(e,r,n),Pg.addBox(e,r)},stop(e){Pg.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const r=e.legend;Pg.configure(e,r,n),r.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const r=t.datasetIndex,s=n.chart;s.isDatasetVisible(r)?(s.hide(r),t.hidden=!0):(s.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:s,color:i}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{const a=e.controller.getStyle(n?0:void 0),o=bf(a.borderWidth);return{text:t[e.index].label,fillStyle:a.backgroundColor,fontColor:i,hidden:!e.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(o.width+o.height)/4,strokeStyle:a.borderColor,pointStyle:r||a.pointStyle,rotation:a.rotation,textAlign:s||a.textAlign,borderRadius:0,datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class Kx extends Kp{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const r=nh(n.text)?n.text.length:1;this._padding=bf(n.padding);const s=r*wf(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:n,bottom:r,right:s,options:i}=this,a=i.align;let o,l,c,d=0;return this.isHorizontal()?(l=nm(a,n,s),c=t+e,o=s-n):("left"===i.position?(l=n+e,c=nm(a,r,t),d=-.5*Sh):(l=s-e,c=nm(a,t,r),d=.5*Sh),o=r-t),{titleX:l,titleY:c,maxWidth:o,rotation:d}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=wf(t.font),r=n.lineHeight/2+this._padding.top,{titleX:s,titleY:i,maxWidth:a,rotation:o}=this._drawArgs(r);cf(e,t.text,0,0,n,{color:t.color,maxWidth:a,rotation:o,textAlign:tm(t.align),textBaseline:"middle",translation:[s,i]})}}var Zx={id:"title",_element:Kx,start(e,t,n){!function(e,t){const n=new Kx({ctx:e.ctx,options:t,chart:e});Pg.configure(e,n,t),Pg.addBox(e,n),e.titleBlock=n}(e,n)},stop(e){const t=e.titleBlock;Pg.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const r=e.titleBlock;Pg.configure(e,r,n),r.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const Jx={average(e){if(!e.length)return!1;let t,n,r=0,s=0,i=0;for(t=0,n=e.length;t<n;++t){const n=e[t].element;if(n&&n.hasValue()){const e=n.tooltipPosition();r+=e.x,s+=e.y,++i}}return{x:r/i,y:s/i}},nearest(e,t){if(!e.length)return!1;let n,r,s,i=t.x,a=t.y,o=Number.POSITIVE_INFINITY;for(n=0,r=e.length;n<r;++n){const r=e[n].element;if(r&&r.hasValue()){const e=zh(t,r.getCenterPoint());e<o&&(o=e,s=r)}}if(s){const e=s.tooltipPosition();i=e.x,a=e.y}return{x:i,y:a}}};function $x(e,t){return t&&(nh(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function ey(e){return("string"===typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function ty(e,t){const{element:n,datasetIndex:r,index:s}=t,i=e.getDatasetMeta(r).controller,{label:a,value:o}=i.getLabelAndValue(s);return{chart:e,label:a,parsed:i.getParsed(s),raw:e.data.datasets[r].data[s],formattedValue:o,dataset:i.getDataset(),dataIndex:s,datasetIndex:r,element:n}}function ny(e,t){const n=e.chart.ctx,{body:r,footer:s,title:i}=e,{boxWidth:a,boxHeight:o}=t,l=wf(t.bodyFont),c=wf(t.titleFont),d=wf(t.footerFont),u=i.length,h=s.length,m=r.length,f=bf(t.padding);let p=f.height,g=0,x=r.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);if(x+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),x){p+=m*(t.displayColors?Math.max(o,l.lineHeight):l.lineHeight)+(x-m)*l.lineHeight+(x-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const b=function(e){g=Math.max(g,n.measureText(e).width+y)};return n.save(),n.font=c.string,ch(e.title,b),n.font=l.string,ch(e.beforeBody.concat(e.afterBody),b),y=t.displayColors?a+2+t.boxPadding:0,ch(r,e=>{ch(e.before,b),ch(e.lines,b),ch(e.after,b)}),y=0,n.font=d.string,ch(e.footer,b),n.restore(),g+=f.width,{width:g,height:p}}function ry(e,t,n,r){const{x:s,width:i}=n,{width:a,chartArea:{left:o,right:l}}=e;let c="center";return"center"===r?c=s<=(o+l)/2?"left":"right":s<=i/2?c="left":s>=a-i/2&&(c="right"),function(e,t,n,r){const{x:s,width:i}=r,a=n.caretSize+n.caretPadding;return"left"===e&&s+i+a>t.width||"right"===e&&s-i-a<0||void 0}(c,e,t,n)&&(c="center"),c}function sy(e,t,n){const r=n.yAlign||t.yAlign||function(e,t){const{y:n,height:r}=t;return n<r/2?"top":n>e.height-r/2?"bottom":"center"}(e,n);return{xAlign:n.xAlign||t.xAlign||ry(e,t,n,r),yAlign:r}}function iy(e,t,n,r){const{caretSize:s,caretPadding:i,cornerRadius:a}=e,{xAlign:o,yAlign:l}=n,c=s+i,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:m}=yf(a);let f=function(e,t){let{x:n,width:r}=e;return"right"===t?n-=r:"center"===t&&(n-=r/2),n}(t,o);const p=function(e,t,n){let{y:r,height:s}=e;return"top"===t?r+=n:r-="bottom"===t?s+n:s/2,r}(t,l,c);return"center"===l?"left"===o?f+=c:"right"===o&&(f-=c):"left"===o?f-=Math.max(d,h)+s:"right"===o&&(f+=Math.max(u,m)+s),{x:Wh(f,0,r.width-t.width),y:Wh(p,0,r.height-t.height)}}function ay(e,t,n){const r=bf(n.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-r.right:e.x+r.left}function oy(e){return $x([],ey(e))}function ly(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}class cy extends Kp{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart||e._chart,this._chart=this.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),r=n.enabled&&t.options.animation&&n.animations,s=new Np(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=(e=this.chart.getContext(),t=this,n=this._tooltipItems,Nf(e,{tooltip:t,tooltipItems:n,type:"tooltip"})));var e,t,n}getTitle(e,t){const{callbacks:n}=t,r=n.beforeTitle.apply(this,[e]),s=n.title.apply(this,[e]),i=n.afterTitle.apply(this,[e]);let a=[];return a=$x(a,ey(r)),a=$x(a,ey(s)),a=$x(a,ey(i)),a}getBeforeBody(e,t){return oy(t.callbacks.beforeBody.apply(this,[e]))}getBody(e,t){const{callbacks:n}=t,r=[];return ch(e,e=>{const t={before:[],lines:[],after:[]},s=ly(n,e);$x(t.before,ey(s.beforeLabel.call(this,e))),$x(t.lines,s.label.call(this,e)),$x(t.after,ey(s.afterLabel.call(this,e))),r.push(t)}),r}getAfterBody(e,t){return oy(t.callbacks.afterBody.apply(this,[e]))}getFooter(e,t){const{callbacks:n}=t,r=n.beforeFooter.apply(this,[e]),s=n.footer.apply(this,[e]),i=n.afterFooter.apply(this,[e]);let a=[];return a=$x(a,ey(r)),a=$x(a,ey(s)),a=$x(a,ey(i)),a}_createItems(e){const t=this._active,n=this.chart.data,r=[],s=[],i=[];let a,o,l=[];for(a=0,o=t.length;a<o;++a)l.push(ty(this.chart,t[a]));return e.filter&&(l=l.filter((t,r,s)=>e.filter(t,r,s,n))),e.itemSort&&(l=l.sort((t,r)=>e.itemSort(t,r,n))),ch(l,t=>{const n=ly(e.callbacks,t);r.push(n.labelColor.call(this,t)),s.push(n.labelPointStyle.call(this,t)),i.push(n.labelTextColor.call(this,t))}),this.labelColors=r,this.labelPointStyles=s,this.labelTextColors=i,this.dataPoints=l,l}update(e,t){const n=this.options.setContext(this.getContext()),r=this._active;let s,i=[];if(r.length){const e=Jx[n.position].call(this,r,this._eventPosition);i=this._createItems(n),this.title=this.getTitle(i,n),this.beforeBody=this.getBeforeBody(i,n),this.body=this.getBody(i,n),this.afterBody=this.getAfterBody(i,n),this.footer=this.getFooter(i,n);const t=this._size=ny(this,n),a=Object.assign({},e,t),o=sy(this.chart,n,a),l=iy(n,a,o,this.chart);this.xAlign=o.xAlign,this.yAlign=o.yAlign,s={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=i,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,r){const s=this.getCaretPosition(e,n,r);t.lineTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.lineTo(s.x3,s.y3)}getCaretPosition(e,t,n){const{xAlign:r,yAlign:s}=this,{caretSize:i,cornerRadius:a}=n,{topLeft:o,topRight:l,bottomLeft:c,bottomRight:d}=yf(a),{x:u,y:h}=e,{width:m,height:f}=t;let p,g,x,y,b,w;return"center"===s?(b=h+f/2,"left"===r?(p=u,g=p-i,y=b+i,w=b-i):(p=u+m,g=p+i,y=b-i,w=b+i),x=p):(g="left"===r?u+Math.max(o,c)+i:"right"===r?u+m-Math.max(l,d)-i:this.caretX,"top"===s?(y=h,b=y-i,p=g-i,x=g+i):(y=h+f,b=y+i,p=g+i,x=g-i),w=y),{x1:p,x2:g,x3:x,y1:y,y2:b,y3:w}}drawTitle(e,t,n){const r=this.title,s=r.length;let i,a,o;if(s){const l=op(n.rtl,this.x,this.width);for(e.x=ay(this,n.titleAlign,n),t.textAlign=l.textAlign(n.titleAlign),t.textBaseline="middle",i=wf(n.titleFont),a=n.titleSpacing,t.fillStyle=n.titleColor,t.font=i.string,o=0;o<s;++o)t.fillText(r[o],l.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+a,o+1===s&&(e.y+=n.titleMarginBottom-a)}}_drawColorBox(e,t,n,r,s){const i=this.labelColors[n],a=this.labelPointStyles[n],{boxHeight:o,boxWidth:l,boxPadding:c}=s,d=wf(s.bodyFont),u=ay(this,"left",s),h=r.x(u),m=o<d.lineHeight?(d.lineHeight-o)/2:0,f=t.y+m;if(s.usePointStyle){const t={radius:Math.min(l,o)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},n=r.leftForLtr(h,l)+l/2,c=f+o/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,tf(e,t,n,c),e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,tf(e,t,n,c)}else{e.lineWidth=rh(i.borderWidth)?Math.max(...Object.values(i.borderWidth)):i.borderWidth||1,e.strokeStyle=i.borderColor,e.setLineDash(i.borderDash||[]),e.lineDashOffset=i.borderDashOffset||0;const t=r.leftForLtr(h,l-c),n=r.leftForLtr(r.xPlus(h,1),l-c-2),a=yf(i.borderRadius);Object.values(a).some(e=>0!==e)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,uf(e,{x:t,y:f,w:l,h:o,radius:a}),e.fill(),e.stroke(),e.fillStyle=i.backgroundColor,e.beginPath(),uf(e,{x:n,y:f+1,w:l-2,h:o-2,radius:a}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(t,f,l,o),e.strokeRect(t,f,l,o),e.fillStyle=i.backgroundColor,e.fillRect(n,f+1,l-2,o-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:r}=this,{bodySpacing:s,bodyAlign:i,displayColors:a,boxHeight:o,boxWidth:l,boxPadding:c}=n,d=wf(n.bodyFont);let u=d.lineHeight,h=0;const m=op(n.rtl,this.x,this.width),f=function(n){t.fillText(n,m.x(e.x+h),e.y+u/2),e.y+=u+s},p=m.textAlign(i);let g,x,y,b,w,v,N;for(t.textAlign=i,t.textBaseline="middle",t.font=d.string,e.x=ay(this,p,n),t.fillStyle=n.bodyColor,ch(this.beforeBody,f),h=a&&"right"!==p?"center"===i?l/2+c:l+2+c:0,b=0,v=r.length;b<v;++b){for(g=r[b],x=this.labelTextColors[b],t.fillStyle=x,ch(g.before,f),y=g.lines,a&&y.length&&(this._drawColorBox(t,e,b,m,n),u=Math.max(d.lineHeight,o)),w=0,N=y.length;w<N;++w)f(y[w]),u=d.lineHeight;ch(g.after,f)}h=0,u=d.lineHeight,ch(this.afterBody,f),e.y-=s}drawFooter(e,t,n){const r=this.footer,s=r.length;let i,a;if(s){const o=op(n.rtl,this.x,this.width);for(e.x=ay(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=o.textAlign(n.footerAlign),t.textBaseline="middle",i=wf(n.footerFont),t.fillStyle=n.footerColor,t.font=i.string,a=0;a<s;++a)t.fillText(r[a],o.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+n.footerSpacing}}drawBackground(e,t,n,r){const{xAlign:s,yAlign:i}=this,{x:a,y:o}=e,{width:l,height:c}=n,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:m}=yf(r.cornerRadius);t.fillStyle=r.backgroundColor,t.strokeStyle=r.borderColor,t.lineWidth=r.borderWidth,t.beginPath(),t.moveTo(a+d,o),"top"===i&&this.drawCaret(e,t,n,r),t.lineTo(a+l-u,o),t.quadraticCurveTo(a+l,o,a+l,o+u),"center"===i&&"right"===s&&this.drawCaret(e,t,n,r),t.lineTo(a+l,o+c-m),t.quadraticCurveTo(a+l,o+c,a+l-m,o+c),"bottom"===i&&this.drawCaret(e,t,n,r),t.lineTo(a+h,o+c),t.quadraticCurveTo(a,o+c,a,o+c-h),"center"===i&&"left"===s&&this.drawCaret(e,t,n,r),t.lineTo(a,o+d),t.quadraticCurveTo(a,o,a+d,o),t.closePath(),t.fill(),r.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,r=n&&n.x,s=n&&n.y;if(r||s){const n=Jx[e.position].call(this,this._active,this._eventPosition);if(!n)return;const i=this._size=ny(this,e),a=Object.assign({},n,this._size),o=sy(t,e,a),l=iy(e,a,o,t);r._to===l.x&&s._to===l.y||(this.xAlign=o.xAlign,this.yAlign=o.yAlign,this.width=i.width,this.height=i.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const r={width:this.width,height:this.height},s={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const i=bf(t.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&a&&(e.save(),e.globalAlpha=n,this.drawBackground(s,e,r,t),lp(e,t.textDirection),s.y+=i.top,this.drawTitle(s,e,t),this.drawBody(s,e,t),this.drawFooter(s,e,t),cp(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,r=e.map(e=>{let{datasetIndex:t,index:n}=e;const r=this.chart.getDatasetMeta(t);if(!r)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:r.data[n],index:n}}),s=!dh(n,r),i=this._positionChanged(r,t);(s||i)&&(this._active=r,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,s=this._active||[],i=this._getActiveElements(e,s,t,n),a=this._positionChanged(i,e),o=t||!dh(i,s)||a;return o&&(this._active=i,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),o}_getActiveElements(e,t,n,r){const s=this.options;if("mouseout"===e.type)return[];if(!r)return t;const i=this.chart.getElementsAtEventForMode(e,s.mode,s,n);return s.reverse&&i.reverse(),i}_positionChanged(e,t){const{caretX:n,caretY:r,options:s}=this,i=Jx[s.position].call(this,e,t);return!1!==i&&(n!==i.x||r!==i.y)}}cy.positioners=Jx;var dy={id:"tooltip",_element:cy,positioners:Jx,afterInit(e,t,n){n&&(e.tooltip=new cy({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",n))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:$u,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,r=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return n[t.dataIndex]}return""},afterTitle:$u,beforeBody:$u,beforeLabel:$u,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return th(n)||(t+=n),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:$u,afterBody:$u,beforeFooter:$u,footer:$u,afterFooter:$u}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function uy(e,t,n,r){const s=e.indexOf(t);if(-1===s)return((e,t,n,r)=>("string"===typeof t?(n=e.push(t)-1,r.unshift({index:n,label:t})):isNaN(t)&&(n=null),n))(e,t,n,r);return s!==e.lastIndexOf(t)?n:s}class hy extends og{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:n,label:r}of t)e[n]===r&&e.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(th(e))return null;const n=this.getLabels();return((e,t)=>null===e?null:Wh(Math.round(e),0,t))(t=isFinite(t)&&n[t]===e?t:uy(n,e,ah(t,e),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:r}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(n=0),t||(r=this.getLabels().length-1)),this.min=n,this.max=r}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,r=[];let s=this.getLabels();s=0===e&&t===s.length-1?s:s.slice(e,t+1),this._valueRange=Math.max(s.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let i=e;i<=t;i++)r.push({value:i});return r}getLabelForValue(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!==typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function my(e,t){const n=[],{bounds:r,step:s,min:i,max:a,precision:o,count:l,maxTicks:c,maxDigits:d,includeBounds:u}=e,h=s||1,m=c-1,{min:f,max:p}=t,g=!th(i),x=!th(a),y=!th(l),b=(p-f)/(d+1);let w,v,N,S,A=Ph((p-f)/m/h)*h;if(A<1e-14&&!g&&!x)return[{value:f},{value:p}];S=Math.ceil(p/A)-Math.floor(f/A),S>m&&(A=Ph(S*A/m/h)*h),th(o)||(w=Math.pow(10,o),A=Math.ceil(A*w)/w),"ticks"===r?(v=Math.floor(f/A)*A,N=Math.ceil(p/A)*A):(v=f,N=p),g&&x&&s&&function(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}((a-i)/s,A/1e3)?(S=Math.round(Math.min((a-i)/A,c)),A=(a-i)/S,v=i,N=a):y?(v=g?i:v,N=x?a:N,S=l-1,A=(N-v)/S):(S=(N-v)/A,S=Oh(S,Math.round(S),A/1e3)?Math.round(S):Math.ceil(S));const _=Math.max(Bh(A),Bh(v));w=Math.pow(10,th(o)?_:o),v=Math.round(v*w)/w,N=Math.round(N*w)/w;let C=0;for(g&&(u&&v!==i?(n.push({value:i}),v<i&&C++,Oh(Math.round((v+C*A)*w)/w,i,fy(i,b,e))&&C++):v<i&&C++);C<S;++C)n.push({value:Math.round((v+C*A)*w)/w});return x&&u&&N!==a?n.length&&Oh(n[n.length-1].value,a,fy(a,b,e))?n[n.length-1].value=a:n.push({value:a}):x&&N!==a||n.push({value:N}),n}function fy(e,t,n){let{horizontal:r,minRotation:s}=n;const i=Mh(s),a=(r?Math.sin(i):Math.cos(i))||.001,o=.75*t*(""+e).length;return Math.min(t/a,o)}hy.id="category",hy.defaults={ticks:{callback:hy.prototype.getLabelForValue}};class py extends og{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return th(e)||("number"===typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:r,max:s}=this;const i=e=>r=t?r:e,a=e=>s=n?s:e;if(e){const e=Dh(r),t=Dh(s);e<0&&t<0?a(0):e>0&&t>0&&i(0)}if(r===s){let t=1;(s>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(t=Math.abs(.05*s)),a(s+t),e||i(r-t)}this.min=r,this.max=s}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:n,stepSize:r}=e;return r?(t=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,t>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(r," would result generating up to ").concat(t," ticks. Limiting to 1000.")),t=1e3)):(t=this.computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const r=my({maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&Lh(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const r=(n-t)/Math.max(e.length-1,1)/2;t-=r,n+=r}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return ap(e,this.chart.options.locale,this.options.ticks.format)}}class gy extends py{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=sh(e)?e:0,this.max=sh(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=Mh(this.options.ticks.minRotation),r=(e?Math.sin(n):Math.cos(n))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,s.lineHeight/r))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}function xy(e){return 1===e/Math.pow(10,Math.floor(kh(e)))}gy.id="linear",gy.defaults={ticks:{callback:Jp.formatters.numeric}};class yy extends og{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=py.prototype.parse.apply(this,[e,t]);if(0!==n)return sh(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=sh(e)?Math.max(0,e):null,this.max=sh(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,r=this.max;const s=t=>n=e?n:t,i=e=>r=t?r:e,a=(e,t)=>Math.pow(10,Math.floor(kh(e))+t);n===r&&(n<=0?(s(1),i(10)):(s(a(n,-1)),i(a(r,1)))),n<=0&&s(a(r,-1)),r<=0&&i(a(n,1)),this._zero&&this.min!==this._suggestedMin&&n===a(this.min,0)&&s(a(n,-1)),this.min=n,this.max=r}buildTicks(){const e=this.options,t=function(e,t){const n=Math.floor(kh(t.max)),r=Math.ceil(t.max/Math.pow(10,n)),s=[];let i=ih(e.min,Math.pow(10,Math.floor(kh(t.min)))),a=Math.floor(kh(i)),o=Math.floor(i/Math.pow(10,a)),l=a<0?Math.pow(10,Math.abs(a)):1;do{s.push({value:i,major:xy(i)}),++o,10===o&&(o=1,++a,l=a>=0?1:l),i=Math.round(o*Math.pow(10,a)*l)/l}while(a<n||a===n&&o<r);const c=ih(e.max,i);return s.push({value:c,major:xy(i)}),s}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&Lh(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":ap(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=kh(e),this._valueRange=kh(this.max)-kh(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(kh(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function by(e){const t=e.ticks;if(t.display&&e.display){const e=bf(t.backdropPadding);return ah(t.font&&t.font.size,Km.font.size)+e.height}return 0}function wy(e,t,n){return n=nh(n)?n:[n],{w:Jm(e,t.string,n),h:n.length*t.lineHeight}}function vy(e,t,n,r,s){return e===r||e===s?{start:t-n/2,end:t+n/2}:e<r||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function Ny(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),r=[],s=[],i=e._pointLabels.length,a=e.options.pointLabels,o=a.centerPointLabels?Sh/i:0;for(let l=0;l<i;l++){const i=a.setContext(e.getPointLabelContext(l));s[l]=i.padding;const c=e.getPointPosition(l,e.drawingArea+s[l],o),d=wf(i.font),u=wy(e.ctx,d,e._pointLabels[l]);r[l]=u;const h=Hh(e.getIndexAngle(l)+o),m=Math.round(Fh(h));Sy(n,t,h,vy(m,c.x,u.w,0,180),vy(m,c.y,u.h,90,270))}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=function(e,t,n){const r=[],s=e._pointLabels.length,i=e.options,a=by(i)/2,o=e.drawingArea,l=i.pointLabels.centerPointLabels?Sh/s:0;for(let c=0;c<s;c++){const s=e.getPointPosition(c,o+a+n[c],l),i=Math.round(Fh(Hh(s.angle+Eh))),d=t[c],u=Cy(s.y,d.h,i),h=Ay(i),m=_y(s.x,d.w,h);r.push({x:s.x,y:u,textAlign:h,left:m,top:u,right:m+d.w,bottom:u+d.h})}return r}(e,r,s)}function Sy(e,t,n,r,s){const i=Math.abs(Math.sin(n)),a=Math.abs(Math.cos(n));let o=0,l=0;r.start<t.l?(o=(t.l-r.start)/i,e.l=Math.min(e.l,t.l-o)):r.end>t.r&&(o=(r.end-t.r)/i,e.r=Math.max(e.r,t.r+o)),s.start<t.t?(l=(t.t-s.start)/a,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/a,e.b=Math.max(e.b,t.b+l))}function Ay(e){return 0===e||180===e?"center":e<180?"left":"right"}function _y(e,t,n){return"right"===n?e-=t:"center"===n&&(e-=t/2),e}function Cy(e,t,n){return 90===n||270===n?e-=t/2:(n>270||n<90)&&(e-=t),e}function Iy(e,t,n,r){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,Ah);else{let n=e.getPointPosition(0,t);s.moveTo(n.x,n.y);for(let i=1;i<r;i++)n=e.getPointPosition(i,t),s.lineTo(n.x,n.y)}}yy.id="logarithmic",yy.defaults={ticks:{callback:Jp.formatters.logarithmic,major:{enabled:!0}}};class Ey extends py{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=bf(by(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=sh(e)&&!isNaN(e)?e:0,this.max=sh(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/by(this.options))}generateTickLabels(e){py.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((e,t)=>{const n=lh(this.options.pointLabels.callback,[e,t],this);return n||0===n?n:""}).filter((e,t)=>this.chart.getDataVisibility(t))}fit(){const e=this.options;e.display&&e.pointLabels.display?Ny(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,r){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,r))}getIndexAngle(e){return Hh(e*(Ah/(this._pointLabels.length||1))+Mh(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(th(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(th(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return function(e,t,n){return Nf(e,{label:n,index:t,type:"pointLabel"})}(this.getContext(),e,n)}}getPointPosition(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=this.getIndexAngle(e)-Eh+n;return{x:Math.cos(r)*t+this.xCenter,y:Math.sin(r)*t+this.yCenter,angle:r}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:r,bottom:s}=this._pointLabelItems[e];return{left:t,top:n,right:r,bottom:s}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),Iy(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:r}=t,s=this._pointLabels.length;let i,a,o;if(t.pointLabels.display&&function(e,t){const{ctx:n,options:{pointLabels:r}}=e;for(let s=t-1;s>=0;s--){const t=r.setContext(e.getPointLabelContext(s)),i=wf(t.font),{x:a,y:o,textAlign:l,left:c,top:d,right:u,bottom:h}=e._pointLabelItems[s],{backdropColor:m}=t;if(!th(m)){const e=yf(t.borderRadius),r=bf(t.backdropPadding);n.fillStyle=m;const s=c-r.left,i=d-r.top,a=u-c+r.width,o=h-d+r.height;Object.values(e).some(e=>0!==e)?(n.beginPath(),uf(n,{x:s,y:i,w:a,h:o,radius:e}),n.fill()):n.fillRect(s,i,a,o)}cf(n,e._pointLabels[s],a,o+i.lineHeight/2,i,{color:t.color,textAlign:l,textBaseline:"middle"})}}(this,s),r.display&&this.ticks.forEach((e,t)=>{if(0!==t){a=this.getDistanceFromCenterForValue(e.value);!function(e,t,n,r){const s=e.ctx,i=t.circular,{color:a,lineWidth:o}=t;!i&&!r||!a||!o||n<0||(s.save(),s.strokeStyle=a,s.lineWidth=o,s.setLineDash(t.borderDash),s.lineDashOffset=t.borderDashOffset,s.beginPath(),Iy(e,n,i,r),s.closePath(),s.stroke(),s.restore())}(this,r.setContext(this.getContext(t-1)),a,s)}}),n.display){for(e.save(),i=s-1;i>=0;i--){const r=n.setContext(this.getPointLabelContext(i)),{color:s,lineWidth:l}=r;l&&s&&(e.lineWidth=l,e.strokeStyle=s,e.setLineDash(r.borderDash),e.lineDashOffset=r.borderDashOffset,a=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),o=this.getPointPosition(i,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(o.x,o.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const r=this.getIndexAngle(0);let s,i;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(r),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((r,a)=>{if(0===a&&!t.reverse)return;const o=n.setContext(this.getContext(a)),l=wf(o.font);if(s=this.getDistanceFromCenterForValue(this.ticks[a].value),o.showLabelBackdrop){e.font=l.string,i=e.measureText(r.label).width,e.fillStyle=o.backdropColor;const t=bf(o.backdropPadding);e.fillRect(-i/2-t.left,-s-l.size/2-t.top,i+t.width,l.size+t.height)}cf(e,r.label,0,-s,l,{color:o.color})}),e.restore()}drawTitle(){}}Ey.id="radialLinear",Ey.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Jp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}},Ey.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},Ey.descriptors={angleLines:{_fallback:"grid"}};const Ty={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},jy=Object.keys(Ty);function ky(e,t){return e-t}function Dy(e,t){if(th(t))return null;const n=e._adapter,{parser:r,round:s,isoWeekday:i}=e._parseOpts;let a=t;return"function"===typeof r&&(a=r(a)),sh(a)||(a="string"===typeof r?n.parse(a,r):n.parse(a)),null===a?null:(s&&(a="week"!==s||!Rh(i)&&!0!==i?n.startOf(a,s):n.startOf(a,"isoWeek",i)),+a)}function Py(e,t,n,r){const s=jy.length;for(let i=jy.indexOf(e);i<s-1;++i){const e=Ty[jy[i]],s=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((n-t)/(s*e.size))<=r)return jy[i]}return jy[s-1]}function Ry(e,t,n){if(n){if(n.length){const{lo:r,hi:s}=Yh(n,t);e[n[r]>=t?n[r]:n[s]]=!0}}else e[t]=!0}function Oy(e,t,n){const r=[],s={},i=t.length;let a,o;for(a=0;a<i;++a)o=t[a],s[o]=a,r.push({value:o,major:!1});return 0!==i&&n?function(e,t,n,r){const s=e._adapter,i=+s.startOf(t[0].value,r),a=t[t.length-1].value;let o,l;for(o=i;o<=a;o=+s.add(o,1,r))l=n[o],l>=0&&(t[l].major=!0);return t}(e,r,s,n):r}class Ly extends og{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t){const n=e.time||(e.time={}),r=this._adapter=new mg._date(e.adapters.date);r.init(t),ph(n.displayFormats,r.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:Dy(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:r,max:s,minDefined:i,maxDefined:a}=this.getUserBounds();function o(e){i||isNaN(e.min)||(r=Math.min(r,e.min)),a||isNaN(e.max)||(s=Math.max(s,e.max))}i&&a||(o(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||o(this.getMinMax(!1))),r=sh(r)&&!isNaN(r)?r:+t.startOf(Date.now(),n),s=sh(s)&&!isNaN(s)?s:+t.endOf(Date.now(),n)+1,this.min=Math.min(r,s-1),this.max=Math.max(r+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,r="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const s=this.min,i=function(e,t,n){let r=0,s=e.length;for(;r<s&&e[r]<t;)r++;for(;s>r&&e[s-1]>n;)s--;return r>0||s<e.length?e.slice(r,s):e}(r,s,this.max);return this._unit=t.unit||(n.autoSkip?Py(t.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(e,t,n,r,s){for(let i=jy.length-1;i>=jy.indexOf(n);i--){const n=jy[i];if(Ty[n].common&&e._adapter.diff(s,r,n)>=t-1)return n}return jy[n?jy.indexOf(n):0]}(this,i.length,t.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(e){for(let t=jy.indexOf(e)+1,n=jy.length;t<n;++t)if(Ty[jy[t]].common)return jy[t]}(this._unit):void 0,this.initOffsets(r),e.reverse&&i.reverse(),Oy(this,i,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e){let t,n,r=0,s=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),r=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,n=this.getDecimalForValue(e[e.length-1]),s=1===e.length?n:(n-this.getDecimalForValue(e[e.length-2]))/2);const i=e.length<3?.5:.25;r=Wh(r,0,i),s=Wh(s,0,i),this._offsets={start:r,end:s,factor:1/(r+1+s)}}_generate(){const e=this._adapter,t=this.min,n=this.max,r=this.options,s=r.time,i=s.unit||Py(s.minUnit,t,n,this._getLabelCapacity(t)),a=ah(s.stepSize,1),o="week"===i&&s.isoWeekday,l=Rh(o)||!0===o,c={};let d,u,h=t;if(l&&(h=+e.startOf(h,"isoWeek",o)),h=+e.startOf(h,l?"day":i),e.diff(n,t,i)>1e5*a)throw new Error(t+" and "+n+" are too far apart with stepSize of "+a+" "+i);const m="data"===r.ticks.source&&this.getDataTimestamps();for(d=h,u=0;d<n;d=+e.add(d,a,i),u++)Ry(c,d,m);return d!==n&&"ticks"!==r.bounds&&1!==u||Ry(c,d,m),Object.keys(c).sort((e,t)=>e-t).map(e=>+e)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}_tickFormatFunction(e,t,n,r){const s=this.options,i=s.time.displayFormats,a=this._unit,o=this._majorUnit,l=a&&i[a],c=o&&i[o],d=n[t],u=o&&c&&d&&d.major,h=this._adapter.format(e,r||(u?c:l)),m=s.ticks.callback;return m?lh(m,[h,t,n],this):h}generateTickLabels(e){let t,n,r;for(t=0,n=e.length;t<n;++t)r=e[t],r.label=this._tickFormatFunction(r.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,r=Mh(this.isHorizontal()?t.maxRotation:t.minRotation),s=Math.cos(r),i=Math.sin(r),a=this._resolveTickFontOptions(0).size;return{w:n*s+a*i,h:n*i+a*s}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,r=n[t.unit]||n.millisecond,s=this._tickFormatFunction(e,0,Oy(this,[e],this._majorUnit),r),i=this._getLabelSize(s),a=Math.floor(this.isHorizontal()?this.width/i.w:this.height/i.h)-1;return a>0?a:1}getDataTimestamps(){let e,t,n=this._cache.data||[];if(n.length)return n;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(e=0,t=r.length;e<t;++e)n=n.concat(r[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const r=this.getLabels();for(t=0,n=r.length;t<n;++t)e.push(Dy(this,r[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Jh(e.sort(ky))}}function My(e,t,n){let r,s,i,a,o=0,l=e.length-1;n?(t>=e[o].pos&&t<=e[l].pos&&({lo:o,hi:l}=Xh(e,"pos",t)),({pos:r,time:i}=e[o]),({pos:s,time:a}=e[l])):(t>=e[o].time&&t<=e[l].time&&({lo:o,hi:l}=Xh(e,"time",t)),({time:r,pos:i}=e[o]),({time:s,pos:a}=e[l]));const c=s-r;return c?i+(a-i)*(t-r)/c:i}Ly.id="time",Ly.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class Fy extends Ly{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=My(t,this.min),this._tableRange=My(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,r=[],s=[];let i,a,o,l,c;for(i=0,a=e.length;i<a;++i)l=e[i],l>=t&&l<=n&&r.push(l);if(r.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(i=0,a=r.length;i<a;++i)c=r[i+1],o=r[i-1],l=r[i],Math.round((c+o)/2)!==l&&s.push({time:l,pos:i/(a-1)});return s}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return e=t.length&&n.length?this.normalize(t.concat(n)):t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(My(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return My(this._table,n*this._tableRange+this._minPos,!0)}}Fy.id="timeseries",Fy.defaults=Ly.defaults;const By=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent","updateMode"],Uy="label";function zy(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function qy(e,t){e.labels=t}function Hy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uy;const r=[];e.datasets=t.map(t=>{const s=e.datasets.find(e=>e[n]===t[n]);return s&&t.data&&!r.includes(s)?(r.push(s),Object.assign(s,t),s):(0,a.A)({},t)})}function Vy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uy;const n={labels:[],datasets:[]};return qy(n,e.labels),Hy(n,e.datasets,t),n}function Wy(e,n){let{height:r=150,width:s=300,redraw:i=!1,datasetIdKey:o,type:l,data:c,options:d,plugins:u=[],fallbackContent:h,updateMode:m}=e,f=(0,_e.A)(e,By);const p=(0,t.useRef)(null),g=(0,t.useRef)(),x=()=>{p.current&&(g.current=new wx(p.current,{type:l,data:Vy(c,o),options:d&&(0,a.A)({},d),plugins:u}),zy(n,g.current))},y=()=>{zy(n,null),g.current&&(g.current.destroy(),g.current=null)};return(0,t.useEffect)(()=>{var e,t;!i&&g.current&&d&&(e=g.current,t=d,Object.assign(e.options,t))},[i,d]),(0,t.useEffect)(()=>{!i&&g.current&&qy(g.current.config.data,c.labels)},[i,c.labels]),(0,t.useEffect)(()=>{!i&&g.current&&c.datasets&&Hy(g.current.config.data,c.datasets,o)},[i,c.datasets]),(0,t.useEffect)(()=>{g.current&&(i?(y(),setTimeout(x)):g.current.update(m))},[i,d,c.labels,c.datasets,m]),(0,t.useEffect)(()=>{g.current&&(y(),setTimeout(x))},[l]),(0,t.useEffect)(()=>(x(),()=>y()),[]),t.createElement("canvas",Object.assign({ref:p,role:"img",height:r,width:s},f),h)}const Gy=(0,t.forwardRef)(Wy);function Yy(e,n){return wx.register(n),(0,t.forwardRef)((n,r)=>t.createElement(Gy,Object.assign({},n,{ref:r,type:e})))}const Xy=Yy("bar",Hp),Qy=Yy("pie",Xp),Ky=e=>{var t,n,r,s,i,a,o,l,c,d,u,h,m;if(!e)return{rate:0,total:0,qty:0,unit:""};const f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Number(e);return Number.isFinite(n)?n:t},p=f(e.quantity||e.qty||0,0),g=e.unit||e.quantityUnit||"pcs",x=f(null!==(t=null!==(n=null!==(r=null!==(s=null!==(i=null!==(a=null!==(o=e.totalSellingPrice)&&void 0!==o?o:e.total)&&void 0!==a?a:e.sellingPrice)&&void 0!==i?i:e.totalAmount)&&void 0!==s?s:e.amount)&&void 0!==r?r:e.subtotal)&&void 0!==n?n:e.lineTotal)&&void 0!==t?t:0,0);let y=p>0?x/p:f(null!==(l=null!==(c=null!==(d=null!==(u=null!==(h=null!==(m=e.unitSellingPrice)&&void 0!==m?m:e.sellingPrice)&&void 0!==h?h:e.price)&&void 0!==u?u:e.unitPrice)&&void 0!==d?d:e.costPrice)&&void 0!==c?c:e.rate)&&void 0!==l?l:0,0);var b,w,v,N,S;0===y&&(y=f(null!==(b=null!==(w=null!==(v=null!==(N=null!==(S=e.sellingPrice)&&void 0!==S?S:e.price)&&void 0!==N?N:e.unitPrice)&&void 0!==v?v:e.costPrice)&&void 0!==w?w:e.rate)&&void 0!==b?b:0,0));const A=p>0?y*p:x||y*p;return{rate:Number.isFinite(y)?Number(y.toFixed(2)):0,total:Number.isFinite(A)?Number(A.toFixed(2)):0,qty:p||1,unit:g||"pcs"}},Zy=e=>{const t=Number(e||0)||0;return"\u20b9".concat(t.toFixed(2))};var Jy=n(3885);wx.register(hy,gy,Gx,Zx,dy,Qx,Ex);const $y=()=>{var e,n,r,s,o,l,c,d;const{state:u,dispatch:h}=(0,i.nm)(),[m,f]=(0,t.useState)("today"),[p,g]=(0,t.useState)(!0),[x,y]=(0,t.useState)(null),[b,w]=(0,t.useState)(!1),[v,N]=(0,t.useState)(null),[S,A]=(0,t.useState)(!1),[_,C]=(0,t.useState)(!1),I=(0,t.useRef)(null),E=(()=>{try{return(0,Se.$u)()}catch(e){return console.error("Financial: failed to extract sellerId from auth",e),null}})(),T=e=>{var t,n,r;if(!e&&0!==e)return null;return(null===e||void 0===e||null===(t=e.toString)||void 0===t||null===(n=(r=t.call(e)).trim)||void 0===n?void 0:n.call(r))||null},j=new Set([E,null===(e=u.currentUser)||void 0===e?void 0:e.sellerId,null===(n=u.currentUser)||void 0===n?void 0:n.id,null===(r=u.currentUser)||void 0===r?void 0:r._id,null===(s=u.currentUser)||void 0===s?void 0:s.userId,null===(o=u.currentUser)||void 0===o?void 0:o.uid,null===(l=u.currentUser)||void 0===l?void 0:l.storeId,null===(c=u.currentUser)||void 0===c||null===(d=c.profile)||void 0===d?void 0:d.sellerId,u.sellerId,u.storeId].map(T).filter(Boolean)),k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&0!==j.size?e.filter(e=>((e,t)=>{var n,r,s,i,a,o,l,c,d,u,h;if(!e||!(t instanceof Set)||0===t.size)return!0;const m=[e.sellerId,e.sellerID,e.seller_id,e._sellerId,null===(n=e.seller)||void 0===n?void 0:n.id,null===(r=e.seller)||void 0===r?void 0:r._id,null===(s=e.seller)||void 0===s?void 0:s.sellerId,e.storeId,null===(i=e.store)||void 0===i?void 0:i.id,null===(a=e.store)||void 0===a?void 0:a._id,e.vendorId,null===(o=e.createdBy)||void 0===o?void 0:o.sellerId,null===(l=e.createdBy)||void 0===l?void 0:l.sellerID,null===(c=e.createdBy)||void 0===c?void 0:c._id,null===(d=e.meta)||void 0===d?void 0:d.sellerId,null===(u=e.meta)||void 0===u?void 0:u.storeId,null===(h=e.owner)||void 0===h?void 0:h.sellerId].map(T).filter(Boolean);return 0===m.length||m.some(e=>t.has(e))})(e,j)):e||[]};(0,t.useEffect)(()=>{(async()=>{try{g(!0);const[v,N,S,A]=await Promise.all([(0,Ae.getAllItems)(Ae.STORES.orders).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.transactions).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.purchaseOrders).catch(()=>[]),(0,Ae.getAllItems)(Ae.STORES.customers).catch(()=>[])]),_=(A||[]).map(e=>(0,a.A)((0,a.A)({},e),{},{dueAmount:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,balanceDue:void 0!==e.dueAmount?e.dueAmount:void 0!==e.balanceDue?e.balanceDue:0,mobileNumber:e.mobileNumber||e.phone||""}));h({type:"SET_ORDERS",payload:v||[]}),h({type:"SET_TRANSACTIONS",payload:N||[]}),h({type:"SET_PURCHASE_ORDERS",payload:S||[]}),h({type:"SET_CUSTOMERS",payload:_}),g(!1);if(await(0,Jy.isOnline)())try{var e;const g=await(0,Se.AT)("/data/all",{method:"GET"});if(g.success&&null!==(e=g.data)&&void 0!==e&&e.data){var t,n,r,s,i,o,l,c,d,u,m,f,p,x,y,b;const{orders:e,transactions:w,purchaseOrders:A,customers:C}=g.data.data,I=(C||[]).map(e=>(0,a.A)((0,a.A)({},e),{},{dueAmount:e.dueAmount||0,balanceDue:e.dueAmount||0,mobileNumber:e.mobileNumber||e.phone||""})),E=((null===v||void 0===v?void 0:v.length)||0)!==((null===e||void 0===e?void 0:e.length)||0)||(null===e||void 0===e?void 0:e.length)>0&&(null===v||void 0===v?void 0:v.length)>0&&(null===(t=e[0])||void 0===t?void 0:t._id)!==(null===(n=v[0])||void 0===n?void 0:n._id)&&(null===(r=e[0])||void 0===r?void 0:r.id)!==(null===(s=v[0])||void 0===s?void 0:s.id),T=((null===N||void 0===N?void 0:N.length)||0)!==((null===w||void 0===w?void 0:w.length)||0)||(null===w||void 0===w?void 0:w.length)>0&&(null===N||void 0===N?void 0:N.length)>0&&(null===(i=w[0])||void 0===i?void 0:i._id)!==(null===(o=N[0])||void 0===o?void 0:o._id)&&(null===(l=w[0])||void 0===l?void 0:l.id)!==(null===(c=N[0])||void 0===c?void 0:c.id),j=((null===S||void 0===S?void 0:S.length)||0)!==((null===A||void 0===A?void 0:A.length)||0)||(null===A||void 0===A?void 0:A.length)>0&&(null===S||void 0===S?void 0:S.length)>0&&(null===(d=A[0])||void 0===d?void 0:d._id)!==(null===(u=S[0])||void 0===u?void 0:u._id)&&(null===(m=A[0])||void 0===m?void 0:m.id)!==(null===(f=S[0])||void 0===f?void 0:f.id),k=((null===_||void 0===_?void 0:_.length)||0)!==((null===I||void 0===I?void 0:I.length)||0)||(null===I||void 0===I?void 0:I.length)>0&&(null===_||void 0===_?void 0:_.length)>0&&(null===(p=I[0])||void 0===p?void 0:p._id)!==(null===(x=_[0])||void 0===x?void 0:x._id)&&(null===(y=I[0])||void 0===y?void 0:y.id)!==(null===(b=_[0])||void 0===b?void 0:b.id);(e||w||A||C)&&(E||T||j||k||(null===e||void 0===e?void 0:e.length)>0||(null===w||void 0===w?void 0:w.length)>0||(null===A||void 0===A?void 0:A.length)>0)&&(h({type:"SET_ORDERS",payload:e||[]}),h({type:"SET_TRANSACTIONS",payload:w||[]}),h({type:"SET_PURCHASE_ORDERS",payload:A||[]}),h({type:"SET_CUSTOMERS",payload:I}),await Promise.all([(0,Jy.syncToIndexedDB)(Ae.STORES.orders,e||[]),(0,Jy.syncToIndexedDB)(Ae.STORES.transactions,w||[]),(0,Jy.syncToIndexedDB)(Ae.STORES.purchaseOrders,A||[]),(0,Jy.syncToIndexedDB)(Ae.STORES.customers,I)]))}}catch(w){console.error("Error fetching financial data from MongoDB:",w)}}catch(v){console.error("Error loading financial data:",v),g(!1)}})()},[h]);const D=e=>{const t=(e||"").toString().toLowerCase();return"card"===t||"upi"===t||"online"===t?"online":"due"===t||"credit"===t?"due":"cash"},P=e=>{switch(D(e)){case"online":return"Online Payment";case"due":return"Due (Credit)";default:return"Cash"}},R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;"undefined"!==typeof window&&"function"===typeof window.showToast&&window.showToast(e,t,n)},O=e=>{if(!e)return;const t=It(e.customerMobile||e.customerPhone||e.phoneNumber||"");if(!t)return void R("No customer mobile number found for this invoice.","warning");const n=((e,t)=>{var n,r,s,i,a,o,l,c,d,h,m,f,p,g,x,y,b,w;if(!e)return"";const v=e=>null===e||void 0===e||""===e?"null":e,N=v(u.storeName||(null===(n=u.currentUser)||void 0===n?void 0:n.shopName)||(null===(r=u.currentUser)||void 0===r?void 0:r.username)),S=v(null===(s=u.currentUser)||void 0===s?void 0:s.shopAddress),A=(null===(i=u.currentUser)||void 0===i?void 0:i.phoneNumber)||(null===(a=u.currentUser)||void 0===a?void 0:a.mobileNumber)||(null===(o=u.currentUser)||void 0===o?void 0:o.phone)||(null===(l=u.currentUser)||void 0===l?void 0:l.contact)||"",_=It(A),C=_?"+91 ".concat(_):v(A),I=new Date(e.date||e.createdAt||e.updatedAt||Date.now()),E=Number.isNaN(I.getTime())?"null":I.toLocaleDateString("en-IN"),T=v(e.customerName||e.customer||"Customer"),j=t?"+91 ".concat(t):"null",k=M(null!==(c=null!==(d=null!==(h=e.subtotal)&&void 0!==h?h:e.subTotal)&&void 0!==d?d:e.total)&&void 0!==c?c:0,0),D=M(null!==(m=null!==(f=e.discountAmount)&&void 0!==f?f:e.discount)&&void 0!==m?m:0,0),R=M(null!==(p=null!==(g=e.taxAmount)&&void 0!==g?g:e.tax)&&void 0!==p?p:0,0),O=M(null!==(x=null!==(y=null!==(b=e.total)&&void 0!==b?b:e.totalAmount)&&void 0!==y?y:e.amount)&&void 0!==x?x:k,0),L=null!==(w=e.taxPercent)&&void 0!==w?w:e.taxRate,F=void 0!==L&&null!==L?Number(L):k>0?R/k*100:null,B=Number.isFinite(k)?"\u20b9".concat(k.toFixed(2)):"\u20b9null",U=Number.isFinite(D)?"\u20b9".concat(D.toFixed(2)):"\u20b9null",z=Number.isFinite(R)?"\u20b9".concat(R.toFixed(2)):"\u20b9null",q=Number.isFinite(F)?"".concat(F%1===0?F.toFixed(0):F.toFixed(2),"%"):"null",H=Number.isFinite(O)?"\u20b9".concat(O.toFixed(2)):"\u20b9null",V="".concat("Item".padEnd(12," ")).concat("Qty".padStart(8," "),"   ").concat("Rate".padStart(8," "),"   ").concat("Amount".padStart(10," ")),W=(e.items||[]).map((e,t)=>{var n,r,s,i,a,o,l,c,d,u,h,m,f,p;const g=M(null!==(n=null!==(r=null!==(s=e.quantity)&&void 0!==s?s:null===(i=e.originalQuantity)||void 0===i?void 0:i.quantity)&&void 0!==r?r:e.qty)&&void 0!==n?n:0,0),x=e.unit||(null===(a=e.originalQuantity)||void 0===a?void 0:a.unit)||"",y=M(null!==(o=null!==(l=null!==(c=e.unitSellingPrice)&&void 0!==c?c:e.sellingPrice)&&void 0!==l?l:e.price)&&void 0!==o?o:g>0?(null!==(d=null!==(u=null!==(h=e.totalSellingPrice)&&void 0!==h?h:e.total)&&void 0!==u?u:e.amount)&&void 0!==d?d:0)/g:0,0),b=M(null!==(m=null!==(f=null!==(p=e.totalSellingPrice)&&void 0!==p?p:e.total)&&void 0!==f?f:e.amount)&&void 0!==m?m:y*g,0),w=(e.name||e.productName||"Item ".concat(t+1)).slice(0,12).padEnd(12," "),v=(Number.isFinite(g)?g.toString():"null").padStart(8," "),N=(Number.isFinite(y)?y.toFixed(2):"null").padStart(8," "),S=(Number.isFinite(b)?b.toFixed(2):"null").padStart(10," ");return"".concat(w).concat(v,"   ").concat(N,"   ").concat(S).concat(x?" ".concat(x):"")}),G=W.length?W.join("\n"):"".concat("null".padEnd(12," ")).concat("null".padStart(8," "),"   ").concat("null".padStart(8," "),"   ").concat("null".padStart(10," ")),Y=v(P(e.paymentMethod)),X="--------------------------------";return["             INVOICE","",X,"Shop Name : ".concat(N),"Address   : ".concat(S),"Phone     : ".concat(C),"Date      : ".concat(E),X,"Customer Name : ".concat(T),"Customer Phone: ".concat(j),X,V,G,X,"Subtotal     : ".concat(B),"Discount     : ".concat(U),"Tax (".concat(q,")     : ").concat(z),X,"Grand Total  : ".concat(H),"Payment Mode : ".concat(Y),"Thank you for shopping with us!",X,"       Powered by Drag & Drop",X].join("\n")})(e,t);if(!n)return void R("Unable to prepare invoice details for sharing.","error");const r=10===t.length?"91".concat(t):t,s="https://wa.me/".concat(r,"?text=").concat(encodeURIComponent(n));window.open(s,"_blank")},L=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toLocaleDateString("en-IN")},M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Number(e);return Number.isFinite(n)?n:t},F=function(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r)return 0;const s=M(null!==(e=null!==(t=null!==(n=r.total)&&void 0!==n?n:r.grandTotal)&&void 0!==t?t:r.amount)&&void 0!==e?e:r.totalAmount,0);return s>0?s:Array.isArray(r.items)&&r.items.length>0?r.items.reduce((e,t)=>e+function(){var e,t,n,r,s,i,a,o,l;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!c)return 0;const d=M(null!==(e=null!==(t=c.subtotal)&&void 0!==t?t:c.total)&&void 0!==e?e:c.lineTotal,0);return d||M(null!==(n=null!==(r=null!==(s=null!==(i=c.price)&&void 0!==i?i:c.costPrice)&&void 0!==s?s:c.unitPrice)&&void 0!==r?r:c.rate)&&void 0!==n?n:0,0)*M(null!==(a=null!==(o=null!==(l=c.quantity)&&void 0!==l?l:c.qty)&&void 0!==o?o:c.count)&&void 0!==a?a:1,1)}(t),0):0},{startDate:B,endDate:U}=(()=>{const e=new Date;e.setHours(23,59,59,999);const t=new Date;t.setHours(0,0,0,0);let n=new Date(t);switch(m){case"today":default:return{startDate:t,endDate:e};case"7d":n.setDate(e.getDate()-7);break;case"30d":n.setDate(e.getDate()-30);break;case"90d":n.setDate(e.getDate()-90);break;case"1y":n.setFullYear(e.getFullYear()-1)}return{startDate:n,endDate:e}})(),z=k(u.orders).filter(e=>{const t=new Date(e.createdAt||e.date||0);return t>=B&&t<=U}),q=k(u.purchaseOrders).filter(e=>{const t=new Date(e.createdAt||e.orderDate||e.date||e.updatedAt||0);return t>=B&&t<=U}),H=z.reduce((e,t)=>e+(t.totalAmount||0),0),V=(e=>{const t=e=>("number"===typeof e?e:parseFloat(e))||0;return e.reduce((e,n)=>{if(!n.items||!Array.isArray(n.items))return e;return e+n.items.reduce((e,n)=>{var r,s,i,a;return e+(t(null!==(r=null!==(s=n.totalSellingPrice)&&void 0!==s?s:n.sellingPrice)&&void 0!==r?r:0)-t(null!==(i=null!==(a=n.totalCostPrice)&&void 0!==a?a:n.costPrice)&&void 0!==i?i:0))},0)},0)})(z),W=q.reduce((e,t)=>e+(F(t)||0),0),G=V-W,Y=H>0?G/H*100:0,X=u.customers.reduce((e,t)=>e+(t.balanceDue||0),0),Q=u.customers.filter(e=>(e.balanceDue||0)>0).length,K=(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()-5,1),n=[];for(let r=0;r<6;r++){const e=new Date(t);e.setMonth(e.getMonth()+r);const s=u.orders.filter(t=>{const n=new Date(t.createdAt||t.date);return n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()}),i=s.reduce((e,t)=>e+(t.totalAmount||0),0);n.push(i)}return n})();const Z={labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Revenue",data:K,backgroundColor:"rgba(34, 197, 94, 0.8)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:2,borderRadius:8},{label:"Expenses",data:K.map(e=>.3*e),backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:2,borderRadius:8}]},J=(()=>{const e={cash:0,online:0,due:0,split:0};return z.forEach(t=>{if("split"===(t.paymentMethod||"").toString().toLowerCase().trim())e.split=(e.split||0)+1;else{const n=D(t.paymentMethod);e[n]=(e[n]||0)+1}}),[e.cash,e.online,e.due,e.split]})(),$=(()=>{const e={cash:0,online:0,due:0,split:0};return z.forEach(t=>{const n=(t.paymentMethod||"").toString().toLowerCase().trim(),r=t.totalAmount||t.total||0;if("split"===n)e.split=(e.split||0)+r;else{const n=D(t.paymentMethod);e[n]=(e[n]||0)+r}}),[e.cash,e.online,e.due,e.split]})(),ee=["Cash","Online Payment","Due (Credit)","Split Payment"],te=(()=>{const e={cash:0,online:0,due:0};return z.forEach(t=>{if("split"===(t.paymentMethod||"").toString().toLowerCase().trim()&&t.splitPaymentDetails){const n=t.splitPaymentDetails;e.cash=e.cash+(Number(n.cashAmount)||0),e.online=e.online+(Number(n.onlineAmount)||0),e.due=e.due+(Number(n.dueAmount)||0)}}),e})(),ne=[],re=[],se=[];ee.forEach((e,t)=>{$[t]>0&&(ne.push(e),re.push($[t]),se.push(J[t]))});const ie={labels:ne,datasets:[{label:"Amount (\u20b9)",data:re,backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)","rgba(239, 68, 68, 0.8)","rgba(168, 85, 247, 0.8)"].slice(0,ne.length),borderColor:["rgba(34, 197, 94, 1)","rgba(59, 130, 246, 1)","rgba(239, 68, 68, 1)","rgba(168, 85, 247, 1)"].slice(0,ne.length),borderWidth:2,hoverOffset:4}]},ae={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"500"}},onClick:(e,t)=>{}},tooltip:{callbacks:{label:function(e){const t=e.label||"",n=e.parsed||0,r=e.dataset.data.reduce((e,t)=>e+t,0),s=r>0?(n/r*100).toFixed(1):0,i=e.dataIndex,a=se[i]||0;return"".concat(t,": \u20b9").concat(n.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})," (").concat(a," ").concat(1===a?"order":"orders",", ").concat(s,"%)")}},backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:12},borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1},generateLabels:function(e){const t=e.data;return t.labels.length&&t.datasets.length?t.labels.map((e,n)=>{const r=t.datasets[0],s=r.data[n],i=se[n]||0,a=re.reduce((e,t)=>e+t,0),o=a>0?(s/a*100).toFixed(1):0;return{text:"".concat(e,": \u20b9").concat(s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})," (").concat(i," ").concat(1===i?"order":"orders",", ").concat(o,"%)"),fillStyle:r.backgroundColor[n],strokeStyle:r.borderColor[n],lineWidth:r.borderWidth,hidden:!1,index:n}}):[]}}};(0,t.useEffect)(()=>{const e=e=>{I.current&&!I.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const oe=(e,t,n)=>{const r=new Blob([t],{type:n}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=e,i.click(),window.URL.revokeObjectURL(s)},le=e=>{if(null===e||void 0===e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t};if(p&&0===u.orders.length&&0===u.transactions.length)return(0,Pe.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Loading financial data..."})]})});return(0,Pe.jsxs)("div",{className:"space-y-8 fade-in-up",children:[(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Financial Management"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-2",children:"Track revenue, expenses, and performance"})]}),(0,Pe.jsxs)("div",{className:"mt-4 sm:mt-0 flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[(0,Pe.jsx)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80 p-1 shadow-sm",children:[{value:"today",label:"Today"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"},{value:"90d",label:"Last 90 days"},{value:"1y",label:"All Time"}].map(e=>{const t=m===e.value;return(0,Pe.jsx)("button",{type:"button",onClick:()=>f(e.value),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat(t?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:e.label},e.value)})}),(0,Pe.jsxs)("div",{className:"relative",ref:I,children:[(0,Pe.jsxs)("button",{onClick:()=>C(!_),className:"btn-secondary flex items-center justify-center gap-2 px-5 py-2.5 text-sm font-semibold",children:[(0,Pe.jsx)(st,{className:"h-4 w-4"}),"Export Report",(0,Pe.jsx)(Ku,{className:"h-4 w-4 transition-transform ".concat(_?"rotate-180":"")})]}),_&&(0,Pe.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50",children:[(0,Pe.jsxs)("button",{onClick:()=>{try{var e;const n=new Uo("l","mm","a4"),r=n.internal.pageSize.getWidth(),s=n.internal.pageSize.getHeight(),i={r:47,g:60,b:126},a={r:244,g:162,b:89},o={r:71,g:85,b:145},l={r:248,g:249,b:253},c={r:15,g:23,b:42},d={r:100,g:116,b:150};n.setFillColor(i.r,i.g,i.b),n.rect(0,0,r,24,"F"),n.setFillColor(a.r,a.g,a.b),n.rect(0,0,r,2.5,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(18),n.text("Drag & Drop",15,15),n.setFillColor(a.r,a.g,a.b),n.rect(15,17,48,1.8,"F"),n.setFont("helvetica","normal"),n.setFontSize(12),n.text("Financial Report",r-15,15,{align:"right"}),n.setFontSize(8),n.setTextColor(250,250,250);const h="".concat((null===(e=u.currentUser)||void 0===e?void 0:e.shopName)||"Store","  \u2022  ").concat((new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}));n.text(h,r-15,21,{align:"right"});const m=29,f=16,p=3.5,g=(r-30-3*p)/4;[{label:"Total Revenue",value:"\u20b9".concat(H.toFixed(2)),bgColor:l,accentColor:{r:34,g:197,b:94}},{label:"Total Expenses",value:"\u20b9".concat(W.toFixed(2)),bgColor:l,accentColor:{r:239,g:68,b:68}},{label:"Net Profit",value:"\u20b9".concat(G.toFixed(2)),bgColor:l,accentColor:i},{label:"Receivables",value:"\u20b9".concat(X.toFixed(2)),bgColor:l,accentColor:a}].forEach((e,t)=>{const r=10+t*(g+p);n.setFillColor(e.bgColor.r,e.bgColor.g,e.bgColor.b),n.rect(r,m,g,f,"F"),n.setDrawColor(o.r,o.g,o.b),n.setLineWidth(.15),n.rect(r,m,g,f,"D"),n.setFillColor(e.accentColor.r,e.accentColor.g,e.accentColor.b),n.rect(r,m,g,1.5,"F"),n.setFontSize(7),n.setFont("helvetica","normal"),n.setTextColor(d.r,d.g,d.b),n.text(e.label.toUpperCase(),r+2.5,m+6),n.setFontSize(10),n.setFont("helvetica","bold"),n.setTextColor(e.accentColor.r,e.accentColor.g,e.accentColor.b);const s=n.splitTextToSize(e.value,g-5);n.text(s[0],r+2.5,m+12.5)});let x=m+f+8;const y=12,b=r-12,w=r-24;n.setFontSize(10),n.setFont("helvetica","bold"),n.setTextColor(c.r,c.g,c.b),n.text("Financial Summary",y,x),x+=6;const v=[["Metric","Value"],["Total Revenue","\u20b9".concat(H.toFixed(2))],["Total Expenses","\u20b9".concat(W.toFixed(2))],["Net Profit","\u20b9".concat(G.toFixed(2))],["Profit Margin","".concat(Y.toFixed(2),"%")],["Total Receivables","\u20b9".concat(X.toFixed(2))],["Customers with Debt",Q.toString()]];n.setFontSize(8),n.setFont("helvetica","normal"),v.forEach((e,t)=>{0===t?(n.setFont("helvetica","bold"),n.setFillColor(i.r,i.g,i.b),n.rect(y,x-5,w,6,"F"),n.setTextColor(255,255,255)):(n.setFont("helvetica","normal"),n.setFillColor(t%2===0?l.r:255,t%2===0?l.g:255,t%2===0?l.b:255),n.rect(y,x-5,w,5,"F"),n.setTextColor(c.r,c.g,c.b)),n.text(e[0],y+2,x),n.text(e[1],b-2,x,{align:"right"}),x+=0===t?6:5});const N=n.internal.getNumberOfPages();for(let e=1;e<=N;e++){var t;n.setPage(e),n.setFillColor(l.r,l.g,l.b),n.rect(0,s-10,r,10,"F"),n.setFillColor(a.r,a.g,a.b),n.rect(0,s-10,r,1,"F"),n.setDrawColor(o.r,o.g,o.b),n.setLineWidth(.15),n.line(0,s-10,r,s-10),n.setFontSize(8),n.setFont("helvetica","normal"),n.setTextColor(d.r,d.g,d.b),n.text("Page ".concat(e," of ").concat(N),12,s-5),n.setFont("helvetica","bold"),n.setFontSize(8.5),n.setTextColor(i.r,i.g,i.b),n.text("".concat((null===(t=u.currentUser)||void 0===t?void 0:t.shopName)||"Store"),r-12,s-5,{align:"right"}),n.setFont("helvetica","normal"),n.setFontSize(7),n.setTextColor(d.r,d.g,d.b),n.text("Drag & Drop",r-12,s-2.5,{align:"right"})}n.save("financial-report-".concat((new Date).toISOString().split("T")[0],".pdf")),window.showToast&&window.showToast("Financial report exported as PDF.","success"),C(!1)}catch(n){console.error("Error generating PDF:",n),window.showToast&&window.showToast("Error generating PDF. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Lt,{className:"h-4 w-4 text-red-600"}),(0,Pe.jsx)("span",{children:"Export as PDF"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{var e;const t={summary:{totalRevenue:H,totalExpenses:W,netProfit:G,profitMargin:Y.toFixed(2),totalReceivables:X,customersWithDebt:Q},generatedAt:(new Date).toISOString(),shopName:(null===(e=u.currentUser)||void 0===e?void 0:e.shopName)||"Store"};oe("financial-report-".concat((new Date).toISOString().split("T")[0],".json"),JSON.stringify(t,null,2),"application/json"),window.showToast&&window.showToast("Financial report exported as JSON.","success"),C(!1)}catch(t){console.error("Error exporting financial JSON:",t),window.showToast&&window.showToast("Error exporting JSON. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4 text-yellow-600"}),(0,Pe.jsx)("span",{children:"Export as JSON"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{const e=["Type","Date","Description","Amount","Payment Method","Status"],t=[];t.push([le("Summary"),le((new Date).toLocaleDateString()),le("Total Revenue"),le(H),le("All Methods"),le("Completed")]),t.push([le("Summary"),le((new Date).toLocaleDateString()),le("Total Expenses"),le(W),le("All Methods"),le("Completed")]),t.push([le("Summary"),le((new Date).toLocaleDateString()),le("Net Profit"),le(H-W),le("N/A"),le("Calculated")]);const n=[e.join(","),...t.map(e=>e.join(","))].join("\n");oe("financial-report-".concat((new Date).toISOString().split("T")[0],".csv"),n,"text/csv;charset=utf-8;"),window.showToast&&window.showToast("Financial report exported as CSV.","success"),C(!1)}catch(e){console.error("Error exporting financial CSV:",e),window.showToast&&window.showToast("Error exporting CSV. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4 text-green-600"}),(0,Pe.jsx)("span",{children:"Export as CSV"})]})]})]})]})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[{title:"Total Revenue",value:H,color:"green",icon:(0,Pe.jsx)(je,{})},{title:"Total Expenses",value:W,color:"red",icon:(0,Pe.jsx)(Nt,{})},{title:"Net Profit",value:G,color:"blue",icon:(0,Pe.jsx)(Zu,{})},{title:"Receivables",value:X,color:"orange",icon:(0,Pe.jsx)(De,{})}].map((e,t)=>(0,Pe.jsxs)("div",{className:"stat-card flex items-center",children:[(0,Pe.jsx)("div",{className:"p-3 bg-".concat(e.color,"-100 rounded-xl text-").concat(e.color,"-600"),children:e.icon}),(0,Pe.jsxs)("div",{className:"ml-4",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.title}),(0,Pe.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20b9",e.value.toFixed(2)]})]})]},t))}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(We,{className:"h-5 w-5 mr-2 text-blue-600"})," Revenue vs Expenses"]}),(0,Pe.jsx)("div",{className:"h-64",children:(0,Pe.jsx)(Xy,{data:Z,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20}}},scales:{y:{beginAtZero:!0},x:{grid:{display:!1}}}}})})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(Ju,{className:"h-5 w-5 mr-2 text-purple-600"})," Payment Methods (Revenue)"]}),(0,Pe.jsx)("div",{className:"h-80 mb-2",children:(0,Pe.jsx)(Qy,{data:ie,options:ae})}),(0,Pe.jsx)("div",{className:"mt-4 space-y-2",children:ee.map((e,t)=>{const n=$[t]||0,r=J[t]||0,s=$.reduce((e,t)=>e+t,0),i=s>0?(n/s*100).toFixed(1):"0.0",a={Cash:{bg:"bg-green-50",border:"border-green-200",text:"text-green-900",chartColor:"rgba(34, 197, 94, 0.8)"},"Online Payment":{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-900",chartColor:"rgba(59, 130, 246, 0.8)"},"Due (Credit)":{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",chartColor:"rgba(239, 68, 68, 0.8)"},"Split Payment":{bg:"bg-purple-50",border:"border-purple-200",text:"text-purple-900",chartColor:"rgba(168, 85, 247, 0.8)"}}[e]||{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-900",chartColor:"rgba(156, 163, 175, 0.8)"},o="Split Payment"===e;return(0,Pe.jsxs)("div",{className:"rounded-lg border ".concat(a.bg," ").concat(a.border," ").concat(a.text),children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-3 ".concat(o?"border-b border-purple-200":""),children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.chartColor}}),(0,Pe.jsx)("span",{className:"font-semibold text-sm",children:e})]}),(0,Pe.jsxs)("div",{className:"text-right",children:[(0,Pe.jsxs)("div",{className:"font-bold text-base",children:["\u20b9",n.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,Pe.jsxs)("div",{className:"text-xs opacity-75",children:[r," ",1===r?"order":"orders"," \u2022 ",i,"%"]})]})]}),o&&n>0&&(0,Pe.jsxs)("div",{className:"p-3 pt-2 space-y-1.5 bg-purple-100/30",children:[(0,Pe.jsx)("p",{className:"text-xs font-medium text-purple-800 mb-2",children:"Breakdown:"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,Pe.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded p-2",children:[(0,Pe.jsx)("p",{className:"text-xs text-green-700 font-medium mb-0.5",children:"Cash"}),(0,Pe.jsxs)("p",{className:"text-sm font-bold text-green-900",children:["\u20b9",te.cash.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-2",children:[(0,Pe.jsx)("p",{className:"text-xs text-blue-700 font-medium mb-0.5",children:"Online"}),(0,Pe.jsxs)("p",{className:"text-sm font-bold text-blue-900",children:["\u20b9",te.online.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:[(0,Pe.jsx)("p",{className:"text-xs text-red-700 font-medium mb-0.5",children:"Due"}),(0,Pe.jsxs)("p",{className:"text-sm font-bold text-red-900",children:["\u20b9",te.due.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})]},t)})})]})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 mr-2 text-yellow-600"})," Financial Alerts"]}),X>0&&(0,Pe.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-xl border-l-4 border-yellow-400 mb-3",children:[(0,Pe.jsx)(St,{className:"h-6 w-6 text-yellow-600 inline mr-2"}),(0,Pe.jsx)("span",{className:"font-semibold",children:"Outstanding Receivables:"})," \u20b9",X.toFixed(2)]}),Y<10&&(0,Pe.jsxs)("div",{className:"p-4 bg-red-50 rounded-xl border-l-4 border-red-400 mb-3",children:[(0,Pe.jsx)(Nt,{className:"h-6 w-6 text-red-600 inline mr-2"}),"Low Profit Margin (",Y.toFixed(1),"%)"]}),G<0&&(0,Pe.jsxs)("div",{className:"p-4 bg-red-50 rounded-xl border-l-4 border-red-400 mb-3",children:[(0,Pe.jsx)(St,{className:"h-6 w-6 text-red-600 inline mr-2"}),"Negative Profit: \u20b9",Math.abs(G).toFixed(2)]}),0===X&&Y>=10&&G>=0&&(0,Pe.jsxs)("div",{className:"text-center py-8",children:[(0,Pe.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Pe.jsx)(Ct,{className:"h-8 w-8 text-green-600"})}),(0,Pe.jsx)("p",{className:"text-green-600 font-semibold",children:"Great! Your finances are healthy \ud83c\udfaf"})]})]}),b&&x&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/50 px-4 overflow-y-auto py-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col my-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4 flex-shrink-0",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Transaction Details"}),(0,Pe.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:x.customerName||"Walk-in Customer"}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(x.date).toLocaleString()," \u2022 ",P(x.paymentMethod)]})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsxs)("button",{type:"button",onClick:()=>O(x),className:"inline-flex items-center gap-2 rounded-full border border-primary-100 bg-primary-50 px-3 py-1.5 text-xs font-medium text-primary-600 transition hover:bg-primary-100",children:[(0,Pe.jsx)(At,{className:"h-3.5 w-3.5"}),"Share Bill"]}),(0,Pe.jsx)("button",{type:"button",onClick:()=>{w(!1),y(null)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close transaction details",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]})]}),(0,Pe.jsxs)("div",{className:"px-6 py-5 space-y-6 overflow-y-auto flex-1",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Date"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(e=>{try{const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-IN",n).format(t)}catch(t){return e}})(x.createdAt||x.date)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Customer Name"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:x.customerName||"Walk-in Customer"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Customer Mobile"}),(0,Pe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:x.customerMobile||"-"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Payment Method"}),(0,Pe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{const t=(e||"").toLowerCase();return"cash"===t?"bg-green-50 text-green-700":"card"===t||"upi"===t||"online"===t?"bg-blue-50 text-blue-700":"due"===t||"credit"===t?"bg-red-50 text-red-700":"split"===t?"bg-purple-50 text-purple-700":"bg-gray-50 text-gray-700"})(x.paymentMethod)),children:x.paymentMethod||"N/A"})]}),(()=>{if("split"===(x.paymentMethod||"").toString().toLowerCase().trim()){const e=x.splitPaymentDetails||{},t=Number(e.cashAmount)||0,n=Number(e.onlineAmount)||0,r=Number(e.dueAmount)||0;return(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Split Payment Breakdown"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,Pe.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-green-700 font-medium mb-1",children:"Cash"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-green-900",children:Zy(t)})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Online"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-blue-900",children:Zy(n)})]}),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-red-700 font-medium mb-1",children:"Due"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-red-900",children:Zy(r)})]})]})]})}return null})(),(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Amount"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:Zy(x.totalAmount||x.total)})]})]}),x.items&&x.items.length>0&&(0,Pe.jsx)("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-gray-100",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Item"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Qty"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Rate"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-gray-100",children:x.items.map((e,t)=>{const{rate:n,total:r,qty:s,unit:i}=Ky(e);return(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("td",{className:"px-4 py-2 text-gray-800",children:(0,Pe.jsx)("span",{className:"truncate block max-w-[200px]",title:e.name||"\u2014",children:e.name||"\u2014"})}),(0,Pe.jsxs)("td",{className:"px-4 py-2 text-center text-gray-600",children:[s," ",i]}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right text-gray-600",children:Zy(n)}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right font-medium text-gray-700",children:Zy(r)})]},"".concat(e.productId||e.name||t,"-").concat(t))})})]})}),x.note&&(0,Pe.jsxs)("div",{className:"bg-primary-50 border border-primary-100 rounded-xl p-3 text-sm text-primary-700",children:[(0,Pe.jsx)("p",{className:"text-xs uppercase tracking-wide text-primary-600 mb-1",children:"Note"}),x.note]})]}),(0,Pe.jsx)("div",{className:"flex justify-end border-t border-gray-200 px-6 py-4 flex-shrink-0",children:(0,Pe.jsx)("button",{type:"button",onClick:()=>{w(!1),y(null)},className:"btn-secondary",children:"Close"})})]})}),S&&v&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/50 px-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Purchase Order Details"}),(0,Pe.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:v.supplierName||"Unknown Supplier"}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:["PO #",(v.id||v._id||"").toString().slice(-8).toUpperCase()," \u2022 ",L(v.createdAt||v.orderDate||v.date)]})]}),(0,Pe.jsx)("button",{type:"button",onClick:()=>{A(!1),N(null)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full","aria-label":"Close",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Status"}),(0,Pe.jsx)("span",{className:function(){const e="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold";switch(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pending")||"pending").toLowerCase()){case"completed":return"".concat(e," bg-emerald-100 text-emerald-700");case"cancelled":case"canceled":return"".concat(e," bg-rose-100 text-rose-700");case"in-progress":case"processing":return"".concat(e," bg-sky-100 text-sky-700");default:return"".concat(e," bg-amber-100 text-amber-700")}}(v.status),children:function(){const e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pending")||"pending").toString().trim();return e?e.charAt(0).toUpperCase()+e.slice(1):"Pending"}(v.status)})]}),v.expectedDeliveryDate&&(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Expected Delivery"}),(0,Pe.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:L(v.expectedDeliveryDate)})]})]}),v.items&&v.items.length>0&&(0,Pe.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,Pe.jsx)("thead",{className:"bg-gray-100",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-600",children:"Item"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-center font-medium text-gray-600",children:"Qty"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right font-medium text-gray-600",children:"Price"}),(0,Pe.jsx)("th",{className:"px-4 py-2 text-right font-medium text-gray-600",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"divide-y divide-gray-100",children:v.items.map((e,t)=>{const{rate:n,total:r,qty:s,unit:i}=Ky(e);return(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("td",{className:"px-4 py-2 text-gray-800",children:(0,Pe.jsx)("span",{className:"truncate block max-w-[200px]",title:e.productName||e.name||"\u2014",children:e.productName||e.name||"\u2014"})}),(0,Pe.jsxs)("td",{className:"px-4 py-2 text-center text-gray-600",children:[s," ",i]}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right text-gray-600",children:Zy(n)}),(0,Pe.jsx)("td",{className:"px-4 py-2 text-right font-medium text-gray-700",children:Zy(r)})]},t)})})]})}),(0,Pe.jsx)("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("span",{className:"text-sm font-medium text-blue-700",children:"Total Amount"}),(0,Pe.jsx)("span",{className:"text-2xl font-bold text-blue-900",children:Zy(F(v))})]})}),v.notes&&(0,Pe.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm text-gray-700",children:[(0,Pe.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-600 mb-1",children:"Notes"}),v.notes]})]}),(0,Pe.jsx)("div",{className:"flex justify-end border-t border-gray-200 px-6 py-4",children:(0,Pe.jsx)("button",{type:"button",onClick:()=>{A(!1),N(null)},className:"btn-secondary",children:"Close"})})]})})]})},eb=Ee("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);wx.register(hy,gy,Gx,Zx,dy,Qx,Ex);const tb={primary:{background:"rgba(47, 60, 126, 0.12)",color:"#2F3C7E",border:"rgba(47, 60, 126, 0.28)"},teal:{background:"rgba(45, 212, 191, 0.14)",color:"#0F766E",border:"rgba(15, 118, 110, 0.24)"},amber:{background:"rgba(244, 162, 89, 0.16)",color:"#C2410C",border:"rgba(194, 65, 12, 0.24)"},rose:{background:"rgba(251, 113, 133, 0.16)",color:"#BE123C",border:"rgba(190, 18, 60, 0.24)"},sky:{background:"rgba(56, 189, 248, 0.18)",color:"#0369A1",border:"rgba(3, 105, 161, 0.24)"},emerald:{background:"rgba(74, 222, 128, 0.14)",color:"#047857",border:"rgba(4, 120, 87, 0.22)"},purple:{background:"rgba(196, 181, 253, 0.2)",color:"#6D28D9",border:"rgba(109, 40, 217, 0.24)"},slate:{background:"rgba(148, 163, 184, 0.16)",color:"#1E293B",border:"rgba(30, 41, 59, 0.2)"}},nb=e=>tb[e]||tb.slate,rb=()=>{var e,n,r;const{state:s}=(0,i.nm)(),[o,l]=(0,t.useState)("today"),[c,d]=(0,t.useState)(!1),u=t.useRef(null),h=(()=>{try{return(0,Se.$u)()}catch(e){return null}})(),m=e=>{var t,n,r;if(!e&&0!==e)return null;return(null===e||void 0===e||null===(t=e.toString)||void 0===t||null===(n=(r=t.call(e)).trim)||void 0===n?void 0:n.call(r))||null},f=new Set([h,null===(e=s.currentUser)||void 0===e?void 0:e.sellerId,null===(n=s.currentUser)||void 0===n?void 0:n.id,null===(r=s.currentUser)||void 0===r?void 0:r._id].map(m).filter(Boolean)),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&0!==f.size?e.filter(e=>((e,t)=>{var n,r,s;if(!e||!(t instanceof Set)||0===t.size)return!0;const i=[e.sellerId,e.sellerID,e.seller_id,e._sellerId,null===(n=e.seller)||void 0===n?void 0:n.id,null===(r=e.seller)||void 0===r?void 0:r._id,null===(s=e.seller)||void 0===s?void 0:s.sellerId].map(m).filter(Boolean);return 0===i.length||i.some(e=>t.has(e))})(e,f)):e||[]},{startDate:g,endDate:x}=(()=>{const e=new Date;e.setHours(23,59,59,999);const t=new Date;t.setHours(0,0,0,0);let n=new Date(t);switch(o){case"today":default:return{startDate:t,endDate:e};case"7d":n.setDate(e.getDate()-7);break;case"30d":n.setDate(e.getDate()-30);break;case"90d":n.setDate(e.getDate()-90);break;case"1y":n.setFullYear(e.getFullYear()-1)}return{startDate:n,endDate:e}})(),y=p(s.orders||[]).filter(e=>{if(e.isDeleted)return!1;const t=new Date(e.createdAt||e.date||0);return t>=g&&t<=x}),b=p(s.purchaseOrders||[]).filter(e=>{if(e.isDeleted)return!1;const t=new Date(e.createdAt||e.orderDate||e.date||e.updatedAt||0);return t>=g&&t<=x}),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Number(e);return Number.isFinite(n)?n:t},v=e=>Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[],N=e=>{var t;const n=w(null!==(t=null===e||void 0===e?void 0:e.totalAmount)&&void 0!==t?t:null===e||void 0===e?void 0:e.total);return n>0?n:v(e).reduce((e,t)=>{var n,r,s;w(null===t||void 0===t?void 0:t.quantity);return e+w(null!==(n=null!==(r=null!==(s=null===t||void 0===t?void 0:t.totalSellingPrice)&&void 0!==s?s:null===t||void 0===t?void 0:t.sellingPrice)&&void 0!==r?r:null===t||void 0===t?void 0:t.price)&&void 0!==n?n:null===t||void 0===t?void 0:t.unitPrice)},0)},S=e=>{var t,n,r;if(!e)return 0;const s=w(null!==(t=null!==(n=null!==(r=e.total)&&void 0!==r?r:e.grandTotal)&&void 0!==n?n:e.amount)&&void 0!==t?t:e.totalAmount,0);return s>0?s:Array.isArray(e.items)&&e.items.length>0?e.items.reduce((e,t)=>{var n,r,s,i,a,o,l,c,d;const u=w(null!==(n=null!==(r=t.subtotal)&&void 0!==r?r:t.total)&&void 0!==n?n:t.lineTotal,0);if(u)return e+u;return e+w(null!==(s=null!==(i=null!==(a=null!==(o=t.price)&&void 0!==o?o:t.costPrice)&&void 0!==a?a:t.unitPrice)&&void 0!==i?i:t.rate)&&void 0!==s?s:0,0)*w(null!==(l=null!==(c=null!==(d=t.quantity)&&void 0!==d?d:t.qty)&&void 0!==c?c:t.count)&&void 0!==l?l:1,1)},0):0},A=y.reduce((e,t)=>e+N(t),0),_=y.length,C=(e=>{const t=e=>("number"===typeof e?e:parseFloat(e))||0;return e.reduce((e,n)=>{if(!n.items||!Array.isArray(n.items))return e;return e+n.items.reduce((e,n)=>{var r,s,i,a;return e+(t(null!==(r=null!==(s=n.totalSellingPrice)&&void 0!==s?s:n.sellingPrice)&&void 0!==r?r:0)-t(null!==(i=null!==(a=n.totalCostPrice)&&void 0!==a?a:n.costPrice)&&void 0!==i?i:0))},0)},0)})(y)-b.reduce((e,t)=>e+(S(t)||0),0),I=(0,t.useMemo)(()=>{const e=[],t=new Map,n=Math.ceil((x-g)/864e5),r=Math.min(n,30);for(let s=0;s<r;s++){const n=new Date(g);n.setDate(n.getDate()+s);const r=n.toLocaleDateString("en-US",{month:"short",day:"numeric"});e.push(r),t.set(r,0)}return y.forEach(e=>{const n=new Date(e.createdAt||e.date);if(!Number.isNaN(n.getTime())&&n>=g&&n<=x){const r=n.toLocaleDateString("en-US",{month:"short",day:"numeric"});t.has(r)&&t.set(r,t.get(r)+N(e))}}),{labels:e,datasets:[{label:"Sales (\u20b9)",data:e.map(e=>t.get(e)||0),backgroundColor:"rgba(34, 197, 94, 0.8)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:2,borderRadius:8}]}},[y,g,x]),E=s.products.length,T=s.lowStockThreshold||10,j=s.products.filter(e=>{var t,n;const r=w(null!==(t=null!==(n=e.quantity)&&void 0!==n?n:e.stock)&&void 0!==t?t:0);return r>0&&r<=T}).length,k=s.products.filter(e=>{var t,n;return w(null!==(t=null!==(n=e.quantity)&&void 0!==n?n:e.stock)&&void 0!==t?t:0)<=0}).length,D=(0,t.useMemo)(()=>({labels:["In Stock","Low Stock","Out of Stock"],datasets:[{data:[E-j-k,j,k],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(249, 115, 22, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgba(34, 197, 94, 1)","rgba(249, 115, 22, 1)","rgba(239, 68, 68, 1)"],borderWidth:2}]}),[E,j,k]),P=b.reduce((e,t)=>e+S(t),0),R=b.filter(e=>{const t=(e.status||"pending").toLowerCase();return"pending"===t||"processing"===t||"in-progress"===t}).length,O=(0,t.useMemo)(()=>{const e={completed:0,pending:0,cancelled:0};return b.forEach(t=>{const n=(t.status||"pending").toLowerCase();"completed"===n?e.completed++:"cancelled"===n||"canceled"===n?e.cancelled++:e.pending++}),{labels:["Completed","Pending","Cancelled"],datasets:[{data:[e.completed,e.pending,e.cancelled],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(249, 115, 22, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgba(34, 197, 94, 1)","rgba(249, 115, 22, 1)","rgba(239, 68, 68, 1)"],borderWidth:2}]}},[b]),L=(0,t.useMemo)(()=>{const e={cash:0,online:0,due:0};return y.forEach(t=>{const n=w(t.totalAmount||0),r=(e=>{const t=(e||"").toString().toLowerCase();return"card"===t||"upi"===t||"online"===t?"online":"due"===t||"credit"===t?"due":"cash"})(t.paymentMethod);"split"===t.paymentMethod&&t.splitPaymentDetails?(e.cash+=w(t.splitPaymentDetails.cashAmount||0),e.online+=w(t.splitPaymentDetails.onlineAmount||0),e.due+=w(t.splitPaymentDetails.dueAmount||0)):e[r]+=n}),e},[y]),M=L.cash,F=L.online,B=s.customers.reduce((e,t)=>{var n,r;return e+w(null!==(n=null!==(r=t.balanceDue)&&void 0!==r?r:t.dueAmount)&&void 0!==n?n:0)},0),U=(0,t.useMemo)(()=>({labels:["Cash","Online","Due"],datasets:[{data:[M,F,B],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)","rgba(249, 115, 22, 0.8)"],borderColor:["rgba(34, 197, 94, 1)","rgba(59, 130, 246, 1)","rgba(249, 115, 22, 1)"],borderWidth:2}]}),[M,F,B]),z={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:10,font:{size:11}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:10,cornerRadius:8}}},q=(0,a.A)((0,a.A)({},z),{},{scales:{x:{grid:{display:!1}},y:{grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{callback:function(e){return"\u20b9"+e.toLocaleString("en-IN")}}}}}),H=(e,t,n)=>{const r=new Blob([t],{type:n}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=e,i.click(),window.URL.revokeObjectURL(s)},V=e=>{if(null===e||void 0===e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t};t.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const W=[{value:"today",label:"Today"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"},{value:"90d",label:"Last 90 days"},{value:"1y",label:"All Time"}],G=e=>"\u20b9".concat(w(e).toFixed(2));return(0,Pe.jsxs)("div",{className:"space-y-6 fade-in-up",children:[(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Business Reports"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-2",children:"Essential business insights and analytics"})]}),(0,Pe.jsxs)("div",{className:"mt-4 sm:mt-0 flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[(0,Pe.jsx)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80 p-1 shadow-sm",children:W.map(e=>{const t=o===e.value;return(0,Pe.jsx)("button",{type:"button",onClick:()=>l(e.value),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat(t?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:e.label},e.value)})}),(0,Pe.jsxs)("div",{className:"relative",ref:u,children:[(0,Pe.jsxs)("button",{onClick:()=>d(!c),className:"btn-secondary flex items-center justify-center gap-2 px-5 py-2.5 text-sm font-semibold",children:[(0,Pe.jsx)(st,{className:"h-4 w-4"}),"Export",(0,Pe.jsx)(Ku,{className:"h-4 w-4 transition-transform ".concat(c?"rotate-180":"")})]}),c&&(0,Pe.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50",children:[(0,Pe.jsxs)("button",{onClick:()=>{try{var e,t;const i=new Uo("l","mm","a4"),a=i.internal.pageSize.getWidth(),l=i.internal.pageSize.getHeight(),c={r:47,g:60,b:126},u={r:244,g:162,b:89},h={r:248,g:249,b:253},m={r:15,g:23,b:42},f={r:100,g:116,b:150},p={r:226,g:232,b:240},g=15,x=15,y=a-g-x,b=28;i.setFillColor(c.r,c.g,c.b),i.rect(0,0,a,b,"F"),i.setFillColor(u.r,u.g,u.b),i.rect(0,0,a,3,"F");const w=18,v=g,N=8;i.setFillColor(255,255,255),i.setDrawColor(u.r,u.g,u.b),i.setLineWidth(.5),i.rect(v,N,w,w,"FD"),i.setTextColor(255,255,255),i.setFont("helvetica","bold"),i.setFontSize(20),i.text("Drag & Drop",v+w+6,N+7),i.setFillColor(u.r,u.g,u.b),i.rect(v+w+6,N+9,50,2,"F"),i.setFont("helvetica","bold"),i.setFontSize(14),i.text("Business Reports",a-x,N+5,{align:"right"}),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(240,240,240);try{const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",weekday:"long"});i.text(e,a-x,N+11,{align:"right"})}catch(r){i.text((new Date).toLocaleDateString("en-US"),a-x,N+11,{align:"right"})}i.setFontSize(8),i.setTextColor(220,220,220);const S="".concat((null===(e=s.currentUser)||void 0===e?void 0:e.shopName)||"Store");i.text(S,a-x,N+16,{align:"right"});const I=b+12,T=20,D=4,O=(y-3*D)/4;[{label:"Total Sales",value:"\u20b9".concat(A.toFixed(2)),accentColor:{r:34,g:197,b:94}},{label:"Total Orders",value:_.toString(),accentColor:c},{label:"Net Profit",value:"\u20b9".concat(C.toFixed(2)),accentColor:{r:59,g:130,b:246}},{label:"Products",value:E.toString(),accentColor:u}].forEach((e,t)=>{const n=g+t*(O+D);i.setFillColor(255,255,255),i.setDrawColor(p.r,p.g,p.b),i.setLineWidth(.3),i.rect(n,I,O,T,"FD"),i.setFillColor(e.accentColor.r,e.accentColor.g,e.accentColor.b),i.rect(n,I,O,2.5,"F"),i.setFontSize(8),i.setFont("helvetica","normal"),i.setTextColor(f.r,f.g,f.b),i.text(e.label.toUpperCase(),n+4,I+8),i.setFontSize(12),i.setFont("helvetica","bold"),i.setTextColor(e.accentColor.r,e.accentColor.g,e.accentColor.b);const r=i.splitTextToSize(e.value,O-8);i.text(r[0],n+4,I+15)});let L=I+T+15;i.setDrawColor(c.r,c.g,c.b),i.setLineWidth(.5),i.line(g,L,a-x,L),L+=8,i.setFontSize(16),i.setFont("helvetica","bold"),i.setTextColor(c.r,c.g,c.b),i.text("Detailed Report Summary",g,L),i.setFontSize(9),i.setFont("helvetica","normal"),i.setTextColor(f.r,f.g,f.b);const U=(null===(t=W.find(e=>e.value===o))||void 0===t?void 0:t.label)||"All Time";i.text("Period: ".concat(U),a-x,L,{align:"right"}),L+=10;const z=L,q=7,H=8,V=4,G=[["Section","Metric","Value"],["Sales Summary","Total Sales","\u20b9".concat(A.toFixed(2))],["Sales Summary","Total Orders",_.toString()],["Sales Summary","Net Profit","\u20b9".concat(C.toFixed(2))],["Stock Summary","Total Products",E.toString()],["Stock Summary","Low Stock",j.toString()],["Stock Summary","Out of Stock",k.toString()],["Purchase Summary","Total Purchase Amount","\u20b9".concat(P.toFixed(2))],["Purchase Summary","Pending Orders",R.toString()],["Payment Summary","Cash Received","\u20b9".concat(M.toFixed(2))],["Payment Summary","Online Received","\u20b9".concat(F.toFixed(2))],["Payment Summary","Outstanding Due","\u20b9".concat(B.toFixed(2))]],Y=.35*y;G.forEach((e,t)=>{const n=z+t*q+(0===t?0:H-q);if(0===t)i.setFillColor(c.r,c.g,c.b),i.rect(g,n-H+2,y,H,"F"),i.setFont("helvetica","bold"),i.setFontSize(10),i.setTextColor(255,255,255),i.text(e[0],g+V,n-2),i.text(e[1],g+Y+V,n-2),i.text(e[2],a-x-V,n-2,{align:"right"});else{const r=t%2===0?{r:h.r,g:h.g,b:h.b}:{r:255,g:255,b:255};i.setFillColor(r.r,r.g,r.b),i.setDrawColor(p.r,p.g,p.b),i.setLineWidth(.1),i.rect(g,n-q+2,y,q,"FD"),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(m.r,m.g,m.b),i.text(e[0],g+V,n-2),i.text(e[1],g+Y+V,n-2),i.setFont("helvetica","bold"),i.text(e[2],a-x-V,n-2,{align:"right"})}});const X=i.internal.getNumberOfPages(),Q=15,K=l-Q;for(let e=1;e<=X;e++){var n;i.setPage(e),i.setFillColor(h.r,h.g,h.b),i.rect(0,K,a,Q,"F"),i.setFillColor(u.r,u.g,u.b),i.rect(0,K,a,1.5,"F"),i.setDrawColor(p.r,p.g,p.b),i.setLineWidth(.3),i.line(0,K,a,K),i.setFontSize(9),i.setFont("helvetica","normal"),i.setTextColor(f.r,f.g,f.b),i.text("Page ".concat(e," of ").concat(X),g,K+10);try{const e=new Date,t=e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" "+e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});i.text("Generated: ".concat(t),g+50,K+10)}catch(r){i.text("Generated: ".concat((new Date).toISOString().split("T")[0]),g+50,K+10)}i.setFont("helvetica","bold"),i.setFontSize(10),i.setTextColor(c.r,c.g,c.b),i.text("".concat((null===(n=s.currentUser)||void 0===n?void 0:n.shopName)||"Store"),a-x,K+6,{align:"right"}),i.setFont("helvetica","normal"),i.setFontSize(8),i.setTextColor(f.r,f.g,f.b),i.text("Drag & Drop",a-x,K+11,{align:"right"})}i.save("reports-".concat((new Date).toISOString().split("T")[0],".pdf")),window.showToast&&window.showToast("Reports exported as PDF.","success"),d(!1)}catch(i){console.error("Error generating PDF:",i),console.error("Error details:",i.message,i.stack),window.showToast&&window.showToast("Error generating PDF: ".concat(i.message||"Please try again."),"error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Lt,{className:"h-4 w-4 text-red-600"}),(0,Pe.jsx)("span",{children:"Export as PDF"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{var e;const t={dateRange:{start:g.toISOString(),end:x.toISOString(),range:o},salesSummary:{totalSales:A,totalOrders:_,netProfit:C},stockSummary:{totalProducts:E,lowStockCount:j,outOfStockCount:k},purchaseSummary:{totalPurchaseAmount:P,pendingPurchaseOrders:R},paymentSummary:{totalCashReceived:M,totalOnlineReceived:F,totalOutstandingDue:B},generatedAt:(new Date).toISOString(),shopName:(null===(e=s.currentUser)||void 0===e?void 0:e.shopName)||"Store"};H("reports-".concat((new Date).toISOString().split("T")[0],".json"),JSON.stringify(t,null,2),"application/json"),window.showToast&&window.showToast("Reports exported as JSON.","success"),d(!1)}catch(t){console.error("Error exporting JSON:",t),window.showToast&&window.showToast("Error exporting JSON. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4 text-yellow-600"}),(0,Pe.jsx)("span",{children:"Export as JSON"})]}),(0,Pe.jsxs)("button",{onClick:()=>{try{const e=["Section","Metric","Value"],t=[["Sales Summary","Total Sales","\u20b9".concat(A.toFixed(2))],["Sales Summary","Total Orders",_],["Sales Summary","Net Profit","\u20b9".concat(C.toFixed(2))],["Stock Summary","Total Products",E],["Stock Summary","Low Stock Count",j],["Stock Summary","Out of Stock Count",k],["Purchase Summary","Total Purchase Amount","\u20b9".concat(P.toFixed(2))],["Purchase Summary","Pending Purchase Orders",R],["Payment Summary","Cash Received","\u20b9".concat(M.toFixed(2))],["Payment Summary","Online Received","\u20b9".concat(F.toFixed(2))],["Payment Summary","Outstanding Due","\u20b9".concat(B.toFixed(2))]],n=[e.join(","),...t.map(e=>e.map(V).join(","))].join("\n");H("reports-".concat((new Date).toISOString().split("T")[0],".csv"),n,"text/csv;charset=utf-8;"),window.showToast&&window.showToast("Reports exported as CSV.","success"),d(!1)}catch(e){console.error("Error exporting CSV:",e),window.showToast&&window.showToast("Error exporting CSV. Please try again.","error")}},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors flex items-center gap-3",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4 text-green-600"}),(0,Pe.jsx)("span",{children:"Export as CSV"})]})]})]})]})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Sales Summary"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Revenue, orders, and net profit for selected period"})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6",children:[(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("emerald").background,color:nb("emerald").color,borderColor:nb("emerald").border},children:(0,Pe.jsx)(je,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Total Sales"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(A)})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("primary").background,color:nb("primary").color,borderColor:nb("primary").border},children:(0,Pe.jsx)(bt,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Total Orders"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:_})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("sky").background,color:nb("sky").color,borderColor:nb("sky").border},children:(0,Pe.jsx)(je,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Net Profit"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(C)})]})]})})})]}),(0,Pe.jsx)("div",{className:"h-64",children:(0,Pe.jsx)(Xy,{data:I,options:q})})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Stock Summary"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Product inventory status and alerts"})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6",children:[(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("slate").background,color:nb("slate").color,borderColor:nb("slate").border},children:(0,Pe.jsx)(Me,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Total Products"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:E})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("amber").background,color:nb("amber").color,borderColor:nb("amber").border},children:(0,Pe.jsx)(lt,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Low Stock"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:j})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("rose").background,color:nb("rose").color,borderColor:nb("rose").border},children:(0,Pe.jsx)(eb,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Out of Stock"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:k})]})]})})})]}),(0,Pe.jsx)("div",{className:"h-48 flex items-center justify-center",children:(0,Pe.jsx)("div",{className:"w-64",children:(0,Pe.jsx)(Qy,{data:D,options:z})})})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Purchase Summary"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Purchase orders and pending items"})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6",children:[(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("purple").background,color:nb("purple").color,borderColor:nb("purple").border},children:(0,Pe.jsx)(qe,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Total Purchase Amount"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(P)})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("amber").background,color:nb("amber").color,borderColor:nb("amber").border},children:(0,Pe.jsx)(lt,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Pending Orders"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:R})]})]})})})]}),(0,Pe.jsx)("div",{className:"h-48 flex items-center justify-center",children:(0,Pe.jsx)("div",{className:"w-64",children:(0,Pe.jsx)(Qy,{data:O,options:z})})})]}),(0,Pe.jsxs)("div",{className:"card",children:[(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Payment Summary"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600",children:"Payment methods and outstanding dues"})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6",children:[(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("emerald").background,color:nb("emerald").color,borderColor:nb("emerald").border},children:(0,Pe.jsx)(Ve,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Cash Received"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(M)})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("sky").background,color:nb("sky").color,borderColor:nb("sky").border},children:(0,Pe.jsx)(De,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Online Received"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(F)})]})]})})}),(0,Pe.jsx)("div",{className:"stat-card bg-white rounded-xl border border-gray-200 p-5 shadow-sm hover:shadow-md transition-all duration-300",children:(0,Pe.jsx)("div",{className:"flex items-start justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"rounded-xl border p-2.5 transition",style:{backgroundColor:nb("amber").background,color:nb("amber").color,borderColor:nb("amber").border},children:(0,Pe.jsx)(lt,{className:"h-5 w-5"})}),(0,Pe.jsxs)("div",{className:"min-w-0",children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-1",children:"Outstanding Due"}),(0,Pe.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:G(B)})]})]})})})]}),(0,Pe.jsx)("div",{className:"h-48 flex items-center justify-center",children:(0,Pe.jsx)("div",{className:"w-64",children:(0,Pe.jsx)(Qy,{data:U,options:z})})})]})]})},sb=e=>{try{const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-IN",n).format(t)}catch(t){return e}},ib=e=>{try{const t=new Date(e);return Number.isNaN(t.getTime())?e:new Intl.DateTimeFormat("en-IN",{day:"2-digit",month:"short",year:"numeric"}).format(t)}catch(t){return e}},ab=()=>{const{state:e}=(0,i.nm)(),[n,r]=(0,t.useState)(""),[s,a]=(0,t.useState)("all"),[o,l]=(0,t.useState)("all"),[c,d]=(0,t.useState)(1),[u]=(0,t.useState)(25),[h,m]=(0,t.useState)(null),[f,p]=(0,t.useState)(!1),[g,x]=(0,t.useState)(!1),y=(0,t.useRef)(null);(0,t.useEffect)(()=>{const e=e=>{y.current&&!y.current.contains(e.target)&&x(!1)};return g&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[g]);const b=(0,t.useMemo)(()=>(e.orders||[]).filter(e=>!e.isDeleted),[e.orders]),w=(0,t.useMemo)(()=>{let e=b;if(n){const t=n.toLowerCase();e=e.filter(e=>{const n=(e.customerName||"").toLowerCase(),r=(e.customerMobile||"").toLowerCase();return n.includes(t)||r.includes(t)})}if("all"!==s&&(e=e.filter(e=>{const t=(e.paymentMethod||"").toLowerCase();return"online"===s.toLowerCase()?"card"===t||"upi"===t||"online"===t||"split"===t&&e.splitPaymentDetails&&e.splitPaymentDetails.onlineAmount>0:"cash"===s.toLowerCase()?"cash"===t||"split"===t&&e.splitPaymentDetails&&e.splitPaymentDetails.cashAmount>0:"due"===s.toLowerCase()?"due"===t||"credit"===t||"split"===t&&e.splitPaymentDetails&&e.splitPaymentDetails.dueAmount>0:t===s.toLowerCase()})),"all"!==o){const t=new Date;t.setHours(0,0,0,0),e=e.filter(e=>{const n=new Date(e.createdAt||e.date||0);if(Number.isNaN(n.getTime()))return!1;switch(n.setHours(0,0,0,0),o){case"today":return n.getTime()===t.getTime();case"week":const e=new Date(t);return e.setDate(e.getDate()-7),n>=e;case"month":const r=new Date(t);return r.setMonth(r.getMonth()-1),n>=r;default:return!0}})}return e.sort((e,t)=>{const n=new Date(e.createdAt||e.date||0);return new Date(t.createdAt||t.date||0)-n})},[b,n,s,o]),v=Math.ceil(w.length/u),N=(c-1)*u,S=w.slice(N,N+u),A=e=>{d(e)},_=w.reduce((e,t)=>e+(Number(t.totalAmount)||Number(t.total)||0),0),C=w.filter(e=>{const t=(e.paymentMethod||"").toLowerCase();return"split"===t&&e.splitPaymentDetails?e.splitPaymentDetails.cashAmount>0:"cash"===t}).reduce((e,t)=>"split"===(t.paymentMethod||"").toLowerCase()&&t.splitPaymentDetails?e+(t.splitPaymentDetails.cashAmount||0):e+(Number(t.totalAmount)||Number(t.total)||0),0),I=w.filter(e=>{const t=(e.paymentMethod||"").toLowerCase();return"split"===t&&e.splitPaymentDetails?e.splitPaymentDetails.onlineAmount>0:"card"===t||"upi"===t||"online"===t}).reduce((e,t)=>"split"===(t.paymentMethod||"").toLowerCase()&&t.splitPaymentDetails?e+(t.splitPaymentDetails.onlineAmount||0):e+(Number(t.totalAmount)||Number(t.total)||0),0),E=(w.filter(e=>{const t=(e.paymentMethod||"").toLowerCase();return"split"===t&&e.splitPaymentDetails?e.splitPaymentDetails.dueAmount>0:"due"===t||"credit"===t}).reduce((e,t)=>"split"===(t.paymentMethod||"").toLowerCase()&&t.splitPaymentDetails?e+(t.splitPaymentDetails.dueAmount||0):e+(Number(t.totalAmount)||Number(t.total)||0),0),e=>{m(e),p(!0)}),T=e=>{const t=(e||"").toLowerCase();return"cash"===t?"bg-green-50 text-green-700":"card"===t||"upi"===t||"online"===t?"bg-blue-50 text-blue-700":"due"===t||"credit"===t?"bg-red-50 text-red-700":"bg-gray-50 text-gray-700"},j=(e,t)=>{const n=(e||"").toLowerCase();if("split"===n&&t){const e=[];return t.cashAmount>0&&e.push("Cash: \u20b9".concat(t.cashAmount.toFixed(2))),t.onlineAmount>0&&e.push("Online: \u20b9".concat(t.onlineAmount.toFixed(2))),t.dueAmount>0&&e.push("Due: \u20b9".concat(t.dueAmount.toFixed(2))),"Split (".concat(e.join(", "),")")}return"cash"===n?"Cash":"card"===n?"Card":"upi"===n?"UPI":"online"===n?"Online":"due"===n||"credit"===n?"Due/Credit":e||"N/A"},k=t=>{var n,r,s,i,a,o,l,c,d,u,h,m,f,p,g,x,y,b;if(!t)return"";const w=e=>null===e||void 0===e||""===e?"null":e,v=w(e.storeName||(null===(n=e.currentUser)||void 0===n?void 0:n.shopName)||(null===(r=e.currentUser)||void 0===r?void 0:r.username)||"Store"),N=w((null===(s=e.currentUser)||void 0===s?void 0:s.shopAddress)||""),S=(null===(i=e.currentUser)||void 0===i?void 0:i.phoneNumber)||(null===(a=e.currentUser)||void 0===a?void 0:a.mobileNumber)||(null===(o=e.currentUser)||void 0===o?void 0:o.phone)||(null===(l=e.currentUser)||void 0===l?void 0:l.contact)||"",A=It(S),_=A?"+91 ".concat(A):w(S),C=new Date(t.createdAt||t.date||Date.now()),I=Number.isNaN(C.getTime())?"null":C.toLocaleDateString("en-IN"),E=w(t.customerName||"Customer"),T=It(t.customerMobile||""),k=T?"+91 ".concat(T):"null",D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Number(e);return Number.isFinite(n)?n:t},P=D(null!==(c=null!==(d=null!==(u=null!==(h=t.subtotal)&&void 0!==h?h:t.subTotal)&&void 0!==u?u:t.totalAmount)&&void 0!==d?d:t.total)&&void 0!==c?c:0,0),R=D(null!==(m=null!==(f=t.discountAmount)&&void 0!==f?f:t.discount)&&void 0!==m?m:0,0),O=D(null!==(p=null!==(g=t.taxAmount)&&void 0!==g?g:t.tax)&&void 0!==p?p:0,0),L=D(null!==(x=null!==(y=t.totalAmount)&&void 0!==y?y:t.total)&&void 0!==x?x:P,0),M=null!==(b=t.taxPercent)&&void 0!==b?b:t.taxRate,F=void 0!==M&&null!==M?Number(M):P>0?O/P*100:null,B=Number.isFinite(P)?"\u20b9".concat(P.toFixed(2)):"\u20b9null",U=Number.isFinite(R)?"\u20b9".concat(R.toFixed(2)):"\u20b9null",z=Number.isFinite(O)?"\u20b9".concat(O.toFixed(2)):"\u20b9null",q=Number.isFinite(F)?"".concat(F%1===0?F.toFixed(0):F.toFixed(2),"%"):"null",H=Number.isFinite(L)?"\u20b9".concat(L.toFixed(2)):"\u20b9null",V=t.items||[];let W;if(V.length>0){const e=V.map((e,t)=>((e,t)=>{const{rate:n,total:r,qty:s,unit:i}=Ky(e),a=e.name||e.productName||"Item ".concat(t+1),o=s.toString(),l="\u20b9".concat(n.toFixed(2)),c="\u20b9".concat(r.toFixed(2));let d="\u2022 ".concat(a);return d+=s>0?" - ".concat(o).concat(i?" ".concat(i):""," x ").concat(l," = ").concat(c):" - ".concat(c),d})(e,t));W=e.join("\n")}else W="\u2022 No items";const G=w(j(t.paymentMethod,t.splitPaymentDetails)),Y="--------------------------------";return["             INVOICE","",Y,"Shop Name : ".concat(v),"Address   : ".concat(N),"Phone     : ".concat(_),"Date      : ".concat(I),Y,"Customer Name : ".concat(E),"Customer Phone: ".concat(k),Y,"Items:","",W,Y,"Subtotal     : ".concat(B),"Discount     : ".concat(U),"Tax (".concat(q,")     : ").concat(z),Y,"Grand Total  : ".concat(H),"Payment Mode : ".concat(G),"Thank you for shopping with us!",Y,"       Powered by Drag & Drop",Y].join("\n")},D=e=>{if(!e)return;const t=It(e.customerMobile||"");if(!t)return void(window.showToast&&window.showToast("No customer mobile number found for this invoice.","warning"));const n=k(e);if(!n)return void(window.showToast&&window.showToast("Unable to prepare invoice details for sharing.","error"));const r=10===t.length?"91".concat(t):t,s="https://wa.me/".concat(r,"?text=").concat(encodeURIComponent(n));window.open(s,"_blank")};return(0,Pe.jsxs)("div",{className:"space-y-6",children:[(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900",children:"Sales Order History"}),(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:"View and manage all your sales orders"})]}),(0,Pe.jsx)("div",{className:"flex items-center gap-2",children:(0,Pe.jsxs)("div",{className:"relative",ref:y,children:[(0,Pe.jsxs)("button",{onClick:()=>x(!g),className:"btn-secondary flex items-center gap-2 text-sm px-3 sm:px-4 py-2 touch-manipulation",children:[(0,Pe.jsx)(st,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Export"})]}),g&&(0,Pe.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[(0,Pe.jsxs)("button",{onClick:()=>{(()=>{const e=w.map(e=>[e.customerName||"",e.customerMobile||"",j(e.paymentMethod,e.splitPaymentDetails)||"",(Number(e.totalAmount)||Number(e.total)||0).toFixed(2),ib(e.createdAt||e.date)]),t=[["Customer Name","Customer Mobile","Payment Method","Total Amount","Date"].join(","),...e.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="sales-orders-".concat((new Date).toISOString().split("T")[0],".csv"),r.click()})(),x(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,Pe.jsx)(Mt,{className:"h-4 w-4"}),"Export as CSV"]}),(0,Pe.jsxs)("button",{onClick:()=>{(()=>{const e=JSON.stringify(w,null,2),t=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="sales-orders-".concat((new Date).toISOString().split("T")[0],".json"),n.click()})(),x(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,Pe.jsx)(Ft,{className:"h-4 w-4"}),"Export as JSON"]}),(0,Pe.jsxs)("button",{onClick:()=>{(()=>{const e=new Uo;e.setFontSize(18),e.text("Sales Order History",14,22),e.setFontSize(12),e.text("Total Orders: ".concat(w.length),14,32),e.text("Total Sales: ".concat(Zy(_)),14,38);let t=50;e.setFontSize(10),e.text("Customer",14,t),e.text("Payment",80,t),e.text("Amount",130,t),e.text("Date",170,t),t+=5,S.forEach((n,r)=>{t>280&&(e.addPage(),t=20),e.text((n.customerName||"Walk-in Customer").substring(0,20),14,t),e.text((n.paymentMethod||"").substring(0,8),80,t),e.text(Zy(n.totalAmount||n.total),130,t),e.text(ib(n.createdAt||n.date),170,t),t+=7}),e.save("sales-orders-".concat((new Date).toISOString().split("T")[0],".pdf"))})(),x(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,Pe.jsx)(Be,{className:"h-4 w-4"}),"Export as PDF"]})]})]})})]}),(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{htmlFor:"order-search",className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Search Orders"}),(0,Pe.jsx)("input",{id:"order-search",type:"text",placeholder:"Search by customer name or mobile...",value:n,onChange:e=>{r(e.target.value),d(1)},className:"input-field w-full text-sm sm:text-base"})]}),(0,Pe.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[(0,Pe.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),(0,Pe.jsx)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80 p-1 shadow-sm w-full h-[44px] sm:h-[42px]",children:[{value:"all",label:"All"},{value:"cash",label:"Cash"},{value:"online",label:"Online"},{value:"due",label:"Due/Credit"}].map(e=>{const t=s===e.value;return(0,Pe.jsx)("button",{type:"button",onClick:()=>{a(e.value),d(1)},className:"px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium rounded-full transition flex-1 h-full flex items-center justify-center touch-manipulation ".concat(t?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 active:bg-gray-100"),children:e.label},e.value)})})]}),(0,Pe.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,Pe.jsx)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80 p-1 shadow-sm w-full h-[44px] sm:h-[42px]",children:[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"Last 7 Days"},{value:"month",label:"Last 30 Days"}].map(e=>{const t=o===e.value;return(0,Pe.jsxs)("button",{type:"button",onClick:()=>{l(e.value),d(1)},className:"px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium rounded-full transition flex-1 h-full flex items-center justify-center touch-manipulation ".concat(t?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 active:bg-gray-100"),children:[(0,Pe.jsx)("span",{className:"hidden sm:inline",children:e.label}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"all"===e.value?"All":"today"===e.value?"Today":"week"===e.value?"7 Days":"30 Days"})]},e.value)})})]})]})]})}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Total Orders"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 mt-1 truncate",children:w.length})]}),(0,Pe.jsx)(Be,{className:"h-6 w-6 sm:h-8 sm:w-8 text-indigo-500 flex-shrink-0 ml-2"})]})}),(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Total Sales"}),(0,Pe.jsx)("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 truncate",children:Zy(_)})]}),(0,Pe.jsx)(Be,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-500 flex-shrink-0 ml-2"})]})}),(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Cash Sales"}),(0,Pe.jsx)("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 truncate",children:Zy(C)})]}),(0,Pe.jsx)(Be,{className:"h-6 w-6 sm:h-8 sm:w-8 text-emerald-500 flex-shrink-0 ml-2"})]})}),(0,Pe.jsx)("div",{className:"card p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Online Sales"}),(0,Pe.jsx)("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 truncate",children:Zy(I)})]}),(0,Pe.jsx)(Be,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-500 flex-shrink-0 ml-2"})]})})]}),(0,Pe.jsx)("div",{className:"card hidden lg:block",children:(0,Pe.jsx)("div",{className:"overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gray-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Customer"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Mobile"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Payment Method"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Amount"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Date"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Actions"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:S.length>0?S.map(e=>(0,Pe.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:e.customerName||"Walk-in Customer"}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:e.customerMobile||"-"}),(0,Pe.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:(0,Pe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(T(e.paymentMethod)),children:e.paymentMethod||"N/A"})}),(0,Pe.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-semibold text-gray-900 text-center",children:Zy(e.totalAmount||e.total)}),(0,Pe.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-center",children:sb(e.createdAt||e.date)}),(0,Pe.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,Pe.jsx)("button",{onClick:()=>E(e),className:"p-2 text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-lg transition-colors",title:"View Details",children:(0,Pe.jsx)(zt,{className:"h-4 w-4"})}),e.customerMobile&&(0,Pe.jsx)("button",{onClick:()=>D(e),className:"p-2 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-lg transition-colors",title:"Share Invoice on WhatsApp",children:(0,Pe.jsx)(At,{className:"h-4 w-4"})})]})})]},e.id)):(0,Pe.jsx)("tr",{children:(0,Pe.jsxs)("td",{colSpan:"6",className:"px-4 py-12 text-center",children:[(0,Pe.jsx)(Be,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"No orders found"}),n||"all"!==s||"all"!==o?(0,Pe.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Try adjusting your filters"}):null]})})})]})})}),(0,Pe.jsx)("div",{className:"lg:hidden space-y-3",children:S.length>0?S.map(e=>(0,Pe.jsxs)("div",{className:"card p-4 hover:shadow-md transition-shadow",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate",children:e.customerName||"Walk-in Customer"}),e.customerMobile&&(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.customerMobile})]}),(0,Pe.jsxs)("div",{className:"ml-3 flex items-center gap-2 flex-shrink-0",children:[(0,Pe.jsx)("button",{onClick:()=>E(e),className:"p-2.5 text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-lg transition-colors touch-manipulation",title:"View Details",children:(0,Pe.jsx)(zt,{className:"h-5 w-5"})}),e.customerMobile&&(0,Pe.jsx)("button",{onClick:()=>D(e),className:"p-2.5 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-lg transition-colors touch-manipulation",title:"Share Invoice on WhatsApp",children:(0,Pe.jsx)(At,{className:"h-5 w-5"})})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Amount"}),(0,Pe.jsx)("p",{className:"text-lg font-bold text-gray-900",children:Zy(e.totalAmount||e.total)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Payment"}),(0,Pe.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ".concat(T(e.paymentMethod)),children:j(e.paymentMethod,e.splitPaymentDetails)||"N/A"})]})]}),(0,Pe.jsx)("div",{className:"pt-3 border-t border-gray-200",children:(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:sb(e.createdAt||e.date)})})]},e.id)):(0,Pe.jsxs)("div",{className:"card p-12 text-center",children:[(0,Pe.jsx)(Be,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600 text-base",children:"No orders found"}),n||"all"!==s||"all"!==o?(0,Pe.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Try adjusting your filters"}):null]})}),v>1&&(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4 mt-4 sm:mt-6 px-3 sm:px-4 py-3 sm:py-4 bg-gray-50 rounded-xl border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"text-xs sm:text-sm text-gray-700 text-center sm:text-left",children:["Showing ",(0,Pe.jsx)("span",{className:"font-semibold",children:N+1})," to"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:Math.min(N+u,w.length)})," of"," ",(0,Pe.jsx)("span",{className:"font-semibold",children:w.length})," orders"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>A(1),disabled:1===c,className:"p-2 sm:p-2 text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation","aria-label":"First page",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4 sm:h-4 sm:w-4"})}),(0,Pe.jsx)("button",{onClick:()=>A(c-1),disabled:1===c,className:"p-2 sm:p-2 text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation","aria-label":"Previous page",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4 sm:h-4 sm:w-4"})}),(()=>{const e=[];if(v<=5)for(let t=1;t<=v;t++)e.push(t);else if(c<=3){for(let t=1;t<=4;t++)e.push(t);e.push("ellipsis"),e.push(v)}else if(c>=v-2){e.push(1),e.push("ellipsis");for(let t=v-3;t<=v;t++)e.push(t)}else{e.push(1),e.push("ellipsis");for(let t=c-1;t<=c+1;t++)e.push(t);e.push("ellipsis"),e.push(v)}return e})().map((e,n)=>(0,Pe.jsx)(t.Fragment,{children:"ellipsis"===e?(0,Pe.jsx)("span",{className:"px-1 sm:px-2 text-gray-500 text-xs sm:text-sm",children:"..."}):(0,Pe.jsx)("button",{onClick:()=>A(e),className:"px-2.5 sm:px-3 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors touch-manipulation ".concat(c===e?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-300 active:bg-gray-50"),children:e})},n)),(0,Pe.jsx)("button",{onClick:()=>A(c+1),disabled:c===v,className:"p-2 sm:p-2 text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation","aria-label":"Next page",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4 sm:h-4 sm:w-4"})}),(0,Pe.jsx)("button",{onClick:()=>A(v),disabled:c===v,className:"p-2 sm:p-2 text-gray-500 bg-white border border-gray-300 rounded-lg active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation","aria-label":"Last page",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4 sm:h-4 sm:w-4"})})]})]}),f&&h&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-xl w-full max-w-3xl max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0",children:[(0,Pe.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Order Details"}),(0,Pe.jsx)("button",{onClick:()=>{p(!1),m(null)},className:"p-2 text-gray-400 active:text-gray-600 active:bg-gray-100 rounded-lg transition-colors touch-manipulation","aria-label":"Close",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 sm:h-5 sm:w-5"})})]}),(0,Pe.jsx)("div",{className:"overflow-y-auto flex-1 p-4 sm:p-6",children:(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Date"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-semibold text-gray-900 break-words",children:sb(h.createdAt||h.date)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Customer Name"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-semibold text-gray-900 break-words",children:h.customerName||"Walk-in Customer"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Customer Mobile"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-semibold text-gray-900 break-words",children:h.customerMobile||"-"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Payment Method"}),(0,Pe.jsx)("span",{className:"inline-flex items-center px-2.5 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium ".concat(T(h.paymentMethod)),children:j(h.paymentMethod,h.splitPaymentDetails)||"N/A"})]}),(()=>{if("split"===(h.paymentMethod||"").toString().toLowerCase().trim()){const e=h.splitPaymentDetails||{},t=Number(e.cashAmount)||0,n=Number(e.onlineAmount)||0,r=Number(e.dueAmount)||0;return(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-2",children:"Split Payment Breakdown"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[(0,Pe.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2.5 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-green-700 font-medium mb-1",children:"Cash"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-bold text-green-900 break-words",children:Zy(t)})]}),(0,Pe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2.5 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Online"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-bold text-blue-900 break-words",children:Zy(n)})]}),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2.5 sm:p-3",children:[(0,Pe.jsx)("p",{className:"text-xs text-red-700 font-medium mb-1",children:"Due"}),(0,Pe.jsx)("p",{className:"text-base sm:text-lg font-bold text-red-900 break-words",children:Zy(r)})]})]})]})}return null})(),(0,Pe.jsxs)("div",{className:"sm:col-span-2",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Total Amount"}),(0,Pe.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 break-words",children:Zy(h.totalAmount||h.total)})]})]}),h.items&&h.items.length>0&&(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Order Items"}),(0,Pe.jsx)("div",{className:"hidden sm:block overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gray-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Product"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Quantity"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Price"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.items.map((e,t)=>{const{rate:n,total:r,qty:s,unit:i}=Ky(e);return(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.name||"N/A"}),(0,Pe.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-700 text-right",children:[s," ",i]}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 text-right",children:Zy(n)}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 text-right",children:Zy(r)})]},t)})})]})}),(0,Pe.jsx)("div",{className:"sm:hidden space-y-3",children:h.items.map((e,t)=>{const{rate:n,total:r,qty:s,unit:i}=Ky(e);return(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Pe.jsx)("p",{className:"text-sm font-semibold text-gray-900 flex-1 pr-2",children:e.name||"N/A"}),(0,Pe.jsx)("p",{className:"text-sm font-bold text-gray-900",children:Zy(r)})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Pe.jsxs)("span",{children:[s," ",i]}),(0,Pe.jsxs)("span",{children:["@ ",Zy(n)]})]})]},t)})})]})]})})]})})]})},ob=e=>{const t=Number(e||0)||0;return"\u20b9".concat(t.toFixed(2))},lb=e=>{try{const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-IN",n).format(t)}catch(t){return e}},cb=e=>{try{const t=new Date(e);return Number.isNaN(t.getTime())?e:new Intl.DateTimeFormat("en-IN",{day:"2-digit",month:"short",year:"numeric"}).format(t)}catch(t){return e}},db=()=>{const{state:e,dispatch:r}=(0,i.nm)(),s=(0,Se.$u)(),[o,l]=(0,t.useState)("search"),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("mobile"),[m,f]=(0,t.useState)([]),[p,g]=(0,t.useState)(null),[x,y]=(0,t.useState)(168),[b,w]=(0,t.useState)(!1),[v,N]=(0,t.useState)([]),[S,A]=(0,t.useState)(""),[_,C]=(0,t.useState)(!1),[I,E]=(0,t.useState)(!1),[T,j]=(0,t.useState)(null),[k,D]=(0,t.useState)([]),[P,R]=(0,t.useState)({from:"",to:"",customerMobile:"",orderId:""}),[O,L]=(0,t.useState)(1);(0,t.useEffect)(()=>{(async()=>{try{var e;const t=await(0,Se.AT)("/auth/seller/profile");t.success&&null!==(e=t.data)&&void 0!==e&&e.seller&&y(t.data.seller.refundWindowHours||168)}catch(t){console.error("Error fetching seller settings:",t)}})()},[]);(0,t.useEffect)(()=>{if(c.trim()){const t=setTimeout(()=>{(async()=>{if(!c.trim())return f([]),void w(!1);w(!0);try{const t=e.orders||[];if(!t||0===t.length)return f([]),w(!1),void(window.showToast&&window.showToast("No orders found. Please sync your data first.","info"));const n=Date.now(),r=60*x*60*1e3,i=c.toLowerCase().trim();let o=t.filter(e=>{var t;const a=e.sellerId||(null===(t=e.sellerId)||void 0===t?void 0:t.toString()),o=null===s||void 0===s?void 0:s.toString();if(a&&o&&a!==o)return console.warn("Order ".concat(e.id||e._id," belongs to different seller, skipping")),!1;const l=new Date(e.createdAt||e.date||0).getTime();if(isNaN(l))return!1;if(n-l>r)return!1;if("mobile"===u){const t=It(e.customerMobile||""),n=It(c);return!(!n||n.length<3)&&(t.includes(n)||n.includes(t))}if("orderId"===u){const t=e.id||e._id;if(!t)return!1;const n=t.toString().toLowerCase();return n.includes(i)||n.endsWith(i)}return"product"===u&&!(!e.items||!Array.isArray(e.items)||0===e.items.length)&&e.items.some(e=>{const t=(e.name||"").toLowerCase(),n=(e.barcode||"").toLowerCase();return t.includes(i)||n.includes(i)})});const l=(await Promise.all(o.map(async e=>{try{const t=e._id||e.id;if(!t)return null;const n=(e.sellerId||"").toString(),r=(s||"").toString();if(n&&r&&n!==r)return console.warn("Skipping order ".concat(t," - sellerId mismatch")),null;const i=await(0,Se.AT)("/refunds/order/".concat(t));let o={};if(i.success&&i.data){const e=i.data;e.success&&e.data&&e.data.refundedQuantities||e.data&&e.data.refundedQuantities?o=e.data.refundedQuantities:e.refundedQuantities&&(o=e.refundedQuantities)}let l="NOT_REFUNDED",c=0,d=0;return e.items&&Array.isArray(e.items)&&e.items.length>0&&e.items.forEach(e=>{var t;const n=((null===(t=e.productId)||void 0===t?void 0:t._id)||e.productId||e._id||"").toString(),r=Number(e.quantity||0);let s=0;if(n&&o&&(s=o[n]||0,0===s&&Object.keys(o).length>0)){const e=Object.keys(o).find(e=>e.toString()===n||e.toString().includes(n)||n.includes(e.toString()));e&&(s=o[e]||0)}d+=r,c+=s}),l=0===c?"NOT_REFUNDED":c>=d?"REFUNDED":"PARTIALLY_REFUNDED",(0,a.A)((0,a.A)({},e),{},{refundStatus:l,refundedQuantities:o})}catch(t){console.error("Error fetching refunds for order ".concat(e._id||e.id,":"),t);const n=(e.sellerId||"").toString(),r=(s||"").toString();return n&&r&&n!==r?null:(0,a.A)((0,a.A)({},e),{},{refundStatus:"NOT_REFUNDED",refundedQuantities:{}})}}))).filter(e=>null!==e);f(l)}catch(t){console.error("Error searching orders:",t),f([]),window.showToast&&window.showToast("Error searching orders: "+(t.message||"Unknown error"),"error")}finally{w(!1)}})()},500);return()=>clearTimeout(t)}f([]),w(!1)},[c,u,x]),(0,t.useEffect)(()=>{p&&M()},[p]);const M=async()=>{if(p)try{const n=(p.sellerId||"").toString(),r=(s||"").toString();if(n&&r&&n!==r)return console.error("Cannot load refund items - order does not belong to current seller"),window.showToast&&window.showToast("Access denied: Order does not belong to your account","error"),void g(null);const i=p._id||p.id,a=null===i||void 0===i?void 0:i.toString(),o=(await(0,Ae.getAllItems)(Ae.STORES.refunds).catch(()=>[])).filter(e=>(e.orderId||"").toString()===a),l={};if(o.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{const t=(e.productId||"").toString();t&&(l[t]=(l[t]||0)+(e.qty||0))})}),pt.Ay.isOnline())try{const t=await(0,Se.AT)("/refunds/order/".concat(i));if(t.success){var e;const n=t.data,r=n.success?(null===(e=n.data)||void 0===e?void 0:e.refundedQuantities)||{}:n.refundedQuantities||{};Object.assign(l,r)}}catch(t){console.error("Error loading refunds from backend (using IndexedDB):",t)}const c=(p.items||[]).map(e=>{const t=(e.productId||e._id||"").toString(),n=Number(e.quantity||0),r=l[t]||0,s=n-r;let i=0;if(void 0!==e.unitSellingPrice&&null!==e.unitSellingPrice)i=Number(e.unitSellingPrice||0);else if(n>0){i=Number(e.sellingPrice||e.price||e.totalSellingPrice||0)/n}else i=Number(e.sellingPrice||e.price||0);return{productId:t,name:e.name||"Unknown",orderedQty:n,refundedQty:r,availableQty:s,rate:i,refundQty:0,unit:e.unit||"pcs"}});N(c)}catch(t){console.error("Error loading refund items:",t),window.showToast&&window.showToast("Error loading order items","error")}},F=(0,t.useMemo)(()=>v.reduce((e,t)=>e+t.refundQty*t.rate,0),[v]),B=(e,t)=>{const n=Math.max(0,Number(t)||0);N(t=>t.map(t=>{if(t.productId===e){const e=Math.min(n,t.availableQty);return(0,a.A)((0,a.A)({},t),{},{refundQty:e})}return t}))},U=async()=>{try{const i=await(0,Ae.getAllItems)(Ae.STORES.refunds).catch(()=>[]);let a=i.filter(e=>{const t=(e.sellerId||"").toString(),n=(s||"").toString();return!t||!n||t===n}).filter(t=>{if(P.from){if(new Date(t.createdAt||t.refundDate)<new Date(P.from))return!1}if(P.to){const e=new Date(t.createdAt||t.refundDate),n=new Date(P.to);if(n.setHours(23,59,59,999),e>n)return!1}if(P.orderId){const e=(t.orderId||"").toString(),n=P.orderId.trim();if(!e.includes(n))return!1}if(P.customerMobile){const n=e.orders.find(e=>(e._id||e.id||"").toString()===(t.orderId||"").toString());if(!n)return!1;{const e=It(n.customerMobile||""),t=It(P.customerMobile);if(!e.includes(t)&&!t.includes(e))return!1}}return!0});const o=a.map(t=>{var n;return{id:t.id||t._id,refundId:t.id||t._id,orderId:t.orderId,customerId:t.customerId,totalRefundAmount:t.totalRefundAmount,refundDate:t.createdAt||t.refundDate,refundedBy:t.refundedByUser||"-",itemsCount:(null===(n=t.items)||void 0===n?void 0:n.length)||0,reason:t.reason||"",customerName:(()=>{const n=e.orders.find(e=>(e._id||e.id||"").toString()===(t.orderId||"").toString());return(null===n||void 0===n?void 0:n.customerName)||"-"})(),customerMobile:(()=>{const n=e.orders.find(e=>(e._id||e.id||"").toString()===(t.orderId||"").toString());return(null===n||void 0===n?void 0:n.customerMobile)||"-"})()}});if(pt.Ay.isOnline())try{const e=new URLSearchParams;P.from&&e.append("from",P.from),P.to&&e.append("to",P.to),P.customerMobile&&e.append("customerMobile",P.customerMobile),P.orderId&&e.append("orderId",P.orderId);const r=await(0,Se.AT)("/refunds?".concat(e.toString()));if(r.success){var t;const e=r.data,s=e.success?(null===(t=e.data)||void 0===t?void 0:t.data)||e.data||[]:e.data||[];if(Array.isArray(s)&&s.length>0){const{syncToIndexedDB:e}=await Promise.resolve().then(n.bind(n,3885));return await e(Ae.STORES.refunds,s),void D(s)}}}catch(r){console.error("Error loading refunds from backend (using IndexedDB):",r)}D(o)}catch(r){console.error("Error loading refunds:",r),D([])}};(0,t.useEffect)(()=>{"list"===o&&U()},[o,P]);const z=Math.ceil(k.length/10),q=10*(O-1),H=k.slice(q,q+10),V=e=>{const t={REFUNDED:"bg-green-100 text-green-800 border-green-200",PARTIALLY_REFUNDED:"bg-yellow-100 text-yellow-800 border-yellow-200",NOT_REFUNDED:"bg-gray-100 text-gray-800 border-gray-200"};return t[e]||t.NOT_REFUNDED};return(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6 px-2 sm:px-0 pb-6",children:[(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] rounded-2xl p-4 sm:p-6 shadow-lg",children:(0,Pe.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsx)("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-xl",children:(0,Pe.jsx)(ze,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white flex items-center gap-2",children:"Refunds"}),(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-blue-100 mt-1",children:"Process refunds and manage return requests"})]})]})})}),(0,Pe.jsxs)("div",{className:"flex border-b-2 border-gray-200 bg-white rounded-t-xl overflow-hidden shadow-sm",children:[(0,Pe.jsxs)("button",{onClick:()=>l("search"),className:"flex-1 px-3 sm:px-4 py-3 font-semibold text-xs sm:text-sm transition-all relative ".concat("search"===o?"text-[#2f3c7e] bg-blue-50":"text-gray-600 hover:text-[#2f3c7e] hover:bg-gray-50"),children:["search"===o&&(0,Pe.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-[#2f3c7e] to-[#18224f]"}),(0,Pe.jsx)("span",{className:"hidden sm:inline",children:"Search Orders"}),(0,Pe.jsx)("span",{className:"sm:hidden",children:"Search"})]}),(0,Pe.jsxs)("button",{onClick:()=>l("list"),className:"flex-1 px-3 sm:px-4 py-3 font-semibold text-xs sm:text-sm transition-all relative ".concat("list"===o?"text-[#2f3c7e] bg-blue-50":"text-gray-600 hover:text-[#2f3c7e] hover:bg-gray-50"),children:["list"===o&&(0,Pe.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-[#2f3c7e] to-[#18224f]"}),"All Refunds"]})]}),"search"===o&&(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 sm:p-6 border border-gray-100",children:[(0,Pe.jsxs)("h2",{className:"text-base sm:text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,Pe.jsx)(Yu,{className:"h-5 w-5 text-indigo-600"}),"Search Orders for Refund"]}),(0,Pe.jsxs)("div",{className:"space-y-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"Search By"}),(0,Pe.jsx)("div",{className:"flex flex-wrap gap-2",children:[{value:"mobile",label:"Mobile",fullLabel:"Customer Mobile"},{value:"orderId",label:"Order ID",fullLabel:"Order ID"},{value:"product",label:"Product",fullLabel:"Product Name/Barcode"}].map(e=>(0,Pe.jsxs)("button",{onClick:()=>{h(e.value),d(""),f([])},className:"px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all ".concat(u===e.value?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,Pe.jsx)("span",{className:"hidden sm:inline",children:e.fullLabel}),(0,Pe.jsx)("span",{className:"sm:hidden",children:e.label})]},e.value))})]}),(0,Pe.jsxs)("div",{className:"relative",children:[(0,Pe.jsx)(Yu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-500"}),(0,Pe.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Enter ".concat("mobile"===u?"mobile number":"orderId"===u?"order ID":"product name or barcode"),className:"w-full pl-10 pr-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all text-sm sm:text-base text-gray-900 placeholder:text-gray-400"})]}),(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-slate-50 border-2 border-blue-200 rounded-xl p-3 sm:p-4",children:(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm text-slate-700 flex items-start gap-2",children:[(0,Pe.jsx)(St,{className:"h-4 w-4 text-slate-600 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("span",{children:["Only orders within ",(0,Pe.jsxs)("span",{className:"font-bold",children:[x," hours"]})," (",Math.round(x/24)," days) are eligible for refund"]})]})})]})]}),b&&(0,Pe.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6 sm:p-8 border border-gray-100",children:(0,Pe.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-2"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Searching orders..."})]})})}),!b&&m.length>0&&(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 sm:p-6 border border-gray-100",children:[(0,Pe.jsxs)("h3",{className:"text-base sm:text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,Pe.jsx)(od,{className:"h-5 w-5 text-[#2f3c7e]"}),"Eligible Orders ",(0,Pe.jsxs)("span",{className:"text-indigo-600",children:["(",m.length,")"]})]}),(0,Pe.jsx)("div",{className:"space-y-3",children:m.map(e=>{const t="NOT_REFUNDED"!==e.refundStatus,n=(null===p||void 0===p?void 0:p.id)===e.id||(null===p||void 0===p?void 0:p._id)===e._id;return(0,Pe.jsx)("div",{className:"border-2 rounded-xl p-3 sm:p-4 cursor-pointer transition-all ".concat(t?"border-red-400 bg-gradient-to-r from-red-50 to-red-100/50":n?"border-blue-500 bg-gradient-to-r from-blue-50 to-slate-50 shadow-md":"border-gray-200 hover:border-blue-300 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50/30"),onClick:()=>g(e),children:(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,Pe.jsxs)("p",{className:"font-bold text-sm sm:text-base ".concat(t?"text-red-900":"text-gray-900"),children:["Order: ",(0,Pe.jsx)("span",{className:"font-mono",children:(e.id||e._id||"").toString().slice(-8)})]}),t?(0,Pe.jsx)("span",{className:"px-2 py-1 rounded-lg text-xs font-bold border-2 border-red-600 bg-red-100 text-red-800",children:"REFUNDED"}):(0,Pe.jsx)("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold border ".concat(V(e.refundStatus)),children:(r=e.refundStatus,{REFUNDED:"REFUNDED",PARTIALLY_REFUNDED:"PARTIALLY REFUNDED",NOT_REFUNDED:"NOT REFUNDED"}[r]||"NOT REFUNDED")})]}),(0,Pe.jsxs)("p",{className:"text-xs sm:text-sm ".concat(t?"text-red-700":"text-gray-600"," mb-1"),children:[(0,Pe.jsx)("span",{className:"font-medium",children:e.customerName||"Walk-in Customer"}),e.customerMobile&&(0,Pe.jsxs)("span",{className:"text-gray-500",children:[" \u2022 ",e.customerMobile]})]}),(0,Pe.jsx)("p",{className:"text-xs ".concat(t?"text-red-600":"text-gray-500"),children:lb(e.createdAt||e.date)})]}),(0,Pe.jsxs)("div",{className:"text-left sm:text-right flex-shrink-0",children:[(0,Pe.jsx)("p",{className:"text-lg sm:text-xl font-bold ".concat(t?"text-red-900":"text-gray-900"),children:ob(e.totalAmount||e.total)}),(0,Pe.jsx)("p",{className:"text-xs uppercase font-medium ".concat(t?"text-red-600":"text-[#2f3c7e]"),children:e.paymentMethod||"cash"})]})]})},e.id||e._id);var r})})]}),!b&&c.trim()&&0===m.length&&(0,Pe.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6 sm:p-8 border border-gray-100",children:(0,Pe.jsxs)("div",{className:"text-center py-8",children:[(0,Pe.jsx)(St,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,Pe.jsx)("p",{className:"text-gray-700 font-medium",children:"No eligible orders found"}),(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 mt-2",children:"Try a different search term or check the refund window settings."})]})}),p&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",onClick:e=>{e.target===e.currentTarget&&(g(null),N([]),A(""))},children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-4 sm:px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center gap-2",children:[(0,Pe.jsx)(ze,{className:"h-5 w-5 sm:h-6 sm:w-6"}),"Refund Items"]}),(0,Pe.jsx)("button",{onClick:()=>{g(null),N([]),A("")},className:"p-2 text-white/90 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),(0,Pe.jsxs)("div",{className:"overflow-y-auto flex-1 p-4 sm:p-6",children:[(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl p-4 mb-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 text-sm",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:"Order ID"}),(0,Pe.jsx)("p",{className:"font-bold text-gray-900 font-mono",children:(p.id||p._id||"").toString().slice(-8)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:"Customer"}),(0,Pe.jsx)("p",{className:"font-bold text-gray-900",children:p.customerName||"Walk-in Customer"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:"Date"}),(0,Pe.jsx)("p",{className:"font-semibold text-gray-900 text-xs sm:text-sm",children:lb(p.createdAt||p.date)})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:"Total Amount"}),(0,Pe.jsx)("p",{className:"font-bold text-indigo-600 text-lg",children:ob(p.totalAmount||p.total)})]})]})}),v.length>0&&(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsx)("div",{className:"hidden sm:block overflow-x-auto -mx-4 sm:mx-0",children:(0,Pe.jsx)("div",{className:"inline-block min-w-full align-middle",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gradient-to-r from-blue-50 to-slate-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Product"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wide text-slate-700",children:"Ordered"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wide text-slate-700",children:"Refunded"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wide text-slate-700",children:"Available"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-bold uppercase tracking-wide text-slate-700",children:"Rate"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wide text-slate-700",children:"Refund Qty"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-bold uppercase tracking-wide text-slate-700",children:"Total"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map((e,t)=>(0,Pe.jsxs)("tr",{className:e.refundedQty>0?"bg-yellow-50/50":"hover:bg-gray-50",children:[(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.name}),(0,Pe.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:[e.orderedQty," ",(0,Pe.jsx)("span",{className:"text-gray-500 text-xs",children:e.unit})]}),(0,Pe.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:[e.refundedQty," ",(0,Pe.jsx)("span",{className:"text-gray-500 text-xs",children:e.unit})]}),(0,Pe.jsxs)("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 text-center",children:[e.availableQty," ",(0,Pe.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:e.unit})]}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 text-right",children:ob(e.rate)}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-center",children:(0,Pe.jsx)("input",{type:"number",min:"0",max:e.availableQty,value:e.refundQty||"",onChange:t=>B(e.productId,t.target.value),disabled:0===e.availableQty,className:"w-20 px-2 py-1.5 text-sm border-2 rounded-lg text-center font-semibold ".concat(0===e.availableQty?"bg-gray-100 cursor-not-allowed text-gray-400":"border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 text-gray-900")})}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 text-right",children:ob(e.refundQty*e.rate)})]},e.productId))})]})})}),(0,Pe.jsx)("div",{className:"sm:hidden space-y-3",children:v.map(e=>(0,Pe.jsxs)("div",{className:"bg-white border-2 rounded-xl p-4 ".concat(e.refundedQty>0?"border-yellow-300 bg-yellow-50/30":"border-gray-200"),children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Pe.jsx)("h4",{className:"font-bold text-gray-900 text-sm flex-1",children:e.name}),(0,Pe.jsxs)("span",{className:"text-xs font-semibold text-[#2f3c7e] bg-blue-50 px-2 py-1 rounded",children:[ob(e.rate),"/",e.unit]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3 text-xs",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-500",children:"Ordered"}),(0,Pe.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.orderedQty," ",e.unit]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-500",children:"Refunded"}),(0,Pe.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.refundedQty," ",e.unit]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-500",children:"Available"}),(0,Pe.jsxs)("p",{className:"font-bold text-indigo-600",children:[e.availableQty," ",e.unit]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-500",children:"Line Total"}),(0,Pe.jsx)("p",{className:"font-bold text-indigo-600",children:ob(e.refundQty*e.rate)})]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Refund Quantity"}),(0,Pe.jsx)("input",{type:"number",min:"0",max:e.availableQty,value:e.refundQty||"",onChange:t=>B(e.productId,t.target.value),disabled:0===e.availableQty,className:"w-full px-3 py-2 text-sm border-2 rounded-lg text-center font-semibold ".concat(0===e.availableQty?"bg-gray-100 cursor-not-allowed text-gray-400":"border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 text-gray-900")})]})]},e.productId))}),(0,Pe.jsxs)("div",{className:"mt-4 sm:mt-6 space-y-4",children:[(0,Pe.jsx)("div",{className:"flex justify-end",children:(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] rounded-xl p-4 sm:p-6 shadow-lg w-full sm:w-auto",children:[(0,Pe.jsx)("p",{className:"text-xs sm:text-sm text-blue-100 mb-1 font-medium",children:"Total Refund Amount"}),(0,Pe.jsx)("p",{className:"text-2xl sm:text-3xl font-bold text-white",children:ob(F)})]})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:["Refund Reason ",(0,Pe.jsx)("span",{className:"text-gray-400 font-normal",children:"(Optional)"})]}),(0,Pe.jsx)("textarea",{value:S,onChange:e=>A(e.target.value),placeholder:"Enter reason for refund...",rows:3,className:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all text-sm sm:text-base text-gray-900 placeholder:text-gray-400"})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-2",children:[(0,Pe.jsx)("button",{onClick:()=>{g(null),N([]),A("")},className:"w-full sm:w-auto px-6 py-3 rounded-xl font-bold transition-all bg-gray-200 text-gray-700 hover:bg-gray-300 active:scale-95",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:async()=>{if(!p)return;const t=(p.sellerId||"").toString(),i=(s||"").toString();if(t&&i&&t!==i)return console.error("Cannot process refund - order does not belong to current seller"),window.showToast&&window.showToast("Access denied: Order does not belong to your account","error"),void g(null);const l=v.filter(e=>e.refundQty>0);if(0!==l.length){for(const e of l)if(e.refundQty>e.availableQty)return void(window.showToast&&window.showToast("Cannot refund ".concat(e.refundQty," units of ").concat(e.name,". Only ").concat(e.availableQty," available."),"error"));C(!0);try{var c,u,h,m;const t=p._id||p.id,i=null===t||void 0===t?void 0:t.toString(),x=l.map(e=>({productId:e.productId,name:e.name,qty:e.refundQty,rate:e.rate,lineTotal:e.refundQty*e.rate,unit:e.unit||"pcs"})),y=x.reduce((e,t)=>e+t.lineTotal,0),b="refund_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),w={id:b,orderId:i,customerId:p.customerId||null,sellerId:s||(null===(c=e.currentUser)||void 0===c?void 0:c.sellerId)||(null===(u=e.currentUser)||void 0===u?void 0:u._id),items:x,totalRefundAmount:y,reason:S.trim()||"",refundedByUser:(null===(h=e.currentUser)||void 0===h?void 0:h.name)||(null===(m=e.currentUser)||void 0===m?void 0:m.email)||"System",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),stockAdjusted:!0,isSynced:!1};await(0,Ae.addItem)(Ae.STORES.refunds,w),console.log("\u2705 Refund saved to IndexedDB:",b);for(const s of l){const t=e.products.find(e=>(e._id||e.id||"").toString()===(s.productId||"").toString());if(t){const e=(0,a.A)((0,a.A)({},t),{},{stock:(t.stock||t.quantity||0)+s.refundQty,quantity:(t.stock||t.quantity||0)+s.refundQty,isSynced:!1,isUpdate:!0,updatedAt:(new Date).toISOString()}),{updateItem:i}=await Promise.resolve().then(n.bind(n,1337));await i(Ae.STORES.products,e),r&&r({type:"UPDATE_PRODUCT",payload:e})}}j({refundId:b,orderId:i,totalRefundAmount:y,itemsCount:x.length,createdAt:w.createdAt}),E(!0),g(null),N([]),A(""),d(""),f([]),"list"===o&&U(),window.showToast&&window.showToast("Refund processed successfully","success"),setTimeout(async()=>{if(pt.Ay.isOnline())try{const{getStoreFunctions:e}=await Promise.resolve().then(n.bind(n,8050));pt.Ay.syncAll(e).then(()=>{console.log("\u2705 Refund synced to MongoDB (background)")}).catch(e=>{console.error("\u26a0\ufe0f Error syncing refund to MongoDB (will retry later):",e)})}catch(e){console.error("\u26a0\ufe0f Error initiating refund sync:",e)}else console.log("\u26a0\ufe0f Offline - refund will sync when connection is restored")},100)}catch(x){console.error("Error processing refund:",x),window.showToast&&window.showToast("Error processing refund: "+(x.message||"Unknown error"),"error")}finally{C(!1)}}else window.showToast&&window.showToast("Please select items to refund","warning")},disabled:_||0===F,className:"w-full sm:w-auto px-6 py-3 rounded-xl font-bold transition-all ".concat(_||0===F?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow-lg hover:shadow-xl active:scale-95"),children:_?(0,Pe.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Process Refund"})]})]})]}),0===v.length&&(0,Pe.jsxs)("div",{className:"text-center py-12",children:[(0,Pe.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-3"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Loading refund items..."})]})]})]})})]}),"list"===o&&(0,Pe.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 sm:p-6 border border-gray-100",children:[(0,Pe.jsxs)("h2",{className:"text-base sm:text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,Pe.jsx)(Bc,{className:"h-5 w-5 text-indigo-600"}),"Filters"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"From Date"}),(0,Pe.jsx)("input",{type:"date",value:P.from,onChange:e=>R(t=>(0,a.A)((0,a.A)({},t),{},{from:e.target.value})),className:"w-full px-3 sm:px-4 py-2 text-sm rounded-lg border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"To Date"}),(0,Pe.jsx)("input",{type:"date",value:P.to,onChange:e=>R(t=>(0,a.A)((0,a.A)({},t),{},{to:e.target.value})),className:"w-full px-3 sm:px-4 py-2 text-sm rounded-lg border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"Customer Mobile"}),(0,Pe.jsx)("input",{type:"text",value:P.customerMobile,onChange:e=>R(t=>(0,a.A)((0,a.A)({},t),{},{customerMobile:e.target.value})),placeholder:"Search by mobile",className:"w-full px-3 sm:px-4 py-2 text-sm rounded-lg border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"Order ID"}),(0,Pe.jsx)("input",{type:"text",value:P.orderId,onChange:e=>R(t=>(0,a.A)((0,a.A)({},t),{},{orderId:e.target.value})),placeholder:"Search by order ID",className:"w-full px-3 sm:px-4 py-2 text-sm rounded-lg border-2 border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500"})]})]})]}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden",children:[(0,Pe.jsx)("div",{className:"p-4 sm:p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-slate-50",children:(0,Pe.jsxs)("h2",{className:"text-base sm:text-lg font-bold text-gray-900 flex items-center gap-2",children:[(0,Pe.jsx)(ze,{className:"h-5 w-5 text-[#2f3c7e]"}),"All Refunds ",(0,Pe.jsxs)("span",{className:"text-indigo-600",children:["(",k.length,")"]})]})}),(0,Pe.jsx)("div",{className:"hidden sm:block overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gradient-to-r from-blue-50 to-slate-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Refund ID"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Order ID"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Customer"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-right text-xs font-bold uppercase tracking-wide text-slate-700",children:"Amount"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wide text-slate-700",children:"Items"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Date"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wide text-slate-700",children:"Refunded By"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:H.length>0?H.map(e=>(0,Pe.jsxs)("tr",{className:"hover:bg-indigo-50/30 transition-colors",children:[(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 font-mono",children:(e.refundId||e.id||"").toString().slice(-8)}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 font-mono",children:(e.orderId||"").toString().slice(-8)}),(0,Pe.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-700",children:[(0,Pe.jsx)("div",{className:"font-medium",children:e.customerName||"-"}),e.customerMobile&&(0,Pe.jsx)("div",{className:"text-xs text-gray-500",children:e.customerMobile})]}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 text-right",children:ob(e.totalRefundAmount)}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:(0,Pe.jsx)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-lg font-semibold text-xs",children:e.itemsCount||0})}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:lb(e.refundDate||e.createdAt)}),(0,Pe.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.refundedBy||"-"})]},e.id)):(0,Pe.jsx)("tr",{children:(0,Pe.jsxs)("td",{colSpan:"7",className:"px-4 py-12 text-center",children:[(0,Pe.jsx)(ze,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600 font-medium",children:"No refunds found"})]})})})]})}),(0,Pe.jsx)("div",{className:"sm:hidden divide-y divide-gray-200",children:H.length>0?H.map(e=>(0,Pe.jsxs)("div",{className:"p-4 hover:bg-gray-50",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,Pe.jsx)("span",{className:"text-xs font-mono font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:(e.refundId||e.id||"").toString().slice(-8)}),(0,Pe.jsxs)("span",{className:"text-xs text-gray-500",children:["Order: ",(e.orderId||"").toString().slice(-8)]})]}),(0,Pe.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.customerName||"-"}),e.customerMobile&&(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:e.customerMobile})]}),(0,Pe.jsxs)("div",{className:"text-right",children:[(0,Pe.jsx)("p",{className:"text-lg font-bold text-blue-600",children:ob(e.totalRefundAmount)}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500",children:[e.itemsCount||0," items"]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mt-2 pt-2 border-t border-gray-100",children:[(0,Pe.jsx)("span",{children:cb(e.refundDate||e.createdAt)}),(0,Pe.jsx)("span",{className:"font-medium",children:e.refundedBy||"-"})]})]},e.id)):(0,Pe.jsxs)("div",{className:"px-4 py-12 text-center",children:[(0,Pe.jsx)(ze,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600 font-medium",children:"No refunds found"})]})}),z>1&&(0,Pe.jsx)("div",{className:"px-4 sm:px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,Pe.jsxs)("div",{className:"text-xs sm:text-sm text-gray-700 font-medium",children:["Showing ",(0,Pe.jsx)("span",{className:"font-bold text-indigo-600",children:q+1})," to"," ",(0,Pe.jsx)("span",{className:"font-bold text-indigo-600",children:Math.min(q+10,k.length)})," of"," ",(0,Pe.jsx)("span",{className:"font-bold text-indigo-600",children:k.length})," refunds"]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Pe.jsx)("button",{onClick:()=>L(1),disabled:1===O,className:"p-2 text-gray-500 bg-white border-2 border-gray-300 rounded-lg hover:bg-indigo-50 hover:border-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,Pe.jsx)(Ht,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>L(O-1),disabled:1===O,className:"p-2 text-gray-500 bg-white border-2 border-gray-300 rounded-lg hover:bg-indigo-50 hover:border-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,Pe.jsx)(Vt,{className:"h-4 w-4"})}),(0,Pe.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(z,5)},(e,t)=>{let n;return n=z<=5||O<=3?t+1:O>=z-2?z-4+t:O-2+t,(0,Pe.jsx)("button",{onClick:()=>L(n),className:"px-3 py-2 text-xs sm:text-sm font-bold rounded-lg transition-all ".concat(O===n?"bg-gradient-to-r from-indigo-600 to-blue-600 text-white shadow-md":"bg-white text-gray-700 border-2 border-gray-300 hover:bg-indigo-50 hover:border-indigo-300"),children:n},n)})}),(0,Pe.jsx)("button",{onClick:()=>L(O+1),disabled:O===z,className:"p-2 text-gray-500 bg-white border-2 border-gray-300 rounded-lg hover:bg-indigo-50 hover:border-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,Pe.jsx)(Wt,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>L(z),disabled:O===z,className:"p-2 text-gray-500 bg-white border-2 border-gray-300 rounded-lg hover:bg-indigo-50 hover:border-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,Pe.jsx)(Gt,{className:"h-4 w-4"})})]})]})})]})]}),I&&T&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-center",children:[(0,Pe.jsx)(od,{className:"h-16 w-16 text-white mx-auto mb-3"}),(0,Pe.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-white",children:"Refund Processed Successfully"})]}),(0,Pe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[(0,Pe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Pe.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"Refund ID"}),(0,Pe.jsx)("span",{className:"text-sm font-mono font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg",children:(T.refundId||"").toString().slice(-8)})]}),(0,Pe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Pe.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"Total Amount"}),(0,Pe.jsx)("span",{className:"text-xl font-bold text-indigo-600",children:ob(T.totalRefundAmount)})]}),(0,Pe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Pe.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"Items Refunded"}),(0,Pe.jsx)("span",{className:"text-sm font-bold text-gray-900 bg-indigo-100 text-indigo-800 px-3 py-1 rounded-lg",children:T.itemsCount||0})]})]}),(0,Pe.jsx)("button",{onClick:()=>{E(!1),j(null)},className:"w-full px-6 py-3 bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white rounded-xl font-bold hover:shadow-lg active:scale-95 transition-all",children:"Close"})]})]})})]})},ub=Ee("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),hb=Ee("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),mb=Ee("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),fb=Ee("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),pb=Ee("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),gb=()=>{var e;const{state:n}=(0,i.nm)(),r="staff"===(null===(e=n.currentUser)||void 0===e?void 0:e.userType),[s,o]=(0,t.useState)(r?"permissions":"list"),[l,c]=(0,t.useState)([]),[d,u]=(0,t.useState)([]),[h,m]=(0,t.useState)([]),[f,p]=(0,t.useState)({}),[g,x]=(0,t.useState)(!1),[y,b]=(0,t.useState)(!0),[w,v]=(0,t.useState)(""),[N,S]=(0,t.useState)("all"),[A,_]=(0,t.useState)(!1),[C,I]=(0,t.useState)({permissions:{}}),[E,T]=(0,t.useState)(null),[j,k]=(0,t.useState)(null),[D,P]=(0,t.useState)(!1),[R,O]=(0,t.useState)(!1),[L,M]=(0,t.useState)(!1),[F,B]=(0,t.useState)(!1),[U,z]=(0,t.useState)(null),[q,H]=(0,t.useState)(null),[V,W]=(0,t.useState)(!1),[G,Y]=(0,t.useState)(""),[X,Q]=(0,t.useState)(!1),K={dashboard:{title:"Dashboard",permissions:{dashboard:"Dashboard Access"}},products:{title:"Products",permissions:{products:"Product Management"}},inventory:{title:"Inventory",permissions:{inventory:"Inventory Management"}},billing:{title:"Billing & Sales",permissions:{billing:"Billing & Sales",salesOrderHistory:"Sales Order History"}},refunds:{title:"Refunds",permissions:{refunds:"Refund Management"}},financial:{title:"Financial",permissions:{financial:"Financial Reports"}},reports:{title:"Reports",permissions:{reports:"Reports Access"}},settings:{title:"Settings",permissions:{settings:"Settings Access"}}};(0,t.useEffect)(()=>{J(),Z()},[]);const Z=()=>{pt.R0&&"function"===typeof pt.R0.registerStoreForSync&&pt.R0.registerStoreForSync(Ae.STORES.staff,{loadFromAPI:async()=>{var e;const t=await(0,Se.AT)("/staff").catch(e=>({success:!1,error:e.message}));return t.success&&(null===(e=t.data)||void 0===e?void 0:e.data)||[]},saveToIndexedDB:Ae.saveStaffMembers,getSyncMetadata:()=>({collection:"staff"})})},J=async()=>{b(!0);try{var e;const s=null===(e=n.currentUser)||void 0===e?void 0:e.sellerId;let i=[];if(s)try{i=await(0,Ae.getStaffMembers)(s),i&&i.length>0&&(c([...i]),console.log("\u26a1 Loaded staff from IndexedDB cache:",i.length,"members"))}catch(t){console.warn("Failed to load staff from IndexedDB:",t)}const[a,o]=await Promise.all([(0,Se.AT)("/staff").catch(e=>({success:!1,error:e.message})),(0,Se.AT)("/staff/invites").catch(e=>({success:!1,error:e.message}))]);if(a.success&&a.data&&Array.isArray(a.data.data)){const e=a.data.data;if(c([...e]),s&&e.length>0)try{await(0,Ae.saveStaffMembers)(e),console.log("\ud83d\udcbe Saved staff data to IndexedDB:",e.length,"members")}catch(r){console.warn("Failed to save staff data to IndexedDB:",r)}console.log("\ud83d\udd0d Staff data loaded from API:",{total:e.length,active:e.filter(e=>e.isActive).length,inactive:e.filter(e=>!e.isActive).length,resigned:e.filter(e=>!e.isActive&&e.resignedAt).length,samples:e.slice(0,3).map(e=>({name:e.name,isActive:e.isActive,resignedAt:e.resignedAt,accessRevoked:e.accessRevoked}))})}else 0===i.length&&c([]);if(o.success&&o.data&&Array.isArray(o.data.data)){const e=o.data.data.filter(e=>{const t=e.revokedAt||e.isRevoked||e.revoked||e.deletedAt,n="accepted"===e.status&&(!e.usedBy||!e.usedAt);return!t&&!n&&("pending"===e.status||!e.status)});u(e)}else u([])}catch(s){console.error("Error loading staff data:",s),c([]),u([]),window.showToast&&window.showToast("Failed to load staff data","error")}finally{b(!1)}},$=(e,t)=>{I(n=>(0,a.A)((0,a.A)({},n),{},{permissions:(0,a.A)((0,a.A)({},n.permissions),{},{[e]:t})}))},ee=async()=>{try{const e=await(0,Se.AT)("/staff/invite",{method:"POST",body:{permissions:C.permissions}});e.success?(z(e.data.inviteUrl),H(e.data.token),_(!1),I({permissions:{}}),window.showToast&&window.showToast("Invite link created successfully!","success"),J()):window.showToast&&window.showToast("Failed to create invite","error")}catch(e){console.error("Error creating invite:",e),window.showToast&&window.showToast("Failed to create invite","error")}},te=async(e,t)=>{try{var r;const s=null===(r=n.currentUser)||void 0===r?void 0:r.sellerId;if(s)try{const n={isActive:!t,isSuspend:t,permissions:t?{}:void 0,updatedAt:(new Date).toISOString()};await(0,Ae.updateStaffMember)(e,n),console.log("\ud83d\udcbe Updated staff suspension status in IndexedDB"),c(n=>n.map(n=>n._id===e?(0,a.A)((0,a.A)({},n),{},{isActive:!t,isSuspend:t,permissions:t?{}:n.permissions,updatedAt:(new Date).toISOString()}):n))}catch(i){console.warn("Failed to update staff suspension in IndexedDB:",i)}const l=await(0,Se.AT)("/staff/".concat(e,"/suspend"),{method:"PUT",body:{isSuspend:t}});if(l.success)console.log("\u2601\ufe0f Staff suspension status synced to MongoDB"),l.data&&c(t=>t.map(t=>t._id===e?l.data:t)),window.showToast&&window.showToast("Staff member ".concat(t?"suspended":"unsuspended"," successfully!"),"success"),J();else if(window.showToast&&window.showToast("Failed to update staff suspension status","error"),s)try{await(0,Ae.updateStaffMember)(e,{isActive:t,isSuspend:!t,updatedAt:(new Date).toISOString()})}catch(o){console.warn("Failed to revert IndexedDB changes:",o)}}catch(l){var s;console.error("Error updating staff suspension status:",l),window.showToast&&window.showToast("Failed to update staff suspension status","error");if(null===(s=n.currentUser)||void 0===s?void 0:s.sellerId)try{await(0,Ae.updateStaffMember)(e,{isActive:t,isSuspend:!t,updatedAt:(new Date).toISOString()})}catch(o){console.warn("Failed to revert IndexedDB changes:",o)}}},ne=async e=>{if(window.confirm("Are you sure you want to revoke this invite? This action cannot be undone."))try{(await(0,Se.AT)("/staff/invites/".concat(e),{method:"DELETE"})).success?(window.showToast&&window.showToast("Invite revoked successfully","success"),J()):window.showToast&&window.showToast("Failed to revoke invite","error")}catch(t){console.error("Error revoking invite:",t),window.showToast&&window.showToast("Failed to revoke invite","error")}},re=(0,t.useMemo)(()=>Array.isArray(l)?l.filter(e=>{if(!e||"object"!==typeof e)return!1;const t=e.name||"",n=e.email||"",r=e.isActive,s=t.toLowerCase().includes(w.toLowerCase())||n.toLowerCase().includes(w.toLowerCase()),i="all"===N||"active"===N&&r&&!e.isSuspend||"resigned"===N&&!r&&!e.isSuspend||"suspended"===N&&e.isSuspend;return s&&i}):[],[l,w,N]),se=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ie=e=>{if(!e||"object"!==typeof e)return 0;try{return Object.values(e).filter(Boolean).length}catch(t){return console.warn("Error counting permissions:",t),0}};try{var ae;return(0,Pe.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white relative overflow-hidden",children:[(0,Pe.jsx)("div",{className:"absolute inset-0 bg-black/10"}),(0,Pe.jsx)("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Pe.jsx)("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-xl shadow-lg",children:(0,Pe.jsx)(Le,{className:"h-8 w-8"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Staff Management"}),(0,Pe.jsx)("p",{className:"text-indigo-100 mt-1",children:"Manage your team members and their access permissions"})]})]}),!r&&(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsxs)("button",{onClick:()=>{console.log("\ud83c\udfaf Invite History button clicked"),B(!0),console.log("\ud83d\udd04 Modal state set to true"),(async()=>{console.log("\ud83d\udd0d loadInviteHistory called"),x(!0);try{console.log("\ud83d\udce1 Making API request to /staff/invite-history");const e=await(0,Se.AT)("/staff/invite-history");if(console.log("\ud83d\udccb Invite History API Response:",e),e.success&&e.data){const t=e.data.data||[],n=e.data.stats||{};console.log("\u2705 Invite history loaded:",t.length,"invites"),console.log("\ud83d\udcca Stats:",n),console.log("\ud83d\udccb First invite sample:",t[0]),m(t);let r=n||{};if(!r.revoked||0===r.revoked){const e=t.filter(e=>{let t=e.status||"pending";return!!(e.revokedAt||e.isRevoked||e.revoked||e.deletedAt)||!("accepted"!==t||e.usedBy&&e.usedAt)}).length;r=(0,a.A)((0,a.A)({},r),{},{revoked:e})}p(r),console.log("\ud83d\udd04 State updated - inviteHistory length:",t.length),console.log("\ud83d\udcca Invite stats:",r)}else console.log("\u274c No invite history data received"),m([]),p({})}catch(e){console.error("\u274c Error loading invite history:",e),m([]),p({}),window.showToast&&window.showToast("Failed to load invite history","error")}finally{x(!1)}})()},className:"bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700 transition-colors duration-200 flex items-center space-x-2 shadow-lg",children:[(0,Pe.jsx)(Ue,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Invite History"})]}),(0,Pe.jsxs)("button",{onClick:()=>{I({permissions:{}}),_(!0)},className:"bg-white text-indigo-600 px-6 py-3 rounded-xl font-semibold hover:bg-indigo-50 transition-colors duration-200 flex items-center space-x-2 shadow-lg",children:[(0,Pe.jsx)(ub,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Invite Staff"})]})]})]})})]}),(0,Pe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,Pe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,Pe.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:"Total Staff"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:l.length}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["All time | Raw: ",l.length]})]}),(0,Pe.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg",children:(0,Pe.jsx)(Le,{className:"h-5 w-5 text-blue-600"})})]})}),(0,Pe.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:"Active Staff"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>e.isActive).length}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Working | Raw: ",l.filter(e=>e.isActive).length]})]}),(0,Pe.jsx)("div",{className:"bg-green-100 p-2 rounded-lg",children:(0,Pe.jsx)(He,{className:"h-5 w-5 text-green-600"})})]})}),(0,Pe.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:"Inactive Staff"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-red-600",children:l.filter(e=>!e.isActive&&!e.isSuspend).length}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Inactive | Raw: ",l.filter(e=>!e.isActive&&!e.isSuspend).length]})]}),(0,Pe.jsx)("div",{className:"bg-red-100 p-2 rounded-lg",children:(0,Pe.jsx)(St,{className:"h-5 w-5 text-red-600"})})]})}),(0,Pe.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:"Suspended Staff"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:l.filter(e=>e.isSuspend).length}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Suspended | Raw: ",l.filter(e=>e.isSuspend).length]})]}),(0,Pe.jsx)("div",{className:"bg-orange-100 p-2 rounded-lg",children:(0,Pe.jsx)(hb,{className:"h-5 w-5 text-orange-600"})})]})}),(0,Pe.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:"Pending"}),(0,Pe.jsx)("p",{className:"text-2xl font-bold text-amber-600",children:d.length})]}),(0,Pe.jsx)("div",{className:"bg-amber-100 p-2 rounded-lg",children:(0,Pe.jsx)(mb,{className:"h-5 w-5 text-amber-600"})})]})})]}),(0,Pe.jsx)("div",{className:"sticky top-4 z-10 bg-white/90 backdrop-blur-md rounded-2xl border border-white/20 shadow-xl ring-1 ring-gray-200/50 p-6 mb-8 transition-all duration-200 ease-in-out",children:(0,Pe.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-start lg:items-center justify-between",children:[(0,Pe.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,Pe.jsxs)("div",{className:"relative flex-1",children:[(0,Pe.jsx)("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:(0,Pe.jsx)(Yu,{className:"h-5 w-6 text-slate-400"})}),(0,Pe.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:w,onChange:e=>v(e.target.value),className:"block w-full min-w-[400px] pl-12 pr-4 py-3 bg-slate-50/50 border border-slate-200 rounded-xl text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500 focus:bg-white transition-all duration-200 ease-in-out text-sm font-medium"})]})}),(0,Pe.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Pe.jsxs)("div",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white/80 p-1 shadow-sm",children:[(0,Pe.jsxs)("button",{onClick:()=>S("all"),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat("all"===N?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:["All (",l.length,")"]}),(0,Pe.jsxs)("button",{onClick:()=>S("active"),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat("active"===N?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:["Active (",l.filter(e=>e.isActive).length,")"]}),(0,Pe.jsxs)("button",{onClick:()=>S("resigned"),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat("resigned"===N?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:["Resigned (",l.filter(e=>!e.isActive&&!e.isSuspend).length,")"]}),(0,Pe.jsxs)("button",{onClick:()=>S("suspended"),className:"px-3 py-1.5 text-xs font-medium rounded-full transition sm:text-sm ".concat("suspended"===N?"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white shadow":"text-slate-600 hover:text-[#2f3c7e] hover:bg-white"),children:["Suspended (",l.filter(e=>e.isSuspend).length,")"]})]}),w&&(0,Pe.jsxs)("button",{onClick:()=>v(""),className:"px-3 py-1.5 rounded-full font-medium text-xs bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors border border-slate-200 hover:border-slate-300 flex items-center gap-1.5",children:[(0,Pe.jsx)(Ye,{className:"h-3 w-3"}),(0,Pe.jsx)("span",{children:"Clear search"})]})]})]})}),d.length>0&&(0,Pe.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-white/20 shadow-lg ring-1 ring-gray-200/50 p-6 mb-8",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 p-3 rounded-xl shadow-lg",children:(0,Pe.jsx)(mb,{className:"h-6 w-6 text-white"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-xl font-bold text-slate-900 bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent",children:"Pending Invites"}),(0,Pe.jsx)("p",{className:"text-slate-600 text-sm mt-1",children:"Invitations sent but not yet accepted"})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-3 text-sm text-amber-600 bg-gradient-to-r from-amber-50 to-orange-50 px-4 py-2 rounded-xl border border-amber-100",children:[(0,Pe.jsx)("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),(0,Pe.jsxs)("span",{className:"font-semibold",children:[d.length," pending invites"]})]})]}),(0,Pe.jsx)("div",{className:"space-y-3",children:d.map(e=>(0,Pe.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Pe.jsx)(mb,{className:"h-5 w-5 text-blue-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("p",{className:"font-medium text-gray-900",children:["Invite sent to: ",e.email||"Unknown"]}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600",children:["Sent on ",new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsxs)("div",{className:"text-right",children:[(0,Pe.jsxs)("p",{className:"text-sm text-gray-600",children:["Expires: ",new Date(e.expiryTime).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500",children:(()=>{const t=new Date,n=new Date(e.expiryTime),r=Math.max(0,Math.floor((n-t)/36e5));return r<24?"".concat(r,"h left"):"".concat(Math.floor(r/24),"d left")})()})]}),(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full",children:"Pending"}),!r&&(0,Pe.jsx)("button",{onClick:()=>ne(e._id),className:"text-red-600 hover:text-red-800 p-1 rounded-full hover:bg-red-50 transition-colors",title:"Revoke invite",children:(0,Pe.jsx)(Ye,{className:"h-4 w-4"})})]})]})]},e._id))})]}),y?(0,Pe.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading staff members..."})]})}):0===re.length?(0,Pe.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:(0,Pe.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,Pe.jsx)("div",{className:"bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-6",children:(0,Pe.jsx)(Le,{className:"h-10 w-10 text-gray-400"})}),(0,Pe.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:0===l.length?"No staff members yet":"No matching staff found"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:0===l.length?"Get started by inviting your first team member to help manage your business.":"Try adjusting your search or filter criteria."}),0===l.length&&!r&&(0,Pe.jsxs)("button",{onClick:()=>{I({permissions:{}}),_(!0)},className:"bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center space-x-2 mx-auto",children:[(0,Pe.jsx)(ub,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Invite First Staff Member"})]})]})}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("div",{className:"card hidden lg:block",children:(0,Pe.jsx)("div",{className:"overflow-x-auto",children:(0,Pe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Pe.jsx)("thead",{className:"bg-gray-50",children:(0,Pe.jsxs)("tr",{children:[(0,Pe.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Staff Member"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Status"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Permissions"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Last Active"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Joined"}),(0,Pe.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold uppercase tracking-wide text-gray-700",children:"Actions"})]})}),(0,Pe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:re.length>0?re.map(e=>(0,Pe.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,Pe.jsxs)("div",{className:"flex items-center",children:[(0,Pe.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,Pe.jsxs)("div",{className:"w-10 h-10 rounded-lg overflow-hidden ring-2 ring-gray-200",children:[e.profilePicture?(0,Pe.jsx)("img",{src:e.profilePicture,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none";const t=e.target.parentElement.querySelector(".fallback-avatar");t&&(t.style.display="flex")}}):(0,Pe.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:(0,Pe.jsx)(He,{className:"h-5 w-5 text-white"})}),(0,Pe.jsx)("div",{className:"fallback-avatar w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",style:{display:"none"},children:(0,Pe.jsx)(He,{className:"h-5 w-5 text-white"})})]}),(0,Pe.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ".concat(e.isActive?"bg-emerald-500":"bg-red-500")})]}),(0,Pe.jsxs)("div",{className:"ml-3 min-w-0 flex-1",children:[(0,Pe.jsx)("div",{className:"text-sm font-semibold text-gray-900 truncate",children:e.name||"Unknown"}),(0,Pe.jsx)("div",{className:"text-sm text-gray-600 truncate",children:e.email||"No email"})]})]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:(0,Pe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isSuspend?"bg-orange-50 text-orange-700 border border-orange-200":e.isActive?"bg-emerald-50 text-emerald-700 border border-emerald-200":"bg-red-50 text-red-700 border border-red-200"),children:[(0,Pe.jsx)("div",{className:"w-1.5 h-1.5 rounded-full mr-1.5 ".concat(e.isSuspend?"bg-orange-500":e.isActive?"bg-emerald-500":"bg-red-500")}),e.isSuspend?"Suspended":e.isActive?"Active":"Inactive"]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:(0,Pe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200",children:[(0,Pe.jsx)(Te,{className:"h-3 w-3 mr-1"}),ie(e.permissions)]})}),(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700 text-center",children:se(e.lastActivityDate)}),(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700 text-center",children:se(e.createdAt)}),(0,Pe.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,Pe.jsx)("button",{onClick:()=>{T(e),O(!0)},className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all duration-200",title:"View Details",children:(0,Pe.jsx)(zt,{className:"h-4 w-4"})}),!r&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("button",{onClick:()=>{T(e),I({permissions:(0,a.A)({},e.permissions)}),P(!0)},className:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-md transition-all duration-200",title:"Edit Permissions",children:(0,Pe.jsx)(Te,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>te(e._id,!e.isSuspend),className:"p-1.5 rounded-md transition-all duration-200 ".concat(e.isSuspend?"text-green-600 hover:text-green-800 hover:bg-green-50":"text-orange-600 hover:text-orange-800 hover:bg-orange-50"),title:e.isSuspend?"Unsuspend Staff":"Suspend Staff",children:(0,Pe.jsx)(hb,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>{T(e),M(!0)},className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-all duration-200",title:"Remove Staff",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})]})})]},e._id)):(0,Pe.jsx)("tr",{children:(0,Pe.jsx)("td",{colSpan:"6",className:"px-4 py-8 text-center text-sm text-gray-500",children:"No staff members found"})})})]})})}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:hidden gap-4",children:re.map(e=>(0,Pe.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md transition-shadow",children:(0,Pe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Pe.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,Pe.jsxs)("div",{className:"w-12 h-12 rounded-lg overflow-hidden ring-2 ring-gray-200",children:[e.profilePicture?(0,Pe.jsx)("img",{src:e.profilePicture,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none";const t=e.target.parentElement.querySelector(".fallback-avatar");t&&(t.style.display="flex")}}):(0,Pe.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:(0,Pe.jsx)(He,{className:"h-5 w-5 text-white"})}),(0,Pe.jsx)("div",{className:"fallback-avatar w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",style:{display:"none"},children:(0,Pe.jsx)(He,{className:"h-5 w-5 text-white"})})]}),(0,Pe.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ".concat(e.isActive?"bg-emerald-500":"bg-red-500")})]}),(0,Pe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Pe.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,Pe.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:e.name||"Unknown"}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.email||"No email"})]}),(0,Pe.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Pe.jsx)("button",{onClick:()=>{T(e),O(!0)},className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all duration-200",title:"View Details",children:(0,Pe.jsx)(zt,{className:"h-4 w-4"})}),!r&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("button",{onClick:()=>{T(e),I({permissions:(0,a.A)({},e.permissions)}),P(!0)},className:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-md transition-all duration-200",title:"Edit Permissions",children:(0,Pe.jsx)(Te,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>te(e._id,!e.isSuspend),className:"p-1.5 rounded-md transition-all duration-200 ".concat(e.isSuspend?"text-green-600 hover:text-green-800 hover:bg-green-50":"text-orange-600 hover:text-orange-800 hover:bg-orange-50"),title:e.isSuspend?"Unsuspend Staff":"Suspend Staff",children:(0,Pe.jsx)(hb,{className:"h-4 w-4"})}),(0,Pe.jsx)("button",{onClick:()=>{T(e),M(!0)},className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-all duration-200",title:"Remove Staff",children:(0,Pe.jsx)(qt,{className:"h-4 w-4"})})]})]})]}),(0,Pe.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Pe.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(e.isSuspend?"bg-orange-50 text-orange-700 border border-orange-200":e.isActive?"bg-emerald-50 text-emerald-700 border border-emerald-200":"bg-red-50 text-red-700 border border-red-200"),children:[(0,Pe.jsx)("div",{className:"w-1.5 h-1.5 rounded-full mr-1 ".concat(e.isSuspend?"bg-orange-500":e.isActive?"bg-emerald-500":"bg-red-500")}),e.isSuspend?"Suspended":e.isActive?"Active":"Inactive"]}),(0,Pe.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200",children:[(0,Pe.jsx)(Te,{className:"h-3 w-3 mr-1"}),ie(e.permissions)]})]}),(0,Pe.jsxs)("div",{className:"text-xs text-gray-500",children:["Joined ",se(e.createdAt)]})]})]})]})},e._id))})]}),r&&(0,Pe.jsx)("div",{className:"space-y-8",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,Pe.jsx)("div",{className:"bg-indigo-100 rounded-full p-2",children:(0,Pe.jsx)(Te,{className:"h-6 w-6 text-indigo-600"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Your Permissions"}),(0,Pe.jsx)("p",{className:"text-gray-600 text-sm",children:"Current access permissions granted by your seller"})]})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(null===(ae=n.currentUser)||void 0===ae?void 0:ae.permissions)&&Object.entries(n.currentUser.permissions).map(e=>{let[t,n]=e;return(0,Pe.jsx)("div",{className:"p-4 rounded-lg border ".concat(n?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(n?"bg-green-500":"bg-gray-400")}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-medium text-sm text-gray-900 capitalize",children:t.replace(/_/g," ").replace(/([A-Z])/g," $1").trim()}),(0,Pe.jsx)("p",{className:"text-xs ".concat(n?"text-green-600":"text-gray-500"),children:n?"Enabled":"Disabled"})]})]})},t)})}),(0,Pe.jsx)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,Pe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Permission Changes"}),(0,Pe.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"If you need additional permissions or believe your current permissions are incorrect, please contact your seller directly."})]})]})}),(0,Pe.jsx)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:(0,Pe.jsx)("div",{className:"bg-red-50 rounded-lg p-6 border border-red-200",children:(0,Pe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Pe.jsx)(St,{className:"h-6 w-6 text-red-600 mt-0.5"}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h4",{className:"text-lg font-semibold text-red-900 mb-2",children:"Resign from Position"}),(0,Pe.jsx)("p",{className:"text-red-700 text-sm mb-4",children:"If you wish to leave your current position, you can resign. This action cannot be undone and will permanently deactivate your account and revoke all access."}),(0,Pe.jsxs)("button",{onClick:()=>W(!0),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[(0,Pe.jsx)(St,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{children:"Resign"})]})]})]})})})]})}),A&&!r&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Pe.jsx)(ub,{className:"h-6 w-6"}),(0,Pe.jsx)("span",{children:"Invite New Staff Member"})]}),(0,Pe.jsx)("button",{onClick:()=>_(!1),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-6 w-6"})})]}),(0,Pe.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"space-y-6",children:[(0,Pe.jsx)("div",{className:"text-center",children:(0,Pe.jsx)("p",{className:"text-gray-600",children:"Configure permissions for the new staff member and generate an invite link."})}),(0,Pe.jsx)("div",{className:"space-y-4",children:Object.entries(K).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,Pe.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[(0,Pe.jsx)(Te,{className:"h-4 w-4 text-indigo-600"}),(0,Pe.jsx)("span",{children:n.title})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(n.permissions).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)("input",{type:"checkbox",checked:C.permissions[t]||!1,onChange:e=>$(t,e.target.checked),className:"w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-700",children:n})]},t)})})]},t)})})]})}),(0,Pe.jsxs)("div",{className:"border-t border-gray-200 p-6 flex justify-end space-x-3",children:[(0,Pe.jsx)("button",{onClick:()=>_(!1),className:"px-6 py-3 rounded-xl font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:ee,className:"px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-[#2f3c7e] to-[#18224f] hover:from-[#243168] hover:to-[#111c44] transition-colors",children:"Generate Invite Link"})]})]})}),R&&E&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Pe.jsx)(zt,{className:"h-6 w-6"}),(0,Pe.jsx)("span",{children:E.name})]}),(0,Pe.jsx)("button",{onClick:()=>O(!1),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-6 w-6"})})]}),(0,Pe.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:(0,Pe.jsxs)("div",{className:"space-y-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Pe.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200",children:E.profilePicture?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("img",{src:E.profilePicture,alt:E.name,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.target.parentElement.querySelector(".fallback-avatar").style.display="flex"}}),(0,Pe.jsx)("div",{className:"fallback-avatar w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",style:{display:"none"},children:(0,Pe.jsx)(He,{className:"h-8 w-8 text-white"})})]}):(0,Pe.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:(0,Pe.jsx)(He,{className:"h-8 w-8 text-white"})})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:E.name}),(0,Pe.jsx)("p",{className:"text-gray-600",children:E.email}),(0,Pe.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-medium mt-2 ".concat(E.isSuspend?"bg-orange-100 text-orange-800":E.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:E.isSuspend?"Suspended":E.isActive?"Active":"Inactive"})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{className:"space-y-4",children:[(0,Pe.jsxs)("h5",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[(0,Pe.jsx)(mb,{className:"h-4 w-4"}),(0,Pe.jsx)("span",{children:"Contact Information"})]}),(0,Pe.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Pe.jsxs)("p",{children:[(0,Pe.jsx)("strong",{children:"Email:"})," ",E.email]}),(0,Pe.jsxs)("p",{children:[(0,Pe.jsx)("strong",{children:"Joined:"})," ",se(E.createdAt)]}),(0,Pe.jsxs)("p",{children:[(0,Pe.jsx)("strong",{children:"Last Active:"})," ",se(E.lastActivityDate)]})]})]}),(0,Pe.jsxs)("div",{className:"space-y-4",children:[(0,Pe.jsxs)("h5",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[(0,Pe.jsx)(Te,{className:"h-4 w-4"}),(0,Pe.jsxs)("span",{children:["Permissions (",ie(E.permissions),")"]})]}),(0,Pe.jsxs)("div",{className:"space-y-2",children:[Object.entries(K).map(e=>{let[t,n]=e;const r=Object.keys(n.permissions).filter(e=>E.permissions[e]);return 0===r.length?null:(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h6",{className:"text-sm font-medium text-gray-700 mb-1",children:n.title}),(0,Pe.jsx)("div",{className:"flex flex-wrap gap-1",children:r.map(e=>(0,Pe.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full",children:n.permissions[e]},e))})]},t)}),0===ie(E.permissions)&&(0,Pe.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No permissions assigned"})]})]})]}),E.invitedBy&&(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,Pe.jsx)("h5",{className:"font-semibold text-gray-900 mb-2",children:"Invitation Details"}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600",children:["Invited by ",(0,Pe.jsx)("strong",{children:E.invitedBy.name})," (",E.invitedBy.email,")"]}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Token: ",E.inviteToken]})]})]})}),(0,Pe.jsx)("div",{className:"border-t border-gray-200 p-6 flex justify-end",children:(0,Pe.jsx)("button",{onClick:()=>O(!1),className:"px-6 py-3 rounded-xl font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors",children:"Close"})})]})}),D&&E&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Pe.jsx)(Te,{className:"h-6 w-6"}),(0,Pe.jsxs)("span",{children:["Edit Permissions - ",E.name]})]}),(0,Pe.jsx)("button",{onClick:()=>P(!1),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-6 w-6"})})]}),(0,Pe.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:(0,Pe.jsx)("div",{className:"space-y-6",children:Object.entries(K).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,Pe.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[(0,Pe.jsx)(Te,{className:"h-4 w-4 text-indigo-600"}),(0,Pe.jsx)("span",{children:n.title})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(n.permissions).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)("input",{type:"checkbox",checked:C.permissions[t]||!1,onChange:e=>$(t,e.target.checked),className:"w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-700",children:n})]},t)})})]},t)})})}),(0,Pe.jsxs)("div",{className:"border-t border-gray-200 p-6 flex justify-end space-x-3",children:[(0,Pe.jsx)("button",{onClick:()=>{P(!1),I({permissions:{}}),T(null)},className:"px-6 py-3 rounded-xl font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,Pe.jsx)("button",{onClick:()=>(async(e,t)=>{try{if((await(0,Se.AT)("/staff/".concat(e,"/permissions"),{method:"PUT",body:{permissions:t}})).success){P(!1),T(null),I({permissions:{}});try{var r;(null===(r=n.currentUser)||void 0===r?void 0:r.sellerId)&&(await(0,Ae.updateStaffMember)(e,{permissions:t,updatedAt:(new Date).toISOString()}),console.log("\ud83d\udcbe Updated staff permissions in IndexedDB"))}catch(s){console.warn("Failed to update staff permissions in IndexedDB:",s)}window.showToast&&window.showToast("Permissions updated successfully!","success"),J()}else window.showToast&&window.showToast("Failed to update permissions","error")}catch(i){console.error("Error updating permissions:",i),window.showToast&&window.showToast("Failed to update permissions","error")}})(E._id,C.permissions),className:"px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-[#2f3c7e] to-[#18224f] hover:from-[#243168] hover:to-[#111c44] transition-colors",children:"Update Permissions"})]})]})}),U&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[(0,Pe.jsx)(od,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Invite Link Created!"})]}),(0,Pe.jsx)("button",{onClick:()=>z(null),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"p-6",children:[(0,Pe.jsx)("p",{className:"text-gray-600 mb-4",children:"Share this link with your new staff member:"}),(0,Pe.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:(0,Pe.jsx)("p",{className:"text-sm font-mono break-all text-gray-800",children:U})}),(0,Pe.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(U),window.showToast&&window.showToast("Link copied to clipboard!","success")},className:"w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2",children:[(0,Pe.jsx)(fb,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Copy Link"})]})]})]})}),F&&!r&&(0,Pe.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,Pe.jsxs)("div",{className:"bg-gradient-to-r from-[#2f3c7e] to-[#18224f] px-6 py-4 flex items-center justify-between",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[(0,Pe.jsx)(Ue,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"All Invites History"})]}),(0,Pe.jsx)("button",{onClick:()=>B(!1),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[(0,Pe.jsx)("div",{className:"mb-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Complete Invite History"}),(0,Pe.jsx)("p",{className:"text-gray-600 text-sm",children:"All invitation links: pending, expired, and accepted"})]}),(0,Pe.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,Pe.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),(0,Pe.jsxs)("span",{children:["Pending (",f.pending||0,")"]})]}),(0,Pe.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,Pe.jsxs)("span",{children:["Accepted (",f.accepted||0,")"]})]}),(0,Pe.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),(0,Pe.jsxs)("span",{children:["Expired (",f.expired||0,")"]})]}),(0,Pe.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),(0,Pe.jsxs)("span",{children:["Revoked (",f.revoked||0,")"]})]})]})]})}),g?(0,Pe.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),(0,Pe.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading invite history..."})]}):0===h.length?(0,Pe.jsxs)("div",{className:"text-center py-12",children:[(0,Pe.jsx)("div",{className:"bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,Pe.jsx)(mb,{className:"h-8 w-8 text-gray-400"})}),(0,Pe.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Invites Yet"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Start inviting team members to see their history here."})]}):(0,Pe.jsx)("div",{className:"space-y-4",children:Array.isArray(h)&&h.map((e,t)=>{try{if(!e||"object"!==typeof e)return console.error("\u274c Invalid invite object at index",t,":",e),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 text-red-500"}),(0,Pe.jsx)("span",{className:"text-red-700 font-medium",children:"Error loading invite"})]}),(0,Pe.jsx)("p",{className:"text-red-600 text-sm mt-1",children:"Invalid invite data received."})]},"error-".concat(t));let n,r,s,i=e.status||"pending";switch(e.revokedAt||e.isRevoked||e.revoked||e.deletedAt?i="revoked":"accepted"!==i||e.usedBy&&e.usedAt||(i="revoked"),i){case"accepted":n="green",r="Accepted",s=(0,Pe.jsx)(od,{className:"h-4 w-4"});break;case"expired":n="red",r="Expired",s=(0,Pe.jsx)(eb,{className:"h-4 w-4"});break;case"revoked":n="red",r="Revoked",s=(0,Pe.jsx)(hb,{className:"h-4 w-4"});break;default:n="yellow",r="Pending",s=(0,Pe.jsx)(rt,{className:"h-4 w-4"})}return(0,Pe.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow",children:[(0,Pe.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,Pe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Pe.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat("green"===n?"bg-green-100":"red"===n?"bg-red-100":"bg-yellow-100"),children:"green"===n?(0,Pe.jsx)(od,{className:"h-6 w-6 text-green-600"}):"red"===n?(0,Pe.jsx)(Ye,{className:"h-6 w-6 text-red-600"}):(0,Pe.jsx)(rt,{className:"h-6 w-6 text-yellow-600"})}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Pe.jsx)("h4",{className:"font-semibold text-gray-900",children:(null===e||void 0===e?void 0:e.email)||"Unknown Email"}),(0,Pe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("green"===n?"bg-green-100 text-green-800":"red"===n?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:[s,(0,Pe.jsx)("span",{className:"ml-1",children:r})]})]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("span",{className:"font-medium",children:"Sent:"})," ",null!==e&&void 0!==e&&e.createdAt?new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown"]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("span",{className:"font-medium",children:"Expires:"})," ",(0,Pe.jsx)("span",{className:"expired"===i||"revoked"===i?"text-red-600":"pending"===i?"text-yellow-600":"text-gray-600",children:null!==e&&void 0!==e&&e.expiryTime?new Date(e.expiryTime).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown"})]}),"accepted"===i&&e.usedBy&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("span",{className:"font-medium",children:"Accepted by:"})," ",(0,Pe.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[e.usedBy.profilePicture&&(0,Pe.jsx)("img",{src:e.usedBy.profilePicture,alt:e.usedBy.name,className:"w-6 h-6 rounded-full"}),(0,Pe.jsx)("span",{children:e.usedBy.name}),(0,Pe.jsxs)("span",{className:"text-gray-500",children:["(",e.usedBy.email,")"]})]})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("span",{className:"font-medium",children:"Accepted on:"})," ",e.usedAt?new Date(e.usedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown"]})]}),"revoked"===i&&(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("span",{className:"font-medium text-gray-600",children:"Revoked:"})," ",(0,Pe.jsx)("span",{className:"text-gray-500",children:"This invite was revoked by the seller"})]})]})]})]}),(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:["pending"===i&&(0,Pe.jsx)("button",{onClick:()=>{const t="".concat(window.location.origin,"/staff/signup?token=").concat(e.token);navigator.clipboard.writeText(t),window.showToast&&window.showToast("Invite link copied!","success")},className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Copy invite link",children:(0,Pe.jsx)(fb,{className:"h-4 w-4"})}),"pending"===i&&(0,Pe.jsx)("button",{onClick:()=>{const t="".concat(window.location.origin,"/staff/signup?token=").concat(e.token);window.open(t,"_blank")},className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Open invite link",children:(0,Pe.jsx)(pb,{className:"h-4 w-4"})}),"pending"===i&&(0,Pe.jsx)("button",{onClick:()=>ne(e._id),className:"p-2 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-lg transition-colors",title:"Revoke invite",children:(0,Pe.jsx)(hb,{className:"h-4 w-4"})})]})]}),(0,Pe.jsx)("div",{className:"border-t pt-4",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)(Te,{className:"h-4 w-4 text-gray-400"}),(0,Pe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Permissions:"})]}),(0,Pe.jsx)("div",{className:"flex flex-wrap gap-1",children:null!==e&&void 0!==e&&e.permissions&&"object"===typeof e.permissions?Object.entries(e.permissions).filter(e=>{let[t,n]=e;return!0===n}).map(e=>{let[t,n]=e;return(0,Pe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.replace(/_/g," ")},t)}):null})]})})]},e._id)}catch(n){return console.error("\u274c Error rendering invite at index",t,":",n,e),(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 text-red-500"}),(0,Pe.jsx)("span",{className:"text-red-700 font-medium",children:"Error loading invite"})]}),(0,Pe.jsx)("p",{className:"text-red-600 text-sm mt-1",children:"There was a problem displaying this invitation."})]},"error-".concat(t))}})})]})]})})]})]})}catch(oe){return console.error("Error rendering Staff component:",oe),(0,Pe.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,Pe.jsx)(St,{className:"h-8 w-8 text-red-600"})}),(0,Pe.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Component Error"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an error loading the staff page."}),(0,Pe.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:"Reload Page"})]})})}};function xb(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(qb){}new Map;const yb=r.startTransition;ot.flushSync,r.useId;function bb(e){let{basename:n,children:r,future:s,window:i}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:i,v5Compat:!0})&&(o={}),p(function(e,t){let{pathname:n,search:r,hash:s}=e.location;return h("",{pathname:n,search:r,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:m(t)},null,o)));let l=a.current,[c,d]=t.useState({action:l.action,location:l.location}),{v7_startTransition:u}=s||{},f=t.useCallback(e=>{u&&yb?yb(()=>d(e)):d(e)},[d,u]);return t.useLayoutEffect(()=>l.listen(f),[l,f]),t.useEffect(()=>fe(s),[s]),t.createElement(ye,{basename:n,children:r,location:c.location,navigationType:c.action,navigator:l,future:s})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var wb,vb;function Nb(e){let n=t.useRef(xb(e)),r=t.useRef(!1),s=J(),i=t.useMemo(()=>function(e,t){let n=xb(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(s.search,r.current?null:n.current),[s.search]),a=ee(),o=t.useCallback((e,t)=>{const n=xb("function"===typeof e?e(i):e);r.current=!0,a("?"+n,t)},[a,i]);return[i,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(wb||(wb={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(vb||(vb={}));const Sb=Ee("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),Ab=()=>{var e,n;const[r]=Nb(),s=ee(),[i,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(null),[m,f]=(0,t.useState)(null),[p,g]=(0,t.useState)(!1),x=r.get("token");(0,t.useEffect)(()=>{if(!x)return f("Invalid invite link. No token provided."),void a(!1);y()},[x]);const y=async()=>{l(!0);try{const t=await(0,Se.AT)("/staff/invite/".concat(x));var e;if(t.success)h(t.data.data);else f((null===(e=t.data)||void 0===e?void 0:e.message)||t.message||"Invalid or expired invite token")}catch(m){console.error("Error validating invite token:",m),f("Failed to validate invite token. Please try again.")}finally{l(!1),a(!1)}};return i?(0,Pe.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 flex items-center justify-center p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[(0,Pe.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,Pe.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Validating Invite"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Please wait while we validate your invite token..."})]})}):m?(0,Pe.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 flex items-center justify-center p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[(0,Pe.jsx)(St,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,Pe.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Invalid Invite"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:m}),(0,Pe.jsx)("button",{onClick:()=>s("/"),className:"w-full px-6 py-3 bg-gradient-to-r from-[#2f3c7e] to-[#18224f] text-white rounded-xl font-bold hover:shadow-lg transition-all",children:"Go to Homepage"})]})}):p?(0,Pe.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50 flex items-center justify-center p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[(0,Pe.jsx)(od,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,Pe.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Welcome to the Team!"}),(0,Pe.jsx)("p",{className:"text-gray-600 mb-6",children:"Your staff account has been created successfully. You can now access the system with your assigned permissions."}),(0,Pe.jsx)("p",{className:"text-sm text-gray-500",children:"Redirecting you to login..."})]})}):(0,Pe.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 flex items-center justify-center p-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-lg w-full",children:[(0,Pe.jsxs)("div",{className:"text-center mb-8",children:[(0,Pe.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:(0,Pe.jsx)(He,{className:"h-8 w-8 text-indigo-600"})}),(0,Pe.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Join the Team"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Complete your staff account setup"})]}),(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-slate-50 rounded-xl p-4 mb-6 border border-blue-200",children:(0,Pe.jsxs)("div",{className:"flex items-start gap-3",children:[(0,Pe.jsx)(mb,{className:"h-5 w-5 text-indigo-600 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:"Staff Invitation"}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["You've been invited to join ",(0,Pe.jsx)("strong",{children:(null===u||void 0===u||null===(e=u.seller)||void 0===e?void 0:e.shopName)||(null===u||void 0===u||null===(n=u.seller)||void 0===n?void 0:n.name)||"the team"})]}),(0,Pe.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[(0,Pe.jsxs)("span",{className:"flex items-center gap-1",children:[(0,Pe.jsx)(Te,{className:"h-3 w-3"}),(b=null===u||void 0===u?void 0:u.permissions,Object.values(b||{}).filter(Boolean).length)," permissions"]}),(0,Pe.jsxs)("span",{className:"flex items-center gap-1",children:[(0,Pe.jsx)(rt,{className:"h-3 w-3"}),"Expires ",(e=>{try{return new Date(e).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Invalid Date"}})(null===u||void 0===u?void 0:u.expiryTime)]})]})]})]})}),(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[(0,Pe.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,Pe.jsx)(Te,{className:"h-4 w-4 text-indigo-600"}),"Your Permissions"]}),(0,Pe.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries((null===u||void 0===u?void 0:u.permissions)||{}).filter(e=>{let[,t]=e;return t}).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)(od,{className:"h-3 w-3 text-green-600 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"text-gray-700 capitalize",children:t.replace(/_/g," ")})]},t)})})]}),(0,Pe.jsx)("button",{onClick:async()=>{if(u){d(!0);try{const t=(await(0,ve.df)(Ne.auth,Ne.hJ)).user;if(!t)return void f("Failed to authenticate with Google. Please try again.");const n={token:u.token,email:t.email,uid:t.uid,displayName:t.displayName,photoURL:t.photoURL};console.log("Sending signup request with data:",n);const r=await(0,Se.AT)("/staff/signup",{method:"POST",body:n});var e;if(console.log("Signup response:",r),r.success)g(!0),setTimeout(()=>{s("/login")},3e3);else f((null===(e=r.data)||void 0===e?void 0:e.message)||r.message||"Failed to create staff account")}catch(m){console.error("Error during staff signup:",m),"auth/popup-closed-by-user"===m.code?f("Sign-in was cancelled. Please try again."):"auth/popup-blocked"===m.code?f("Sign-in popup was blocked. Please allow popups and try again."):"auth/account-exists-with-different-credential"===m.code?f("An account with this email already exists. Please sign in with the existing method."):f("Failed to create staff account. Please try again.")}finally{d(!1)}}},disabled:c,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-white border-2 border-gray-300 rounded-xl font-semibold text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(Sb,{className:"h-5 w-5 animate-spin"}),"Creating Account..."]}):(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",children:[(0,Pe.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Pe.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Pe.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Pe.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 text-center mt-6",children:"By signing up, you agree to join the team and accept the assigned permissions. This invite expires and can only be used once."})]})});var b},_b=Ee("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Cb=Ee("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Ib=()=>{var e;const{state:n,dispatch:r}=(0,i.nm)(),[s,o]=(0,t.useState)([]),[l,c]=(0,t.useState)(!0),[d,u]=(0,t.useState)(null),[h,m]=(0,t.useState)(null),[f,p]=(0,t.useState)(0),[g,x]=(0,t.useState)(null),y=null===(e=n.currentPlanDetails)||void 0===e?void 0:e.planUsageSummary,b=y?[{key:"customers",label:"Customers",summary:y.customers},{key:"products",label:"Products",summary:y.products},{key:"orders",label:"Orders",summary:y.orders}].filter(e=>e.summary):[],w=e=>"number"===typeof(null===e||void 0===e?void 0:e.used)?e.used:0,v=e=>e?e.isUnlimited?"Unlimited":"number"===typeof e.remaining?Math.max(0,e.remaining):"number"===typeof e.limit?Math.max(0,e.limit-w(e)):Math.max(0,-w(e)):0,N=async()=>{try{u(null);const r=await(0,Se.AT)("/data/plans");if(r.success&&r.data){const s=(Array.isArray(r.data),r.data);let i=[],l=null,c=0;if(Array.isArray(s)?i=s:s&&Array.isArray(s.data)?(i=s.data,l=s.sellerPlanInfo,c=s.activePlanOrdersCount||0):r.data.data&&Array.isArray(r.data.data)&&(i=r.data.data,l=r.data.sellerPlanInfo,c=r.data.activePlanOrdersCount||0),Array.isArray(i)){var e,t;const s=i.map(e=>{var t,r;return(0,a.A)((0,a.A)({},e),{},{planType:e.planType||"standard",current:void 0!==e.isCurrentPlan?e.isCurrentPlan:n.currentPlan===e.id||n.currentPlan===(null===(t=e.name)||void 0===t||null===(r=t.toLowerCase())||void 0===r?void 0:r.replace(/\s+/g,"-"))||n.currentPlan===e._id})});console.log("Plans received with planTypes:",s.map(e=>({name:e.name,planType:e.planType}))),o(s),l?m(l):null!==(e=r.data)&&void 0!==e&&e.sellerPlanInfo&&m(r.data.sellerPlanInfo),c>0?p(c):null!==(t=r.data)&&void 0!==t&&t.activePlanOrdersCount&&p(r.data.activePlanOrdersCount)}else u("Invalid plans data format"),o([])}else u("No internet"),window.showToast&&window.showToast("No internet","error"),o([])}catch(r){console.error("Error fetching plans:",r),u("No internet"),window.showToast&&window.showToast("No internet","error"),o([])}};(0,t.useEffect)(()=>{(async()=>{c(!0),await N(),c(!1)})()},[n.currentPlan]);const S=async()=>{try{const[e,t]=await Promise.all([(0,Se.AT)("/data/current-plan"),(0,Se.AT)("/plans/usage")]),n=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||e.data:null,s=t.success&&t.data&&t.data.summary?t.data:null;let o=(0,i.P9)(n,s);!o&&n&&(o=(0,a.A)({},n)),o&&(r({type:i.ActionTypes.SET_CURRENT_PLAN_DETAILS,payload:o}),o.planId&&r({type:i.ActionTypes.SET_CURRENT_PLAN,payload:o.planId}))}catch(e){console.error("Error refreshing plan details:",e)}};if(l)return(0,Pe.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Loading plans..."})]})});if(d&&0===s.length)return(0,Pe.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,Pe.jsxs)("div",{className:"text-center p-8 bg-red-50 rounded-lg border border-red-200 max-w-md",children:[(0,Pe.jsxs)("p",{className:"text-red-600 mb-4",children:["Error loading plans: ",d]}),(0,Pe.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"Retry"})]})});if(0===s.length)return(0,Pe.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,Pe.jsxs)("div",{className:"text-center p-8",children:[(0,Pe.jsx)("p",{className:"text-gray-600 mb-4",children:"No plans available at the moment."}),(0,Pe.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"Refresh"})]})});const A=s.find(e=>e.current)||s[0];return(0,Pe.jsxs)("div",{className:"space-y-8",children:[(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"flex justify-center mb-4",children:(0,Pe.jsx)("div",{className:"p-4 bg-gradient-to-r from-black to-primary-500 rounded-full",children:(0,Pe.jsx)(Ge,{className:"h-12 w-12 text-white"})})}),(0,Pe.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Choose Your Plan"}),(0,Pe.jsx)("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Unlock the full potential of your grocery business with our advanced features and tools."}),(0,Pe.jsxs)("div",{className:"mt-6 p-4 bg-primary-50 border border-primary-200 rounded-lg max-w-2xl mx-auto",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-center text-primary-800",children:[(0,Pe.jsx)(Ge,{className:"h-5 w-5 mr-2"}),(0,Pe.jsx)("span",{className:"font-medium",children:"How to Upgrade:"})]}),(0,Pe.jsx)("p",{className:"text-primary-700 text-sm mt-2",children:"Simply click on any plan card below to instantly upgrade your account. All features will be unlocked immediately!"})]})]}),d&&s.length>0&&(0,Pe.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:(0,Pe.jsx)("p",{className:"text-yellow-800 text-sm",children:"\u26a0\ufe0f Some plans may not be available. Showing available plans."})}),(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-black to-primary-500 rounded-xl p-6 text-white",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Current Plan: ",(null===A||void 0===A?void 0:A.name)||"Basic"]}),(0,Pe.jsx)("p",{className:"text-white/80",children:(null===A||void 0===A?void 0:A.description)||""}),h&&h.expiryDate&&(0,Pe.jsxs)("p",{className:"text-white/80 text-sm mt-2",children:["Expires: ",new Date(h.expiryDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),h.isExpired&&(0,Pe.jsx)("span",{className:"ml-2 bg-red-500 px-2 py-1 rounded text-xs",children:"Expired"})]}),(0,Pe.jsx)("p",{className:"text-white/80 text-sm mt-2",children:"\ud83d\udca1 Click any plan below to upgrade instantly!"})]}),(0,Pe.jsxs)("div",{className:"text-right",children:[(0,Pe.jsx)("p",{className:"text-3xl font-bold",children:(null===A||void 0===A?void 0:A.price)||"\u20b9299"}),(0,Pe.jsx)("p",{className:"text-green-100",children:(null===A||void 0===A?void 0:A.period)||"per month"})]})]})}),(b.length>0||f>0)&&(0,Pe.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm mb-10",children:[(0,Pe.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Active Plan Capacity"}),f>0&&(0,Pe.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["You have ",f," active plan order",1===f?"":"s"," in use."]})]})}),b.length>0&&(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:b.map(e=>{return(0,Pe.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,Pe.jsx)("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:e.label}),(0,Pe.jsxs)("div",{className:"mt-2 text-lg font-semibold text-gray-900",children:[w(e.summary)," / ",(t=e.summary,null!==t&&void 0!==t&&t.isUnlimited?"Unlimited":"number"===typeof(null===t||void 0===t?void 0:t.limit)?t.limit:0)]}),(0,Pe.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Remaining: ",v(e.summary)]})]},e.key);var t})})]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map((e,t)=>(0,Pe.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-lg border-2 border-primary-200 ".concat(e.popular?"ring-2 ring-primary-500 ring-opacity-50":""," ").concat(e.current?"opacity-75":""),children:[e.popular&&(0,Pe.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,Pe.jsxs)("div",{className:"bg-primary-500 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center",children:[(0,Pe.jsx)(_b,{className:"h-4 w-4 mr-1"}),"Most Popular"]})}),e.current&&(0,Pe.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2 z-10",children:(0,Pe.jsx)("div",{className:"bg-primary-500 text-white px-4 py-2 rounded-full text-sm font-semibold",children:"Current Plan"})}),!e.current&&e.userHasThisPlan&&(0,Pe.jsx)("div",{className:"absolute -top-4 right-4 z-10",children:(0,Pe.jsx)("div",{className:"bg-primary-500 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"You Have This Plan"})}),(0,Pe.jsxs)("div",{className:"p-8",children:[(0,Pe.jsxs)("div",{className:"text-center mb-6",children:[(0,Pe.jsx)("div",{className:"text-4xl mb-2",children:e.icon}),(0,Pe.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsx)("span",{className:"text-4xl font-bold text-gray-900",children:e.price}),(0,Pe.jsx)("span",{className:"text-gray-600 ml-2",children:e.period})]}),(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description})]}),(0,Pe.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,Pe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Limits"}),(0,Pe.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Max Customers:"}),(0,Pe.jsx)("span",{className:"font-medium",children:e.maxCustomers===1/0||-1===e.maxCustomers?"Unlimited":e.maxCustomers})]}),(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Max Products:"}),(0,Pe.jsx)("span",{className:"font-medium",children:e.maxProducts===1/0||-1===e.maxProducts?"Unlimited":e.maxProducts})]}),(0,Pe.jsxs)("div",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{className:"text-gray-600",children:"Max Orders:"}),(0,Pe.jsx)("span",{className:"font-medium",children:e.maxOrders===1/0||-1===e.maxOrders?"Unlimited":e.maxOrders})]})]})]}),e.unlockedModules&&e.unlockedModules.length>0&&(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[(0,Pe.jsx)(Cb,{className:"h-4 w-4 mr-2 text-primary-500"}),"Unlocked Modules"]}),(0,Pe.jsx)("ul",{className:"space-y-2",children:e.unlockedModules.map((e,t)=>(0,Pe.jsxs)("li",{className:"flex items-start",children:[(0,Pe.jsx)(Yc,{className:"h-4 w-4 text-primary-500 mr-2 mt-0.5 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-700",children:e})]},t))})]}),e.lockedModules&&e.lockedModules.length>0&&(0,Pe.jsxs)("div",{className:"mb-6",children:[(0,Pe.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[(0,Pe.jsx)(Xe,{className:"h-4 w-4 mr-2 text-primary-500"}),"Locked Modules"]}),(0,Pe.jsx)("ul",{className:"space-y-2",children:e.lockedModules.map((e,t)=>(0,Pe.jsxs)("li",{className:"flex items-start",children:[(0,Pe.jsx)(Xe,{className:"h-4 w-4 text-primary-500 mr-2 mt-0.5 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-500",children:e})]},t))})]}),(0,Pe.jsx)("button",{onClick:()=>(async e=>{var t;const a=s.find(t=>t.id===e||t._id===e),o="mini"===(null===a||void 0===a?void 0:a.planType);if(null!==a&&void 0!==a&&a.current)return;if(null!==a&&void 0!==a&&a.userHasThisPlan&&!o){try{x(e);const t=await(0,Se.AT)("/data/plans/upgrade",{method:"POST",body:{planId:e}});if(t.success){var l;const n=(null===(l=t.data)||void 0===l?void 0:l.data)||t.data;r({type:i.ActionTypes.SET_CURRENT_PLAN,payload:e}),window.showToast("Switched to ".concat((null===n||void 0===n?void 0:n.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!"),"success"),await N(),await S()}else{const e=t.message||t.error||"Unable to switch plan right now.";window.showToast(e,"error")}}catch(g){console.error("Error switching plan:",g),window.showToast("No internet","error")}finally{x(null)}return}if(0!==((null===a||void 0===a?void 0:a.rawPrice)||parseFloat((null===a||void 0===a||null===(t=a.price)||void 0===t?void 0:t.replace("\u20b9",""))||"0")))try{var c,u,h,m;x(e);const t=await(0,Se.AT)("/data/plans/create-razorpay-order",{method:"POST",body:{planId:e}});if(!t.success)return window.showToast("No internet","error"),void x(null);const s=(null===(c=t.data)||void 0===c?void 0:c.data)||t.data;if(null!==s&&void 0!==s&&s.isFree){const t=await(0,Se.AT)("/data/plans/upgrade",{method:"POST",body:{planId:e}});if(t.success){var f;const n=(null===(f=t.data)||void 0===f?void 0:f.data)||t.data;o||r({type:i.ActionTypes.SET_CURRENT_PLAN,payload:e});const s=o?"Successfully topped up with ".concat((null===n||void 0===n?void 0:n.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!"):"Successfully upgraded to ".concat((null===n||void 0===n?void 0:n.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!");window.showToast(s,"success"),await N(),await S()}return void x(null)}const{orderId:l,amount:p,currency:g,key:y}=s;if(!y)return console.error("Razorpay key is missing from response:",s),window.showToast("Payment configuration error. Please contact support.","error"),void x(null);if(!window.Razorpay)return console.error("Razorpay script is not loaded"),window.showToast("Payment gateway is not available. Please refresh the page.","error"),void x(null);if(!l||!p||!g)return console.error("Missing payment details:",{orderId:l,amount:p,currency:g,key:y}),window.showToast("Invalid payment order. Please try again.","error"),void x(null);const b={key:y,amount:p,currency:g,name:"Drag & Drop",description:"Plan Purchase: ".concat((null===a||void 0===a?void 0:a.name)||"Selected Plan"),order_id:l,handler:async function(t){try{const s=await(0,Se.AT)("/data/plans/verify-razorpay-payment",{method:"POST",body:{razorpayOrderId:t.razorpay_order_id,razorpayPaymentId:t.razorpay_payment_id,razorpaySignature:t.razorpay_signature,planId:e}});if(s.success){var n;const t=(null===(n=s.data)||void 0===n?void 0:n.data)||s.data;o||r({type:i.ActionTypes.SET_CURRENT_PLAN,payload:e});const l=o?"Successfully topped up with ".concat((null===t||void 0===t?void 0:t.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!"):"Successfully upgraded to ".concat((null===t||void 0===t?void 0:t.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!");window.showToast(l,"success"),await N(),await S()}else window.showToast("No internet","error")}catch(s){console.error("Payment verification error:",s),window.showToast("No internet","error")}finally{x(null)}},prefill:{name:(null===(u=n.currentUser)||void 0===u?void 0:u.name)||"",email:(null===(h=n.currentUser)||void 0===h?void 0:h.email)||"",contact:(null===(m=n.currentUser)||void 0===m?void 0:m.phone)||""},theme:{color:"#10b981"},modal:{ondismiss:function(){x(null),window.showToast("Payment cancelled","warning")}}};try{const e=new window.Razorpay(b);e.on("payment.failed",function(e){console.error("Payment failed:",e.error),window.showToast("Payment failed: ".concat(e.error.description||e.error.reason||"Unknown error"),"error"),x(null)}),e.open()}catch(d){console.error("Error opening Razorpay checkout:",d),window.showToast("Failed to open payment gateway. Please try again.","error"),x(null)}}catch(g){console.error("Error initiating payment:",g),window.showToast("No internet","error"),x(null)}else try{x(e);const t=await(0,Se.AT)("/data/plans/upgrade",{method:"POST",body:{planId:e}});if(t.success){var p;const n=(null===(p=t.data)||void 0===p?void 0:p.data)||t.data;o||r({type:i.ActionTypes.SET_CURRENT_PLAN,payload:e});const s=o?"Successfully topped up with ".concat((null===n||void 0===n?void 0:n.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!"):"Successfully upgraded to ".concat((null===n||void 0===n?void 0:n.planName)||(null===a||void 0===a?void 0:a.name)||"selected plan","!");window.showToast(s,"success"),await N(),await S()}else{const e=t.message||t.error||"Unable to activate this plan.";window.showToast(e,"error")}}catch(g){console.error("Error upgrading plan:",g),window.showToast("No internet","error")}finally{x(null)}})(e.id||e._id),className:"w-full py-3 px-6 rounded-lg font-semibold transition-all duration-200 ".concat(e.current?"bg-gray-300 text-gray-500 cursor-not-allowed":g===(e.id||e._id)?"bg-gray-400 text-white cursor-wait":"bg-primary-500 hover:bg-primary-600 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1"),disabled:e.current||g===(e.id||e._id),children:e.current?"Current Plan":g===(e.id||e._id)?e.userHasThisPlan?"Switching...":"Upgrading...":e.userHasThisPlan?"Switch Plan":e.popular?"Upgrade Now":"Upgrade Plan"})]})]},e.id||e._id))}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl p-8",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"Feature Comparison"}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"p-4 bg-primary-50 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,Pe.jsx)(_t,{className:"h-8 w-8 text-primary-600"})}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Lightning Fast"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Optimized performance for quick operations"})]}),(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"p-4 bg-primary-50 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,Pe.jsx)(Te,{className:"h-8 w-8 text-primary-600"})}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Secure & Reliable"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Your data is safe with enterprise-grade security"})]}),(0,Pe.jsxs)("div",{className:"text-center",children:[(0,Pe.jsx)("div",{className:"p-4 bg-primary-50 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,Pe.jsx)(Le,{className:"h-8 w-8 text-primary-600"})}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Team Collaboration"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Work together with your team seamlessly"})]})]})]}),(0,Pe.jsxs)("div",{className:"bg-white rounded-xl p-8",children:[(0,Pe.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Frequently Asked Questions"}),(0,Pe.jsxs)("div",{className:"space-y-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Can I change my plan anytime?"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Yes, you can upgrade or downgrade your plan at any time. Changes take effect immediately."})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Is there a free trial?"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"Yes, all paid plans come with a 14-day free trial. No credit card required."})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"What payment methods do you accept?"}),(0,Pe.jsx)("p",{className:"text-gray-600",children:"We accept all major credit cards, UPI, and bank transfers."})]})]})]})]})},Eb=Ee("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Tb=Ee("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),jb=Ee("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),kb=Ee("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Db=()=>{var e,n,r,s,a;const{state:o,dispatch:l}=(0,i.nm)();(0,t.useEffect)(()=>{console.log("StaffSettings component rendered"),setTimeout(()=>{const e=document.querySelector("button");console.log("Resign button element found:",e),e&&(console.log("Button text:",e.textContent),console.log("Button classes:",e.className))},100)},[]);const[c,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(null),[m,f]=(0,t.useState)(!1),[p,g]=(0,t.useState)(""),[x,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{var e,t;if(null!==(e=o.currentUser)&&void 0!==e&&e.sellerId&&(null===(t=o.currentUser)||void 0===t||!t.seller)&&!u)try{var n;console.log("\ud83d\udd04 Fetching seller info for staff user...");const e=await(0,Se.AT)("/data/seller/profile");e.success&&null!==(n=e.data)&&void 0!==n&&n.seller&&(console.log("\u2705 Fetched seller info:",e.data.seller),h(e.data.seller))}catch(r){console.error("\u274c Failed to fetch seller info:",r)}})()},[null===(e=o.currentUser)||void 0===e?void 0:e.sellerId,null===(n=o.currentUser)||void 0===n?void 0:n.seller,u]);return m?(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 px-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Resignation"}),(0,Pe.jsx)("button",{onClick:()=>{x||(f(!1),g(""))},className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",disabled:x,children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Are you sure you want to resign from your staff position? This action cannot be undone and will:"}),(0,Pe.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1 mb-4",children:[(0,Pe.jsx)("li",{children:"\u2022 Immediately deactivate your account"}),(0,Pe.jsx)("li",{children:"\u2022 Revoke all your permissions"}),(0,Pe.jsx)("li",{children:"\u2022 Remove access from all devices"}),(0,Pe.jsx)("li",{children:"\u2022 Notify your seller about your resignation"})]})]}),(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for resignation (optional)"}),(0,Pe.jsx)("textarea",{value:p,onChange:e=>g(e.target.value),placeholder:"Please provide a reason for your resignation...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none",rows:3,disabled:x,maxLength:500}),(0,Pe.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[p.length,"/500 characters"]})]}),(0,Pe.jsxs)("div",{className:"flex space-x-3",children:[(0,Pe.jsx)("button",{onClick:()=>{x||(f(!1),g(""))},className:"flex-1 btn-secondary",disabled:x,children:"Cancel"}),(0,Pe.jsx)("button",{onClick:async()=>{if(p.trim()){y(!0);try{const e=await(0,Se.AT)("/staff/".concat(o.currentUser._id,"/resign"),{method:"PATCH",body:{reason:p.trim()}});e.success?(window.showToast&&window.showToast("You have successfully resigned. Your account has been deactivated.","success"),setTimeout(()=>{window.location.href="/login"},2e3)):window.showToast&&window.showToast(e.message||"Failed to process resignation","error")}catch(e){console.error("Resignation error:",e),window.showToast&&window.showToast("Failed to process resignation","error")}finally{y(!1),f(!1),g("")}}else window.showToast&&window.showToast("Please provide a reason for resignation","warning")},disabled:x,className:"flex-1 btn-primary bg-red-600 hover:bg-red-700 disabled:bg-red-400",children:x?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(Ou,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"Confirm Resignation"})]})]})}):(0,Pe.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Pe.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white",children:(0,Pe.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,Pe.jsx)("div",{className:"flex items-center justify-between",children:(0,Pe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Pe.jsx)("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-xl",children:(0,Pe.jsx)(gd,{className:"h-8 w-8"})}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Staff Settings"}),(0,Pe.jsx)("p",{className:"text-indigo-100 mt-1",children:"Manage your account settings and preferences"})]})]})})})}),(0,Pe.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,Pe.jsxs)("div",{className:"space-y-8",children:[(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(gd,{className:"h-5 w-5 mr-2 text-indigo-600"}),"Profile Information"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,Pe.jsx)("input",{type:"text",value:(null===(r=o.currentUser)||void 0===r?void 0:r.name)||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,Pe.jsx)("input",{type:"email",value:(null===(s=o.currentUser)||void 0===s?void 0:s.email)||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"})]})]})]}),(null===(a=o.currentUser)||void 0===a?void 0:a.permissions)&&(0,Pe.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(Te,{className:"h-5 w-5 mr-2 text-green-600"}),"Your Permissions"]}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(o.currentUser.permissions).map(e=>{let[t,n]=e;return(0,Pe.jsx)("div",{className:"p-4 rounded-lg border ".concat(n?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:(0,Pe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Pe.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(n?"bg-green-500":"bg-gray-400")}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"font-medium text-sm text-gray-900 capitalize",children:t.replace(/_/g," ").replace(/([A-Z])/g," $1").trim()}),(0,Pe.jsx)("p",{className:"text-xs ".concat(n?"text-green-600":"text-gray-500"),children:n?"Enabled":"Disabled"})]})]})},t)})}),(0,Pe.jsx)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,Pe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Pe.jsx)(St,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Permission Changes"}),(0,Pe.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"If you need additional permissions or believe your current permissions are incorrect, please contact your seller directly."})]})]})})]}),(0,Pe.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-red-200 p-6",children:(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-red-900 mb-1",children:"Resign from Position"}),(0,Pe.jsx)("p",{className:"text-red-600 text-sm",children:"Permanently leave your staff position. This action cannot be undone."})]}),(0,Pe.jsxs)("button",{onClick:()=>f(!0),className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 transition-colors",children:[(0,Pe.jsx)(St,{className:"h-5 w-5"}),(0,Pe.jsx)("span",{children:"Resign"})]})]})})]})})]})},Pb=(0,t.memo)(()=>{var e,n;const{state:r}=(0,i.nm)(),s="staff"===r.userType||"staff"===(null===(e=r.currentUser)||void 0===e?void 0:e.userType);return(0,t.useEffect)(()=>{var e;console.log("Settings component - state.userType:",r.userType),console.log("Settings component - state.currentUser?.userType:",null===(e=r.currentUser)||void 0===e?void 0:e.userType),console.log("Settings component - isStaffUser:",s)},[r.userType,null===(n=r.currentUser)||void 0===n?void 0:n.userType,s]),s?(0,Pe.jsx)(Db,{}):(0,Pe.jsx)(Rb,{})}),Rb=()=>{var e,n,r,s,o,l,c,d;const{state:u,dispatch:h}=(0,i.nm)(),m="staff"===u.userType||"staff"===(null===(e=u.currentUser)||void 0===e?void 0:e.userType),f=e=>{var t,n;const r=(null===e||void 0===e?void 0:e.businessType)||(null===e||void 0===e?void 0:e.businessCategory),s=r&&""!==r.trim()?r.trim():"Retail";return{lowStockThreshold:null!==(t=null===e||void 0===e?void 0:e.lowStockThreshold)&&void 0!==t?t:10,expiryDaysThreshold:null!==(n=null===e||void 0===e?void 0:e.expiryDaysThreshold)&&void 0!==n?n:7,storeName:(null===e||void 0===e?void 0:e.shopName)||"",gstNumber:(null===e||void 0===e?void 0:e.gstNumber)||"",upiId:(null===e||void 0===e?void 0:e.upiId)||"",sellerName:(null===e||void 0===e?void 0:e.name)||"",sellerEmail:(null===e||void 0===e?void 0:e.email)||"",sellerPhone:(null===e||void 0===e?void 0:e.phoneNumber)||(null===e||void 0===e?void 0:e.mobileNumber)||"",businessAddress:(null===e||void 0===e?void 0:e.shopAddress)||(null===e||void 0===e?void 0:e.address)||"",businessCity:(null===e||void 0===e?void 0:e.city)||"",businessState:(null===e||void 0===e?void 0:e.state)||"",businessPincode:(null===e||void 0===e?void 0:e.pincode)||"",businessType:s}},p=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,a.A)((0,a.A)({id:"settings_".concat(e),sellerId:e},t),{},{updatedAt:(new Date).toISOString(),isSynced:!1},n)},g=function(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=(null===e||void 0===e?void 0:e.businessType)||(null===e||void 0===e?void 0:e.businessCategory),i=s&&""!==s.trim()?s.trim():"Retail";return{lowStockThreshold:null!==(t=null===e||void 0===e?void 0:e.lowStockThreshold)&&void 0!==t?t:10,expiryDaysThreshold:null!==(n=null===e||void 0===e?void 0:e.expiryDaysThreshold)&&void 0!==n?n:7,storeName:(null===e||void 0===e?void 0:e.storeName)||"",gstNumber:(null===e||void 0===e?void 0:e.gstNumber)||"",upiId:(null===e||void 0===e?void 0:e.upiId)||"",sellerName:(null===e||void 0===e?void 0:e.sellerName)||"",sellerEmail:(null===e||void 0===e?void 0:e.sellerEmail)||r,sellerPhone:(null===e||void 0===e?void 0:e.sellerPhone)||"",businessAddress:(null===e||void 0===e?void 0:e.businessAddress)||"",businessCity:(null===e||void 0===e?void 0:e.businessCity)||"",businessState:(null===e||void 0===e?void 0:e.businessState)||"",businessPincode:(null===e||void 0===e?void 0:e.businessPincode)||"",businessType:i}},x=async e=>{try{await(0,Ae.updateItem)(Ae.STORES.settings,e,!0)}catch(t){try{await(0,Ae.addItem)(Ae.STORES.settings,e,!0)}catch(n){console.error("Error saving settings to IndexedDB:",n)}}},[y,b]=(0,t.useState)(!1),[w,v]=(0,t.useState)(!1),[N,S]=(0,t.useState)(navigator.onLine),[A,_]=(0,t.useState)(!1),[C,I]=(0,t.useState)({lowStockThreshold:10,expiryDaysThreshold:7,storeName:"",gstNumber:"",upiId:"",sellerName:"",sellerEmail:"",sellerPhone:"",businessAddress:"",businessCity:"",businessState:"",businessPincode:"",businessType:"Retail"}),[E,T]=(0,t.useState)(!1),[j,k]=(0,t.useState)(!1),[D,P]=(0,t.useState)([]),[R,O]=(0,t.useState)({message:"",offline:!1}),[L,M]=(0,t.useState)(!1),[F,B]=(0,t.useState)(""),[U,z]=(0,t.useState)(!1),q=(e=>{if(null!==e&&void 0!==e&&e._id)return e._id;if(null!==e&&void 0!==e&&e.sellerId)return e.sellerId;try{var t,n;const e=JSON.parse(localStorage.getItem("auth")||"{}");return e.sellerId||(null===(t=e.currentUser)||void 0===t?void 0:t._id)||(null===(n=e.currentUser)||void 0===n?void 0:n.sellerId)||null}catch(r){return console.error("Error reading sellerId from storage:",r),null}})(u.currentUser),H=(null===(n=u.currentUser)||void 0===n?void 0:n.email)||"",V=(0,t.useRef)(!1),W=(0,t.useRef)(!1),G=(0,t.useCallback)(async()=>{if(!q)return null;try{return await(0,Ae.getItem)(Ae.STORES.settings,"settings_".concat(q))}catch(e){if("NotFoundError"===(null===e||void 0===e?void 0:e.name)){const e=f(u.currentUser||{email:H}),t=p(q,e,{isSynced:!0,sellerEmail:e.sellerEmail||H});return await x(t),t}throw e}},[q,H]),Y=(0,t.useCallback)(async function(){let{silent:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!q)return!0;if(!N)return!1;try{const l=await G();if(!l||l.isSynced)return _(!1),!0;const c=(e=>({upiId:e.upiId.trim(),username:e.sellerName,phone:e.sellerPhone,address:e.businessAddress,city:e.businessCity,state:e.businessState,pincode:e.businessPincode,businessType:e.businessType,storeName:e.storeName,gstNumber:e.gstNumber,lowStockThreshold:parseInt(e.lowStockThreshold,10)||0,expiryDaysThreshold:parseInt(e.expiryDaysThreshold,10)||0}))(l);console.log("\ud83c\udf10 Syncing offline settings to MongoDB:",c);const d=await(0,Se.AT)("/data/seller/settings",{method:"PUT",body:c});if(d.success){try{var t,n,r;const e=await(0,Se.AT)("/data/seller/profile"),o=(null===(t=e.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.seller)||(null===(r=e.data)||void 0===r?void 0:r.seller);if(e.success&&o){const e=f(o);I(e),h({type:i.ActionTypes.UPDATE_USER,payload:o});const t=p(q,e,{updatedAt:(new Date).toISOString(),isSynced:!0,syncedAt:(new Date).toISOString(),sellerEmail:e.sellerEmail});await x(t);try{const e=JSON.parse(localStorage.getItem("auth")||"{}");e.currentUser=o,localStorage.setItem("auth",JSON.stringify(e))}catch(s){console.error("Error updating auth storage after sync:",s)}}else{const e=l.sellerEmail||H,t=p(q,g(l,e),{updatedAt:(new Date).toISOString(),isSynced:!0,syncedAt:(new Date).toISOString(),sellerEmail:e});if(await x(t),u.currentUser){const e=(0,a.A)((0,a.A)({},u.currentUser),{},{name:l.sellerName,phoneNumber:l.sellerPhone,shopName:l.storeName,shopAddress:l.businessAddress,city:l.businessCity,state:l.businessState,pincode:l.businessPincode,gstNumber:l.gstNumber,businessType:l.businessType||l.businessCategory,upiId:l.upiId,lowStockThreshold:l.lowStockThreshold,expiryDaysThreshold:l.expiryDaysThreshold});h({type:i.ActionTypes.UPDATE_USER,payload:e})}}}catch(o){console.error("Error fetching seller profile after sync:",o);const e=l.sellerEmail||H,t=p(q,g(l,e),{updatedAt:(new Date).toISOString(),isSynced:!0,syncedAt:(new Date).toISOString(),sellerEmail:e});await x(t)}return _(!1),!e&&window.showToast&&window.showToast("Offline changes synced successfully!","success"),!0}return _(!0),!e&&window.showToast&&window.showToast(d.error||"Failed to sync settings. Will retry automatically.","warning"),!1}catch(s){return console.error("Error syncing settings to MongoDB:",s),_(!0),!e&&window.showToast&&window.showToast("Failed to sync settings. They will retry automatically.","error"),!1}},[q,N,H,u.currentUser,h,G]);(0,t.useEffect)(()=>{if(!q)return V.current=!1,void(W.current=!1);V.current=!1,W.current=!1;let e=!0;return(async()=>{if(W.current)return;let t=null;try{const n=await G();if(n&&e){console.log("[Settings] Raw IndexedDB record:",{businessType:n.businessType,businessCategory:n.businessCategory,fullRecord:n}),t=g(n,H);const e=!1===n.isSynced;I(t),_(e),console.log("[Settings] Loaded from IndexedDB - Converted settings:",{businessType:t.businessType,businessCategory:n.businessCategory,rawBusinessType:n.businessType,rawBusinessCategory:n.businessCategory})}}catch(c){console.error("[Settings] Error loading from IndexedDB:",c)}if(N&&e&&!W.current){W.current=!0;try{var n,r,s;const c=await(0,Se.AT)("/data/seller/profile"),d=(null===(n=c.data)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.seller)||(null===(s=c.data)||void 0===s?void 0:s.seller);if(c.success&&d&&e){var o,l;console.log("[Settings] Seller data from API (MongoDB):",{businessType:d.businessType,businessCategory:d.businessCategory,rawSellerData:d});const e=f(d);console.log("[Settings] Mapped settings from MongoDB:",{businessType:e.businessType,fullSettings:e}),console.log("[Settings] Comparing IndexedDB vs MongoDB:",{indexedDB:null===(o=t)||void 0===o?void 0:o.businessType,mongodb:e.businessType,indexedDBRaw:t,mongodbRaw:e});const n=(0,a.A)({},e),r=d.businessType||d.businessCategory,s=null===(l=t)||void 0===l?void 0:l.businessType;r&&""!==r.trim()&&"Retail"!==r?(console.log("[Settings] Using MongoDB businessType value:",r),n.businessType=r.trim()):s&&"Retail"!==s?(console.log("[Settings] Preserving IndexedDB businessType value:",s),n.businessType=s):r&&""!==r.trim()&&(console.log("[Settings] Using MongoDB businessType value (even if default):",r),n.businessType=r.trim());if(((e,t)=>{if(!e||!t)return!0;const n=["lowStockThreshold","expiryDaysThreshold","storeName","gstNumber","upiId","sellerName","sellerEmail","sellerPhone","businessAddress","businessCity","businessState","businessPincode","businessType"];for(const r of n)if(String(e[r]||"").trim()!==String(t[r]||"").trim())return!0;return!1})(t,n)){console.log("[Settings] API data differs from IndexedDB, updating UI with:",{businessType:n.businessType}),I(n),h({type:i.ActionTypes.UPDATE_USER,payload:d});const e=p(q,n,{isSynced:!0,sellerEmail:n.sellerEmail,syncedAt:(new Date).toISOString()});await x(e),_(!1)}else{if(console.log("[Settings] API data matches IndexedDB, no update needed"),t){const e=p(q,t,{isSynced:!0,sellerEmail:t.sellerEmail,syncedAt:(new Date).toISOString()});await x(e)}h({type:i.ActionTypes.UPDATE_USER,payload:d})}}}catch(c){console.error("[Settings] Error fetching seller profile from API:",c)}finally{W.current=!1}}else!N&&e&&console.log("[Settings] Offline mode - using IndexedDB data only");if(!t&&u.currentUser&&e){console.log("[Settings] Using currentUser fallback:",{businessType:u.currentUser.businessType,businessCategory:u.currentUser.businessCategory});const e=f(u.currentUser);console.log("[Settings] Fallback settings:",{businessType:e.businessType}),I(e);const t=p(q,e,{isSynced:!0,sellerEmail:e.sellerEmail});x(t),_(!1)}V.current=!0})(),()=>{e=!1}},[q,N,H,G]),(0,t.useEffect)(()=>{const e=()=>S(!0),t=()=>S(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,t.useEffect)(()=>{N&&A&&Y({silent:!0})},[N,A,Y]),(0,t.useEffect)(()=>{console.log("[Settings] businessType state changed:",{businessType:C.businessType,isEditing:y,timestamp:(new Date).toISOString()})},[C.businessType,y]);const X=()=>{j||(T(!1),P([]),O({message:"",offline:!1}))};return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)("div",{className:"space-y-8 pb-16 max-w-4xl mx-auto",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),(0,Pe.jsx)("p",{className:"text-gray-600 mt-2",children:m?"Manage your account settings and preferences":"Manage your business settings and preferences"})]}),A&&(0,Pe.jsxs)("div",{className:"rounded-lg border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-700 flex items-start gap-2",children:[(0,Pe.jsx)(lt,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),(0,Pe.jsxs)("span",{children:["Changes saved while offline will sync automatically when you are back online.",N?" Synchronizing now\u2026":" Reconnect to sync with the cloud."]})]}),(0,Pe.jsxs)("div",{className:"card space-y-8",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(gd,{className:"h-5 w-5 mr-2 text-blue-600"}),m?"Staff Profile":"Seller Profile"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,Pe.jsx)("input",{type:"text",value:C.sellerName,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{sellerName:e.target.value})),className:"input-field",placeholder:"Enter your name",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,Pe.jsx)("input",{type:"email",value:C.sellerEmail,className:"input-field",disabled:!0})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,Pe.jsx)("input",{type:"tel",value:C.sellerPhone,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{sellerPhone:e.target.value})),className:"input-field",placeholder:"Enter phone number",disabled:!y})]})]})]}),(0,Pe.jsxs)("div",{className:"border-t pt-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(Eb,{className:"h-5 w-5 mr-2 text-purple-600"}),"Business Profile"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store/Business Name"}),(0,Pe.jsx)("input",{type:"text",value:C.storeName,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{storeName:e.target.value})),className:"input-field",placeholder:"Enter store name",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),(()=>{const e=C.businessType||"Retail",t={retail:"Retail",grocery:"Grocery",wholesale:"Wholesale",electronics:"Electronics",clothing:"Clothing",food:"Food",pharmacy:"Pharmacy",hardware:"Hardware",other:"Other"},n=t[e.toLowerCase()]||e,r=!!t[e.toLowerCase()],s=e&&"Retail"!==e&&!r,i=n;return(0,Pe.jsx)(Pe.Fragment,{children:(0,Pe.jsxs)("select",{value:i,onChange:e=>{I(t=>(0,a.A)((0,a.A)({},t),{},{businessType:e.target.value}))},className:"input-field",disabled:!y,children:[s&&(0,Pe.jsx)("option",{value:e,children:e},"dynamic-".concat(e)),(0,Pe.jsx)("option",{value:"Retail",children:"Retail Store"}),(0,Pe.jsx)("option",{value:"Grocery",children:"Grocery Store"}),(0,Pe.jsx)("option",{value:"Wholesale",children:"Wholesale"}),(0,Pe.jsx)("option",{value:"Electronics",children:"Electronics"}),(0,Pe.jsx)("option",{value:"Clothing",children:"Clothing & Fashion"}),(0,Pe.jsx)("option",{value:"Food",children:"Food & Beverages"}),(0,Pe.jsx)("option",{value:"Pharmacy",children:"Pharmacy"}),(0,Pe.jsx)("option",{value:"Hardware",children:"Hardware"}),(0,Pe.jsx)("option",{value:"Other",children:"Other"})]})})})()]}),(0,Pe.jsxs)("div",{className:"md:col-span-2",children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Address"}),(0,Pe.jsx)("textarea",{value:C.businessAddress,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{businessAddress:e.target.value})),className:"input-field",rows:"2",placeholder:"Enter complete business address",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),(0,Pe.jsx)("input",{type:"text",value:C.businessCity,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{businessCity:e.target.value})),className:"input-field",placeholder:"Enter city",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),(0,Pe.jsx)("input",{type:"text",value:C.businessState,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{businessState:e.target.value})),className:"input-field",placeholder:"Enter state",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pincode"}),(0,Pe.jsx)("input",{type:"text",value:C.businessPincode,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{businessPincode:e.target.value})),className:"input-field",placeholder:"Enter pincode",disabled:!y})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"GST Number"}),(0,Pe.jsx)("input",{type:"text",value:C.gstNumber,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{gstNumber:e.target.value})),className:"input-field",placeholder:"Enter GST number (optional)",disabled:!y})]})]})]}),(0,Pe.jsxs)("div",{className:"border-t pt-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(De,{className:"h-5 w-5 mr-2 text-green-600"}),"Payment Settings"]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UPI ID"}),(0,Pe.jsx)("input",{type:"text",value:C.upiId,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{upiId:e.target.value})),className:"input-field",placeholder:"e.g. store@upi",disabled:!y}),(0,Pe.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Provide your business UPI ID to accept digital payments on invoices."})]})]}),(0,Pe.jsxs)("div",{className:"border-t pt-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(it,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Alert Settings"]}),(0,Pe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Low Stock Threshold"}),(0,Pe.jsx)("input",{type:"number",value:C.lowStockThreshold,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{lowStockThreshold:e.target.value})),className:"input-field",min:"0",placeholder:"Enter threshold",disabled:!y}),(0,Pe.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Products with stock at or below this number will trigger low stock alerts"})]}),(0,Pe.jsxs)("div",{children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Days Threshold"}),(0,Pe.jsx)("input",{type:"number",value:C.expiryDaysThreshold,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{expiryDaysThreshold:e.target.value})),className:"input-field",min:"0",placeholder:"Enter days",disabled:!y}),(0,Pe.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Products expiring within this many days will trigger expiry alerts"})]})]})]}),m&&(0,Pe.jsxs)("div",{className:"border-t pt-6",children:[(0,Pe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,Pe.jsx)(Te,{className:"h-5 w-5 mr-2 text-green-600"}),"My Permissions"]}),(0,Pe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Pe.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"These are the permissions granted to you by your administrator. If you need access to additional features, please contact your administrator to update your permissions."}),(0,Pe.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries((null===(r=u.currentUser)||void 0===r?void 0:r.permissions)||u.permissions||{}).filter(e=>{let[,t]=e;return t}).map(e=>{let[t,n]=e;return(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsx)(od,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,Pe.jsx)("span",{className:"text-sm text-gray-700 capitalize",children:t.replace(/_/g," ")})]},t)})}),(!(null!==(s=u.currentUser)&&void 0!==s&&s.permissions)&&!u.permissions||(null===(o=u.currentUser)||void 0===o?void 0:o.permissions)&&0===Object.keys(u.currentUser.permissions).length&&(!u.permissions||0===Object.keys(u.permissions).length))&&(0,Pe.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No permissions assigned yet."})]})]}),(0,Pe.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between pt-6 border-t border-gray-200 gap-3",children:[(0,Pe.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Pe.jsxs)("button",{onClick:()=>T(!0),className:"btn-secondary flex items-center justify-center bg-red-50 text-red-600 hover:bg-red-100 border-red-300",children:[(0,Pe.jsx)(Tb,{className:"h-4 w-4 mr-2"}),"Logout"]}),!N&&(0,Pe.jsxs)("div",{className:"flex items-center text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded-lg border border-orange-200",children:[(0,Pe.jsx)(jb,{className:"h-3 w-3 mr-1.5"}),"Offline"]})]}),!m&&(0,Pe.jsx)(Pe.Fragment,{children:y?(0,Pe.jsxs)("button",{onClick:async()=>{if(w)return;v(!0);const e=parseInt(C.lowStockThreshold,10),t=parseInt(C.expiryDaysThreshold,10);if(isNaN(e)||isNaN(t))return window.showToast&&window.showToast("Please enter valid numbers for thresholds","error"),void v(!1);if(!q)return console.error("Seller ID missing. Cannot save settings."),window.showToast&&window.showToast("Seller ID missing. Please log in again.","error"),void v(!1);const n=p(q,(0,a.A)((0,a.A)({},C),{},{sellerEmail:C.sellerEmail,lowStockThreshold:e,expiryDaysThreshold:t}),{isSynced:!1,sellerEmail:C.sellerEmail});try{if(await x(n),_(!0),u.currentUser){const n=(0,a.A)((0,a.A)({},u.currentUser),{},{name:C.sellerName,phoneNumber:C.sellerPhone,shopName:C.storeName,shopAddress:C.businessAddress,city:C.businessCity,state:C.businessState,pincode:C.businessPincode,gstNumber:C.gstNumber,businessType:C.businessType,upiId:C.upiId.trim(),lowStockThreshold:e,expiryDaysThreshold:t});h({type:i.ActionTypes.UPDATE_USER,payload:n});try{const e=JSON.parse(localStorage.getItem("auth")||"{}");e.currentUser=n,localStorage.setItem("auth",JSON.stringify(e))}catch(r){console.error("Error updating localStorage:",r)}}b(!1),N?(await Y({silent:!0}),window.showToast&&window.showToast("Settings saved. Syncing with cloud...","info")):window.showToast&&window.showToast("Settings saved offline. They will sync automatically when online.","info")}catch(s){console.error("Error saving settings to IndexedDB:",s),window.showToast&&window.showToast("Failed to save settings locally.","error")}finally{v(!1)}},disabled:w,className:"btn-primary flex items-center justify-center ".concat(w?"opacity-60 cursor-not-allowed":""),children:[(0,Pe.jsx)(kb,{className:"h-4 w-4 mr-2"}),w?"Saving...":"Save Settings"]}):(0,Pe.jsxs)("button",{onClick:()=>{b(!0)},className:"btn-primary flex items-center justify-center",children:[(0,Pe.jsx)(Ut,{className:"h-4 w-4 mr-2"}),"Edit Settings"]})})]})]}),(0,Pe.jsxs)("div",{className:"card border-red-200 bg-red-50",children:[(0,Pe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Pe.jsx)(lt,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-red-900",children:"Danger Zone"})]}),(0,Pe.jsx)("div",{className:"bg-white rounded-lg border border-red-200 p-4",children:(0,Pe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Pe.jsxs)("div",{className:"flex-1",children:[(0,Pe.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Delete Account"}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Permanently delete your account and all associated data. This action cannot be undone.","seller"===(null===(l=u.currentUser)||void 0===l?void 0:l.userType)?" All your products, orders, staff, and business data will be permanently removed.":" Your staff account and all associated data will be permanently removed."]})]}),(0,Pe.jsx)("button",{onClick:()=>M(!0),className:"btn-secondary bg-red-600 text-white hover:bg-red-700 border-red-600",children:"Delete Account"})]})})]})]}),L&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 px-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-red-900",children:"Delete Account"}),(0,Pe.jsx)("button",{onClick:()=>M(!1),className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsxs)("div",{className:"mt-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center text-red-600 mb-3",children:[(0,Pe.jsx)(lt,{className:"h-5 w-5 mr-2"}),(0,Pe.jsx)("span",{className:"font-medium",children:"This action cannot be undone"})]}),(0,Pe.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["This will permanently delete your ","seller"===(null===(c=u.currentUser)||void 0===c?void 0:c.userType)?"seller account":"staff account"," and remove all associated data from our servers."]}),"seller"===(null===(d=u.currentUser)||void 0===d?void 0:d.userType)&&(0,Pe.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[(0,Pe.jsx)("p",{className:"text-sm text-red-700 font-medium mb-2",children:"The following data will be permanently deleted:"}),(0,Pe.jsxs)("ul",{className:"text-sm text-red-700 space-y-1",children:[(0,Pe.jsx)("li",{children:"\u2022 Your business profile and settings"}),(0,Pe.jsx)("li",{children:"\u2022 All products and inventory data"}),(0,Pe.jsx)("li",{children:"\u2022 All orders and transaction history"}),(0,Pe.jsx)("li",{children:"\u2022 All staff accounts and permissions"}),(0,Pe.jsx)("li",{children:"\u2022 All reports and analytics data"})]})]}),(0,Pe.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[(0,Pe.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,Pe.jsx)("strong",{children:"Warning:"}),' To confirm deletion, type "DELETE" in the field below.']}),(0,Pe.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"This action is permanent and cannot be reversed."})]}),(0,Pe.jsxs)("div",{className:"mb-4",children:[(0,Pe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:'Type "DELETE" to confirm'}),(0,Pe.jsx)("input",{type:"text",value:F,onChange:e=>B(e.target.value),className:"input-field border-red-300 focus:border-red-500 focus:ring-red-500",placeholder:"Type DELETE here"})]})]}),(0,Pe.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Pe.jsx)("button",{onClick:()=>M(!1),className:"btn-secondary",disabled:U,children:"Cancel"}),(0,Pe.jsx)("button",{onClick:async()=>{if("DELETE"===F){z(!0);try{const t=await(0,Se.AT)("/auth/delete-account",{method:"DELETE"});var e;if(t.success)window.showToast&&window.showToast("Account deleted successfully","success"),localStorage.clear(),sessionStorage.clear(),await(0,ve.CI)(Ne.auth),window.location.href="/login";else if(window.showToast)window.showToast((null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to delete account","error")}catch(t){console.error("Error deleting account:",t),window.showToast&&window.showToast("Failed to delete account. Please try again.","error")}finally{z(!1),M(!1),B("")}}},disabled:U||"DELETE"!==F,className:"btn-primary bg-red-600 hover:bg-red-700 disabled:bg-red-400",children:U?"Deleting...":"Delete Account"})]})]})}),E&&(0,Pe.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 px-4",children:(0,Pe.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-6",children:[(0,Pe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Pe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Logout"}),(0,Pe.jsx)("button",{onClick:X,className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",children:(0,Pe.jsx)(Ye,{className:"h-5 w-5"})})]}),(0,Pe.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:D.length>0?"We detected pending offline changes.":"Make sure all your data is synced before logging out."}),D.length>0&&(0,Pe.jsxs)("div",{className:"mt-4 rounded-lg border border-orange-200 bg-orange-50 p-4",children:[(0,Pe.jsxs)("div",{className:"flex items-center text-sm font-medium text-orange-700",children:[(0,Pe.jsx)(lt,{className:"h-4 w-4 mr-2"}),"Pending sync items"]}),(0,Pe.jsx)("ul",{className:"mt-2 space-y-1 text-sm text-orange-700",children:D.map(e=>(0,Pe.jsxs)("li",{className:"flex justify-between",children:[(0,Pe.jsx)("span",{children:e.label}),(0,Pe.jsx)("span",{className:"font-medium",children:e.count})]},e.key))})]}),j&&(0,Pe.jsxs)("div",{className:"mt-4 flex items-center text-sm text-gray-500",children:[(0,Pe.jsx)(Ou,{className:"h-4 w-4 mr-2 animate-spin"}),"Checking unsynced data..."]}),(0,Pe.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Pe.jsx)("button",{onClick:X,className:"btn-secondary",disabled:j,children:"Cancel"}),(0,Pe.jsx)("button",{onClick:async()=>{if(!j){k(!0);try{if(q&&!m)try{const e=await G();if(e&&!1===e.isSynced){if(!N)return O({message:"You are offline. Please go online to sync pending settings before logging out.",offline:!0}),void k(!1);if(!await Y({silent:!0}))return O({message:"Unable to sync settings right now. Please try again shortly.",offline:!1}),void k(!1)}}catch(t){console.error("Error checking settings sync status before logout:",t)}const n=await h({type:"REQUEST_LOGOUT"});var e;if(null===n||void 0===n||!n.success)return null!==n&&void 0!==n&&null!==(e=n.unsynced)&&void 0!==e&&e.length&&P(n.unsynced),null!==n&&void 0!==n&&n.message&&window.showToast&&window.showToast(n.message,(null===n||void 0===n?void 0:n.toastType)||"warning"),O({message:(null===n||void 0===n?void 0:n.message)||"",offline:!(null===n||void 0===n||!n.offline)}),void k(!1);await(0,ve.CI)(Ne.auth),await h({type:i.ActionTypes.LOGOUT}),window.showToast&&window.showToast("Logged out successfully.","success"),T(!1)}catch(n){console.error("Sign out error:",n),await h({type:i.ActionTypes.LOGOUT}),window.showToast&&window.showToast("Logged out.","warning"),T(!1)}finally{k(!1)}}},className:"btn-primary bg-red-500 hover:bg-red-600",disabled:j,children:j?"Syncing...":"Logout"})]})]})})]})},Ob=Pb,Lb=e=>{var t,n,r,s,i,a;if(!e)return null;return(e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t})((null===(t=e.subscription)||void 0===t?void 0:t.expiresAt)||(null===(n=e.subscription)||void 0===n?void 0:n.expiryDate)||(null===(r=e.subscription)||void 0===r?void 0:r.endDate)||(null===(s=e.currentPlanDetails)||void 0===s?void 0:s.expiresAt)||(null===(i=e.currentPlanDetails)||void 0===i?void 0:i.expiryDate)||(null===(a=e.currentPlanDetails)||void 0===a?void 0:a.endDate)||null)},Mb=()=>{var e;const n=J(),{state:r,dispatch:s}=(0,i.nm)(),a=ee();return(0,t.useEffect)(()=>{const e=(0,$e.zD)(n.pathname);if(e&&r.currentView!==e){var t;(!("staff"===r.userType||"staff"===(null===(t=r.currentUser)||void 0===t?void 0:t.userType))||r.permissionsInitiallyLoaded)&&s({type:i.ActionTypes.SET_CURRENT_VIEW,payload:e})}},[n.pathname,s,r.currentView,r.userType,null===(e=r.currentUser)||void 0===e?void 0:e.userType,r.permissionsInitiallyLoaded]),(0,t.useEffect)(()=>{const e=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&(s({type:i.ActionTypes.SET_CURRENT_VIEW,payload:e}),a((0,$e.k_)(e),{replace:null!==(t=n.replace)&&void 0!==t&&t}))};return"undefined"!==typeof window&&(window.navigateToView=e),()=>{"undefined"!==typeof window&&window.navigateToView===e&&delete window.navigateToView}},[s,a]),(0,Pe.jsx)(yt,{children:(0,Pe.jsx)(ge,{})})},Fb=e=>{var t;let{viewKey:n,children:r}=e;const{state:s}=(0,i.nm)();if(null===s.currentPlanDetails)return r;const a="staff"===s.userType||"staff"===(null===(t=s.currentUser)||void 0===t?void 0:t.userType),o=(e=>{var t;if(!e)return!1;if(!1===e.isSubscriptionActive)return!0;if("expired"===("string"===typeof(null===(t=e.subscription)||void 0===t?void 0:t.status)?e.subscription.status.toLowerCase():null))return!0;const n=Lb(e);return!!n&&n.getTime()<=Date.now()})(s),l="upgrade"===n,c="staff"===n;let d=!0;if("settings"===n)d=!0;else if(a)if(c)d=!1;else{var u;const e=(null===(u=s.currentUser)||void 0===u?void 0:u.permissions)||{},t={dashboard:"dashboard",customers:"customers",products:"products",inventory:"inventory",billing:"billing",salesOrderHistory:"salesOrderHistory",refunds:"refunds",purchase:"purchaseOrders",financial:"financial",reports:"reports"}[n];d=!t||Boolean(e[t]),d||console.log("\ud83d\udd12 STAFF ROUTE BLOCKED for ".concat(n,":"),{requiredPermission:t,permissionValue:e[t],allStaffPermissions:Object.keys(e).filter(t=>!0===e[t])})}else d="upgrade"===n||"dashboard"===n||(0,Je.Ku)(n,s.currentPlan,s.currentPlanDetails),c&&(d=!0);var h;if(!a&&o&&!l&&"settings"!==n)return null!==(h=window)&&void 0!==h&&h.showToast&&window.showToast("Your subscription has expired. Upgrade your plan to continue.","warning"),(0,Pe.jsx)(pe,{to:(0,$e.k_)("upgrade"),replace:!0});if(!d&&!l){var m;if(null!==(m=window)&&void 0!==m&&m.showToast){const e=a?"You do not have permission to access this feature.":(0,Je.IV)(n,s.currentPlan);window.showToast(e,"warning")}if(a){var f;const e=(null===(f=s.currentUser)||void 0===f?void 0:f.permissions)||{},t=["customers","products","inventory","billing","salesOrderHistory","refunds","purchaseOrders","financial","reports","settings","dashboard"];let n="dashboard";for(const r of t)if(!0===e[r]){n=r;break}return(0,Pe.jsx)(pe,{to:(0,$e.k_)(n),replace:!0})}return(0,Pe.jsx)(pe,{to:(0,$e.k_)("dashboard"),replace:!0})}return r},Bb=()=>{const{state:e}=(0,i.nm)();return e.isAuthenticated?(0,Pe.jsx)(be,{children:(0,Pe.jsxs)(xe,{element:(0,Pe.jsx)(Mb,{}),children:[(0,Pe.jsx)(xe,{index:!0,element:(0,Pe.jsx)(pe,{to:"/dashboard",replace:!0})}),(0,Pe.jsx)(xe,{path:"/dashboard",element:(0,Pe.jsx)(Fb,{viewKey:"dashboard",children:(0,Pe.jsx)(Ot,{})})}),(0,Pe.jsx)(xe,{path:"/customers",element:(0,Pe.jsx)(Fb,{viewKey:"customers",children:(0,Pe.jsx)(Hc,{})})}),(0,Pe.jsx)(xe,{path:"/products",element:(0,Pe.jsx)(Fb,{viewKey:"products",children:(0,Pe.jsx)(Vu,{})})}),(0,Pe.jsx)(xe,{path:"/inventory",element:(0,Pe.jsx)(Fb,{viewKey:"inventory",children:(0,Pe.jsx)(Gu,{})})}),(0,Pe.jsx)(xe,{path:"/billing",element:(0,Pe.jsx)(Fb,{viewKey:"billing",children:(0,Pe.jsx)(Fu,{})})}),(0,Pe.jsx)(xe,{path:"/purchase",element:(0,Pe.jsx)(Fb,{viewKey:"purchase",children:(0,Pe.jsx)(Qu,{})})}),(0,Pe.jsx)(xe,{path:"/financial",element:(0,Pe.jsx)(Fb,{viewKey:"financial",children:(0,Pe.jsx)($y,{})})}),(0,Pe.jsx)(xe,{path:"/reports",element:(0,Pe.jsx)(Fb,{viewKey:"reports",children:(0,Pe.jsx)(rb,{})})}),(0,Pe.jsx)(xe,{path:"/sales-order-history",element:(0,Pe.jsx)(Fb,{viewKey:"salesOrderHistory",children:(0,Pe.jsx)(ab,{})})}),(0,Pe.jsx)(xe,{path:"/refunds",element:(0,Pe.jsx)(Fb,{viewKey:"refunds",children:(0,Pe.jsx)(db,{})})}),(0,Pe.jsx)(xe,{path:"/staff",element:(0,Pe.jsx)(Fb,{viewKey:"staff",children:(0,Pe.jsx)(gb,{})})}),(0,Pe.jsx)(xe,{path:"/upgrade",element:(0,Pe.jsx)(Fb,{viewKey:"upgrade",children:(0,Pe.jsx)(Ib,{})})}),(0,Pe.jsx)(xe,{path:"/settings",element:(0,Pe.jsx)(Fb,{viewKey:"settings",children:(0,Pe.jsx)(Ob,{})})}),(0,Pe.jsx)(xe,{path:"*",element:(0,Pe.jsx)(pe,{to:"/dashboard",replace:!0})})]})}):(0,Pe.jsxs)(be,{children:[(0,Pe.jsx)(xe,{path:"/login",element:(0,Pe.jsx)(Re,{})}),(0,Pe.jsx)(xe,{path:"/staff/signup",element:(0,Pe.jsx)(Ab,{})}),(0,Pe.jsx)(xe,{path:"*",element:(0,Pe.jsx)(pe,{to:"/login",replace:!0})})]})};const Ub=function(){return(0,Pe.jsx)(i.Dv,{children:(0,Pe.jsx)(bb,{children:(0,Pe.jsx)(Bb,{})})})};function zb(){navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("\u2705 Service Worker registered successfully:",e.scope);const t=localStorage.getItem("auth");if(t)try{const e=JSON.parse(t);e.isAuthenticated&&navigator.serviceWorker.controller&&setTimeout(()=>{navigator.serviceWorker.controller.postMessage({type:"AUTHENTICATED",user:e.currentUser}),navigator.serviceWorker.controller.postMessage({type:"CACHE_APP_RESOURCES"})},1e3)}catch(qb){console.error("Error parsing auth data:",qb)}e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&console.log("New service worker available. Refresh to update.")})})}).catch(e=>{e.message.includes("MIME type")||e.message.includes("text/html")?console.log("\u26a0\ufe0f Service Worker not available in development mode. This is normal."):console.error("\u274c Service Worker registration failed:",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("Service worker controller changed. Reloading...")})}s.createRoot(document.getElementById("root")).render((0,Pe.jsx)(t.StrictMode,{children:(0,Pe.jsx)(Ub,{})})),(0,Se.$C)().then(e=>{e.available?console.log("\u2705 Backend connected:",e.data):(console.warn("\u26a0\ufe0f Backend not available:",e.error),console.warn("\u26a0\ufe0f App will work in offline mode. Some features may be limited."))}).catch(e=>{console.warn("\u26a0\ufe0f Backend health check failed:",e)}),"serviceWorker"in navigator?(window.addEventListener("load",()=>{zb()}),window.addEventListener("online",()=>{console.log("\ud83c\udf10 Connection restored"),window.showToast&&window.showToast("Connection restored. Syncing data...","success"),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"TRIGGER_SYNC"})}),window.addEventListener("offline",()=>{console.log("\ud83d\udce1 Connection lost - App continues offline"),window.showToast&&window.showToast("You are offline. App continues to work.","info")})):console.warn("\u26a0\ufe0f Service Workers are not supported in this browser. PWA features unavailable."),console.log("\ud83d\udcf1 PWA Installability Check:"),console.log("- Service Worker Support:","serviceWorker"in navigator),console.log("- Display Mode:",window.matchMedia("(display-mode: standalone)").matches?"standalone":"browser")})()})();
//# sourceMappingURL=main.69886b26.js.map